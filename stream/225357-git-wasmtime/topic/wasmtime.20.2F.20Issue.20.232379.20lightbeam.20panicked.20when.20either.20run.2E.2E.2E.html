<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2379 lightbeam panicked when either run... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html">wasmtime / Issue #2379 lightbeam panicked when either run...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="216048624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216048624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216048624">(Nov 09 2020 at 06:55)</a>:</h4>
<p>qinxk-inter labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p><strong>- What are the steps to reproduce the issue?</strong><br>
t.wasm is wat2wasm from below text:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"></span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"add"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="p">))</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>./wasmtime run --lightbeam t.wasm 1 2<br>
./wasmtime wasm2obj --lightbeam t.wasm t.obj<br>
**- What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?**<br>
Expect to be run without any issue. Got error with the output:</p>
<blockquote>
<p>thread 'main' panicked at 'index out of bounds: the len is 0 but the index is 0', /PATH/wasmtime/crates/lightbeam/src/backend.rs:637:35<br>
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
</blockquote>
<p><strong>- Which Wasmtime version / commit hash / branch are you using?</strong><br>
main latest by now, commit 12e658a1ef344ccacf872accb0cadd7ef6e8cf4a<br>
<strong>- If relevant, can you include some extra information about your environment?</strong><br>
  (Rust version, operating system, architecture...)<br>
rustc 1.45.2, MacOS</p>
</blockquote>



<a name="216048625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216048625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216048625">(Nov 09 2020 at 06:55)</a>:</h4>
<p>qinxk-inter opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p><strong>- What are the steps to reproduce the issue?</strong><br>
t.wasm is wat2wasm from below text:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"></span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"add"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="p">))</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>./wasmtime run --lightbeam t.wasm 1 2<br>
./wasmtime wasm2obj --lightbeam t.wasm t.obj<br>
**- What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?**<br>
Expect to be run without any issue. Got error with the output:</p>
<blockquote>
<p>thread 'main' panicked at 'index out of bounds: the len is 0 but the index is 0', /PATH/wasmtime/crates/lightbeam/src/backend.rs:637:35<br>
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
</blockquote>
<p><strong>- Which Wasmtime version / commit hash / branch are you using?</strong><br>
main latest by now, commit 12e658a1ef344ccacf872accb0cadd7ef6e8cf4a<br>
<strong>- If relevant, can you include some extra information about your environment?</strong><br>
  (Rust version, operating system, architecture...)<br>
rustc 1.45.2, MacOS</p>
</blockquote>



<a name="216054420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216054420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216054420">(Nov 09 2020 at 08:29)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2379#issuecomment-723853274">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p>The panic happens at <a href="https://github.com/bytecodealliance/wasmtime/blob/12e658a1ef344ccacf872accb0cadd7ef6e8cf4a/crates/lightbeam/src/backend.rs#L637">https://github.com/bytecodealliance/wasmtime/blob/12e658a1ef344ccacf872accb0cadd7ef6e8cf4a/crates/lightbeam/src/backend.rs#L637</a></p>
<p><code>func_starts</code> should be filled at <a href="https://github.com/bytecodealliance/wasmtime/blob/12e658a1ef344ccacf872accb0cadd7ef6e8cf4a/crates/lightbeam/src/backend.rs#L610-L612">https://github.com/bytecodealliance/wasmtime/blob/12e658a1ef344ccacf872accb0cadd7ef6e8cf4a/crates/lightbeam/src/backend.rs#L610-L612</a></p>
<p><code>func_count</code> gets it's value from <a href="https://github.com/bytecodealliance/wasmtime/blob/77827a48a924337b3b690d8f35aef0f601af6dde/crates/lightbeam/wasmtime/src/lib.rs#L38-L42">https://github.com/bytecodealliance/wasmtime/blob/77827a48a924337b3b690d8f35aef0f601af6dde/crates/lightbeam/wasmtime/src/lib.rs#L38-L42</a></p>
<p>All elements in <code>function_body_inputs</code> are taken just before at <a href="https://github.com/bytecodealliance/wasmtime/blob/77827a48a924337b3b690d8f35aef0f601af6dde/crates/jit/src/compiler.rs#L131">https://github.com/bytecodealliance/wasmtime/blob/77827a48a924337b3b690d8f35aef0f601af6dde/crates/jit/src/compiler.rs#L131</a> leaving the count at zero.</p>
</blockquote>



<a name="216097013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216097013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216097013">(Nov 09 2020 at 15:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2379#issuecomment-724074549">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p>The lightbeam backend is known to currently have many bugs in it and is not tested on CI. It's not recommended for widespread usage. Thanks for the report, though, this is good to know when someone gets around to fixing lightbeam issues!</p>
</blockquote>



<a name="216097029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216097029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216097029">(Nov 09 2020 at 15:12)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p><strong>- What are the steps to reproduce the issue?</strong><br>
t.wasm is wat2wasm from below text:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$lhs</span><span class="w"></span>
<span class="w">    </span><span class="n">get_local</span><span class="w"> </span><span class="cp">$rhs</span><span class="w"></span>
<span class="w">    </span><span class="kt">i32</span><span class="p">.</span><span class="n">add</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"add"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$add</span><span class="p">))</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>./wasmtime run --lightbeam t.wasm 1 2<br>
./wasmtime wasm2obj --lightbeam t.wasm t.obj<br>
**- What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?**<br>
Expect to be run without any issue. Got error with the output:</p>
<blockquote>
<p>thread 'main' panicked at 'index out of bounds: the len is 0 but the index is 0', /PATH/wasmtime/crates/lightbeam/src/backend.rs:637:35<br>
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
</blockquote>
<p><strong>- Which Wasmtime version / commit hash / branch are you using?</strong><br>
main latest by now, commit 12e658a1ef344ccacf872accb0cadd7ef6e8cf4a<br>
<strong>- If relevant, can you include some extra information about your environment?</strong><br>
  (Rust version, operating system, architecture...)<br>
rustc 1.45.2, MacOS</p>
</blockquote>



<a name="216150084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216150084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216150084">(Nov 09 2020 at 22:17)</a>:</h4>
<p>daubaris <a href="https://github.com/bytecodealliance/wasmtime/issues/2379#issuecomment-724311403">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p>Are the lengths of <code>translation.function_body_input</code> and <code>translation.native_signatures</code> are always the same or can they be different in some situations?</p>
</blockquote>



<a name="216150413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232379%20lightbeam%20panicked%20when%20either%20run.../near/216150413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232379.20lightbeam.20panicked.20when.20either.20run.2E.2E.2E.html#216150413">(Nov 09 2020 at 22:21)</a>:</h4>
<p>daubaris edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2379#issuecomment-724311403">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2379">Issue #2379</a>:</p>
<blockquote>
<p>Are the lengths of <code>translation.function_body_input</code> and <code>translation.native_signatures</code> always the same or can they be different in some situations?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>