<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7298 New Fuel APIs for Store · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html">wasmtime / PR #7298 New Fuel APIs for Store</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="397579443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397579443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397579443">(Oct 19 2023 at 21:23)</a>:</h4>
<p><strong>rockwotj</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397579444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397579444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397579444">(Oct 19 2023 at 21:23)</a>:</h4>
<p>rockwotj opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a> from <code>rockwotj:fuel2</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Fixes: #7255</p>
<p>I've implemented the APIs as documented in the strawman there, but I used <code>Option&lt;NonZeroU64&gt;</code> for the yield interval instead of trying to figure out what to do if the yield interval is <code>0</code>.</p>
<p>I also took a stab in the second commit in being able to support the full range of <code>u64</code> so that you can <code>set_fuel(u64::MAX)</code> then <code>get_fuel() == u64::MAX</code>. This makes accounting externally less tricky since we're removing that functionality from wasmtime directly.<br>
</p>
</blockquote>



<a name="397579446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397579446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397579446">(Oct 19 2023 at 21:23)</a>:</h4>
<p><strong>rockwotj</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397579775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397579775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397579775">(Oct 19 2023 at 21:26)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397580013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397580013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397580013">(Oct 19 2023 at 21:28)</a>:</h4>
<p>rockwotj edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>:</p>
<blockquote>
<p>Fixes: #7255</p>
<p>I've implemented the APIs as documented in the strawman there, but I used <code>Option&lt;NonZeroU64&gt;</code> for the yield interval instead of trying to figure out what to do if the yield interval is <code>0</code>.</p>
<p>I also took a stab in the second commit in being able to support the full range of <code>u64</code> so that you can <code>set_fuel(u64::MAX)</code> then <code>get_fuel() == u64::MAX</code>. This makes accounting externally less tricky since we're removing that functionality from wasmtime directly.</p>
<p>prtest:full</p>
</blockquote>



<a name="397580057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397580057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397580057">(Oct 19 2023 at 21:29)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397730134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397730134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397730134">(Oct 20 2023 at 15:04)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397730640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397730640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397730640">(Oct 20 2023 at 15:07)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397731717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397731717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397731717">(Oct 20 2023 at 15:13)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397735115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397735115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397735115">(Oct 20 2023 at 15:31)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397742716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397742716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397742716">(Oct 20 2023 at 16:19)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397762899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397762899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397762899">(Oct 20 2023 at 19:09)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397772737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397772737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397772737">(Oct 20 2023 at 20:34)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397781286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397781286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397781286">(Oct 20 2023 at 22:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397792630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397792630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397792630">(Oct 21 2023 at 00:32)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397792642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397792642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397792642">(Oct 21 2023 at 00:32)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397792691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397792691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397792691">(Oct 21 2023 at 00:33)</a>:</h4>
<p>rockwotj edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>:</p>
<blockquote>
<p>In an effort to simplify the many fuel related APIs, simplify the<br>
interface here to a single counter with get and set methods.<br>
Additionally the async yield is reduced to an interval of the total fuel<br>
instead of injecting fuel, so it's easy to still reason about how much<br>
fuel is left even with yielding turned on.</p>
<p>Internally this works by keeping two counters - one the VM uses to<br>
increment towards 0 for fuel, the other to track how much is in<br>
"reserve". Then when we're out of gas, we pull from the reserve to<br>
refuel and continue. We use the reserve in two cases: one for overflow<br>
of the fuel (which is an i64 and the API expresses fuel as u64) and the<br>
other for async yieling, which then the yield interval acts as a cap to<br>
how much we can refuel with.</p>
<p>This also means that <code>get_fuel</code> can return the full range of <code>u64</code><br>
before this change it could only return up to <code>i64::MAX</code>. This is<br>
important because this PR is removing the functionality to track fuel<br>
consumption, and this makes the API less error prone for embedders to<br>
track consumption themselves.</p>
<p>Careful to note that the VM counter that is stored as <code>i64</code> can be<br>
positive if an instruction "costs" multiple units of fuel when the fuel<br>
ran out.</p>
<p>Fixes: #7255</p>
<p>I've implemented the APIs as documented in the strawman from the issue, but I used <code>Option&lt;NonZeroU64&gt;</code> for the yield interval instead of trying to figure out what to do if the yield interval is <code>0</code>.</p>
</blockquote>



<a name="397793162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397793162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397793162">(Oct 21 2023 at 00:38)</a>:</h4>
<p>rockwotj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1691027397">PR review</a>.</p>



<a name="397793163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397793163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397793163">(Oct 21 2023 at 00:38)</a>:</h4>
<p>rockwotj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1691027397">PR review</a>.</p>



<a name="397793166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397793166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397793166">(Oct 21 2023 at 00:38)</a>:</h4>
<p>rockwotj created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1367573085">PR review comment</a>:</p>
<blockquote>
<p>I wanted to make sure to write unit tests for the methods standalone from the rest to ensure I got all the overflow cases correct, so hence pulling these methods out as standalone so they can be tested directly. I don't know if this is a "normal" pattern or not, but it did help me catch a couple of bugs.</p>
</blockquote>



<a name="397794058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397794058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397794058">(Oct 21 2023 at 00:47)</a>:</h4>
<p>rockwotj edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>:</p>
<blockquote>
<p>In an effort to simplify the many fuel related APIs, simplify the<br>
interface here to a single counter with get and set methods.<br>
Additionally the async yield is reduced to an interval of the total fuel<br>
instead of injecting fuel, so it's easy to still reason about how much<br>
fuel is left even with yielding turned on.</p>
<p>Internally this works by keeping two counters - one the VM uses to<br>
increment towards 0 for fuel, the other to track how much is in<br>
"reserve". Then when we're out of gas, we pull from the reserve to<br>
refuel and continue. We use the reserve in two cases: one for overflow<br>
of the fuel (which is an i64 and the API expresses fuel as u64) and the<br>
other for async yieling, which then the yield interval acts as a cap to<br>
how much we can refuel with.</p>
<p>This also means that <code>get_fuel</code> can return the full range of <code>u64</code><br>
before this change it could only return up to <code>i64::MAX</code>. This is<br>
important because this PR is removing the functionality to track fuel<br>
consumption, and this makes the API less error prone for embedders to<br>
track consumption themselves.</p>
<p>Careful to note that the VM counter that is stored as <code>i64</code> can be<br>
positive if an instruction "costs" multiple units of fuel when the fuel<br>
ran out.</p>
<p>Fixes: #7255</p>
<p>I've implemented the APIs as documented in the strawman from the issue, <br>
but I used <code>Option&lt;NonZeroU64&gt;</code> for the yield interval instead of trying<br>
to figure out what to do if the yield interval is <code>0</code>.</p>
</blockquote>



<a name="397983858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397983858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397983858">(Oct 23 2023 at 00:39)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="397987373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/397987373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#397987373">(Oct 23 2023 at 01:12)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398106404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398106404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398106404">(Oct 23 2023 at 15:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1692809899">PR review</a>:</p>
<blockquote>
<p>Wow I really like how this all turned out, thank you for pushing on this!</p>
<p>I've got a few cosmetic-related concerns but otherwise I think this is good to go. If you're up for it as well it might be good to do a once-over of fuel-related documentation not only on <code>Store</code> but also <code>Config</code> and perhaps other locations since this is a somewhat significant departure from the prior model (but well worth it). For example running out of fuel now unconditionally panics and that cannot be configured, which may be lingering in a few locations (and if not then nothing to do yay!)</p>
</blockquote>



<a name="398106405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398106405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398106405">(Oct 23 2023 at 15:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1692809899">PR review</a>:</p>
<blockquote>
<p>Wow I really like how this all turned out, thank you for pushing on this!</p>
<p>I've got a few cosmetic-related concerns but otherwise I think this is good to go. If you're up for it as well it might be good to do a once-over of fuel-related documentation not only on <code>Store</code> but also <code>Config</code> and perhaps other locations since this is a somewhat significant departure from the prior model (but well worth it). For example running out of fuel now unconditionally panics and that cannot be configured, which may be lingering in a few locations (and if not then nothing to do yay!)</p>
</blockquote>



<a name="398106406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398106406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398106406">(Oct 23 2023 at 15:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1368838198">PR review comment</a>:</p>
<blockquote>
<p>While I think it definitely makes sense to store this as <code>Option&lt;NonZeroU64&gt;</code> taking that as a function parameter here may be a bit overkill in the sense that it's somewhat unergonomic to call. Could this instead take <code>Option&lt;u64&gt;</code> and return an error for <code>Some(0)</code>?</p>
</blockquote>



<a name="398106407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398106407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398106407">(Oct 23 2023 at 15:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1368828298">PR review comment</a>:</p>
<blockquote>
<p>Nah while this isn't common right now I think this is a good idea, so thanks for adding these tests!</p>
</blockquote>



<a name="398106409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398106409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398106409">(Oct 23 2023 at 15:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1368836634">PR review comment</a>:</p>
<blockquote>
<p>Reader over this I realize that the term "consumed" here is inherited from the <code>StoreLimits</code> but in isolation I think it's somewhat confusing because it's not actually consumed fuel, it's actually "negating this gives you some remaining fuel".</p>
<p>I'm curious, do you have an idea of a better name for this? Not a blocker for the PR of course, but if you've got an idea for a better name it'd definitely be ok to rename here.</p>
</blockquote>



<a name="398126947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398126947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398126947">(Oct 23 2023 at 17:11)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398127091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127091">(Oct 23 2023 at 17:12)</a>:</h4>
<p>rockwotj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693050980">PR review</a>:</p>
<blockquote>
<blockquote>
<p>If you're up for it as well it might be good to do a once-over of fuel-related documentation not only on Store but also Config and perhaps other locations since this is a somewhat significant departure from the prior model (but well worth it). For example running out of fuel now unconditionally panics and that cannot be configured, which may be lingering in a few locations (and if not then nothing to do yay!)</p>
</blockquote>
<p>I found one place in Config::consume_fuel so nice suggestion! A quick glance over the project via <code>git grep fuel</code> did not show any other usages.</p>
</blockquote>



<a name="398127092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127092">(Oct 23 2023 at 17:12)</a>:</h4>
<p>rockwotj created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1368981947">PR review comment</a>:</p>
<blockquote>
<p>I've been thinking about this in terms of "active fuel" or "injected fuel". I'll use the term "injected" unless you prefer "active"</p>
</blockquote>



<a name="398127093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127093">(Oct 23 2023 at 17:12)</a>:</h4>
<p>rockwotj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693050980">PR review</a>:</p>
<blockquote>
<blockquote>
<p>If you're up for it as well it might be good to do a once-over of fuel-related documentation not only on Store but also Config and perhaps other locations since this is a somewhat significant departure from the prior model (but well worth it). For example running out of fuel now unconditionally panics and that cannot be configured, which may be lingering in a few locations (and if not then nothing to do yay!)</p>
</blockquote>
<p>I found one place in Config::consume_fuel so nice suggestion! A quick glance over the project via <code>git grep fuel</code> did not show any other usages.</p>
</blockquote>



<a name="398127094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127094">(Oct 23 2023 at 17:12)</a>:</h4>
<p>rockwotj created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1368983115">PR review comment</a>:</p>
<blockquote>
<p>Thoughts on what to do for the C API in that case? Do we just translate the 0 there into <code>None</code>?</p>
</blockquote>



<a name="398127224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127224">(Oct 23 2023 at 17:13)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398127621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398127621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398127621">(Oct 23 2023 at 17:16)</a>:</h4>
<p><strong>rockwotj</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398138301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398138301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398138301">(Oct 23 2023 at 18:40)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693261237">PR review</a>.</p>



<a name="398138396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398138396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398138396">(Oct 23 2023 at 18:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693264343">PR review</a>.</p>



<a name="398138397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398138397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398138397">(Oct 23 2023 at 18:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1369112622">PR review comment</a>:</p>
<blockquote>
<p>Yeah I think that's reasonable to do for the C API as magical numbers like that are relatively common in C</p>
</blockquote>



<a name="398140501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398140501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398140501">(Oct 23 2023 at 18:57)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398140614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398140614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398140614">(Oct 23 2023 at 18:58)</a>:</h4>
<p>rockwotj submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693324833">PR review</a>.</p>



<a name="398140615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398140615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398140615">(Oct 23 2023 at 18:58)</a>:</h4>
<p>rockwotj created <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#discussion_r1369144440">PR review comment</a>:</p>
<blockquote>
<p>Okay I've made this change then.</p>
</blockquote>



<a name="398140721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398140721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398140721">(Oct 23 2023 at 18:58)</a>:</h4>
<p>rockwotj updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398140749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398140749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398140749">(Oct 23 2023 at 18:59)</a>:</h4>
<p><strong>rockwotj</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398141449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398141449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398141449">(Oct 23 2023 at 19:03)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7298#pullrequestreview-1693347323">PR review</a>.</p>



<a name="398141462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398141462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398141462">(Oct 23 2023 at 19:03)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<a name="398153487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237298%20New%20Fuel%20APIs%20for%20Store/near/398153487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237298.20New.20Fuel.20APIs.20for.20Store.html#398153487">(Oct 23 2023 at 20:43)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7298">PR #7298</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>