<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4389 x64: port `atomic_rmw` to ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html">wasmtime / PR #4389 x64: port `atomic_rmw` to ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="288605465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288605465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288605465">(Jul 05 2022 at 23:47)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>:</p>
<blockquote>
<p>This change ports <code>atomic_rmw</code> to ISLE for the x64 backend. It does not<br>
change the lowering in any way, though it seems possible that the fixed<br>
regs need not be as fixed and that there are opportunities for single<br>
instruction lowerings. It does rename <code>inst_common::AtomicRmwOp</code> to<br>
<code>MachAtomicRmwOp</code> to disambiguate with the IR enum with the same name.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="288609566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609566">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1029351169">PR review</a>.</p>



<a name="288609567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609567">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1029351169">PR review</a>.</p>



<a name="288609568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609568">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914307436">PR review comment</a>:</p>
<blockquote>
<p>Let's keep some variant of this FIXME around: it would still be ideal to not have hardcoded registers in the sequence, but rather allocate as many temps as needed (as operands) and use them here.</p>
</blockquote>



<a name="288609569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609569">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914309317">PR review comment</a>:</p>
<blockquote>
<p>No indent here</p>
</blockquote>



<a name="288609570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609570">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914308415">PR review comment</a>:</p>
<blockquote>
<p>Can we assert something about <code>flags</code>? (We could pass it into <code>x64_atomic_rmw_seq</code> and match only the flags that we expect, or something like that...)</p>
</blockquote>



<a name="288609571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609571">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914309088">PR review comment</a>:</p>
<blockquote>
<p>These two should be "late uses", or otherwise the below two defs should be "early defs", semantically. It won't matter yet with the fixed reg constraints (neither of the defs could possibly overlap either of the uses) but it will matter when we eventually remove the need for the fixed regs, and I'd rather note it now while we're thinking about it!</p>
<p>I don't think there is a <code>reg_fixed_late_use</code> on the <code>OperandCollector</code> but we should be able to add one, analogously to the other helpers there.</p>
</blockquote>



<a name="288609572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288609572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288609572">(Jul 06 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914307879">PR review comment</a>:</p>
<blockquote>
<p>Likewise here, let's have some sort of TODO noting that ideally we wouldn't have register constraints.</p>
</blockquote>



<a name="288615906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288615906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288615906">(Jul 06 2022 at 02:40)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1029423932">PR review</a>.</p>



<a name="288615907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288615907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288615907">(Jul 06 2022 at 02:40)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914362681">PR review comment</a>:</p>
<blockquote>
<p>Ok, I might actually add another commit to this PR to avoid the hard coded registers... Just wanted to make sure this was on the right track. (Or I could open another PR, I guess).</p>
</blockquote>



<a name="288689183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288689183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288689183">(Jul 06 2022 at 15:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288690465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288690465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288690465">(Jul 06 2022 at 15:46)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288690494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288690494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288690494">(Jul 06 2022 at 15:46)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030327081">PR review</a>.</p>



<a name="288690495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288690495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288690495">(Jul 06 2022 at 15:46)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914999090">PR review comment</a>:</p>
<blockquote>
<p>I think we probably want a <code>fixed_reg_use_at_end</code> helper in <code>regalloc2</code>. See what I did in <code>OperandCollector</code> in the interim.</p>
</blockquote>



<a name="288690536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288690536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288690536">(Jul 06 2022 at 15:47)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r914999387">PR review comment</a>:</p>
<blockquote>
<p>Not sure what we should assert here.</p>
</blockquote>



<a name="288690537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288690537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288690537">(Jul 06 2022 at 15:47)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030327491">PR review</a>.</p>



<a name="288691812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288691812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288691812">(Jul 06 2022 at 15:56)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288709049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288709049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288709049">(Jul 06 2022 at 18:11)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288722943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288722943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288722943">(Jul 06 2022 at 20:02)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288723214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288723214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288723214">(Jul 06 2022 at 20:04)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r915211087">PR review comment</a>:</p>
<blockquote>
<p>Ok, take a look at 3799054, which calculates the amode at this point instead of in <code>emit.rs</code>. I believe this is the more conventional way to do things in ISLE now, but unfortunately I see failures related <code>reg.is_real()</code> so the <code>mem.finalize...</code> part must not be right.</p>
</blockquote>



<a name="288723215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288723215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288723215">(Jul 06 2022 at 20:04)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030634991">PR review</a>.</p>



<a name="288723429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288723429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288723429">(Jul 06 2022 at 20:06)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r915212342">PR review comment</a>:</p>
<blockquote>
<p>Ah, I think this is missing the corresponding use of the amode in the <code>get_operands</code> method; once that's added (in the same order as the <code>allocs</code> invocations) it should probably work?</p>
</blockquote>



<a name="288723437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288723437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288723437">(Jul 06 2022 at 20:06)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030636915">PR review</a>.</p>



<a name="288725148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288725148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288725148">(Jul 06 2022 at 20:20)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288725481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288725481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288725481">(Jul 06 2022 at 20:23)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030655762">PR review</a>.</p>



<a name="288725483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288725483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288725483">(Jul 06 2022 at 20:23)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r915224713">PR review comment</a>:</p>
<blockquote>
<p>Hm, that fixes one problem but now I see <code>wasm trap: out of bounds memory access</code> from <code>threads.wast</code>. <code>mem.get_operands()</code> ends up doing a <code>collector.reg_use()</code> instead of <code>collector.reg_late_use()</code> like we were doing previously--seems like this could be the problem?</p>
</blockquote>



<a name="288735933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288735933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288735933">(Jul 06 2022 at 21:52)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030754534">PR review</a>.</p>



<a name="288735934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288735934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288735934">(Jul 06 2022 at 21:52)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r915284813">PR review comment</a>:</p>
<blockquote>
<p>Ah yes! I think we'll need a variant of <code>SyntheticAmode::get_operands()</code> (and the functions it calls, <code>Amode::get_operands()</code> at least) that is something like <code>get_operands_late()</code> and internally does <code>reg_late_use()</code> instead.</p>
</blockquote>



<a name="288740924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288740924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288740924">(Jul 06 2022 at 22:52)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288741106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741106">(Jul 06 2022 at 22:55)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#discussion_r915316160">PR review comment</a>:</p>
<blockquote>
<p>Ok, that seems to work.</p>
</blockquote>



<a name="288741107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741107">(Jul 06 2022 at 22:55)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030796110">PR review</a>.</p>



<a name="288741113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741113">(Jul 06 2022 at 22:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4389#pullrequestreview-1030796130">PR review</a>.</p>



<a name="288741115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741115">(Jul 06 2022 at 22:55)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> as ready for review.</p>



<a name="288741226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741226">(Jul 06 2022 at 22:57)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288741410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741410">(Jul 06 2022 at 22:59)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a> from <code>isle-atomic-rmw</code> to <code>main</code>.</p>



<a name="288741678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288741678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288741678">(Jul 06 2022 at 23:02)</a>:</h4>
<p>abrown has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a>.</p>



<a name="288745681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234389%20x64%3A%20port%20%60atomic_rmw%60%20to%20ISLE/near/288745681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234389.20x64.3A.20port.20.60atomic_rmw.60.20to.20ISLE.html#288745681">(Jul 06 2022 at 23:59)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4389">PR #4389</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>