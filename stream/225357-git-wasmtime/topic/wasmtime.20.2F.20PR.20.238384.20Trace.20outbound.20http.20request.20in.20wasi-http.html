<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8384 Trace outbound http request in wasi-http · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html">wasmtime / PR #8384 Trace outbound http request in wasi-http</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="433580617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433580617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433580617">(Apr 16 2024 at 18:18)</a>:</h4>
<p><strong>calebschoepp</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>.</p>



<a name="433580619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433580619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433580619">(Apr 16 2024 at 18:18)</a>:</h4>
<p><strong>calebschoepp</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>.</p>



<a name="433580620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433580620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433580620">(Apr 16 2024 at 18:18)</a>:</h4>
<p>calebschoepp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a> from <code>calebschoepp:trace-outbound-request</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is to support tracing of outbound HTTP request in downstream libraries like <a href="https://github.com/fermyon/spin/issues/2354">Spin</a>.</p>
<ul>
<li>Adds tracing to <code>default_send_request</code> that follows the OTel HTTP trace <a href="https://opentelemetry.io/docs/specs/semconv/http/http-spans/">semantic conventions</a>.</li>
<li>Makes sure that the trace context is propagated across the async boundary introduced by the spawn.<br>
</li>
</ul>
</blockquote>



<a name="433581323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433581323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433581323">(Apr 16 2024 at 18:22)</a>:</h4>
<p>calebschoepp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>.</p>



<a name="433593451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593451">(Apr 16 2024 at 19:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#pullrequestreview-2004476129">PR review</a>.</p>



<a name="433593452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593452">(Apr 16 2024 at 19:45)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#discussion_r1567865606">PR review comment</a>:</p>
<blockquote>
<p>I've not used <code>#[instrument]</code> myself before, but would it be possible to do something like <code>url.full = request.uri()</code> here in the macro instead of in the body below? I'm not sure if that has type restrictions on the return value of <code>.ur()</code>, but adding <code>.to_string()</code> may work well too.</p>
<p>Also, mind adding some comments as to what <code>otel.kind</code>, <code>otel.name</code>, and <code>server.{address,port}</code> are doing? The first two seem like sort of "standard variables" to set, but the second two aren't set here in the method either.</p>
</blockquote>



<a name="433593564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593564">(Apr 16 2024 at 19:46)</a>:</h4>
<p>calebschoepp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>.</p>



<a name="433593666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593666">(Apr 16 2024 at 19:47)</a>:</h4>
<p>calebschoepp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#pullrequestreview-2004478574">PR review</a>.</p>



<a name="433593667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593667">(Apr 16 2024 at 19:47)</a>:</h4>
<p>calebschoepp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#discussion_r1567867160">PR review comment</a>:</p>
<blockquote>
<p>Sure, I'll look into that @alexcrichton. Also sorry, I force pushed a linting fix without realizing you'd already started reviewing this.</p>
</blockquote>



<a name="433593784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433593784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433593784">(Apr 16 2024 at 19:48)</a>:</h4>
<p>calebschoepp <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#issuecomment-2059813583">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>:</p>
<blockquote>
<p>@alexcrichton is this something worth backporting to <code>v18</code>? It seems like this code changes a reasonable amount between <code>v18</code> and <code>v19</code>.</p>
</blockquote>



<a name="433594365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433594365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433594365">(Apr 16 2024 at 19:52)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#issuecomment-2059819278">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>:</p>
<blockquote>
<p>It's possible yeah to backport to 18/19, yeah, but if it works it'd probably be best to get this in <code>main</code> and backport it to the 20.0.0 release happening this weekend and having Spin update to 20.0.0 </p>
</blockquote>



<a name="433613484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433613484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433613484">(Apr 16 2024 at 21:51)</a>:</h4>
<p>calebschoepp closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>.</p>



<a name="433613485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238384%20Trace%20outbound%20http%20request%20in%20wasi-http/near/433613485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238384.20Trace.20outbound.20http.20request.20in.20wasi-http.html#433613485">(Apr 16 2024 at 21:51)</a>:</h4>
<p>calebschoepp <a href="https://github.com/bytecodealliance/wasmtime/pull/8384#issuecomment-2059977572">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8384">PR #8384</a>:</p>
<blockquote>
<p>Closing this b/c after a discussion with @alexcrichton we decided it is best to do this tracing in Spin. A subsequent PR will follow that will expose <code>handler</code> for Spin to use.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>