<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5020 fuzzgen: Generate compiler flags · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html">wasmtime / issue #5020 fuzzgen: Generate compiler flags</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="302471622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/302471622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#302471622">(Oct 05 2022 at 14:39)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1268494798">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:meta", "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="303314046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/303314046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#303314046">(Oct 10 2022 at 19:19)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1273717975">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>This PR had some performance issues:</p>
<ul>
<li>
<p>The regalloc checker started consuming a bunch of time (around 45%) so we now try to minimize runs with it (10% with the current iteration).</p>
</li>
<li>
<p>I've also had to limit the amount of runs that we allow, at some point the fuzzer decided that spending 100% of the time in the interpreter was a good idea, and started generating huge inputs, that were in the order of 20k runs each. (up to 130k!)</p>
</li>
</ul>
<p>execs/s seems way better than before, which is nice.</p>
<p>And for those who are interested, here's a flamegraph of where we spend time. This is about 1min at 1Khz around 190k inputs into my normal benchmark run:</p>
<p>![flamegraph all](<a href="https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg">https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg</a>)</p>
</blockquote>



<a name="303314194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/303314194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#303314194">(Oct 10 2022 at 19:20)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1273717975">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>This PR had some performance issues:</p>
<ul>
<li>
<p>The regalloc checker started consuming a bunch of time (around 45%) so we now try to minimize runs with it (10% with the current iteration).</p>
</li>
<li>
<p>I've also had to limit the amount of runs that we allow, at some point the fuzzer decided that spending 100% of the time in the interpreter was a good idea, and started generating huge inputs, that were in the order of 20k runs each. (up to 130k!)</p>
</li>
</ul>
<p>execs/s seems way better than before, which is nice.</p>
<p>And for those who are interested, here's a flamegraph of where we spend time. This is about 2min at 1Khz around 190k inputs into my normal benchmark run:</p>
<p>![flamegraph all](<a href="https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg">https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg</a>)</p>
</blockquote>



<a name="303314473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/303314473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#303314473">(Oct 10 2022 at 19:22)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1273717975">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>This PR had some performance issues:</p>
<ul>
<li>
<p>The regalloc checker started consuming a bunch of time (around 45%) so we now try to minimize runs with it (10% with the current iteration).</p>
</li>
<li>
<p>I've also had to limit the amount of runs that we allow, at some point the fuzzer decided that spending 100% of the time in the interpreter was a good idea, and started generating huge inputs, that were in the order of 20k runs each. (up to 130k!)</p>
</li>
</ul>
<p>execs/s seems way better than before, which is nice.</p>
<p>And for those who are interested, here's a flamegraph of where we spend time. This is about 2min at 1Khz around 190k inputs into my normal benchmark run:</p>
<p>![flamegraph all](<a href="https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg">https://user-images.githubusercontent.com/1357143/194936815-38ab0c4c-211c-4828-95fc-ad63e9f5ba74.svg</a>)</p>
<p>Edit: I should note, this is all on top of #5034 </p>
</blockquote>



<a name="304560114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/304560114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#304560114">(Oct 17 2022 at 21:17)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1281506641">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>I've given this one round of fuzzing on AArch64 and x86, and it found the two issues with <code>iconst</code>, one has already been fixed in  #5061 and I'm working on removing <code>iconst.i128</code>, once that is merged I'll give this another round of fuzzing and if everything goes right we should be able to merge this.</p>
</blockquote>



<a name="305239537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/305239537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#305239537">(Oct 20 2022 at 21:16)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1286162493">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>@cfallin What do you think about merging this with the <code>use_egraphs</code> flag commented out and enabling that on a separate PR?</p>
<p>It's getting a bit annoying having to rebase my other work on this PR just to fuzz it. I've fuzzed this for about an hour on both AArch64 and x86 without <code>use_egraphs</code> and it seems stable.</p>
</blockquote>



<a name="305240444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/305240444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#305240444">(Oct 20 2022 at 21:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1286168777">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<p>Oh, for sure, I didn't know we were waiting on something here; sorry! I was waiting for your go-ahead to merge. FWIW the PR is still marked as a draft; go ahead and transition it to "Ready for review" when you want me to merge.</p>
<p>I actually think maybe it's fine to include <code>use_egraphs</code>; better to get the fuzzbugs coming sooner than later, and I'm happy to take them as they come in. But I'm open to the other approach if you think otherwise.</p>
</blockquote>



<a name="305250129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/305250129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#305250129">(Oct 20 2022 at 22:41)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1286237708">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<blockquote>
<p>Oh, for sure, I didn't know we were waiting on something here; sorry! <br>
I wasn't really, I just got a bit annoyed today at having to do a rebase for the third time, that's where that suggestion came from!</p>
</blockquote>
<p>I'm okay with merging this as is and letting fuzzgen report issues as we go along.</p>
</blockquote>



<a name="305250168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235020%20fuzzgen%3A%20Generate%20compiler%20flags/near/305250168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235020.20fuzzgen.3A.20Generate.20compiler.20flags.html#305250168">(Oct 20 2022 at 22:41)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5020#issuecomment-1286237708">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5020">issue #5020</a>:</p>
<blockquote>
<blockquote>
<p>Oh, for sure, I didn't know we were waiting on something here; sorry! </p>
</blockquote>
<p>I wasn't really, I just got a bit annoyed today at having to do a rebase for the third time, that's where that suggestion came from!</p>
<p>I'm okay with merging this as is and letting ossfuzz report issues as we go along.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>