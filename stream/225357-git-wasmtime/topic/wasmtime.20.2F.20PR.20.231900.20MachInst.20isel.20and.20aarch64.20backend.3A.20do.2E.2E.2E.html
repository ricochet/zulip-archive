<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1900 MachInst isel and aarch64 backend: do... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html">wasmtime / PR #1900 MachInst isel and aarch64 backend: do...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="201308095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201308095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201308095">(Jun 18 2020 at 18:33)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1900">PR #1900</a> from <code>clarify-lowering-docs</code> to <code>master</code>:</p>
<blockquote>
<p>From discussion with Julian and Ben, this PR makes a few documentation-<br>
and naming-level changes (no functionality change):</p>
<ul>
<li>
<p>Document that the <code>LowerCtx</code>-provided output register can be used as a<br>
  scratch register during the lowered instruction sequence before<br>
  placing the final result in it.</p>
</li>
<li>
<p>Rename <code>input_to_*</code> helpers in the AArch64 backend to<br>
<code>put_input_in_*</code>, emphasizing that these are side-effecting helpers<br>
  that potentially generate code (e.g., sign/zero-extensions) to ensure<br>
  an input value is in a register.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="201308096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201308096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201308096">(Jun 18 2020 at 18:33)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1900">PR #1900</a>.</p>



<a name="201308097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201308097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201308097">(Jun 18 2020 at 18:33)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1900">PR #1900</a>.</p>



<a name="201313927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201313927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201313927">(Jun 18 2020 at 19:21)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1900">PR #1900</a> from <code>clarify-lowering-docs</code> to <code>master</code>:</p>
<blockquote>
<p>From discussion with Julian and Ben, this PR makes a few documentation-<br>
and naming-level changes (no functionality change):</p>
<ul>
<li>
<p>Document that the <code>LowerCtx</code>-provided output register can be used as a<br>
  scratch register during the lowered instruction sequence before<br>
  placing the final result in it.</p>
</li>
<li>
<p>Rename <code>input_to_*</code> helpers in the AArch64 backend to<br>
<code>put_input_in_*</code>, emphasizing that these are side-effecting helpers<br>
  that potentially generate code (e.g., sign/zero-extensions) to ensure<br>
  an input value is in a register.</p>
</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="201352817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201352817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201352817">(Jun 19 2020 at 05:05)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-433804359">PR Review</a>.</p>



<a name="201352818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201352818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201352818">(Jun 19 2020 at 05:05)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r442632557">PR Review Comment</a>:</p>
<blockquote>
<p>Indeed, IIUC, <code>it is guaranteed not to overlap with any of the inputs of either this or any other IR instruction</code>, yes?</p>
</blockquote>



<a name="201352820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201352820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201352820">(Jun 19 2020 at 05:05)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-433804359">PR Review</a>.</p>



<a name="201600393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201600393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201600393">(Jun 22 2020 at 12:44)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-434881740">PR Review</a>.</p>



<a name="201600394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201600394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201600394">(Jun 22 2020 at 12:44)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-434881740">PR Review</a>.</p>



<a name="201600395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201600395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201600395">(Jun 22 2020 at 12:44)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r443527948">PR Review Comment</a>:</p>
<blockquote>
<p>This output IR inst could be the input to another IR inst, right? And we're only concerned about usage local to the current IR instruction here. Maybe I'm missing something here?</p>
</blockquote>



<a name="201600396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201600396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201600396">(Jun 22 2020 at 12:44)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r443529973">PR Review Comment</a>:</p>
<blockquote>
<p>Thanks for this renaming which clarifies the side-effects happening here indeed.</p>
<p>As an alternative, as demonstrated by the changes in this PR, it seems that the narrowing is the edge case, and not the usual thing to do.</p>
<p>Two propositions:</p>
<ul>
<li>either we could add another helper function <code>get_input(ctx, input)</code> which really reads the input and does no side-effect? Callers of <code>put_input_in_reg</code> with <code>NarrowMode::None</code> could call this function instead.</li>
<li>or we could just remove the NarrowMode parameter all the time, and having another helper function that does the narrowing, separating the different responsibilities more clearly? (I hope to implement it this way on the x64 backend, if possible.)</li>
</ul>
</blockquote>



<a name="201752431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201752431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201752431">(Jun 23 2020 at 16:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-435973916">PR Review</a>.</p>



<a name="201752432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201752432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201752432">(Jun 23 2020 at 16:54)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r444369668">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, as @bnjbvr said, the guarantee is only in the context of the current instruction being lowered (since if it were never used by any other IR instruction either, the computation would be dead).</p>
</blockquote>



<a name="201752752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201752752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201752752">(Jun 23 2020 at 16:57)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-435976312">PR Review</a>.</p>



<a name="201752753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201752753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201752753">(Jun 23 2020 at 16:57)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r444371504">PR Review Comment</a>:</p>
<blockquote>
<p>Sure, I would be fine with the latter; perhaps we can consider this in the context of refactoring to share helpers with the x64 backend? (I'm thinking that e.g. we could define a trait to describe codegen for value widening and then plug that into a generic helper, for example. Similar for codegenning constants. Part of a "libMachBackend" of sorts as an optional layer on top of the lowering context API.)</p>
</blockquote>



<a name="201752947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201752947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201752947">(Jun 23 2020 at 16:59)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1900">PR #1900</a>.</p>



<a name="201825803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201825803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201825803">(Jun 24 2020 at 09:09)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#discussion_r444754377">PR Review Comment</a>:</p>
<blockquote>
<p>Good idea!</p>
</blockquote>



<a name="201825804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231900%20MachInst%20isel%20and%20aarch64%20backend%3A%20do.../near/201825804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231900.20MachInst.20isel.20and.20aarch64.20backend.3A.20do.2E.2E.2E.html#201825804">(Jun 24 2020 at 09:09)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1900#pullrequestreview-436463928">PR Review</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>