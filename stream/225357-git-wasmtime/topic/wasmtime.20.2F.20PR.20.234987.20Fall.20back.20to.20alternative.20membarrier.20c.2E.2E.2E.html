<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4987 Fall back to alternative membarrier c... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html">wasmtime / PR #4987 Fall back to alternative membarrier c...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="301696440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301696440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301696440">(Sep 30 2022 at 17:16)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4987">PR #4987</a> from <code>aarch64-membarrier-cmd-shared</code> to <code>main</code>:</p>
<blockquote>
<p>This is an attempt to fix #4972 by adding a fallback syscall that older kernels should support. The fallback is invoked only if the more specific membarrier fails.</p>
</blockquote>



<a name="301696441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301696441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301696441">(Sep 30 2022 at 17:16)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/akirilov-arm">akirilov-arm</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4987">PR #4987</a>.</p>



<a name="301698776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301698776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301698776">(Sep 30 2022 at 17:29)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#pullrequestreview-1127146905">PR review</a>.</p>



<a name="301698778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301698778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301698778">(Sep 30 2022 at 17:29)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#discussion_r984807529">PR review comment</a>:</p>
<blockquote>
<p><code>RegisterPrivateExpeditedSyncCore</code> registers intent to use <code>PrivateExpeditedSyncCore</code> later on in the <code>publish</code> method. <code>Global</code> should be used in <code>publish</code> and doesn't have an associated register command.</p>
</blockquote>



<a name="301700248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301700248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301700248">(Sep 30 2022 at 17:37)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#pullrequestreview-1127145015">PR review</a>.</p>



<a name="301700249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301700249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301700249">(Sep 30 2022 at 17:37)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#pullrequestreview-1127145015">PR review</a>.</p>



<a name="301700250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301700250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301700250">(Sep 30 2022 at 17:37)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#discussion_r984806226">PR review comment</a>:</p>
<blockquote>
<p>This change should be applied to line 171 instead, and I think that here you can just use <code>unwrap_or_default()</code>.</p>
<p>Since the <code>EXPEDITED</code> commands have additional overhead (according to <a href="https://man7.org/linux/man-pages/man2/membarrier.2.html">the documentation</a>), the process must opt in explicitly to use them via the corresponding <code>REGISTER</code> command (e.g. <code>MEMBARRIER_CMD_REGISTER_PRIVATE_EXPEDITED_SYNC_CORE</code>); the call here is precisely that registration.</p>
<p>BTW in hindsight when I implemented this initially, adding this call here was probably not the best idea because the registration should happen only once for the whole lifetime of the process (instead of whenever a <code>CodeMemory</code> object is created, though subsequent registrations are harmless); perhaps the moment of the <code>Engine</code> creation is a better time? Of course, that assumes that no one is going to use a <code>CodeMemory</code> object without creating an <code>Engine</code> first.</p>
</blockquote>



<a name="301700592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301700592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301700592">(Sep 30 2022 at 17:38)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#pullrequestreview-1127157500">PR review</a>.</p>



<a name="301700593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/301700593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#301700593">(Sep 30 2022 at 17:38)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#discussion_r984814611">PR review comment</a>:</p>
<blockquote>
<p>Ninja'd by @bjorn3 <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span>.</p>
</blockquote>



<a name="302069700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/302069700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#302069700">(Oct 03 2022 at 14:01)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4987#discussion_r984814611">PR review comment</a>.</p>



<a name="302325325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234987%20Fall%20back%20to%20alternative%20membarrier%20c.../near/302325325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234987.20Fall.20back.20to.20alternative.20membarrier.20c.2E.2E.2E.html#302325325">(Oct 04 2022 at 18:47)</a>:</h4>
<p>cfallin closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/4987">PR #4987</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>