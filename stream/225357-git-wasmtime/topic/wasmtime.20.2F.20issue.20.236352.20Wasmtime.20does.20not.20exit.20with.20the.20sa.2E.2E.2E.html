<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6352 Wasmtime does not exit with the sa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html">wasmtime / issue #6352 Wasmtime does not exit with the sa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="356530275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356530275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356530275">(May 07 2023 at 17:56)</a>:</h4>
<p>yowl opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Create a wasm which as a main that exits with  a return value &gt; 1.  E.g. the attached</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>wasmtime --wasm-features=threads --wasi-modules=experimental-wasi-threads HelloWasm.wasm</li>
<li>echo %ERROR_LEVEL%</li>
</ul>
<h3>Expected Results</h3>
<p>should print 100</p>
<h3>Actual Results</h3>
<p>prints 1</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime-cli 9.0.0</p>
<p>Operating system: Win11</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>Node.js prints 100 for this test.  Thanks!</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/11415667/HelloWasm.zip">HelloWasm.zip</a><br>
</p>
</blockquote>



<a name="356530276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356530276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356530276">(May 07 2023 at 17:56)</a>:</h4>
<p>yowl labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Create a wasm which as a main that exits with  a return value &gt; 1.  E.g. the attached</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>wasmtime --wasm-features=threads --wasi-modules=experimental-wasi-threads HelloWasm.wasm</li>
<li>echo %ERROR_LEVEL%</li>
</ul>
<h3>Expected Results</h3>
<p>should print 100</p>
<h3>Actual Results</h3>
<p>prints 1</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime-cli 9.0.0</p>
<p>Operating system: Win11</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>Node.js prints 100 for this test.  Thanks!</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/11415667/HelloWasm.zip">HelloWasm.zip</a><br>
</p>
</blockquote>



<a name="356531563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356531563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356531563">(May 07 2023 at 18:04)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537506424">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>On Windows, error codes have a different meaning than on Unix. Error code 100 on Windows <a href="https://learn.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-">means</a> "Cannot create another system semaphore", which wouldn't correctly reflect the intent of a portable program, so Wasmtime normalizes error codes.</p>
</blockquote>



<a name="356532124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356532124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356532124">(May 07 2023 at 18:08)</a>:</h4>
<p>yowl <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537507387">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>I see, this it the how the dotnet runtime tests work so would have thought they would be ok.  Note that node.js behaves in line with how these tests are run.  However if it is not consider wrong, then I can take it up with the dotnet team and perhaps change the how the test results are analysed.</p>
</blockquote>



<a name="356532266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356532266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356532266">(May 07 2023 at 18:09)</a>:</h4>
<p>yowl <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537507749">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>E.g. <a href="https://github.com/dotnet/runtimelab/blob/7fe97907a9a2f677e74f4a116363236c4966651c/src/tests/nativeaot/SmokeTests/UnitTests/Main.cs#L20">https://github.com/dotnet/runtimelab/blob/7fe97907a9a2f677e74f4a116363236c4966651c/src/tests/nativeaot/SmokeTests/UnitTests/Main.cs#L20</a></p>
</blockquote>



<a name="356535717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356535717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356535717">(May 07 2023 at 18:40)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537514045">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>There is some design tension here. On one hand there's a desire to have WASI programs be portable and avoid having assumptions about how they're being used. On the other hand, this dotnet example shows an example of programs that know how they're going to be used and have a special convention that only has meaning in that context.</p>
<p>We could potentially relax this, within some limits (Unix has more restrictions on the value). Perhaps one question is, how much of a need is there for real-world programs to use custom error code conventions, rather than just specialized situations like test harnesses?</p>
</blockquote>



<a name="356538136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356538136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356538136">(May 07 2023 at 19:02)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537518430">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>Rust uses 101 for panics. ls uses 1 for minor issues and 2 for major issues. Tar uses 1 for when some files differ in comparison mode and uses 2 for fatal errors.</p>
</blockquote>



<a name="356538160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356538160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356538160">(May 07 2023 at 19:03)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537518430">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>Rust uses 101 for panics. <code>ls</code> uses 1 for minor issues and 2 for major issues. <code>tar</code> uses 1 for when some files differ in comparison mode and uses 2 for fatal errors.</p>
</blockquote>



<a name="356554933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356554933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356554933">(May 07 2023 at 22:23)</a>:</h4>
<p>yowl <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537553435">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<blockquote>
<p>Error code 100 on Windows <a href="https://learn.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-">means</a></p>
</blockquote>
<p>These are the code for <code>GetLastError</code>, i.e. calls to the Win32 API, which is not the same as the main return value.  Interestingly it looks like *nix has more restrictions, yet wasmtime does indeed return the main exit code there (e.g. with <code>$?</code> in bash)<br>
</p>
</blockquote>



<a name="356557873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356557873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356557873">(May 07 2023 at 22:58)</a>:</h4>
<p>yowl <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537559973">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>Some more investigation, <code>wasmer</code> on linux and windows shows 100 for the exit code.  Out of the 4 that I've tried the odd one out so far is wasmtime on windows.</p>
</blockquote>



<a name="356573291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356573291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356573291">(May 08 2023 at 01:48)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1537625237">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<blockquote>
<p>These are the code for GetLastError, i.e. calls to the Win32 API, which is not the same as the main return value. </p>
</blockquote>
<p>There are programs which return the <code>GetLastError</code> as their exit status, though it appears this convention is not as widespread as I initially thought.</p>
<p>Wasmtime is starting to anticipate WASI Preview2 in some parts of its implementation, and Preview2 currently has only a boolean success-or-failure exit status from commands. I've now filed <a href="https://github.com/WebAssembly/wasi-cli/issues/11">https://github.com/WebAssembly/wasi-cli/issues/11</a> to discuss expanding it.</p>
</blockquote>



<a name="356699109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356699109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356699109">(May 08 2023 at 13:10)</a>:</h4>
<p>yowl <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1538337121">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>Thanks, @sunfishcode  do you want to close this then and it can just be taken up in <a href="https://github.com/WebAssembly/wasi-cli/issues/11">https://github.com/WebAssembly/wasi-cli/issues/11</a> ?  That would be fine with me.</p>
</blockquote>



<a name="356770588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356770588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356770588">(May 08 2023 at 17:15)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/6352#issuecomment-1538747011">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<p>Yeah, seems like we should have one issue for this: I also had <a href="https://github.com/WebAssembly/WASI/issues/524">https://github.com/WebAssembly/WASI/issues/524</a> open which I believe is similar.</p>
</blockquote>



<a name="356770791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236352%20Wasmtime%20does%20not%20exit%20with%20the%20sa.../near/356770791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236352.20Wasmtime.20does.20not.20exit.20with.20the.20sa.2E.2E.2E.html#356770791">(May 08 2023 at 17:16)</a>:</h4>
<p>yowl closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6352">issue #6352</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Create a wasm which as a main that exits with  a return value &gt; 1.  E.g. the attached</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>wasmtime --wasm-features=threads --wasi-modules=experimental-wasi-threads HelloWasm.wasm</li>
<li>echo %ERROR_LEVEL%</li>
</ul>
<h3>Expected Results</h3>
<p>should print 100</p>
<h3>Actual Results</h3>
<p>prints 1</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: wasmtime-cli 9.0.0</p>
<p>Operating system: Win11</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>Node.js prints 100 for this test.  Thanks!</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/11415667/HelloWasm.zip">HelloWasm.zip</a><br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>