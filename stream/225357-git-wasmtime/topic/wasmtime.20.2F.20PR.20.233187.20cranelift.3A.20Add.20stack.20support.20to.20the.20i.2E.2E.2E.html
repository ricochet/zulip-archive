<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3187 cranelift: Add stack support to the i... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html">wasmtime / PR #3187 cranelift: Add stack support to the i...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="249524493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249524493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249524493">(Aug 15 2021 at 18:13)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>:</p>
<blockquote>
<p>Hey,</p>
<p>This PR is #3164 with an additional Virtual Addressing scheme that was discussed as a better alternative to returning the real addresses.</p>
<p>The virtual addresses are split into 4 regions (stack, heap, tables and global values), and the address itself is composed of an <code>entry</code> field and an <code>offset</code> field. In general the <code>entry</code> field corresponds to the instance of the resource (e.g. table5 is entry 5) and the <code>offset</code> field is a byte offset inside that entry.</p>
<p>There is one exception to this which is the stack, where due to only having one stack, the whole address is an offset field.</p>
<p>The number of bits in entry vs offset fields is variable with respect to the <code>region</code> and the address size (32bits vs 64bits). This is done because with 32 bit addresses we would have to compromise on heap size, or have a small number of global values / tables. With 64 bit addresses we do not have to compromise on this, but we need to support 32 bit addresses.</p>
<p>cc: @abrown @cfallin </p>
</blockquote>



<a name="249524542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249524542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249524542">(Aug 15 2021 at 18:14)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>:</p>
<blockquote>
<p>Hey,</p>
<p>This PR is #3164 with an additional Virtual Addressing scheme that was discussed as a better alternative to returning the real addresses.</p>
<p>The virtual addresses are split into 4 regions (stack, heap, tables and global values), and the address itself is composed of an <code>entry</code> field and an <code>offset</code> field. In general the <code>entry</code> field corresponds to the instance of the resource (e.g. table5 is entry 5) and the <code>offset</code> field is a byte offset inside that entry.</p>
<p>There is one exception to this which is the stack, where due to only having one stack, the whole address is an offset field.</p>
<p>The number of bits in entry vs offset fields is variable with respect to the region and the address size (32bits vs 64bits). This is done because with 32 bit addresses we would have to compromise on heap size, or have a small number of global values / tables. With 64 bit addresses we do not have to compromise on this, but we need to support 32 bit addresses.</p>
<p>cc: @abrown @cfallin </p>
</blockquote>



<a name="249525871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249525871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249525871">(Aug 15 2021 at 18:55)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="249526826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249526826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249526826">(Aug 15 2021 at 19:22)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="249616485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249616485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249616485">(Aug 16 2021 at 17:06)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730928550">PR review</a>.</p>



<a name="249616487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249616487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249616487">(Aug 16 2021 at 17:06)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730928550">PR review</a>.</p>



<a name="249616488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249616488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249616488">(Aug 16 2021 at 17:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689698076">PR review comment</a>:</p>
<blockquote>
<p>nit: I think it might be helpful here to just document all of the decisions made in this file in a table:</p>
<table>
<thead>
<tr>
<th>address size</th>
<th>address kind</th>
<th>region value (2 bits)</th>
<th>entry bits (#)</th>
<th>offset bits (#)</th>
</tr>
</thead>
<tbody>
<tr>
<td>32</td>
<td>Stack</td>
<td>0b00</td>
<td>0</td>
<td>30</td>
</tr>
<tr>
<td>32</td>
<td>Heap</td>
<td>0b01</td>
<td>2</td>
<td>28</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>64</td>
<td>Stack</td>
<td>0b00</td>
<td>0</td>
<td>62</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>



<a name="249616489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249616489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249616489">(Aug 16 2021 at 17:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689707453">PR review comment</a>:</p>
<blockquote>
<p>I should really create a helper functions for this common "just run the interpreter on this CLIF" case. Don't worry about it for this PR but eventually I'll do something like that. </p>
</blockquote>



<a name="249618374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249618374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249618374">(Aug 16 2021 at 17:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730949886">PR review</a>.</p>



<a name="249618375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249618375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249618375">(Aug 16 2021 at 17:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689716555">PR review comment</a>:</p>
<blockquote>
<p>Would it make sense to track the current sum (basically a "frame pointer") in the interpreter state, rather than compute this dynamically? I could see a worst-case quadratic cost here especially if the fuzzer gets too devious with its test-case generation.</p>
</blockquote>



<a name="249618376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249618376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249618376">(Aug 16 2021 at 17:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730949886">PR review</a>.</p>



<a name="249618377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249618377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249618377">(Aug 16 2021 at 17:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689714510">PR review comment</a>:</p>
<blockquote>
<p>Is there a particular reason that we need to pull these specific errors out of the more general "heap out-of-bounds" error below? It seems to me that at least the first two (OOB load, OOB store) are canonical OOB cases, and "invalid address" would make some sense if we had a more general notion of address-space maps in Wasm, but I think the complexity and confusion presented in the API here is not really worth it. @abrown thoughts?</p>
</blockquote>



<a name="249618378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249618378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249618378">(Aug 16 2021 at 17:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689718935">PR review comment</a>:</p>
<blockquote>
<p>Converting to a raw pointer then accessing it with <code>unsafe</code> feels a little bit unnecessary to me -- not that it's hard to see the safety here, since the code is very simple, but it entrenches a pattern that could go wrong later if it gets much more complicated.</p>
<p>Instead perhaps could we:</p>
<ul>
<li>Get a slice <code>&amp;mut [u8]</code> of raw memory bytes from whatever region/object we're accessing (so the underlying interpreter-state for the stack, any wasm memories, etc., is just a <code>Vec&lt;u8&gt;</code>)</li>
<li>Slice that into the number of bytes we need at the offset we need</li>
<li>Provide accessors on <code>DataValue</code> that read and write from <code>&amp;[u8]</code> / <code>&amp;mut [u8]</code>?</li>
</ul>
</blockquote>



<a name="249623163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249623163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249623163">(Aug 16 2021 at 17:52)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730983898">PR review</a>.</p>



<a name="249623164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249623164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249623164">(Aug 16 2021 at 17:52)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689740937">PR review comment</a>:</p>
<blockquote>
<p>I guess that makes sense: <code>InvalidAddress</code> is also really just an OOB. Can we get away with <code>StackOutOfBounds</code> here (to match the other <code>...OutOfBounds</code> below)?</p>
</blockquote>



<a name="249623521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249623521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249623521">(Aug 16 2021 at 17:55)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730986353">PR review</a>.</p>



<a name="249623522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249623522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249623522">(Aug 16 2021 at 17:55)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689742822">PR review comment</a>:</p>
<blockquote>
<p>I think @afonso360 was just going along with what existed previously in <code>DataValue</code> (those unsafe methods are necessary for interacting with trampolines). I agree that it would probably be better to just some safe versions of those functions to <code>DataValue</code>.</p>
</blockquote>



<a name="249624715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249624715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249624715">(Aug 16 2021 at 18:03)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-730993115">PR review</a>.</p>



<a name="249624716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249624716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249624716">(Aug 16 2021 at 18:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689748237">PR review comment</a>:</p>
<blockquote>
<p>Indeed, it was a reasonable approach given the APIs that existed! The unsafe accessors on <code>DataValue</code> can certainly stay for the other use-cases (and perhaps a future refactor can centralize those into e.g. <code>unsafe { std::slice::from_raw_parts(...) }</code> in the trampoline-adjacent code and then use of safe APIs on <code>DataValue</code>, but that's a separate conversation!).</p>
</blockquote>



<a name="249635278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249635278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249635278">(Aug 16 2021 at 19:25)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-731058007">PR review</a>.</p>



<a name="249635279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249635279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249635279">(Aug 16 2021 at 19:25)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689799719">PR review comment</a>:</p>
<blockquote>
<p>I didn't use <code>HeapOutOfBounds</code> because i thought it would be heap specific, but we can fold all other memory accesses / invalid address into that.</p>
<p>We can also specialize a <code>StackOutOfBounds</code> for <code>stack_loads</code>/<code>stores</code>.</p>
</blockquote>



<a name="249647188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249647188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249647188">(Aug 16 2021 at 21:02)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-731131586">PR review</a>.</p>



<a name="249647190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/249647190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#249647190">(Aug 16 2021 at 21:02)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r689857515">PR review comment</a>:</p>
<blockquote>
<p>Yeah, sounds like a good idea. I can probably fix that when I implement heap access, ill probably have to add a number of tests similar to these ones.</p>
</blockquote>



<a name="250224098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250224098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250224098">(Aug 21 2021 at 15:55)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="250328658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250328658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250328658">(Aug 23 2021 at 09:30)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-735911519">PR review</a>.</p>



<a name="250328659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250328659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250328659">(Aug 23 2021 at 09:30)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r693812697">PR review comment</a>:</p>
<blockquote>
<p>It looks like <code>read_value_from</code>/<code>write_value_to</code> are only used in the interpreter, so I replaced them with <code>write_to_slice</code> and <code>read_from_slice</code>. It looks like we don't use them anywhere else, but if we need them we have a version that uses <code>slice::from_raw_parts</code> in 5c594c4</p>
</blockquote>



<a name="250328709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250328709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250328709">(Aug 23 2021 at 09:31)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="250329562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250329562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250329562">(Aug 23 2021 at 09:42)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-735922674">PR review</a>.</p>



<a name="250329565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250329565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250329565">(Aug 23 2021 at 09:42)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r693821592">PR review comment</a>:</p>
<blockquote>
<p>Oh, it looks like we duplicate the <code>write_value_to</code> in <a href="http://function_runner.rs">function_runner.rs</a></p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/b2bcdd13ecb87e9c7cdae9cead1e490bcd47e4fe/cranelift/filetests/src/function_runner.rs#L235-L247">https://github.com/bytecodealliance/wasmtime/blob/b2bcdd13ecb87e9c7cdae9cead1e490bcd47e4fe/cranelift/filetests/src/function_runner.rs#L235-L247</a></p>
</blockquote>



<a name="250332026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250332026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250332026">(Aug 23 2021 at 10:12)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="250332290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250332290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250332290">(Aug 23 2021 at 10:15)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="250332402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250332402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250332402">(Aug 23 2021 at 10:16)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#pullrequestreview-735952984">PR review</a>.</p>



<a name="250332404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250332404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250332404">(Aug 23 2021 at 10:16)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r693844578">PR review comment</a>:</p>
<blockquote>
<p>Since we had this duplicated, I thought it would be best to merge it all into DataValue right now before we have some hard to track down memory layout mismatch.</p>
</blockquote>



<a name="250332474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250332474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250332474">(Aug 23 2021 at 10:17)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3187#discussion_r693821592">PR review comment</a>.</p>



<a name="250454014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250454014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250454014">(Aug 24 2021 at 08:04)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a> from <code>interperter-stack-vaddr</code> to <code>main</code>.</p>



<a name="250510435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233187%20cranelift%3A%20Add%20stack%20support%20to%20the%20i.../near/250510435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233187.20cranelift.3A.20Add.20stack.20support.20to.20the.20i.2E.2E.2E.html#250510435">(Aug 24 2021 at 16:29)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3187">PR #3187</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>