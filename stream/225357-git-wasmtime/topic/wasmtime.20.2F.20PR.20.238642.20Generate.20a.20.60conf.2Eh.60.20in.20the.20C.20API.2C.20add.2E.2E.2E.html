<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8642 Generate a `conf.h` in the C API, add... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html">wasmtime / PR #8642 Generate a `conf.h` in the C API, add...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="439124177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439124177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439124177">(May 17 2024 at 00:21)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a> from <code>alexcrichton:c-api-features-in-cmake</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Work in progress to leverage our concurrency on PRs to test this more. I'll fill in more details when this is ready.</p>
</blockquote>



<a name="439125171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439125171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439125171">(May 17 2024 at 00:32)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439125712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439125712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439125712">(May 17 2024 at 00:39)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439126012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439126012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439126012">(May 17 2024 at 00:43)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>:</p>
<blockquote>
<p>Work in progress to leverage our concurrency on PRs to test this more. I'll fill in more details when this is ready.</p>
<p>Unorganized bullets of motivation:</p>
<ul>
<li>C-API can be configured right now and some symbols disappear, but this is not reflected in the C headers</li>
<li>Cannot easily configure features via CMake</li>
<li>Current CMake does not easily support cross-compilation</li>
</ul>
<p>Unorganized bullets of changes:</p>
<ul>
<li>Add CMake options for all Cargo features</li>
<li>Add <code>conf.h.in</code> header file and generate <code>conf.h</code> as part of CMake build</li>
<li>Move documenting the C API to CMake (as it needs generated header)</li>
<li>Move installation of the C API into CMake (including things like <code>install_name_tool</code> on macOS)<br>
</li>
</ul>
</blockquote>



<a name="439126133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439126133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439126133">(May 17 2024 at 00:45)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439127244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439127244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439127244">(May 17 2024 at 01:00)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439127304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439127304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439127304">(May 17 2024 at 01:01)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>:</p>
<blockquote>
<p>Work in progress to leverage our concurrency on PRs to test this more. I'll fill in more details when this is ready.</p>
<p>Unorganized bullets of motivation:</p>
<ul>
<li>C-API can be configured right now and some symbols disappear, but this is not reflected in the C headers</li>
<li>Cannot easily configure features via CMake</li>
<li>Current CMake does not easily support cross-compilation</li>
</ul>
<p>Unorganized bullets of changes:</p>
<ul>
<li>Add CMake options for all Cargo features</li>
<li>Add <code>conf.h.in</code> header file and generate <code>conf.h</code> as part of CMake build</li>
<li>Move documenting the C API to CMake (as it needs generated header)</li>
<li>Move installation of the C API into CMake (including things like <code>install_name_tool</code> on macOS)</li>
<li>Various Android bits removed from CMake</li>
<li>The c-api artifacts now have a separate set of headers for the "min" build instead of having the "min" libraries be next to the typical libraries<br>
</li>
</ul>
</blockquote>



<a name="439127338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439127338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439127338">(May 17 2024 at 01:01)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439132832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439132832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439132832">(May 17 2024 at 02:10)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439133354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439133354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439133354">(May 17 2024 at 02:17)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439138060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439138060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439138060">(May 17 2024 at 03:08)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439142536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439142536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439142536">(May 17 2024 at 03:55)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>.</p>



<a name="439142546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238642%20Generate%20a%20%60conf.h%60%20in%20the%20C%20API%2C%20add.../near/439142546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238642.20Generate.20a.20.60conf.2Eh.60.20in.20the.20C.20API.2C.20add.2E.2E.2E.html#439142546">(May 17 2024 at 03:55)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8642">PR #8642</a>:</p>
<blockquote>
<p>This commit overhauls and refactors the management of the building of<br>
the C API. Instead of this being script-based it's now done entirely<br>
through CMake and CMake is the primary focus for building the C API. For<br>
example building the C API release artifacts is now done through CMake<br>
instead of through a shell script's <code>cargo build</code> and manually moving<br>
artifacts.</p>
<p>The benefits that this brings are:</p>
<ul>
<li>
<p>The C API now properly hides symbols in its header files that weren't<br>
  enabled at build time. This is done through a new build-time generated<br>
<code>conf.h</code> templated on a <code>conf.h.in</code> file in the source tree.</p>
</li>
<li>
<p>The C API's project now supports enabling/disabling Cargo features to<br>
  have finer-grained support over what's included (plus auto-management<br>
  of the header file).</p>
</li>
<li>
<p>Building the C API and managing it is now exclusively done through<br>
  CMake. For example invoking <code>doxygen</code> now lives in CMake, installation<br>
  lives there, etc.</p>
</li>
</ul>
<p>The <code>CMakeLists.txt</code> file for the C API is overhauled in the process of<br>
doing this. The build now primarily matches on the Rust target being<br>
built rather than the host target. Additionally installation will now<br>
install both the static and shared libraries instead of just one.<br>
Additionally during this refactoring various bits and pieces of<br>
Android-specific code were all removed. Management of the C toolchain<br>
feels best left in scope of the caller (e.g. configuring <code>CC_*</code> env vars<br>
and such) rather than here.<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>