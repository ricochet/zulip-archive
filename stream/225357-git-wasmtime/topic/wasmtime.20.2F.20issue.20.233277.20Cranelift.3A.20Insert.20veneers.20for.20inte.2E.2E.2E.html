<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3277 Cranelift: Insert veneers for inte... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html">wasmtime / issue #3277 Cranelift: Insert veneers for inte...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="251606078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233277%20Cranelift%3A%20Insert%20veneers%20for%20inte.../near/251606078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html#251606078">(Sep 01 2021 at 18:23)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3277">issue #3277</a>:</p>
<blockquote>
<p>More details coming soon, reserving an issue number to write in the code...</p>
</blockquote>



<a name="251606079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233277%20Cranelift%3A%20Insert%20veneers%20for%20inte.../near/251606079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html#251606079">(Sep 01 2021 at 18:23)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3277">issue #3277</a>:</p>
<blockquote>
<p>More details coming soon, reserving an issue number to write in the code...</p>
</blockquote>



<a name="251606081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233277%20Cranelift%3A%20Insert%20veneers%20for%20inte.../near/251606081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html#251606081">(Sep 01 2021 at 18:23)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3277">issue #3277</a>:</p>
<blockquote>
<p>More details coming soon, reserving an issue number to write in the code...</p>
</blockquote>



<a name="251606082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233277%20Cranelift%3A%20Insert%20veneers%20for%20inte.../near/251606082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html#251606082">(Sep 01 2021 at 18:23)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3277">issue #3277</a>:</p>
<blockquote>
<p>More details coming soon, reserving an issue number to write in the code...</p>
</blockquote>



<a name="251607246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233277%20Cranelift%3A%20Insert%20veneers%20for%20inte.../near/251607246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233277.20Cranelift.3A.20Insert.20veneers.20for.20inte.2E.2E.2E.html#251607246">(Sep 01 2021 at 18:31)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3277">issue #3277</a>:</p>
<blockquote>
<p>This issue is intended to track <a href="https://github.com/bytecodealliance/wasmtime/blob/1532516a363eed88b5a36726a1710411a9883049/cranelift/codegen/src/machinst/buffer.rs#L1278-L1310">this FIXME in the code</a> which specifically relates to how inter-function relative calls, used for the first time in Wasmtime in <a href="https://github.com/bytecodealliance/wasmtime/pull/3275">https://github.com/bytecodealliance/wasmtime/pull/3275</a>, have limited jump ranges (especially on AArch64 with 26-bit jumps), and may need fixups.</p>
<p>Today if a compiled function on AArch64 is greater than 64MB in size then it runs the risk of panicking when "linking" if it needs to call a function defined after that function. The <code>MachBuffer</code> used when assembling the function does not keep track of relative calls and where they are, instead it just assumes all relocations will still work once the function is fully generated.</p>
<p>The fix for this issue will be introducing the notion of a permanently unresolved label in <code>MachBuffer</code>. This label would then be used for relocations which are recognized as a <code>LabelUse</code> (probably via the <code>LabelUse::from_reloc</code> function). The <code>MachBuffer</code> would automatically insert veneers for these <code>LabelUse</code> items and, at the end of a function, would take all the remaining <code>LabelUse</code> items and generate relocations for them.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>