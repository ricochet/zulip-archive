<html>
<head><meta charset="utf-8"><title>wasmtime / issue #2980 Port to OpenBSD! · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html">wasmtime / issue #2980 Port to OpenBSD!</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="242478171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/242478171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#242478171">(Jun 12 2021 at 23:28)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-860125677">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>I'll also note that this depends on <a href="https://github.com/darfink/region-rs/issues/8">darfink/region-rs#8</a>, which was recently added but has not yet been released yet; I'll ping over there to see if they can release a new version to <a href="http://crates.io">crates.io</a>.</p>
</blockquote>



<a name="242478714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/242478714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#242478714">(Jun 12 2021 at 23:43)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-860126771">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @kubkon</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasi"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>kubkon: wasi</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="242622770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/242622770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#242622770">(Jun 14 2021 at 16:17)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-860813439">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>@cfallin, I'm interested in why the openvino-sys crate is failing: the way we build it here, it _should_ have no target-specific logic since it uses <code>libloading</code> to look for the right libraries. Can you send me the failed build output and I'll try to fix upstream?</p>
</blockquote>



<a name="242627755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/242627755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#242627755">(Jun 14 2021 at 16:55)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-860837766">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin, I'm interested in why the openvino-sys crate is failing: the way we build it here, it _should_ have no target-specific logic since it uses <code>libloading</code> to look for the right libraries. Can you send me the failed build output and I'll try to fix upstream?</p>
</blockquote>
<p>It's an issue with some platform-specific constants that are defined with <code>#[cfg(linux)]</code> or similar rather than "all Unix-like platforms", I think:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0425</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">`</span><span class="n">ENV_LIBRARY_PATH</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">openvino</span><span class="o">-</span><span class="n">finder</span><span class="o">-</span><span class="mf">0.3.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">44</span>:<span class="mi">37</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">44</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">var_os</span><span class="p">(</span><span class="n">ENV_LIBRARY_PATH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                                     </span><span class="o">^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0425</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">`</span><span class="n">DEFAULT_INSTALLATION_DIRECTORIES</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cfallin</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">openvino</span><span class="o">-</span><span class="n">finder</span><span class="o">-</span><span class="mf">0.3.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">54</span>:<span class="mi">24</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">54</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="k">for</span><span class="w"> </span><span class="n">default_dir</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">DEFAULT_INSTALLATION_DIRECTORIES</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">help</span>: <span class="nc">a</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">similar</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">exists</span>: <span class="err">`</span><span class="n">KNOWN_INSTALLATION_SUBDIRECTORIES</span><span class="err">`</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="242667990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/242667990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#242667990">(Jun 14 2021 at 22:43)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-861041118">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>system-interface 0.6.6 and posish 0.6.3 are now available.</p>
</blockquote>



<a name="244220848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244220848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244220848">(Jun 29 2021 at 00:32)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-870139058">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>@sunfishcode I've updated this now with some spare cycles and I think it might be good for another look, whenever you have the chance! It's still pending a <a href="http://region.rs">region.rs</a> release but I've pinged over there. I resolved the <code>libc</code> dependency for now with a C helper, which isn't ideal but is better than a hardcoded constant.</p>
<p>There's also some version weirdness where cap-std-* is pulling in two versions of <code>rustc_version</code> (see cargo-deny CI job); not sure what's going on there.</p>
</blockquote>



<a name="244237477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244237477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244237477">(Jun 29 2021 at 06:17)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-870271082">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>Updated, thanks! This just depends now on (i) a region-rs release, and (ii) resolution of some multi-crate-version weirdness:</p>
<p>@sunfishcode, it seems that we have:</p>
<ul>
<li>system-interface 0.6.6 -&gt; cap-fs-ext 0.13.7 -&gt; unsafe_io 0.6.12 -&gt; rustc_version 0.3.3</li>
<li>system-interface 0.6.6 -&gt; cap-fs-ext 0.13.7 -&gt; unsafe_io 0.6.12 -&gt; io_lifetimes 0.1.1 -&gt; rustc_version 0.4.0</li>
<li>system-interface 0.6.6 -&gt; cap-fs-ext 0.13.10 -&gt; rustc_version 0.3.3</li>
<li>system-interface 0.6.6 -&gt; rustc_version 0.4.0</li>
</ul>
<p>in general it seems the various cap-std-related crates have inconsistent dependencies on <code>rustc_version</code>, which is making cargo-deny unhappy -- thoughts? Would it be possible to harmonize everything to 0.4.0?</p>
</blockquote>



<a name="244240624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244240624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244240624">(Jun 29 2021 at 07:04)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-870323439">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>@alexcrichton PTAL again (with low priority for this unofficial side-project!) re: fibers -- there's some additional flags-setting needed that I hadn't realized before too, as OpenBSD has a special mitigation that requires blessing stack memory in a certain way.</p>
</blockquote>



<a name="244250728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244250728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244250728">(Jun 29 2021 at 08:55)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-870410675">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>With latest updates, all tests pass in <code>wasmtime</code> crate. I had to disable the pooling allocator as well, for <code>MAP_STACK</code>-related reasons. Checking all tests would require me to set up a wasm32-wasi toolchain, which means building rustc from source (whee!), so that's the last of my side-project steam for now.</p>
<p>On a slightly less-unofficial note, at some point it would be neat to articulate a tier strategy for platform support; I imagine something like Rust's tier 1/2/3 (tested, compiled, and best-effort respectively?), where OpenBSD is definitely tier 3, but there might be some systems we could include at tier 2 (other BSDs? Linux/musl? macOS/aarch64?) if cross-compilation works.</p>
</blockquote>



<a name="244250796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244250796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244250796">(Jun 29 2021 at 08:56)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-870410675">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>With latest updates, all tests pass in <code>wasmtime</code> crate. I had to disable the pooling allocator as well, for <code>MAP_STACK</code>-related reasons. Checking all tests (our full CI gamut) would require me to set up a wasm32-wasi toolchain, which means building rustc from source (whee!), so that's the last of my side-project steam for now.</p>
<p>On a slightly less-unofficial note, at some point it would be neat to articulate a tier strategy for platform support; I imagine something like Rust's tier 1/2/3 (tested, compiled, and best-effort respectively?), where OpenBSD is definitely tier 3, but there might be some systems we could include at tier 2 (other BSDs? Linux/musl? macOS/aarch64?) if cross-compilation works.</p>
</blockquote>



<a name="244510450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/244510450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#244510450">(Jul 01 2021 at 01:56)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-871849151">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>@cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/3049">https://github.com/bytecodealliance/wasmtime/pull/3049</a> updates almost everything to rustc_version 0.4.0, except wasmtime still depends on criterion which depends on cast which depends on rustc_version 0.3.3. I've now submitted <a href="https://github.com/japaric/cast.rs/pull/34">https://github.com/japaric/cast.rs/pull/34</a> to update cast.</p>
</blockquote>



<a name="251149238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232980%20Port%20to%20OpenBSD%21/near/251149238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232980.20Port.20to.20OpenBSD.21.html#251149238">(Aug 29 2021 at 18:25)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2980#issuecomment-907843722">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2980">issue #2980</a>:</p>
<blockquote>
<p>I just rebased onto latest <code>main</code> and updated to region-rs 3.0.0, which includes a fix for OpenBSD.</p>
<p>Unfortunately it looks like new build failures have cropped up in the meantime, this time in <code>rsix</code> (<a href="https://github.com/bytecodealliance/rsix/issues/32">bytecodealliance/rsix#32</a>). I also had to upgrade my test VM to OpenBSD-current to get Rust 1.54.0 because -stable (currently 6.9) has Rust 1.51.0, which fails to build some other things. (Rustup doesn't support OpenBSD unfortunately so one must use the system package or build from source.)</p>
<p>Given the moving target, the fact that we probably won't have a reasonable way to test this on CI, and the fact that we (or at least I) don't really have the time to support another platform beyond "one weekend morning once every few months" (this PR so far), I think I'll go ahead and close this PR. We should definitely reconsider this if/when OpenBSD graduates from tier3 and Rustup adds binaries, and if/when we have a way of adding native GitHub CI runners, at which point someone could run OpenBSD CI.</p>
<p>Until then I'll keep the <code>wasmtime</code> binary on my little router as a keepsake from that one golden moment when this PR compiled cleanly. Thanks for the patience, all!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>