<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2453 Add differential fuzzing against wasm... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html">wasmtime / PR #2453 Add differential fuzzing against wasm...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="217951415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217951415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217951415">(Nov 25 2020 at 23:35)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> and <a href="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a>.</p>



<a name="217951418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217951418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217951418">(Nov 25 2020 at 23:35)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="217951419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217951419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217951419">(Nov 25 2020 at 23:35)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> and <a href="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a>.</p>



<a name="217951990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217951990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217951990">(Nov 25 2020 at 23:45)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="217952756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217952756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217952756">(Nov 25 2020 at 23:58)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="217953297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217953297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217953297">(Nov 26 2020 at 00:06)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="217953575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217953575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217953575">(Nov 26 2020 at 00:11)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="217954125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954125">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-538916400">PR Review</a>.</p>



<a name="217954126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954126">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-538916400">PR Review</a>.</p>



<a name="217954127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954127">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r530704000">PR Review Comment</a>:</p>
<blockquote>
<p>This can be tightened up a bit with <code>let payload = payload.ok()?</code> and in a few other places too</p>
</blockquote>



<a name="217954128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954128">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r530704676">PR Review Comment</a>:</p>
<blockquote>
<p>Does wasmi not support larger memories? Or is this to just limit how much memory we're comparing?</p>
</blockquote>



<a name="217954129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954129">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r530704454">PR Review Comment</a>:</p>
<blockquote>
<p>This function may actually be best done elsewhere perhaps? It might make more sense to create a <code>wasmtime::Config</code> and use wasmtime to compile the module first, and that can do a lot of the gating here. We can disable wasm features that wasmi hasn't implemented to prevent them getting past validation.</p>
<p>Additionally once we've got <code>wasmtime::Module</code> we can inspect the exports for what to locate.</p>
</blockquote>



<a name="217954130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/217954130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#217954130">(Nov 26 2020 at 00:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r530705289">PR Review Comment</a>:</p>
<blockquote>
<p>Another alternative is to configure <code>wasm_smith::Config</code> to generate only appropriate modules for running in wasmi. We could presumably add configuration options for things like "disable this proposal", "memories can be at most this big", or "there must be a <code>main</code> function which takes no arguments"</p>
</blockquote>



<a name="218322169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322169">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-541150602">PR Review</a>.</p>



<a name="218322170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322170">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r532790520">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    if wasmi_mem.current_size().0 != wasmtime_mem.size() {
</code></pre></div>
<p>We have a method to get the size in pages, so no need for the manual conversion here.</p>
</blockquote>



<a name="218322171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322171">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r532788492">PR Review Comment</a>:</p>
<blockquote>
<p>Out of curiosity, why can't we handle start functions?</p>
</blockquote>



<a name="218322172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322172">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-541150602">PR Review</a>.</p>



<a name="218322174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322174">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r532785490">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, I think <code>wasm_smith::Config</code> is the way to go here.</p>
</blockquote>



<a name="218322175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218322175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218322175">(Nov 30 2020 at 18:00)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r532786588">PR Review Comment</a>:</p>
<blockquote>
<p>I assume this is to limit the size of memory, since we are comparing wasmtime and wasmi memories.</p>
<p>Again, rather than filtering generated wasm modules, we can get better throughput by only generating Wasm modules that have the shape we're looking for (via <code>wasm_smith::Config</code>).</p>
<p>Aside: it would be good to do this memory comparison with our other differential fuzz targets as well. I had assumed it would be too slow, but now that we have <code>wasm-smith</code> and can control memory sizes, that assumption doesn't necessarily hold anymore.</p>
</blockquote>



<a name="218500022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218500022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218500022">(Dec 02 2020 at 00:10)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="218500886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218500886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218500886">(Dec 02 2020 at 00:23)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="218500958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218500958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218500958">(Dec 02 2020 at 00:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542405504">PR Review</a>.</p>



<a name="218500959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218500959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218500959">(Dec 02 2020 at 00:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r533811737">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="218501134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501134">(Dec 02 2020 at 00:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542406674">PR Review</a>.</p>



<a name="218501135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501135">(Dec 02 2020 at 00:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r533812745">PR Review Comment</a>:</p>
<blockquote>
<p>This is mostly just for simplicity -- instantiate module first on both sides, then execute and compare. Also <code>start()</code> can't return a value, and it seemed better to (i) only execute one function, to economize on fuzzing input bytes (more efficient search) and (ii) allow a return-value comparison. Since we have <code>allow_start_export()</code> in the <code>Config</code> now I think this is probably fine, as we aren't rejecting any modules because of it?</p>
</blockquote>



<a name="218501153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501153">(Dec 02 2020 at 00:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542406901">PR Review</a>.</p>



<a name="218501154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501154">(Dec 02 2020 at 00:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r533812918">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="218501235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501235">(Dec 02 2020 at 00:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542407295">PR Review</a>.</p>



<a name="218501237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501237">(Dec 02 2020 at 00:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r533813259">PR Review Comment</a>:</p>
<blockquote>
<p>Indeed, this is both to limit the comparison time and to reduce memory usage; I was getting OOMs otherwise during fuzzing.</p>
</blockquote>



<a name="218501262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501262">(Dec 02 2020 at 00:29)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542407439">PR Review</a>.</p>



<a name="218501263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218501263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218501263">(Dec 02 2020 at 00:29)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r533813376">PR Review Comment</a>:</p>
<blockquote>
<p>Oh, neat, I didn't know that <code>Option</code> was question-mark-operator-friendly too; thanks!</p>
</blockquote>



<a name="218502661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218502661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218502661">(Dec 02 2020 at 00:48)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="218568169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568169">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542918675">PR Review</a>.</p>



<a name="218568170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568170">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-542918675">PR Review</a>.</p>



<a name="218568172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568172">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534231549">PR Review Comment</a>:</p>
<blockquote>
<p>It's ok to omit <code>default</code> here since it doesn't do anything.</p>
</blockquote>



<a name="218568173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568173">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534232202">PR Review Comment</a>:</p>
<blockquote>
<p>In this crate you might be able to do this with <code>#[derive(Arbitrary)]</code> I think too</p>
</blockquote>



<a name="218568174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568174">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534234188">PR Review Comment</a>:</p>
<blockquote>
<p>For <code>.ok()?</code> here, is that ignoring traps? Or are there other failure conditions? Ideally we'd also test that if wasmi trapped that wasmtime also traps (and the memories still look the same)</p>
</blockquote>



<a name="218568175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568175">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534235043">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW this can also be <code>let mut wasmi_buf = vec![0; wasmtime_mem.data_size()];</code></p>
</blockquote>



<a name="218568176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218568176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218568176">(Dec 02 2020 at 15:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534235564">PR Review Comment</a>:</p>
<blockquote>
<p>It should be ok to remove <code>default</code> here too</p>
</blockquote>



<a name="218631827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631827">(Dec 02 2020 at 22:52)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a> from <code>differential-fuzz-interp</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a new fuzz target, <code>differential_wasmi</code>, that runs a<br>
Cranelift-based Wasm backend alongside a simple third-party Wasm<br>
interpeter crate (<code>wasmi</code>).  The fuzzing runs the first function in a<br>
given module to completion on each side, and then diffs the return value<br>
and linear memory contents.</p>
<p>This strategy should provide end-to-end coverage including both the Wasm<br>
translation to CLIF (which has seen some subtle and scary bugs at<br>
times), the lowering from CLIF to VCode, the register allocation, and<br>
the final code emission.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="218631886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631886">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-543304947">PR Review</a>.</p>



<a name="218631887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631887">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534536749">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, originally I had figured it would be the most useful to just compare successful runs on both sides, but I agree that allowing traps allows for more interesting coverage -- fixed (here and in value-matching below), thanks!</p>
</blockquote>



<a name="218631902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631902">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-543305036">PR Review</a>.</p>



<a name="218631903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631903">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534536829">PR Review Comment</a>:</p>
<blockquote>
<p>Nice, thanks.</p>
</blockquote>



<a name="218631911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631911">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-543305122">PR Review</a>.</p>



<a name="218631912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631912">(Dec 02 2020 at 22:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534536892">PR Review Comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="218631965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631965">(Dec 02 2020 at 22:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-543305184">PR Review</a>.</p>



<a name="218631967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631967">(Dec 02 2020 at 22:54)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534536959">PR Review Comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="218631978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631978">(Dec 02 2020 at 22:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#pullrequestreview-543305243">PR Review</a>.</p>



<a name="218631979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218631979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218631979">(Dec 02 2020 at 22:54)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2453#discussion_r534537017">PR Review Comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="218636198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232453%20Add%20differential%20fuzzing%20against%20wasm.../near/218636198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232453.20Add.20differential.20fuzzing.20against.20wasm.2E.2E.2E.html#218636198">(Dec 02 2020 at 23:41)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2453">PR #2453</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>