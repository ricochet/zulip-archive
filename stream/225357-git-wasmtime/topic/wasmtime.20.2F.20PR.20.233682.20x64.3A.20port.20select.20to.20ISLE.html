<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3682 x64: port select to ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html">wasmtime / PR #3682 x64: port select to ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="267652273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267652273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267652273">(Jan 11 2022 at 22:03)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>:</p>
<blockquote>
<p>This change ports CLIF's <code>select</code> instruction to ISLE for x64.</p>
</blockquote>



<a name="267653329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267653329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267653329">(Jan 11 2022 at 22:11)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a>.</p>



<a name="267653345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267653345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267653345">(Jan 11 2022 at 22:11)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a>.</p>



<a name="267653793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267653793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267653793">(Jan 11 2022 at 22:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="267663000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663000">(Jan 11 2022 at 23:39)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="267663202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663202">(Jan 11 2022 at 23:41)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-849839592">PR review</a>.</p>



<a name="267663204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663204">(Jan 11 2022 at 23:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r782606007">PR review comment</a>:</p>
<blockquote>
<p>@cfallin, I believe this test is incorrect--both previously and with the current lowering. By first moving <code>%xmm0</code> to <code>%xmm1</code> with <code>movaps</code>, the flag-checking jumps really have no effect (they just move almost the same data again). Thoughts?</p>
</blockquote>



<a name="267663284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663284">(Jan 11 2022 at 23:42)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-849840128">PR review</a>.</p>



<a name="267663285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663285">(Jan 11 2022 at 23:42)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r782606398">PR review comment</a>:</p>
<blockquote>
<p>Zooming out: not only was the <code>FloatCC::Equal</code> lowering incorrect for FP, but there are no tests (that I can see) that exercise the other variants.</p>
</blockquote>



<a name="267663324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267663324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267663324">(Jan 11 2022 at 23:43)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r782606398">PR review comment</a>.</p>



<a name="267769113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267769113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267769113">(Jan 12 2022 at 18:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783351801">PR review comment</a>:</p>
<blockquote>
<p>This overwrites <code>dst</code> from above, I think -- it seems we want the first cmove to write a tmp, and <code>alternative</code> in the second to be that tmp? So then we have the equivalent of <code>cmove(cc1, a, cmove(cc2, b, alternative))</code>.</p>
</blockquote>



<a name="267769114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267769114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267769114">(Jan 12 2022 at 18:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-850875985">PR review</a>.</p>



<a name="267770012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770012">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-850859644">PR review</a>.</p>



<a name="267770014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770014">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-850859644">PR review</a>.</p>



<a name="267770015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770015">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783339997">PR review comment</a>:</p>
<blockquote>
<p>Could this have a comment describing what it is?</p>
</blockquote>



<a name="267770016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770016">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783352700">PR review comment</a>:</p>
<blockquote>
<p>The <code>is_reg</code> prefix makes me think that these will extract from <code>Reg</code>s but they actually will extract from <code>Type</code>s. Can we rename these to <code>is_{xmm,gpr}_type</code> instead perhaps?</p>
</blockquote>



<a name="267770017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770017">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783341159">PR review comment</a>:</p>
<blockquote>
<p>So this is</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">cc1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">cc2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">consequent</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>right?</p>
<p>Could we maybe add that pseudocode to the comments for these variants? I think that will be very helpful for future readers.</p>
</blockquote>



<a name="267770018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770018">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783355258">PR review comment</a>:</p>
<blockquote>
<p>Sounds like we need some runtests for these <code>select</code>s, rather than just compile tests.</p>
</blockquote>



<a name="267770019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770019">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783342779">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>;;;; Rules for `select` ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; CLIF `select` instructions receive a testable argument (i.e. boolean or
</code></pre></div><br>
</p>
</blockquote>



<a name="267770021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/267770021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#267770021">(Jan 12 2022 at 18:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r783354492">PR review comment</a>:</p>
<blockquote>
<p>Alternatively, we could have them operate on <code>Reg</code>s and keep the current names. Then we would just have to adjust the call sites appropriately, which I think would be possible for all call sites since they also have <code>Reg</code>s available.</p>
</blockquote>



<a name="268095297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/268095297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#268095297">(Jan 15 2022 at 01:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="269657053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/269657053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#269657053">(Jan 27 2022 at 23:29)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="269658638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/269658638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#269658638">(Jan 27 2022 at 23:43)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="269828278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/269828278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#269828278">(Jan 29 2022 at 01:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="269828364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/269828364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#269828364">(Jan 29 2022 at 01:38)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> as ready for review.</p>



<a name="269828873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/269828873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#269828873">(Jan 29 2022 at 01:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="270088534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088534">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-868269499">PR review</a>.</p>



<a name="270088536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088536">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-868269499">PR review</a>.</p>



<a name="270088537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088537">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795958459">PR review comment</a>:</p>
<blockquote>
<p>I think these hard-coded sizes are fine, since we know an <code>i128</code> is represented with two <code>i64</code> GPRs.</p>
</blockquote>



<a name="270088538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088538">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795963561">PR review comment</a>:</p>
<blockquote>
<p>Doing the <code>emit</code> here is actually unsafe because nothing is guaranteeing that</p>
<ul>
<li>we just emitted the flags producer before this</li>
<li>nothing else is emitted after the flags producer and before this flags consumer that clobbers the flags</li>
</ul>
<p>What we want to do is return two <code>ConsumesFlags</code> here that we can then pass into <code>with_flags_2</code> along with a <code>FlagsProducer</code>.</p>
<p>ISLE doesn't have tuple/fixed-size-arrays support, so we will have to define an extern type for this.</p>
<p>But! The other rule for <code>cmove_from_values</code> for when it is a single-register value emits only one <code>ConsumesFlags</code>, so I think we actually want an extern type that is either one or two <code>ConsumesFlags</code>. I think we can just use a <code>SmallVec&lt;[ConsumesFlags; 2]&gt;</code>.</p>
</blockquote>



<a name="270088539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088539">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795959887">PR review comment</a>:</p>
<blockquote>
<p>I think that <code>cmove_from_values</code> should take these <code>ValueRegs</code> instead of <code>Value</code>s. This lets us reuse it in places where we've already put the values into registers.</p>
<p><div class="codehilite" data-code-language="Common Lisp"><pre><span></span><code><span class="p">(</span><span class="nv">decl</span> <span class="nv">cmove_from_values</span> <span class="p">(</span><span class="nv">Type</span> <span class="nv">CC</span> <span class="nv">ValueRegs</span> <span class="nv">ValueRegs</span><span class="p">)</span> <span class="nv">ConsumesFlags</span><span class="p">)</span>
<span class="p">(</span><span class="nv">rule</span> <span class="p">(</span><span class="nv">cmove_from_vlaue</span> <span class="nv">$I128</span> <span class="nv">cc</span> <span class="nv">consequent</span> <span class="nv">alternative</span><span class="p">)</span>
      <span class="o">...</span><span class="p">)</span>
<span class="o">````</span>
<span class="nv">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="270088540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088540">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795984245">PR review comment</a>:</p>
<blockquote>
<p>These rules look great, thanks!</p>
</blockquote>



<a name="270088541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088541">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795985037">PR review comment</a>:</p>
<blockquote>
<p>Note that we will want a <code>with_flags_*</code> variant that takes the <code>SmallVec&lt;[ConsumesFlags; 2]&gt;</code> as well, and it will probably have to be implemented in external Rust code so it can loop over each <code>ConsumesFlags</code> in the small vec.</p>
</blockquote>



<a name="270088545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088545">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795964312">PR review comment</a>:</p>
<blockquote>
<p>We need to have an extractor that ensure that this is a single-register type, as discussed before:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>(rule (cmove_from_values (is_single_register_type ty) cc consequent alternative)
</code></pre></div><br>
</p>
</blockquote>



<a name="270088546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270088546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270088546">(Jan 31 2022 at 19:16)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r795965978">PR review comment</a>:</p>
<blockquote>
<p>Nitpick: we should clarify how we are combining the multiple flags here:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>;; Helper for creating `cmove` instructions with the logical OR of multiple
;; flags. Note that these instructions will always result in more than one
;; emitted x86 instruction.
</code></pre></div><br>
</p>
</blockquote>



<a name="270286651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270286651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270286651">(Feb 01 2022 at 21:08)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-869830373">PR review</a>.</p>



<a name="270286652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270286652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270286652">(Feb 01 2022 at 21:08)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r797022801">PR review comment</a>:</p>
<blockquote>
<p>The downside to that is that it bloats the rules in <code>lower.isle</code>; can we do this refactoring in a future PR or issue, e.g., the next time cmove is used?</p>
</blockquote>



<a name="270287114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270287114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270287114">(Feb 01 2022 at 21:11)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="270287599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270287599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270287599">(Feb 01 2022 at 21:14)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-869835107">PR review</a>.</p>



<a name="270287600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270287600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270287600">(Feb 01 2022 at 21:14)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r797027331">PR review comment</a>:</p>
<blockquote>
<p>This sounds like a lot of new infrastructure to build and this PR may already have enough of that. The current lowering rules perform the same unsafe emission as this PR. Can't this be done afterwards?</p>
</blockquote>



<a name="270288183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270288183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270288183">(Feb 01 2022 at 21:17)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="270288327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270288327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270288327">(Feb 01 2022 at 21:18)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-869838871">PR review</a>.</p>



<a name="270288328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270288328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270288328">(Feb 01 2022 at 21:18)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r797030999">PR review comment</a>:</p>
<blockquote>
<p>Ok, I added an extractor that just checks that the type is not <code>I128</code> in fb334e1--can you take a look at that?</p>
</blockquote>



<a name="270288549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270288549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270288549">(Feb 01 2022 at 21:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="270299174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270299174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270299174">(Feb 01 2022 at 22:31)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-869901835">PR review</a>.</p>



<a name="270299175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270299175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270299175">(Feb 01 2022 at 22:31)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r797097661">PR review comment</a>:</p>
<blockquote>
<p>Sure, that works for me.</p>
</blockquote>



<a name="270301281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270301281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270301281">(Feb 01 2022 at 22:49)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-869914875">PR review</a>.</p>



<a name="270301282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/270301282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#270301282">(Feb 01 2022 at 22:49)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r797113045">PR review comment</a>:</p>
<blockquote>
<p>The current lowering rules for <code>select</code> are written in Rust, so it isn't really comparable. It would be one thing if this <code>emit</code> was near the <code>emit</code> for the flags-producer instruction and the <code>emit</code> for the other flags-consuming instruction, but it isn't. It isn't even clear to me, reading this code, that the instructions will always be emitted in the correct order!</p>
<p>It seems to me that the order of evaluation will be something like</p>
<ul>
<li>construct <code>FlagsProducer</code> (do not emit it)</li>
<li>call this constructor<ul>
<li>emit first cmove</li>
<li>construct FlagsConsumer with the second cmove</li>
</ul>
</li>
<li>call a <code>with_flags</code> variant with the constructed <code>FlagsProducer</code> and <code>FlagsConsumer</code><ul>
<li>emit the producer</li>
<li>emit the consumer</li>
</ul>
</li>
</ul>
<p>If that is actually how things end up evaluating, then we would get <code>cmove; test/cmp; cmove</code> instead of <code>test/cmp; cmove; cmove</code>.</p>
<p>It looks like we aren't testing <code>select</code> with <code>i128</code>s yet (since you have only ported floating point <code>select</code>s so far). But this is exactly the kind bug I want to avoid with a dedicated <code>with_flags_*</code> variant that takes <code>SmallVec&lt;[ConsumesFlags; 2]&gt;</code>, as described above.</p>
<p>I really think we should fix this issue before landing this PR, or change this PR to not define and use <code>cmove_from_values</code> and instead use plain <code>cmove</code> (which will work for all the single-register values for <code>select</code> that are are currently supported in ISLE).</p>
</blockquote>



<a name="272027944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272027944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272027944">(Feb 15 2022 at 19:45)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="272029760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272029760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272029760">(Feb 15 2022 at 19:59)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-883582375">PR review</a>.</p>



<a name="272029761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272029761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272029761">(Feb 15 2022 at 19:59)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r807267156">PR review comment</a>:</p>
<blockquote>
<p>Ok, @cfallin and I (but mostly @cfallin), worked on this a bit. The unpolished results are in <a href="https://github.com/bytecodealliance/wasmtime/pull/3682/commits/667935f6ae12122be0454ba905c4c665c55404e1">667935f</a>--@fitzgen, thoughts?<br>
</p>
</blockquote>



<a name="272036763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272036763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272036763">(Feb 15 2022 at 20:57)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-883641095">PR review</a>.</p>



<a name="272036764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272036764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272036764">(Feb 15 2022 at 20:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r807308749">PR review comment</a>:</p>
<blockquote>
<p>The extensions to <code>with_flags</code>, <code>ProducesFlags</code>, and <code>ConsumesFlags</code> look good!</p>
</blockquote>



<a name="272036848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272036848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272036848">(Feb 15 2022 at 20:58)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-883641655">PR review</a>.</p>



<a name="272036849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272036849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272036849">(Feb 15 2022 at 20:58)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#discussion_r807309156">PR review comment</a>:</p>
<blockquote>
<p>Looks good!</p>
</blockquote>



<a name="272458102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272458102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272458102">(Feb 18 2022 at 21:12)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="272458451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272458451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272458451">(Feb 18 2022 at 21:15)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="272461000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272461000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272461000">(Feb 18 2022 at 21:39)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a>.</p>



<a name="272461002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272461002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272461002">(Feb 18 2022 at 21:39)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a>.</p>



<a name="272846596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272846596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272846596">(Feb 22 2022 at 18:30)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-890203842">PR review</a>.</p>



<a name="272848626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272848626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272848626">(Feb 22 2022 at 18:45)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3682#pullrequestreview-890220192">PR review</a>.</p>



<a name="272894509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272894509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272894509">(Feb 23 2022 at 01:51)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="272903817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272903817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272903817">(Feb 23 2022 at 04:29)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a> from <code>isle-select</code> to <code>main</code>.</p>



<a name="272988024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233682%20x64%3A%20port%20select%20to%20ISLE/near/272988024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233682.20x64.3A.20port.20select.20to.20ISLE.html#272988024">(Feb 23 2022 at 18:03)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3682">PR #3682</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>