<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2742 cranelift: add support for the Mac aa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html">wasmtime / PR #2742 cranelift: add support for the Mac aa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="230993979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/230993979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#230993979">(Mar 19 2021 at 09:14)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2742">PR #2742</a> from <code>mac-aarch64</code> to <code>main</code>:</p>
<blockquote>
<p>This bumps target-lexicon and adds support for the AppleAarch64 calling<br>
convention. Specifically for WebAssembly support, we only have to worry<br>
about the new stack slots convention. Stack slots don't need to be at<br>
least 8-bytes, they can be as small as the data type's size. For<br>
instance, if we need stack slots for (i32, i32), they can be located at<br>
offsets (+0, +4). Note that they still need to be properly aligned on<br>
the data type they're containing, though, so if we need stack slots for<br>
(i32, i64), we can't start the i64 slot at the +4 offset (it must start<br>
at the +8 offset).</p>
<p>Added one test that was failing on the Mac M1, as well as other tests<br>
stressing different yet similar situations.</p>
<p>Fixes #2734.</p>
<p>(Note: more work will likely be needed to accommodate non-wasm uses: sign- or zero- extension of &lt; 32 bits arguments + i128 registers proper register passing. Happy to try PRs and confirm they work or not here.)</p>
</blockquote>



<a name="230999648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/230999648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#230999648">(Mar 19 2021 at 10:07)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2742">PR #2742</a> from <code>mac-aarch64</code> to <code>main</code>.</p>



<a name="231000228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000228">(Mar 19 2021 at 10:13)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616245380">PR Review</a>.</p>



<a name="231000229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000229">(Mar 19 2021 at 10:13)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597553949">PR Review Comment</a>:</p>
<blockquote>
<p>This bumps more than target-lexicon. Could the other updates be split into a new PR.</p>
</blockquote>



<a name="231000562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000562">(Mar 19 2021 at 10:16)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597555926">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, just ran <code>cargo update</code>. I'm happy to do so, or revert the updates unrelated to target-lexicon. But in general patch bumps shouldn't bring in breaking changes (that's unfortunately not the case for this target-lexicon patch bump, which brings a breaking API change), what advantages do you see in doing so?</p>
</blockquote>



<a name="231000563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000563">(Mar 19 2021 at 10:16)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616247932">PR Review</a>.</p>



<a name="231000648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000648">(Mar 19 2021 at 10:17)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597556547">PR Review Comment</a>:</p>
<blockquote>
<p>When depending on new features of a dependency could you also update the dependency requirement in <code>Cargo.toml</code>? That would be useful for users like cg_clif that only update a single crate at a time and keep the rest pinned using <code>Cargo.lock</code>.</p>
</blockquote>



<a name="231000649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000649">(Mar 19 2021 at 10:17)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616248717">PR Review</a>.</p>



<a name="231000889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000889">(Mar 19 2021 at 10:19)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616250795">PR Review</a>.</p>



<a name="231000890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231000890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231000890">(Mar 19 2021 at 10:19)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597558210">PR Review Comment</a>:</p>
<blockquote>
<p>Could the fast and cold call conv use this too? They are unstable anyway and this saves stack usage.</p>
</blockquote>



<a name="231001281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231001281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231001281">(Mar 19 2021 at 10:23)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616253707">PR Review</a>.</p>



<a name="231001282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231001282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231001282">(Mar 19 2021 at 10:23)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597560302">PR Review Comment</a>:</p>
<blockquote>
<p>For <code>0.x.y</code>, <code>y</code> bumps may still add features. Only breaking changes are not allowed.</p>
</blockquote>



<a name="231001566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231001566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231001566">(Mar 19 2021 at 10:25)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2742">PR #2742</a> from <code>mac-aarch64</code> to <code>main</code>.</p>



<a name="231004645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231004645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231004645">(Mar 19 2021 at 10:52)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616276665">PR Review</a>.</p>



<a name="231004646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231004646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231004646">(Mar 19 2021 at 10:52)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597582196">PR Review Comment</a>:</p>
<blockquote>
<p>I've opened <a href="https://github.com/bytecodealliance/target-lexicon/issues/71">https://github.com/bytecodealliance/target-lexicon/issues/71</a> to discuss this, since in fact I think that adding the new enum variant is a breaking API change (this may break users' match statements, since the enum isn't marked non-exhaustive), but it's subtle. In any case, I've reverted the other packages updates.</p>
</blockquote>



<a name="231037183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231037183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231037183">(Mar 19 2021 at 15:04)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616500447">PR Review</a>.</p>



<a name="231037184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231037184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231037184">(Mar 19 2021 at 15:04)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616500447">PR Review</a>.</p>



<a name="231037185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231037185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231037185">(Mar 19 2021 at 15:04)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597752200">PR Review Comment</a>:</p>
<blockquote>
<p>Mind adding an additional test here that uses <code>get_typed_func</code> to ensure that ABI of Rust-calling-wasm works as well?</p>
</blockquote>



<a name="231059327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231059327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231059327">(Mar 19 2021 at 17:23)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616636112">PR Review</a>.</p>



<a name="231059328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231059328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231059328">(Mar 19 2021 at 17:23)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597853591">PR Review Comment</a>:</p>
<blockquote>
<p>sure!</p>
</blockquote>



<a name="231060906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231060906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231060906">(Mar 19 2021 at 17:33)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616642070">PR Review</a>.</p>



<a name="231060907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231060907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231060907">(Mar 19 2021 at 17:33)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597858254">PR Review Comment</a>:</p>
<blockquote>
<p>One thing I noticed here: "If the total number of bytes for stack-based arguments is not a multiple of 8 bytes, insert padding on the stack to maintain the 8-byte alignment requirements." However below we align the final stack-arg area size up to a 16-byte alignment.</p>
<p>(Related to this, my understanding is that the trap-on-not-16-aligned-SP behavior of aarch64 is configurable with a mode bit as well; maybe this means Apple runs with only an 8-aligned stack?)</p>
<p>I think this is OK as it should be fine to reserve extra space at a callsite, but we should document that we diverge and why it's OK (and verify that it is!).</p>
</blockquote>



<a name="231060908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231060908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231060908">(Mar 19 2021 at 17:33)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616642070">PR Review</a>.</p>



<a name="231060909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231060909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231060909">(Mar 19 2021 at 17:33)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597858701">PR Review Comment</a>:</p>
<blockquote>
<p><code>apple_aarch64</code> to be consistent here?</p>
</blockquote>



<a name="231062882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231062882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231062882">(Mar 19 2021 at 17:46)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597868257">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe? It's a bit out of scope for this PR, so I'll try not to accidentally introduce new changes there. Plus, I am not sure if these conventions are used; I seem to recall that there fast implies the default calling convention in some cases, and if we're not being careful that might mean subtly breaking other calling conventions. We should probably audit the "fast"/"cold" calling conventions at some point, and re-design them from the ground up.</p>
</blockquote>



<a name="231062883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231062883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231062883">(Mar 19 2021 at 17:46)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616655396">PR Review</a>.</p>



<a name="231063441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231063441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231063441">(Mar 19 2021 at 17:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616659267">PR Review</a>.</p>



<a name="231063444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231063444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231063444">(Mar 19 2021 at 17:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597871292">PR Review Comment</a>:</p>
<blockquote>
<p>+1 -- I actually think we <em>should</em> do something about the "fast" and "cold" conventions, but we should be a little more explicit in designing them, and probably give them better names. I'm not a huge fan of generic terms like "fast ABI" because the ambiguity is confusing -- both on the user/embedder side ("what guarantees does this have? how fast is fast? when can I use it?") and on the implementer side (do we just choose an array of features that lead to better speed, and add more as we think of them? IMHO an evolving ABI is a recipe for subtle bugs as we mutate invariants over time).</p>
<p>So I'd rather design a "fast internal Cranelift ABI v1", implement it, and then keep that as a first-class, well-defined ABI alongside the others, and retire names like "fast" and "cold", just for clarity's sake. But, that's a deeper discussion for another day, I think!</p>
</blockquote>



<a name="231066004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231066004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231066004">(Mar 19 2021 at 18:07)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2742">PR #2742</a> from <code>mac-aarch64</code> to <code>main</code>.</p>



<a name="231066224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231066224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231066224">(Mar 19 2021 at 18:08)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616674101">PR Review</a>.</p>



<a name="231066225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231066225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231066225">(Mar 19 2021 at 18:08)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597882446">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, and it maintains our invariant that the stack is always allocated in 16-bytes chunked, thus always aligned, which is nice. (Otherwise would require more changes when generating prologues and epilogues.)</p>
</blockquote>



<a name="231067085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231067085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231067085">(Mar 19 2021 at 18:14)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#pullrequestreview-616678392">PR Review</a>.</p>



<a name="231067087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231067087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231067087">(Mar 19 2021 at 18:14)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2742#discussion_r597885760">PR Review Comment</a>:</p>
<blockquote>
<p>I've bumped target-lexicon to 0.12.0, which is the new pre-major release for this new enum variant.</p>
</blockquote>



<a name="231279743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232742%20cranelift%3A%20add%20support%20for%20the%20Mac%20aa.../near/231279743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232742.20cranelift.3A.20add.20support.20for.20the.20Mac.20aa.2E.2E.2E.html#231279743">(Mar 22 2021 at 09:06)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2742">PR #2742</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>