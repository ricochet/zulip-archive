<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1519 Cranelift ARM64 and Spidermonkey i... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html">wasmtime / Issue #1519 Cranelift ARM64 and Spidermonkey i...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194337942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194337942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194337942">(Apr 16 2020 at 17:16)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[ ] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true)</li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
</ul>
</blockquote>



<a name="194337943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194337943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194337943">(Apr 16 2020 at 17:16)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[ ] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true)</li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
</ul>
</blockquote>



<a name="194337944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194337944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194337944">(Apr 16 2020 at 17:16)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[ ] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true)</li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
</ul>
</blockquote>



<a name="194337973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194337973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194337973">(Apr 16 2020 at 17:17)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-614783402" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-614783402">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @bnjbvr</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>bnjbvr: cranelift</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="194445342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194445342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194445342">(Apr 17 2020 at 14:09)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[ ] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true)</li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[ ] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated)</li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
</ul>
</blockquote>



<a name="194470937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194470937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194470937">(Apr 17 2020 at 17:05)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[ ] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated)</li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
</ul>
</blockquote>



<a name="194515884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194515884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194515884">(Apr 18 2020 at 00:21)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[ ] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated)</li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
</ul>
</blockquote>



<a name="194803033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194803033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194803033">(Apr 21 2020 at 13:43)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated)</li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
</ul>
</blockquote>



<a name="194810709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194810709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194810709">(Apr 21 2020 at 14:36)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated)</li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="194810772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194810772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194810772">(Apr 21 2020 at 14:37)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[ ] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf)</li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="194944571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194944571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194944571">(Apr 22 2020 at 15:03)</a>:</h4>
<p>jgouly <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617834720" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617834720">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I'm working on a patch for the DIV by 0 and overflow issue.</p>
</blockquote>



<a name="194945087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194945087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194945087">(Apr 22 2020 at 15:07)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617837119" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617837119">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I'll take care of float-to-int conversions edge cases.</p>
</blockquote>



<a name="194962879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194962879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194962879">(Apr 22 2020 at 17:14)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[ ] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="194962901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194962901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194962901">(Apr 22 2020 at 17:15)</a>:</h4>
<p>bnjbvr edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617837119" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617837119">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I'll take care of float-to-int conversions edge cases. edit: done in <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></p>
</blockquote>



<a name="194964009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/194964009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#194964009">(Apr 22 2020 at 17:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617917399" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-617917399">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I can take the <code>trapif</code> / <code>ifcmp</code> issue -- it's sort of a gnarly corner of isel. Also happy to fix <code>rotate_left</code> and the saturating conversions.</p>
</blockquote>



<a name="195041553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195041553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195041553">(Apr 23 2020 at 10:21)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618318063" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618318063">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I'm now looking at rotations. There are a few tricks we can steal from Spidermonkey's implementation...</p>
</blockquote>



<a name="195046084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195046084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195046084">(Apr 23 2020 at 11:17)</a>:</h4>
<p>bnjbvr edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618318063" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618318063">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>I'm now looking at rotations. There are a few tricks we can steal from Spidermonkey's implementation... done =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1584" title="https://github.com/bytecodealliance/wasmtime/pull/1584">https://github.com/bytecodealliance/wasmtime/pull/1584</a></p>
</blockquote>



<a name="195046097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195046097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195046097">(Apr 23 2020 at 11:17)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount)</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="195046106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195046106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195046106">(Apr 23 2020 at 11:17)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[ ] saturating conversions must return 0 for NaN</li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="195064282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195064282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195064282">(Apr 23 2020 at 13:58)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618402729" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618402729">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Re <code>trapif</code>, investigation shows that a heap with explicit bounds checks will generate <code>ifadd_cout</code> to compute base+offset, then check for overflow with <code>trapif</code> if the carry flag is set. I'm happy to let others figure the right fix for this (this would require implementing <code>ifadd_cout</code> too, or lowering heap accesses with explicit bounds checks to something entirely different). Here's a test case extracted from Spidermonkey test suite.</p>
<p>&lt;details&gt;<br>
function u0:0(i32, i64 vmctx) baldrdash_system_v {<br>
    gv0 = vmctx<br>
    gv1 = load.i64 notrap aligned gv0<br>
    gv2 = load.i32 notrap aligned gv0+8<br>
    heap0 = dynamic gv1, min 0x0001_0000, bound gv2, offset_guard 0xfff8, index_type i32</p>
<div class="codehilite"><pre><span></span>                            block0(v0: i32, v1: i64):
</pre></div>


<p>@0025                               v4 = load.i32 notrap aligned v1+8<br>
@0025                               v5 = iconst.i32 0x7fff_ffe1<br>
@0025                               v6, v7 = iadd_ifcout v0, v5<br>
@0025                               trapif ult v7, heap_oob<br>
@0025                               v8 = icmp ugt v6, v4<br>
@0025                               brz v8, block3<br>
@0025                               jump block2</p>
<div class="codehilite"><pre><span></span>                            block2:
</pre></div>


<p>@0025                               trap heap_oob</p>
<div class="codehilite"><pre><span></span>                            block3:
</pre></div>


<p>@0025                               v9 = uextend.i64 v0<br>
@0025                               v10 = get_pinned_reg.i64 <br>
@0025                               v2 = iadd v10, v9<br>
@0025                               v3 = sload8.i32 v2+0x7fff_ffff<br>
@002d                               jump block1</p>
<div class="codehilite"><pre><span></span>                            block1:
</pre></div>


<p>@002d                               fallthrough_return<br>
}<br>
&lt;/details&gt;</p>
</blockquote>



<a name="195064359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195064359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195064359">(Apr 23 2020 at 13:58)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[ ] (verify?) saturating conversions must return 0 for NaN</li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] (verify?) popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="195064361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195064361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195064361">(Apr 23 2020 at 13:58)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[ ] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true.</li>
<li>[ ] ditto for modulo</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[ ] (verify?) saturating conversions must return 0 for NaN</li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[ ] (verify?) popcnt is still incorrect for i32, see also #1537</li>
</ul>
</blockquote>



<a name="195072916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195072916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195072916">(Apr 23 2020 at 14:54)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[x] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true. =&gt; #1585</li>
<li>[x] ditto for modulo =&gt; #1585</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>~~~[ ] (verify?) saturating conversions must return 0 for NaN~~~</li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>~~~[ ] (verify?) popcnt is still incorrect for i32, see also #1537~~~</li>
</ul>
</blockquote>



<a name="195072979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195072979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195072979">(Apr 23 2020 at 14:55)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[x] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true. =&gt; #1585</li>
<li>[x] ditto for modulo =&gt; #1585</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[x] <del>(verify?) saturating conversions must return 0 for NaN</del></li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[x] <del>(verify?) popcnt is still incorrect for i32, see also #1537</del></li>
</ul>
</blockquote>



<a name="195073061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195073061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195073061">(Apr 23 2020 at 14:55)</a>:</h4>
<p>bnjbvr edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618402729" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-618402729">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Re <code>trapif</code>, investigation shows that a heap with explicit bounds checks will generate <code>ifadd_cout</code> to compute base+offset, then check for overflow with <code>trapif</code> if the carry flag is set. I'm happy to let others figure the right fix for this (this would require implementing <code>ifadd_cout</code> too, or lowering heap accesses with explicit bounds checks to something entirely different). Here's a test case extracted from Spidermonkey test suite.</p>
<p>&lt;details&gt;</p>
<div class="codehilite"><pre><span></span>function u0:0(i32, i64 vmctx) baldrdash_system_v {
    gv0 = vmctx
    gv1 = load.i64 notrap aligned gv0
    gv2 = load.i32 notrap aligned gv0+8
    heap0 = dynamic gv1, min 0x0001_0000, bound gv2, offset_guard 0xfff8, index_type i32

                                block0(v0: i32, v1: i64):
@0025                               v4 = load.i32 notrap aligned v1+8
@0025                               v5 = iconst.i32 0x7fff_ffe1
@0025                               v6, v7 = iadd_ifcout v0, v5
@0025                               trapif ult v7, heap_oob
@0025                               v8 = icmp ugt v6, v4
@0025                               brz v8, block3
@0025                               jump block2

                                block2:
@0025                               trap heap_oob

                                block3:
@0025                               v9 = uextend.i64 v0
@0025                               v10 = get_pinned_reg.i64
@0025                               v2 = iadd v10, v9
@0025                               v3 = sload8.i32 v2+0x7fff_ffff
@002d                               jump block1

                                block1:
@002d                               fallthrough_return
}
</pre></div>


<p>&lt;/details&gt;</p>
</blockquote>



<a name="195095316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195095316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195095316">(Apr 23 2020 at 17:39)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[x] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true. =&gt; #1585</li>
<li>[x] ditto for modulo =&gt; #1585</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[x] <del>(verify?) saturating conversions must return 0 for NaN</del></li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[x] <del>(verify?) popcnt is still incorrect for i32, see also #1537</del></li>
<li>[x] lowering of stack store for call arguments is incorrect for large SP offsets =&gt; #1586</li>
</ul>
</blockquote>



<a name="195556079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195556079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195556079">(Apr 28 2020 at 12:32)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-620576383" title="https://github.com/bytecodealliance/wasmtime/issues/1519#issuecomment-620576383">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Confirmed that as of last Friday, Spidermonkey can run all the main tests, and only have the two remaining issues. I'll open up follow-up issues instead for both remaining items, because reftypes require a bunch of work in regalloc too, and heaps with explicit bounds checks is lower priority on arm64.</p>
<p>RESOLVED FIXED \o/</p>
</blockquote>



<a name="195556081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231519%20Cranelift%20ARM64%20and%20Spidermonkey%20i.../near/195556081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231519.20Cranelift.20ARM64.20and.20Spidermonkey.20i.2E.2E.2E.html#195556081">(Apr 28 2020 at 12:32)</a>:</h4>
<p>bnjbvr closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1519" title="https://github.com/bytecodealliance/wasmtime/issues/1519">Issue #1519</a>:</p>
<blockquote>
<p>Trying to keep track of all the remaining correctness issues in the new arm64 backend, found when running Spidermonkey test cases. I'll update this list as I find and understand more issues.</p>
<p>cc @julian-seward1 @cfallin </p>
<ul>
<li>[ ] <code>anyref</code> / reftypes integration. This is a large item that will require additional support in <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> too.</li>
<li>[x] unpatched code locations should respect the <code>emit_all_ones_funcaddrs</code> setting (by putting all ones in unpatched code locations when this setting is set to true) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1538" title="https://github.com/bytecodealliance/wasmtime/pull/1538">https://github.com/bytecodealliance/wasmtime/pull/1538</a></li>
<li>[x] integer SDiv/UDiv must be legalized to a sequence that checks if the divisor is 0 (or if we're dividing INT_MIN by -1), when the <code>avoid_div_traps</code> setting is set to true. =&gt; #1585</li>
<li>[x] ditto for modulo =&gt; #1585</li>
<li>[x] float-to-int conversion must raise errors in some cases (out of bounds, NaN, inf) =&gt; <a href="https://github.com/bytecodealliance/wasmtime/pull/1578" title="https://github.com/bytecodealliance/wasmtime/pull/1578">https://github.com/bytecodealliance/wasmtime/pull/1578</a></li>
<li>[x] <del>(verify?) saturating conversions must return 0 for NaN</del></li>
<li>[x] rotate_left by an amount larger than the integer's size is allowed (apply modulo on rotation amount) =&gt; #1584</li>
<li>[x] there's something wrong when passing many FP/int registers on the stack (might be on the Spidermonkey side; to be investigated) =&gt; #1564 </li>
<li>[ ] trapif (as legalized from trapnz) may not take its input from an ifcmp, it seems</li>
<li>[x] <del>(verify?) popcnt is still incorrect for i32, see also #1537</del></li>
<li>[x] lowering of stack store for call arguments is incorrect for large SP offsets =&gt; #1586</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>