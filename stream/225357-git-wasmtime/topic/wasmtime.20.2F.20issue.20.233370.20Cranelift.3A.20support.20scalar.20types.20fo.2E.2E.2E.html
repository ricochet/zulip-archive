<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3370 Cranelift: support scalar types fo... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html">wasmtime / issue #3370 Cranelift: support scalar types fo...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="253909528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/253909528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#253909528">(Sep 19 2021 at 02:17)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>Using cranelift 0.76, the following results in this error message: "'Unsupported type for imin instruction: i64', [...]\cranelift-codegen-0.76.0\src\isa\x64\lower.rs:2353:17"</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="nc">windows_fastcall</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcvt_from_sint</span><span class="p">.</span><span class="kt">f64</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Am I using imin incorrectly?</p>
</blockquote>



<a name="253959212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/253959212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#253959212">(Sep 19 2021 at 17:26)</a>:</h4>
<p>DGriffin91 <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-922508399">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>Thanks for the explanation! </p>
<p>Sure! I would be interested in seeing where it would be implemented.</p>
</blockquote>



<a name="253962015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/253962015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#253962015">(Sep 19 2021 at 18:17)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-922515023">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>That particular assert is being triggered when we try to lower the CLIF Opcode into a x86 machine instruction. That is done in the x64 backend <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L2353">lower.rs file, specifically line 2343</a>.</p>
<p>The first step would be figuring out what assembly we want to generate for each instruction. <a href="https://godbolt.org/z/9oxo8KKsx"><code>rustc</code> lowers this</a> as a <code>cmp</code> and <code>cmovg</code>.</p>
<p>Reading the x64 backend a bit, it looks like we have helpers for emitting those instructions. <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L404"><code>emit_cmp</code></a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L1386"><code>emit_cmoves</code></a>. You can probably call those and generate the assembly sequence above.</p>
<p>While doing all these changes an easy way to test them is to build a CLIF test file, and run it using <code>clif-util</code>. Looking at our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/filetests/filetests/runtests">testsuite</a>, it looks like we don't have any test files for <code>imin</code>, so its also a good idea to commit the test file that you generate when you implement this!</p>
<p>A simple testfile for <code>imin.i64</code> could be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">,</span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
</code></pre></div>
<p>Although you'd probably want to add tests for whatever other types / instructions you are implementing. You can then run this test file using <code>cargo run test ./test-file.clif</code>, which compiles the function and runs the tests in the comments.</p>
<p>If you want to view the disassembly of the code you are generating you can run <code> cargo run compile --target x86_64 -D ./test-file.clif</code></p>
<p>Hope this helps, good luck!</p>
</blockquote>



<a name="253962816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/253962816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#253962816">(Sep 19 2021 at 18:31)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-922515023">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>That particular assert is being triggered when we try to lower the CLIF Opcode into a x86 machine instruction. That is done in the x64 backend <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L2353">lower.rs file, specifically line 2343</a>.</p>
<p>The first step would be figuring out what assembly we want to generate for each instruction. <a href="https://godbolt.org/z/9oxo8KKsx"><code>rustc</code> lowers this</a> as a <code>mov</code>, <code>cmp</code> and <code>cmovg</code>. I'm not sure if this is the best instruction sequence, but maybe someone can comment on that later.</p>
<p>Reading the x64 backend a bit, it looks like we have helpers for emitting those instructions. <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L404"><code>emit_cmp</code></a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L1386"><code>emit_cmoves</code></a>. For <code>mov</code>, you can call <code>Inst::gen_move</code> which should generate the right thing. Between those three functions you should be able to generate assembly sequence above.</p>
<p>While doing all these changes an easy way to test them is to build a CLIF test file, and run it using <code>clif-util</code>. Looking at our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/filetests/filetests/runtests">testsuite</a>, it looks like we don't have any test files for <code>imin</code>, so its also a good idea to commit the test file that you generate when you implement this!</p>
<p>A simple testfile for <code>imin.i64</code> could be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">,</span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
</code></pre></div>
<p>Although you'd probably want to add tests for whatever other types / instructions you are implementing. You can then run this test file using <code>cargo run test ./test-file.clif</code>, which compiles the function and runs the tests in the comments.</p>
<p>If you want to view the disassembly of the code you are generating you can run <code> cargo run compile --target x86_64 -D ./test-file.clif</code></p>
<p>Hope this helps, good luck!</p>
</blockquote>



<a name="253962826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/253962826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#253962826">(Sep 19 2021 at 18:31)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-922515023">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>That particular assert is being triggered when we try to lower the CLIF Opcode into a x86 machine instruction. That is done in the x64 backend <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L2353">lower.rs file, specifically line 2343</a>.</p>
<p>The first step would be figuring out what assembly we want to generate for each instruction. <a href="https://godbolt.org/z/9oxo8KKsx"><code>rustc</code> lowers this</a> as a <code>mov</code>, <code>cmp</code> and <code>cmovg</code>. I'm not too familiar with x86 to be sure if this is the best instruction sequence, but maybe someone can comment on that later.</p>
<p>Reading the x64 backend a bit, it looks like we have helpers for emitting those instructions. <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L404"><code>emit_cmp</code></a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/47490b4383bf48cbde8b1c33301a7f7d326ee7cc/cranelift/codegen/src/isa/x64/lower.rs#L1386"><code>emit_cmoves</code></a>. For <code>mov</code>, you can call <code>Inst::gen_move</code> which should generate the right thing. Between those three functions you should be able to generate assembly sequence above.</p>
<p>While doing all these changes an easy way to test them is to build a CLIF test file, and run it using <code>clif-util</code>. Looking at our <a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift/filetests/filetests/runtests">testsuite</a>, it looks like we don't have any test files for <code>imin</code>, so its also a good idea to commit the test file that you generate when you implement this!</p>
<p>A simple testfile for <code>imin.i64</code> could be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">,</span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">imin_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
</code></pre></div>
<p>Although you'd probably want to add tests for whatever other types / instructions you are implementing. You can then run this test file using <code>cargo run test ./test-file.clif</code>, which compiles the function and runs the tests in the comments.</p>
<p>If you want to view the disassembly of the code you are generating you can run <code> cargo run compile --target x86_64 -D ./test-file.clif</code></p>
<p>Hope this helps, good luck!</p>
</blockquote>



<a name="254065021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/254065021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#254065021">(Sep 20 2021 at 15:08)</a>:</h4>
<p>akirilov-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>Using cranelift 0.76, the following results in this error message: "'Unsupported type for imin instruction: i64', [...]\cranelift-codegen-0.76.0\src\isa\x64\lower.rs:2353:17"</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="nc">windows_fastcall</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcvt_from_sint</span><span class="p">.</span><span class="kt">f64</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Am I using imin incorrectly?</p>
</blockquote>



<a name="254065022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/254065022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#254065022">(Sep 20 2021 at 15:08)</a>:</h4>
<p>akirilov-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>Using cranelift 0.76, the following results in this error message: "'Unsupported type for imin instruction: i64', [...]\cranelift-codegen-0.76.0\src\isa\x64\lower.rs:2353:17"</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="nc">windows_fastcall</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcvt_from_sint</span><span class="p">.</span><span class="kt">f64</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Am I using imin incorrectly?</p>
</blockquote>



<a name="254065023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/254065023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#254065023">(Sep 20 2021 at 15:08)</a>:</h4>
<p>akirilov-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>Using cranelift 0.76, the following results in this error message: "'Unsupported type for imin instruction: i64', [...]\cranelift-codegen-0.76.0\src\isa\x64\lower.rs:2353:17"</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="nc">windows_fastcall</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imin</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fcvt_from_sint</span><span class="p">.</span><span class="kt">f64</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Am I using imin incorrectly?</p>
</blockquote>



<a name="254513565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/254513565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#254513565">(Sep 23 2021 at 10:34)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-925692893">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>This issue also looks like a duplicate of #1505.</p>
</blockquote>



<a name="305802110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233370%20Cranelift%3A%20support%20scalar%20types%20fo.../near/305802110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233370.20Cranelift.3A.20support.20scalar.20types.20fo.2E.2E.2E.html#305802110">(Oct 24 2022 at 12:00)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/3370#issuecomment-1288927256">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3370">issue #3370</a>:</p>
<blockquote>
<p>This seems to have been fixed in #3748 for types <code>i64</code> and smaller, we are still crashing on <code>i128</code>.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>