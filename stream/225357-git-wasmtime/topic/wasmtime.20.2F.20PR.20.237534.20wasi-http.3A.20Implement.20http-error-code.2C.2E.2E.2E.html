<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7534 wasi-http: Implement http-error-code,... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html">wasmtime / PR #7534 wasi-http: Implement http-error-code,...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="401875109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401875109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401875109">(Nov 14 2023 at 01:01)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a> from <code>elliottt:trevor/error-code-follow-up</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Implement the body of <code>http-error-code</code>, and add a test that shows its use when writing too much. This functionality was missing from #7434.</p>
<p>Additionally, add some functions in wasi-http for converting from hyper::Error and http::Error to the new <code>ErrorCode</code> variant. These functions log the error received as a warning, and return the translated error to the guest.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="401875110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401875110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401875110">(Nov 14 2023 at 01:01)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="401875112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401875112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401875112">(Nov 14 2023 at 01:01)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="401875186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401875186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401875186">(Nov 14 2023 at 01:02)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="401875188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401875188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401875188">(Nov 14 2023 at 01:02)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="401878020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/401878020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#401878020">(Nov 14 2023 at 01:21)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="402013301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402013301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402013301">(Nov 14 2023 at 15:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7534#pullrequestreview-1730056690">PR review</a>.</p>



<a name="402013302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402013302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402013302">(Nov 14 2023 at 15:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7534#pullrequestreview-1730056690">PR review</a>.</p>



<a name="402013303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402013303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402013303">(Nov 14 2023 at 15:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7534#discussion_r1392806884">PR review comment</a>:</p>
<blockquote>
<p>I realize that this matches what I was talking about yesterday, where if an error is dropped on the floor it's always at least logged, but I will also say that there's quite a lot of logging going on here. In theory almost all error context should be made available to end users, but it seems like almost all errors are being dropped and canonicalized in bland error codes. </p>
<p>There's not really anything that can be done about that in this PR specifically, but it might be something good to keep in mind for future iterations of wasi-http. One possible example might be something like a "last error as debug string" API or something like that. Or alternatively using <code>wasi:io/error.{error}</code> for all http APIs and then having an optional "pull out the http-specific error kind from each error" API sort of like filesystems. Too late to do this for preview2 but perhaps later.</p>
</blockquote>



<a name="402040569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402040569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402040569">(Nov 14 2023 at 18:08)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="402044621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402044621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402044621">(Nov 14 2023 at 18:33)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="402045768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402045768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402045768">(Nov 14 2023 at 18:39)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7534#pullrequestreview-1730472013">PR review</a>.</p>



<a name="402045770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402045770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402045770">(Nov 14 2023 at 18:39)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7534#discussion_r1393074757">PR review comment</a>:</p>
<blockquote>
<p>This was going to be a bit noisy, so I've reworked it so that we only log on a path where there's not clear translation back to a wasi-http error (the fall-through cases). Looking more towards the future, I wonder if it would be better to return a <code>wasi:io/error/error</code> instead of a <code>wasi:http/types/error-code</code>. @pchickey and I started working on this last week, but held off on making this change as it was not as easy as swapping out uses of <code>error-code</code>.</p>
</blockquote>



<a name="402049352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402049352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402049352">(Nov 14 2023 at 18:58)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<a name="402062797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237534%20wasi-http%3A%20Implement%20http-error-code%2C.../near/402062797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237534.20wasi-http.3A.20Implement.20http-error-code.2C.2E.2E.2E.html#402062797">(Nov 14 2023 at 20:22)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7534">PR #7534</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>