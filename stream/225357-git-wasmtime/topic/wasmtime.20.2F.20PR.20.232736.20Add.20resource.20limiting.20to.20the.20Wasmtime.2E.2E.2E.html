<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2736 Add resource limiting to the Wasmtime... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html">wasmtime / PR #2736 Add resource limiting to the Wasmtime...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="230788303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230788303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230788303">(Mar 17 2021 at 23:52)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a <code>ResourceLimiter</code> trait to the Wasmtime API.</p>
<p>When used in conjunction with <code>Store::new_with_limiter</code>, this can be used to<br>
monitor and prevent WebAssembly code from growing linear memories and tables.</p>
<p>This is particularly useful when hosts need to take into account host resource<br>
usage to determine if WebAssembly code can consume more resources.</p>
<p>A simple <code>StaticResourceLimiter</code> is also included with these changes that will<br>
simply limit the size of linear memories or tables for all instances created in<br>
the store based on static values.</p>
</blockquote>



<a name="230788424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230788424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230788424">(Mar 17 2021 at 23:54)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a>.</p>



<a name="230793376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230793376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230793376">(Mar 18 2021 at 00:51)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="230793481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230793481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230793481">(Mar 18 2021 at 00:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="230926609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230926609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230926609">(Mar 18 2021 at 19:47)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="230934580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/230934580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#230934580">(Mar 18 2021 at 20:44)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="231044734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044734">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616537489">PR Review</a>.</p>



<a name="231044736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044736">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597780585">PR Review Comment</a>:</p>
<blockquote>
<p>If this ends up being stored in individual tables/memories then this could probably turn into <code>&amp;'a Arc&lt;dyn ...&gt;</code></p>
</blockquote>



<a name="231044737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044737">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597784015">PR Review Comment</a>:</p>
<blockquote>
<p>To make sure I understand this right, if any <code>maximum</code> is in play then this field is set to the minimum of all those maximums? The sources of <code>maximum</code> are:</p>
<ul>
<li>The actual wasm type itself</li>
<li>The pooling allocator's configured maximum</li>
<li>A custom implementation of <code>RuntimeMemory</code> has a configured maximum</li>
</ul>
<p>If my understanding is right, could this be clarified a bit? Basically <code>None</code> is only returned if literally nothing is limiting the memory growth, but otherwise <code>Some</code> doesn't imply that the wasm type itself had a maximum listed, just that something else somewhere is placing a constraint.</p>
<p>Also, presumably, this function isn't called unless <code>desired</code> is already known to be less than <code>maximum</code>, right? (or is it called even in those cases?)</p>
</blockquote>



<a name="231044738"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044738" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044738">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597780082">PR Review Comment</a>:</p>
<blockquote>
<p>Would it be possible to store the <code>limiter</code> into the <code>Memory</code> itself rather than in the <code>Instance</code>?</p>
</blockquote>



<a name="231044739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044739">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597781510">PR Review Comment</a>:</p>
<blockquote>
<p>Could the  docs here clarify that this is about the runtime limit maximum of the memory, not the maximum size as prescribed by the type in wasm?</p>
</blockquote>



<a name="231044740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044740">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616537489">PR Review</a>.</p>



<a name="231044741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044741">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597784513">PR Review Comment</a>:</p>
<blockquote>
<p>This structure looks ripe for expansion to limiting other resources in the future, so perhaps this could use a builder-api pattern to avoid future API breakage?</p>
</blockquote>



<a name="231044742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044742">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597787499">PR Review Comment</a>:</p>
<blockquote>
<p>I think this needs to be specified? Otherwise are memories created via <code>Memory::new</code> (or tables) limited via the limiter?</p>
</blockquote>



<a name="231044743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044743">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597786430">PR Review Comment</a>:</p>
<blockquote>
<p>It looks like this value doesn't change over time, so I don't think it needs to be backed by a <code>RefCell</code>?</p>
</blockquote>



<a name="231044744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231044744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231044744">(Mar 19 2021 at 15:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597785831">PR Review Comment</a>:</p>
<blockquote>
<p>To avoid double-allocations and double-indirection could <code>ResourceLimiterProxy</code> have a type variable perhaps?</p>
</blockquote>



<a name="231067753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231067753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231067753">(Mar 19 2021 at 18:18)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616681573">PR Review</a>.</p>



<a name="231067754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231067754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231067754">(Mar 19 2021 at 18:18)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597888253">PR Review Comment</a>:</p>
<blockquote>
<p>Your understanding is correct and I can expand upon it in the docs for clarity.</p>
<p>The function is called even when desired exceeds the maximum as some implementers will want to know when the maximum was reached even if it was not directly limited by the limiter.</p>
<p>If that feels a little strange, perhaps a different function with the intention that it is only called when the memory couldn't grow due to it exceeding the maximum (from wasm / pooling allocator / custom runtime memory)?</p>
</blockquote>



<a name="231067800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231067800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231067800">(Mar 19 2021 at 18:18)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616681836">PR Review</a>.</p>



<a name="231067803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231067803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231067803">(Mar 19 2021 at 18:18)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597888508">PR Review Comment</a>:</p>
<blockquote>
<p>Good idea.  I'll implement a builder.</p>
</blockquote>



<a name="231068069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068069">(Mar 19 2021 at 18:20)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616683023">PR Review</a>.</p>



<a name="231068070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068070">(Mar 19 2021 at 18:20)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597889476">PR Review Comment</a>:</p>
<blockquote>
<p>Good point.  I'll fix.</p>
</blockquote>



<a name="231068272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068272">(Mar 19 2021 at 18:21)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616683945">PR Review</a>.</p>



<a name="231068273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068273">(Mar 19 2021 at 18:21)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597890189">PR Review Comment</a>:</p>
<blockquote>
<p>It currently does as it needs to sit on <code>inner</code> which is behind <code>Rc</code> and there's a circular reference between the proxy and the <code>Store</code>, which is why there is ugliness in <code>Store::new_with_limiter</code> to set this thing.</p>
<p>I'm not happy about it at all, so if there's a better way to do this such that the limiter can pass the store along in the callbacks, I'm definitely open to it.</p>
</blockquote>



<a name="231068637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068637">(Mar 19 2021 at 18:24)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597890189">PR Review Comment</a>.</p>



<a name="231068764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068764">(Mar 19 2021 at 18:25)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616686529">PR Review</a>.</p>



<a name="231068765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231068765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231068765">(Mar 19 2021 at 18:25)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597892138">PR Review Comment</a>:</p>
<blockquote>
<p>I will expand these docs.</p>
</blockquote>



<a name="231069054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231069054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231069054">(Mar 19 2021 at 18:27)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616688391">PR Review</a>.</p>



<a name="231069055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231069055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231069055">(Mar 19 2021 at 18:27)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597893512">PR Review Comment</a>:</p>
<blockquote>
<p>Can do.</p>
</blockquote>



<a name="231069152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231069152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231069152">(Mar 19 2021 at 18:28)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-616688904">PR Review</a>.</p>



<a name="231069156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231069156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231069156">(Mar 19 2021 at 18:28)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r597893891">PR Review Comment</a>:</p>
<blockquote>
<p>I'll change this, no reason to clone it for the request until a memory / table needs it.</p>
</blockquote>



<a name="231320849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231320849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231320849">(Mar 22 2021 at 14:40)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-617604137">PR Review</a>.</p>



<a name="231320851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231320851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231320851">(Mar 22 2021 at 14:40)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r598776407">PR Review Comment</a>:</p>
<blockquote>
<p>Ah ok nah I think for now this is fine. It runs a possible risk of making it difficult to optimize <code>memory.grow</code> or <code>table.grow</code> in the future but I don't think that's going to be the bottleneck of anything for a long time.</p>
</blockquote>



<a name="231410487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231410487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231410487">(Mar 23 2021 at 01:37)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a <code>ResourceLimiter</code> trait to the Wasmtime API.</p>
<p>When used in conjunction with <code>Store::new_with_limiter</code>, this can be used to<br>
monitor and prevent WebAssembly code from growing linear memories and tables.</p>
<p>This is particularly useful when hosts need to take into account host resource<br>
usage to determine if WebAssembly code can consume more resources.</p>
<p>A simple <code>Limiter</code> is also included with these changes that will<br>
simply limit the size of linear memories or tables for all instances created in<br>
the store based on static values.</p>
</blockquote>



<a name="231544880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231544880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231544880">(Mar 23 2021 at 21:13)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="231546480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/231546480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#231546480">(Mar 23 2021 at 21:26)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="232935898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/232935898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#232935898">(Apr 02 2021 at 18:36)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="232936149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/232936149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#232936149">(Apr 02 2021 at 18:39)</a>:</h4>
<p><strong>peterhuene</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> as ready for review.</p>



<a name="232961594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/232961594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#232961594">(Apr 02 2021 at 23:00)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> and <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a>.</p>



<a name="233191167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191167">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-627936983">PR Review</a>.</p>



<a name="233191168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191168">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r607159556">PR Review Comment</a>:</p>
<blockquote>
<p><code>Arc</code> is used here but I think <code>Rc</code> may suffice? (I didn't see any location that seemed to require thread-safety here)</p>
</blockquote>



<a name="233191169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191169">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r607160422">PR Review Comment</a>:</p>
<blockquote>
<p>One alternative design perhaps is that the <code>Store</code> isn't passed as an argument here and users manually <code>RefCell</code> and <code>Weak</code> themselves with the <code>Store</code>. Do you think, though, that this will be commonly desired such that we may as well go ahead and expose it?</p>
</blockquote>



<a name="233191170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191170">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-627936983">PR Review</a>.</p>



<a name="233191171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191171">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r607165720">PR Review Comment</a>:</p>
<blockquote>
<p>Hm ok, I had a question above about the <code>Store</code> argument and whether we can possibly remove that, but also here do you think it would make sense to remove the <code>Option</code> to effectively always have a limiting strategy?</p>
</blockquote>



<a name="233191172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233191172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233191172">(Apr 05 2021 at 15:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r607164946">PR Review Comment</a>:</p>
<blockquote>
<p>Could the tests here be expanded with tests where the initial memory/table size exceed the maximum? Additionally API requests like <code>Memory::new</code> and <code>Table::new</code> should fail as well if they exceed the maximum? (ideally also tests where API-created objects will also fail to <code>grow</code> past the maximum)</p>
</blockquote>



<a name="233739486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233739486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233739486">(Apr 08 2021 at 22:18)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-631883886">PR Review</a>.</p>



<a name="233739487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233739487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233739487">(Apr 08 2021 at 22:18)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r610155050">PR Review Comment</a>:</p>
<blockquote>
<p>Okay, getting back to this PR: I guess we don't have to expose the <code>Store</code> and let them capture whatever context they want since it's a custom implementation anyway.</p>
<p>I'll remove the <code>Store</code> parameter and that'll simplify things a bit.</p>
</blockquote>



<a name="233756495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233756495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233756495">(Apr 09 2021 at 01:49)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-631973856">PR Review</a>.</p>



<a name="233756496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233756496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233756496">(Apr 09 2021 at 01:49)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r610273926">PR Review Comment</a>:</p>
<blockquote>
<p>The limiter needs to be an <code>Option</code> in the runtime for both table and memory so that the pooling allocator is able to "take" the memory/table when deallocating the instance (swaps in <code>None</code>).</p>
<p>I don't think having it also <code>Option</code> in <code>Store</code> makes it that much worse and it does have the benefit of not boxing a new trait object every time a <code>Store</code> is created just to return <code>true</code> on memory/table grow operations.</p>
<p>If you're okay with it, I'd like to leave this one as-is.</p>
</blockquote>



<a name="233756505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233756505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233756505">(Apr 09 2021 at 01:49)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r610273926">PR Review Comment</a>.</p>



<a name="233757625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233757625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233757625">(Apr 09 2021 at 02:04)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="233757637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233757637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233757637">(Apr 09 2021 at 02:04)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> and <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a>.</p>



<a name="233758574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/233758574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#233758574">(Apr 09 2021 at 02:16)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="234683756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683756">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-636735649">PR Review</a>.</p>



<a name="234683757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683757">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-636735649">PR Review</a>.</p>



<a name="234683758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683758">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614104834">PR Review Comment</a>:</p>
<blockquote>
<p>To confirm, are there tests for this? It seems a bit fishy that we're  deallocating a half-initialized instance without many modifications below. I'd expect, for example <code>decommit_memory_pages</code> to fail one one way or another if called on an othewise unmapped region?</p>
</blockquote>



<a name="234683759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683759">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614107281">PR Review Comment</a>:</p>
<blockquote>
<p>I suppose one other possible option is to store <code>*mut dyn ResourceLimiter</code> in the <code>*mut VMContext</code> so we can use <code>Box</code> here instead of <code>Rc</code>, but let's only do that if the need actually arises.</p>
</blockquote>



<a name="234683760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683760">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614108212">PR Review Comment</a>:</p>
<blockquote>
<p>Could the documentation here be expanded to indicate that the created <code>Store</code> has no limits on usage of memory and such in wasm modules?</p>
</blockquote>



<a name="234683761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683761">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614109776">PR Review Comment</a>:</p>
<blockquote>
<p>Could this link to the <code>new_with_limits</code> API?</p>
</blockquote>



<a name="234683762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683762">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614107937">PR Review Comment</a>:</p>
<blockquote>
<p>Could the documentation here link to the <code>ResourceLimiter</code> trait which discussed which limits can be configured?</p>
</blockquote>



<a name="234683763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234683763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234683763">(Apr 15 2021 at 14:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r614109466">PR Review Comment</a>:</p>
<blockquote>
<p>Oh also, could this link to <code>StoreLimits</code> and <code>StoreLimitsBuilder</code> for a built-in way to limit resources?</p>
</blockquote>



<a name="234914262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234914262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234914262">(Apr 16 2021 at 20:17)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-638056087">PR Review</a>.</p>



<a name="234914263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234914263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234914263">(Apr 16 2021 at 20:17)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r615100661">PR Review Comment</a>:</p>
<blockquote>
<p>The <code>test_pooling_allocator_initial_limits_exceeded</code> test does cover this, albeit with empty memory/table lists on <code>deallocate</code>, as that test is what caught the problem: with an instance limit of 1, it failed to allocate any more instances because it wasn't being added back to the free list.  I will add another memory to the module definition such that the list of initialized memories isn't empty, just in case.</p>
<p>While the instance isn't completely initialized, it should be safe to call <code>deallocate</code> on it as we iterate back through only initialized <code>Memory</code> and <code>Table</code> to call <code>decommit_memory_pages</code> on pages that were either made accessible (for <code>Memory</code>) or explicitly committed (for <code>Table</code>) prior to inserting into those lists.</p>
</blockquote>



<a name="234933003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234933003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234933003">(Apr 16 2021 at 22:56)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a> from <code>limiter</code> to <code>main</code>.</p>



<a name="234933062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234933062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234933062">(Apr 16 2021 at 22:57)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-638129233">PR Review</a>.</p>



<a name="234933063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/234933063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#234933063">(Apr 16 2021 at 22:57)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#discussion_r615159285">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I'm going to leave this as-is and we can revisit in the the future if needed.</p>
</blockquote>



<a name="235187990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/235187990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#235187990">(Apr 19 2021 at 14:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2736#pullrequestreview-638926289">PR Review</a>.</p>



<a name="235188002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232736%20Add%20resource%20limiting%20to%20the%20Wasmtime.../near/235188002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232736.20Add.20resource.20limiting.20to.20the.20Wasmtime.2E.2E.2E.html#235188002">(Apr 19 2021 at 14:19)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2736">PR #2736</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>