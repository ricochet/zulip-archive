<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6786 riscv64: Missing implementations f... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html">wasmtime / issue #6786 riscv64: Missing implementations f...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="380186553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380186553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380186553">(Jul 31 2023 at 04:22)</a>:</h4>
<p>candymate opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Any cases with v128.loadXXX or v128.storeXXX would work</p>
<p>One example</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="err">v</span><span class="mf">128</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="err">v</span><span class="mf">128</span><span class="p">)</span>
    <span class="nb">local.get</span> <span class="mi">0</span>
    <span class="nb">local.get</span> <span class="mi">1</span>
    <span class="err">v</span><span class="mf">128</span><span class="err">.store</span><span class="mi">16</span><span class="err">_lane</span> <span class="err">align=</span><span class="mf">1 0</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">export</span> <span class="s2">"main"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<p>Compiling any cases containing v128.loadXXX or v128.storeXXX leads to reaching unreachable code.<br>
Such compilations lead to reaching the following codes</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1289</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_type</span><span class="p">(</span><span class="n">t</span>: <span class="nc">Type</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">is_float</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">F32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Flw</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fld</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">R32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lwu</span><span class="p">,</span>
<span class="w">        </span><span class="n">R64</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">I64</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Ld</span><span class="p">,</span>

<span class="w">        </span><span class="n">I8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lb</span><span class="p">,</span>
<span class="w">        </span><span class="n">I16</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lh</span><span class="p">,</span>
<span class="w">        </span><span class="n">I32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lw</span><span class="p">,</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">unreachable!</span><span class="p">(),</span><span class="w"> </span><span class="c1">// reaches here</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1338</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_type</span><span class="p">(</span><span class="n">t</span>: <span class="nc">Type</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">is_float</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">F32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fsw</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fsd</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">bits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sb</span><span class="p">,</span>
<span class="w">        </span><span class="mi">16</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sh</span><span class="p">,</span>
<span class="w">        </span><span class="mi">32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sw</span><span class="p">,</span>
<span class="w">        </span><span class="mi">64</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sd</span><span class="p">,</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">unreachable!</span><span class="p">(),</span><span class="w"> </span><span class="c1">// reaches here</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Steps are the following:</p>
<ol>
<li><code>git submodule update --init</code></li>
<li><code>cargo run --release --target=riscv64gc-unknown-linux-gnu test.wasm</code></li>
</ol>
<h3>Expected Results</h3>
<p>Successful compilation</p>
<h3>Actual Results</h3>
<p>Panics with 'internal error: entered unreachable code'</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: v11.0.1 Release</p>
<p>Operating system: Ubuntu 20.04.6</p>
<p>Architecture: RISC-V64</p>
</blockquote>



<a name="380186554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380186554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380186554">(Jul 31 2023 at 04:22)</a>:</h4>
<p><a href="https://github.com/candymate">candymate</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">Issue #6786</a>.</p>



<a name="380188739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380188739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380188739">(Jul 31 2023 at 04:44)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657567569">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>SIMD support on RISC-V is still a work-in-progress; @afonso360 was contributing code a few opcodes at a time recently. So it's expected that this doesn't yet work, though contributions are welcome if you're interested in tackling this!</p>
</blockquote>



<a name="380244770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380244770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380244770">(Jul 31 2023 at 08:43)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>
<p>Are you running this natively on a RISC-V machine? Or just using QEMU?</p>
<p>If you are running on QEMU you can add the following parameter to make <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> this compile and run.</p>
<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>
<p>That being said, we should probably have a better error message for this stuff.</p>
</blockquote>



<a name="380244912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380244912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380244912">(Jul 31 2023 at 08:44)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>
<p>Are you running this natively on a RISC-V machine? Or just using QEMU?</p>
<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to make this compile and run.</p>
<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>
<p>That being said, we should probably have a better error message for this stuff.</p>
</blockquote>



<a name="380247511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380247511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380247511">(Jul 31 2023 at 08:51)</a>:</h4>
<p><a href="https://github.com/afonso360">afonso360</a> added the cranelift:area:riscv64 label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">Issue #6786</a>.</p>



<a name="380247703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380247703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380247703">(Jul 31 2023 at 08:52)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>
<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>
<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to make this compile and run.</p>
<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>
<p>That being said, we should probably have a better error message for this stuff.</p>
</blockquote>



<a name="380247807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380247807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380247807">(Jul 31 2023 at 08:52)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>
<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>
<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to the QEMU arguments to make this compile and run.</p>
<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>
<p>That being said, we should probably have a better error message for this stuff.</p>
</blockquote>



<a name="380252670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380252670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380252670">(Jul 31 2023 at 09:06)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1657930997">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This code should work, but SIMD support only works on machines with Vector extensions. </p>
<p>Are you running this natively on a RISC-V machine, or just using QEMU?</p>
<p>If you are running on QEMU you can add the following parameter <code>-cpu rv64,v=true,vlen=128,vext_spec=v1.0</code> to the QEMU arguments to make this compile and run.</p>
<p>If you are running on an actual RISC-V machine, please make sure it supports version 1.0 of the Vector Extension and that this is reported in <code>/proc/cpuinfo</code>. I haven't tested with 0.7.1 (popular in a lot of current CPU's) but I doubt it would work since they are somewhat incompatible.</p>
<p>That being said, we should probably have a better error message for this stuff.</p>
</blockquote>



<a name="380543190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380543190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380543190">(Aug 01 2023 at 02:34)</a>:</h4>
<p>candymate <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>
<p>In ~/.cargo/config.toml, I have the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">]</span>
<span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv64-linux-gnu-gcc"</span>
<span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1"</span>
</code></pre></div>
<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href="https://github.com/riscv-collab/riscv-gnu-toolchain">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>
<p>Versions I'm using are the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.1.0</span><span class="w"> </span><span class="p">(</span><span class="n">v7</span><span class="p">.</span><span class="mf">1.0</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="w"> </span><span class="mf">11.4.0</span><span class="o">-</span><span class="mi">1</span><span class="n">ubuntu1</span><span class="o">~</span><span class="mf">22.04</span><span class="p">)</span><span class="w"> </span><span class="mf">11.4.0</span>
</code></pre></div>
<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">-</span><span class="n">cpu</span><span class="w"> </span><span class="n">rv64</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="n">vlen</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">vext_spec</span><span class="o">=</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">WASMTIME_TEST_NO_HOG_MEMORY</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wrapper</span><span class="w"> </span><span class="n">input</span><span class="err">`</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">candymate</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.98.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">inst</span><span class="o">/</span><span class="n">args</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1347</span>:<span class="mi">18</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>It would be helpful if you tell me what I'm missing.</p>
</blockquote>



<a name="380543479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380543479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380543479">(Aug 01 2023 at 02:37)</a>:</h4>
<p>candymate edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>
<p>In ~/.cargo/config.toml, I have the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">]</span>
<span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv64-linux-gnu-gcc"</span>
<span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1"</span>
</code></pre></div>
<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href="https://github.com/riscv-collab/riscv-gnu-toolchain">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>
<p>Versions I'm using are the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">rustc</span><span class="w"> </span><span class="mf">1.71.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="p">(</span><span class="n">ce5919fce</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.1.0</span><span class="w"> </span><span class="p">(</span><span class="n">v7</span><span class="p">.</span><span class="mf">1.0</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="w"> </span><span class="mf">11.4.0</span><span class="o">-</span><span class="mi">1</span><span class="n">ubuntu1</span><span class="o">~</span><span class="mf">22.04</span><span class="p">)</span><span class="w"> </span><span class="mf">11.4.0</span>
</code></pre></div>
<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">-</span><span class="n">cpu</span><span class="w"> </span><span class="n">rv64</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="n">vlen</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">vext_spec</span><span class="o">=</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">WASMTIME_TEST_NO_HOG_MEMORY</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wrapper</span><span class="w"> </span><span class="n">input</span><span class="err">`</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">candymate</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.98.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">inst</span><span class="o">/</span><span class="n">args</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1347</span>:<span class="mi">18</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>It would be helpful if you tell me what I'm missing.</p>
</blockquote>



<a name="380543508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380543508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380543508">(Aug 01 2023 at 02:37)</a>:</h4>
<p>candymate edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1659474296">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>Hi,</p>
<p>I'm currently running QEMU, so I added the parameter you gave me. But, it doesn't change anything.</p>
<p>In ~/.cargo/config.toml, I have the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">]</span>
<span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"riscv64-linux-gnu-gcc"</span>
<span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"qemu-riscv64 -cpu rv64,v=true,vlen=128,vext_spec=v1.0 -L /usr/riscv64-linux-gnu -E LD_LIBRARY_PATH=/usr/riscv64-linux-gnu/lib -E WASMTIME_TEST_NO_HOG_MEMORY=1"</span>
</code></pre></div>
<p>Just in case, I upgraded Ubuntu to 22.04, and built <code>qemu-riscv64</code> from the latest version of riscv-gnu-toolchain. (<a href="https://github.com/riscv-collab/riscv-gnu-toolchain">https://github.com/riscv-collab/riscv-gnu-toolchain</a>)</p>
<p>Versions I'm using are the following:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">cargo</span><span class="w"> </span><span class="mf">1.71.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="p">(</span><span class="mi">13413</span><span class="n">c64f</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">rustc</span><span class="w"> </span><span class="mf">1.71.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="p">(</span><span class="n">ce5919fce</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.1.0</span><span class="w"> </span><span class="p">(</span><span class="n">v7</span><span class="p">.</span><span class="mf">1.0</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="p">(</span><span class="n">Ubuntu</span><span class="w"> </span><span class="mf">11.4.0</span><span class="o">-</span><span class="mi">1</span><span class="n">ubuntu1</span><span class="o">~</span><span class="mf">22.04</span><span class="p">)</span><span class="w"> </span><span class="mf">11.4.0</span>
</code></pre></div>
<p>Still leads to the following error message. (Ran with a simple wrapper to provide Wasm memory)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">-</span><span class="n">cpu</span><span class="w"> </span><span class="n">rv64</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="n">vlen</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">vext_spec</span><span class="o">=</span><span class="n">v1</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">riscv64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="w"> </span><span class="n">WASMTIME_TEST_NO_HOG_MEMORY</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">riscv64gc</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wrapper</span><span class="w"> </span><span class="n">input</span><span class="err">`</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">candymate</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.98.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">inst</span><span class="o">/</span><span class="n">args</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1347</span>:<span class="mi">18</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div>
<p>It would be helpful if you tell me what I'm missing.</p>
</blockquote>



<a name="380654197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380654197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380654197">(Aug 01 2023 at 11:09)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1660098265">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>Oh! Right, QEMU only gained the ability to emulate <code>/proc/cpuinfo</code> in version 8.1, we use that to detect the features of the processor and automatically enable them.</p>
<p>To manually force it on, you can use the wasmtime flag <code>--cranelift-enable has_v</code>, which should forcefully enable them on our side. </p>
</blockquote>



<a name="380885675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380885675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380885675">(Aug 02 2023 at 02:27)</a>:</h4>
<p>candymate <a href="https://github.com/bytecodealliance/wasmtime/issues/6786#issuecomment-1661393893">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<p>Adding the <code>has_v</code> flag solved the problem. Thanks!</p>
</blockquote>



<a name="380885677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236786%20riscv64%3A%20Missing%20implementations%20f.../near/380885677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236786.20riscv64.3A.20Missing.20implementations.20f.2E.2E.2E.html#380885677">(Aug 02 2023 at 02:27)</a>:</h4>
<p>candymate closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6786">issue #6786</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Any cases with v128.loadXXX or v128.storeXXX would work</p>
<p>One example</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
  <span class="p">(</span><span class="k">type</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="err">v</span><span class="mf">128</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">func</span> <span class="cm">(;0;)</span> <span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="err">v</span><span class="mf">128</span><span class="p">)</span>
    <span class="nb">local.get</span> <span class="mi">0</span>
    <span class="nb">local.get</span> <span class="mi">1</span>
    <span class="err">v</span><span class="mf">128</span><span class="err">.store</span><span class="mi">16</span><span class="err">_lane</span> <span class="err">align=</span><span class="mf">1 0</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="k">export</span> <span class="s2">"main"</span> <span class="p">(</span><span class="k">func</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<p>Compiling any cases containing v128.loadXXX or v128.storeXXX leads to reaching unreachable code.<br>
Such compilations lead to reaching the following codes</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1289</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_type</span><span class="p">(</span><span class="n">t</span>: <span class="nc">Type</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">is_float</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">F32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Flw</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fld</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">R32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lwu</span><span class="p">,</span>
<span class="w">        </span><span class="n">R64</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">I64</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Ld</span><span class="p">,</span>

<span class="w">        </span><span class="n">I8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lb</span><span class="p">,</span>
<span class="w">        </span><span class="n">I16</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lh</span><span class="p">,</span>
<span class="w">        </span><span class="n">I32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Lw</span><span class="p">,</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">unreachable!</span><span class="p">(),</span><span class="w"> </span><span class="c1">// reaches here</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// cranelift/codegen/src/isa/riscv64/inst/args.rs:1338</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_type</span><span class="p">(</span><span class="n">t</span>: <span class="nc">Type</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">is_float</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">F32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fsw</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Fsd</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">bits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sb</span><span class="p">,</span>
<span class="w">        </span><span class="mi">16</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sh</span><span class="p">,</span>
<span class="w">        </span><span class="mi">32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sw</span><span class="p">,</span>
<span class="w">        </span><span class="mi">64</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Sd</span><span class="p">,</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">unreachable!</span><span class="p">(),</span><span class="w"> </span><span class="c1">// reaches here</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Steps are the following:</p>
<ol>
<li><code>git submodule update --init</code></li>
<li><code>cargo run --release --target=riscv64gc-unknown-linux-gnu test.wasm</code></li>
</ol>
<h3>Expected Results</h3>
<p>Successful compilation</p>
<h3>Actual Results</h3>
<p>Panics with 'internal error: entered unreachable code'</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: v11.0.1 Release</p>
<p>Operating system: Ubuntu 20.04.6</p>
<p>Architecture: RISC-V64</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>