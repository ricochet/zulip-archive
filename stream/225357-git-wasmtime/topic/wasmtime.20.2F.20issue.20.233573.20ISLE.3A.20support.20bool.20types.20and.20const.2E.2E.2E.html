<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3573 ISLE: support bool types and const... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html">wasmtime / issue #3573 ISLE: support bool types and const...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="263190329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/263190329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#263190329">(Nov 30 2021 at 18:49)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<p>ISLE's prototype compiler was built with the simplifying assumption that all constants are integers. "Symbolic constants" (imported opaque values) like <code>$MYVALUE</code> were added later. It's possible to define <code>bool</code> as a primitive type, but the syntax for bool constants, <code>#t</code> and <code>#f</code>, results in generated code that uses integer values <code>1</code> and <code>0</code> because... everything is (was) an integer. This is clearly suboptimal! In #3572 @alexcrichton used the clever workaround of <code>$false</code>, leveraging the support for arbitrary passthrough of constant names to actually get a <code>false</code> in the code.</p>
<p>We should (i) add a <code>ConstBool</code> alongside <code>ConstInt</code> in the IR (<code>PatternInst</code> and <code>ExprInst</code>), and (ii) codegen these properly as Rust bool types. We might also consider at some point making our "primitive" type hierarchy a bit richer and distinguishing ints and bools, but that's lower-priority.</p>
</blockquote>



<a name="263190330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/263190330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#263190330">(Nov 30 2021 at 18:49)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<p>ISLE's prototype compiler was built with the simplifying assumption that all constants are integers. "Symbolic constants" (imported opaque values) like <code>$MYVALUE</code> were added later. It's possible to define <code>bool</code> as a primitive type, but the syntax for bool constants, <code>#t</code> and <code>#f</code>, results in generated code that uses integer values <code>1</code> and <code>0</code> because... everything is (was) an integer. This is clearly suboptimal! In #3572 @alexcrichton used the clever workaround of <code>$false</code>, leveraging the support for arbitrary passthrough of constant names to actually get a <code>false</code> in the code.</p>
<p>We should (i) add a <code>ConstBool</code> alongside <code>ConstInt</code> in the IR (<code>PatternInst</code> and <code>ExprInst</code>), and (ii) codegen these properly as Rust bool types. We might also consider at some point making our "primitive" type hierarchy a bit richer and distinguishing ints and bools, but that's lower-priority.</p>
</blockquote>



<a name="263190350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/263190350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#263190350">(Nov 30 2021 at 18:49)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/3573#issuecomment-982919477">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="263204999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/263204999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#263204999">(Nov 30 2021 at 20:38)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/3573#issuecomment-983000804">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<p>FWIW, we use <code>$true</code> and <code>$false</code> elsewhere, eg:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/0580c84405cb5808518b187d1851dc17e7538108/cranelift/codegen/src/isa/x64/lower.isle#L24-L30">https://github.com/bytecodealliance/wasmtime/blob/0580c84405cb5808518b187d1851dc17e7538108/cranelift/codegen/src/isa/x64/lower.isle#L24-L30</a></p>
<p>Not convinced that <code>#t</code> and <code>#f</code> is really that much of an improvement.</p>
</blockquote>



<a name="263209433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/263209433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#263209433">(Nov 30 2021 at 21:12)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3573#issuecomment-983024385">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<p>Yep, we'd want to clean up said uses all at the same time.</p>
<p>I'm not as concerned about syntax; we could even just accept tokens <code>true</code> and <code>false</code>; my concern is more that <code>$true</code> and <code>$false</code> are abusing a feature meant for other things (externally-defined constants) and if we have bool values, we should represent them as such in the IR. Getting the type right there would also allow us to use them in the future in other DSL-compiler optimizations.</p>
</blockquote>



<a name="281212118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233573%20ISLE%3A%20support%20bool%20types%20and%20const.../near/281212118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233573.20ISLE.3A.20support.20bool.20types.20and.20const.2E.2E.2E.html#281212118">(May 04 2022 at 20:02)</a>:</h4>
<p>cfallin labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3573">issue #3573</a>:</p>
<blockquote>
<p>ISLE's prototype compiler was built with the simplifying assumption that all constants are integers. "Symbolic constants" (imported opaque values) like <code>$MYVALUE</code> were added later. It's possible to define <code>bool</code> as a primitive type, but the syntax for bool constants, <code>#t</code> and <code>#f</code>, results in generated code that uses integer values <code>1</code> and <code>0</code> because... everything is (was) an integer. This is clearly suboptimal! In #3572 @alexcrichton used the clever workaround of <code>$false</code>, leveraging the support for arbitrary passthrough of constant names to actually get a <code>false</code> in the code.</p>
<p>We should (i) add a <code>ConstBool</code> alongside <code>ConstInt</code> in the IR (<code>PatternInst</code> and <code>ExprInst</code>), and (ii) codegen these properly as Rust bool types. We might also consider at some point making our "primitive" type hierarchy a bit richer and distinguishing ints and bools, but that's lower-priority.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>