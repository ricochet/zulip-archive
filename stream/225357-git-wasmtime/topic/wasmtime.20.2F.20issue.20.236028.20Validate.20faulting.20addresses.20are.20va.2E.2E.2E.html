<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6028 Validate faulting addresses are va... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html">wasmtime / issue #6028 Validate faulting addresses are va...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="342172735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342172735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342172735">(Mar 15 2023 at 21:45)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1470886798">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="342188525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342188525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342188525">(Mar 15 2023 at 23:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1470989244">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="342333538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342333538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342333538">(Mar 16 2023 at 14:42)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1472113639">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<blockquote>
<p>A high-level question as well: a pagefault from within a hostcall won't trigger the warning, right? Or do we enter the handler if an instance in the store is on the stack at all?</p>
</blockquote>
<p>Correct, yeah. We've actually got tests which ensure that a host-triggered segfault isn't caught by Wasmtime and aborts the process (as you'd expect a segfault in a language like Rust to do so). The first thing the signal handlers do is test whether the faulting pc is a wasm pc, and it defers to the default behavior of each signal if it's not a wasm pc. If it's a wasm pc though we fully catch the trap assuming it's expected that the wasm instruction had the kind of fault.</p>
</blockquote>



<a name="342428077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342428077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342428077">(Mar 16 2023 at 21:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1472787301">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<p>@uweigand I was wondering if I could enlist your help to debug a failure here. This has <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/4441496969/jobs/7796650018">failed in CI</a> with this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">----</span><span class="w"> </span><span class="n">traps</span>::<span class="n">wasm_fault_address_reported_by_default</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">traps</span>::<span class="n">wasm_fault_address_reported_by_default</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">bad</span><span class="w"> </span><span class="n">error</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
    <span class="mi">0</span>:   <span class="mh">0x25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">start</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">memory</span><span class="w"> </span><span class="n">fault</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0xdeadb000</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mh">0x10000</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">traps</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1308</span>:<span class="mi">5</span>
</code></pre></div>
<p>where this is the module being executed:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>            (module
                (memory 1)
                (func $start
                    i32.const 0xdeadbeef
                    i32.load
                    drop)
                (start $start)
            )
</code></pre></div>
<p>and the test is asserting:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{err:?}"</span><span class="p">);</span>
<span class="w">    </span><span class="fm">assert!</span><span class="p">(</span>
<span class="w">        </span><span class="n">err</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"memory fault at wasm address 0xdeadbeef in linear memory of size 0x10000"</span><span class="p">),</span>
<span class="w">        </span><span class="s">"bad error: {err}"</span>
<span class="w">    </span><span class="p">);</span>
</code></pre></div>
<p>so it seems like s390x is reporting the faulting address of the load instruction is something page-rounded (or something like that?). I don't know how to hook up gdb to qemu but in theory this means that the address coming out of <code>siginfo_t</code>'s <code>si_addr</code> field in the signal handler doesn't have the <code>0xeef</code> at the end and instead ends in <code>0x000</code> (I think).</p>
<p>Do you know if this is an s390x-specific behavior? Are faulting addresses reported at their page aligned boundary instead of the address itself?</p>
</blockquote>



<a name="342561654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342561654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342561654">(Mar 17 2023 at 13:27)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1473845279">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<blockquote>
<p>Do you know if this is an s390x-specific behavior? Are faulting addresses reported at their page aligned boundary instead of the address itself?</p>
</blockquote>
<p>Yes, this is correct.  Faulting addresses are rounded to their 4k page boundary on s390x.</p>
</blockquote>



<a name="342577079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236028%20Validate%20faulting%20addresses%20are%20va.../near/342577079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236028.20Validate.20faulting.20addresses.20are.20va.2E.2E.2E.html#342577079">(Mar 17 2023 at 14:28)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/6028#issuecomment-1473929314">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6028">issue #6028</a>:</p>
<blockquote>
<p>Ok good to know it's expected! I'll disable this particular test for s390x in that case.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>