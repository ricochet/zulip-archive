<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8846 `wasmtime serve` can&#x27;t run compone... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html">wasmtime / issue #8846 `wasmtime serve` can&#x27;t run compone...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="445855636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445855636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445855636">(Jun 20 2024 at 13:58)</a>:</h4>
<p>dicej opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Since <code>wasmtime serve</code> was switched to using the pooling allocator, which defaults to a memory limit of 10MB, components built with e.g. <code>componentize-py</code> or <code>componentize-dotnet</code> will no longer run by default.  Also, since there is currently no CLI option to override that memory limit, the only workaround is to disable the pooling allocator entirely using <code>wasmtime serve -O pooling-allocator=n</code>.</p>
<p>I propose that we address this with the following changes:</p>
<ul>
<li>Increase the default memory limit in the pooling allocator to something like 100MB</li>
<li>Allow the default to be overridden via a CLI option</li>
<li>Provide a helpful suggestion to use that option when the component can't be run due to the memory limit<br>
</li>
</ul>
</blockquote>



<a name="445855741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445855741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445855741">(Jun 20 2024 at 13:59)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180781165">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>See also <a href="https://github.com/bytecodealliance/wasmtime/issues/8504">https://github.com/bytecodealliance/wasmtime/issues/8504</a> and <a href="https://github.com/bytecodealliance/componentize-py/issues/94">https://github.com/bytecodealliance/componentize-py/issues/94</a></p>
</blockquote>



<a name="445859272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445859272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445859272">(Jun 20 2024 at 14:10)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180810693">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Also, (mainly to help search engines find this issue) this is the kind of error message you get: <code>Error: memory index 0 has a minimum page size of 223 which exceeds the limit of 160</code></p>
</blockquote>



<a name="445876283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445876283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445876283">(Jun 20 2024 at 15:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180944571">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Can you test whether <code>-Opooling-max-memory-size=N</code> enables running these components? Sorry I keep meaning to raise the limit here and keep forgetting, but I also want to confirm orthogonally that this option works since that's what it's supposed to do</p>
</blockquote>



<a name="445877058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445877058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445877058">(Jun 20 2024 at 15:13)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180951560">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">Opooling</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">160</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">cli</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="o">-</span><span class="n">O</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">--</span><span class="n">optimize</span><span class="w"> </span><span class="n">option</span><span class="p">:</span><span class="w"> </span><span class="nc">pooling</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">size</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="445877321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445877321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445877321">(Jun 20 2024 at 15:14)</a>:</h4>
<p>dicej edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180951560">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">version</span>
<span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">21.0.1</span><span class="w"> </span><span class="p">(</span><span class="n">cedf9aa0f</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">22</span><span class="p">)</span>
<span class="w"> </span><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">serve</span><span class="w"> </span><span class="o">-</span><span class="n">Opooling</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">160</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">cli</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="o">-</span><span class="n">O</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">--</span><span class="n">optimize</span><span class="w"> </span><span class="n">option</span><span class="p">:</span><span class="w"> </span><span class="nc">pooling</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">size</span>
</code></pre></div>
<p>Maybe that's new on <code>main</code>?</p>
</blockquote>



<a name="445877343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445877343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445877343">(Jun 20 2024 at 15:14)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180953617">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>I think that might be Wasmtime 21+, what version do you have for that?</p>
</blockquote>



<a name="445877444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445877444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445877444">(Jun 20 2024 at 15:14)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180954310">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Sorry, just edited the comment; it's 21.0.1</p>
</blockquote>



<a name="445877468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445877468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445877468">(Jun 20 2024 at 15:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8846#issuecomment-2180954451">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Oh sorry, for some reason I had Wasmtime 22 installed instead of the 21 version, which explains this!</p>
</blockquote>



<a name="445894706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238846%20%60wasmtime%20serve%60%20can%27t%20run%20compone.../near/445894706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238846.20.60wasmtime.20serve.60.20can.27t.20run.20compone.2E.2E.2E.html#445894706">(Jun 20 2024 at 16:35)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8846">issue #8846</a>:</p>
<blockquote>
<p>Since <code>wasmtime serve</code> was switched to using the pooling allocator, which defaults to a memory limit of 10MB, components built with e.g. <code>componentize-py</code> or <code>componentize-dotnet</code> will no longer run by default.  Also, since there is currently no CLI option to override that memory limit, the only workaround is to disable the pooling allocator entirely using <code>wasmtime serve -O pooling-allocator=n</code>.</p>
<p>I propose that we address this with the following changes:</p>
<ul>
<li>Increase the default memory limit in the pooling allocator to something like 100MB</li>
<li>Allow the default to be overridden via a CLI option</li>
<li>Provide a helpful suggestion to use that option when the component can't be run due to the memory limit<br>
</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>