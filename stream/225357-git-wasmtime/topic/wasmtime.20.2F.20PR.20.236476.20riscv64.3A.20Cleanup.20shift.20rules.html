<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6476 riscv64: Cleanup shift rules · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html">wasmtime / PR #6476 riscv64: Cleanup shift rules</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="361536406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/361536406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#361536406">(May 27 2023 at 10:41)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a> from <code>afonso360:riscv-shifts-cleanup</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This is a small cleanup to the shift rules, we had a few rules that lowered to the same instruction and that could be de-duplicated. Additionally this also does a few improvements in certain cases:</p>
<ul>
<li>We were missing some opportunities to encode the shift amount into the shift instruction</li>
<li>Additionally we now look through <code>uextend</code>'s on the shift amounts to find even more inlining opportunities</li>
</ul>
<p>The first commit adds the tests with the current lowerings, and the follow up commits show how the codegen changes.</p>
</blockquote>



<a name="361536412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/361536412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#361536412">(May 27 2023 at 10:41)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="361536414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/361536414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#361536414">(May 27 2023 at 10:41)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="361538007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/361538007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#361538007">(May 27 2023 at 10:48)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This is a small cleanup to the shift rules, we had a few rules that lowered to the same instruction and that could be de-duplicated. Additionally we now look through <code>uextend</code>'s on the shift amounts to find even more inlining opportunities</p>
<p>The first commit adds the tests with the current lowerings, and the follow up commits show how the codegen changes.</p>
</blockquote>



<a name="361539470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/361539470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#361539470">(May 27 2023 at 10:54)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="362484177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/362484177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#362484177">(May 31 2023 at 15:00)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6476#pullrequestreview-1453460605">PR review</a>:</p>
<blockquote>
<p>Nice! </p>
<p>Definitely appreciate the commit separation, made this quite easy to review <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="362854078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/362854078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#362854078">(Jun 01 2023 at 19:01)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="362855162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/362855162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#362855162">(Jun 01 2023 at 19:05)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="362855388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/362855388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#362855388">(Jun 01 2023 at 19:06)</a>:</h4>
<p>afonso360 has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="362990736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/362990736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#362990736">(Jun 02 2023 at 09:58)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<a name="363008979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236476%20riscv64%3A%20Cleanup%20shift%20rules/near/363008979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236476.20riscv64.3A.20Cleanup.20shift.20rules.html#363008979">(Jun 02 2023 at 11:06)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6476">PR #6476</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>