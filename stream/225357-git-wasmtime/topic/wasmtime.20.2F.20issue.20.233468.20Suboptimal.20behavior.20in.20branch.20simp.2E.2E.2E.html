<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3468 Suboptimal behavior in branch simp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233468.20Suboptimal.20behavior.20in.20branch.20simp.2E.2E.2E.html">wasmtime / issue #3468 Suboptimal behavior in branch simp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="258598050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233468%20Suboptimal%20behavior%20in%20branch%20simp.../near/258598050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233468.20Suboptimal.20behavior.20in.20branch.20simp.2E.2E.2E.html#258598050">(Oct 21 2021 at 18:50)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3468">issue #3468</a>:</p>
<blockquote>
<p>In #3441, a fuzz testcase was found to produce seemingly-quadratic behavior in compiler performance. Part of this was found to be in the register allocator and fixed in that issue; but there is an additional component that appears to be in the branch simplification logic in <code>MachBuffer</code>.</p>
<p>Specifically, the simplification algorithm tracks all labels that alias the current buffer tail, and this list grows to thousands of labels when the thousands of empty Wasm loops in the fuzz testcase are processed and collapse into a "goto next instruction".</p>
<p>It's likely that we can short-circuit the quadratic behavior by having a fallback mode in which we track that we know nothing about the buffer tail, which inhibits any optimizations (branch chomping) from occurring.</p>
</blockquote>



<a name="258613364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233468%20Suboptimal%20behavior%20in%20branch%20simp.../near/258613364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233468.20Suboptimal.20behavior.20in.20branch.20simp.2E.2E.2E.html#258613364">(Oct 21 2021 at 20:37)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3468">issue #3468</a>:</p>
<blockquote>
<p>In #3441, a fuzz testcase was found to produce seemingly-quadratic behavior in compiler performance. Part of this was found to be in the register allocator and fixed in that issue; but there is an additional component that appears to be in the branch simplification logic in <code>MachBuffer</code>.</p>
<p>Specifically, the simplification algorithm tracks all labels that alias the current buffer tail, and this list grows to thousands of labels when the thousands of empty Wasm loops in the fuzz testcase are processed and collapse into a "goto next instruction".</p>
<p>It's likely that we can short-circuit the quadratic behavior by having a fallback mode in which we track that we know nothing about the buffer tail, which inhibits any optimizations (branch chomping) from occurring.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>