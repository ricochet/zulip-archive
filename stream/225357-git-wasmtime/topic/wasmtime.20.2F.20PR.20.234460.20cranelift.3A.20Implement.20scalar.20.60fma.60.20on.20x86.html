<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4460 cranelift: Implement scalar `fma` on x86 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html">wasmtime / PR #4460 cranelift: Implement scalar `fma` on x86</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="289835261"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289835261" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289835261">(Jul 16 2022 at 16:15)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>  Hey,</p>
<p>This PR Implements <code>fma</code> for scalar values.</p>
<p>x86 does not have dedicated instructions for scalar <code>fma</code>, so we lower to a libcall which seems to be what llvm does.</p>
<p>I tried to implement it for SIMD as well but got a bit lost, ill try again later.</p>
</blockquote>



<a name="289835409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289835409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289835409">(Jul 16 2022 at 16:18)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>  Hey,</p>
<p>This PR Implements <code>fma</code> for scalar values.</p>
<p>x86 does not have dedicated instructions for scalar <code>fma</code>, so we lower to a libcall which is matches llvm behaviour.</p>
<p>I tried to implement it for SIMD as well but got a bit lost, ill try again later.</p>
</blockquote>



<a name="289835473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289835473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289835473">(Jul 16 2022 at 16:20)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#pullrequestreview-1041007675">PR review</a>.</p>



<a name="289835474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289835474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289835474">(Jul 16 2022 at 16:20)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#discussion_r922696637">PR review comment</a>:</p>
<blockquote>
<p>I think there is probably a better way to do this, but I'm still not too comfortable with isle.</p>
<p>Can we make this more generic? </p>
</blockquote>



<a name="289839863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289839863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289839863">(Jul 16 2022 at 18:04)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>  Hey,</p>
<p>This PR Implements <code>fma</code> for scalar values.</p>
<p>x86 does not have dedicated instructions for scalar <code>fma</code>, so we lower to a libcall which matches llvm's behaviour.</p>
<p>I tried to implement it for SIMD as well but got a bit lost, ill try again later.</p>
</blockquote>



<a name="289876240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289876240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289876240">(Jul 17 2022 at 10:09)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>.</p>



<a name="289876248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/289876248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#289876248">(Jul 17 2022 at 10:09)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>  Hey,</p>
<p>This PR Implements <code>fma</code> for scalar values.</p>
<p>x86 does not have dedicated instructions for scalar <code>fma</code>, so we lower to a libcall which matches llvm's behaviour.</p>
<p>I tried to implement it for SIMD as well but got a bit lost, ill try again later.</p>
<p>We can't enable <code>fma.clif</code> runtests until we merge #4453.</p>
</blockquote>



<a name="291632112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291632112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291632112">(Aug 01 2022 at 20:52)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>.</p>



<a name="291739577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291739577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291739577">(Aug 02 2022 at 17:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#pullrequestreview-1059116757">PR review</a>.</p>



<a name="291739578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291739578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291739578">(Aug 02 2022 at 17:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#discussion_r935834462">PR review comment</a>:</p>
<blockquote>
<p>This will become a compile error once my remove-Baldrdash PR merges (it's in-queue now), sorry!</p>
</blockquote>



<a name="291739579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291739579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291739579">(Aug 02 2022 at 17:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#pullrequestreview-1059116757">PR review</a>.</p>



<a name="291740905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291740905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291740905">(Aug 02 2022 at 17:24)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#pullrequestreview-1059137734">PR review</a>.</p>



<a name="291740906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291740906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291740906">(Aug 02 2022 at 17:24)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#discussion_r935848502">PR review comment</a>:</p>
<blockquote>
<p>I can remove it now, no problem!</p>
</blockquote>



<a name="291742193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291742193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291742193">(Aug 02 2022 at 17:35)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#discussion_r935848502">PR review comment</a>.</p>



<a name="291763813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291763813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291763813">(Aug 02 2022 at 20:24)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>.</p>



<a name="291808055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291808055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291808055">(Aug 03 2022 at 07:01)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a> from <code>x86-scalar-fma</code> to <code>main</code>.</p>



<a name="291821252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291821252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291821252">(Aug 03 2022 at 09:16)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a>.</p>



<a name="291884112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291884112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291884112">(Aug 03 2022 at 17:29)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4460#pullrequestreview-1060752966">PR review</a>.</p>



<a name="291884132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234460%20cranelift%3A%20Implement%20scalar%20%60fma%60%20on%20x86/near/291884132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234460.20cranelift.3A.20Implement.20scalar.20.60fma.60.20on.20x86.html#291884132">(Aug 03 2022 at 17:29)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4460">PR #4460</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>