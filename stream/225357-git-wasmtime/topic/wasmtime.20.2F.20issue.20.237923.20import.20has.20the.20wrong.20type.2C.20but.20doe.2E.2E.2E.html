<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7923 import has the wrong type, but doe... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html">wasmtime / issue #7923 import has the wrong type, but doe...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="421147479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421147479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421147479">(Feb 12 2024 at 23:13)</a>:</h4>
<p>sporkmonger opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Similar to #7505, I'm running into a problem with a "has the wrong type" error, but unlike that previous issue, I believe I do have the correct adapter version. I'm running <code>wasmtime 17.0.1</code> with the reactor adapter taken from the corresponding release.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">AnyError</span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">incoming</span><span class="o">-</span><span class="n">request</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasm-tools<span class="w"> </span>component<span class="w"> </span>wit<span class="w"> </span>test_plugin.wasm
package<span class="w"> </span>root:component<span class="p">;</span>

world<span class="w"> </span>root<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>import<span class="w"> </span>wasi:io/error@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:io/streams@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:http/types@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>bulwark:plugin/types@0.5.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:cli/environment@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:cli/exit@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:cli/stdin@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:cli/stdout@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:cli/stderr@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:clocks/wall-clock@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:filesystem/types@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:filesystem/preopens@0.2.0<span class="p">;</span>
<span class="w">  </span>import<span class="w"> </span>wasi:random/random@0.2.0<span class="p">;</span>

<span class="w">  </span><span class="nb">export</span><span class="w"> </span>bulwark:plugin/http-handlers@0.5.0<span class="p">;</span>
<span class="o">}</span>
</code></pre></div>
<p>I'm not particularly confident in the correctness of any of these, even though everything compiles OK:<br>
- the world definitions in my wit files<br>
- how things are set up w/ <code>wasmtime</code>'s generate macros<br>
- how things are set up w/ <code>wit-bindgen</code>'s generate macros<br>
- how I'm currently using the <code>wasmtime</code> runtime</p>
<p>However, I did have this previously working with a simpler API definition that didn't really try to do anything with WASI beyond using stdout/stderr.</p>
<p>Full codebase in this branch, along with wit definitions: <a href="https://github.com/bulwark-security/bulwark/tree/api-refactor">https://github.com/bulwark-security/bulwark/tree/api-refactor</a></p>
<p>Unfortunately, I've exhausted everything I can think of to debug this. The error message just doesn't give a whole lot to go on and I'm wondering if there might be something that could be done to significantly improve that error message, because it has seemed to come up a lot.</p>
</blockquote>



<a name="421147498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421147498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421147498">(Feb 12 2024 at 23:13)</a>:</h4>
<p>sporkmonger edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Similar to #7505, I'm running into a problem with a "has the wrong type" error, but unlike that previous issue, I believe I do have the correct adapter version. I'm running <code>wasmtime 17.0.1</code> with the reactor adapter taken from the corresponding release.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">AnyError</span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">incoming</span><span class="o">-</span><span class="n">request</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">test_plugin</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm not particularly confident in the correctness of any of these, even though everything compiles OK:</p>
<ul>
<li>the world definitions in my wit files</li>
<li>how things are set up w/ <code>wasmtime</code>'s generate macros</li>
<li>how things are set up w/ <code>wit-bindgen</code>'s generate macros</li>
<li>how I'm currently using the <code>wasmtime</code> runtime</li>
</ul>
<p>However, I did have this previously working with a simpler API definition that didn't really try to do anything with WASI beyond using stdout/stderr.</p>
<p>Full codebase in this branch, along with wit definitions: <a href="https://github.com/bulwark-security/bulwark/tree/api-refactor">https://github.com/bulwark-security/bulwark/tree/api-refactor</a></p>
<p>Unfortunately, I've exhausted everything I can think of to debug this. The error message just doesn't give a whole lot to go on and I'm wondering if there might be something that could be done to significantly improve that error message, because it has seemed to come up a lot.</p>
</blockquote>



<a name="421152953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421152953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421152953">(Feb 13 2024 at 00:03)</a>:</h4>
<p>sporkmonger edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Similar to #7505, I'm running into a problem with a "has the wrong type" error, but unlike that previous issue, I believe I do have the correct adapter version. I'm running <code>wasmtime 17.0.1</code> with the reactor adapter taken from the corresponding release.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">AnyError</span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">incoming</span><span class="o">-</span><span class="n">request</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">test_plugin</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm not particularly confident in the correctness of any of these, even though everything compiles OK:</p>
<ul>
<li>the world definitions in my wit files</li>
<li>how things are set up w/ <code>wasmtime</code>'s generate macros</li>
<li>how things are set up w/ <code>wit-bindgen</code>'s generate macros</li>
<li>how I'm currently using the <code>wasmtime</code> runtime</li>
</ul>
<p>However, I did have this previously working with a simpler API definition that didn't really try to do anything with WASI beyond using stdout/stderr.</p>
<p>Full codebase in this branch, along with wit definitions: <a href="https://github.com/bulwark-security/bulwark/tree/api-refactor">https://github.com/bulwark-security/bulwark/tree/api-refactor</a></p>
<p>Unfortunately, I've exhausted everything I can think of to debug this. The error message just doesn't give a whole lot to go on and I'm wondering if there might be something that could be done to significantly improve that error message, because it has seemed to come up a lot.<br>
```[tasklist]</p>
<h3>Tasks</h3>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="421152972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421152972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421152972">(Feb 13 2024 at 00:03)</a>:</h4>
<p>sporkmonger edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Similar to #7505, I'm running into a problem with a "has the wrong type" error, but unlike that previous issue, I believe I do have the correct adapter version. I'm running <code>wasmtime 17.0.1</code> with the reactor adapter taken from the corresponding release.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">AnyError</span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">incoming</span><span class="o">-</span><span class="n">request</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
    <span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">test_plugin</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm not particularly confident in the correctness of any of these, even though everything compiles OK:</p>
<ul>
<li>the world definitions in my wit files</li>
<li>how things are set up w/ <code>wasmtime</code>'s generate macros</li>
<li>how things are set up w/ <code>wit-bindgen</code>'s generate macros</li>
<li>how I'm currently using the <code>wasmtime</code> runtime</li>
</ul>
<p>However, I did have this previously working with a simpler API definition that didn't really try to do anything with WASI beyond using stdout/stderr.</p>
<p>Full codebase in this branch, along with wit definitions: <a href="https://github.com/bulwark-security/bulwark/tree/api-refactor">https://github.com/bulwark-security/bulwark/tree/api-refactor</a></p>
<p>Unfortunately, I've exhausted everything I can think of to debug this. The error message just doesn't give a whole lot to go on and I'm wondering if there might be something that could be done to significantly improve that error message, because it has seemed to come up a lot.</p>
</blockquote>



<a name="421155329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421155329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421155329">(Feb 13 2024 at 00:27)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1939868364">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>I think you are missing an add_to_linker that provides wasi:http/types here: <a href="https://github.com/bulwark-security/bulwark/compare/main...api-refactor#diff-3f2325fd7fe144935eb0a48fb3ced5e8afd4a3cc28a6ac7d86a629db1af865ccR282">https://github.com/bulwark-security/bulwark/compare/main...api-refactor#diff-3f2325fd7fe144935eb0a48fb3ced5e8afd4a3cc28a6ac7d86a629db1af865ccR282</a></p>
<p>This one will provide it, if you need the outgoing-handler as well that is nearby <a href="https://docs.rs/wasmtime-wasi-http/latest/wasmtime_wasi_http/bindings/wasi/http/types/fn.add_to_linker.html">https://docs.rs/wasmtime-wasi-http/latest/wasmtime_wasi_http/bindings/wasi/http/types/fn.add_to_linker.html</a></p>
</blockquote>



<a name="421157538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421157538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421157538">(Feb 13 2024 at 00:53)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1939949287">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Wow, thanks, at first glance, that does indeed seem to have been the issue. I think I do need the outgoing-handler one too, but interestingly, omitting it doesn't seem to have failed anything on instantiation. Not sure I understand why the http types one would fail on instantiation but outgoing-handler wouldn't?</p>
<p>I'm also really interested in understanding your thought process for how you found the problem so quickly because I've been trying to figure it out for the better part of a week. <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>
<p>Even with a likely root cause now, I think I feel like my comment on the error message still applies. This feels like a good opportunity to give implementors more useful information.</p>
</blockquote>



<a name="421159322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421159322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421159322">(Feb 13 2024 at 01:14)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1940030374">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Just noticed that <code>wasm-tools component wit test_plugin.wasm</code> output shows <code>import wasi:http/types@0.2.0</code> but not <code>import wasi:http/outgoing-handler@0.2.0</code>, so presuming that's why... but I guess I'm not sure I understand why it's missing. Shouldn't the <code>include</code> have pulled it in?</p>
</blockquote>



<a name="421165665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421165665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421165665">(Feb 13 2024 at 02:32)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1940303094">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>My thought process was: if its just HTTP that gets the complaint and not the rest of WASI, then you probably just weren't aware that our HTTP implementation lives in a separate crate. Missed <code>add_to_linker</code> is a sizable minority of the bug reports we get, so thats always one of the first things I rule out.</p>
<p>If you did an <code>include wasi:http/proxy;</code> that should have pulled in the outgoing-handler import, and require an incoming-handler export be present. That's what we'd expect you to use if you were trying to provide a superset of the proxy world (meaning a proxy component that doesnt know anything about bulwark would execute just like it does in plain old <code>wasmtime serve</code>).</p>
</blockquote>



<a name="421165688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421165688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421165688">(Feb 13 2024 at 02:32)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1940303094">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>My thought process was: if its just HTTP that gets the complaint and not the rest of WASI, then you probably just weren't aware that our HTTP implementation lives in a separate crate. Missed <code>add_to_linker</code> is a sizable minority of the bug reports we get, so thats always one of the first things I rule out.</p>
<p>I don't see exactly where you performed an <code>include</code> - link me if you can. </p>
<p>If you did an <code>include wasi:http/proxy;</code> that should have pulled in the outgoing-handler import, and require an incoming-handler export be present. That's what we'd expect you to use if you were trying to provide a superset of the proxy world (meaning a proxy component that doesnt know anything about bulwark would execute just like it does in plain old <code>wasmtime serve</code>).</p>
</blockquote>



<a name="421332151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421332151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421332151">(Feb 13 2024 at 21:57)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1942704260">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>This include: <a href="https://github.com/bulwark-security/bulwark/blob/api-refactor/wit/platform.wit#L4">https://github.com/bulwark-security/bulwark/blob/api-refactor/wit/platform.wit#L4</a></p>
</blockquote>



<a name="421351123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/421351123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#421351123">(Feb 14 2024 at 00:55)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1942922968">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>I took a look but I'm having a hard time getting oriented to reproduce - can you describe how to build the sample guest code, and run the host code, at the current commit?</p>
</blockquote>



<a name="422687426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/422687426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#422687426">(Feb 21 2024 at 19:12)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1957728908">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>You might need to do a new pull since I've made a few changes and fixes in the interim.</p>
<p>Normal build step for the main <code>bulwark-cli</code> binary (I usually just do <code>cargo install --path .</code>), then using that in the <code>crates/wasm-sdk/examples/blank-slate</code> directory to do its own build:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">bulwark</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">build</span>
<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">9.23</span><span class="n">s</span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">dist</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">bulwark_blank_slate</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="422687597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/422687597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#422687597">(Feb 21 2024 at 19:13)</a>:</h4>
<p>sporkmonger edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1957728908">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>You might need to do a new pull since I've made a few changes and fixes in the interim.</p>
<p>Normal build step for the main <code>bulwark-cli</code> binary (I usually just do <code>cargo install --path .</code>), then using that in the <code>crates/wasm-sdk/examples/blank-slate</code> directory to do its own build:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">bulwark</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">build</span>
<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">9.23</span><span class="n">s</span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">dist</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">bulwark_blank_slate</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I was expecting to see <code>import wasi:http/outgoing-handler@0.2.0</code> in there but it's missing.</p>
</blockquote>



<a name="422687781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/422687781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#422687781">(Feb 21 2024 at 19:14)</a>:</h4>
<p>sporkmonger edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1957728908">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Getting a working build might require a new pull since I've made a few changes and fixes in the interim.</p>
<p>Normal build step for the main <code>bulwark-cli</code> binary (I usually just do <code>cargo install --path .</code>), then using that in the <code>crates/wasm-sdk/examples/blank-slate</code> directory to do its own build:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">bulwark</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="n">build</span>
<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">9.23</span><span class="n">s</span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">dist</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">bulwark_blank_slate</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span>:<span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span>:<span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span>:<span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I was expecting to see <code>import wasi:http/outgoing-handler@0.2.0</code> in there but it's missing.</p>
</blockquote>



<a name="422854789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/422854789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#422854789">(Feb 22 2024 at 16:25)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-1959807222">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>I'll note that when creating a component if an interface isn't used it'll be omitted from the final component. To that end can you confirm that <code>dist/plugins/bulwark_blank_slate.wasm</code> is using <code>wasi:http/outgoing-handler</code>? If it's not then that's expected behavior that the import doesn't show up, but if it is then something indeed odd is happening!</p>
</blockquote>



<a name="441142613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/441142613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#441142613">(May 29 2024 at 01:17)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-2136346250">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Sorry, looping back to this quite a bit later. Yeah, that might be it. That specific component isn't using <code>wasi:http/outgoing-handler</code>. I'll have to write one that does and re-check. Might be working as intended!</p>
</blockquote>



<a name="444364837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/444364837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#444364837">(Jun 13 2024 at 02:11)</a>:</h4>
<p>sporkmonger <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-2164219461">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Confirmed, working as intended, thanks. Once I recompiled a component that used <code>wasi:http/outgoing-handler</code> it started to show up.</p>
</blockquote>



<a name="444365164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/444365164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#444365164">(Jun 13 2024 at 02:14)</a>:</h4>
<p>sporkmonger edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-2164219461">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Confirmed, once I recompiled a component that used <code>wasi:http/outgoing-handler</code> it started to show up.</p>
</blockquote>



<a name="444484655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/444484655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#444484655">(Jun 13 2024 at 14:53)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Similar to #7505, I'm running into a problem with a "has the wrong type" error, but unlike that previous issue, I believe I do have the correct adapter version. I'm running <code>wasmtime 17.0.1</code> with the reactor adapter taken from the corresponding release.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">AnyError</span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>

<span class="nc">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">instance</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="err">`</span><span class="n">incoming</span><span class="o">-</span><span class="n">request</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="k">type</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">expected</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">nothing</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">wit</span><span class="w"> </span><span class="n">test_plugin</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">package</span><span class="w"> </span><span class="n">root</span><span class="p">:</span><span class="nc">component</span><span class="p">;</span>

<span class="n">world</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">error</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">io</span><span class="o">/</span><span class="n">streams</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">http</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">bulwark</span><span class="p">:</span><span class="nc">plugin</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">environment</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">exit</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stdin</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stdout</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">cli</span><span class="o">/</span><span class="n">stderr</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">clocks</span><span class="o">/</span><span class="n">wall</span><span class="o">-</span><span class="n">clock</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">types</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">filesystem</span><span class="o">/</span><span class="n">preopens</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>
<span class="w">  </span><span class="n">import</span><span class="w"> </span><span class="n">wasi</span><span class="p">:</span><span class="nc">random</span><span class="o">/</span><span class="n">random</span><span class="o">@</span><span class="mf">0.2.0</span><span class="p">;</span>

<span class="w">  </span><span class="n">export</span><span class="w"> </span><span class="n">bulwark</span><span class="p">:</span><span class="nc">plugin</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">handlers</span><span class="o">@</span><span class="mf">0.5.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm not particularly confident in the correctness of any of these, even though everything compiles OK:</p>
<ul>
<li>the world definitions in my wit files</li>
<li>how things are set up w/ <code>wasmtime</code>'s generate macros</li>
<li>how things are set up w/ <code>wit-bindgen</code>'s generate macros</li>
<li>how I'm currently using the <code>wasmtime</code> runtime</li>
</ul>
<p>However, I did have this previously working with a simpler API definition that didn't really try to do anything with WASI beyond using stdout/stderr.</p>
<p>Full codebase in this branch, along with wit definitions: <a href="https://github.com/bulwark-security/bulwark/tree/api-refactor">https://github.com/bulwark-security/bulwark/tree/api-refactor</a></p>
<p>Unfortunately, I've exhausted everything I can think of to debug this. The error message just doesn't give a whole lot to go on and I'm wondering if there might be something that could be done to significantly improve that error message, because it has seemed to come up a lot.</p>
</blockquote>



<a name="444484657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237923%20import%20has%20the%20wrong%20type%2C%20but%20doe.../near/444484657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237923.20import.20has.20the.20wrong.20type.2C.20but.20doe.2E.2E.2E.html#444484657">(Jun 13 2024 at 14:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7923#issuecomment-2165912265">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7923">issue #7923</a>:</p>
<blockquote>
<p>Ok sounds good, thanks for the follow-up! I think that means everything here is working as expected, so I'm going to close. (if I missed something though let me know)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>