<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3457 Cranelift: panic in cranelife-code... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html">wasmtime / issue #3457 Cranelift: panic in cranelife-code...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="257874055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874055">(Oct 17 2021 at 00:38)</a>:</h4>
<p>serprex opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li><code>cargo run [mandel.bf](https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf)</code></li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257874056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874056">(Oct 17 2021 at 00:38)</a>:</h4>
<p>serprex labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li><code>cargo run [mandel.bf](https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf)</code></li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257874057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874057">(Oct 17 2021 at 00:38)</a>:</h4>
<p>serprex labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li><code>cargo run [mandel.bf](https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf)</code></li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257874082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874082">(Oct 17 2021 at 00:39)</a>:</h4>
<p>serprex edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li>download <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf</a></li>
<li><code>cargo run </code>mandel.bf`</li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257874094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874094">(Oct 17 2021 at 00:39)</a>:</h4>
<p>serprex edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li>download <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf</a></li>
<li><code>cargo run mandel.bf</code></li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257874633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874633">(Oct 17 2021 at 00:49)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945028676">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>That assert is testing that the number of args on a branch instruction matches the number of block parameters on the destination block. Can you verify that these match in your test case for all the branches?</p>
<blockquote>
<p><code>cargo install clif-util</code> doesn't seem to be a thing</p>
</blockquote>
<p>I'm not sure if we provide a <code>cargo</code> install<code>-able crate with </code>clif-util<code>, but you can get it by checkout out the repo then </code>cargo build --release -p cranelift-tools`. (Sorry this isn't more convenient!)</p>
</blockquote>



<a name="257874646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874646">(Oct 17 2021 at 00:49)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945028676">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>That assert is testing that the number of args on a branch instruction matches the number of block parameters on the destination block. Can you verify that these match in your test case for all the branches?</p>
<blockquote>
<p><code>cargo install clif-util</code> doesn't seem to be a thing</p>
</blockquote>
<p>I'm not sure if we provide a <code>cargo install</code>-able crate with <code>clif-util</code>, but you can get it by checkout out the repo then <code>cargo build --release -p cranelift-tools</code>. (Sorry this isn't more convenient!)</p>
</blockquote>



<a name="257874706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257874706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257874706">(Oct 17 2021 at 00:50)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945028676">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>That assert is testing that the number of args on a branch instruction matches the number of block parameters on the destination block. Can you verify that these match in your test case for all the branches?</p>
<blockquote>
<p><code>cargo install clif-util</code> doesn't seem to be a thing</p>
</blockquote>
<p>I'm not sure if we provide a <code>cargo install</code>-able crate with <code>clif-util</code>, but you can get it by cloning the repo then <code>cargo build --release -p cranelift-tools</code>. (Sorry this isn't more convenient!)</p>
</blockquote>



<a name="257877069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257877069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257877069">(Oct 17 2021 at 01:32)</a>:</h4>
<p>serprex <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945032956">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>The cargo build command fails with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">workspace</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="err">`</span><span class="o">..</span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">bench</span><span class="o">-</span><span class="n">api</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">cap</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">sync</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">common</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="kr">macro</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="n">generate</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">witx</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><code>cargo version</code> outputs <code>cargo 1.55.0 (32da73ab1 2021-08-23)</code> while <code>rustc -V</code> outputs <code>rustc 1.55.0 (c8dfcfe04 2021-09-06)</code></p>
</blockquote>



<a name="257877104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257877104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257877104">(Oct 17 2021 at 01:33)</a>:</h4>
<p>serprex edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945032956">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>I don't think I'm mismatching parameter counts: the generator only creates parameter taking blocks at 2 points in the code (both cases taking 1 parameter)</p>
<p>The cargo build command fails with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">workspace</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="err">`</span><span class="o">..</span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">bench</span><span class="o">-</span><span class="n">api</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">cap</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">sync</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">common</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="kr">macro</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="n">generate</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">witx</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><code>cargo version</code> outputs <code>cargo 1.55.0 (32da73ab1 2021-08-23)</code> while <code>rustc -V</code> outputs <code>rustc 1.55.0 (c8dfcfe04 2021-09-06)</code></p>
</blockquote>



<a name="257877122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257877122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257877122">(Oct 17 2021 at 01:33)</a>:</h4>
<p>serprex edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945032956">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>I don't think I'm mismatching parameter counts: the compiler only creates parameter taking blocks at 2 points in the code (both cases taking 1 parameter)</p>
<p>The cargo build command fails with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">workspace</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="err">`</span><span class="o">..</span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">bench</span><span class="o">-</span><span class="n">api</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">cap</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">sync</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">common</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="kr">macro</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="n">generate</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">witx</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><code>cargo version</code> outputs <code>cargo 1.55.0 (32da73ab1 2021-08-23)</code> while <code>rustc -V</code> outputs <code>rustc 1.55.0 (c8dfcfe04 2021-09-06)</code></p>
</blockquote>



<a name="257878024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257878024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257878024">(Oct 17 2021 at 01:49)</a>:</h4>
<p>serprex edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945032956">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>I don't think I'm mismatching parameter counts: the compiler only creates parameter taking blocks at 2 points in the code (both cases taking 1 parameter)</p>
<p>The cargo build command fails with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">workspace</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="err">`</span><span class="o">..</span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">bench</span><span class="o">-</span><span class="n">api</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">cap</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">sync</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wasi</span><span class="o">-</span><span class="n">common</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="kr">macro</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">wiggle</span><span class="o">-</span><span class="n">generate</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">manifest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="err">`</span><span class="n">witx</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p><code>cargo version</code> outputs <code>cargo 1.55.0 (32da73ab1 2021-08-23)</code> while <code>rustc -V</code> outputs <code>rustc 1.55.0 (c8dfcfe04 2021-09-06)</code></p>
<p>Also silly me didn't include <code>RUST_BACKTRACE=1</code> output</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">assertion</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">num_args</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">f</span><span class="p">.</span><span class="n">dfg</span><span class="p">.</span><span class="n">inst_variable_args</span><span class="p">(</span><span class="n">inst</span><span class="p">).</span><span class="n">len</span><span class="p">()</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">529</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">rust_begin_unwind</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c8dfcfe046a7680554bf4eb612bad840e7631c4b</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c8dfcfe046a7680554bf4eb612bad840e7631c4b</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c8dfcfe046a7680554bf4eb612bad840e7631c4b</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">50</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span>::<span class="n">lower_edge</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">529</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span>::<span class="n">lower</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">974</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">29</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">54</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">MachBackend</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">196</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">backend</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erpre</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.77.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">641</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">barfs</span>::<span class="n">jit</span>::<span class="n">execute</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">jit</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">318</span>:<span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">barfs</span>::<span class="n">main</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">43</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">c8dfcfe046a7680554bf4eb612bad840e7631c4b</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="257878243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257878243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257878243">(Oct 17 2021 at 01:53)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945034819">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>That cargo build failure indicates the git submodules are missing -- try <code>git submodule update --init</code>? (This is possibly git's least intuitive feature ever; sorry and thanks for the patience!).</p>
<blockquote>
<p>I don't think I'm mismatching parameter counts: the compiler only creates parameter taking blocks at 2 points in the code (both cases taking 1 parameter)</p>
</blockquote>
<p>Interesting; nevertheless, the assert is checking exactly this condition; so either it's hiding somewhere in the input, or being introduced somewhere along the way. A minimized test case input would be very helpful (as a <code>.clif</code> that we can compile without needing your infrastructure), if you're able!</p>
</blockquote>



<a name="257880807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257880807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257880807">(Oct 17 2021 at 02:38)</a>:</h4>
<p>serprex <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945038531">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Running clif-util bugpoint found nothing. Was able to compile to x86_64 assembly. Also checked out a1f4b46f64e7c8526dc37bbe220043dff050bf3e (0.77 release commit) &amp; it doesn't raise an error either</p>
<p>I created a clif file by taking the ir output from the pastebin I linked, only clif-util complained about fallthrough not being understood, but it worked once I replaced <code>fallthrough</code> with <code>jump</code>. As an experiment I converted parameterized <code>ins().fallthrough</code> calls in my code to <code>ins().jump</code> but the panic remains</p>
</blockquote>



<a name="257917966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257917966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257917966">(Oct 17 2021 at 13:12)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945119776">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>572fbc8c5 (the commit tagged as wasmtime v0.30.0, so cranelift version 0.77) does return an error for me. The main branch gives <code>signal SIGFPE: integer divide by zero</code> after replacing all <code>fallthrough</code> with <code>jump</code> as <code>fallthrough</code> is removed on the main branch.</p>
<p><div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/barfs/src/jit.rs b/barfs/src/jit.rs</span>
<span class="gh">index a88cd46..d313de4 100644</span>
<span class="gd">--- a/barfs/src/jit.rs</span>
<span class="gi">+++ b/barfs/src/jit.rs</span>
<span class="gu">@@ -103,7 +103,7 @@ pub fn execute(</span>
                        let stidx = builder.use_var(vsidx);
                        let zerocc = builder.ins().iconst(ti64, 0);
                        builder.ins().br_icmp(IntCC::SignedLessThan, stidx, zerocc, zbb, &amp;[]);
<span class="gd">-                       builder.ins().fallthrough(bbpop, &amp;[]);</span>
<span class="gi">+                       builder.ins().jump(bbpop, &amp;[]);</span>
                        builder.switch_to_block(bbpop);
                        let four = builder.ins().iconst(ti64, 4);
                        let newstidx = builder.ins().isub(stidx, four);
<span class="gu">@@ -114,7 +114,7 @@ pub fn execute(</span>
                        builder.ins().jump(bb, &amp;[loadres]);
                        builder.switch_to_block(zbb);
                        let zero = builder.ins().iconst(ti32, 0);
<span class="gd">-                       builder.ins().fallthrough(bb, &amp;[zero]);</span>
<span class="gi">+                       builder.ins().jump(bb, &amp;[zero]);</span>
                        builder.switch_to_block(bb);
                        builder.def_var(var, builder.block_params(bb)[0]);
                };
<span class="gu">@@ -138,7 +138,7 @@ pub fn execute(</span>

                                let newbb = builder.create_block();
                                if !builder.is_filled() {
<span class="gd">-                                       builder.ins().fallthrough(newbb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(newbb, &amp;[]);</span>
                                }
                                builder.switch_to_block(newbb);
                                bbmap.insert(n, newbb);
<span class="gu">@@ -225,13 +225,13 @@ pub fn execute(</span>
                                        builder.append_block_param(bb, ti32);
                                        let zero = builder.ins().iconst(ti32, 0);
                                        builder.ins().br_icmp(IntCC::UnsignedLessThan, ab, twofivesixzero, bb, &amp;[zero]);
<span class="gd">-                                       builder.ins().fallthrough(idxbb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(idxbb, &amp;[]);</span>
                                        builder.switch_to_block(idxbb);
                                        let ab = builder.ins().uextend(ti64, ab);
                                        let vcode = builder.ins().iconst(tptr, code.as_ptr() as i64);
                                        let vcodeab = builder.ins().iadd(vcode, ab);
                                        let result = builder.ins().load(ti32, aligned, vcodeab, 0);
<span class="gd">-                                       builder.ins().fallthrough(bb, &amp;[result]);</span>
<span class="gi">+                                       builder.ins().jump(bb, &amp;[result]);</span>
                                        builder.switch_to_block(bb);
                                        let val = builder.block_params(bb)[0];
                                        clpush(&amp;mut builder, val);
<span class="gu">@@ -248,7 +248,7 @@ pub fn execute(</span>
                                        let b25 = builder.ins().icmp_imm(IntCC::UnsignedLessThan, b, 25);
                                        let ab8025 = builder.ins().band(a80, b25);
                                        builder.ins().brz(ab8025, bb, &amp;[]);
<span class="gd">-                                       builder.ins().fallthrough(bbwrite, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(bbwrite, &amp;[]);</span>
                                        builder.switch_to_block(bbwrite);
                                        let five = builder.ins().iconst(ti32, 5);
                                        let a5 = builder.ins().ishl(a, five);
<span class="gu">@@ -258,7 +258,7 @@ pub fn execute(</span>
                                        let vcodeab = builder.ins().iadd(vcode, ab);
                                        let c = builder.use_var(tc);
                                        builder.ins().store(aligned, c, vcodeab, 0);
<span class="gd">-                                       builder.ins().fallthrough(bb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(bb, &amp;[]);</span>
                                        builder.switch_to_block(bb);
                                }
                                Op::Jr(r0, r1, r2) =&gt; {
<span class="gu">@@ -272,7 +272,7 @@ pub fn execute(</span>
                                        let j = builder.ins().brz(a, Block::from_u32(0), &amp;[]);
                                        jumpmap.push((j, rz));
                                        compstack.push(rz);
<span class="gd">-                                       let j = builder.ins().fallthrough(Block::from_u32(0), &amp;[]);</span>
<span class="gi">+                                       let j = builder.ins().jump(Block::from_u32(0), &amp;[]);</span>
                                        jumpmap.push((j, op.n));
                                }
                                Op::Ret =&gt; {
</code></pre></div><br>
</p>
</blockquote>



<a name="257918004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257918004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257918004">(Oct 17 2021 at 13:13)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945119776">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>572fbc8c5 (the commit tagged as wasmtime v0.30.0, so cranelift version 0.77) does return an error for me. The main branch gives <code>signal SIGFPE: integer divide by zero</code> after replacing all <code>fallthrough</code> with <code>jump</code> as <code>fallthrough</code> is removed on the main branch.</p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/barfs/src/jit.rs b/barfs/src/jit.rs</span>
<span class="gh">index a88cd46..d313de4 100644</span>
<span class="gd">--- a/barfs/src/jit.rs</span>
<span class="gi">+++ b/barfs/src/jit.rs</span>
<span class="gu">@@ -103,7 +103,7 @@ pub fn execute(</span>
                        let stidx = builder.use_var(vsidx);
                        let zerocc = builder.ins().iconst(ti64, 0);
                        builder.ins().br_icmp(IntCC::SignedLessThan, stidx, zerocc, zbb, &amp;[]);
<span class="gd">-                       builder.ins().fallthrough(bbpop, &amp;[]);</span>
<span class="gi">+                       builder.ins().jump(bbpop, &amp;[]);</span>
                        builder.switch_to_block(bbpop);
                        let four = builder.ins().iconst(ti64, 4);
                        let newstidx = builder.ins().isub(stidx, four);
<span class="gu">@@ -114,7 +114,7 @@ pub fn execute(</span>
                        builder.ins().jump(bb, &amp;[loadres]);
                        builder.switch_to_block(zbb);
                        let zero = builder.ins().iconst(ti32, 0);
<span class="gd">-                       builder.ins().fallthrough(bb, &amp;[zero]);</span>
<span class="gi">+                       builder.ins().jump(bb, &amp;[zero]);</span>
                        builder.switch_to_block(bb);
                        builder.def_var(var, builder.block_params(bb)[0]);
                };
<span class="gu">@@ -138,7 +138,7 @@ pub fn execute(</span>

                                let newbb = builder.create_block();
                                if !builder.is_filled() {
<span class="gd">-                                       builder.ins().fallthrough(newbb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(newbb, &amp;[]);</span>
                                }
                                builder.switch_to_block(newbb);
                                bbmap.insert(n, newbb);
<span class="gu">@@ -225,13 +225,13 @@ pub fn execute(</span>
                                        builder.append_block_param(bb, ti32);
                                        let zero = builder.ins().iconst(ti32, 0);
                                        builder.ins().br_icmp(IntCC::UnsignedLessThan, ab, twofivesixzero, bb, &amp;[zero]);
<span class="gd">-                                       builder.ins().fallthrough(idxbb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(idxbb, &amp;[]);</span>
                                        builder.switch_to_block(idxbb);
                                        let ab = builder.ins().uextend(ti64, ab);
                                        let vcode = builder.ins().iconst(tptr, code.as_ptr() as i64);
                                        let vcodeab = builder.ins().iadd(vcode, ab);
                                        let result = builder.ins().load(ti32, aligned, vcodeab, 0);
<span class="gd">-                                       builder.ins().fallthrough(bb, &amp;[result]);</span>
<span class="gi">+                                       builder.ins().jump(bb, &amp;[result]);</span>
                                        builder.switch_to_block(bb);
                                        let val = builder.block_params(bb)[0];
                                        clpush(&amp;mut builder, val);
<span class="gu">@@ -248,7 +248,7 @@ pub fn execute(</span>
                                        let b25 = builder.ins().icmp_imm(IntCC::UnsignedLessThan, b, 25);
                                        let ab8025 = builder.ins().band(a80, b25);
                                        builder.ins().brz(ab8025, bb, &amp;[]);
<span class="gd">-                                       builder.ins().fallthrough(bbwrite, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(bbwrite, &amp;[]);</span>
                                        builder.switch_to_block(bbwrite);
                                        let five = builder.ins().iconst(ti32, 5);
                                        let a5 = builder.ins().ishl(a, five);
<span class="gu">@@ -258,7 +258,7 @@ pub fn execute(</span>
                                        let vcodeab = builder.ins().iadd(vcode, ab);
                                        let c = builder.use_var(tc);
                                        builder.ins().store(aligned, c, vcodeab, 0);
<span class="gd">-                                       builder.ins().fallthrough(bb, &amp;[]);</span>
<span class="gi">+                                       builder.ins().jump(bb, &amp;[]);</span>
                                        builder.switch_to_block(bb);
                                }
                                Op::Jr(r0, r1, r2) =&gt; {
<span class="gu">@@ -272,7 +272,7 @@ pub fn execute(</span>
                                        let j = builder.ins().brz(a, Block::from_u32(0), &amp;[]);
                                        jumpmap.push((j, rz));
                                        compstack.push(rz);
<span class="gd">-                                       let j = builder.ins().fallthrough(Block::from_u32(0), &amp;[]);</span>
<span class="gi">+                                       let j = builder.ins().jump(Block::from_u32(0), &amp;[]);</span>
                                        jumpmap.push((j, op.n));
                                }
                                Op::Ret =&gt; {
</code></pre></div>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="257918298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257918298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257918298">(Oct 17 2021 at 13:17)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945121136">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Replacing all <code>fallthrough</code> with <code>jump</code> also fixes the issue for cranelift 0.77. The issue is that a <code>fallthrough</code> instruction actually specifies a destination that doesn't come directly after the <code>fallthrough</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">block1035</span><span class="p">(</span><span class="n">v4902</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v4950</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v4911</span><span class="w"> </span>-&gt; <span class="nc">v4950</span><span class="w"></span>
<span class="w">    </span><span class="n">brz</span><span class="w"> </span><span class="n">v4902</span><span class="p">,</span><span class="w"> </span><span class="n">block1036</span><span class="w"></span>
<span class="w">    </span><span class="n">fallthrough</span><span class="w"> </span><span class="n">block266</span><span class="p">(</span><span class="n">v4950</span><span class="p">)</span><span class="w"></span>

<span class="n">block1036</span>:
    <span class="nc">v4910</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="n">v4912</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">    </span><span class="n">v4913</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v4911</span><span class="p">,</span><span class="w"> </span><span class="n">v4912</span><span class="w"></span>
<span class="w">    </span><span class="n">v4914</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mh">0x7fff_ffff_9698</span><span class="w"></span>
<span class="w">    </span><span class="n">v4915</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v4914</span><span class="p">,</span><span class="w"> </span><span class="n">v4913</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="w"> </span><span class="n">aligned</span><span class="w"> </span><span class="n">v4910</span><span class="p">,</span><span class="w"> </span><span class="n">v4915</span><span class="w"></span>
<span class="w">    </span><span class="n">v4917</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">br_icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v4913</span><span class="p">,</span><span class="w"> </span><span class="n">v4917</span><span class="p">,</span><span class="w"> </span><span class="n">block1038</span><span class="w"></span>
<span class="w">    </span><span class="n">fallthrough</span><span class="w"> </span><span class="n">block1037</span><span class="w"></span>
</code></pre></div>
<p><code>block266</code> doesn't follow <code>block1035</code>.</p>
</blockquote>



<a name="257918339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257918339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257918339">(Oct 17 2021 at 13:18)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945121136">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Replacing all <code>fallthrough</code> with <code>jump</code> also fixes the issue for cranelift 0.77. The issue is that a <code>fallthrough</code> instruction actually specifies a destination that doesn't come directly after the <code>fallthrough</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">block1035</span><span class="p">(</span><span class="n">v4902</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v4950</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v4911</span><span class="w"> </span>-&gt; <span class="nc">v4950</span><span class="w"></span>
<span class="w">    </span><span class="n">brz</span><span class="w"> </span><span class="n">v4902</span><span class="p">,</span><span class="w"> </span><span class="n">block1036</span><span class="w"></span>
<span class="w">    </span><span class="n">fallthrough</span><span class="w"> </span><span class="n">block266</span><span class="p">(</span><span class="n">v4950</span><span class="p">)</span><span class="w"></span>

<span class="n">block1036</span>:
    <span class="nc">v4910</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="n">v4912</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">    </span><span class="n">v4913</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v4911</span><span class="p">,</span><span class="w"> </span><span class="n">v4912</span><span class="w"></span>
<span class="w">    </span><span class="n">v4914</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mh">0x7fff_ffff_9698</span><span class="w"></span>
<span class="w">    </span><span class="n">v4915</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v4914</span><span class="p">,</span><span class="w"> </span><span class="n">v4913</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="w"> </span><span class="n">aligned</span><span class="w"> </span><span class="n">v4910</span><span class="p">,</span><span class="w"> </span><span class="n">v4915</span><span class="w"></span>
<span class="w">    </span><span class="n">v4917</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">br_icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v4913</span><span class="p">,</span><span class="w"> </span><span class="n">v4917</span><span class="p">,</span><span class="w"> </span><span class="n">block1038</span><span class="w"></span>
<span class="w">    </span><span class="n">fallthrough</span><span class="w"> </span><span class="n">block1037</span><span class="w"></span>
</code></pre></div>
<p><code>block266</code> doesn't follow <code>block1035</code>. If it weren't for the fact that <code>falthrough</code> has been removed anyway it would be nice to have a verifier error for this.</p>
</blockquote>



<a name="257922530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257922530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257922530">(Oct 17 2021 at 14:22)</a>:</h4>
<p>serprex closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Please fill out the TODOs below.</p>
<h3><code>.clif</code> Test Case</h3>
<p>Is printing the JITModule's context's func the clif result? If so that's included at the end of the stdout output. Can look into narrowing down test case with some guidance about clif-util &amp; how to get clif output (<code>cargo install clif-util</code> doesn't seem to be  a thing)</p>
<h3>Steps to Reproduce</h3>
<ul>
<li>git clone <a href="https://github.com/serprex/Befunge">https://github.com/serprex/Befunge</a></li>
<li>cd to barfs directory</li>
<li>download <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf</a></li>
<li><code>cargo run mandel.bf</code></li>
</ul>
<h3>Expected Results</h3>
<p>Receive an error probably, or do whatever it is my code generator is doing (it's WIP, so still buggy itself)</p>
<h3>Actual Results</h3>
<p><code>thread 'main' panicked at 'assertion failed: num_args == self.f.dfg.inst_variable_args(inst).len()', .../cranelift-codegen-0.77.0/src/machinst/lower.rs:529:9</code></p>
<h3>Versions and Environment</h3>
<p>Cranelift version or commit: 0.77</p>
<p>Operating system: Archlinux</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?</p>
<p>barfs stdout on <a href="https://github.com/catseye/Befunge-93/blob/master/eg/mandel.bf">mandel.bf</a>: <a href="https://pastebin.com/4fLDcktw">https://pastebin.com/4fLDcktw</a></p>
<p>Also unrelated but doc for <a href="https://docs.rs/cranelift/0.77.0/cranelift/prelude/trait.InstBuilder.html#method.icmp">icmp</a> is missing info on output type, "A boolean type with 1 bits."</p>
</blockquote>



<a name="257922531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257922531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257922531">(Oct 17 2021 at 14:22)</a>:</h4>
<p>serprex <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945134031">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>The floating point error is likely a division by zero in my buggy generated code. Looks like this is effectively fixed in master</p>
<p>Thanks</p>
</blockquote>



<a name="257944010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233457%20Cranelift%3A%20panic%20in%20cranelife-code.../near/257944010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233457.20Cranelift.3A.20panic.20in.20cranelife-code.2E.2E.2E.html#257944010">(Oct 17 2021 at 19:57)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3457#issuecomment-945185315">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3457">issue #3457</a>:</p>
<blockquote>
<p>Ah, thank you for finding the issue, @bjorn3! In hindsight I also should have suggested enabling the CLIF verifier -- this should have also found the issue with the erroneous <code>fallthrough</code>. Possibly a useful tip for any future issues with your generated CLIF :-)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>