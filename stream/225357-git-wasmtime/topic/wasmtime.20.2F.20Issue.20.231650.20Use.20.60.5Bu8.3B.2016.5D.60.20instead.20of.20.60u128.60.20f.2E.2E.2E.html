<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1650 Use `[u8; 16]` instead of `u128` f... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html">wasmtime / Issue #1650 Use `[u8; 16]` instead of `u128` f...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="196217933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196217933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196217933">(May 04 2020 at 18:06)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623618289" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623618289">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>I am not married to this proposal: we could instead add a pretty-printer to wrap <code>Val</code>s and print the <code>Val::V128</code> variants as either hex or converted by <code>to_le_bytes()</code>. Even better would be to figure out what the lane types of the <code>V128</code> are supposed to be and print as that. I'll close this and try one of those approaches if someone has a strong opinion (or really any opinion <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>) but this at least makes it easier to troubleshoot why tests are failing.</p>
</blockquote>



<a name="196219509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196219509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196219509">(May 04 2020 at 18:18)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623624514" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623624514">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="196224192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196224192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196224192">(May 04 2020 at 18:52)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623641294" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-623641294">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>Oh seeing this I remember now that <a href="https://github.com/bytecodealliance/wasmtime/pull/689" title="https://github.com/bytecodealliance/wasmtime/pull/689">https://github.com/bytecodealliance/wasmtime/pull/689</a> shows that we're wavering back and forth on this. That was motivated by <a href="https://github.com/bytecodealliance/wasmtime/commit/3d69e04659a9dade78fa80a76e69e3f1b9d1af07#r36326017" title="https://github.com/bytecodealliance/wasmtime/commit/3d69e04659a9dade78fa80a76e69e3f1b9d1af07#r36326017">https://github.com/bytecodealliance/wasmtime/commit/3d69e04659a9dade78fa80a76e69e3f1b9d1af07#r36326017</a>, so @joshtriplett would you mind helping to weigh in here?</p>
</blockquote>



<a name="196339071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196339071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196339071">(May 05 2020 at 17:24)</a>:</h4>
<p>joshtriplett <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>A few different considerations:</p>
<ul>
<li>Does the change here impact code generation? Do we get better assembly code by shifting values out of a u128 than we get by offsetting into a slice and extracting bytes?</li>
<li>For debugging, can we improve the debugging prints of the V128 to make it easier to see the individual components? (For instance, showing it in hex, providing <code>_</code> between each 32-bit value, etc?)</li>
<li>How would this interact with the actual use of full <code>u128</code> values in Rust and WebAssembly?</li>
</ul>
</blockquote>



<a name="196339139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196339139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196339139">(May 05 2020 at 17:25)</a>:</h4>
<p>joshtriplett edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>A few different considerations:</p>
<ul>
<li>Does the change here impact code generation? Do we get better assembly code by shifting values out of a u128 than we get by offsetting into a slice and extracting bytes?</li>
<li>For debugging, can we improve the debugging prints of the V128 to make it easier to see the individual components? (For instance, showing it in hex, providing <code>_</code> between each 32-bit value, etc?) Because looking at a <code>[u8; 16]</code> doesn't necessarily make it easy to "see" a <code>u32</code> or <code>u64</code> either.</li>
<li>How would this interact with the actual use of full <code>u128</code> values in Rust and WebAssembly?</li>
</ul>
</blockquote>



<a name="196339155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196339155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196339155">(May 05 2020 at 17:25)</a>:</h4>
<p>joshtriplett edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624195142">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>A few different considerations:</p>
<ul>
<li>Does the change here impact code generation? Do we get better assembly code by shifting values out of a u128 than we get by offsetting into a slice and extracting bytes?</li>
<li>For debugging, can we improve the debugging prints of the V128 to make it easier to see the individual components? (For instance, showing it in hex, providing <code>_</code> between each 32-bit value, etc?) Looking at a <code>[u8; 16]</code> doesn't necessarily make it easy to "see" a <code>u32</code> or <code>u64</code> either.</li>
<li>How would this interact with the actual use of full <code>u128</code> values in Rust and WebAssembly?</li>
</ul>
</blockquote>



<a name="196344348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196344348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196344348">(May 05 2020 at 18:09)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624218543" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624218543">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<blockquote>
<div class="codehilite"><pre><span></span><code>* Does the change here impact code generation? Do we get better assembly code by shifting values out of a u128 than we get by offsetting into a slice and extracting bytes?
</code></pre></div>


</blockquote>
<p>This should not impact Cranelift codegen; this is an internal detail for the boxing of values used in Wasmtime (e.g. if a user passes in a V128 from the CLI somehow it would be stored internally as either <code>[u8; 16]</code> or <code>u128</code> (depending on what we decide) for the brief time before it is passed in to the compiled code.</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>* For debugging, can we improve the debugging prints of the V128 to make it easier to see the individual components? (For instance, showing it in hex, providing _ between each 32-bit value, etc?) Looking at a [u8; 16] doesn&#39;t necessarily make it easy to &quot;see&quot; a u32 or u64 either.
</code></pre></div>


</blockquote>
<p>I think this is actually the better long-term solution. Lazily, I didn't really want to implement this but looking into it a bit it seems like we could coerce the V128 to look like whatever the <code>V128Pattern</code> from <code>wast</code> looks like. Let me try that instead of this approach.</p>
<blockquote>
<p>* How would this interact with the actual use of full u128 values in Rust and WebAssembly?</p>
</blockquote>
<p>I don't really see how it does. It seemed to me like a very internal detail to boxed values but I could be missing something.</p>
</blockquote>



<a name="196344388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196344388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196344388">(May 05 2020 at 18:09)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624218543" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624218543">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<blockquote>
<ul>
<li>Does the change here impact code generation? Do we get better assembly code by shifting values out of a u128 than we get by offsetting into a slice and extracting bytes?</li>
</ul>
</blockquote>
<p>This should not impact Cranelift codegen; this is an internal detail for the boxing of values used in Wasmtime (e.g. if a user passes in a V128 from the CLI somehow it would be stored internally as either <code>[u8; 16]</code> or <code>u128</code> (depending on what we decide) for the brief time before it is passed in to the compiled code.</p>
<blockquote>
<ul>
<li>For debugging, can we improve the debugging prints of the V128 to make it easier to see the individual components? (For instance, showing it in hex, providing _ between each 32-bit value, etc?) Looking at a [u8; 16] doesn't necessarily make it easy to "see" a u32 or u64 either.</li>
</ul>
</blockquote>
<p>I think this is actually the better long-term solution. Lazily, I didn't really want to implement this but looking into it a bit it seems like we could coerce the V128 to look like whatever the <code>V128Pattern</code> from <code>wast</code> looks like. Let me try that instead of this approach.</p>
<blockquote>
<ul>
<li>How would this interact with the actual use of full u128 values in Rust and WebAssembly?</li>
</ul>
</blockquote>
<p>I don't really see how it does. It seemed to me like a very internal detail to boxed values but I could be missing something.</p>
</blockquote>



<a name="196692965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/196692965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#196692965">(May 06 2020 at 20:31)</a>:</h4>
<p>joshtriplett <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624874749" title="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-624874749">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650" title="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>If this doesn't have any performance impact, I have no objection. But if the primary concern is debugging, I think it's worth trying a simple change to our debugging prints first.</p>
</blockquote>



<a name="197202456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231650%20Use%20%60%5Bu8%3B%2016%5D%60%20instead%20of%20%60u128%60%20f.../near/197202456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231650.20Use.20.60.5Bu8.3B.2016.5D.60.20instead.20of.20.60u128.60.20f.2E.2E.2E.html#197202456">(May 11 2020 at 20:45)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1650#issuecomment-626952997">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1650">Issue #1650</a>:</p>
<blockquote>
<p>Closing, see <a href="https://github.com/bytecodealliance/wasmtime/issues/1681">https://github.com/bytecodealliance/wasmtime/issues/1681</a>.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>