<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3351 cranelift: Add support for parsing i1... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html">wasmtime / PR #3351 cranelift: Add support for parsing i1...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="253425434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253425434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253425434">(Sep 15 2021 at 14:40)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a> from <code>parser-i128</code> to <code>main</code>:</p>
<blockquote>
<p>Hey,</p>
<p>This PR adds support for parsing <code>i128</code> data values, it also cleans up the <code>i128</code> test suite to pass those values directly to the functions. (We previously passed the bottom and top half in <code>i64</code>'s and <code>iconcat</code> them together)</p>
<p>This causes a bunch of noise in the diff (sorry!). I've separated this into two commits, the first one with the parser changes, and the second one with test suite changes. It might be easier to review it that way.</p>
<p>Since we now pass i128's directly we need to enable the <code>enable_llvm_abi_extensions</code> flag. This is because the <code>windows_fastcall</code> ABI does not specify how to pass <code>i128</code> values to functions. This is only necessary for the tests to pass on x86_64 windows.</p>
<p>It doesn't add support for <code>iconst.i128</code> since its instruction format (<code>UnaryImm</code>) doesen't allow us to include a 128 bit value. We would need to change it to <code>UnaryConst</code> for that.</p>
</blockquote>



<a name="253430851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253430851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253430851">(Sep 15 2021 at 15:12)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a> from <code>parser-i128</code> to <code>main</code>.</p>



<a name="253797713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253797713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253797713">(Sep 17 2021 at 19:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-757804962">PR review</a>.</p>



<a name="253797715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253797715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253797715">(Sep 17 2021 at 19:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-757804962">PR review</a>.</p>



<a name="253797716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253797716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253797716">(Sep 17 2021 at 19:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r711309048">PR review comment</a>:</p>
<blockquote>
<p>Why is this different (<code>ne</code> rather than <code>le</code>)? It would be useful to have a comment here explaining why we need to use native endian rather than explicit little endian as in the other cases.</p>
</blockquote>



<a name="253797717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253797717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253797717">(Sep 17 2021 at 19:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r711310364">PR review comment</a>:</p>
<blockquote>
<p>I see the duplication is pre-existing, but it's also unfortunate to continue it here. While it may expand the scope of this PR a bit, I wonder if there's a way to write a single polymorphic implementation? Maybe it can take the signed/unsigned types and require <code>FromStr</code> / <code>FromHex</code> / whatever encapsulates <code>wrapping_neg</code>?</p>
</blockquote>



<a name="253807987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253807987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253807987">(Sep 17 2021 at 21:10)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-757861379">PR review</a>.</p>



<a name="253807988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253807988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253807988">(Sep 17 2021 at 21:10)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r711352894">PR review comment</a>:</p>
<blockquote>
<p>We actually do need <code>ne</code> in the other ones (for big endian systems), however changing <code>le</code> -&gt; <code>ne</code> is already in a separate PR (#3329).</p>
</blockquote>



<a name="253814915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253814915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253814915">(Sep 17 2021 at 22:15)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-757892312">PR review</a>.</p>



<a name="253814916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253814916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253814916">(Sep 17 2021 at 22:15)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r711378582">PR review comment</a>:</p>
<blockquote>
<p>Ah, yes, this makes sense. Thanks for the nudge -- I re-read the issue and decided to merge #3329 to resolve the immediate regression on s390x (so this line now matches what's on <code>main</code>), and created a new issue to track the broader question of endianness in the interpreter.</p>
</blockquote>



<a name="253947339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253947339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253947339">(Sep 19 2021 at 14:02)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a> from <code>parser-i128</code> to <code>main</code>.</p>



<a name="253947410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253947410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253947410">(Sep 19 2021 at 14:04)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a> from <code>parser-i128</code> to <code>main</code>.</p>



<a name="253947734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253947734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253947734">(Sep 19 2021 at 14:08)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-758153710">PR review</a>.</p>



<a name="253947735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/253947735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#253947735">(Sep 19 2021 at 14:08)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r711750619">PR review comment</a>:</p>
<blockquote>
<p>I tried doing this as a generic function, but it was proving to be somewhat difficult, most of the functions that we need / could use are not in separate traits, but as functions associated with the primitive types. <code>FromStr</code> works, but <code>FromHex</code> doesen't exist. Casting between signed and unsigned types in a generic function, as far as I can tell  is a no go.</p>
<p>We could solve pretty much all of these problems by adding a dependency on the num crate, but I don't think this justifies it.</p>
<p>I've implemented this as a macro, hope that is ok.</p>
</blockquote>



<a name="254189455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/254189455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#254189455">(Sep 21 2021 at 11:12)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a>.</p>



<a name="254242503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/254242503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#254242503">(Sep 21 2021 at 17:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-760026630">PR review</a>.</p>



<a name="254242505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/254242505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#254242505">(Sep 21 2021 at 17:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#pullrequestreview-760026630">PR review</a>.</p>



<a name="254242507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/254242507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#254242507">(Sep 21 2021 at 17:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3351#discussion_r713246236">PR review comment</a>:</p>
<blockquote>
<p>Perfect, thank you!</p>
</blockquote>



<a name="254242527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233351%20cranelift%3A%20Add%20support%20for%20parsing%20i1.../near/254242527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233351.20cranelift.3A.20Add.20support.20for.20parsing.20i1.2E.2E.2E.html#254242527">(Sep 21 2021 at 17:04)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3351">PR #3351</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>