<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9505 x64: use `ByteSink` more liberally in... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html">wasmtime / PR #9505 x64: use `ByteSink` more liberally in...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="478593933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478593933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478593933">(Oct 23 2024 at 22:32)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>.</p>



<a name="478593934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478593934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478593934">(Oct 23 2024 at 22:32)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>.</p>



<a name="478593935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478593935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478593935">(Oct 23 2024 at 22:32)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a> from <code>abrown:more-byte-sink</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In looking at adding auto-generated assembler code to Cranelift, I've noticed that we pass <code>MachBuffer</code> down when it is not always necessary. The <code>ByteSink</code> trait (which <code>MachBuffer</code> implements) is a simplified view to <code>put*</code> bytes into the buffer and it is a bit simpler to use when testing since it is also implemented by <code>Vec&lt;u8&gt;</code>. This change propagates the trait to the <code>rex</code> module.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="478594160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594160">(Oct 23 2024 at 22:35)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#issuecomment-2433605553">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>:</p>
<blockquote>
<p>Similar to #9504, this is just an attempt at trying to simplify what is needed to actually assemble an instruction. We still need <code>MachBuffer</code> for instructions that touch memory; thinking about it, it may just be unavoidable.</p>
</blockquote>



<a name="478594283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594283">(Oct 23 2024 at 22:36)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#pullrequestreview-2390786284">PR review</a>.</p>



<a name="478594284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594284">(Oct 23 2024 at 22:36)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#discussion_r1813842957">PR review comment</a>:</p>
<blockquote>
<p>Oh, actually let me remove this: this is for the new assembler but isn't used yet.</p>
</blockquote>



<a name="478594358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594358">(Oct 23 2024 at 22:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>.</p>



<a name="478594541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594541">(Oct 23 2024 at 22:38)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#pullrequestreview-2390788966">PR review</a>.</p>



<a name="478594543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594543">(Oct 23 2024 at 22:38)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#discussion_r1813849607">PR review comment</a>:</p>
<blockquote>
<p>...and a little bit of code movement.</p>
</blockquote>



<a name="478594831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594831">(Oct 23 2024 at 22:41)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#pullrequestreview-2390791740">PR review</a>:</p>
<blockquote>
<p>This looks fine, thanks!</p>
<p>Re: handling <code>Amode</code>s and the helper that briefly appeared here: I think we'll need <code>MachBuffer</code> unavoidably once we have amodes that can refer to labels; that's the semantic thing that MachBuffer gives us above an arbitrary byte sequence. But totally fine to trim the close coupling at lower levels.</p>
<p>I'd love to talk more about the assembler design w.r.t. dependencies -- intuitively I would have thought that <code>MachBuffer</code> would be an integral part of it, i.e. it's the assembler's way of providing its output (given that assemblers need label references, and to flow through other metadata like trap info and relocs from insts to the code blob), but maybe there's another use-case or need for generalization I'm missing.</p>
</blockquote>



<a name="478594843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478594843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478594843">(Oct 23 2024 at 22:41)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>.</p>



<a name="478595491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478595491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478595491">(Oct 23 2024 at 22:48)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#issuecomment-2433668266">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>:</p>
<blockquote>
<blockquote>
<p>intuitively I would have thought that MachBuffer would be an integral part of it</p>
</blockquote>
<p>I mean, that's how it has to be today. I'm kind of wondering if it should, though: it's nice to be able to "just emit" an instruction into a byte buffer during testing and that's what I've been thinking about. The setup in <code>emit_tests.rs</code> just to be able to emit an instruction is a lot, e.g. If we're proptest-ing or fuzzing we also want the "emit a single instruction" path to be relatively quick.</p>
<p>On the other hand, sometimes its unavoidable: I've notice that we register traps and labels using a <code>MachBuffer</code> in the encoding logic and that simply cannot be done with <code>ByteSink</code>. Maybe <code>ByteSink</code> can gain extra trait functions that do nothing for the <code>Vec&lt;u8&gt;</code> case or something like that...</p>
</blockquote>



<a name="478595544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478595544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478595544">(Oct 23 2024 at 22:49)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#issuecomment-2433668266">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>:</p>
<blockquote>
<blockquote>
<p>intuitively I would have thought that MachBuffer would be an integral part of it</p>
</blockquote>
<p>I mean, that's how it has to be today. I'm kind of wondering if it should, though: it's nice to be able to "just emit" an instruction into a byte buffer during testing and that's what I've been thinking about. The setup in <code>emit_tests.rs</code> just to be able to emit an instruction is a lot, e.g. If we're proptest-ing or fuzzing we also want the "emit a single instruction" path to be relatively quick.</p>
<p>On the other hand, sometimes it _is_ unavoidable: I've notice that we register traps and labels using a <code>MachBuffer</code> in the encoding logic and that simply cannot be done with <code>ByteSink</code>. Maybe <code>ByteSink</code> can gain extra trait functions that do nothing for the <code>Vec&lt;u8&gt;</code> case or something like that...</p>
</blockquote>



<a name="478596553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478596553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478596553">(Oct 23 2024 at 23:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#issuecomment-2433698633">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>:</p>
<blockquote>
<blockquote>
<p>Maybe ByteSink can gain extra trait functions that do nothing for the Vec&lt;u8&gt; case or something like that...</p>
</blockquote>
<p>Ah! Yeah, that's an interesting idea: lift the whole interface of MachBuffer into a trait, and provide an implementation of that trait for a <code>Vec&lt;u8&gt;</code>.</p>
<p>There are interesting semantic implementations of this though when label references are involved: what <em>should</em> the assembled bytes from a <code>mov rax, [rip+label]</code> instruction be? Zeroes in the RIP offset (i.e. labels not resolved)? One aspect of the <code>MachBuffer</code> that is nice is that its types essentially force one to be aware one is referencing addresses in the buffer: you have to ask for a label to refer to it, the various amodes require a label, and if you don't bind it, (IIRC?) it should panic when finalizing.</p>
<p>Maybe another way of reading this friction is that we need some convenience APIs? It should be possible to write an <code>assemble(inst: Inst) -&gt; Vec&lt;u8&gt;</code> that is something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">assemble</span><span class="p">(</span><span class="n">inst</span><span class="p">:</span><span class="w"> </span><span class="nc">Inst</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MachBuffer</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">  </span><span class="n">inst</span><span class="p">.</span><span class="n">emit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">inst</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.);</span>
<span class="w">  </span><span class="n">buffer</span><span class="p">.</span><span class="n">finalize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">VCodeConstants</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ControlPlane</span><span class="p">::</span><span class="n">default</span><span class="p">()).</span><span class="n">apply_base_srcloc</span><span class="p">(</span><span class="n">SourceLoc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="n">data</span><span class="p">.</span><span class="n">into</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>(whew, that is a bit of a mouthful, I see why you want it!)</p>
</blockquote>



<a name="478596665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478596665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478596665">(Oct 23 2024 at 23:01)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/9505#issuecomment-2433698633">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>:</p>
<blockquote>
<blockquote>
<p>Maybe ByteSink can gain extra trait functions that do nothing for the Vec&lt;u8&gt; case or something like that...</p>
</blockquote>
<p>Ah! Yeah, that's an interesting idea: lift the whole interface of MachBuffer into a trait, and provide an implementation of that trait for a <code>Vec&lt;u8&gt;</code>.</p>
<p>There are interesting semantic implementations of this though when label references are involved: what <em>should</em> the assembled bytes from a <code>mov rax, [rip+label]</code> instruction be? Zeroes in the RIP offset (i.e. labels not resolved)? One aspect of the <code>MachBuffer</code> that is nice is that its types essentially force one to be aware one is referencing addresses in the buffer: you have to ask for a label to refer to it, the various amodes require a label, and if you don't bind it, (IIRC?) it should panic when finalizing.</p>
<p>Maybe another way of reading this friction is that we need some convenience APIs? It should be possible to write an <code>assemble(inst: Inst) -&gt; Vec&lt;u8&gt;</code> that is something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">assemble</span><span class="p">(</span><span class="n">inst</span><span class="p">:</span><span class="w"> </span><span class="nc">Inst</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MachBuffer</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">  </span><span class="n">inst</span><span class="p">.</span><span class="n">emit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.);</span>
<span class="w">  </span><span class="n">buffer</span><span class="p">.</span><span class="n">finalize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">VCodeConstants</span><span class="p">::</span><span class="n">default</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ControlPlane</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">apply_base_srcloc</span><span class="p">(</span><span class="n">SourceLoc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">data</span>
<span class="w">    </span><span class="p">.</span><span class="n">into</span><span class="p">()</span><span class="w"> </span><span class="c1">// SmallVec into Vec</span>
<span class="p">}</span>
</code></pre></div>
<p>(whew, that is a bit of a mouthful, I see why you want it!)</p>
</blockquote>



<a name="478596957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239505%20x64%3A%20use%20%60ByteSink%60%20more%20liberally%20in.../near/478596957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239505.20x64.3A.20use.20.60ByteSink.60.20more.20liberally.20in.2E.2E.2E.html#478596957">(Oct 23 2024 at 23:04)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9505">PR #9505</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>