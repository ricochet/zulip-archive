<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9947 Make module validation deterministic ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html">wasmtime / PR #9947 Make module validation deterministic ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="492491855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492491855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492491855">(Jan 08 2025 at 12:15)</a>:</h4>
<p><strong>michael-weigelt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>.</p>



<a name="492491856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492491856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492491856">(Jan 08 2025 at 12:15)</a>:</h4>
<p>michael-weigelt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a> from <code>michael-weigelt:mwe/deterministic_validation</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>If a Wasm binary is invalid in several ways, parallel compilation will return a non-deterministic result. We would like to get a deterministic result even in the presence of multiple errors. </p>
<p>This PR addresses that by first materializing all validation results and then returning the first error, if any ('first' with regard to the order of the input vector).</p>
<p>The downside is that we cannot return early when an error is encountered. This slows down the validation for invalid binaries. Since that is not the happy path anyway, I propose to accept the slowdown.  </p>
<p>The provided test does not prove determinism, which is hard to do. But it gives _some_ confidence and ensures the behaviour of parallel and sequential compilation do not deviate. </p>
</blockquote>



<a name="492491857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492491857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492491857">(Jan 08 2025 at 12:15)</a>:</h4>
<p><strong>michael-weigelt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>.</p>



<a name="492499351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492499351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492499351">(Jan 08 2025 at 12:59)</a>:</h4>
<p>michael-weigelt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>:</p>
<blockquote>
<p>If a Wasm binary is invalid in several ways, parallel compilation will return a non-deterministic result. We would like to get a deterministic result even in the presence of multiple errors. </p>
<p>This PR addresses that by first materializing all validation results and then returning the first error, if any ('first' with regard to the order of the input vector).</p>
<p>The downside is that we cannot return early when an error is encountered. This slows down the validation for invalid binaries. Since that is not the happy path anyway, I propose to accept the slowdown.  </p>
<p>The provided test does not prove determinism, which is hard to do. But it gives _some_ confidence and ensures the behaviours of parallel and sequential compilation do not deviate. </p>
</blockquote>



<a name="492529167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492529167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492529167">(Jan 08 2025 at 15:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9947#pullrequestreview-2537487536">PR review</a>:</p>
<blockquote>
<p>Thanks for this!</p>
</blockquote>



<a name="492555593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492555593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492555593">(Jan 08 2025 at 17:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9947#issuecomment-2578259204">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>:</p>
<blockquote>
<p>Ah the timeout there looks like the new <code>validate_deterministic</code> test is taking awhile in miri, so mind putting <code>#[cfg(not(miri))]</code> on the test?</p>
</blockquote>



<a name="492555661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492555661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492555661">(Jan 08 2025 at 17:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9947#issuecomment-2578259693">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>:</p>
<blockquote>
<p>er, actually, <code>#[cfg_attr(miri, ignore)]</code> would probably be better</p>
</blockquote>



<a name="492663214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492663214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492663214">(Jan 09 2025 at 08:37)</a>:</h4>
<p>michael-weigelt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>.</p>



<a name="492663714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492663714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492663714">(Jan 09 2025 at 08:40)</a>:</h4>
<p>michael-weigelt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>.</p>



<a name="492684770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492684770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492684770">(Jan 09 2025 at 10:22)</a>:</h4>
<p>michael-weigelt <a href="https://github.com/bytecodealliance/wasmtime/pull/9947#issuecomment-2579725426">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>:</p>
<blockquote>
<p>@alexcrichton done, and I made the test smaller too.</p>
</blockquote>



<a name="492759500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239947%20Make%20module%20validation%20deterministic%20.../near/492759500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239947.20Make.20module.20validation.20deterministic.20.2E.2E.2E.html#492759500">(Jan 09 2025 at 16:10)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9947">PR #9947</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>