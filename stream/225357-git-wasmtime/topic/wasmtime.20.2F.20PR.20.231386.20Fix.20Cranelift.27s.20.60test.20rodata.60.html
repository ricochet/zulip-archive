<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1386 Fix Cranelift&#x27;s `test rodata` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html">wasmtime / PR #1386 Fix Cranelift&#x27;s `test rodata`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="191546649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/191546649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#191546649">(Mar 23 2020 at 22:38)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1386" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1386">PR #1386</a> from <code>fix-rodata</code> to <code>master</code>:</p>
<blockquote>
<p>Previously <code>test rodata</code> would cause failures when compiling Cranelift IR that had assertions about the current sink offset (e.g. multiple blocks, see <code>emit_function</code> in <code>binemit/mod.rs</code>). This was because <code>RodataSink</code> was not keeping track of other emitted bytes--a692365 changes that.</p>
<p>Additionally, I started to worry that having jump tables and constants might cause issues with RIP-relative addressing. f1c698e adds two tests to show that there is no issue.</p>
</blockquote>



<a name="191546680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/191546680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#191546680">(Mar 23 2020 at 22:39)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr" target="_blank" title="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1386" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1386">PR #1386</a>.</p>



<a name="191546713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/191546713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#191546713">(Mar 23 2020 at 22:39)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1386" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1386">PR #1386</a> from <code>fix-rodata</code> to <code>master</code>:</p>
<blockquote>
<p>Previously <code>test rodata</code> would cause failures when compiling Cranelift IR that had assertions about the current sink offset (e.g. multiple blocks, see <code>emit_function</code> in <code>binemit/mod.rs</code>). This was because <code>RodataSink</code> was not keeping track of other emitted bytes; a692365 changes that.</p>
<p>Additionally, I started to worry that having jump tables and constants might cause issues with RIP-relative addressing. f1c698e adds two tests to show that there is no issue.</p>
</blockquote>



<a name="192267866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/192267866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#192267866">(Mar 30 2020 at 14:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1386#pullrequestreview-383942235" title="https://github.com/bytecodealliance/wasmtime/pull/1386#pullrequestreview-383942235">PR Review</a>.</p>



<a name="192267867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/192267867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#192267867">(Mar 30 2020 at 14:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1386#pullrequestreview-383942235" title="https://github.com/bytecodealliance/wasmtime/pull/1386#pullrequestreview-383942235">PR Review</a>.</p>



<a name="192267868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/192267868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#192267868">(Mar 30 2020 at 14:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1386#discussion_r400259810" title="https://github.com/bytecodealliance/wasmtime/pull/1386#discussion_r400259810">PR Review Comment</a>:</p>
<blockquote>
<p>Alternatively, what do you think of having the <code>RodataSink</code> struct have one more <code>usize</code> field called <code>offset</code>? It would be returned by this function, and it would need to be updated by the functions below to take into account the offset sizes. This would have the benefit of storing less bytes in the <code>emitted</code> vector, so it'd be more efficient and would make the tests run faster (no need for resizing, for instance).</p>
</blockquote>



<a name="192277911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/192277911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#192277911">(Mar 30 2020 at 16:06)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1386" title="https://github.com/bytecodealliance/wasmtime/pull/1386">PR #1386</a> from <code>fix-rodata</code> to <code>master</code>:</p>
<blockquote>
<p>Previously <code>test rodata</code> would cause failures when compiling Cranelift IR that had assertions about the current sink offset (e.g. multiple blocks, see <code>emit_function</code> in <code>binemit/mod.rs</code>). This was because <code>RodataSink</code> was not keeping track of other emitted bytes; a692365 changes that.</p>
<p>Additionally, I started to worry that having jump tables and constants might cause issues with RIP-relative addressing. f1c698e adds two tests to show that there is no issue.</p>
</blockquote>



<a name="192283602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231386%20Fix%20Cranelift%27s%20%60test%20rodata%60/near/192283602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231386.20Fix.20Cranelift.27s.20.60test.20rodata.60.html#192283602">(Mar 30 2020 at 16:48)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1386" title="https://github.com/bytecodealliance/wasmtime/pull/1386">PR #1386</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>