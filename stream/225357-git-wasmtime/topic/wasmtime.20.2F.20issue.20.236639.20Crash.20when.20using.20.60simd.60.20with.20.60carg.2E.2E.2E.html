<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6639 Crash when using `simd` with `carg... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236639.20Crash.20when.20using.20.60simd.60.20with.20.60carg.2E.2E.2E.html">wasmtime / issue #6639 Crash when using `simd` with `carg...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="369095468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236639%20Crash%20when%20using%20%60simd%60%20with%20%60carg.../near/369095468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236639.20Crash.20when.20using.20.60simd.60.20with.20.60carg.2E.2E.2E.html#369095468">(Jun 24 2023 at 07:19)</a>:</h4>
<p>ozgrakkurt opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6639">issue #6639</a>:</p>
<blockquote>
<p>Hello!</p>
<p>I am trying to test a library with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">"-C target-feature=+simd128"</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">nocapture</span>
</code></pre></div>
<p>But it crashes on runtime without any diagnostic info:<br>
<a href="https://github.com/ozgrakkurt/sbbf-rs/actions/runs/5363148176/jobs/9730524096?pr=4">https://github.com/ozgrakkurt/sbbf-rs/actions/runs/5363148176/jobs/9730524096?pr=4</a></p>
<p>It works without <code>simd</code> so I am thinking it is because of <code>simd</code>. I installed wasmtime and cargo-wasi via the recommended commands:</p>
<ul>
<li><code>curl https://wasmtime.dev/install.sh -sSf | bash</code></li>
<li><code>cargo install cargo-wasi</code></li>
</ul>
<p>and the file that uses simd intrinsics is here:<br>
<a href="https://github.com/ozgrakkurt/sbbf-rs/blob/4648a9c72ccf51c68ed8ee3dd610a0fa7f2b69de/src/arch/wasm.rs">https://github.com/ozgrakkurt/sbbf-rs/blob/4648a9c72ccf51c68ed8ee3dd610a0fa7f2b69de/src/arch/wasm.rs</a></p>
<p>Not sure if I am misusing something related to <code>simd</code> or if this is a bug</p>
</blockquote>



<a name="369163331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236639%20Crash%20when%20using%20%60simd%60%20with%20%60carg.../near/369163331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236639.20Crash.20when.20using.20.60simd.60.20with.20.60carg.2E.2E.2E.html#369163331">(Jun 24 2023 at 12:02)</a>:</h4>
<p>ozgrakkurt <a href="https://github.com/bytecodealliance/wasmtime/issues/6639#issuecomment-1605435026">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6639">issue #6639</a>:</p>
<blockquote>
<p>seems like the crash only happens when I run it locally on my <code>aarch64</code> pc, works on a PC with avx2 (github actions)</p>
</blockquote>



<a name="369163612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236639%20Crash%20when%20using%20%60simd%60%20with%20%60carg.../near/369163612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236639.20Crash.20when.20using.20.60simd.60.20with.20.60carg.2E.2E.2E.html#369163612">(Jun 24 2023 at 12:03)</a>:</h4>
<p>ozgrakkurt closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6639">issue #6639</a>:</p>
<blockquote>
<p>Hello!</p>
<p>I am trying to test a library with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUSTFLAGS</span><span class="o">=</span><span class="s">"-C target-feature=+simd128"</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">--</span><span class="n">nocapture</span>
</code></pre></div>
<p>But it crashes on runtime without any diagnostic info:<br>
<a href="https://github.com/ozgrakkurt/sbbf-rs/actions/runs/5363148176/jobs/9730524096?pr=4">https://github.com/ozgrakkurt/sbbf-rs/actions/runs/5363148176/jobs/9730524096?pr=4</a></p>
<p>It works without <code>simd</code> so I am thinking it is because of <code>simd</code>. I installed wasmtime and cargo-wasi via the recommended commands:</p>
<ul>
<li><code>curl https://wasmtime.dev/install.sh -sSf | bash</code></li>
<li><code>cargo install cargo-wasi</code></li>
</ul>
<p>and the file that uses simd intrinsics is here:<br>
<a href="https://github.com/ozgrakkurt/sbbf-rs/blob/4648a9c72ccf51c68ed8ee3dd610a0fa7f2b69de/src/arch/wasm.rs">https://github.com/ozgrakkurt/sbbf-rs/blob/4648a9c72ccf51c68ed8ee3dd610a0fa7f2b69de/src/arch/wasm.rs</a></p>
<p>Not sure if I am misusing something related to <code>simd</code> or if this is a bug</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>