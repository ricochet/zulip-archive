<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4989 Cleanup cranelift-frontend · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html">wasmtime / PR #4989 Cleanup cranelift-frontend</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="301720238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301720238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301720238">(Sep 30 2022 at 19:28)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4989">PR #4989</a>.</p>



<a name="301720239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301720239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301720239">(Sep 30 2022 at 19:28)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4989">PR #4989</a> from <code>cleanup-frontend</code> to <code>main</code>:</p>
<blockquote>
<p>This PR eliminates most of the per-block state tracked by the <code>frontend</code> module in cranelift-frontend. I think I can eliminate the last bits of state while preserving all the debug-assertions, but I want to think about that more.</p>
<p>I tried to keep the individual commits well-separated so it may be worth reviewing them individually.</p>
<p>This saves a tiny bit of memory allocations and traffic, according to DHAT, but has basically no impact on performance.</p>
</blockquote>



<a name="301729003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301729003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301729003">(Sep 30 2022 at 20:27)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127329717">PR review</a>.</p>



<a name="301732300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301732300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301732300">(Sep 30 2022 at 20:53)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984941664">PR review comment</a>:</p>
<blockquote>
<p>Saltwater uses this function. (and so does it fork crabwater that aims to revive saltwater).</p>
</blockquote>



<a name="301732301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301732301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301732301">(Sep 30 2022 at 20:53)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127351128">PR review</a>.</p>



<a name="301733024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301733024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301733024">(Sep 30 2022 at 20:58)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127356390">PR review</a>.</p>



<a name="301733352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301733352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301733352">(Sep 30 2022 at 21:01)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127358142">PR review</a>.</p>



<a name="301733353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301733353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301733353">(Sep 30 2022 at 21:01)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984946374">PR review comment</a>:</p>
<blockquote>
<p>I gather you mean <a href="https://github.com/nulla-git/crabwater/">https://github.com/nulla-git/crabwater/</a>? I didn't know that existed.</p>
</blockquote>



<a name="301734225"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301734225" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301734225">(Sep 30 2022 at 21:08)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127363470">PR review</a>.</p>



<a name="301734228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301734228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301734228">(Sep 30 2022 at 21:08)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984950037">PR review comment</a>:</p>
<blockquote>
<p>Yes</p>
</blockquote>



<a name="301734539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301734539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301734539">(Sep 30 2022 at 21:11)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127365252">PR review</a>.</p>



<a name="301734540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301734540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301734540">(Sep 30 2022 at 21:11)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984951367">PR review comment</a>:</p>
<blockquote>
<p>After discussion with Chris, I'm going to merge this despite that breakage. For anyone who's using this API, I'd be happy to help with migrating to something else after a discussion about what they actually need from it.</p>
</blockquote>



<a name="301734588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301734588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301734588">(Sep 30 2022 at 21:11)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4989">PR #4989</a>.</p>



<a name="301735802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301735802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301735802">(Sep 30 2022 at 21:21)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127372233">PR review</a>.</p>



<a name="301735803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301735803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301735803">(Sep 30 2022 at 21:21)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984956309">PR review comment</a>:</p>
<blockquote>
<p>More specifically, to give some reasoning for this:</p>
<ul>
<li>We don't guarantee stability of Cranelift APIs between releases (each release is a semver break, and we haven't declared any sort of long-term stability guarantee generally);</li>
<li>Thus, it's <em>technically</em> allowed to alter APIs arbitrarily;</li>
<li>All the same, we want to minimize churn, as it's definitely in the project's interest to bring users along to new versions with minimal work. So we should have a reason to remove or alter APIs;</li>
<li>In this case, @jameysharp 's reasoning (with which I think I agree) is that the function just seems a bit redundant or unnecessary: it lets the user query whether they have already added instructions, but it seems better either for the user to know that directly, or (possibly) to get that via more general IR introspection.</li>
</ul>
<p>So on balance, I think this API cleanup makes sense, but we also don't want to cause arbitrary and unfixable breakage so please do let us know (anyone) if there are compatibility concerns we can try to address some other way.</p>
</blockquote>



<a name="301747361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301747361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301747361">(Sep 30 2022 at 22:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#pullrequestreview-1127419429">PR review</a>.</p>



<a name="301747362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234989%20Cleanup%20cranelift-frontend/near/301747362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234989.20Cleanup.20cranelift-frontend.html#301747362">(Sep 30 2022 at 22:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4989#discussion_r984991848">PR review comment</a>:</p>
<blockquote>
<p>(also, is no one else chuckling about the puns in all these names?!)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>