<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3094 Cranelift CLIF Fuzzer generate blo... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html">wasmtime / issue #3094 Cranelift CLIF Fuzzer generate blo...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="246373099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/246373099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#246373099">(Jul 18 2021 at 11:36)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-882043023">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>This currently quickly crashes in the verify fuzzer with a out of memory error.</p>
<p>This crash is reproducible with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s">"JyEEAf8B/ydxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAAAQgAAAAAAAAAAAAAAvARAAAIAAAClAAAnAAA="</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
<span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
</code></pre></div>
<p>Here's what the <code>FunctionBuilder</code> looks like before calling <code>seal_all_blocks</code> (which is where this crashes):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v5</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v13</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v14</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v17</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block3</span><span class="p">(</span><span class="n">v18</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span><span class="p">(</span><span class="n">v20</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ugt</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block3</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v22</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v23</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ule</span><span class="w"> </span><span class="n">v23</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This input doesn't look unreasonable to me? None of the blocks have a <code>return</code>, but do we need to guarantee a return is present?</p>
<p>I just noticed now that 2 of the <code>jump</code>'s provide no args to their target blocks, but we definitely pass them in in the instruction inserter. Is this because we picked a non local variable?</p>
<p>Here is the output of <code>cargo-fuzz</code>:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="o">-</span><span class="n">artifact_prefix</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="w"> </span><span class="n">ar</span><span class="w"></span>
<span class="n">tifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="err">`</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">1365534722</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195415718a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56195418d3e5</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195418d3e8</span><span class="p">,</span><span class="mh">0x5619544ef998</span><span class="p">),</span><span class="w"></span>
<span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span>: <span class="nc">Running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">each</span><span class="p">.</span><span class="w"></span>
<span class="n">Running</span>: <span class="nc">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="w"></span>
<span class="o">==</span><span class="mi">2822</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">used</span>: <span class="mi">2093</span><span class="n">Mb</span><span class="p">;</span><span class="w"> </span><span class="n">limit</span>: <span class="mi">2048</span><span class="n">Mb</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">To</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">rss_limit_mb</span><span class="o">=&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>

<span class="n">Live</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="n">Allocations</span>: <span class="mi">2037467893</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">quarantined</span>: <span class="mi">32</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="mi">8736</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">chunks</span>: <span class="mi">8791</span><span class="p">;</span><span class="w"> </span><span class="n">showing</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="n">contexts</span><span class="p">)</span><span class="w"></span>
<span class="mi">2013265920</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">allocation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x5619523a36a9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">realloc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_malloc_linux</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">164</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56195247a6e4</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">finish_grow</span>::<span class="n">h45ef09ff8efa3011</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8aa6e4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5619522ca86f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">RawVec</span><span class="cp">$LT$T$C$A$GT$</span>::<span class="n">reserve</span>::<span class="n">do_reserve_and_handle</span>::<span class="n">h10ad7ae98da66681</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x6f</span><span class="w"></span>
<span class="n">a86f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5619524aae90</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">use_var_nonlocal</span>::<span class="n">hfb5d4209dbff3efc</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dae90</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5619524b0cba</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">run_state_machine</span>::<span class="n">h4be05d0025ad2762</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8e0cba</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5619524ac4dd</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">seal_one_block</span>::<span class="n">h0168f5ef0239babb</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dc4dd</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56195249e736</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">frontend</span>::<span class="n">FunctionBuilder</span>::<span class="n">seal_all_blocks</span>::<span class="n">h80281c0fe53cdd5a</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8ce736</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x56195244447c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_fuzzgen</span>::<span class="n">function_generator</span>::<span class="n">FunctionGenerator</span>::<span class="n">generate</span>::<span class="n">h960858ee4bfd5fd6</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x874</span><span class="w"></span>
<span class="mi">47</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5619524451be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_</span><span class="cp">$LT$cranelift_fuzzgen</span><span class="o">..</span><span class="n">TestCase</span><span class="cp">$u20$as$u20$arbitrary</span><span class="o">..</span><span class="n">Arbitrary</span><span class="cp">$GT$</span>::<span class="n">arbitrary</span>::<span class="n">h8ffee5eb12788765</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="w"></span>
<span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8751be</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5619523ec5c7</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x81c5c7</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x561953b286d0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f586d0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x561953b27e5f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f57e5f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x561953b2b5fc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f5b5fc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x561953b3ba29</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f6ba29</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x561953b45222</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f7522</span><span class="w"></span>
<span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x561952327786</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x757786</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x7f7187be50b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/../</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>

<span class="n">SUMMARY</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">71</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="246373178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/246373178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#246373178">(Jul 18 2021 at 11:38)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-882043023">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>This currently quickly crashes in the verify fuzzer with a out of memory error.</p>
<p>This crash is reproducible with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s">"JyEEAf8B/ydxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAAAQgAAAAAAAAAAAAAAvARAAAIAAAClAAAnAAA="</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
<span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
</code></pre></div>
<p>Here's what the <code>FunctionBuilder</code> looks like before calling <code>seal_all_blocks</code> (which is where this crashes):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v5</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v13</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v14</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v17</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block3</span><span class="p">(</span><span class="n">v18</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span><span class="p">(</span><span class="n">v20</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ugt</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block3</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v22</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v23</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ule</span><span class="w"> </span><span class="n">v23</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This input doesn't look unreasonable to me. None of the blocks have a <code>return</code>, but do we need to guarantee a <code>return</code> is present?</p>
<p>I just noticed now that 2 of the <code>jump</code>'s provide no args to their target blocks, but we definitely pass them in in the instruction inserter. Is this because we picked a non local variable?</p>
<p>Here is the output of <code>cargo-fuzz</code>:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="o">-</span><span class="n">artifact_prefix</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="w"> </span><span class="n">ar</span><span class="w"></span>
<span class="n">tifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="err">`</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">1365534722</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195415718a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56195418d3e5</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195418d3e8</span><span class="p">,</span><span class="mh">0x5619544ef998</span><span class="p">),</span><span class="w"></span>
<span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span>: <span class="nc">Running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">each</span><span class="p">.</span><span class="w"></span>
<span class="n">Running</span>: <span class="nc">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="w"></span>
<span class="o">==</span><span class="mi">2822</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">used</span>: <span class="mi">2093</span><span class="n">Mb</span><span class="p">;</span><span class="w"> </span><span class="n">limit</span>: <span class="mi">2048</span><span class="n">Mb</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">To</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">rss_limit_mb</span><span class="o">=&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>

<span class="n">Live</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="n">Allocations</span>: <span class="mi">2037467893</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">quarantined</span>: <span class="mi">32</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="mi">8736</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">chunks</span>: <span class="mi">8791</span><span class="p">;</span><span class="w"> </span><span class="n">showing</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="n">contexts</span><span class="p">)</span><span class="w"></span>
<span class="mi">2013265920</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">allocation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x5619523a36a9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">realloc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_malloc_linux</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">164</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56195247a6e4</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">finish_grow</span>::<span class="n">h45ef09ff8efa3011</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8aa6e4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5619522ca86f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">RawVec</span><span class="cp">$LT$T$C$A$GT$</span>::<span class="n">reserve</span>::<span class="n">do_reserve_and_handle</span>::<span class="n">h10ad7ae98da66681</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x6f</span><span class="w"></span>
<span class="n">a86f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5619524aae90</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">use_var_nonlocal</span>::<span class="n">hfb5d4209dbff3efc</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dae90</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5619524b0cba</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">run_state_machine</span>::<span class="n">h4be05d0025ad2762</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8e0cba</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5619524ac4dd</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">seal_one_block</span>::<span class="n">h0168f5ef0239babb</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dc4dd</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56195249e736</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">frontend</span>::<span class="n">FunctionBuilder</span>::<span class="n">seal_all_blocks</span>::<span class="n">h80281c0fe53cdd5a</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8ce736</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x56195244447c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_fuzzgen</span>::<span class="n">function_generator</span>::<span class="n">FunctionGenerator</span>::<span class="n">generate</span>::<span class="n">h960858ee4bfd5fd6</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x874</span><span class="w"></span>
<span class="mi">47</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5619524451be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_</span><span class="cp">$LT$cranelift_fuzzgen</span><span class="o">..</span><span class="n">TestCase</span><span class="cp">$u20$as$u20$arbitrary</span><span class="o">..</span><span class="n">Arbitrary</span><span class="cp">$GT$</span>::<span class="n">arbitrary</span>::<span class="n">h8ffee5eb12788765</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="w"></span>
<span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8751be</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5619523ec5c7</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x81c5c7</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x561953b286d0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f586d0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x561953b27e5f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f57e5f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x561953b2b5fc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f5b5fc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x561953b3ba29</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f6ba29</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x561953b45222</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f7522</span><span class="w"></span>
<span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x561952327786</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x757786</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x7f7187be50b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/../</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>

<span class="n">SUMMARY</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">71</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="246373773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/246373773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#246373773">(Jul 18 2021 at 11:56)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-882045287">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:aarch64", "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="246833541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/246833541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#246833541">(Jul 22 2021 at 11:13)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-882043023">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>This currently quickly crashes in the verify fuzzer with a out of memory error.</p>
<p>This crash is reproducible with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s">"JyEEAf8B/ydxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAAAQgAAAAAAAAAAAAAAvARAAAIAAAClAAAnAAA="</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
<span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
</code></pre></div>
<p>Here's what the <code>FunctionBuilder</code> looks like before calling <code>seal_all_blocks</code> (which is where this crashes):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v5</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v13</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v14</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v17</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block3</span><span class="p">(</span><span class="n">v18</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span><span class="p">(</span><span class="n">v20</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ugt</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block3</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v22</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v23</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ule</span><span class="w"> </span><span class="n">v23</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This input doesn't look unreasonable to me. None of the blocks have a <code>return</code>, but do we need to guarantee a <code>return</code> is present?</p>
<p>I just noticed now that 2 of the <code>jump</code>'s provide no args to their target blocks, but we definitely pass them in in the instruction inserter. Is this because we picked a non local variable?</p>
<p>Here is the output of <code>cargo-fuzz</code>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="o">-</span><span class="n">artifact_prefix</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="w"> </span><span class="n">ar</span><span class="w"></span>
<span class="n">tifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="err">`</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">1365534722</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195415718a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56195418d3e5</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195418d3e8</span><span class="p">,</span><span class="mh">0x5619544ef998</span><span class="p">),</span><span class="w"></span>
<span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span>: <span class="nc">Running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">each</span><span class="p">.</span><span class="w"></span>
<span class="n">Running</span>: <span class="nc">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="w"></span>
<span class="o">==</span><span class="mi">2822</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">used</span>: <span class="mi">2093</span><span class="n">Mb</span><span class="p">;</span><span class="w"> </span><span class="n">limit</span>: <span class="mi">2048</span><span class="n">Mb</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">To</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">rss_limit_mb</span><span class="o">=&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>

<span class="n">Live</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="n">Allocations</span>: <span class="mi">2037467893</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">quarantined</span>: <span class="mi">32</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="mi">8736</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">chunks</span>: <span class="mi">8791</span><span class="p">;</span><span class="w"> </span><span class="n">showing</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="n">contexts</span><span class="p">)</span><span class="w"></span>
<span class="mi">2013265920</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">allocation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x5619523a36a9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">realloc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_malloc_linux</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">164</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56195247a6e4</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">finish_grow</span>::<span class="n">h45ef09ff8efa3011</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8aa6e4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5619522ca86f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">RawVec</span><span class="cp">$LT$T$C$A$GT$</span>::<span class="n">reserve</span>::<span class="n">do_reserve_and_handle</span>::<span class="n">h10ad7ae98da66681</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x6f</span><span class="w"></span>
<span class="n">a86f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5619524aae90</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">use_var_nonlocal</span>::<span class="n">hfb5d4209dbff3efc</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dae90</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5619524b0cba</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">run_state_machine</span>::<span class="n">h4be05d0025ad2762</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8e0cba</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5619524ac4dd</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">seal_one_block</span>::<span class="n">h0168f5ef0239babb</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dc4dd</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56195249e736</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">frontend</span>::<span class="n">FunctionBuilder</span>::<span class="n">seal_all_blocks</span>::<span class="n">h80281c0fe53cdd5a</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8ce736</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x56195244447c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_fuzzgen</span>::<span class="n">function_generator</span>::<span class="n">FunctionGenerator</span>::<span class="n">generate</span>::<span class="n">h960858ee4bfd5fd6</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x874</span><span class="w"></span>
<span class="mi">47</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5619524451be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_</span><span class="cp">$LT$cranelift_fuzzgen</span><span class="o">..</span><span class="n">TestCase</span><span class="cp">$u20$as$u20$arbitrary</span><span class="o">..</span><span class="n">Arbitrary</span><span class="cp">$GT$</span>::<span class="n">arbitrary</span>::<span class="n">h8ffee5eb12788765</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="w"></span>
<span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8751be</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5619523ec5c7</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x81c5c7</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x561953b286d0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f586d0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x561953b27e5f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f57e5f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x561953b2b5fc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f5b5fc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x561953b3ba29</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f6ba29</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x561953b45222</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f7522</span><span class="w"></span>
<span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x561952327786</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x757786</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x7f7187be50b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/../</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>

<span class="n">SUMMARY</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">71</span><span class="w"></span>
</code></pre></div>
<p>Edit: This is a verify only error, the regular fuzzer (<code>cranelift-fuzzgen</code>) runs normally</p>
</blockquote>



<a name="246838667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/246838667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#246838667">(Jul 22 2021 at 12:19)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-882043023">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>This currently quickly crashes in the verify fuzzer with a out of memory error.</p>
<p>This crash is reproducible with:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s">"JyEEAf8B/ydxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAAAQgAAAAAAAAAAAAAAvARAAAIAAAClAAAnAAA="</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
<span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">fuzz</span><span class="o">-</span><span class="n">input</span><span class="w"></span>
</code></pre></div>
<p>Here's what the <code>FunctionBuilder</code> looks like before calling <code>seal_all_blocks</code> (which is where this crashes):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v5</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v13</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v14</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">v16</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">,</span><span class="w"> </span><span class="n">v15</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v17</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">v17</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block3</span><span class="p">(</span><span class="n">v18</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">eq</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">v19</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">,</span><span class="w"> </span><span class="n">v18</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span><span class="p">(</span><span class="n">v20</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ugt</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">v21</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">,</span><span class="w"> </span><span class="n">v20</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block3</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v22</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v23</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span>: <span class="kt">i8</span><span class="p">)</span>:
    <span class="nc">br_icmp</span><span class="w"> </span><span class="n">ule</span><span class="w"> </span><span class="n">v23</span><span class="p">,</span><span class="w"> </span><span class="n">v24</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This input doesn't look unreasonable to me. None of the blocks have a <code>return</code>, but do we need to guarantee a <code>return</code> is present?</p>
<p>I just noticed now that 2 of the <code>jump</code>'s provide no args to their target blocks, but we definitely pass them in in the instruction inserter. Is this because we picked a non local variable?</p>
<p>Here is the output of <code>cargo-fuzz</code>:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="w"> </span><span class="o">-</span><span class="n">artifact_prefix</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="w"> </span><span class="n">ar</span><span class="w"></span>
<span class="n">tifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="err">`</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">1365534722</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195415718a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56195418d3e5</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">221787</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">221787</span><span class="w"> </span><span class="p">[</span><span class="mh">0x56195418d3e8</span><span class="p">,</span><span class="mh">0x5619544ef998</span><span class="p">),</span><span class="w"></span>
<span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span>: <span class="nc">Running</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">each</span><span class="p">.</span><span class="w"></span>
<span class="n">Running</span>: <span class="nc">artifacts</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">/</span><span class="n">oom</span><span class="o">-</span><span class="n">a8aef5b7b1e8d020aae51e6d3dedc9418b04dd99</span><span class="w"></span>
<span class="o">==</span><span class="mi">2822</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">used</span>: <span class="mi">2093</span><span class="n">Mb</span><span class="p">;</span><span class="w"> </span><span class="n">limit</span>: <span class="mi">2048</span><span class="n">Mb</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">To</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">rss_limit_mb</span><span class="o">=&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"></span>

<span class="n">Live</span><span class="w"> </span><span class="n">Heap</span><span class="w"> </span><span class="n">Allocations</span>: <span class="mi">2037467893</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">quarantined</span>: <span class="mi">32</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="mi">8736</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">chunks</span><span class="p">;</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">chunks</span>: <span class="mi">8791</span><span class="p">;</span><span class="w"> </span><span class="n">showing</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">95</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">unique</span><span class="w"> </span><span class="n">contexts</span><span class="p">)</span><span class="w"></span>
<span class="mi">2013265920</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">98</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">allocation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x5619523a36a9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">realloc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_malloc_linux</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">164</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56195247a6e4</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">finish_grow</span>::<span class="n">h45ef09ff8efa3011</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8aa6e4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5619522ca86f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">alloc</span>::<span class="n">raw_vec</span>::<span class="n">RawVec</span><span class="cp">$LT$T$C$A$GT$</span>::<span class="n">reserve</span>::<span class="n">do_reserve_and_handle</span>::<span class="n">h10ad7ae98da66681</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x6f</span><span class="w"></span>
<span class="n">a86f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5619524aae90</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">use_var_nonlocal</span>::<span class="n">hfb5d4209dbff3efc</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dae90</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5619524b0cba</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">run_state_machine</span>::<span class="n">h4be05d0025ad2762</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8e0cba</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5619524ac4dd</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">ssa</span>::<span class="n">SSABuilder</span>::<span class="n">seal_one_block</span>::<span class="n">h0168f5ef0239babb</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8dc4dd</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56195249e736</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_frontend</span>::<span class="n">frontend</span>::<span class="n">FunctionBuilder</span>::<span class="n">seal_all_blocks</span>::<span class="n">h80281c0fe53cdd5a</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8ce736</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x56195244447c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cranelift_fuzzgen</span>::<span class="n">function_generator</span>::<span class="n">FunctionGenerator</span>::<span class="n">generate</span>::<span class="n">h960858ee4bfd5fd6</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x874</span><span class="w"></span>
<span class="mi">47</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5619524451be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_</span><span class="cp">$LT$cranelift_fuzzgen</span><span class="o">..</span><span class="n">TestCase</span><span class="cp">$u20$as$u20$arbitrary</span><span class="o">..</span><span class="n">Arbitrary</span><span class="cp">$GT$</span>::<span class="n">arbitrary</span>::<span class="n">h8ffee5eb12788765</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="w"></span>
<span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x8751be</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5619523ec5c7</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x81c5c7</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x561953b286d0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f586d0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x561953b27e5f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f57e5f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x561953b2b5fc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f5b5fc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x561953b3ba29</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f6ba29</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x561953b45222</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x1f7522</span><span class="w"></span>
<span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x561952327786</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">Afonso</span><span class="o">/</span><span class="n">CLionProjects</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="o">+</span><span class="mh">0x757786</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x7f7187be50b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/../</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>

<span class="n">SUMMARY</span>: <span class="nc">libFuzzer</span>: <span class="nc">out</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">memory</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">71</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="247267134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247267134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247267134">(Jul 26 2021 at 21:37)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-887044945">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<blockquote>
<p>but do we need to guarantee a <code>return</code> is present?</p>
</blockquote>
<p>Nope, a function that does not terminate (loops infinitely) is legal CLIF, though of course that should hit the timeout mechanism you've added to the interpreter.</p>
<blockquote>
<p>Live Heap Allocations: 2037467893 bytes in 54 chunks; quarantined: 32 bytes in 1 chunks; 8736 other chunks; total chunks: 8791; showing top 95% (at most 8 unique contexts)</p>
</blockquote>
<p>This looks like uncontrolled <code>Vec</code> growth in the SSA-builder frontend; either the predecessor-block mechanism or the variable tracking. Possibly the way in which blocks are sealed is incorrect, though I haven't looked closely at the details here yet. Are you able to dig a bit more and e.g. add some tracing logging to the algorithm to see what's going wrong?</p>
</blockquote>



<a name="247847582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247847582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247847582">(Aug 01 2021 at 08:24)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
</blockquote>



<a name="247848246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247848246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247848246">(Aug 01 2021 at 08:43)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p>Edit: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code>, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors looking causing the infinite loop.</p>
<p>So this is an issue with marking predecessors.</p>
</blockquote>



<a name="247848250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247848250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247848250">(Aug 01 2021 at 08:43)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code>, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors looking causing the infinite loop.</p>
<p>So this is an issue with marking predecessors.</p>
</blockquote>



<a name="247848390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247848390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247848390">(Aug 01 2021 at 08:47)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code>, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>So this is an issue with marking predecessors.</p>
</blockquote>



<a name="247848432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247848432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247848432">(Aug 01 2021 at 08:48)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code> which should be ok, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>So this is an issue with marking predecessors.</p>
</blockquote>



<a name="247849583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247849583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247849583">(Aug 01 2021 at 09:20)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code> which should be ok, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>Looking at the code, <code>block2</code> is indeed the only predecessor to <code>block2</code>, and I assume that we want to mark a block as its own predecessor if it jumps to itself.</p>
<p>So, should we stop the lookup in <code>use_var_nonlocal</code> if we are trying to lookup ourselves again? (seems reasonable to me)<br>
However this also brings another issue, which is: <code>block2</code> is unreachable from <code>block0</code>, we never actually jump to it, so we are never going to find the definition of variable 3.</p>
</blockquote>



<a name="247849590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247849590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247849590">(Aug 01 2021 at 09:20)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code> which should be ok, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>Looking at the code, <code>block2</code> is indeed the only predecessor to <code>block2</code>, and I assume that we want to mark a block as its own predecessor if it jumps to itself.</p>
<p>So, should we stop the lookup in <code>use_var_nonlocal</code> if we are trying to lookup ourselves again? (seems reasonable to me)</p>
<p>However this also brings up another issue, which is: <code>block2</code> is unreachable from <code>block0</code>, we never actually jump to it, so we are never going to find the definition of variable 3.</p>
</blockquote>



<a name="247849821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247849821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247849821">(Aug 01 2021 at 09:26)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code> which should be ok, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>Looking at the code, <code>block2</code> is indeed the only predecessor to <code>block2</code>, and I assume that we want to mark a block as its own predecessor if it jumps to itself.</p>
<p>So, should we stop the lookup in <code>use_var_nonlocal</code> if we are trying to lookup ourselves again? (seems reasonable to me)</p>
<p>This also brings up another issue, which is: <code>block2</code> and <code>block5</code> are unreachable from <code>block0</code>, we never actually jump to either of them, so we are never going to find the definition of variable 3 in their predecessors.</p>
</blockquote>



<a name="247850119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/247850119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#247850119">(Aug 01 2021 at 09:34)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-890475549">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>Hey, </p>
<p>Had a busy week and couldn't really look at this until today. I think this is what is going on, but I tried to build a minimized test demonstrating this behaviour and couldn't reproduce it.</p>
<p>It looks like there are 2 blocks that are important here <code>block5</code> and <code>block2</code>.</p>
<p>The infinite loop happens after calling <code>begin_predecessors_lookup</code> for <code>block5</code>, which from my understanding is trying to look for a definition for variable 3 in <code>block2</code>, but we don't use varable 3 in <code>block2</code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w"></span>

<span class="n">Block</span>: <span class="nc">block5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">signature</span>: <span class="p">[]</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v22</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v23</span><span class="p">)</span><span class="w"></span>
<span class="n">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">I8</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">Unsealed</span><span class="p">(</span><span class="n">v24</span><span class="p">)</span><span class="w"></span>

<span class="o">..</span><span class="p">.</span><span class="w"></span>

<span class="n">begin_predecessors_lookup</span>: <span class="nc">sentinel</span>: <span class="nc">v22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">dest_block</span>: <span class="nc">block5</span><span class="w"></span>
<span class="w">    </span><span class="n">begin_predecessors_lookup</span>: <span class="nc">calls</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>

<span class="n">run_state_machine</span>: <span class="nc">processing</span><span class="w"> </span><span class="n">call</span>: <span class="nc">UseVar</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">run_state_machine</span>: <span class="nc">call</span><span class="w"> </span><span class="n">queue</span>: <span class="p">[</span><span class="n">FinishPredecessorsLookup</span><span class="p">(</span><span class="n">v22</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">),</span><span class="w"> </span><span class="n">FinishSealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="n">var_defs</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ssa_block</span>: <span class="nc">block2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">blockindex</span>: <span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SecondaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="nb">Some</span><span class="p">(</span><span class="n">v3</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v15</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v18</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v20</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">v22</span><span class="p">)],</span><span class="w"> </span><span class="n">default</span>: <span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">var_defs</span><span class="p">[</span><span class="n">ssa_block</span><span class="p">]</span>: <span class="nb">None</span>
<span class="nc">use_var_nonlocal</span>: <span class="nc">var</span>: <span class="nc">Variable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">  </span><span class="n">ty</span>: <span class="nc">types</span>::<span class="n">B1</span><span class="w">   </span><span class="n">block</span>: <span class="nc">block2</span><span class="w"></span>
<span class="w">    </span><span class="n">use_var_nonlocal</span>: <span class="nc">case</span>: <span class="nc">SealedOnePredecessor</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>This then repeats forever increasing the <code>FinishSealedOnePredecessor(block2)</code> cases in the call queue, which is what causes the uncontrollable vec growth.</p>
<p>I've pushed the log calls into a separate commit.</p>
<p><strong>Edit</strong>: Had some further progress here.</p>
<p>We are indeed looking for variable 3 in <code>block2</code> which should be ok, but that's not what is causing the issue. The issue is happening because <code>block2</code> only has one predecessor which is <code>block2</code>, so we keep recursing through its predecessors causing the infinite loop.</p>
<p>Looking at the code, <code>block2</code> is indeed the only predecessor to <code>block2</code>, and I assume that we want to mark a block as its own predecessor if it jumps to itself.</p>
<p>So, should we stop the lookup in <code>use_var_nonlocal</code> if we are trying to lookup ourselves again? (seems reasonable to me)</p>
<p>This also brings up another issue, which is: <code>block2</code> and <code>block5</code> are unreachable from <code>block0</code>, we never actually jump to either of them, so we are never going to find the definition of variable 3 in their predecessors.</p>
<p>If I understand the <a href="https://link.springer.com/content/pdf/10.1007/978-3-642-37051-9_6.pdf">paper</a> correctly, they deal with this in Algorithm 3 by DCE'ing these blocks?</p>
</blockquote>



<a name="248669033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/248669033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#248669033">(Aug 06 2021 at 21:11)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-894520499">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<blockquote>
<p>Looking at the code, block2 is indeed the only predecessor to block2, and I assume that we want to mark a block as its own predecessor if it jumps to itself.</p>
<p>So, should we stop the lookup in use_var_nonlocal if we are trying to lookup ourselves again? (seems reasonable to me)</p>
</blockquote>
<p>Ah -- yes, we need to handle the self-predecessor case specially here, I think. This likely never came up before because the Wasm translator will not generate code of that form.</p>
<blockquote>
<p>This also brings up another issue, which is: block2 and block5 are unreachable from block0, we never actually jump to either of them, so we are never going to find the definition of variable 3 in their predecessors.</p>
<p>If I understand the paper correctly, they deal with this in Algorithm 3 by DCE'ing these blocks?</p>
</blockquote>
<p>Yes, it looks like they replace any phi whose only input is itself with <code>undef</code>; this makes sense as such a phi could only occur in an unreachable infinite loop (otherwise the loop entry would have to feed into the phi too).</p>
<p>Unreachable code can create all sorts of interesting edge cases in analyses. As one design point, in the regalloc2 fuzzer I took care to only generate reachable blocks in CFGs by construction, and require that for all input code; but I don't think it makes as much sense to create such a mandate in a general-purpose compiler, as it imposes too much on the IR producer. The upshot is that fuzzing like this will certainly expose our unreachable-code-related bugs, so thank you :-)</p>
</blockquote>



<a name="251910472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/251910472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#251910472">(Sep 03 2021 at 16:53)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-912676075">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>@cfallin I can't request a review on GH, but I think with #3258 merged we can start review this.</p>
</blockquote>



<a name="251910543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233094%20Cranelift%20CLIF%20Fuzzer%20generate%20blo.../near/251910543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233094.20Cranelift.20CLIF.20Fuzzer.20generate.20blo.2E.2E.2E.html#251910543">(Sep 03 2021 at 16:53)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3094#issuecomment-912676075">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3094">issue #3094</a>:</p>
<blockquote>
<p>@cfallin I can't request a review on GH, but I think with #3258 merged we can start a review on this.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>