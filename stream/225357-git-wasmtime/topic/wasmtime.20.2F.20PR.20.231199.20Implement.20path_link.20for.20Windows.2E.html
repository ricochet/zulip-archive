<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1199 Implement path_link for Windows. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html">wasmtime / PR #1199 Implement path_link for Windows.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="189693906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189693906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189693906">(Mar 04 2020 at 14:13)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189694960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189694960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189694960">(Mar 04 2020 at 14:22)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189705419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189705419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189705419">(Mar 04 2020 at 16:03)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189712741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189712741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189712741">(Mar 04 2020 at 17:12)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189728199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189728199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189728199">(Mar 04 2020 at 19:52)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369075419" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369075419">PR Review</a>.</p>



<a name="189728200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189728200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189728200">(Mar 04 2020 at 19:52)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387897968" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387897968">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be <code>test_path_link_nonstrict</code> for convention's sake?</p>
</blockquote>



<a name="189732086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189732086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189732086">(Mar 04 2020 at 20:32)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189732226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189732226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189732226">(Mar 04 2020 at 20:34)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189735806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189735806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189735806">(Mar 04 2020 at 21:17)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369127518" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369127518">PR Review</a>.</p>



<a name="189735808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189735808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189735808">(Mar 04 2020 at 21:17)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387939204" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387939204">PR Review Comment</a>:</p>
<blockquote>
<p>This looks like a good choice of errno value here, but I'd like @sunfishcode to double check that though.</p>
</blockquote>



<a name="189735809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189735809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189735809">(Mar 04 2020 at 21:17)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369127518" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-369127518">PR Review</a>.</p>



<a name="189735811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189735811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189735811">(Mar 04 2020 at 21:17)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387938245" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r387938245">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, I think I'd prefer if we had two versions of the testcase, not necessarily overlapping in any way, but such that the "strict" tests are executed only on supported *nix platform, while the rest always executes the "nonstrict" set.</p>
</blockquote>



<a name="189877051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189877051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189877051">(Mar 06 2020 at 09:52)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189878513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189878513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189878513">(Mar 06 2020 at 10:14)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189878609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189878609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189878609">(Mar 06 2020 at 10:16)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189878963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189878963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189878963">(Mar 06 2020 at 10:23)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="189879307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/189879307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#189879307">(Mar 06 2020 at 10:28)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="190083544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190083544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190083544">(Mar 09 2020 at 15:49)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
</blockquote>



<a name="190273224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190273224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190273224">(Mar 11 2020 at 11:55)</a>:</h4>
<p>marmistrz edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190421168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190421168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190421168">(Mar 12 2020 at 17:46)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190484727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190484727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190484727">(Mar 13 2020 at 09:28)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190486081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190486081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190486081">(Mar 13 2020 at 09:46)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190488613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190488613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190488613">(Mar 13 2020 at 10:27)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190489033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190489033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190489033">(Mar 13 2020 at 10:34)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190489299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190489299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190489299">(Mar 13 2020 at 10:38)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190490593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190490593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190490593">(Mar 13 2020 at 10:58)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190553453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190553453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190553453">(Mar 13 2020 at 20:53)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="190553866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190553866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190553866">(Mar 13 2020 at 20:57)</a>:</h4>
<p>marmistrz created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r392472688" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r392472688">PR Review Comment</a>:</p>
<blockquote>
<p>Done, the non-strict version is no more!</p>
</blockquote>



<a name="190553867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/190553867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#190553867">(Mar 13 2020 at 20:57)</a>:</h4>
<p>marmistrz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-374615854" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-374615854">PR Review</a>.</p>



<a name="191025141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191025141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191025141">(Mar 18 2020 at 18:47)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191034847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191034847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191034847">(Mar 18 2020 at 20:05)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191037593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191037593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191037593">(Mar 18 2020 at 20:28)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191079913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191079913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191079913">(Mar 19 2020 at 08:00)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191080089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191080089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191080089">(Mar 19 2020 at 08:01)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191081355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191081355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191081355">(Mar 19 2020 at 08:19)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191082467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191082467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191082467">(Mar 19 2020 at 08:35)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191086453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191086453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191086453">(Mar 19 2020 at 09:19)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191086637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191086637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191086637">(Mar 19 2020 at 09:20)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191088069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191088069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191088069">(Mar 19 2020 at 09:34)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191090203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191090203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191090203">(Mar 19 2020 at 09:55)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191094168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191094168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191094168">(Mar 19 2020 at 10:32)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191096101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191096101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191096101">(Mar 19 2020 at 10:49)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191473035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191473035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191473035">(Mar 23 2020 at 13:34)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191473614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191473614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191473614">(Mar 23 2020 at 13:38)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191474074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191474074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191474074">(Mar 23 2020 at 13:42)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191477816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191477816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191477816">(Mar 23 2020 at 14:10)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191478835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191478835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191478835">(Mar 23 2020 at 14:19)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191479150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191479150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191479150">(Mar 23 2020 at 14:21)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191479372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191479372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191479372">(Mar 23 2020 at 14:23)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191479919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191479919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191479919">(Mar 23 2020 at 14:25)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191511951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191511951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191511951">(Mar 23 2020 at 17:55)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191522916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191522916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191522916">(Mar 23 2020 at 19:18)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191532987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191532987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191532987">(Mar 23 2020 at 20:38)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191546516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191546516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191546516">(Mar 23 2020 at 22:37)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191548383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191548383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191548383">(Mar 23 2020 at 22:57)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191572207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191572207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191572207">(Mar 24 2020 at 07:06)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191580518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191580518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191580518">(Mar 24 2020 at 08:59)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191582764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191582764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191582764">(Mar 24 2020 at 09:19)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191584522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191584522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191584522">(Mar 24 2020 at 09:36)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191585583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191585583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191585583">(Mar 24 2020 at 09:45)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191585614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191585614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191585614">(Mar 24 2020 at 09:45)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191587816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191587816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191587816">(Mar 24 2020 at 10:04)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191588772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191588772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191588772">(Mar 24 2020 at 10:13)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191589679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191589679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191589679">(Mar 24 2020 at 10:21)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191598100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191598100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191598100">(Mar 24 2020 at 11:45)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191603344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191603344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191603344">(Mar 24 2020 at 12:44)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" target="_blank" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" target="_blank" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" target="_blank" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191759277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191759277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191759277">(Mar 25 2020 at 15:08)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191759949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191759949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191759949">(Mar 25 2020 at 15:11)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191760466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191760466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191760466">(Mar 25 2020 at 15:14)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191762245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191762245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191762245">(Mar 25 2020 at 15:23)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191763304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191763304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191763304">(Mar 25 2020 at 15:28)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="191763542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191763542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191763542">(Mar 25 2020 at 15:29)</a>:</h4>
<p><strong>marmistrz</strong> requested <a href="https://github.com/peterhuene" title="https://github.com/peterhuene">peterhuene</a> and <a href="https://github.com/sunfishcode" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a>.</p>



<a name="191763571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/191763571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#191763571">(Mar 25 2020 at 15:30)</a>:</h4>
<p><strong>marmistrz</strong> requested <a href="https://github.com/peterhuene" title="https://github.com/peterhuene">peterhuene</a>, <a href="https://github.com/kubkon" title="https://github.com/kubkon">kubkon</a> and <a href="https://github.com/sunfishcode" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a>.</p>



<a name="192607180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192607180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192607180">(Apr 01 2020 at 23:58)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192609027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609027">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386037148" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386037148">PR Review</a>.</p>



<a name="192609028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609028">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386037148" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386037148">PR Review</a>.</p>



<a name="192609029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609029">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986764" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986764">PR Review Comment</a>:</p>
<blockquote>
<p>If we remove the RAII type, we should remove or update this comment.  Calling out that the <code>fd_close</code> must be called prior to unlinking on Windows probably isn't worth a comment, but I'm also good with updating this comment to reflect that.</p>
</blockquote>



<a name="192609030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609030">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986971" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986971">PR Review Comment</a>:</p>
<blockquote>
<p>Is this TODO comment actionable or can it be removed?</p>
</blockquote>



<a name="192609031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609031">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986399" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986399">PR Review Comment</a>:</p>
<blockquote>
<p>Rather than using an RAII type for this single test, perhaps we should just insert the <code>fd_close</code> calls in the three places that are needed?</p>
</blockquote>



<a name="192609032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192609032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192609032">(Apr 02 2020 at 00:31)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986471" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r401986471">PR Review Comment</a>:</p>
<blockquote>
<p>We can remove this comment now I think.</p>
</blockquote>



<a name="192667692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192667692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192667692">(Apr 02 2020 at 13:51)</a>:</h4>
<p>marmistrz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386446223" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386446223">PR Review</a>.</p>



<a name="192667693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192667693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192667693">(Apr 02 2020 at 13:51)</a>:</h4>
<p>marmistrz created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402329287" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402329287">PR Review Comment</a>:</p>
<blockquote>
<p>What's wrong with RAII here?</p>
</blockquote>



<a name="192668699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192668699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192668699">(Apr 02 2020 at 13:59)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386453783" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386453783">PR Review</a>.</p>



<a name="192668701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192668701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192668701">(Apr 02 2020 at 13:59)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402335092" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402335092">PR Review Comment</a>:</p>
<blockquote>
<p>I'm also eager to remove RAII here. It makes the test logic somewhat clunky since we have to force nested scoping for the <code>drop</code> to fire. I cannot see why manually calling <code>fd_close</code> on all needed resources should be inferior to using the RAII type.</p>
</blockquote>



<a name="192695771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192695771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192695771">(Apr 02 2020 at 16:55)</a>:</h4>
<p>marmistrz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386616841" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386616841">PR Review</a>.</p>



<a name="192695772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192695772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192695772">(Apr 02 2020 at 16:55)</a>:</h4>
<p>marmistrz created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402464800" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402464800">PR Review Comment</a>:</p>
<blockquote>
<p>I'm removing this mapping, because there is no clear reason why it's needed, just as in #1359.</p>
</blockquote>



<a name="192695848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192695848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192695848">(Apr 02 2020 at 16:56)</a>:</h4>
<p>marmistrz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386617240" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386617240">PR Review</a>.</p>



<a name="192695849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192695849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192695849">(Apr 02 2020 at 16:56)</a>:</h4>
<p>marmistrz created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402465095" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402465095">PR Review Comment</a>:</p>
<blockquote>
<p>Okay, I'll remove RAII.</p>
</blockquote>



<a name="192696433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696433">(Apr 02 2020 at 17:01)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192696448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696448">(Apr 02 2020 at 17:01)</a>:</h4>
<p>marmistrz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386621293" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386621293">PR Review</a>.</p>



<a name="192696450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696450">(Apr 02 2020 at 17:01)</a>:</h4>
<p>marmistrz created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402468405" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402468405">PR Review Comment</a>:</p>
<blockquote>
<p>Done</p>
</blockquote>



<a name="192696503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696503">(Apr 02 2020 at 17:01)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386621713" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386621713">PR Review</a>.</p>



<a name="192696504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696504">(Apr 02 2020 at 17:01)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402468735" title="https://github.com/bytecodealliance/wasmtime/pull/1199#discussion_r402468735">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, I wouldn't say there's anything wrong with it by itself, just that it's a little bit of implementation that only saves three <code>fd_close</code> calls in a single test case.</p>
</blockquote>



<a name="192696629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192696629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192696629">(Apr 02 2020 at 17:02)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192697367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192697367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192697367">(Apr 02 2020 at 17:08)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192698268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192698268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192698268">(Apr 02 2020 at 17:16)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386632754" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386632754">PR Review</a>.</p>



<a name="192703752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192703752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192703752">(Apr 02 2020 at 18:01)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192703973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192703973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192703973">(Apr 02 2020 at 18:02)</a>:</h4>
<p>marmistrz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a> from <code>path_link</code> to <code>master</code>:</p>
<blockquote>
<p>This is probably the last missing syscall for Windows!</p>
<p>This PR implements <code>path_link</code> for Windows and adds a non-strict version of the <code>path_link</code> integration test.</p>
<p>I'm unsure about the error handling in <code>path_link</code>. MSDN doesn't say much about possible error codes for either <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createhardlinka"><code>CreateHardLinkA</code></a> or <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka" title="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsymboliclinka"><code>CreateSymbolicLinkA</code></a>. I mostly copied over the error conversion from <code>path_symlink</code>, but I'm not sure if it's correct. In particular, it's unclear to me what the purpose of <code>strip_trailing_slashes_and_concatenate</code> is.</p>
<p><code>path_symlink</code> will now also detect an attempt to create a dangling symlink and return <code>ENOTSUP</code>. (is this the correct return code)?</p>
<p>Currently the non-strictness of the test consists of:</p>
<ol>
<li>we use a separate subdirectories <code>subdir</code>, <code>subdir2</code>, <code>subdir3</code> for each test stage. This is due to the fact Windows will not remove the directory and won't allow to create a directory with the same name until the previous one has been deleted. I don't see any way of circumventing it, because the application may still try to access the directory through the unclosed file descriptor.</li>
<li><code>path_link</code> will return <code>EACCES</code> instead of <code>EPERM</code> when trying to create a link to a subdirectory. This violates the POSIX spec. We could manually check if the source path is a directory in case of <code>ERROR_ACCESS_DENIED</code> but this would cost us an extra syscall.</li>
<li>Tests for dangling symlinks or symlink loops have been disabled. Alternatively, we could check if the attempt to create a dangling symlink returns <code>ENOTSUP</code>, but this doesn't make much sense while 1&amp;2 are an issue.</li>
</ol>
<p>Let me know what you think.</p>
<p>Btw. @kubkon, according to <a href="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x" title="https://stackoverflow.com/questions/1432540/creating-directory-hard-links-in-mac-os-x">this stackoverflow post</a> Mac OS X 10.5+ permits hard links to directories, which our tests expect to fail.</p>
<hr>
<p>Notes about links and symlinks under Windows:</p>
<ul>
<li>creating a symlink requires administrative privileges (<code>SeCreateSymbolicLinkPrivilege</code>). On Windows 10 <a href="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/" title="https://blogs.windows.com/windowsdeveloper/2016/12/02/symlinks-windows-10/">this requirement may be removed, but this requires enabling developer mode</a></li>
<li>Windows distinguishes between file and directory symlinks</li>
<li>It's possible to create a dangling symlink, but the type (file/directory) has to be specified upon creation. The behavior in case of type mismatch is inconsistent. Precisely, suppose that a dangling file symlink is created <code>foo -&gt; bar</code> and later, a directory <code>bar</code> is created. Then:<ul>
<li>under msys64 bash, <code>cd foo</code> succeeds and the directory view is the same when access either directly or through the symlink</li>
<li>under cmd (both windowed and as a child process from msys64 bash). <code>cd foo</code> fails with <code>The directory name is invalid</code></li>
</ul>
</li>
</ul>
</blockquote>



<a name="192726774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192726774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192726774">(Apr 02 2020 at 21:09)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386777952" title="https://github.com/bytecodealliance/wasmtime/pull/1199#pullrequestreview-386777952">PR Review</a>.</p>



<a name="192852658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231199%20Implement%20path_link%20for%20Windows./near/192852658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231199.20Implement.20path_link.20for.20Windows.2E.html#192852658">(Apr 03 2020 at 19:24)</a>:</h4>
<p>marmistrz merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1199" title="https://github.com/bytecodealliance/wasmtime/pull/1199">PR #1199</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>