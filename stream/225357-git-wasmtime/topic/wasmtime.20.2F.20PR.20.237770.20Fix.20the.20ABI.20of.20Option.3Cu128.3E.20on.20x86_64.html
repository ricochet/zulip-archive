<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7770 Fix the ABI of Option&lt;u128&gt; on x86_64 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html">wasmtime / PR #7770 Fix the ABI of Option&lt;u128&gt; on x86_64</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="412376074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412376074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412376074">(Jan 11 2024 at 16:13)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a> from <code>bjorn3:fix_x64_option_i128_abi</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>LLVM passes the tag in rax and the u128 val in rdx/rcx. Before this change Cranelift would pass the first half of the value in rdx and the second half using an implicit return value pointer.</p>
<p>Fixes <a href="https://github.com/rust-lang/rustc_codegen_cranelift/issues/1449">https://github.com/rust-lang/rustc_codegen_cranelift/issues/1449</a></p>
</blockquote>



<a name="412376077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412376077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412376077">(Jan 11 2024 at 16:13)</a>:</h4>
<p><strong>bjorn3</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>.</p>



<a name="412376078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412376078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412376078">(Jan 11 2024 at 16:13)</a>:</h4>
<p><strong>bjorn3</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>.</p>



<a name="412379650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412379650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412379650">(Jan 11 2024 at 16:32)</a>:</h4>
<p>bjorn3 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>.</p>



<a name="412392861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412392861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412392861">(Jan 11 2024 at 17:46)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7770#pullrequestreview-1816147726">PR review</a>:</p>
<blockquote>
<p>Makes sense to me.</p>
</blockquote>



<a name="412393345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412393345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412393345">(Jan 11 2024 at 17:50)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/7770#issuecomment-1887673417">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>:</p>
<blockquote>
<p>@bjorn3, I tried to look this up in the LLVM documentation but all I can find is a mention of RCX in the swiftcc calling convention <a href="https://llvm.org/docs/LangRef.html#calling-conventions">here</a>. Where do you see it?</p>
</blockquote>



<a name="412396699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412396699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412396699">(Jan 11 2024 at 18:12)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/7770#issuecomment-1887706423">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>:</p>
<blockquote>
<p>See eg <a href="https://rust.godbolt.org/z/fTM6o84xq">https://rust.godbolt.org/z/fTM6o84xq</a> Fair chance it isn't documented anywhere, this requires the enable_llvm_abi_extensions flag in Cranelift for a reason.</p>
</blockquote>



<a name="412408396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237770%20Fix%20the%20ABI%20of%20Option%3Cu128%3E%20on%20x86_64/near/412408396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237770.20Fix.20the.20ABI.20of.20Option.3Cu128.3E.20on.20x86_64.html#412408396">(Jan 11 2024 at 19:35)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7770">PR #7770</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>