<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1781 Initial, partial support for `externref` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html">wasmtime / PR #1781 Initial, partial support for `externref`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199060804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199060804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199060804">(May 28 2020 at 18:18)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a>.</p>



<a name="199060806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199060806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199060806">(May 28 2020 at 18:18)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199063390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199063390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199063390">(May 28 2020 at 18:34)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199072560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199072560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199072560">(May 28 2020 at 19:39)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199081798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199081798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199081798">(May 28 2020 at 20:25)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199201875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201875">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-421223183">PR Review</a>.</p>



<a name="199201877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201877">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-421223183">PR Review</a>.</p>



<a name="199201879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201879">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432687749">PR Review Comment</a>:</p>
<blockquote>
<p>Since <code>data</code> isn't an owned value this doesn't actually do anything, right?</p>
</blockquote>



<a name="199201881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201881">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432688743">PR Review Comment</a>:</p>
<blockquote>
<p><code>.unwrap()</code>?</p>
</blockquote>



<a name="199201883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201883">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432689833">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps defer to <a href="https://doc.rust-lang.org/std/alloc/fn.handle_alloc_error.html">https://doc.rust-lang.org/std/alloc/fn.handle_alloc_error.html</a>?</p>
</blockquote>



<a name="199201885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201885">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432688672">PR Review Comment</a>:</p>
<blockquote>
<p>This looks like it's sharing a lot of code with allocation below, could that be refactored out to a shared function?</p>
</blockquote>



<a name="199201887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201887">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432691058">PR Review Comment</a>:</p>
<blockquote>
<p>Is this a place in the C API where the store should be passed in?</p>
</blockquote>



<a name="199201891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201891">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432691566">PR Review Comment</a>:</p>
<blockquote>
<p>Looks like this file became executable?</p>
</blockquote>



<a name="199201893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201893">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432691774">PR Review Comment</a>:</p>
<blockquote>
<p>This can probably just be deleted now, it doesn't seem to serve too much purpose any more</p>
</blockquote>



<a name="199201895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201895">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432690252">PR Review Comment</a>:</p>
<blockquote>
<p>This and traits below seem dangerous since I'd naively expect it to defer to the underlying type (which can't be done here b/c it's not generic). Could this be exposed as a free-function?</p>
</blockquote>



<a name="199201896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201896">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432691472">PR Review Comment</a>:</p>
<blockquote>
<p>This seems like a fine API to expose though, especially because <code>Caller</code> below exposes it too</p>
</blockquote>



<a name="199201897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201897">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432691988">PR Review Comment</a>:</p>
<blockquote>
<p>out of date comment?</p>
</blockquote>



<a name="199201898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201898">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432692407">PR Review Comment</a>:</p>
<blockquote>
<p>Ideally we'd move this out of the <code>wasmtime</code> crate entirely. Can all the <code>host_info</code> stuff move to <code>wasm_store_t</code> in the C API? I think the C API could store a <code>Rc&lt;wasm_store_t&gt;</code> on all the exported types, right?</p>
</blockquote>



<a name="199201899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201899">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432694107">PR Review Comment</a>:</p>
<blockquote>
<p>The only reason this is here is for the <code>host_info</code> APIs, right? If so I would personally prefer that we just jettison that support from the C API for now. I think we should find a better way for implementing that, if necessary, instead of altering the design of the <code>wasmtime</code> crate itself.</p>
</blockquote>



<a name="199201900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201900">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432692836">PR Review Comment</a>:</p>
<blockquote>
<p>Can this structure move to the C API?</p>
</blockquote>



<a name="199201901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199201901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199201901">(May 29 2020 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r432692699">PR Review Comment</a>:</p>
<blockquote>
<p>Could this pass in <code>self.store()</code> and defer to <code>Debug for Store</code>?</p>
</blockquote>



<a name="199419947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199419947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199419947">(Jun 01 2020 at 20:39)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422164492">PR Review</a>.</p>



<a name="199419949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199419949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199419949">(Jun 01 2020 at 20:39)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r433476430">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, this is more of a doing-everything-by-the-book and crossing-out-ts-and-dotting-our-is sort of thing for avoiding UB, but it is maybe overly conservative.</p>
</blockquote>



<a name="199425948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199425948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199425948">(Jun 01 2020 at 21:25)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422193398">PR Review</a>.</p>



<a name="199425949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199425949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199425949">(Jun 01 2020 at 21:25)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r433499017">PR Review Comment</a>:</p>
<blockquote>
<p>This is needed for the <code>wasi_instance_bind_import</code> WASI C API function -- do you happen to know if this is part of the C API or part of wasi?</p>
</blockquote>



<a name="199427165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199427165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199427165">(Jun 01 2020 at 21:36)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422199354">PR Review</a>.</p>



<a name="199427166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199427166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199427166">(Jun 01 2020 at 21:36)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r433503646">PR Review Comment</a>:</p>
<blockquote>
<p>As mentioned in chat, it is useful to have this built into the <code>wasmtime</code> crate so that host infos can be cleaned up when their associated <code>externref</code> goes away.</p>
</blockquote>



<a name="199427259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199427259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199427259">(Jun 01 2020 at 21:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422199930">PR Review</a>.</p>



<a name="199427260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199427260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199427260">(Jun 01 2020 at 21:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r433504083">PR Review Comment</a>:</p>
<blockquote>
<p><code>Store</code> doesn't implement <code>Debug</code>, but I can add an impl.</p>
</blockquote>



<a name="199428678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199428678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199428678">(Jun 01 2020 at 21:52)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199428827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199428827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199428827">(Jun 01 2020 at 21:54)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199428880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199428880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199428880">(Jun 01 2020 at 21:55)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a>.</p>



<a name="199430189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199430189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199430189">(Jun 01 2020 at 22:10)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a> from <code>externref</code> to <code>master</code>:</p>
<blockquote>
<p>This is enough to get an <code>externref -&gt; externref</code> identity function passing.</p>
<p>However, <code>externref</code>s that are dropped by compiled Wasm code are (safely) leaked. Follow up work will leverage cranelift's stack maps to resolve this issue.</p>
</blockquote>



<a name="199519836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199519836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199519836">(Jun 02 2020 at 16:41)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422864590">PR Review</a>.</p>



<a name="199519837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199519837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199519837">(Jun 02 2020 at 16:41)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#discussion_r434021044">PR Review Comment</a>:</p>
<blockquote>
<p>Ah I think that's just part of WASI, but this seems fine to add anyway</p>
</blockquote>



<a name="199520257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199520257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199520257">(Jun 02 2020 at 16:45)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1781#pullrequestreview-422867145">PR Review</a>.</p>



<a name="199520609"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231781%20Initial%2C%20partial%20support%20for%20%60externref%60/near/199520609" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231781.20Initial.2C.20partial.20support.20for.20.60externref.60.html#199520609">(Jun 02 2020 at 16:47)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1781">PR #1781</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>