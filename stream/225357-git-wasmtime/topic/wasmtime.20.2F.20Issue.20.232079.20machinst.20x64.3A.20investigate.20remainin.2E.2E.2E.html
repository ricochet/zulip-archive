<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2079 machinst x64: investigate remainin... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html">wasmtime / Issue #2079 machinst x64: investigate remainin...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="205376093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205376093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205376093">(Jul 29 2020 at 15:57)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[ ] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[ ] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="205376094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205376094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205376094">(Jul 29 2020 at 15:57)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[ ] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[ ] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="205429017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205429017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205429017">(Jul 30 2020 at 00:16)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[x] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[ ] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="205429020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205429020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205429020">(Jul 30 2020 at 00:17)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[ ] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[ ] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="205429948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205429948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205429948">(Jul 30 2020 at 00:30)</a>:</h4>
<p>jlb6740 <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-666001332">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>@bnjbvr Hi .. How do you test to see all the failures? If you run:</p>
<blockquote>
<p>cargo test --all  --features=experimental_x64</p>
</blockquote>
<p>or under the cranelift project:</p>
<blockquote>
<p>RUST_BACKTRACE=1` RUST_LOG=debug cargo test --all --features=experimental_x64 --package cranelift-codegen  -- --nocapture</p>
</blockquote>
<p>you see failures I believe related to the first bullet on stack onwinding .. but those are the only ones I can see fail. </p>
</blockquote>



<a name="205478214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205478214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205478214">(Jul 30 2020 at 13:29)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-666364933">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>A commit has now landed in CI with the right command line to use for running all the test cases; it's a bit long and requires Rust nightly (because of the way Cargo feature unification works in stable vs nightly):</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="n">cargo</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">-</span><span class="n">Zfeatures</span><span class="o">=</span><span class="n">all</span><span class="w"> </span><span class="o">-</span><span class="n">Zpackage</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="n">test</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">test_programs</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">experimental_x64</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">all</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">lightbeam</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">automata</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">fuzzing</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="kr">macro</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">runtime</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">test</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205478244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205478244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205478244">(Jul 30 2020 at 13:29)</a>:</h4>
<p>bnjbvr edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-666364933">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>A commit has now landed in CI with the right command line to use for running all the test cases; it's a bit long and requires Rust nightly (because of the way Cargo feature unification works in stable vs nightly):</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">-</span><span class="n">Zfeatures</span><span class="o">=</span><span class="n">all</span><span class="w"> </span><span class="o">-</span><span class="n">Zpackage</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="n">test</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">test_programs</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">experimental_x64</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">all</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">lightbeam</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">automata</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">fuzzing</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="kr">macro</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">runtime</span><span class="w"> </span><span class="err">\</span><span class="w"></span>
<span class="w">            </span><span class="o">--</span><span class="n">exclude</span><span class="w"> </span><span class="n">peepmatic</span><span class="o">-</span><span class="n">test</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205537850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/205537850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#205537850">(Jul 30 2020 at 22:03)</a>:</h4>
<p>jlb6740 <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-666733460">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Thanks ... see this now after updating the version of nightly. Did not see any errors but will take a closer look at the tests that are disabled. </p>
</blockquote>



<a name="211135883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/211135883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#211135883">(Sep 24 2020 at 14:06)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[ ] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[ ] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="211135914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/211135914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#211135914">(Sep 24 2020 at 14:06)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-698367866">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @bnjbvr</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>bnjbvr: cranelift</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="211149563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/211149563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#211149563">(Sep 24 2020 at 15:40)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[ ] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[x] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="211149806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/211149806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#211149806">(Sep 24 2020 at 15:42)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[x] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[x] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<a name="231134317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/231134317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#231134317">(Mar 20 2021 at 09:19)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-803277437">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<blockquote>
<p>implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</p>
</blockquote>
<p>This is done.</p>
<blockquote>
<p>tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</p>
</blockquote>
<p>Is this done?</p>
</blockquote>



<a name="231169501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/231169501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#231169501">(Mar 20 2021 at 20:26)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2079#issuecomment-803458501">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>I think so; we don't have any excluded GC tests anymore.</p>
</blockquote>



<a name="231169504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232079%20machinst%20x64%3A%20investigate%20remainin.../near/231169504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232079.20machinst.20x64.3A.20investigate.20remainin.2E.2E.2E.html#231169504">(Mar 20 2021 at 20:26)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2079">Issue #2079</a>:</p>
<blockquote>
<p>Opening an issue as a placeholder for remaining issues observed during testing. Initial PR for landing excluded the following tests:</p>
<ul>
<li>[ ] implement proper stack unwinding for the new backend: codegen/src/isa/x86/unwind/{systemv, winx64}.rs, tests/all/traps.rs (also: this will require implementing the win64 fastcall ABI in x64)</li>
<li>[x] cranelift filetests. For those, we'd need to either make them dependent on the Cargo feature x64 being not present (for e.g. regalloc tests), or keep them enabled (e.g. run tests). It will require more triaging. One idea would be to create a new directory x64 in the filetests suite, and copy over the tests that can be ported there; then we'd need some kind of way to dispatch the x64 tests to the new backend only, and x86 to the old backend only.</li>
<li>[ ] tests/all/gc.rs: investigate the gc-during-gc test failure. Probably a miscompilation in new-backend x64, since aarch64 doens't seem to fail this test.</li>
<li>[x] tests/all/iloop.rs, tests/all/stack_overflow.rs: probably require implementing probe stacks for both. The first file relates to interrupts, which might or might not be handled the same way as stack overflows in Wasmtime; I don't know.</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>