<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5151 Reduce calls to `section_by_name` loa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html">wasmtime / PR #5151 Reduce calls to `section_by_name` loa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="306731437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306731437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306731437">(Oct 28 2022 at 19:14)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5151">PR #5151</a> from <code>less-section-by-name</code> to <code>main</code>:</p>
<blockquote>
<p>Data is stored in binary artifacts as an ELF object and when loading an artifact lots of calls are made to the <code>object</code> crate's <code>section_by_name</code> method which ends up doing a linear search through the list of sections for a particular name. To avoid doing this linear search every time I've replaced this with one loop over the sections of an object at the beginning when an object is loaded, or at least most of the calls with this loop.</p>
<p>This isn't really a pressing issue today but some upcoming work I hope to do for AOT-compiled components will be adding more sections to the artifact so it seems best to keep the number of linear searches small and avoided if possible.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="306750617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306750617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306750617">(Oct 28 2022 at 21:14)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5151">PR #5151</a> from <code>less-section-by-name</code> to <code>main</code>.</p>



<a name="306752291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306752291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306752291">(Oct 28 2022 at 21:26)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#pullrequestreview-1160747654">PR review</a>.</p>



<a name="306752296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306752296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306752296">(Oct 28 2022 at 21:26)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#pullrequestreview-1160747654">PR review</a>.</p>



<a name="306752299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306752299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306752299">(Oct 28 2022 at 21:26)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#discussion_r1008501490">PR review comment</a>:</p>
<blockquote>
<p>I kinda wish you could pre-allocate the <code>dwarf_sections</code> for the maximum possible <code>SectionId</code>, since there aren't that many of them, rather than having to think about the edge cases of incremental resizing. But I don't see any easy way to get the max <code>SectionId</code> value.</p>
<p>I think this condition would read more clearly to me if flipped (<code>if idx &gt;= dwarf_sections.len()</code>). But I always have to think about this kind of condition either way, so I don't feel strongly about it.</p>
</blockquote>



<a name="306753940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306753940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306753940">(Oct 28 2022 at 21:37)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5151">PR #5151</a>.</p>



<a name="306754025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306754025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306754025">(Oct 28 2022 at 21:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#pullrequestreview-1160760180">PR review</a>.</p>



<a name="306754026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306754026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306754026">(Oct 28 2022 at 21:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#discussion_r1008511587">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah in terms of minor inefficiencies in loading a precompiled artifact I think this is pretty low down on the list, all the other operations I think vastly dominate the time spent doing that.</p>
</blockquote>



<a name="306757915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306757915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306757915">(Oct 28 2022 at 22:08)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#pullrequestreview-1160789177">PR review</a>.</p>



<a name="306757916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306757916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306757916">(Oct 28 2022 at 22:08)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5151#discussion_r1008538404">PR review comment</a>:</p>
<blockquote>
<p>Oh, absolutely. I wasn't worried about inefficiency of resizing the vector. This <code>if</code> condition was the only bit I had to stop to think about, and also the only place where you had a bug caught by CI. So it would be nice if we could pre-size the array to avoid having to think about the correctness of this <code>if</code> statement. But there doesn't appear to be a good way to do that, and after all CI _did_ catch the bug, so the way you have it is probably the best option.</p>
</blockquote>



<a name="306763114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235151%20Reduce%20calls%20to%20%60section_by_name%60%20loa.../near/306763114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235151.20Reduce.20calls.20to.20.60section_by_name.60.20loa.2E.2E.2E.html#306763114">(Oct 28 2022 at 22:55)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5151">PR #5151</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>