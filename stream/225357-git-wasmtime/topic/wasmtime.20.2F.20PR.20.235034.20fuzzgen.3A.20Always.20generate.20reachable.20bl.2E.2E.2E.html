<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5034 fuzzgen: Always generate reachable bl... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html">wasmtime / PR #5034 fuzzgen: Always generate reachable bl...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="303060509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303060509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303060509">(Oct 08 2022 at 20:24)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR alters fuzzgen to always generate reachable blocks. See #5022 for context.</p>
<p>We do this by making sure that whenever we insert terminators at least one of the edges points to the next block. </p>
<p>Another thing this PR does is separate the CFG construction from block terminator insertion.</p>
<p>This fuzzed ok individually, but I'm now also testing with #5020 on top to see if it finds anything else.</p>
<p>cc: @jameysharp </p>
</blockquote>



<a name="303544021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303544021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303544021">(Oct 12 2022 at 00:58)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1138298237">PR review</a>.</p>



<a name="303544022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303544022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303544022">(Oct 12 2022 at 00:58)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#discussion_r992883590">PR review comment</a>:</p>
<blockquote>
<p>I believe you can write this as:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        .map(|_| u.choose(options).cloned())
</code></pre></div><br>
</p>
</blockquote>



<a name="303544023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303544023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303544023">(Oct 12 2022 at 00:58)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1138298237">PR review</a>.</p>



<a name="303589453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303589453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303589453">(Oct 12 2022 at 09:24)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>.</p>



<a name="303589848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303589848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303589848">(Oct 12 2022 at 09:27)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>.</p>



<a name="303702297"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303702297" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303702297">(Oct 12 2022 at 18:57)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1139556973">PR review</a>.</p>



<a name="303702298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303702298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303702298">(Oct 12 2022 at 18:57)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1139556973">PR review</a>.</p>



<a name="303702299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303702299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303702299">(Oct 12 2022 at 18:57)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#discussion_r993798029">PR review comment</a>:</p>
<blockquote>
<p>Comment here describing why these checks (brtable targets can't have blockparams)?</p>
</blockquote>



<a name="303702300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303702300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303702300">(Oct 12 2022 at 18:57)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#discussion_r993785363">PR review comment</a>:</p>
<blockquote>
<p>The vec of boxed closures here is a little awkward -- is it forced only because we want to use the <code>Arbitrary::choose()</code> function below to pick out of a list?</p>
<p>I wonder if it would make sense to instead have something like</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">enum</span> <span class="nc">BlockTerminatorKind</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">Return</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">Jump</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">Cond</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">BrTable</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>and then match on that and do generation as required (i.e. have a <code>match kind { ... }</code> that evaluates to a <code>BlockTerminator</code>)?</p>
</blockquote>



<a name="303807081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303807081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303807081">(Oct 13 2022 at 11:29)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1140609918">PR review</a>.</p>



<a name="303807082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/303807082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#303807082">(Oct 13 2022 at 11:29)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#discussion_r994523624">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>The vec of boxed closures here is a little awkward -- is it forced only because we want to use the Arbitrary::choose() function below to pick out of a list?</p>
</blockquote>
<p>Yeah, exactly.</p>
<blockquote>
<p>I wonder if it would make sense to instead have something like and then match on that and do generation as required (i.e. have a match kind { ... } that evaluates to a BlockTerminator)?</p>
</blockquote>
<p>Sounds Good <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="304227230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/304227230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#304227230">(Oct 15 2022 at 17:28)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>.</p>



<a name="304227736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/304227736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#304227736">(Oct 15 2022 at 17:33)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>.</p>



<a name="304228740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/304228740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#304228740">(Oct 15 2022 at 17:44)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a> from <code>fuzzgen-reachable</code> to <code>main</code>.</p>



<a name="304545504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/304545504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#304545504">(Oct 17 2022 at 19:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5034#pullrequestreview-1144725799">PR review</a>.</p>



<a name="304545577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235034%20fuzzgen%3A%20Always%20generate%20reachable%20bl.../near/304545577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235034.20fuzzgen.3A.20Always.20generate.20reachable.20bl.2E.2E.2E.html#304545577">(Oct 17 2022 at 19:51)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5034">PR #5034</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>