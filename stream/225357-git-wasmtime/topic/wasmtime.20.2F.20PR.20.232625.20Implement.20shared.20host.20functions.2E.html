<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2625 Implement shared host functions. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html">wasmtime / PR #2625 Implement shared host functions.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="224822708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822708">(Feb 02 2021 at 02:54)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Engine</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Engine</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_engine_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224822858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822858">(Feb 02 2021 at 02:58)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Engine</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Engine</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_engine_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224822894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822894">(Feb 02 2021 at 02:59)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Engine</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Engine</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_engine_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224822902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822902">(Feb 02 2021 at 02:59)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224822993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822993">(Feb 02 2021 at 03:01)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-580948055">PR Review</a>.</p>



<a name="224822994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224822994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224822994">(Feb 02 2021 at 03:01)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568290034">PR Review Comment</a>:</p>
<blockquote>
<p>I've added a comment where we have the unsafe impls for <code>HostFunc</code>.</p>
</blockquote>



<a name="224823067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224823067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224823067">(Feb 02 2021 at 03:02)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-580948416">PR Review</a>.</p>



<a name="224823068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224823068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224823068">(Feb 02 2021 at 03:02)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568290301">PR Review Comment</a>:</p>
<blockquote>
<p>I'm now in favor of keeping the interning as the map can be cloned into multiple engines from a single config.</p>
<p>Thoughts with the recent changes?</p>
</blockquote>



<a name="224823072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224823072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224823072">(Feb 02 2021 at 03:02)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a>.</p>



<a name="224823073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224823073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224823073">(Feb 02 2021 at 03:02)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> and <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a>.</p>



<a name="224823720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224823720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224823720">(Feb 02 2021 at 03:15)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224891052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891052">(Feb 02 2021 at 15:58)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581488282">PR Review</a>.</p>



<a name="224891053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891053">(Feb 02 2021 at 15:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568712998">PR Review Comment</a>:</p>
<blockquote>
<p>Hm we may wish to brainstorm a different API for this. I'm worried about this causing unexpected panics in applications because you couldn't, for example, call this method recursively twice. I fear that would hamper usage of this API quite a lot. For example if you're implementing a WASI API which calls back into the module to malloc you'd need to be extremely careful to not <code>with_context</code> while malloc is being run.</p>
</blockquote>



<a name="224891054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891054">(Feb 02 2021 at 15:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568710934">PR Review Comment</a>:</p>
<blockquote>
<p>Would it be possible to move this logic into <code>self.get</code> directly? That internally handles the module-linking feature where if you import an instance it can be satisfied with a function definition of a two-level import. I think that if <code>self.store</code> were consulted in <code>self.get</code> that it'd naturally support that though.</p>
</blockquote>



<a name="224891055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891055">(Feb 02 2021 at 15:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568718714">PR Review Comment</a>:</p>
<blockquote>
<p>Ah ok makes sense! I don't feel that this should be removed really, only that I wasn't sure if the complexity was worth it (not even sure it's entirely worth it in <code>Linker</code>, not like I've profiled anything...). Seems fine to leave though!</p>
</blockquote>



<a name="224891056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891056">(Feb 02 2021 at 15:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568717926">PR Review Comment</a>:</p>
<blockquote>
<p>We could unify these two actually by fetching the <code>Store</code> from the same location, the location in TLS post-dates the original storage into the function's environment here. I think then the two could be shared?</p>
</blockquote>



<a name="224891283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891283">(Feb 02 2021 at 15:59)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581500356">PR Review</a>.</p>



<a name="224891284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224891284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224891284">(Feb 02 2021 at 15:59)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568719930">PR Review Comment</a>:</p>
<blockquote>
<p>I think the ideal API here would be <code>fn get&lt;T&gt;(&amp;self) -&gt; Option&lt;&amp;T&gt;</code> perhaps.</p>
<p>Could we not support <code>remove</code> and if consumers want it then they could have <code>T = RefCell&lt;Option&lt;U&gt;&gt;</code> perhaps?</p>
</blockquote>



<a name="224916602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916602">(Feb 02 2021 at 18:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581648558">PR Review</a>.</p>



<a name="224916603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916603">(Feb 02 2021 at 18:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581648558">PR Review</a>.</p>



<a name="224916604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916604">(Feb 02 2021 at 18:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568833911">PR Review Comment</a>:</p>
<blockquote>
<p>Does this mean that we need to check that this store is using an engine that is using this <code>HostFunc</code>'s config? is it possible for these things to get out of sync (which seems like it would lead to unsafety)</p>
</blockquote>



<a name="224916605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916605">(Feb 02 2021 at 18:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568842074">PR Review Comment</a>:</p>
<blockquote>
<p>+1 for exposing <code>&amp;T</code> instead of <code>&amp;mut T</code></p>
<p>if users are the ones adding ref cells, then they are aware of the re-entrancy concerns and can design around that, rather than being surprised when they finally hit a corner case and have already designed and implemented a bunch of stuff that now needs to be redone</p>
</blockquote>



<a name="224916606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916606">(Feb 02 2021 at 18:42)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568835154">PR Review Comment</a>:</p>
<blockquote>
<p>Seems like, based on this call site, they should stay in-sync, but that perhaps <code>to_func</code> isn't always guaranteed to be safe. If I'm understanding all this correctly, then I think <code>to_func</code> should be <code>unsafe</code> and this call site should be the place with the <code>unsafe</code> block that has a comment like "we know this store is using the same config as the host func".</p>
</blockquote>



<a name="224916892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916892">(Feb 02 2021 at 18:44)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581662111">PR Review</a>.</p>



<a name="224916893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224916893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224916893">(Feb 02 2021 at 18:44)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568844455">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>Could we not support <code>remove</code> and if consumers want it then they could have <code>T = RefCell&lt;Option&lt;U&gt;&gt;</code> perhaps?</p>
</blockquote>
<p>Yeah, good point. I guess switching to <code>&amp;T</code> alone isn't enough, we also have to not support removal to make reentrancy panic-free.</p>
</blockquote>



<a name="224917030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224917030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224917030">(Feb 02 2021 at 18:45)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581663007">PR Review</a>.</p>



<a name="224917031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224917031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224917031">(Feb 02 2021 at 18:45)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568845110">PR Review Comment</a>:</p>
<blockquote>
<p>Worth documenting for users how they would get mutability and the ability to remove context via <code>RefCell&lt;Option&lt;T&gt;&gt;</code> in the doc comments.</p>
</blockquote>



<a name="224917085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224917085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224917085">(Feb 02 2021 at 18:45)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568845110">PR Review Comment</a>.</p>



<a name="224925400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224925400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224925400">(Feb 02 2021 at 19:44)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581710941">PR Review</a>.</p>



<a name="224925401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224925401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224925401">(Feb 02 2021 at 19:44)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568882169">PR Review Comment</a>:</p>
<blockquote>
<p>If we want to do that rather than sourcing it from the instance data, I'll make the shim shared.</p>
</blockquote>



<a name="224925694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224925694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224925694">(Feb 02 2021 at 19:47)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581712756">PR Review</a>.</p>



<a name="224925695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224925695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224925695">(Feb 02 2021 at 19:47)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568883656">PR Review Comment</a>:</p>
<blockquote>
<p>I think you're right, <code>get</code> makes more sense for this implementation as it should behave as if the function were already defined in the linker even though it comes from the store.</p>
<p>I'll make that change.</p>
</blockquote>



<a name="224926089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926089">(Feb 02 2021 at 19:49)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581714818">PR Review</a>.</p>



<a name="224926090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926090">(Feb 02 2021 at 19:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568885317">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah I think we may as well change to that. It also has the added benefit of where the host state can remain 0-sized if <code>Self</code> is 0-sized (as is the case with all wasi functions). Additionally I think you could actually go ahead and remove <code>into_func</code> and simply have <code>into_host_func</code>, and then <code>Func::wrap</code> would have a small amount more glue to handle the add-the-instance-to-the-store case?</p>
</blockquote>



<a name="224926681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926681">(Feb 02 2021 at 19:53)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581717582">PR Review</a>.</p>



<a name="224926683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926683">(Feb 02 2021 at 19:53)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568887336">PR Review Comment</a>:</p>
<blockquote>
<p>That's a good point about reentrancy and moving the <code>RefCell</code> into the context value would give the callers more control over mutation scope.</p>
<p>This will necessitate a method on <code>Wasi</code> or <code>WasiCtx</code> to set the context in the store with the exact type the generated <code>Wasi</code> host functions expect, though (it's how I had it in the RFC, but this was a poor attempt at a "cleaner" API).</p>
<p>I'll get this fixed.</p>
</blockquote>



<a name="224926857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926857">(Feb 02 2021 at 19:54)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581718347">PR Review</a>.</p>



<a name="224926858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926858">(Feb 02 2021 at 19:54)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568887911">PR Review Comment</a>:</p>
<blockquote>
<p>I will add a debug assertion just to double check that the <code>HostFunc</code> is indeed related to the associated config.</p>
</blockquote>



<a name="224926942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926942">(Feb 02 2021 at 19:55)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581718780">PR Review</a>.</p>



<a name="224926944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224926944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224926944">(Feb 02 2021 at 19:55)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568888232">PR Review Comment</a>:</p>
<blockquote>
<p>I'll make it unsafe and comment as to the safety of the call.</p>
</blockquote>



<a name="224930124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224930124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224930124">(Feb 02 2021 at 20:17)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581735717">PR Review</a>.</p>



<a name="224930125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224930125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224930125">(Feb 02 2021 at 20:17)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568901088">PR Review Comment</a>:</p>
<blockquote>
<p>That works.  Thoughts on renaming the trait then?</p>
</blockquote>



<a name="224930229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224930229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224930229">(Feb 02 2021 at 20:18)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568901088">PR Review Comment</a>.</p>



<a name="224931183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224931183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224931183">(Feb 02 2021 at 20:25)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581741560">PR Review</a>.</p>



<a name="224931184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224931184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224931184">(Feb 02 2021 at 20:25)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r568905571">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, the lookup can't be done quickly as the <code>HostFunc</code> doesn't store the requisite information to query the passed store.</p>
<p>I think making this unsafe as suggested in the other comment is the best approach.</p>
</blockquote>



<a name="224949311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224949311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224949311">(Feb 02 2021 at 22:55)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224950342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224950342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224950342">(Feb 02 2021 at 23:05)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="224950562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224950562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224950562">(Feb 02 2021 at 23:07)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a>.</p>



<a name="224954748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/224954748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#224954748">(Feb 02 2021 at 23:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-581874986">PR Review</a>.</p>



<a name="225065872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/225065872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#225065872">(Feb 03 2021 at 19:13)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="225070061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/225070061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#225070061">(Feb 03 2021 at 19:40)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with an <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="225113226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/225113226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#225113226">(Feb 04 2021 at 02:52)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with a <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="225197115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/225197115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#225197115">(Feb 04 2021 at 17:57)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>:</p>
<blockquote>
<p>This PR introduces defining host functions at the <code>Config</code> rather than with<br>
<code>Func</code> tied to a <code>Store</code>.</p>
<p>The intention here is to enable a host to define all of the functions once at<br>
with a <code>Config</code> and then use a <code>Linker</code> (or directly with<br>
<code>Store::get_host_func</code>) to use the functions when instantiating a module.</p>
<p>This should help improve the performance of use cases where a <code>Store</code> is<br>
short-lived and redefining the functions at every module instantiation a<br>
noticeable performance hit.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/9">bytecodealliance/rfcs#9</a> regarding these changes.</p>
</blockquote>



<a name="226907174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/226907174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#226907174">(Feb 19 2021 at 01:00)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229413929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229413929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229413929">(Mar 09 2021 at 03:01)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229417193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229417193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229417193">(Mar 09 2021 at 03:47)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229551797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229551797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229551797">(Mar 09 2021 at 20:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229552544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229552544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229552544">(Mar 09 2021 at 20:58)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229558115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229558115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229558115">(Mar 09 2021 at 21:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-608085193">PR Review</a>.</p>



<a name="229578032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229578032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229578032">(Mar 09 2021 at 23:52)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229695866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229695866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229695866">(Mar 10 2021 at 16:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-608912276">PR Review</a>.</p>



<a name="229695867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229695867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229695867">(Mar 10 2021 at 16:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-608912276">PR Review</a>.</p>



<a name="229695868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229695868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229695868">(Mar 10 2021 at 16:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591673229">PR Review Comment</a>:</p>
<blockquote>
<p>Hm although then you'd have to also validate that no functions were defined yet, which is a bit wonky...</p>
<p>Do you have thoughts on this? I think it's fine either way myself.</p>
</blockquote>



<a name="229695869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229695869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229695869">(Mar 10 2021 at 16:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591672102">PR Review Comment</a>:</p>
<blockquote>
<p>The purpose of this being a constructor on <code>Store</code> was primarily to avoid switching at runtime, but because <code>Config</code> is intended as a builder and it's "frozen" as an <code>Engine</code> I think this is fine to simply have as an extra method on <code>Config</code> (probably named <code>async_</code>)</p>
</blockquote>



<a name="229714788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229714788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229714788">(Mar 10 2021 at 18:12)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-609020737">PR Review</a>.</p>



<a name="229714789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229714789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229714789">(Mar 10 2021 at 18:12)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591756228">PR Review Comment</a>:</p>
<blockquote>
<p>I'm leaning towards making it a setting like any other, rather than having <code>Config::new_async</code>, and having to set "async" prior to defining any async shared host functions.</p>
<p>With the instance allocator and now host functions in <code>Config</code>, I'm concerned that <code>Config</code> is too stateful now.  There's a similar problem with <code>async_stack_size</code> not being able to be set <em>after</em> an instance allocation strategy was set because the pooling allocator relies on that setting.</p>
<p>I'm wondering if we should move the <em>instantiated</em> instance allocator and shared host functions into <code>Engine</code> (like we have for <code>Compiler</code>), leaving <code>Config</code> a bunch of settings and only concerned with conflicts rather than <em>ordering</em> of the settings.  This wouldn't be a breaking change to the API.</p>
<p>This would change the semantics a little as each engine would now have its own instance allocator, but to me that makes more sense than having each engine share the instance allocator from a "configuration".</p>
<p>We'd still have to panic when you attempt to construct an <code>Engine</code> from an incorrect <code>Config</code>, though (e.g. you defined an async host function without setting the "async" setting, but now the order of those operations doesn't matter).</p>
<p>What's your take?</p>
</blockquote>



<a name="229723410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229723410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229723410">(Mar 10 2021 at 19:04)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-609067470">PR Review</a>.</p>



<a name="229723412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229723412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229723412">(Mar 10 2021 at 19:04)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591792768">PR Review Comment</a>:</p>
<blockquote>
<p>However, we'd also have to panic when constructing an engine if we can't allocate enough memory for the pooling instance allocator (when used) instead of what we do currently which is return error from <code>Config::with_allocation_strategy</code>.</p>
<p>Given this would ever likely be done once early on and isn't recoverable in a way that would make progress (out of memory <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span>), I'm not terribly concerned with a panicking if it improves <code>Config</code>.<br>
</p>
</blockquote>



<a name="229723573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229723573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229723573">(Mar 10 2021 at 19:05)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591792768">PR Review Comment</a>.</p>



<a name="229723636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229723636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229723636">(Mar 10 2021 at 19:06)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591756228">PR Review Comment</a>.</p>



<a name="229724078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229724078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229724078">(Mar 10 2021 at 19:08)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591792768">PR Review Comment</a>.</p>



<a name="229731487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229731487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229731487">(Mar 10 2021 at 19:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229731558"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229731558" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229731558">(Mar 10 2021 at 19:53)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#pullrequestreview-609109518">PR Review</a>.</p>



<a name="229731560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229731560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229731560">(Mar 10 2021 at 19:53)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2625#discussion_r591826968">PR Review Comment</a>:</p>
<blockquote>
<p>I've pushed up a change for the instance allocator to get a sense of what I'm talking about above. It also removes that confusing "default" instance allocator in the process.</p>
<p>I'll see about the same for moving "async" to a setting and making instantiating the host functions into the engine rather than config.</p>
<p>If we don't like it this way, I'll remove the commits.</p>
</blockquote>



<a name="229732064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229732064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229732064">(Mar 10 2021 at 19:57)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229768816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229768816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229768816">(Mar 10 2021 at 23:55)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229770404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229770404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229770404">(Mar 11 2021 at 00:09)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a> from <code>engine-funcs</code> to <code>main</code>.</p>



<a name="229876901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232625%20Implement%20shared%20host%20functions./near/229876901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232625.20Implement.20shared.20host.20functions.2E.html#229876901">(Mar 11 2021 at 16:14)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2625">PR #2625</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>