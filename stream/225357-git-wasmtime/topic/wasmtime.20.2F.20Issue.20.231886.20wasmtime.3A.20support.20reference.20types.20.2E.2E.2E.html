<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1886 wasmtime: support reference types ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html">wasmtime / Issue #1886 wasmtime: support reference types ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="201045190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/201045190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#201045190">(Jun 16 2020 at 17:02)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>I think this should mostly Just Work after <a href="https://github.com/bytecodealliance/wasmtime/issues/1617">https://github.com/bytecodealliance/wasmtime/issues/1617</a> lands, but we also need to remove these <code>cfg</code>s (and make sure the tests pass, ofc):</p>
<ul>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216</a></p>
</li>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24</a></p>
</li>
</ul>
</blockquote>



<a name="201045191"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/201045191" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#201045191">(Jun 16 2020 at 17:02)</a>:</h4>
<p>fitzgen labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>I think this should mostly Just Work after <a href="https://github.com/bytecodealliance/wasmtime/issues/1617">https://github.com/bytecodealliance/wasmtime/issues/1617</a> lands, but we also need to remove these <code>cfg</code>s (and make sure the tests pass, ofc):</p>
<ul>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216</a></p>
</li>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24</a></p>
</li>
</ul>
</blockquote>



<a name="201057770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/201057770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#201057770">(Jun 16 2020 at 18:45)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1886#issuecomment-644946403">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>For tracking purposes: the initial support for the ref values and opcodes themselves is in the WIP PR #1852, and @julian-seward1 and I are working out the safepoints story from the <a href="http://regalloc.rs">regalloc.rs</a> and isel sides respectively. We should have at least an initial version done in the next few weeks.</p>
<p>We're pushing things forward for the SpiderMonkey use-case and planning to test there, so I'll be interested to see how we interface with <code>wasmtime</code>'s new reftypes support you've been building. The stackmaps interface will likely need a bit of finessing but I'm happy to work that out once we get there.</p>
</blockquote>



<a name="201057810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/201057810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#201057810">(Jun 16 2020 at 18:45)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/1886#issuecomment-644946403">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>For tracking purposes: the initial support for the ref values and opcodes themselves on AArch64 is in the WIP PR #1852, and @julian-seward1 and I are working out the safepoints story from the <a href="http://regalloc.rs">regalloc.rs</a> and isel sides respectively. We should have at least an initial version done in the next few weeks.</p>
<p>We're pushing things forward for the SpiderMonkey use-case and planning to test there, so I'll be interested to see how we interface with <code>wasmtime</code>'s new reftypes support you've been building. The stackmaps interface will likely need a bit of finessing but I'm happy to work that out once we get there.</p>
</blockquote>



<a name="201061625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/201061625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#201061625">(Jun 16 2020 at 19:18)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/1886#issuecomment-644963218">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>Thanks for the update @cfallin!</p>
<p>FYI we now have <code>test stackmaps</code> support in filetests now too, so that should hopefully make testing in-tree a little easier for you:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/master/cranelift/filetests/src/test_stackmaps.rs">https://github.com/bytecodealliance/wasmtime/blob/master/cranelift/filetests/src/test_stackmaps.rs</a></li>
<li><a href="https://github.com/bytecodealliance/wasmtime/tree/master/cranelift/filetests/filetests/stackmaps">https://github.com/bytecodealliance/wasmtime/tree/master/cranelift/filetests/filetests/stackmaps</a></li>
</ul>
<p>The stack maps interfaces definitely need a little finessing (one example off the top of my head would be to have "semantic" methods rather than just exposing the inner bit map directly and expecting callers to figure out how to interpret that; also I suspect we can do better than iterating over every word in the frame and have an iterator over only the live refs instead).</p>
<p>As long as everything remains SP-relative, then I think Wasmtime should be fine (getting SP portably and reliably is <em>much</em> easier than getting the CFA with libunwind).</p>
</blockquote>



<a name="216647586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/216647586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#216647586">(Nov 13 2020 at 17:52)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1886#issuecomment-726916679">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>Fixed by #2410.</p>
</blockquote>



<a name="216647588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231886%20wasmtime%3A%20support%20reference%20types%20.../near/216647588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231886.20wasmtime.3A.20support.20reference.20types.20.2E.2E.2E.html#216647588">(Nov 13 2020 at 17:52)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1886">Issue #1886</a>:</p>
<blockquote>
<p>I think this should mostly Just Work after <a href="https://github.com/bytecodealliance/wasmtime/issues/1617">https://github.com/bytecodealliance/wasmtime/issues/1617</a> lands, but we also need to remove these <code>cfg</code>s (and make sure the tests pass, ofc):</p>
<ul>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/build.rs#L214-L216</a></p>
</li>
<li>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24">https://github.com/bytecodealliance/wasmtime/blob/647d2b423131c533af57e59e98928ca5d1f6887e/tests/all/main.rs#L22-L24</a></p>
</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>