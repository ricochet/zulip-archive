<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5087 wiggle: allow disable tracing in W... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html">wasmtime / issue #5087 wiggle: allow disable tracing in W...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="305238915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305238915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305238915">(Oct 20 2022 at 21:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286158008">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Seems reasonable to me! Instead of a crate feature, though, could this be added to <code>CodegenSettings</code>?</p>
</blockquote>



<a name="305242352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305242352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305242352">(Oct 20 2022 at 21:36)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286183228">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @kubkon</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasi"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>kubkon: wasi</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="305243069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305243069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305243069">(Oct 20 2022 at 21:41)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286188290">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Ok, pushed a version using <code>CodegenSettings</code>; the parent crates still have Cargo features, though, since this is how the <code>wasmtime</code> feature is enabled.</p>
</blockquote>



<a name="305243743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305243743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305243743">(Oct 20 2022 at 21:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286194589">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>I don't remember enough of the rationale here to remember for sure, but can the features be removed entirely? I think it's reasonable to leave <code>tracing</code> off-by-default and turn it back on for <code>wasi-common</code> to preserve its current feature set.</p>
</blockquote>



<a name="305244050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305244050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305244050">(Oct 20 2022 at 21:52)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286197712">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Not sure I understand how you want it to be turned on-off by the users of <code>from_witx!</code> and <code>wasmtime_integration!</code>...</p>
</blockquote>



<a name="305245062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305245062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305245062">(Oct 20 2022 at 22:00)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286205148">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>In fact... I think there might even be an additional level of feature propagation needed up to <code>crates/wasi</code>, <code>crates/wasi-common</code>, etc. Those users of wiggle are the places where I want to turn tracing on or off and the only way I see to do that is through Cargo features (just like the Wasmtime integration).</p>
</blockquote>



<a name="305253942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305253942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305253942">(Oct 20 2022 at 23:20)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286265964">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Oh never mind me! I think I understand now that you mean use the parse-able configuration of the macro. The latest commit attempts that. Unfortunately, when I add <code>tracing: false</code> to a <code>from_witx!</code> macro, I see build errors like:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">wasmtime/crates/wasi-common$ cargo build</span>
<span class="go">   Compiling wasi-common v3.0.0 (/.../wasmtime/crates/wasi-common)</span>
<span class="go">error[E0728]: `await` is only allowed inside `async` functions and blocks</span>
<span class="go">  --&gt; crates/wasi-common/src/snapshots/preview_1.rs:21:1</span>
<span class="go">   |</span>
<span class="go">21 | / wiggle::from_witx!({</span>
<span class="go">22 | |     witx: ["$WASI_ROOT/phases/snapshot/witx/wasi_snapshot_preview1.witx"],</span>
<span class="go">23 | |     errors: { errno =&gt; Error },</span>
<span class="go">24 | |     // Note: not every function actually needs to be async, however, nearly all of them do, and</span>
<span class="go">...  |</span>
<span class="go">29 | |     wasmtime: false</span>
<span class="go">30 | | });</span>
<span class="go">   | |  ^</span>
<span class="go">   | |  |</span>
<span class="go">   | |__only allowed inside `async` functions and blocks</span>
<span class="go">   |    this is not `async`</span>
<span class="go">   |</span>
<span class="go">   = note: this error originates in the macro `wiggle::from_witx` (in Nightly builds, run with -Z macro-backtrace for more info)</span>

<span class="go">e</span>
<span class="go">...</span>
</code></pre></div>
<p>So somehow the macro now thinks it should async when it shouldn't?</p>
</blockquote>



<a name="305253958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305253958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305253958">(Oct 20 2022 at 23:20)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1286265964">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Oh never mind me! I think I understand now that you mean use the parse-able configuration of the macro. The latest commit attempts that. Unfortunately, when I add <code>tracing: false</code> to a <code>from_witx!</code> macro, I see build errors like:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">wasmtime/crates/wasi-common$ cargo build</span>
<span class="go">   Compiling wasi-common v3.0.0 (/.../wasmtime/crates/wasi-common)</span>
<span class="go">error[E0728]: `await` is only allowed inside `async` functions and blocks</span>
<span class="go">  --&gt; crates/wasi-common/src/snapshots/preview_1.rs:21:1</span>
<span class="go">   |</span>
<span class="go">21 | / wiggle::from_witx!({</span>
<span class="go">22 | |     witx: ["$WASI_ROOT/phases/snapshot/witx/wasi_snapshot_preview1.witx"],</span>
<span class="go">23 | |     errors: { errno =&gt; Error },</span>
<span class="go">24 | |     // Note: not every function actually needs to be async, however, nearly all of them do, and</span>
<span class="go">...  |</span>
<span class="go">29 | |     wasmtime: false</span>
<span class="go">30 | | });</span>
<span class="go">   | |  ^</span>
<span class="go">   | |  |</span>
<span class="go">   | |__only allowed inside `async` functions and blocks</span>
<span class="go">   |    this is not `async`</span>
<span class="go">   |</span>
<span class="go">   = note: this error originates in the macro `wiggle::from_witx` (in Nightly builds, run with -Z macro-backtrace for more info)</span>

<span class="go">e</span>
<span class="go">...</span>
</code></pre></div>
<p>So somehow the macro now thinks it should async when it shouldn't or viceversa?</p>
</blockquote>



<a name="305366641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/305366641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#305366641">(Oct 21 2022 at 14:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1287035139">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Unfortunately wiggle hasn't really seen much bug fixing and battle-testing over its lifespan, so what you're seeing may be a bug in wiggle. CI isn't failing, though, so is this with an individual build rather than an always-happens things?</p>
<p>As for the <code>wasmtime</code> feature, wiggle-of-old was used for both Lucet and Wasmtime so it had a feature to avoid using Wasmtime, but nowadays I don't think there's necessarily any need for it and we should probably eventually remove that. No need to do that here of course, mostly just that the prior design decisions of wiggle aren't necessarily great guides for what to do with it going forward since times have changed.</p>
</blockquote>



<a name="306498997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235087%20wiggle%3A%20allow%20disable%20tracing%20in%20W.../near/306498997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235087.20wiggle.3A.20allow.20disable.20tracing.20in.20W.2E.2E.2E.html#306498997">(Oct 27 2022 at 17:18)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/5087#issuecomment-1293837203">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5087">issue #5087</a>:</p>
<blockquote>
<p>Closing in favor of the rebased #5146.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>