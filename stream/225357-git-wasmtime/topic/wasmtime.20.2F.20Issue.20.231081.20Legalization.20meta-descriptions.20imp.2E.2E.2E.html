<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1081 Legalization meta-descriptions imp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231081.20Legalization.20meta-descriptions.20imp.2E.2E.2E.html">wasmtime / Issue #1081 Legalization meta-descriptions imp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="225047340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231081%20Legalization%20meta-descriptions%20imp.../near/225047340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231081.20Legalization.20meta-descriptions.20imp.2E.2E.2E.html#225047340">(Feb 03 2021 at 17:12)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/1081#issuecomment-772672538">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1081">Issue #1081</a>:</p>
<blockquote>
<p>The new backend framework doesn't use legalizations.</p>
</blockquote>



<a name="225050581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231081%20Legalization%20meta-descriptions%20imp.../near/225050581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231081.20Legalization.20meta-descriptions.20imp.2E.2E.2E.html#225050581">(Feb 03 2021 at 17:33)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1081#issuecomment-772687279">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1081">Issue #1081</a>:</p>
<blockquote>
<p>While we still use some skeletal remains of legalizations (e.g. lowering heap accesses to primitive address computation ops and load/store ops), the specific issues described here mostly don't apply anymore, I agree.</p>
</blockquote>



<a name="225050584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231081%20Legalization%20meta-descriptions%20imp.../near/225050584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231081.20Legalization.20meta-descriptions.20imp.2E.2E.2E.html#225050584">(Feb 03 2021 at 17:33)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1081">Issue #1081</a>:</p>
<blockquote>
<p>I'll use this issue as a dump for things that I've noticed could be enhanced for the legalization module in the Rust meta crate, probably better to do later once we've ported all of the meta code to Rust.</p>
<ul>
<li>[ ] Remove the ordering hack in the <code>x86</code> legalizer file, which was needed because we want to ensure the same ordering of transform groups as the Python module does (for encodings).</li>
<li>[x] When there are several legalizations available for a given Cranelift opcode (e.g. when the opcode is type-dependent), the generated code does unwrap the arguments from the instruction several times, and generates a predicate too. We could unwrap the arguments at the top once and for all, and then generate predicates for each type the legalization affects.</li>
<li>[x] Remove the condition when the value of <code>predicate</code> is a plain <code>true</code>.</li>
<li>[x] Try to gather the predicate conditions together, instead of refining the predicate (e.g. <code>let predicate = value_type == I64; let predicate = predicate &amp;&amp; type_sets[42].contains(something);</code> etc).</li>
<li>[ ] Allow to bind several times in the <code>def!</code> macro.</li>
<li>[ ] Consider adding a <code>ToRustCode</code> and <code>ToRustComment</code> trait that structs can implement.</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>