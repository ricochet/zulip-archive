<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5750 Reuse `inst_predicates::visit_block_s... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html">wasmtime / PR #5750 Reuse `inst_predicates::visit_block_s...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="326693069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326693069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326693069">(Feb 08 2023 at 22:01)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5750">PR #5750</a> from <code>trevor/visit-blocks</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="326693255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326693255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326693255">(Feb 08 2023 at 22:02)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5750">PR #5750</a> from <code>trevor/visit-blocks</code> to <code>main</code>:</p>
<blockquote>
<p>Following up from #5730, replace some explicit matching over branch instructions with a use of <code>inst_predicates::visit_block_succs</code>.</p>
<p>cc @bjorn3 </p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="326693272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326693272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326693272">(Feb 08 2023 at 22:02)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5750">PR #5750</a>.</p>



<a name="326693693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326693693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326693693">(Feb 08 2023 at 22:05)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290069935">PR review</a>.</p>



<a name="326693697"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326693697" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326693697">(Feb 08 2023 at 22:05)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#discussion_r1100729399">PR review comment</a>:</p>
<blockquote>
<p>Using <code>visit_block_succs</code> changes the traversal order here, traversing the default block first.</p>
</blockquote>



<a name="326694008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326694008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326694008">(Feb 08 2023 at 22:07)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290071856">PR review</a>.</p>



<a name="326694272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326694272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326694272">(Feb 08 2023 at 22:08)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290073662">PR review</a>.</p>



<a name="326694273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326694273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326694273">(Feb 08 2023 at 22:08)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#discussion_r1100731934">PR review comment</a>:</p>
<blockquote>
<p>I think that is fine, but I am not familiar with this code.</p>
</blockquote>



<a name="326702871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326702871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326702871">(Feb 08 2023 at 23:08)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290133456">PR review</a>.</p>



<a name="326702873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326702873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326702873">(Feb 08 2023 at 23:08)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#discussion_r1100775382">PR review comment</a>:</p>
<blockquote>
<p>The doc comment for this function says the requirement is that "if a block is split in two, we get the same post-order except for the insertion of the new block header at the split point" (which it calls a "split-invariant post-order"). As far as I can tell, the order of visiting successors of a single instruction doesn't affect that property, as long as the order is stable if you compute the dominator tree multiple times.</p>
<p>Looking further at the history, I think a lot of this is remnants from the old "extended basic block" model. There's a giant comment in <code>compute_postorder</code>, which is immediately above this function, where as far as I can tell almost none of that comment applies to Cranelift today. Most of that comment was written when this was still called Cretonne.</p>
<p>I wouldn't be shocked if we don't care about "split-invariant post-orders" at all any more. Even if we do, I don't think this change breaks that property. But just in case I'm wrong about both of those, let's see if @cfallin wants to weigh in.</p>
</blockquote>



<a name="326706067"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326706067" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326706067">(Feb 08 2023 at 23:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290164125">PR review</a>.</p>



<a name="326706069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326706069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326706069">(Feb 08 2023 at 23:35)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#pullrequestreview-1290164125">PR review</a>.</p>



<a name="326706071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326706071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326706071">(Feb 08 2023 at 23:35)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5750#discussion_r1100793173">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I don't think traversal order should matter here; and if it does, to the extent that it causes a bug, we should fix that.</p>
</blockquote>



<a name="326706883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235750%20Reuse%20%60inst_predicates%3A%3Avisit_block_s.../near/326706883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235750.20Reuse.20.60inst_predicates.3A.3Avisit_block_s.2E.2E.2E.html#326706883">(Feb 08 2023 at 23:42)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5750">PR #5750</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>