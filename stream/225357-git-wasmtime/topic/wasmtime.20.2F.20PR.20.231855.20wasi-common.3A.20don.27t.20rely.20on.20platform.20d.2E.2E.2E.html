<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1855 wasi-common: don&#x27;t rely on platform d... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html">wasmtime / PR #1855 wasi-common: don&#x27;t rely on platform d...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="200440828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200440828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200440828">(Jun 10 2020 at 16:28)</a>:</h4>
<p>ueno opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1855">PR #1855</a> from <code>wip/dueno/null</code> to <code>master</code>:</p>
<blockquote>
<p>If stdio is not inherited nor associated with a file, <code>WasiCtxBuilder</code> tries to open "/dev/null" ("NUL" on Windows) and attach stdio to it. While most platforms today support those device files, it would be<br>
good to avoid unnecessary access to the host device if possible.  This patch instead uses a virtual Handle that emulates the "NUL" device.</p>
<p>This is particularly needed when using wasmtime in a restricted environment, such as inside TEE (see <a href="https://github.com/enarx/enarx/issues/559">https://github.com/enarx/enarx/issues/559</a> for the context).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200449379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200449379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200449379">(Jun 10 2020 at 17:33)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1855">PR #1855</a> from <code>wip/dueno/null</code> to <code>master</code>:</p>
<blockquote>
<p>If stdio is not inherited nor associated with a file, <code>WasiCtxBuilder</code> tries to open "/dev/null" ("NUL" on Windows) and attach stdio to it. While most platforms today support those device files, it would be<br>
good to avoid unnecessary access to the host device if possible.  This patch instead uses a virtual Handle that emulates the "NUL" device.</p>
<p>This is particularly needed when using wasmtime in a restricted environment, such as inside TEE (see <a href="https://github.com/enarx/enarx/issues/559">https://github.com/enarx/enarx/issues/559</a> for the context).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200455130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200455130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200455130">(Jun 10 2020 at 18:14)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428308204">PR Review</a>.</p>



<a name="200455132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200455132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200455132">(Jun 10 2020 at 18:14)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428308204">PR Review</a>.</p>



<a name="200455134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200455134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200455134">(Jun 10 2020 at 18:14)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438318941">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>                let cast_iovlen: types::Size = iov.len().try_into()?;
</code></pre></div>


<p>I think this should bubble up with an error rather than panic, and same below. Oh, and FWIW this should be convertible to <code>crate::wasi::Error</code> without remapping the error types, etc.</p>
</blockquote>



<a name="200455135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200455135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200455135">(Jun 10 2020 at 18:14)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438316123">PR Review Comment</a>:</p>
<blockquote>
<p>So the reason we've had a <code>PendingEntry::Thunk</code> here was because (if my memory serves me well) <code>OsOther::from_null</code> was fallible and hence it was convenient to save a function returning <code>Result</code> rather than dealing with unwraps, etc., in <code>WasiCtxBuilder::new</code> which is non-fallible. Since I don't see any reason for <code>NullDevice::null_device</code> to be fallible (it always succeeds since it's a virtual device, am I right?), perhaps we could make the fn <code>null_device</code> non-fallible, or better yet, have a more meaningful method such as <code>NullDevice::new</code> as it's constructor, and here, use <code>PendingEntry::Handle</code> instead of <code>PendingEntry::Thunk</code>?</p>
</blockquote>



<a name="200455136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200455136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200455136">(Jun 10 2020 at 18:14)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438319166">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>            .fold(Some(0u32), |len, iov| len.and_then(|x| x.checked_add(iov)))?;
</code></pre></div>


</blockquote>



<a name="200536511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200536511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200536511">(Jun 11 2020 at 12:24)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1855">PR #1855</a> from <code>wip/dueno/null</code> to <code>master</code>:</p>
<blockquote>
<p>If stdio is not inherited nor associated with a file, <code>WasiCtxBuilder</code> tries to open "/dev/null" ("NUL" on Windows) and attach stdio to it. While most platforms today support those device files, it would be<br>
good to avoid unnecessary access to the host device if possible.  This patch instead uses a virtual Handle that emulates the "NUL" device.</p>
<p>This is particularly needed when using wasmtime in a restricted environment, such as inside TEE (see <a href="https://github.com/enarx/enarx/issues/559">https://github.com/enarx/enarx/issues/559</a> for the context).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200536681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200536681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200536681">(Jun 11 2020 at 12:26)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428857242">PR Review</a>.</p>



<a name="200536682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200536682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200536682">(Jun 11 2020 at 12:26)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438744672">PR Review Comment</a>:</p>
<blockquote>
<p>Thank you for the suggestion! I've rewritten that part along these lines.</p>
</blockquote>



<a name="200536990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200536990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200536990">(Jun 11 2020 at 12:28)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428859171">PR Review</a>.</p>



<a name="200536991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200536991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200536991">(Jun 11 2020 at 12:28)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438746018">PR Review Comment</a>:</p>
<blockquote>
<p>This and the below seem to be a bit tricky (to a Rust newbie :-), as the error is inside closure. I tried to rewrite this part with <code>try_fold</code>, though it required some manual remapping.</p>
</blockquote>



<a name="200551432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200551432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200551432">(Jun 11 2020 at 14:26)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428967029">PR Review</a>.</p>



<a name="200551433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200551433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200551433">(Jun 11 2020 at 14:26)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438827059">PR Review Comment</a>:</p>
<blockquote>
<p>Ahh, I missed the fact this was within a <code>map</code> closure. FWIW, in situations like this one, I prefer to use a standard <code>for</code> loop and use <code>?</code> without the need to remap or carry over the result until the collect/fold step:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">total_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">iov</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">iovs</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span>: <span class="nc">types</span>::<span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iov</span><span class="p">.</span><span class="n">len</span><span class="p">().</span><span class="n">try_into</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">total_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_len</span><span class="p">.</span><span class="n">checked_add</span><span class="p">(</span><span class="n">len</span><span class="p">).</span><span class="n">ok_or</span><span class="p">(</span><span class="n">Errno</span>::<span class="n">Overflow</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nb">Ok</span><span class="p">(</span><span class="n">total_len</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="200551824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200551824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200551824">(Jun 11 2020 at 14:30)</a>:</h4>
<p>kubkon edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438827059">PR Review Comment</a>.</p>



<a name="200552817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200552817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200552817">(Jun 11 2020 at 14:37)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428977483">PR Review</a>.</p>



<a name="200554035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200554035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200554035">(Jun 11 2020 at 14:47)</a>:</h4>
<p>ueno updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1855">PR #1855</a> from <code>wip/dueno/null</code> to <code>master</code>:</p>
<blockquote>
<p>If stdio is not inherited nor associated with a file, <code>WasiCtxBuilder</code> tries to open "/dev/null" ("NUL" on Windows) and attach stdio to it. While most platforms today support those device files, it would be<br>
good to avoid unnecessary access to the host device if possible.  This patch instead uses a virtual Handle that emulates the "NUL" device.</p>
<p>This is particularly needed when using wasmtime in a restricted environment, such as inside TEE (see <a href="https://github.com/enarx/enarx/issues/559">https://github.com/enarx/enarx/issues/559</a> for the context).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200554136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200554136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200554136">(Jun 11 2020 at 14:48)</a>:</h4>
<p>ueno submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#pullrequestreview-428987217">PR Review</a>.</p>



<a name="200554137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200554137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200554137">(Jun 11 2020 at 14:48)</a>:</h4>
<p>ueno created <a href="https://github.com/bytecodealliance/wasmtime/pull/1855#discussion_r438842081">PR Review Comment</a>:</p>
<blockquote>
<p>Indeed, that is much cleaner, thanks!</p>
</blockquote>



<a name="200570918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231855%20wasi-common%3A%20don%27t%20rely%20on%20platform%20d.../near/200570918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231855.20wasi-common.3A.20don.27t.20rely.20on.20platform.20d.2E.2E.2E.html#200570918">(Jun 11 2020 at 16:45)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1855">PR #1855</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>