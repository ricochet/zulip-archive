<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7766 Support compilation-only build by add... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html">wasmtime / PR #7766 Support compilation-only build by add...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="417189796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189796">(Jan 22 2024 at 09:38)</a>:</h4>
<p>adambratschikaye edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417189872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189872">(Jan 22 2024 at 09:39)</a>:</h4>
<p><strong>adambratschikaye</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a> as ready for review.</p>



<a name="417189876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189876">(Jan 22 2024 at 09:39)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417189877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189877">(Jan 22 2024 at 09:39)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417189878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189878">(Jan 22 2024 at 09:39)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417189879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417189879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417189879">(Jan 22 2024 at 09:39)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417190654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417190654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417190654">(Jan 22 2024 at 09:44)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1903609863">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>With these changes I was able to get <a href="https://github.com/adambratschikaye/wasmtime-in-wasm">this example</a> of performing wasmtime compilation within wasm to work. However there was one problem with is that the compilation of wasmtime to wasm32 contains a function with ~60,000 locals and <code>wasmparser</code> has a hard limit of 50,000 locals per function.</p>
<p>So I'd like to add a test that does the compilation within wasm, but I still need to figure out how to handle that limit on locals.</p>
</blockquote>



<a name="417194043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417194043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417194043">(Jan 22 2024 at 10:05)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="417298533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417298533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417298533">(Jan 22 2024 at 19:16)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1904646836">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>That's awesome! I think you're perhaps the first person ever to execute a cross-compilation using Cranelift from a 32-bit architecture to a 64-bit architecture!</p>
<p>I'll dig into this today and give a review.</p>
</blockquote>



<a name="417302163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417302163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417302163">(Jan 22 2024 at 19:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1837188082">PR review</a>:</p>
<blockquote>
<p>Thanks again for this! Reading over it, everything looks at a high level ok here, but if you're ok with it I'd like to brainstorm a bit on the internal organization here. My goal here would be to cut down on "complexity" (a loose term here...) which kind of translates to minimizing <code>#[cfg]</code> and other things. Some possible ideas:</p>
<ul>
<li>
<p>Could the <code>runtime</code> module, at its root, have everything reexported of it's internals? My hope would be that in <code>lib.rs</code> we'd have:</p>
<p><code>rust
#[cfg(feature = "runtime")]
mod runtime;
#[cfg(feature = "runtime")]
pub use runtime::*;
</code></p>
<p>I think <code>cargo fmt</code> has issues with modules defined via macro expansions so moving the <code>mod runtime</code> out of a macro may benefit that niche use case.</p>
</li>
<li>
<p>I think it's ok to move some more things into <code>runtime</code> that are technically agnostic like <code>limits</code>, <code>resources</code>, and <code>stack</code>.</p>
</li>
<li>Can you add a builder to CI to build the wasmtime crate for the wasm32-wasi target with the <code>runtime</code> feature disabled?</li>
<li>
<p>Splitting <code>engine.rs</code> feels not great since it's now so spread out (and requires a large struct with a bunch of <code>pub(crate)</code> which never feels great. This might be something where it may be worth some more <code>#[cfg]</code>. Do you know if a design such as this would work?</p>
<p><code>rust
impl Engine { /* common methods */ }
#[cfg(feature = "runtime")] 
impl Engine { /* runtime methods */ }
#[cfg(feature = "compile")] 
impl Engine { /* compilation methods */ }
</code></p>
<p>that might help keep everything in a single file, albeit there'd probably be a lot of <code>#[cfg]</code> related to <code>use</code> directives at the top of the file perhaps.</p>
</li>
<li>
<p>Do you think it would make sense to have a top level <code>mod compile;</code> with all compilation-related bits under that? Right now it's sort of spread out at the root it seems.</p>
</li>
</ul>
</blockquote>



<a name="417302164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417302164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417302164">(Jan 22 2024 at 19:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1837188082">PR review</a>:</p>
<blockquote>
<p>Thanks again for this! Reading over it, everything looks at a high level ok here, but if you're ok with it I'd like to brainstorm a bit on the internal organization here. My goal here would be to cut down on "complexity" (a loose term here...) which kind of translates to minimizing <code>#[cfg]</code> and other things. Some possible ideas:</p>
<ul>
<li>
<p>Could the <code>runtime</code> module, at its root, have everything reexported of it's internals? My hope would be that in <code>lib.rs</code> we'd have:</p>
<p><code>rust
#[cfg(feature = "runtime")]
mod runtime;
#[cfg(feature = "runtime")]
pub use runtime::*;
</code></p>
<p>I think <code>cargo fmt</code> has issues with modules defined via macro expansions so moving the <code>mod runtime</code> out of a macro may benefit that niche use case.</p>
</li>
<li>
<p>I think it's ok to move some more things into <code>runtime</code> that are technically agnostic like <code>limits</code>, <code>resources</code>, and <code>stack</code>.</p>
</li>
<li>Can you add a builder to CI to build the wasmtime crate for the wasm32-wasi target with the <code>runtime</code> feature disabled?</li>
<li>
<p>Splitting <code>engine.rs</code> feels not great since it's now so spread out (and requires a large struct with a bunch of <code>pub(crate)</code> which never feels great. This might be something where it may be worth some more <code>#[cfg]</code>. Do you know if a design such as this would work?</p>
<p><code>rust
impl Engine { /* common methods */ }
#[cfg(feature = "runtime")] 
impl Engine { /* runtime methods */ }
#[cfg(feature = "compile")] 
impl Engine { /* compilation methods */ }
</code></p>
<p>that might help keep everything in a single file, albeit there'd probably be a lot of <code>#[cfg]</code> related to <code>use</code> directives at the top of the file perhaps.</p>
</li>
<li>
<p>Do you think it would make sense to have a top level <code>mod compile;</code> with all compilation-related bits under that? Right now it's sort of spread out at the root it seems.</p>
</li>
</ul>
</blockquote>



<a name="417302165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417302165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417302165">(Jan 22 2024 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#discussion_r1462306270">PR review comment</a>:</p>
<blockquote>
<p>Could you add a doc-block here and above <code>runtime</code> below indicating what the feature is?</p>
</blockquote>



<a name="417302166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417302166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417302166">(Jan 22 2024 at 19:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#discussion_r1462304758">PR review comment</a>:</p>
<blockquote>
<p>Mind throwing a comment above this indicating why it's here?</p>
</blockquote>



<a name="417302597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417302597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417302597">(Jan 22 2024 at 19:41)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1904684123">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<blockquote>
<p>So I'd like to add a test that does the compilation within wasm, but I still need to figure out how to handle that limit on locals.</p>
</blockquote>
<p>Can you paste an example of buliding wasmtime like this? I checked out your repo and pointed it at this branch and this passed:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<p>but I expected that it might otherwise fail</p>
</blockquote>



<a name="417408698"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/417408698" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#417408698">(Jan 23 2024 at 09:55)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1905689112">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>Thanks, all those comments seem reasonable and I'll look into them.</p>
</blockquote>



<a name="418080124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418080124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418080124">(Jan 25 2024 at 13:33)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418090649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418090649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418090649">(Jan 25 2024 at 14:27)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418096868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418096868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418096868">(Jan 25 2024 at 14:55)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418100540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418100540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418100540">(Jan 25 2024 at 15:12)</a>:</h4>
<p><strong>adambratschikaye</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418100541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418100541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418100541">(Jan 25 2024 at 15:12)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418101987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418101987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418101987">(Jan 25 2024 at 15:18)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418114242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418114242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418114242">(Jan 25 2024 at 16:13)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418118812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418118812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418118812">(Jan 25 2024 at 16:35)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418122237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418122237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418122237">(Jan 25 2024 at 16:51)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418127348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418127348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418127348">(Jan 25 2024 at 17:16)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418140462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418140462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418140462">(Jan 25 2024 at 18:29)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418140713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418140713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418140713">(Jan 25 2024 at 18:30)</a>:</h4>
<p>adambratschikaye submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1844391137">PR review</a>.</p>



<a name="418140714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418140714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418140714">(Jan 25 2024 at 18:30)</a>:</h4>
<p>adambratschikaye created <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#discussion_r1466774243">PR review comment</a>:</p>
<blockquote>
<p>Yep, added one.</p>
</blockquote>



<a name="418140849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418140849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418140849">(Jan 25 2024 at 18:31)</a>:</h4>
<p>adambratschikaye submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1844392471">PR review</a>.</p>



<a name="418140850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418140850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418140850">(Jan 25 2024 at 18:31)</a>:</h4>
<p>adambratschikaye created <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#discussion_r1466775150">PR review comment</a>:</p>
<blockquote>
<p>I added one for <code>runtime</code>. I think this feature isn't actually necessary - I modified the cranelift build so that if <code>all-arch</code> is enabled it doesn't complain if it can't build for the host arch.</p>
</blockquote>



<a name="418146148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418146148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418146148">(Jan 25 2024 at 19:05)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1910814129">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>Ok, I've made most of the suggested changes:</p>
<blockquote>
<ul>
<li>Could the <code>runtime</code> module, at its root, have everything reexported of it's internals? My hope would be that in <code>lib.rs</code> we'd have:<br>
<code>rust
  #[cfg(feature = "runtime")]
  mod runtime;
  #[cfg(feature = "runtime")]
  pub use runtime::*;
  </code><br>
  I think <code>cargo fmt</code> has issues with modules defined via macro expansions so moving the <code>mod runtime</code> out of a macro may benefit that niche use case.</li>
</ul>
</blockquote>
<p>Yes this seems to be cleaner.</p>
<blockquote>
<ul>
<li>I think it's ok to move some more things into <code>runtime</code> that are technically agnostic like <code>limits</code>, <code>resources</code>, and <code>stack</code>.</li>
</ul>
</blockquote>
<p>I moved these three as well as <code>coredump</code> and <code>debug</code>.</p>
<blockquote>
<ul>
<li>Can you add a builder to CI to build the wasmtime crate for the wasm32-wasi target with the <code>runtime</code> feature disabled?</li>
</ul>
</blockquote>
<p>I added an extra build job in the CI (that runs on x86 linux). Hope this makes sense within the general CI setup of the project.</p>
<blockquote>
<ul>
<li>Splitting <code>engine.rs</code> feels not great since it's now so spread out (and requires a large struct with a bunch of <code>pub(crate)</code> which never feels great. This might be something where it may be worth some more <code>#[cfg]</code>. Do you know if a design such as this would work?<br>
<code>rust
  impl Engine { /* common methods */ }
  #[cfg(feature = "runtime")] 
  impl Engine { /* runtime methods */ }
  #[cfg(feature = "compile")] 
  impl Engine { /* compilation methods */ }
  </code><br>
  that might help keep everything in a single file, albeit there'd probably be a lot of <code>#[cfg]</code> related to <code>use</code> directives at the top of the file perhaps.</li>
</ul>
</blockquote>
<p>Yep this works fine, except I didn't add a <code>compile</code> feature. It would just be the same as <code>any(feature = "cranelift", feature = "winch")</code> so I just used that everywhere.</p>
<blockquote>
<ul>
<li>Do you think it would make sense to have a top level <code>mod compile;</code> with all compilation-related bits under that? Right now it's sort of spread out at the root it seems.</li>
</ul>
</blockquote>
<p>I put some things that were at the top-level under the <code>compile</code> module. But there's still a bunch of compilation specific stuff under <code>cfg</code> directives in the runtime module. Many of these seem like they wouldn't make sense to move over to the <code>compile</code> because they rely on types that wouldn't be used without the <code>runtime</code> feature. For example, <code>Func::new</code> requires compilation, but I don't see how it could be used without the <code>runtime</code> feature (there are similar examples for <code>Linker</code>, <code>Module</code>, and <code>Component</code>).</p>
</blockquote>



<a name="418148529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418148529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418148529">(Jan 25 2024 at 19:19)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1910833500">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<blockquote>
<p>Can you paste an example of buliding wasmtime like this? I checked out your repo and pointed it at this branch and this passed:</p>
<p><code>
$ wasm-tools validate ./target/wasm32-wasi/release/wasmtime-in-wasm.wasm
</code></p>
<p>but I expected that it might otherwise fail</p>
</blockquote>
<p>Ah yep, that's working for me as well. Doing the debug build hits the limit though:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="err">❯</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span>

<span class="err">❯</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span>: <span class="nc">func</span><span class="w"> </span><span class="mi">35030</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">validate</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">too</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">locals</span>: <span class="nc">locals</span><span class="w"> </span><span class="n">exceed</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x111420c</span><span class="p">)</span>
</code></pre></div>
<p>Would it make sense to add that code as an example along with a CI job do the compilation in Wasm and then execute on the host system? And would you want that job to run on all hosts in the matrix?</p>
</blockquote>



<a name="418338531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418338531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418338531">(Jan 26 2024 at 19:26)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1846409750">PR review</a>:</p>
<blockquote>
<p>Ok thanks again for you work on this, it's all looking great to me! I've got some minor nits and things but I think it's probably best to go ahead and land this and I can follow-up myself with anything else I'd like. I'd also like to get the <code>wasmtime</code> CLI itself compiling to wasm with just the cranelift/winch features enabled, but no need to do that here either! I think there's a rebase conflict but otherwise I'm happy to throw this at the merge queue.</p>
<blockquote>
<p>Would it make sense to add that code as an example along with a CI job do the compilation in Wasm and then execute on the host system? And would you want that job to run on all hosts in the matrix?</p>
</blockquote>
<p>I think so yeah, but I'll do that as part of a follow-up to get the <code>wasmtime</code> CLI itself compiling. I tried for a bit to figure out what function was causing issues unsuccessfully, but this is also ok to work on as a follow-up.</p>
<p>My guess is that it's a function in cranelift-codegen for lowering since that's the main source of "big generated code". I have yet to confirm this though.</p>
</blockquote>



<a name="418344223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418344223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418344223">(Jan 26 2024 at 20:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1912626430">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>Ah ok so I found the function:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">error</span>: <span class="nc">func</span><span class="w"> </span><span class="mi">39100</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">validate</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">too</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">locals</span>: <span class="nc">locals</span><span class="w"> </span><span class="n">exceed</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0x12ebabe</span><span class="p">)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">wasm</span><span class="o">-</span><span class="n">tools</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">skeleton</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">rg</span><span class="w"> </span><span class="mi">39100</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_ZN4core6option19Option$LT$$RF$T$GT$</span><span class="mi">6</span><span class="n">cloned17h3ad039100bcc27f6E</span><span class="w"> </span><span class="p">(;</span><span class="mi">11910</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.)</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_ZN17cranelift_codegen2ir7builder11InstBuilder8f64const17h4e1391004dd942baE</span><span class="w"> </span><span class="p">(;</span><span class="mi">18861</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.)</span>
<span class="w">  </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$_ZN17cranelift_codegen4opts14generated_code20constructor_simplify17h2e155f4b5f5d37f9E</span><span class="w"> </span><span class="p">(;</span><span class="mi">39100</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">..</span><span class="p">.)</span>
<span class="cp">$</span><span class="w"> </span><span class="n">rustfilt</span><span class="w"> </span><span class="n">_ZN17cranelift_codegen4opts14generated_code20constructor_simplify17h2e155f4b5f5d37f9E</span>
<span class="n">cranelift_codegen</span>::<span class="n">opts</span>::<span class="n">generated_code</span>::<span class="n">constructor_simplify</span>
</code></pre></div>
<p>That corresponds to the ISLE-generated code for optimizing CLIF. I'm not personally aware of any low-hanging fruit on optimizing the output of ISLE for debug builds, so this may be a case where <code>cranelift-codegen</code> the crate needs to be optimized, even in debug builds.</p>
</blockquote>



<a name="418588573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418588573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418588573">(Jan 29 2024 at 08:53)</a>:</h4>
<p>adambratschikaye updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418589086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418589086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418589086">(Jan 29 2024 at 08:56)</a>:</h4>
<p>adambratschikaye <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1914236737">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<blockquote>
<p>Ok thanks again for you work on this, it's all looking great to me! I've got some minor nits and things but I think it's probably best to go ahead and land this and I can follow-up myself with anything else I'd like. I'd also like to get the <code>wasmtime</code> CLI itself compiling to wasm with just the cranelift/winch features enabled, but no need to do that here either! I think there's a rebase conflict but otherwise I'm happy to throw this at the merge queue.</p>
</blockquote>
<p>I resolved the conflicts. Happy to follow up with compiling the CLI to wasm as well.</p>
</blockquote>



<a name="418666752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418666752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418666752">(Jan 29 2024 at 15:51)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#pullrequestreview-1849016517">PR review</a>.</p>



<a name="418666952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418666952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418666952">(Jan 29 2024 at 15:52)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1914987730">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>Ok sounds good! I don't necessarily have a concrete use case in mind but it seems like a neat way to demo how Cranelift can be compiled to wasm. I'll poke a bit more at the internals of the <code>wasmtime</code> crate and leave the CLI bits to you. </p>
</blockquote>



<a name="418674571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418674571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418674571">(Jan 29 2024 at 16:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>.</p>



<a name="418734503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237766%20Support%20compilation-only%20build%20by%20add.../near/418734503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237766.20Support.20compilation-only.20build.20by.20add.2E.2E.2E.html#418734503">(Jan 29 2024 at 22:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7766#issuecomment-1915708898">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7766">PR #7766</a>:</p>
<blockquote>
<p>I was curious to play around with this and went a bit far down the rabbit hole! I was able to hack things up and get things working though with <a href="https://github.com/bytecodealliance/wasmtime/pull/7842">https://github.com/bytecodealliance/wasmtime/pull/7842</a> and <a href="https://github.com/bytecodealliance/wasmtime/pull/7844">https://github.com/bytecodealliance/wasmtime/pull/7844</a>, however. That's perhaps a bit of a taste of how cross-compilation, especially across pointer widths, is not the most well trodden path in Wasmtime so there may be a few other lingering bugs. Mostly just something to be aware of, and I'd hope that we can start adding regression tests in CI once we've got CLI support!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>