<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5325 Unexpted error &quot;called `Option::un... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html">wasmtime / issue #5325 Unexpted error &quot;called `Option::un...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="312183192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312183192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312183192">(Nov 25 2022 at 13:06)</a>:</h4>
<p>kpreisser opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Use the following WASM file (this is not actually a movie; I renamed the .wasm to .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312183478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312183478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312183478">(Nov 25 2022 at 13:08)</a>:</h4>
<p>kpreisser edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Use the following WASM file as <code>dotnet-codabix-wasm-build.wasm</code> (this is not actually a movie; I renamed the .wasm to .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312183895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312183895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312183895">(Nov 25 2022 at 13:10)</a>:</h4>
<p>kpreisser <a href="https://github.com/bytecodealliance/wasmtime/issues/5325#issuecomment-1327459622">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>When using a debug build of Wasmtime from commit 28cf995, I get the following backtrace:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">80</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdceced9c2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">dbghelp</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="o">..</span><span class="err">\</span><span class="o">..</span><span class="err">\</span><span class="n">backtrace</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">backtrace</span><span class="err">\</span><span class="n">dbghelp</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">98</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdceced9c2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="o">..</span><span class="err">\</span><span class="o">..</span><span class="err">\</span><span class="n">backtrace</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">backtrace</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdceced9c2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print_fmt</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">sys_common</span><span class="err">\</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdceced9c2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">fmt</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">sys_common</span><span class="err">\</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdced0991b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">fmt</span>::<span class="n">write</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">fmt</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1202</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdcece87ea</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span>::<span class="n">write_fmt</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">windows</span>::<span class="n">stdio</span>::<span class="n">Stderr</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">io</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1679</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdcecf0114</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">sys_common</span><span class="err">\</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">48</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdcecf0114</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">print</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">sys_common</span><span class="err">\</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdcecf0114</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">1</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">295</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdcecefd4a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">314</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdcecf0901</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">698</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdcecf07ca</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">586</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdcecee3ef</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="p">,</span><span class="n">never</span><span class="cp">$</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">sys_common</span><span class="err">\</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">138</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdcecf04d0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">584</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdced6d005</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">142</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:     <span class="mh">0x7ffdced6ceac</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">48</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:     <span class="mh">0x7ffdcd875c4a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">ref_mut</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span>::<span class="n">unwrap</span><span class="o">&lt;</span><span class="n">ref_mut</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">775</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:     <span class="mh">0x7ffdcd7f924a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">linker</span>::<span class="n">wasmtime_linker_define_wasi</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:     <span class="mh">0x7ffdcd7d2011</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">3</span>::<span class="n">async_block</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linker</span>::<span class="n">wasmtime_linker_define_wasi</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasi</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:     <span class="mh">0x7ffdcd77d2bf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">1</span>::<span class="n">poll</span><span class="o">&lt;</span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">3</span>::<span class="n">async_block_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linker</span>::<span class="n">wasmtime_linker_define_w</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">future</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">91</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:     <span class="mh">0x7ffdcd77227e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wiggle</span>::<span class="n">run_in_dummy_executor</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">future</span>::<span class="n">from_generator</span>::<span class="n">GenFuture</span><span class="o">&lt;</span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">3</span>::<span class="n">async_block_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linke</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wiggle</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1039</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdcd7c1ffd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">3</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linker</span>::<span class="n">wasmtime_linker_define_wasi</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasi</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdcd809570</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">3</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasm</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1917</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdcd97f60e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">3</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">stor</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">ops</span><span class="err">\</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">248</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdcd9cf499</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">23</span>::<span class="n">call_once</span><span class="o">&lt;</span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_sn</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="err">\</span><span class="n">unwind_safe</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">271</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdcd9e2021</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_lin</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">492</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdcd9eae83</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_catch</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">trampoline</span>::<span class="n">func</span>::<span class="n">stub_fn</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">6</span>::<span class="n">new_unchecked</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">tuple</span><span class="cp">$</span><span class="o">&lt;&gt;</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">new</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">tuple</span><span class="cp">$</span><span class="o">&lt;&gt;</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">store</span>::
  <span class="mi">27</span>:     <span class="mh">0x7ffdcd9d82db</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span><span class="o">&lt;</span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">prev</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">456</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffdcd847d39</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">panic</span>::<span class="n">unwind_safe</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>:
                               <span class="nc">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">897e37553</span><span class="n">bba8b42751c67658967889d11ecd120</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffdcd800f20</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">3</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linke</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1912</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffdcd834595</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="o">&gt;</span>::<span class="n">with</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">enum2</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">CallResult</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">Store</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1714</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffdcd7ff015</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">52</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasmtime_wasi</span>::<span class="n">sync</span>::<span class="n">snapshots</span>::<span class="n">preview_1</span>::<span class="n">add_wasi_snapshot_preview1_to_linker</span>::<span class="n">closure_env</span><span class="cp">$</span><span class="mi">3</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="p">,</span><span class="n">wasi_common</span>::<span class="n">ctx</span>::<span class="n">WasiCtx</span><span class="p">,</span><span class="n">wasmtime</span>::<span class="n">linker</span>::<span class="n">wasmtime</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1901</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:      <span class="mh">0x1226a717e4e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:      <span class="mh">0x1226a717ba1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:      <span class="mh">0x1226a714e81</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:      <span class="mh">0x12269bb102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:      <span class="mh">0x1226a74f22e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:      <span class="mh">0x1226a74f72b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdcd8394fc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">call_unchecked_raw</span>::<span class="n">closure</span><span class="cp">$</span><span class="mi">0</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">store</span>::<span class="n">StoreData</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="n">C</span>:<span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">developer4</span><span class="err">\</span><span class="n">Desktop</span><span class="err">\</span><span class="n">WebAssembly</span><span class="o">-</span><span class="n">Tests</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">crates</span><span class="err">\</span><span class="n">wasmtime</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">900</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdcd867a3d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="k">impl</span><span class="cp">$</span><span class="mi">0</span>::<span class="n">call_</span><span class="w"></span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="312184933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312184933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312184933">(Nov 25 2022 at 13:16)</a>:</h4>
<p>kpreisser edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Download the following .Zip file and extract <code>dotnet-codabix-wasm-build.wasmI</code> from it (this is not actually a movie; I renamed the .zip zo .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312184949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312184949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312184949">(Nov 25 2022 at 13:16)</a>:</h4>
<p>kpreisser edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Download the following .Zip file and extract <code>dotnet-codabix-wasm-build.wasm</code> from it (this is not actually a movie; I renamed the .zip zo .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312185353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312185353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312185353">(Nov 25 2022 at 13:18)</a>:</h4>
<p>kpreisser edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Download the following .Zip file and extract <code>dotnet-codabix-wasm-build.wasm</code> from it (this is not actually a movie; I renamed the .zip to .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312199428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312199428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312199428">(Nov 25 2022 at 14:28)</a>:</h4>
<p>kpreisser edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Download the following .Zip file and extract <code>dotnet-codabix-wasm-build.wasm</code> from it (this is not actually a movie; I renamed the .zip to .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312207795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312207795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312207795">(Nov 25 2022 at 15:09)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5325#issuecomment-1327612776">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>I think you need to call the C# equivalent of <code>wasmtime_context_set_wasi</code> on the store.</p>
</blockquote>



<a name="312208869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312208869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312208869">(Nov 25 2022 at 15:15)</a>:</h4>
<p>kpreisser <a href="https://github.com/bytecodealliance/wasmtime/issues/5325#issuecomment-1327618043">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Thanks! You are right, this fixes the error. Unfortunately, this doesn't fix the access violation in our other application (where the call to <code>store.SetWasiConfiguration()</code> already occurs), so this actually seems to be a different error.</p>
<p>I will continue to try to reproduce that and then open a new issue.</p>
</blockquote>



<a name="312208871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312208871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312208871">(Nov 25 2022 at 15:15)</a>:</h4>
<p>kpreisser closed <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Hi, <br>
we use Wasmtime 3.0.0 with <code>wasmtime-dotnet</code> in an application where we load a 8 MB .wasm file produced by the WASI SDK for .NET. </p>
<p>After instantiating the module and calling the exported <code>_start</code> function, we either get an access violation, or the following error is printed to the console and returned as trap (with <code>RUST_BACKTRACE=full</code> (this is on Windows 10 x64 (Build 19044)):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="err">\</span><span class="n">c</span><span class="o">-</span><span class="n">api</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">104</span>:<span class="mi">63</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:     <span class="mh">0x7ffdf2b36d42</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:     <span class="mh">0x7ffdf2b5283b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:     <span class="mh">0x7ffdf2b31f7a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:     <span class="mh">0x7ffdf2b39464</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:     <span class="mh">0x7ffdf2b3909a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:     <span class="mh">0x7ffdf2b39c51</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:     <span class="mh">0x7ffdf2b39b1a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:     <span class="mh">0x7ffdf2b3776f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:     <span class="mh">0x7ffdf2b39820</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">impl_new_epoch</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:     <span class="mh">0x7ffdf2bf4a85</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:     <span class="mh">0x7ffdf2bf492c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:     <span class="mh">0x7ffdf2533d52</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:     <span class="mh">0x7ffdf259008d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_globaltype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:     <span class="mh">0x7ffdf25b7cad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:     <span class="mh">0x7ffdf24edb09</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:      <span class="mh">0x1b7f0bfa26d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:      <span class="mh">0x1b7f0bfa090</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:      <span class="mh">0x1b7f0bf8501</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:      <span class="mh">0x1b7f086102c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:      <span class="mh">0x1b7f0c22bee</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:      <span class="mh">0x1b7f0c230eb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:     <span class="mh">0x7ffdf2bb2c73</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">_jit_debug_register_code</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:     <span class="mh">0x7ffdf25c2d74</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_val_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:     <span class="mh">0x7ffdf25d55f6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_tabletype_copy</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:     <span class="mh">0x7ffdf24f4ef7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:     <span class="mh">0x7ffdf24f7de5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasm_foreign_delete</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:     <span class="mh">0x7ffdf25e3ed0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_func_call</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:     <span class="mh">0x7ffd9e0b0f8c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:     <span class="mh">0x7ffd9e0b0c79</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:     <span class="mh">0x7ffd9e0b08a3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:     <span class="mh">0x7ffd9e0b06b8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:     <span class="mh">0x7ffd9e0a553c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:     <span class="mh">0x7ffd9e0a2eb1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>:     <span class="mh">0x7ffdfdc4aac3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_shutdown_2</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>:     <span class="mh">0x7ffdfdb681a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>:     <span class="mh">0x7ffdfdbeeff7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>:     <span class="mh">0x7ffdfdbeee76</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">37</span>:     <span class="mh">0x7ffdfdbeed25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">38</span>:     <span class="mh">0x7ffdfdbeeae6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MetaDataGetDispenser</span><span class="w"></span>
<span class="w">  </span><span class="mi">39</span>:     <span class="mh">0x7ffdfdc05dd2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">coreclr_execute_assembly</span><span class="w"></span>
<span class="w">  </span><span class="mi">40</span>:     <span class="mh">0x7ffe93b3971b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">41</span>:     <span class="mh">0x7ffe93b39a4c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">42</span>:     <span class="mh">0x7ffe93b3a3e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">corehost_main</span><span class="w"></span>
<span class="w">  </span><span class="mi">43</span>:     <span class="mh">0x7ffe9fb6b77c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">44</span>:     <span class="mh">0x7ffe9fb6e3f7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">45</span>:     <span class="mh">0x7ffe9fb7075f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">46</span>:     <span class="mh">0x7ffe9fb6ea53</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_close</span><span class="w"></span>
<span class="w">  </span><span class="mi">47</span>:     <span class="mh">0x7ffe9fb6850b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hostfxr_main_startupinfo</span><span class="w"></span>
<span class="w">  </span><span class="mi">48</span>:     <span class="mh">0x7ff6c39d1eb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">49</span>:     <span class="mh">0x7ff6c39d222b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">50</span>:     <span class="mh">0x7ff6c39d36d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">51</span>:     <span class="mh">0x7ffebb5774b4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">BaseThreadInitThunk</span><span class="w"></span>
<span class="w">  </span><span class="mi">52</span>:     <span class="mh">0x7ffebbce26a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RtlUserThreadStart</span><span class="w"></span>
<span class="n">Unhandled</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Wasmtime</span><span class="p">.</span><span class="n">TrapException</span>: <span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Option</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
</code></pre></div>
<p>I can reproduce the error, using the following configuration:</p>
<ul>
<li>Create a C# application (.NET 6.0) with "dotnet new console", containing a project reference to <code>Wasmtime.Dotnet</code> from commit <a href="https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b">https://github.com/bytecodealliance/wasmtime-dotnet/commit/415438c88eb9c3b8d52de924020ce21630fe070b</a>.</li>
<li>In the <code>Wasmtime.csproj</code>, remove the code for downloading <code>wasmtime</code>, and instead download <code>wasmtime-v3.0.0-x86_64-windows-c-api.zip</code> , and use the <code>wasmtime.dll</code> from there.</li>
<li>Use the following code in the C# application (<code>Program.cs</code>):</li>
</ul>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">Wasmtime</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Engine</span><span class="p">();</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Module</span><span class="p">.</span><span class="n">FromBytes</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"main"</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="p">(</span><span class="s">@"dotnet-codabix-wasm-build.wasm"</span><span class="p">));</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Linker</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Store</span><span class="p">(</span><span class="n">engine</span><span class="p">);</span><span class="w"></span>
<span class="n">linker</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">();</span><span class="w"></span>
<span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="p">);</span><span class="w"></span>

<span class="kt">var</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="s">"_start"</span><span class="p">)!;</span><span class="w"></span>
<span class="n">run</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<ul>
<li>Download the following .Zip file and extract <code>dotnet-codabix-wasm-build.wasm</code> from it (this is not actually a movie; I renamed the .zip to .mov to be able to upload it):<br>
<a href="https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov">https://user-images.githubusercontent.com/13289184/203989968-4639d6d5-15c9-4e57-bf01-c2eccd756642.mov</a></li>
</ul>
<p>When running the C# application, it should print the above error to the console.</p>
<p>I did not yet have a chance to try to reproduce it using a plain C application. Also, I did not manage to reproduce the access violation in the above C# application, as it seems a bit hard to reproduce, but I would assume it has the same cause as the above error.</p>
<p>Do you have any idea what could be causing this? Do you need any further information?</p>
<p>On a related note, I can also reproduce this error using the Wasmtime <strong>dev</strong> release from commit 28cf995fd3f9926a95036758c78390f54a0289ae, but it seems it needs much more time for compiling the module (18.6 seconds for the dev version, but only 2.8 seconds for the 3.0.0 version).</p>
<p>Thank you!<br>
</p>
</blockquote>



<a name="312213147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235325%20Unexpted%20error%20%22called%20%60Option%3A%3Aun.../near/312213147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235325.20Unexpted.20error.20.22called.20.60Option.3A.3Aun.2E.2E.2E.html#312213147">(Nov 25 2022 at 15:38)</a>:</h4>
<p>kpreisser edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5325#issuecomment-1327618043">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5325">issue #5325</a>:</p>
<blockquote>
<p>Thanks! You are right, this fixes the error. Unfortunately, this doesn't fix the access violation in our other application (where the call to <code>store.SetWasiConfiguration()</code> already occurs), so this actually seems to be a different error.</p>
<p>I will continue to try to reproduce that and then open a new issue if needed.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>