<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1269 [wasi-common]: add armv7 support to w... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html">wasmtime / PR #1269 [wasi-common]: add armv7 support to w...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="190166369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190166369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190166369">(Mar 10 2020 at 12:31)</a>:</h4>
<p>kubkon opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a> from <code>wasi-common-armv7</code> to <code>master</code>:</p>
<blockquote>
<p>This commit enables <code>target_pointer_width = 32</code> compatibility for <code>wasi-common</code> (and by transitivity, any crate found inside, e.g., <code>yanix</code>). I've also added a simplistic (bare minimum) check to our CI to ensure that <code>wasi-common</code> cross-compiles to <code>armv7-unknown-gnueabihf</code> fine. While here, I've done the same for <code>wasm32-unknown-emscripten</code>.</p>
<p>To avoid code duplication, I've added a custom ext trait <code>FileTimeExt</code> which implements seconds and nanoseconds accessors for with different impls for different pointer widths. I'm not sure whether that's the cleanest approach but definitely seemed like it at the time. Lemme know what you reckon!</p>
<p>Fixes #1219 </p>
<p>cc @stefson hopefully this fixes it for you :-)</p>
</blockquote>



<a name="190166370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190166370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190166370">(Mar 10 2020 at 12:31)</a>:</h4>
<p><strong>kubkon</strong> requested <a href="https://github.com/alexcrichton" target="_blank" title="https://github.com/alexcrichton">alexcrichton</a>, and <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<a name="190166371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190166371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190166371">(Mar 10 2020 at 12:31)</a>:</h4>
<p><strong>kubkon</strong> requested <a href="https://github.com/alexcrichton" target="_blank" title="https://github.com/alexcrichton">alexcrichton</a>, and <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<a name="190168789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190168789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190168789">(Mar 10 2020 at 13:05)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371922821" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371922821">PR Review</a>.</p>



<a name="190168790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190168790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190168790">(Mar 10 2020 at 13:05)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371922821" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371922821">PR Review</a>.</p>



<a name="190168791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190168791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190168791">(Mar 10 2020 at 13:05)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390291258" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390291258">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, seeing this written out reminds me that some 32-bit targets are transitioning to a 64-bit <code>time_t</code> and making their <code>tv_sec</code> a <code>time_t</code> to fix the 2038 bug. So what we could do instead here would be to change the <code>Result&lt;i32&gt;</code> here to a <code>Result&lt;libc::time_t&gt;</code>, and that should work for both 32-bit and 64-bit targets. It can still use <code>try_into</code>, but it should get optimized away in the case where <code>time_t</code> is 64-bit.</p>
</blockquote>



<a name="190168792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190168792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190168792">(Mar 10 2020 at 13:05)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390296588" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390296588">PR Review Comment</a>:</p>
<blockquote>
<p>We should use <code>libc::c_long</code> here. Or even better, can we use <code>libc::UTIME_NOW</code> and <code>libc::UTIME_OMIT</code> instead of defining our own copies?</p>
</blockquote>



<a name="190168793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190168793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190168793">(Mar 10 2020 at 13:05)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390293483" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390293483">PR Review Comment</a>:</p>
<blockquote>
<p>For nanoseconds, the <code>filetime</code> library <a href="https://docs.rs/filetime/0.2.8/filetime/struct.FileTime.html#method.nanoseconds" target="_blank" title="https://docs.rs/filetime/0.2.8/filetime/struct.FileTime.html#method.nanoseconds">documents</a> that the nanoseconds value is always less than 1 billion, so any value it returns should be convertible to <code>i32</code>, so we can just <code>.try_into().unwrap()</code>.</p>
</blockquote>



<a name="190174418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174418">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371975831" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371975831">PR Review</a>.</p>



<a name="190174419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174419">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332440" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332440">PR Review Comment</a>:</p>
<blockquote>
<p>That's a good point actually. As far as I can remember, the main reason why we'd define them ourselves was to support older <code>libc</code> crates where those constants were incorrectly defined for some targets (netbsd and macos are the awkward ones among others). Given that they are now fixed in <code>libc</code>, I'm happy to reuse their definitions instead <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>
</blockquote>



<a name="190174427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174427">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371975927" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371975927">PR Review</a>.</p>



<a name="190174428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174428">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332520" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332520">PR Review Comment</a>:</p>
<blockquote>
<p>Good catch, thanks!</p>
</blockquote>



<a name="190174441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174441">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371976054" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-371976054">PR Review</a>.</p>



<a name="190174442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174442">(Mar 10 2020 at 13:59)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332631" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390332631">PR Review Comment</a>:</p>
<blockquote>
<p>Excellent!</p>
</blockquote>



<a name="190174567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174567">(Mar 10 2020 at 14:00)</a>:</h4>
<p>kubkon updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a> from <code>wasi-common-armv7</code> to <code>master</code>:</p>
<blockquote>
<p>This commit enables <code>target_pointer_width = 32</code> compatibility for <code>wasi-common</code> (and by transitivity, any crate found inside, e.g., <code>yanix</code>). I've also added a simplistic (bare minimum) check to our CI to ensure that <code>wasi-common</code> cross-compiles to <code>armv7-unknown-gnueabihf</code> fine. While here, I've done the same for <code>wasm32-unknown-emscripten</code>.</p>
<p>To avoid code duplication, I've added a custom ext trait <code>FileTimeExt</code> which implements seconds and nanoseconds accessors for with different impls for different pointer widths. I'm not sure whether that's the cleanest approach but definitely seemed like it at the time. Lemme know what you reckon!</p>
<p>Fixes #1219 </p>
<p>cc @stefson hopefully this fixes it for you :-)</p>
</blockquote>



<a name="190174712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190174712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190174712">(Mar 10 2020 at 14:01)</a>:</h4>
<p><strong>kubkon</strong> requested <a href="https://github.com/alexcrichton" target="_blank" title="https://github.com/alexcrichton">alexcrichton</a>, and <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<a name="190187691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187691">(Mar 10 2020 at 15:42)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372072785" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372072785">PR Review</a>.</p>



<a name="190187695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187695">(Mar 10 2020 at 15:42)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372072785" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372072785">PR Review</a>.</p>



<a name="190187701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187701">(Mar 10 2020 at 15:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390411337" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390411337">PR Review Comment</a>:</p>
<blockquote>
<p>Could we avoid having this <code>#[cfg]</code>? It seems like it'd be best to just always have the <code>try_into().unwrap()</code>, and that I think means we could also remove  the <code>_checked</code> from the name, right?</p>
</blockquote>



<a name="190187704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187704">(Mar 10 2020 at 15:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390410829" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390410829">PR Review Comment</a>:</p>
<blockquote>
<p>Is the <code>#[cfg]</code> here necessary? </p>
<p>I'd love to have as few <code>#[cfg]</code> as necessary and it seems like we'd want this logic on all platforms?</p>
</blockquote>



<a name="190187705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187705">(Mar 10 2020 at 15:42)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390409269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390409269">PR Review Comment</a>:</p>
<blockquote>
<p>Since this likely executes pretty quickly I don't think we necessarily need to have two whole builders for this, could these be collapsed perhaps into a single "check all the targets" builder?</p>
</blockquote>



<a name="190187913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187913">(Mar 10 2020 at 15:43)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372077382" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372077382">PR Review</a>.</p>



<a name="190187915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190187915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190187915">(Mar 10 2020 at 15:43)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390412993" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390412993">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed! You beat me to it actually! I was just reworking this bit as it seems silly to have <code>unwrap</code> wrapped in <code>Result</code> :-D</p>
</blockquote>



<a name="190188108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188108">(Mar 10 2020 at 15:45)</a>:</h4>
<p>kubkon submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372078740" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372078740">PR Review</a>.</p>



<a name="190188109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188109">(Mar 10 2020 at 15:45)</a>:</h4>
<p>kubkon created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414049" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414049">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed about <code>#[cfg]</code>s.</p>
<p>Hmm, do you reckon we could collapse both <code>from_raw</code> versions into one with <code>try_into</code>?</p>
</blockquote>



<a name="190188165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188165">(Mar 10 2020 at 15:45)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372075785" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372075785">PR Review</a>.</p>



<a name="190188166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188166">(Mar 10 2020 at 15:45)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372075785" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372075785">PR Review</a>.</p>



<a name="190188167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188167">(Mar 10 2020 at 15:45)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390411686" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390411686">PR Review Comment</a>:</p>
<blockquote>
<p>We can take this even further: <code>tv_nsec</code> is always a <code>libc::c_long</code>, so we can return that for both 32-bit and 64-bit platforms and avoid the <code>target_pointer_width</code> checks, and since the check always succeeds, we can just return the value instead of a <code>Result</code>.</p>
</blockquote>



<a name="190188170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188170">(Mar 10 2020 at 15:45)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414227" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414227">PR Review Comment</a>:</p>
<blockquote>
<p>And now that I think about it, we can do a similar thing here -- just have one version for both 32-bit and 64-bit platforms, which returns a <code>Result&lt;libc::c_long&gt;</code>, and we can rely on the compiler to optimize away the <code>map_err</code> in the case where <code>c_long</code> is 64-bit.</p>
</blockquote>



<a name="190188507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188507">(Mar 10 2020 at 15:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390416326" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390416326">PR Review Comment</a>:</p>
<blockquote>
<p>Ah yeah @sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414227" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#discussion_r390414227">put it well here</a></p>
</blockquote>



<a name="190188508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190188508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190188508">(Mar 10 2020 at 15:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372081609" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372081609">PR Review</a>.</p>



<a name="190190805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190190805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190190805">(Mar 10 2020 at 16:05)</a>:</h4>
<p>kubkon updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a> from <code>wasi-common-armv7</code> to <code>master</code>:</p>
<blockquote>
<p>This commit enables <code>target_pointer_width = 32</code> compatibility for <code>wasi-common</code> (and by transitivity, any crate found inside, e.g., <code>yanix</code>). I've also added a simplistic (bare minimum) check to our CI to ensure that <code>wasi-common</code> cross-compiles to <code>armv7-unknown-gnueabihf</code> fine. While here, I've done the same for <code>wasm32-unknown-emscripten</code>.</p>
<p>To avoid code duplication, I've added a custom ext trait <code>FileTimeExt</code> which implements seconds and nanoseconds accessors for with different impls for different pointer widths. I'm not sure whether that's the cleanest approach but definitely seemed like it at the time. Lemme know what you reckon!</p>
<p>Fixes #1219 </p>
<p>cc @stefson hopefully this fixes it for you :-)</p>
</blockquote>



<a name="190191296"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190191296" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190191296">(Mar 10 2020 at 16:09)</a>:</h4>
<p>kubkon updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a> from <code>wasi-common-armv7</code> to <code>master</code>:</p>
<blockquote>
<p>This commit enables <code>target_pointer_width = 32</code> compatibility for <code>wasi-common</code> (and by transitivity, any crate found inside, e.g., <code>yanix</code>). I've also added a simplistic (bare minimum) check to our CI to ensure that <code>wasi-common</code> cross-compiles to <code>armv7-unknown-gnueabihf</code> fine. While here, I've done the same for <code>wasm32-unknown-emscripten</code>.</p>
<p>To avoid code duplication, I've added a custom ext trait <code>FileTimeExt</code> which implements seconds and nanoseconds accessors for with different impls for different pointer widths. I'm not sure whether that's the cleanest approach but definitely seemed like it at the time. Lemme know what you reckon!</p>
<p>Fixes #1219 </p>
<p>cc @stefson hopefully this fixes it for you :-)</p>
</blockquote>



<a name="190191351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190191351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190191351">(Mar 10 2020 at 16:09)</a>:</h4>
<p><strong>kubkon</strong> requested <a href="https://github.com/alexcrichton" target="_blank" title="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<a name="190191352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190191352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190191352">(Mar 10 2020 at 16:09)</a>:</h4>
<p><strong>kubkon</strong> requested <a href="https://github.com/alexcrichton" target="_blank" title="https://github.com/alexcrichton">alexcrichton</a>, and <a href="https://github.com/sunfishcode" target="_blank" title="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<a name="190192055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190192055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190192055">(Mar 10 2020 at 16:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372107504" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269#pullrequestreview-372107504">PR Review</a>.</p>



<a name="190206855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231269%20%5Bwasi-common%5D%3A%20add%20armv7%20support%20to%20w.../near/190206855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231269.20.5Bwasi-common.5D.3A.20add.20armv7.20support.20to.20w.2E.2E.2E.html#190206855">(Mar 10 2020 at 18:19)</a>:</h4>
<p>kubkon merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1269" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1269">PR #1269</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>