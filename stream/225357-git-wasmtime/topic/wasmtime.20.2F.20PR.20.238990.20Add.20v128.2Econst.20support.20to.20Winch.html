<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8990 Add v128.const support to Winch · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html">wasmtime / PR #8990 Add v128.const support to Winch</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="453247194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247194">(Jul 22 2024 at 18:25)</a>:</h4>
<p>jeffcharles opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a> from <code>jeffcharles:winch-add-v128-const</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;<br>
Adding support for <code>v128.const</code> to Winch. Start of work to add SIMD support to Winch for the x64 architecture.</p>
</blockquote>



<a name="453247458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247458">(Jul 22 2024 at 18:26)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2192273858">PR review</a>.</p>



<a name="453247459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247459">(Jul 22 2024 at 18:26)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1686977469">PR review comment</a>:</p>
<blockquote>
<p>Not sure if we want to keep the <code>wasm_features(simd)</code> check on here since this is a SIMD test. I removed it so the test would run on Winch.</p>
</blockquote>



<a name="453247833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247833">(Jul 22 2024 at 18:27)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2192277822">PR review</a>.</p>



<a name="453247836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247836">(Jul 22 2024 at 18:27)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1686978793">PR review comment</a>:</p>
<blockquote>
<p>This is a result of changing how memory values are popped from the stack. It now uses the type of the Wasm value to determine the scratch register to use so this now uses the XMM scratch register instead of a GPR.</p>
</blockquote>



<a name="453247923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247923">(Jul 22 2024 at 18:27)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2192278828">PR review</a>.</p>



<a name="453247924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453247924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453247924">(Jul 22 2024 at 18:27)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1686979151">PR review comment</a>:</p>
<blockquote>
<p>Ditto for this change to the disass.</p>
</blockquote>



<a name="453248283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453248283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453248283">(Jul 22 2024 at 18:29)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2192283871">PR review</a>.</p>



<a name="453248286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453248286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453248286">(Jul 22 2024 at 18:29)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1686981133">PR review comment</a>:</p>
<blockquote>
<p>This now needs to handle 128 bit values so using the GPR scratch won't work.</p>
</blockquote>



<a name="453248352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453248352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453248352">(Jul 22 2024 at 18:29)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453253934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453253934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453253934">(Jul 22 2024 at 18:56)</a>:</h4>
<p><strong>jeffcharles</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a> as ready for review.</p>



<a name="453253936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453253936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453253936">(Jul 22 2024 at 18:56)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453253937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453253937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453253937">(Jul 22 2024 at 18:56)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453253938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453253938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453253938">(Jul 22 2024 at 18:56)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453282661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453282661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453282661">(Jul 22 2024 at 21:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#issuecomment-2243866778">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="453425234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453425234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453425234">(Jul 23 2024 at 14:10)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194085743">PR review</a>:</p>
<blockquote>
<p>It's going on a good direction!</p>
<p>One thing that we need to also update as part of this PR is the stack alignment details in the ABI.</p>
<p>Currently, the <a href="https://github.com/bytecodealliance/wasmtime/blob/main/winch/codegen/src/isa/x64/abi.rs#L66">stack alignment</a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/main/winch/codegen/src/isa/x64/abi.rs#L156">slot size</a> are both set to 8 bytes, given that types &gt; 8 bytes were not supported. We'd probably want to ensure that it's now set to 16.</p>
</blockquote>



<a name="453425235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453425235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453425235">(Jul 23 2024 at 14:10)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194085743">PR review</a>:</p>
<blockquote>
<p>It's going on a good direction!</p>
<p>One thing that we need to also update as part of this PR is the stack alignment details in the ABI.</p>
<p>Currently, the <a href="https://github.com/bytecodealliance/wasmtime/blob/main/winch/codegen/src/isa/x64/abi.rs#L66">stack alignment</a> and <a href="https://github.com/bytecodealliance/wasmtime/blob/main/winch/codegen/src/isa/x64/abi.rs#L156">slot size</a> are both set to 8 bytes, given that types &gt; 8 bytes were not supported. We'd probably want to ensure that it's now set to 16.</p>
</blockquote>



<a name="453425237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453425237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453425237">(Jul 23 2024 at 14:10)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688122381">PR review comment</a>:</p>
<blockquote>
<p>I've been giving a bit of thought to this change. If I'm not wrong the motivation is to future-proof, be explicit and correctly differentiate the scratch register for different types (GPR, FPR) and sizes (FPR vs v128). </p>
<p>I'm wondering if there's an alternative way that would allow a similar outcome without need to introduce more <code>*_scratch_reg</code> variations. One option that I can think of is to remove <code>scratch_reg</code> and <code>float_scratch_reg</code> and rely exclusively on <code>scratch_for</code> and <code>sratch!(M, &amp;ty)</code> method and macro respectively. This might make it easier to encapsulate the details of which register should be used depending on the type/size/architecture.</p>
</blockquote>



<a name="453425891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453425891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453425891">(Jul 23 2024 at 14:14)</a>:</h4>
<p>saulecabrera edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688122381">PR review comment</a>.</p>



<a name="453426931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453426931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453426931">(Jul 23 2024 at 14:20)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194141241">PR review</a>.</p>



<a name="453426935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453426935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453426935">(Jul 23 2024 at 14:20)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688155585">PR review comment</a>:</p>
<blockquote>
<p>Yeah I debated whether to just use the float scratch register directly but that seemed like it would be mixing different levels of abstraction. Changing everything to use <code>scratch_for</code> or <code>scratch!(M, &amp;ty)</code> instead makes sense to me. I'll make those changes. Might try doing that in a separate PR to keep it easier to review.</p>
</blockquote>



<a name="453446716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453446716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453446716">(Jul 23 2024 at 15:31)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194338352">PR review</a>.</p>



<a name="453446717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453446717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453446717">(Jul 23 2024 at 15:31)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688276971">PR review comment</a>:</p>
<blockquote>
<p>I looked into this a little more, the <code>scratch!</code> macro relies on <code>scratch_for</code> and <code>scratch_for</code> relies on the <code>scratch_reg</code> and <code>float_scratch_reg</code> methods being present on the ABI trait. I could remove <code>scratch_reg</code> and <code>float_scratch_reg</code> from the trait and move the implementation of <code>scratch_for</code> into the ABI trait implementations. The logic isn't that complicated so repeating the logic in each trait implementation with the registers hard-coded wouldn't necessarily be too bad.</p>
<p>Alternatively, I could not add <code>vector_scratch_reg</code> on the trait, update <code>scratch_for</code> to use the <code>float_scratch_register</code> for v128, and update <code>store_impl</code> to use <code>scratch_for</code>. That'll avoid having to implement <code>scratch_for</code> for each ABI trait implementation.</p>
</blockquote>



<a name="453447848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453447848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453447848">(Jul 23 2024 at 15:38)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194354766">PR review</a>.</p>



<a name="453447851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453447851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453447851">(Jul 23 2024 at 15:38)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688286846">PR review comment</a>:</p>
<blockquote>
<p>In my original comment I was leaning more towards the first option from your comment above: moving <code>scratch_for</code> to each ABI implementation, hoping to (i) get the most flexibility (architecture-wise) at the cost of some repetition (ii) reduce the number of scratch related methods from the ABI trait. </p>
</blockquote>



<a name="453456334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453456334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453456334">(Jul 23 2024 at 16:10)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194437375">PR review</a>.</p>



<a name="453456338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453456338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453456338">(Jul 23 2024 at 16:10)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688337731">PR review comment</a>:</p>
<blockquote>
<p>Opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8999">https://github.com/bytecodealliance/wasmtime/pull/8999</a> to do the refactoring.</p>
</blockquote>



<a name="453480226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453480226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453480226">(Jul 23 2024 at 17:50)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453480682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453480682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453480682">(Jul 23 2024 at 17:53)</a>:</h4>
<p>jeffcharles submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2194672976">PR review</a>.</p>



<a name="453480683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453480683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453480683">(Jul 23 2024 at 17:53)</a>:</h4>
<p>jeffcharles created <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#discussion_r1688478955">PR review comment</a>:</p>
<blockquote>
<p>I could change this to just reuse the existing floating point register methods given this is inside the x64 ABI if that would be preferable.</p>
</blockquote>



<a name="453480989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453480989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453480989">(Jul 23 2024 at 17:55)</a>:</h4>
<p>jeffcharles <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#issuecomment-2245886836">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>:</p>
<blockquote>
<p>The merge commit removed the new vector method on the ABI trait. Not sure if you would like me to do the same with the <code>next_vr</code> and associated methods I've added in the X64ABI file.</p>
</blockquote>



<a name="453480993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453480993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453480993">(Jul 23 2024 at 17:55)</a>:</h4>
<p><strong>jeffcharles</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453482352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453482352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453482352">(Jul 23 2024 at 18:02)</a>:</h4>
<p>saulecabrera <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#issuecomment-2245912511">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>:</p>
<blockquote>
<blockquote>
<p>The merge commit removed the new vector method on the ABI trait. Not sure if you would like me to do the same with the <code>next_vr</code> and associated methods I've added in the X64ABI file.</p>
</blockquote>
<p>Yeah it sounds reasonable to me to get rid of <code>next_vr</code> and <code>vector_reg_for</code> 👍🏽 </p>
</blockquote>



<a name="453484338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453484338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453484338">(Jul 23 2024 at 18:11)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453487813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453487813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453487813">(Jul 23 2024 at 18:23)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453490417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453490417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453490417">(Jul 23 2024 at 18:32)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453760849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453760849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453760849">(Jul 24 2024 at 17:48)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453769307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453769307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453769307">(Jul 24 2024 at 18:28)</a>:</h4>
<p>jeffcharles updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<a name="453772745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453772745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453772745">(Jul 24 2024 at 18:52)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8990#pullrequestreview-2197528811">PR review</a>:</p>
<blockquote>
<p>This looks great to me, thanks!</p>
</blockquote>



<a name="453775373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238990%20Add%20v128.const%20support%20to%20Winch/near/453775373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238990.20Add.20v128.2Econst.20support.20to.20Winch.html#453775373">(Jul 24 2024 at 19:08)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8990">PR #8990</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>