<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3730 Tracking: Implement sock_accept an... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html">wasmtime / issue #3730 Tracking: Implement sock_accept an...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="269563076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/269563076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#269563076">(Jan 27 2022 at 12:08)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] More networking test cases<br>
</li>
</ul>
</blockquote>



<a name="269563236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/269563236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#269563236">(Jan 27 2022 at 12:10)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[ ] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269736703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/269736703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#269736703">(Jan 28 2022 at 13:40)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[ ] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269744237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/269744237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#269744237">(Jan 28 2022 at 14:31)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[ ] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="270027779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/270027779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#270027779">(Jan 31 2022 at 13:08)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[x] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="270164249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/270164249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#270164249">(Feb 01 2022 at 07:45)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[ ] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[x] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="282759636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/282759636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#282759636">(May 18 2022 at 09:09)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[x] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="282760091"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/282760091" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#282760091">(May 18 2022 at 09:13)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[x] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[x] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="315073162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/315073162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#315073162">(Dec 10 2022 at 12:52)</a>:</h4>
<p>huangjj27 <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-1345258572">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>How is this going on? I try to use just  <code>std::net::TcpListener</code> to handle TcpStream and it raises errors that wasi is not supported yet.</p>
</blockquote>



<a name="340106283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/340106283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#340106283">(Mar 07 2023 at 13:14)</a>:</h4>
<p>hlubek <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-1458152084">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>Is there a way to use <code>sock_accept</code> (and reading / writing) without having a busy wait loop?<br>
With wasmtime I couldn't see that <code>poll_oneoff</code> could be used to wait on the preopened fd to wait for a new connection.</p>
</blockquote>



<a name="342929588"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/342929588" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#342929588">(Mar 19 2023 at 12:47)</a>:</h4>
<p>Kerosin3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-1475243846">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<blockquote>
<p>How is this going on? I try to use just <code>std::net::TcpListener</code> to handle TcpStream and it raises errors that wasi is not supported yet.</p>
</blockquote>
<p>Any success in this direction?  <br>
</p>
</blockquote>



<a name="342931220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/342931220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#342931220">(Mar 19 2023 at 12:57)</a>:</h4>
<p>Kerosin3 deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-1475243846">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<blockquote>
<p>How is this going on? I try to use just <code>std::net::TcpListener</code> to handle TcpStream and it raises errors that wasi is not supported yet.</p>
</blockquote>
<p>Any success in this direction?  <br>
</p>
</blockquote>



<a name="343112055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/343112055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#343112055">(Mar 20 2023 at 12:59)</a>:</h4>
<p>Kerosin3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-1476189427">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<blockquote>
<p>How is this going on? I try to use just <code>std::net::TcpListener</code> to handle TcpStream and it raises errors that wasi is not supported yet.<br>
passing <code> --tcplisten=127.0.0.1:10000 </code>  to wasmtime and then </p>
</blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span>::<span class="n">net</span>::<span class="n">TcpStream</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">set_nonblocking</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">context</span><span class="p">(</span><span class="s">"failed to set non-blocking flag on socket"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">  </span><span class="n">TcpListener</span>::<span class="n">from_std</span><span class="p">(</span><span class="n">stdlistener</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>makes the passed socket available to use in server app.</p>
<p>btw I dont know how to perform connect when writing a client app.<br>
passing <code> --tcplisten=127.0.0.1:10000 </code> to client wasm app in case server is running is not possible. (socket already in use)<br>
but enarx example seems to achieve this functionality <a href="http://url">https://github.com/enarx/codex/blob/main/demos/chat-client/rust/src/main.rs#L32</a><br>
I still haven't figured out whether this functionality implemented in wasi .. If anyone can provide any info about how pass a socket to wasm client via wasmtime to perform a connection.. would be great</p>
</blockquote>



<a name="436238510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/436238510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#436238510">(Apr 30 2024 at 10:17)</a>:</h4>
<p>maxwellflitton <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-2084918668">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>@Kerosin3 did you have any luck with this? I just want the TCP to be listening from the wasmtime runtime </p>
</blockquote>



<a name="436675962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/436675962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#436675962">(May 02 2024 at 11:53)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>With the addition of <code>sock_accept()</code> in <a href="https://github.com/bytecodealliance/wasi/commit/984fa4fc17a074e8ea720cf319ad5e0357a991c7"><code>wasi-0.11.0</code></a>, wasmtime can now implement basic networking for pre-opened sockets.</p>
<h3>Todo</h3>
<ul>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">https://github.com/bytecodealliance/wasmtime/pull/3711</a></li>
<li>[x] <a href="https://github.com/bytecodealliance/wasmtime/pull/3729">https://github.com/bytecodealliance/wasmtime/pull/3729</a></li>
<li>[x] Rust: <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a></li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix) to make <code>fd_prestat_get()</code> work for sockets</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Fix <code>get_fdflags()</code> for sockets on Windows</li>
<li>[ ] More networking test cases</li>
<li>[x] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="p">))</span>
</code></pre></div>
</blockquote>



<a name="436675966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/436675966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#436675966">(May 02 2024 at 11:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-2090312148">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>I'm actually going to go ahead and close this as more-or-less not planned at this time. The wasip1 proposal's implementation of sockets was never fully completed, however the wasip2 implementation does have a full suite of socket-based APIs for use. If it works I'd recommend using the wasip2-based APIs.</p>
</blockquote>



<a name="436689755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/436689755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#436689755">(May 02 2024 at 13:08)</a>:</h4>
<p>FrankReh <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-2090461623">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>I've actually seen the <code>mio</code> Wasm tcp listener just work with the latest <code>wasmtime</code>, once I used the <code>-S preview2=n -S tcplisten=...</code> options to run. I had to modify some lines within the <code>mio</code> src too since it is now treating warnings as errors and the wasi build target of <code>mio</code> was causing all sorts of warnings (well at least two, my memory of what all the failures were two days ago is fuzzy).</p>
<p>So the <code>mio</code> Wasm example is able to listen to a socket opened up by <code>wasmtime</code> and interact with <code>nc</code> processes I opened from other terminals. It's cool and I actually didn't expect it to work, so I may dig a little deeper to understand how it works with a Wasm module (a preview1 image).</p>
</blockquote>



<a name="436911872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233730%20Tracking%3A%20Implement%20sock_accept%20an.../near/436911872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233730.20Tracking.3A.20Implement.20sock_accept.20an.2E.2E.2E.html#436911872">(May 03 2024 at 15:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3730#issuecomment-2093280090">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3730">issue #3730</a>:</p>
<blockquote>
<p>I commented in another issue as well but if it aligns with your goals one thing that might be good is to implement mio's support for WASI in terms of the wasip2 target with wasi-sockets. Otherwise though I'm glad you were able to find the <code>-Spreview2=n</code> flag for local testing for now (sorry again for the bad name...)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>