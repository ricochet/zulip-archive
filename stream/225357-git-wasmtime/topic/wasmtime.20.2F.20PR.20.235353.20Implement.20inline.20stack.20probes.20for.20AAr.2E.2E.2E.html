<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5353 Implement inline stack probes for AAr... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html">wasmtime / PR #5353 Implement inline stack probes for AAr...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="313096435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313096435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313096435">(Nov 30 2022 at 16:17)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a> from <code>inline-probe-aarch64</code> to <code>main</code>:</p>
<blockquote>
<p>This PR implements necessary support for inline stack probes in the AArch64 backend and then enables the support in Wasmtime. This builds on <a href="https://github.com/bytecodealliance/wasmtime/pull/5350">https://github.com/bytecodealliance/wasmtime/pull/5350</a> to ensure that on these hosts an accidentally misconfigured <code>Config</code> will still guarantee that wasm itself will run into the guard page for the stack rather than skipping over it.</p>
<p>The commits here have been split out with various refactorings for inline stack probes, including a minor optimization for amodes in the aarch64 backend. I'd appreciate some close review on the aarch64 bits since I'm mostly just going with what works first and I don't necessarily fully understand the implications of the changes.</p>
</blockquote>



<a name="313098983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313098983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313098983">(Nov 30 2022 at 16:28)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#pullrequestreview-1199649471">PR review</a>.</p>



<a name="313098984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313098984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313098984">(Nov 30 2022 at 16:28)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036189858">PR review comment</a>:</p>
<blockquote>
<p>*instruction</p>
</blockquote>



<a name="313101860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313101860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313101860">(Nov 30 2022 at 16:41)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a> from <code>inline-probe-aarch64</code> to <code>main</code>.</p>



<a name="313112508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112508">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#pullrequestreview-1199718319">PR review</a>.</p>



<a name="313112509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112509">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#pullrequestreview-1199718319">PR review</a>.</p>



<a name="313112511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112511">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036236533">PR review comment</a>:</p>
<blockquote>
<p>Can we keep the closing parens all together (Lisp-style)?</p>
</blockquote>



<a name="313112512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112512">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036238348">PR review comment</a>:</p>
<blockquote>
<p>s/a/an/</p>
<p>Also can we note here that it's careful not to use spilltmp or tmp2, so these registers are allowed to be inputs?</p>
</blockquote>



<a name="313112513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112513">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036238892">PR review comment</a>:</p>
<blockquote>
<p>Note here that this code is being generated post-regalloc, so the temps are allowable to use?</p>
</blockquote>



<a name="313112514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112514">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036250192">PR review comment</a>:</p>
<blockquote>
<p>Can we add a note here that we must be careful not to use addressing modes that use spilltmp or tmp2, and this is currently satisfied by using the reg-reg addressing mode (i.e., no large offsets, which we sometimes synthesize into a tmp)?</p>
</blockquote>



<a name="313112515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313112515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313112515">(Nov 30 2022 at 17:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#discussion_r1036240289">PR review comment</a>:</p>
<blockquote>
<p>s/lik/like/</p>
</blockquote>



<a name="313114933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313114933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313114933">(Nov 30 2022 at 17:39)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a> from <code>inline-probe-aarch64</code> to <code>main</code>.</p>



<a name="313116606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313116606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313116606">(Nov 30 2022 at 17:48)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a> from <code>inline-probe-aarch64</code> to <code>main</code>.</p>



<a name="313116772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313116772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313116772">(Nov 30 2022 at 17:49)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a> from <code>inline-probe-aarch64</code> to <code>main</code>.</p>



<a name="313120900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313120900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313120900">(Nov 30 2022 at 18:06)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5353#pullrequestreview-1199798746">PR review</a>.</p>



<a name="313125867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235353%20Implement%20inline%20stack%20probes%20for%20AAr.../near/313125867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235353.20Implement.20inline.20stack.20probes.20for.20AAr.2E.2E.2E.html#313125867">(Nov 30 2022 at 18:30)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5353">PR #5353</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>