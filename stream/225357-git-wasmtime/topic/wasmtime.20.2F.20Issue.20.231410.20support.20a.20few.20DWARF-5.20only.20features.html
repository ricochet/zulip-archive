<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1410 support a few DWARF-5 only features · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html">wasmtime / Issue #1410 support a few DWARF-5 only features</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="191884113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/191884113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#191884113">(Mar 26 2020 at 13:31)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-604432839" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-604432839">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik does your self-assignment mean I shouldn't add any more commits?</p>
</blockquote>



<a name="191884841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/191884841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#191884841">(Mar 26 2020 at 13:37)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-604435418" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-604435418">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>No, it means that he will review this PR once it is ready.</p>
</blockquote>



<a name="194953333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194953333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194953333">(Apr 22 2020 at 16:03)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617871923" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617871923">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik I have now added <code>DW_FORM_addrx*</code> in two spots, and I would expect that frames for subprograms would fill with parameters in <code>lldb</code>. They do for <code>fib-was.c</code> but not for my <code>fib-was.mo.wasm</code> on this branch. I wonder what I am missing here. Where should I start debugging this? Any tips?</p>
</blockquote>



<a name="194962631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194962631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194962631">(Apr 22 2020 at 17:13)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617912167" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617912167">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>They do for fib-was.c but not for my fib-was.mo.wasm on this branch. I wonder what I am missing here.</p>
</blockquote>
<p>@ggreif I don't see <code>DW_AT_high_pc</code> defined for any subprogram in fib-was.mo.wasm. I'm sure how the transform will behave for subprogram without code range defined.</p>
</blockquote>



<a name="194962660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194962660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194962660">(Apr 22 2020 at 17:13)</a>:</h4>
<p>yurydelendik edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617912167" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617912167">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>They do for fib-was.c but not for my fib-was.mo.wasm on this branch. I wonder what I am missing here.</p>
</blockquote>
<p>@ggreif I don't see <code>DW_AT_high_pc</code> defined for any subprogram in fib-was.mo.wasm. I'm not sure how the transform will behave for subprogram without code range defined.</p>
</blockquote>



<a name="194963712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194963712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194963712">(Apr 22 2020 at 17:20)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617916322" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617916322">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Correct. I didn't bother adding <code>DW_AT_high_pc</code> yet. But I have seen that the garbage collector does mark my subprograms as live even without it, so I should be safe.</p>
<p>I am mostly wondering if there are any gotchas about the frame structure that I should know. I guess the type definitions are passed through unchanged.</p>
</blockquote>



<a name="194964103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194964103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194964103">(Apr 22 2020 at 17:23)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617916322" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617916322">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Correct. I didn't bother adding <code>DW_AT_high_pc</code> yet. But I have seen that the garbage collector does mark my subprograms as live even without it, so I should be safe. I should say that I can set breakpoints, but <code>(lldb) frame var</code> will be empty a.t.m.</p>
<p>I am mostly wondering if there are any gotchas about the frame structure that I should know. I guess the type definitions are passed through unchanged.</p>
</blockquote>



<a name="194965087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194965087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194965087">(Apr 22 2020 at 17:30)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617921700" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617921700">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>I didn't bother adding DW_AT_high_pc yet.</p>
</blockquote>
<p>Can you add support for <code>DW_AT_high_pc</code>? That's one of main differences between fib-was.c and <a href="http://fib-was.mo" title="http://fib-was.mo">fib-was.mo</a>.</p>
</blockquote>



<a name="194965146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194965146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194965146">(Apr 22 2020 at 17:31)</a>:</h4>
<p>yurydelendik edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617921700" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617921700">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>I didn't bother adding DW_AT_high_pc yet.</p>
</blockquote>
<p>Can you add support for <code>DW_AT_high_pc</code>? That's one of main differences between fib-was.c and <a href="http://fib-was.mo" title="http://fib-was.mo">fib-was.mo</a>.</p>
<p>P.S. that might be affecting <code>frame var</code></p>
</blockquote>



<a name="194982546"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194982546" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194982546">(Apr 22 2020 at 19:49)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617998287" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-617998287">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>I have updated the binary with <code>DW_AT_high_pc</code>, but I still cannot see the formal parameter in <code>lldb</code>. I am beginning to think that a DWARF-5-ism is the reason, and the code bails out somewhere. I guess the <code>DW_AT_language</code> is not a significant difference?</p>
</blockquote>



<a name="194985811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194985811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194985811">(Apr 22 2020 at 20:16)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618015968" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618015968">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Hard to say, I just tried running your branch and it failed at clone_line_program -- the .debug_line format can differ between v4 and v5.</p>
<p>Also DWARF expressions look rather weird: just <code>DW_OP_plus_uconst </code> is old and it also will not work without <code>DW_AT_frame_base</code>.</p>
<p>Try to use <code>cargo run -- wasm2obj</code> to generate object file and inspect the result file using dwarfdump.</p>
</blockquote>



<a name="194988891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194988891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194988891">(Apr 22 2020 at 20:43)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>Hard to say, I just tried running your branch and it failed at clone_line_program -- the .debug_line format can differ between v4 and v5.</p>
</blockquote>
<p>I have a quick hack for that. The reason is that file number <code>0</code> is allowed in DWARF-5, but not in 4.</p>
<p>Here is the diff</p>
<div class="codehilite"><pre><span></span><span class="gh">diff --git a/crates/debug/src/transform/line_program.rs b/crates/debug/src/transform/line_program.rs</span>
<span class="gh">index 499a1300..862bf5d3 100644</span>
<span class="gd">--- a/crates/debug/src/transform/line_program.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/line_program.rs</span>
<span class="gu">@@ -238,7 +238,8 @@ where</span>
                         };
                         out_program.row().address_offset = address_offset;
                         out_program.row().op_index = *op_index;

<span class="gd">-                        out_program.row().file = files[(file_index - 1) as usize];</span>
<span class="gi">+                        out_program.row().file = files[(if *file_index as i64 &lt;= 0 {0} else {file_index - 1}) as usize];</span>
<span class="gi">+                        // out_program.row().file = if *file_index as i64 &lt;= 0 {write::line::id::zero()} else {files[(file_index - 1) as usize]};</span>
                         out_program.row().line = *line;
                         out_program.row().column = *column;
                         out_program.row().discriminator = *discriminator;
</pre></div>


<p>Sorry!</p>
<p>Regarding <code>DW_OP_plus_uconst</code>, yes this is a provocation to <code>lldb</code> which would emit warnings when <code>frame var</code> is processed. Alas they don't appear with my program. They do with the <code>fib-wasm.wasm</code> one.</p>
<p>Which brings me to the question: Are the loc programs in <code>DW_AT_frame_base</code> and <code>DW_AT_location</code> supposed to be concatenated for each argument/local? I am a bit puzzled to see what <code>clang-11</code> seems to emit. (Those binaries live in the main repo, I temporarily reverted them to <code>clang-10</code> on my branch.)</p>
</blockquote>



<a name="194989638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194989638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194989638">(Apr 22 2020 at 20:50)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618033002" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618033002">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Wow, thanks for the tip!</p>
<div class="codehilite"><pre><span></span>cargo run -- wasm2obj -g tests/debug/testsuite/fib-wasm.mo.wasm  tests/debug/testsuite/fib-wasm.mo.out

llvm-dwarfdump tests/debug/testsuite/fib-wasm.mo.out
</pre></div>


<p>totally helps! <span aria-label="first place" class="emoji emoji-1f947" role="img" title="first place">:first_place:</span> <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span></p>
</blockquote>



<a name="194989675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194989675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194989675">(Apr 22 2020 at 20:50)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618033002" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618033002">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Wow, thanks for the tip!</p>
<div class="codehilite"><pre><span></span>cargo run -- wasm2obj -g tests/debug/testsuite/fib-wasm.mo.wasm tests/debug/testsuite/fib-wasm.mo.out

llvm-dwarfdump tests/debug/testsuite/fib-wasm.mo.out
</pre></div>


<p>totally helps! <span aria-label="first place" class="emoji emoji-1f947" role="img" title="first place">:first_place:</span> <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span></p>
</blockquote>



<a name="194991494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194991494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194991494">(Apr 22 2020 at 21:07)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618041001" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618041001">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>Are the loc programs in DW_AT_frame_base and DW_AT_location supposed to be concatenated for each argument/local? </p>
</blockquote>
<p>Nope. That was the case before DW_AT_frame_base patch landed. DW_OP_fpreg shall be used from this point on to access frame base.</p>
</blockquote>



<a name="194992729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194992729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194992729">(Apr 22 2020 at 21:19)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618046000" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618046000">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>A quick before/after analysis shows</p>
<div class="codehilite"><pre><span></span>0x0000082b:   DW_TAG_subprogram [2] *
                DW_AT_low_pc [DW_FORM_addrx]    (indexed (00000064) address = 0x00000000000019e5)
                DW_AT_high_pc [DW_FORM_data4]   (0x0000005e)
                DW_AT_name [DW_FORM_strp]   ( .debug_str[0x000004af] = &quot;fib&quot;)
                DW_AT_decl_line [DW_FORM_data1] (4)
                DW_AT_decl_column [DW_FORM_data1]   (0x00)
                DW_AT_prototyped [DW_FORM_flag_present] (true)
                DW_AT_external [DW_FORM_flag]   (0x00)

0x00000838:     DW_TAG_formal_parameter [3]
                  DW_AT_name [DW_FORM_strp] ( .debug_str[0x00000145] = &quot;n&quot;)
                  DW_AT_decl_line [DW_FORM_data1]   (4)
                  DW_AT_decl_column [DW_FORM_data1] (0x09)
                  DW_AT_type [DW_FORM_ref_udata]    (cu + 0x67 =&gt; {0x00000067} &quot;Nat16&quot;)
                  DW_AT_location [DW_FORM_exprloc]  (DW_OP_plus_uconst 0x10)
</pre></div>


<p>goes in, and the below comes out:</p>
<div class="codehilite"><pre><span></span>0x00000a9b:   DW_TAG_subprogram [13] *
                DW_AT_low_pc [DW_FORM_addr] (0x0000000000000000 &quot;.text._wasm_function_100&quot;)
                DW_AT_name [DW_FORM_strp]   ( .debug_str[0x0000051a] = &quot;fib&quot;)
                DW_AT_decl_line [DW_FORM_udata] (4)
                DW_AT_decl_column [DW_FORM_udata]   (0)
                DW_AT_prototyped [DW_FORM_flag] (0x01)
                DW_AT_external [DW_FORM_flag]   (0x00)

0x00000aac:     DW_TAG_formal_parameter [14]
                  DW_AT_name [DW_FORM_strp] ( .debug_str[0x000001f9] = &quot;n&quot;)
                  DW_AT_decl_line [DW_FORM_udata]   (4)
                  DW_AT_decl_column [DW_FORM_udata] (9)
                  DW_AT_location [DW_FORM_exprloc]  (DW_OP_plus_uconst 0x10)
                  DW_AT_type [DW_FORM_ref4] (cu + 0x00a9 =&gt; {0x000000a9} &quot;Nat16&quot;)
</pre></div>


<p>Note the disappearance of <code>DW_AT_high_pc</code>. This looks suspiciously the effect of this line:<br>
<a href="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71" title="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71">https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71</a></p>
<p>It is explicitly discarded. I wonder why...</p>
</blockquote>



<a name="194993994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194993994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194993994">(Apr 22 2020 at 21:31)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>It is explicitly discarded</p>
</blockquote>
<p>The before says <code>DW_AT_high_pc [DW_FORM_data4]  (0x0000005e)</code> which is normally <code>Udata</code> for DW_AT_high_pc. Other forms of constants as not supported yet.</p>
</blockquote>



<a name="194994043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194994043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194994043">(Apr 22 2020 at 21:32)</a>:</h4>
<p>yurydelendik edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>It is explicitly discarded</p>
</blockquote>
<p>The before says <code>DW_AT_high_pc [DW_FORM_data4]  (0x0000005e)</code> which is normally <code>Udata</code> for DW_AT_high_pc. Other forms of constants is not supported yet.</p>
</blockquote>



<a name="194994154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194994154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194994154">(Apr 22 2020 at 21:33)</a>:</h4>
<p>yurydelendik edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618051851">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>It is explicitly discarded</p>
</blockquote>
<p>The before says <code>DW_AT_high_pc [DW_FORM_data4]  (0x0000005e)</code> which is normally <code>Udata</code> for DW_AT_high_pc. Other forms of constants are not supported yet.</p>
</blockquote>



<a name="194997367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194997367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194997367">(Apr 22 2020 at 22:10)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618066731" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618066731">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Right. It gets <code>read</code> as <code>Udata</code> and skipped over it in lines<br>
<a href="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71-L73" title="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71-L73">https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L71-L73</a></p>
<p>Similarly for <code>DW_AT_low_pc</code> for <code>Addr</code> in lines<br>
<a href="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L68-L70" title="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L68-L70">https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L68-L70</a>.</p>
<p>Both won't get <code>write</code>n. But here is the twist: I use <code>DW_FORM_addrx</code> (maps to <code>DebugAddrIndex</code>), which ends up written (this is new code added by me) in line<br>
<a href="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L88" title="https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L88">https://github.com/ggreif/wasmtime/blob/master/crates/debug/src/transform/attr.rs#L88</a>!</p>
<p>Should I also suppress <code>DebugAddrIndex</code> with <code>DW_AT_low_pc</code>?</p>
<p>This makes me wonder how <code>fib-wasm.wasm</code> is different. The before/after picture seems to have both <code>DW_AT_low_pc</code> and <code>DW_AT_high_pc</code>:</p>
<div class="codehilite"><pre><span></span>0x00000026:   DW_TAG_subprogram [2] *
                DW_AT_low_pc [DW_FORM_addr] (0x0000000000000003)
                DW_AT_high_pc [DW_FORM_data4]   (0x000000cb)
                DW_AT_name [DW_FORM_strp]   ( .debug_str[0x00000023] = &quot;fib&quot;)
                DW_AT_decl_file [DW_FORM_data1] (&quot;./fib-wasm.c&quot;)
                DW_AT_decl_line [DW_FORM_data1] (8)
                DW_AT_prototyped [DW_FORM_flag_present] (true)
                DW_AT_type [DW_FORM_ref4]   (cu + 0x008a =&gt; {0x0000008a} &quot;int&quot;)
                DW_AT_external [DW_FORM_flag_present]   (true)

0x00000039:     DW_TAG_formal_parameter [3]
                  DW_AT_location [DW_FORM_exprloc]  (DW_OP_plus_uconst 0x1c)
                  DW_AT_name [DW_FORM_strp] ( .debug_str[0x0000002b] = &quot;n&quot;)
                  DW_AT_decl_file [DW_FORM_data1]   (&quot;./fib-wasm.c&quot;)
                  DW_AT_decl_line [DW_FORM_data1]   (8)
                  DW_AT_type [DW_FORM_ref4] (cu + 0x008a =&gt; {0x0000008a} &quot;int&quot;)
</pre></div>


<p>After:</p>
<div class="codehilite"><pre><span></span>0x00000069:   DW_TAG_subprogram [9] *
                DW_AT_low_pc [DW_FORM_addr] (0x0000000000000000)
                DW_AT_high_pc [DW_FORM_udata]   (142)
                DW_AT_name [DW_FORM_strp]   ( .debug_str[0x0000007a] = &quot;fib&quot;)
                DW_AT_decl_file [DW_FORM_udata] (&quot;./fib-wasm.c&quot;)
                DW_AT_decl_line [DW_FORM_udata] (8)
                DW_AT_prototyped [DW_FORM_flag] (0x01)
                DW_AT_external [DW_FORM_flag]   (0x01)
                DW_AT_type [DW_FORM_ref4]   (cu + 0x00df =&gt; {0x000000df} &quot;int&quot;)

...

0x0000008d:     DW_TAG_formal_parameter [11]
                  DW_AT_location [DW_FORM_exprloc]  (DW_OP_plus_uconst 0x1c)
                  DW_AT_name [DW_FORM_strp] ( .debug_str[0x00000086] = &quot;n&quot;)
                  DW_AT_decl_file [DW_FORM_udata]   (&quot;./fib-wasm.c&quot;)
                  DW_AT_decl_line [DW_FORM_udata]   (8)
                  DW_AT_type [DW_FORM_ref4] (cu + 0x00df =&gt; {0x000000df} &quot;int&quot;)
</pre></div>


</blockquote>



<a name="194998584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/194998584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#194998584">(Apr 22 2020 at 22:23)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618071536" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618071536">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>Should I also suppress DebugAddrIndex with DW_AT_low_pc?</p>
</blockquote>
<p>I guess so.</p>
</blockquote>



<a name="195018712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195018712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195018712">(Apr 23 2020 at 04:52)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618176627" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618176627">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik I am getting closer. Now I could use some guidance how to compile operand stack <code>Exprloc</code> s (<a href="https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack" title="https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack">https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack</a>) to <code>CompiledExpression</code> (<code>compile_expression</code>), so that it matches <code>cranelift</code> 's calling convention.</p>
</blockquote>



<a name="195018779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195018779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195018779">(Apr 23 2020 at 04:55)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618176627" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618176627">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik I am getting closer. Now I could use some guidance how to compile operand stack <code>Exprloc</code> s (<a href="https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack" title="https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack">https://yurydelendik.github.io/webassembly-dwarf/#location-descriptions-operand-stack</a>) to <code>CompiledExpression</code> (<code>compile_expression</code>), so that it matches <code>cranelift</code> 's calling convention. N.B.: I am assuming that formal parameters are passed this way, and are _not_ considered locals.</p>
</blockquote>



<a name="195049996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195049996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195049996">(Apr 23 2020 at 12:00)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618361126" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618361126">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>I am assuming that formal parameters are passed this way, and are not considered locals.</p>
</blockquote>
<p>That's incorrect. WebAssembly function parameters are locals (per specification).</p>
<blockquote>
<p>I could use some guidance how to compile operand stack</p>
</blockquote>
<p>It is not possible atm. Currently no toolset generate expressions for operand stack, and cranelift does not provide data for it -- thus such expressions are silently ignored. It is possible to use only locals atm.</p>
</blockquote>



<a name="195068955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195068955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195068955">(Apr 23 2020 at 14:30)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618428225" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618428225">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>I am marking this as ready for first review, then. I think the changes are mostly benign and incremental, so they pose no elevated risk.<br>
I still have my doubts about the <code>DW_AT_addr_base = 8</code> thing, and will establish a mutable variable in the CU context.</p>
<ul>
<li>any guidance how to add sustainable and meaningful tests is welcome.</li>
<li><code>.debug_line_str</code> will be filled in soon (today?)</li>
</ul>
</blockquote>



<a name="195080127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195080127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195080127">(Apr 23 2020 at 15:43)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618428225" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618428225">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>I am marking this as ready for first review, then. I think the changes are mostly benign and incremental, so they pose no elevated risk.<br>
I still have my doubts about the <code>DW_AT_addr_base = 8</code> thing, and will establish a mutable variable in the CU context.</p>
<ul>
<li>any guidance how to add sustainable and meaningful tests is welcome.</li>
<li><code>.debug_line_str</code> will be filled in soon (today?)</li>
<li>revert <code>clang-10</code> stuff, remove <code>moc</code> stuff</li>
</ul>
</blockquote>



<a name="195205104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195205104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195205104">(Apr 24 2020 at 15:31)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>Hard to say, I just tried running your branch and it failed at clone_line_program -- the .debug_line format can differ between v4 and v5.</p>
</blockquote>
<p>I have a quick hack for that. The reason is that file number <code>0</code> is allowed in DWARF-5, but not in 4.</p>
<p>Here is the diff</p>
<div class="codehilite"><pre><span></span><span class="gh">diff --git a/crates/debug/src/transform/line_program.rs b/crates/debug/src/transform/line_program.rs</span>
<span class="gh">index 499a1300..862bf5d3 100644</span>
<span class="gd">--- a/crates/debug/src/transform/line_program.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/line_program.rs</span>
<span class="gu">@@ -238,7 +238,8 @@ where</span>
                         };
                         out_program.row().address_offset = address_offset;
                         out_program.row().op_index = *op_index;

<span class="gd">-                        out_program.row().file = files[(file_index - 1) as usize];</span>
<span class="gi">+                        out_program.row().file = files[(if *file_index as i64 &lt;= 0 {0} else {file_index - 1}) as usize];</span>
<span class="gi">+                        // out_program.row().file = if *file_index as i64 &lt;= 0 {write::line::id::zero()} else {files[(file_index - 1) as usize]};</span>
                         out_program.row().line = *line;
                         out_program.row().column = *column;
                         out_program.row().discriminator = *discriminator;
</pre></div>


<p>Sorry!</p>
<p>Regarding <code>DW_OP_plus_uconst</code>, yes this is a provocation to <code>lldb</code> which would emit warnings when <code>frame var</code> is processed. Alas they don't appear with my program. They do with the <code>fib-wasm.wasm</code> one.</p>
<p>Which brings me to the question: Are the loc programs in <code>DW_AT_frame_base</code> and <code>DW_AT_location</code> supposed to be concatenated for each argument/local? I am a bit puzzled to see what <code>clang-11</code> seems to emit. (Those binaries live in the main repo, I temporarily reverted them to <code>clang-10</code> on my branch, because <code>nix</code> doesn't yet have <code>clang-11</code>.)</p>
<p>It boils down to indexing. DWARF-4 is one-based for file and directory lists</p>
<div class="codehilite"><pre><span></span>file_names[  1]:
           name: &quot;fib-wasm.c&quot;
      dir_index: 0
       mod_time: 0x00000000
         length: 0x00000000
</pre></div>


<p>while DWARF-5 is zero-based:</p>
<div class="codehilite"><pre><span></span>include_directories[  0] =  .debug_line_str[0x00000000] = &quot;.&quot;
file_names[  0]:
           name:  .debug_line_str[0x00000002] = &quot;fib-wasm.c&quot;
      dir_index: 0
   md5_checksum: 3444f0aa42db6d50ac2e4e57ac752c75
</pre></div>


</blockquote>



<a name="195228379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195228379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195228379">(Apr 24 2020 at 18:39)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619180183" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619180183">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik what about enabling these?</p>
<div class="codehilite"><pre><span></span><span class="gh">index 1fba1c35c..bba6aef1e 100644</span>
<span class="gd">--- a/tests/all/debug/translate.rs</span>
<span class="gi">+++ b/tests/all/debug/translate.rs</span>
<span class="gu">@@ -25,7 +25,6 @@ fn check_wasm(wasm_path: &amp;str, directives: &amp;str) -&gt; Result&lt;()&gt; {</span>
 }

 #[test]
<span class="gd">-#[ignore]</span>
 #[cfg(all(
     any(target_os = &quot;linux&quot;, target_os = &quot;macos&quot;),
     target_pointer_width = &quot;64&quot;
<span class="gu">@@ -58,7 +57,6 @@ check:        DW_AT_decl_line (10)</span>
 }

 #[test]
<span class="gd">-#[ignore]</span>
 #[cfg(all(
     any(target_os = &quot;linux&quot;, target_os = &quot;macos&quot;),
     target_pointer_width = &quot;64&quot;
</pre></div>


</blockquote>



<a name="195229136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195229136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195229136">(Apr 24 2020 at 18:47)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>what about enabling these?</p>
</blockquote>
<p>It requires from a developer to have lldb and dwarfdump installed: wasmtime is an umbrella for multiple (sub)project, so we decided to run these tests only on CI.</p>
</blockquote>



<a name="195230176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195230176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195230176">(Apr 24 2020 at 18:55)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619186642" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619186642">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Got it, let's have a look how the _ignore nothing_ flag is passed.</p>
<p>On 4/24/20, Yury Delendik &lt;<a href="mailto:notifications@github.com" title="mailto:notifications@github.com">notifications@github.com</a>&gt; wrote:</p>
<blockquote>
<blockquote>
<p>what about enabling these?</p>
</blockquote>
<p>It requires from a developer to have lldb and dwarfdump installed: wasmtime<br>
is an umbrella for multiple (sub)project, so we decided to run these tests<br>
only on CI.</p>
<p>--<br>
You are receiving this because you were mentioned.<br>
Reply to this email directly or view it on GitHub:<br>
<a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127">https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127</a></p>
</blockquote>
</blockquote>



<a name="195234425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195234425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195234425">(Apr 24 2020 at 19:31)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik can you do me a favour and refresh these on my branch with clang-11 (prerelease):<br>
<code>tests/all/debug/testsuite/fib-wasm-dwarf5.wasm tests/all/debug/testsuite/fib-wasm.wasm</code></p>
<p>The instructions are at the top of the file <code>tests/all/debug/testsuite/fib-wasm.c</code>.</p>
</blockquote>



<a name="195234757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195234757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195234757">(Apr 24 2020 at 19:33)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik can you do me a favour and refresh these on my branch with clang-11 (prerelease):<br>
<code>tests/all/debug/testsuite/fib-wasm-dwarf5.wasm tests/all/debug/testsuite/fib-wasm.wasm</code></p>
<p>The instructions are at the top of the file <code>tests/all/debug/testsuite/fib-wasm.c</code>.</p>
<p>UPDATE: I added you to my repo collabs.</p>
</blockquote>



<a name="195234871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195234871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195234871">(Apr 24 2020 at 19:34)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik can you do me a favour and refresh these on my branch with clang-11 (prerelease):<br>
<code>tests/all/debug/testsuite/fib-wasm-dwarf5.wasm tests/all/debug/testsuite/fib-wasm.wasm</code></p>
<p>The instructions are at the top of the file <code>tests/all/debug/testsuite/fib-wasm.c</code>.</p>
<p>Reason: I don't have a bleeding edge <code>clang</code>.</p>
<p>UPDATE: I added you to my repo collabs.</p>
</blockquote>



<a name="195235064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195235064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195235064">(Apr 24 2020 at 19:36)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik can you do me a favour and refresh these on my branch with clang-11 (prerelease):<br>
<code>tests/all/debug/testsuite/fib-wasm-dwarf5.wasm tests/all/debug/testsuite/fib-wasm.wasm</code></p>
<p>The instructions are at the top of the file <code>tests/all/debug/testsuite/fib-wasm.c</code>.</p>
<p>Reason: I don't have a bleeding edge <code>clang</code>, and using older <code>clang-10</code> doesn't support <code>DW_AT_frame_base</code> yet. This causes test failures.</p>
<p>UPDATE: I added you to my repo collabs.</p>
</blockquote>



<a name="195237798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195237798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195237798">(Apr 24 2020 at 20:01)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619201480">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik can you do me a favour and refresh these on my branch with <code>clang-11</code> (prerelease):<br>
<code>tests/all/debug/testsuite/fib-wasm-dwarf5.wasm tests/all/debug/testsuite/fib-wasm.wasm</code></p>
<p>The instructions are at the top of the file <code>tests/all/debug/testsuite/fib-wasm.c</code>.</p>
<p>Reason: I don't have a bleeding edge <code>clang</code>, and using older <code>clang-10</code> doesn't support <code>DW_AT_frame_base</code> yet. This causes test failures.</p>
<p>UPDATE: I added you to my repo collabs.</p>
</blockquote>



<a name="195287908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195287908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195287908">(Apr 25 2020 at 14:49)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619186642" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619186642">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Got it, let's have a look how the _ignore nothing_ flag is passed.</p>
<p>Like this: <code>cargo test translate -- --ignored</code></p>
<p>On 4/24/20, Yury Delendik &lt;<a href="mailto:notifications@github.com" title="mailto:notifications@github.com">notifications@github.com</a>&gt; wrote:</p>
<blockquote>
<blockquote>
<p>what about enabling these?</p>
</blockquote>
<p>It requires from a developer to have lldb and dwarfdump installed: wasmtime<br>
is an umbrella for multiple (sub)project, so we decided to run these tests<br>
only on CI.</p>
<p>--<br>
You are receiving this because you were mentioned.<br>
Reply to this email directly or view it on GitHub:<br>
<a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127">https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-619183127</a></p>
</blockquote>
</blockquote>



<a name="195289186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195289186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195289186">(Apr 25 2020 at 15:21)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-618029289">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>Hard to say, I just tried running your branch and it failed at clone_line_program -- the .debug_line format can differ between v4 and v5.</p>
</blockquote>
<p>I have a quick hack for that. The reason is that file number <code>0</code> is allowed in DWARF-5, but not in 4.</p>
<p>Here is the diff</p>
<div class="codehilite"><pre><span></span><span class="gh">diff --git a/crates/debug/src/transform/line_program.rs b/crates/debug/src/transform/line_program.rs</span>
<span class="gh">index 499a1300..862bf5d3 100644</span>
<span class="gd">--- a/crates/debug/src/transform/line_program.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/line_program.rs</span>
<span class="gu">@@ -238,7 +238,8 @@ where</span>
                         };
                         out_program.row().address_offset = address_offset;
                         out_program.row().op_index = *op_index;

<span class="gd">-                        out_program.row().file = files[(file_index - 1) as usize];</span>
<span class="gi">+                        out_program.row().file = files[(if *file_index as i64 &lt;= 0 {0} else {file_index - 1}) as usize];</span>
<span class="gi">+                        // out_program.row().file = if *file_index as i64 &lt;= 0 {write::line::id::zero()} else {files[(file_index - 1) as usize]};</span>
                         out_program.row().line = *line;
                         out_program.row().column = *column;
                         out_program.row().discriminator = *discriminator;
</pre></div>


<p>Sorry!</p>
<p>Regarding <code>DW_OP_plus_uconst</code>, yes this is a provocation to <code>lldb</code> which would emit warnings when <code>frame var</code> is processed. Alas they don't appear with my program. They do with the <code>fib-wasm.wasm</code> one.</p>
<p>Which brings me to the question: Are the loc programs in <code>DW_AT_frame_base</code> and <code>DW_AT_location</code> supposed to be concatenated for each argument/local? I am a bit puzzled to see what <code>clang-11</code> seems to emit. (Those binaries live in the main repo, I temporarily reverted them to <code>clang-10</code> on my branch, because <code>nix</code> doesn't yet have <code>clang-11</code>.)</p>
<p>It boils down to indexing. DWARF-4 is one-based for file and directory lists</p>
<div class="codehilite"><pre><span></span>file_names[  1]:
           name: &quot;fib-wasm.c&quot;
      dir_index: 0
       mod_time: 0x00000000
         length: 0x00000000
</pre></div>


<p>while DWARF-5 is zero-based:</p>
<div class="codehilite"><pre><span></span>include_directories[  0] =  .debug_line_str[0x00000000] = &quot;.&quot;
file_names[  0]:
           name:  .debug_line_str[0x00000002] = &quot;fib-wasm.c&quot;
      dir_index: 0
   md5_checksum: 3444f0aa42db6d50ac2e4e57ac752c75
</pre></div>


<p>EDIT: this is fixed in d117d74.</p>
</blockquote>



<a name="195425685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195425685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195425685">(Apr 27 2020 at 14:32)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620025367" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620025367">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik I am grappling with <code>remove_incomplete_ranges</code> in <code>expression.rs</code>. Mostly because I cannot find a definition of <code>range</code> and <code>label</code>. This looks like a (boolean) matrix operation where labels must cover ranges, i.e. the whole row.</p>
<p>But somehow labels correspond to local variables, and ranges are in terms of code offsets (IIUC). I end up with all ranges discarded, because</p>
<p><code>self.processed_labels = {val1, val4294967294}</code> with <code>.len == 2</code><br>
and <code>p</code>'s <code>label_location</code> only mentions one of the variables:</p>
<div class="codehilite"><pre><span></span>remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 0, end: 62, label_location: {} }  ### 0 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 62, end: 96, label_location: {val1: Stack(ss1)} }  ### 1 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 96, end: 120, label_location: {} }  ### 0 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 120, end: 140, label_location: {val4294967294: Stack(ss0)} }  ### 1 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 140, end: 175, label_location: {} }  ### 0 vs. 2
</pre></div>


<p>I am obviously doing something wrong, but since I barely understand what is going on here, I am hard-pressed fixing it.</p>
</blockquote>



<a name="195427945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195427945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195427945">(Apr 27 2020 at 14:47)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620033919" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620033919">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>I am grappling with remove_incomplete_ranges in <a href="http://expression.rs" title="http://expression.rs">expression.rs</a></p>
</blockquote>
<p>Please notice I fixed <em>lots</em> of issues for <a href="http://expression.rs" title="http://expression.rs">expression.rs</a> in <a href="https://github.com/bytecodealliance/wasmtime/pull/1572" title="https://github.com/bytecodealliance/wasmtime/pull/1572">https://github.com/bytecodealliance/wasmtime/pull/1572</a> -- currently waiting on review.</p>
<p>ValueLabelRangesBuilder is used during DWARF expression transformation, and if not all value labels (in your case 2 labels) present in particular item of <code>ranges</code>, DWARF expression will not be transformed successfully.</p>
</blockquote>



<a name="195427996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195427996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195427996">(Apr 27 2020 at 14:47)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620025367" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620025367">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>@yurydelendik I am grappling with <code>remove_incomplete_ranges</code> in <code>expression.rs</code>. Mostly because I cannot find a definition of <code>range</code> and <code>label</code>. This looks like a (boolean) matrix operation where labels must cover ranges, i.e. the whole row.</p>
<p>But somehow labels correspond to local variables, and ranges are in terms of code offsets (IIUC). I end up with all ranges discarded, because</p>
<p><code>self.processed_labels = {val1, val4294967294}</code> with <code>.len == 2</code><br>
and <code>p</code>'s <code>label_location</code> only mentions one of the variables:</p>
<div class="codehilite"><pre><span></span>remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 0, end: 62, label_location: {} }  ### 0 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 62, end: 96, label_location: {val1: Stack(ss1)} }  ### 1 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 96, end: 120, label_location: {} }  ### 0 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 120, end: 140, label_location: {val4294967294: Stack(ss0)} }  ### 1 vs. 2
remove_incomplete_ranges iter CachedValueLabelRange { func_index: DefinedFuncIndex(6), start: 140, end: 175, label_location: {} }  ### 0 vs. 2
</pre></div>


<p>I am obviously doing something wrong, but since I barely understand what is going on here, I am hard-pressed fixing it.</p>
<p>I am also happy to accept a _zoom_ lecture if that is more convenient for you.</p>
</blockquote>



<a name="195428458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195428458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195428458">(Apr 27 2020 at 14:51)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620036093" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620036093">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>I am grappling with remove_incomplete_ranges in <a href="http://expression.rs" title="http://expression.rs">expression.rs</a></p>
</blockquote>
<p>Please notice I fixed _lots_ of issues for <a href="http://expression.rs" title="http://expression.rs">expression.rs</a> in #1572 -- currently waiting on review.</p>
<p>ValueLabelRangesBuilder is used during DWARF expression transformation, and if not all value labels (in your case 2 labels) present in particular item of <code>ranges</code>, DWARF expression will not be transformed successfully.</p>
</blockquote>
<p>So, next step for me to figure out why not both labels show up in <code>CachedValueLabelRange</code>, right?</p>
</blockquote>



<a name="195431036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195431036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195431036">(Apr 27 2020 at 15:09)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620046830" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620046830">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<blockquote>
<p>So, next step for me to figure out why not both labels show up in CachedValueLabelRange, right?</p>
</blockquote>
<p>Correct. Try to use <code>--opt-level 0</code> maybe it is just cranelift optimization or bug in value label range tracking there.</p>
<p>(BTW, would you like to join <a href="" title="">https://bytecodealliance.zulipchat.com/</a> for chat?)</p>
</blockquote>



<a name="195432699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195432699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195432699">(Apr 27 2020 at 15:20)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620053269" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620053269">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Let's freeze scope of this PR to the original description. I noticed you trying to work on DWARF expressions related stuff. I'll update .wasm tests and will try to finalize the review.</p>
</blockquote>



<a name="195435206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195435206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195435206">(Apr 27 2020 at 15:39)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620064436" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620064436">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>I was trying to figure out if the <code>Exprloc</code> problems I am experiencing are DWARF-5 related. That's the background of my last Q. Never mind, I think this PR is ready. Please go ahead, and I'll iterate on the <code>Expr</code> stuff with follow-up PRs.</p>
</blockquote>



<a name="195438907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195438907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195438907">(Apr 27 2020 at 16:08)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620081888" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620081888">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Updated wasm files. fwiw you don't have to provide access to entire repo, submitted as PR branch (option selected by default) gives push access for a reviewer. </p>
</blockquote>



<a name="195469846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195469846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195469846">(Apr 27 2020 at 20:19)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620211486" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620211486">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>This looks good. Will you squash?</p>
</blockquote>



<a name="195482849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231410%20support%20a%20few%20DWARF-5%20only%20features/near/195482849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231410.20support.20a.20few.20DWARF-5.20only.20features.html#195482849">(Apr 27 2020 at 22:27)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620268688" title="https://github.com/bytecodealliance/wasmtime/pull/1410#issuecomment-620268688">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1410" title="https://github.com/bytecodealliance/wasmtime/pull/1410">Issue #1410</a>:</p>
<blockquote>
<p>Thank you for the patch</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>