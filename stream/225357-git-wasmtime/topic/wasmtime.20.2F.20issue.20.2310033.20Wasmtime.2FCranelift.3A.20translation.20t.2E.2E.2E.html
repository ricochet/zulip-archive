<html>
<head><meta charset="utf-8"><title>wasmtime / issue #10033 Wasmtime/Cranelift: translation t... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html">wasmtime / issue #10033 Wasmtime/Cranelift: translation t...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="494192531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494192531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494192531">(Jan 16 2025 at 16:52)</a>:</h4>
<p><a href="https://github.com/Robbepop">Robbepop</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">Issue #10033</a>.</p>



<a name="494192534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494192534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494192534">(Jan 16 2025 at 16:52)</a>:</h4>
<p>Robbepop opened <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file: <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7</a><br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_iter::h33396339ede9fe08<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_from_iter_nested.rs:43:9
<span class="gp">        #</span><span class="m">39</span><span class="w"> </span>0x57a75a833ab0<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::in_place_collect::_<span class="nv">$LT$impl$u20$alloc</span>..vec..spec_from_iter..SpecFromIter<span class="nv">$LT$T$C$I$GT$$</span>u20<span class="nv">$for$u20$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>GT$::from_iter::hdf3befdea2477f72<span class="w"> </span>/rustc/5315cbe15b79533
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494192749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494192749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494192749">(Jan 16 2025 at 16:53)</a>:</h4>
<p>Robbepop edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file: <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7</a><br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_iter::h33396339ede9fe08<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_from_iter_nested.rs:43:9
<span class="gp">        #</span><span class="m">39</span><span class="w"> </span>0x57a75a833ab0<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::in_place_collect::_<span class="nv">$LT$impl$u20$alloc</span>..vec..s
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494192989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494192989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494192989">(Jan 16 2025 at 16:54)</a>:</h4>
<p>Robbepop edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.<br>
Find the Wasmtime differential fuzzing oracle implementation here: <a href="https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/Cargo.toml">https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/Cargo.toml</a></p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file: <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7</a><br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_iter::h33396339ede9fe08<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494193240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494193240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494193240">(Jan 16 2025 at 16:56)</a>:</h4>
<p>Robbepop edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.<br>
Find the Wasmtime differential fuzzing oracle implementation <a href="https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/src/oracle/wasmtime.rs">here</a>.</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file can be find <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">here</a>.<br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_iter::h33396339ede9fe08<span class="w"> </span>/rustc/5315cb
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494194870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494194870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494194870">(Jan 16 2025 at 17:04)</a>:</h4>
<p>Robbepop edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.<br>
Find the Wasmtime differential fuzzing oracle implementation <a href="https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/src/oracle/wasmtime.rs">here</a>.</p>
<p>Used Wasmtime version: v27</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file can be find <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">here</a>.<br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_iter::h33
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494195576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494195576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494195576">(Jan 16 2025 at 17:08)</a>:</h4>
<p>Robbepop edited <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.<br>
Find the Wasmtime differential fuzzing oracle implementation <a href="https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/src/oracle/wasmtime.rs">here</a>.</p>
<p>Tested Wasmtime versions: v27, v28</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file can be find <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">here</a>.<br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_i
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494201280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494201280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494201280">(Jan 16 2025 at 17:40)</a>:</h4>
<p><a href="https://github.com/abrown">abrown</a> added the fuzz-bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">Issue #10033</a>.</p>



<a name="494203081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494203081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494203081">(Jan 16 2025 at 17:51)</a>:</h4>
<p>Robbepop <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596353697">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Questions: in order to fix the time-out issue on my end while continue using Wasmtime as fuzzing oracle: What could I do to improve translation times? Is enforcing Winch or Pulley a viable alternative?</p>
</blockquote>



<a name="494203179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494203179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494203179">(Jan 16 2025 at 17:51)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596353697">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Questions: in order to fix the time-out issue on my end while continue using Wasmtime as fuzzing oracle: What could I do to improve translation times? Is enforcing Winch or Pulley a viable alternative? Or is there a concept such as translation fuel with which I can put a deterministic barrier into the translation process?</p>
</blockquote>



<a name="494232612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494232612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494232612">(Jan 16 2025 at 21:06)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596888438">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>This is, unfortunately, expected. We hit this semi-frequently in Wasmtime as well and there's not a great answer for it. The cause of this is more-or-less:</p>
<ul>
<li>OSS-Fuzz has a 60 second timeout for each test case.</li>
<li>ASAN + Fuzzing can add up to 20x slowdown, meaning we now have a 3s (on native budget)</li>
<li>Parallel compilation is typically disabled in fuzzing (or there's few cores anyway), and "large" input modules often have ~100+ functions, meaning we now have 0.03s budget per function.</li>
<li>Fuzz-generated functions can often have pretty pathological structure so 30ms for compiling a function isn't unheard of.</li>
</ul>
<p>Fuzzing typically finds these sorts of functions eventually and can create nasty modules where 100+ functions all take 30+ms to compile natively which then pretty easily blows the 60s budget on OSS-Fuzz.</p>
<p>Up to now we've never gotten to a point where 100% of timeouts are avoided on OSS-Fuzz. Various options to mitigate this include (a) configuring wasm-smith to avoid generating "big" modules, (b) using the new "single-pass" register allocator in Cranelift, and (c) disabling cranelift optimizations for "big" modules. Cranelift has no notion of fuel-for-itself at this time.</p>
<p>Currently in Wasmtime's fuzzing we basically just ignore timeouts once it looks like it's due to compilation speed. I still try to investigate other timeouts (leading to fixes such as <a href="https://github.com/bytecodealliance/wasmtime/pull/10026">https://github.com/bytecodealliance/wasmtime/pull/10026</a>). It's not a great state-of-affairs to be in IMO, but I've never figured out a better tradeoff for fixing these timeouts on OSS-Fuzz.</p>
</blockquote>



<a name="494235174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494235174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494235174">(Jan 16 2025 at 21:25)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596917307">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>To add (i) a bit of meta-discussion, and (ii) a specific answer, as well:</p>
<ol>
<li>
<p>What <em>should</em> we do? Are these failures "real"? When fuzzing one needs to define what property one is testing, and then ensure the oracle agrees with that (or not generate cases one expects to fail). Here we are implicitly saying "we expect our compiler to be X fast" but we don't have a crisply delineated line where we say that a program with <em>these</em> properties can be compiled in <em>this</em> time budget. For an optimizing compiler in particular that's intractable -- we simply don't know algorithms in the compilers field that have better than, in many cases, super-linear complexity and surprising worst cases (unless we design our compiler from scratch not to optimize). Doing better here is an extremely challenging research problem and you'd advance the state of the art if you could delineate the complexity cleanly or come up with tightly-bound algorithms.</p>
<p>(This may be obvious to folks here but I just wanted to make sure it's explicitly stated: in the state of the art understanding of the field, there is no solution to the core problem of unpredictable latency of optimization at our expected optimization tier, and it's unlikely we will come up with one.)</p>
<p>So arguably then the best we could do with fuzzing is to have the oracle expectation be "successful compilation [with matching execution results etc] OR timeout", and instrument Cranelift with fuel throughout. We have the start of that with the "control plane" abstraction, and someone could push it further. (Basically: we have the place where one would store <code>fuel: u64</code> and we need to check it at every loop and recursion.) It's probably a month of work to carefully go through all the different parts of Cranelift and modify it appropriately, and ensure we haven't missed anything.</p>
</li>
<li>
<p>What can you (@Robbepop) do today? If your goal is to have some differential fuzzing comparison point, Winch is a good answer (it is designed to compile code in time linear with its size), but be aware you're testing something <em>different</em>: it has its own lowerings of Wasm semantics that are different from Cranelift's. In both cases you're testing against the same Wasmtime runtime. Maybe all you want is "some other engine" as a comparison point in which case either is totally reasonable. Winch does currently lag somewhat in feature-completeness.</p>
</li>
</ol>
</blockquote>



<a name="494235227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494235227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494235227">(Jan 16 2025 at 21:25)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596917307">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>To add (i) a bit of meta-discussion, and (ii) a specific answer, as well:</p>
<ol>
<li>
<p>What <em>should</em> we do? Are these failures "real"? When fuzzing one needs to define what property one is testing, and then ensure the oracle agrees with that (or not generate cases one expects to fail). Here we are implicitly saying "we expect our compiler to be X fast" but we don't have a crisply delineated line where we say that a program with <em>these</em> properties can be compiled in <em>this</em> time budget. For an optimizing compiler in particular that's intractable -- we simply don't know algorithms in the compilers field that have better than, in many cases, super-linear complexity and surprising worst cases (unless we design our compiler from scratch not to optimize). Doing better here is an extremely challenging research problem and you'd advance the state of the art if you could delineate the complexity cleanly or come up with tightly-bound algorithms.</p>
<p>(This may be obvious to folks here but I just wanted to make sure it's explicitly stated: in the state of the art understanding of the field, there is no solution to the core problem of unpredictable latency of optimization at our expected optimization tier, and it's unlikely we will come up with one.)</p>
<p>So arguably then the best we could do with fuzzing is to have the oracle expectation be "successful compilation [with matching execution results etc] OR timeout", and instrument Cranelift with fuel throughout. We have the start of that with the "control plane" abstraction, and someone could push it further. (Basically: we have the place where one would store <code>fuel: u64</code> and we need to check it at every loop and recursion.) It's probably a month of work to carefully go through all the different parts of Cranelift and modify it appropriately, and ensure we haven't missed anything.</p>
</li>
<li>
<p>What can you (@Robbepop) do today? If your goal is to have some differential fuzzing comparison point, Winch is a good answer (it is designed to compile code in time linear with its size), but be aware you're testing something <em>different</em>: it has its own lowerings of Wasm semantics that are different from Cranelift's. In both cases you're testing against the same Wasmtime runtime. Maybe all you want is "some other engine" as a comparison point in which case either is totally reasonable. Winch does currently lag somewhat in feature-completeness.</p>
</li>
</ol>
</blockquote>



<a name="494240002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494240002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494240002">(Jan 16 2025 at 21:56)</a>:</h4>
<p>Robbepop <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596986709">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Thank you both for your valuable answers!</p>
<p>For my use case with Wasmi I am mostly interested in fuzzing Wasmi against another Wasm runtime that is well tested. And since I am very fond of Wasmtime testing and quality I think it is one of the best contenders for this. I used the Cranelift backend so far because I was not sure how stable the Winch backend is. If Winch is considered stable and robust and covers all the Wasm features that Wasmi needs, then it is probably the better choice.</p>
<p>@alexcrichton Thanks for the hints to disable optimizations and use a more light-weight register allocation. I suppose this works with the following APIs:</p>
<ul>
<li><a href="https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_opt_level">https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_opt_level</a></li>
<li><a href="https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_regalloc_algorithm">https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_regalloc_algorithm</a></li>
</ul>
<p>Will definitely try this out and see how big the differences are.<br>
Are there more options that could yield improvements here?</p>
<p>@cfallin Thanks for your recommendation to use Winch and for the additional information, I appreciate that!</p>
<p>Could Pulley (once stable) also be an alternative to Cranelift like Winch? Or does Pulley share the more complex translation scheme of the Cranelift backend?</p>
</blockquote>



<a name="494240776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494240776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494240776">(Jan 16 2025 at 22:01)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596997764">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>We've just recently started fuzzing Winch ourselves on OSS-Fuzz in addition to Pulley. In that sense they're probably not quite as robust as Cranelift but our goal is to get them there (and there are no known shortcomings in that sense). It's worth pointing out we have found at least one bug between single_pass register allocation and the (default) backtracking -- <a href="https://github.com/bytecodealliance/wasmtime/issues/9980">https://github.com/bytecodealliance/wasmtime/issues/9980</a>. My gut is that the "backtracking" register allocation is what primarily needs to be swapped out, so if you're only looking for a potential differential target I think it'd be reasonable to hardcod the "single_pass" register allocation pass.</p>
<p>Pulley won't be a great alternative here because its bytecode is compiled in the same manner as native code. It's not expected that Pulley compilation is significantly faster or slower than native x64 compilation. Winch is definitely the other best alternative to the defaults of Wasmtime as its design goal is to generate code quickly.</p>
</blockquote>



<a name="494241372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494241372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494241372">(Jan 16 2025 at 22:05)</a>:</h4>
<p>Robbepop <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597005778">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton I just tested the OSS-Fuzz input with Wasmtime with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">);</span>
<span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="n">cranelift_regalloc_algorithm</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">RegallocAlgorithm</span><span class="p">::</span><span class="n">SinglePass</span><span class="p">);</span>
</code></pre></div>
<p>... and can confirm that the fuzz test case now runs in ~3.3ms whereas before it took ~45ms.<br>
So quite an improvement already.</p>
<p>I think in the long run it is a good idea to use Winch instead, but I am going to wait until it is battle hardened further before going down this path. Thank you for the quick help!</p>
</blockquote>



<a name="494241385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494241385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494241385">(Jan 16 2025 at 22:05)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597005778">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton I just tested the OSS-Fuzz input with Wasmtime with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_regalloc_algorithm</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">RegallocAlgorithm</span><span class="p">::</span><span class="n">SinglePass</span><span class="p">);</span>
</code></pre></div>
<p>... and can confirm that the fuzz test case now runs in ~3.3ms whereas before it took ~45ms.<br>
So quite an improvement already.</p>
<p>I think in the long run it is a good idea to use Winch instead, but I am going to wait until it is battle hardened further before going down this path. Thank you for the quick help!</p>
</blockquote>



<a name="494241545"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494241545" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494241545">(Jan 16 2025 at 22:06)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597005778">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton I just tested the OSS-Fuzz input with Wasmtime with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_regalloc_algorithm</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">RegallocAlgorithm</span><span class="p">::</span><span class="n">SinglePass</span><span class="p">);</span>
</code></pre></div>
<p>... and can confirm that the fuzz test case now runs in ~3.3ms whereas before it took ~45ms.<br>
So quite an improvement already.<br>
I think it is safe to say that optimizations won't make sense for my fuzzing use case anyway, since fuzzing inputs are immediately discarded after being executed once.</p>
<p>I think in the long run it is a good idea to use Winch instead, but I am going to wait until it is battle hardened further before going down this path. Thank you for the quick help!</p>
</blockquote>



<a name="494241733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494241733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494241733">(Jan 16 2025 at 22:08)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597005778">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton I just tested the OSS-Fuzz input with Wasmtime with</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">config</span><span class="p">.</span><span class="n">cranelift_opt_level</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">OptLevel</span><span class="p">::</span><span class="nb">None</span><span class="p">);</span>
<span class="n">config</span><span class="p">.</span><span class="n">cranelift_regalloc_algorithm</span><span class="p">(</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">RegallocAlgorithm</span><span class="p">::</span><span class="n">SinglePass</span><span class="p">);</span>
</code></pre></div>
<p>... and can confirm that the fuzz test case now runs in ~3.3ms whereas before it took ~45ms.<br>
So quite an improvement already.<br>
I think it is safe to say that optimizations won't make sense for my fuzzing use case anyway, since fuzzing inputs are immediately discarded after being executed once.</p>
<p>With optimizations enabled and using singlepass register allocation, the fuzz test case time goes up from ~3.3ms to ~7.7ms. So I think going forward with optimizations disabled is best for my fuzzing needs.</p>
<p>I think in the long run it is a good idea to use Winch instead, but I am going to wait until it is battle hardened further before going down this path. Thank you for the quick help!</p>
</blockquote>



<a name="494242602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494242602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494242602">(Jan 16 2025 at 22:15)</a>:</h4>
<p>Robbepop <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597018687">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton @cfallin Thank you for your solutions. As said in my previous post, my problem has been fixed (for now <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span>) and I consider this issue resolved. <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span> </p>
</blockquote>



<a name="494242691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494242691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494242691">(Jan 16 2025 at 22:15)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2597018687">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>@alexcrichton @cfallin Thank you for your solutions. As said in my previous post, my problem has been fixed (for now <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span>), I am aware of future improvements (using Winch), so I consider this issue resolved. <span aria-label="rocket" class="emoji emoji-1f680" role="img" title="rocket">:rocket:</span> </p>
</blockquote>



<a name="494242752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494242752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494242752">(Jan 16 2025 at 22:16)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Recently OSS-Fuzz has found a time-out in <a href="https://github.com/wasmi-labs/wasmi/blob/main/fuzz/fuzz_targets/differential.rs">Wasmi's <code>differential</code> fuzzing target</a>.<br>
In Wasmi's differential fuzzing target we compare Wasmi and Wasmtime runtimes to yield the same values or errors for Wasm executions.<br>
Find the Wasmtime differential fuzzing oracle implementation <a href="https://github.com/wasmi-labs/wasmi/blob/main/crates/fuzz/src/oracle/wasmtime.rs">here</a>.</p>
<p>Tested Wasmtime versions: v27, v28</p>
<p>The OSS-Fuzz fuzzing input yields the following Wasm file can be find <a href="https://gist.github.com/Robbepop/c82b13448227f3130c05c2252f3859e7">here</a>.<br>
Unfortunately it is quite big but maybe it can be minified further.</p>
<p>Wasmi itself compiles the Wasm input extremely quickly thus I strongly assume the time-out happens due to Wasmtime or Cranelift.</p>
<p>The OSS-Fuzz console reports the Wasmtime requires over 60 seconds to compile this particular Wasm module.<br>
Find the OSS-Fuzz console logs below:</p>
<h3>Crash Stacktrace</h3>
<p><div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">[Environment] ASAN_OPTIONS=exitcode=77</span>
<span class="go">    +----------------------------------------Release Build Stacktrace----------------------------------------+</span>
<span class="go">    Command: /mnt/scratch0/clusterfuzz/resources/platform/linux/unshare -c -n /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential -rss_limit_mb=2560 -timeout=60 -runs=100 /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    Time ran: 62.636693477630615</span>

<span class="go">    INFO: Running with entropic power schedule (0xFF, 100).</span>
<span class="go">    INFO: Seed: 3073010528</span>
<span class="go">    INFO: Loaded 1 modules   (1564427 inline 8-bit counters): 1564427 [0x57a75f0a5810, 0x57a75f22371b),</span>
<span class="go">    INFO: Loaded 1 PC tables (1564427 PCs): 1564427 [0x57a75f223720,0x57a760a027d0),</span>
<span class="go">    /mnt/scratch0/clusterfuzz/bot/builds/clusterfuzz-builds_wasmi_e3ba127336643e55feba7865dfa1735df8d42d60/revisions/differential: Running 1 inputs 100 time(s) each.</span>
<span class="go">    Running: /mnt/scratch0/clusterfuzz/bot/inputs/fuzzer-testcases/timeout-8b7c87999d86caecd1391d9ea0205b3fd15da844</span>
<span class="go">    ALARM: working on the last Unit for 61 seconds</span>
<span class="go">           and the timeout value is 60 (use -timeout=N to change)</span>
<span class="go">    ==403== ERROR: libFuzzer: timeout after 61 seconds</span>
<span class="gp">        #</span><span class="m">0</span><span class="w"> </span>0x57a759b911b1<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_print_stack_trace<span class="w"> </span>/rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:87:3
<span class="gp">        #</span><span class="m">1</span><span class="w"> </span>0x57a75e23f708<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::PrintStackTrace<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210:5
<span class="gp">        #</span><span class="m">2</span><span class="w"> </span>0x57a75e222a17<span class="w"> </span><span class="k">in</span><span class="w"> </span>fuzzer::Fuzzer::AlarmCallback<span class="o">()</span><span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:304:5
<span class="gp">        #</span><span class="m">3</span><span class="w"> </span>0x7bc5684d441f<span class="w"> </span><span class="k">in</span><span class="w"> </span>libpthread.so.0
<span class="gp">        #</span><span class="m">4</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>HandleCmp&lt;unsigned<span class="w"> </span>char&gt;<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:390:32
<span class="gp">        #</span><span class="m">5</span><span class="w"> </span>0x57a75e23d128<span class="w"> </span><span class="k">in</span><span class="w"> </span>__sanitizer_cov_trace_const_cmp1<span class="w"> </span>/src/llvm-project/compiler-rt/lib/fuzzer/FuzzerTracePC.cpp:545:15
<span class="gp">        #</span><span class="m">6</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::probe_seq::h63969da1eb5bb981<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:2609:29
<span class="gp">        #</span><span class="m">7</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTableInner::find_or_find_insert_slot_inner::h1f836dc4db44aa10<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1960:34
<span class="gp">        #</span><span class="m">8</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::raw::inner::RawTable<span class="nv">$LT$T$C$A$GT</span>$::find_or_find_insert_slot::hbea28ee0e469ced8<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/raw/mod.rs:1423:19
<span class="gp">        #</span><span class="m">9</span><span class="w"> </span>0x57a75b6e522a<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::map::HashMap<span class="nv">$LT$K$C$V$C$S$C$A$GT</span>$::insert::h17daa005d09750a1<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/map.rs:1754:15
<span class="gp">        #</span><span class="m">10</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>hashbrown::set::HashSet<span class="nv">$LT$T$C$S$C$A$GT</span>$::insert::h2f5d75470f63f1f7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.14.5/src/set.rs:1115:9
<span class="gp">        #</span><span class="m">11</span><span class="w"> </span>0x57a75b79feea<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::process::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_to_allocate_bundle_to_reg::h9a8b01b7177ec712<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/process.rs:159:42
<span class="gp">        #</span><span class="m">12</span><span class="w"> </span>0x57a75b785bf0<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::spill::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::try_allocating_regs_for_spilled_bundles::h2a5c834a3e5c9abc<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/spill.rs:48:21
<span class="gp">        #</span><span class="m">13</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::_<span class="nv">$LT$impl$u20$regalloc2</span>..ion..data_structures..Env<span class="nv">$LT$F$GT$$</span>GT$::run::h2fbed0629b0003d7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:106:9
<span class="gp">        #</span><span class="m">14</span><span class="w"> </span>0x57a75b754df6<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::ion::run::hb20e7d7a22125a54<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/ion/mod.rs:129:17
<span class="gp">        #</span><span class="m">15</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>regalloc2::run::hdd4da390bb40d529<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/regalloc2-0.10.2/src/lib.rs:1507:5
<span class="gp">        #</span><span class="m">16</span><span class="w"> </span>0x57a75b809c64<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::machinst::compile::compile::hffbbd822f84c84ad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/machinst/compile.rs:66:9
<span class="gp">        #</span><span class="m">17</span><span class="w"> </span>0x57a75b9da947<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::isa::x64::X64Backend::compile_vcode::h10221be5233594c4<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:61:9
<span class="gp">        #</span><span class="m">18</span><span class="w"> </span>0x57a75b9dac0e<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$cranelift_codegen</span>..isa..x64..X64Backend<span class="nv">$u20$as$u20$cranelift_codegen</span>..isa..TargetIsa<span class="nv">$GT</span>$::compile_function::h702bdc255680a236<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/isa/x64/mod.rs:73:40
<span class="gp">        #</span><span class="m">19</span><span class="w"> </span>0x57a75ba5c245<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile_stencil::h29b342563e49c281<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:138:9
<span class="gp">        #</span><span class="m">20</span><span class="w"> </span>0x57a75ba5db8a<span class="w"> </span><span class="k">in</span><span class="w"> </span>cranelift_codegen::context::Context::compile::h8f5dbae767eabee7<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/cranelift-codegen-0.114.0/src/context.rs:204:23
<span class="gp">        #</span><span class="m">21</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_uncached::hdab0bcbc29395652<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:631:5
<span class="gp">        #</span><span class="m">22</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::compile_maybe_cached::h04d062fabb4d51e9<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:624:5
<span class="gp">        #</span><span class="m">23</span><span class="w"> </span>0x57a75b0d5a40<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime_cranelift::compiler::FunctionCompiler::finish_with_info::h813a8da83fb3ef50<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:813:13
<span class="gp">        #</span><span class="m">24</span><span class="w"> </span>0x57a75b0c728a<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$wasmtime_cranelift</span>..compiler..Compiler<span class="nv">$u20$as$u20$wasmtime_environ</span>..compile..Compiler<span class="nv">$GT</span>$::compile_function::h5c73ca60a8c009d2<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-cranelift-27.0.0/src/compiler.rs:233:28
<span class="gp">        #</span><span class="m">25</span><span class="w"> </span>0x57a75abce031<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::collect_inputs_in_translations::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hefbd4a7802a57aad<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:469:25
<span class="gp">        #</span><span class="m">26</span><span class="w"> </span>0x57a75a79b677<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::ops::function::FnOnce::call_once<span class="nv">$u7b$$</span>u7b<span class="nv">$vtable</span>.shim<span class="nv">$u7d$$</span>u7d$::h25fb832484ec2cab<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/ops/function.rs:250:5
<span class="gp">        #</span><span class="m">27</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..boxed..Box<span class="nv">$LT$F$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..ops..function..FnOnce<span class="nv">$LT$Args$GT$$</span>GT$::call_once::h5a340560af018e25<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/boxed.rs:2064:9
<span class="gp">        #</span><span class="m">28</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::compile::CompileInputs::compile::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::hf5e1e564c87b6984<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/compile.rs:552:74
<span class="gp">        #</span><span class="m">29</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>wasmtime::engine::Engine::run_maybe_parallel::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h2cdaa1fa84b333f6<span class="w"> </span>/rust/registry/src/index.crates.io-6f17d22bba15001f/wasmtime-27.0.0/src/engine.rs:167:22
<span class="gp">        #</span><span class="m">30</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::adapters::map::map_try_fold::_<span class="nv">$u7b$$</span>u7b<span class="nv">$closure$u7d$$</span>u7d$::h0953a78a8c13adfe<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:96:28
<span class="gp">        #</span><span class="m">31</span><span class="w"> </span>0x57a75a5791df<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..into_iter..IntoIter<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::he867e1572ce4e7c2<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/into_iter.rs:340:25
<span class="gp">        #</span><span class="m">32</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..map..Map<span class="nv">$LT$I$C$F$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h2a4667ef0928a914<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/map.rs:122:9
<span class="gp">        #</span><span class="m">33</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::try_fold::h923a60b65f94e761<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:204:9
<span class="gp">        #</span><span class="m">34</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>core::iter::traits::iterator::Iterator::try_for_each::hb7d72d45cf615007<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/traits/iterator.rs:2472:9
<span class="gp">        #</span><span class="m">35</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$core</span>..iter..adapters..GenericShunt<span class="nv">$LT$I$C$R$GT$$</span>u20<span class="nv">$as$u20$core</span>..iter..traits..iterator..Iterator<span class="nv">$GT</span>$::next::h83881f48a7ec7e26<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/core/src/iter/adapters/mod.rs:187:14
<span class="gp">        #</span><span class="m">36</span><span class="w"> </span>0x57a75a910123<span class="w"> </span><span class="k">in</span><span class="w"> </span>alloc::vec::Vec<span class="nv">$LT$T$C$A$GT</span>$::extend_desugared::h4e62389177be8aa7<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/mod.rs:3075:35
<span class="gp">        #</span><span class="m">37</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$C$A$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_extend..SpecExtend<span class="nv">$LT$T$C$I$GT$$</span>GT$::spec_extend::h31a0fe13406694e0<span class="w"> </span>/rustc/5315cbe15b79533f380bbb6685aa5480d5ff4ef5/library/alloc/src/vec/spec_extend.rs:17:9
<span class="gp">        #</span><span class="m">38</span><span class="w"> </span>0x57a75a5f1d21<span class="w"> </span><span class="k">in</span><span class="w"> </span>_<span class="nv">$LT$alloc</span>..vec..Vec<span class="nv">$LT$T$GT$$</span>u20<span class="nv">$as$u20$alloc</span>..vec..spec_from_iter_nested..SpecFromIterNested<span class="nv">$LT$T$C$I$GT$$</span>GT$::from_it
<span class="go">[message truncated]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="494242768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%2310033%20Wasmtime/Cranelift%3A%20translation%20t.../near/494242768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.2310033.20Wasmtime.2FCranelift.3A.20translation.20t.2E.2E.2E.html#494242768">(Jan 16 2025 at 22:16)</a>:</h4>
<p>Robbepop edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/10033#issuecomment-2596986709">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/10033">issue #10033</a>:</p>
<blockquote>
<p>Thank you both for your valuable answers!</p>
<p>For my use case with Wasmi I am mostly interested in fuzzing Wasmi against another Wasm runtime that is well tested. And since I am very fond of Wasmtime testing and quality. I think it is one of the best contenders for this. I used the Cranelift backend so far because I was not sure how stable the Winch backend is. If Winch is considered stable and robust and covers all the Wasm features that Wasmi needs, then it is probably the better choice.</p>
<p>@alexcrichton Thanks for the hints to disable optimizations and use a more light-weight register allocation. I suppose this works with the following APIs:</p>
<ul>
<li><a href="https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_opt_level">https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_opt_level</a></li>
<li><a href="https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_regalloc_algorithm">https://docs.rs/wasmtime/28.0.1/wasmtime/struct.Config.html#method.cranelift_regalloc_algorithm</a></li>
</ul>
<p>Will definitely try this out and see how big the differences are.<br>
Are there more options that could yield improvements here?</p>
<p>@cfallin Thanks for your recommendation to use Winch and for the additional information, I appreciate that!</p>
<p>Could Pulley (once stable) also be an alternative to Cranelift like Winch? Or does Pulley share the more complex translation scheme of the Cranelift backend?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>