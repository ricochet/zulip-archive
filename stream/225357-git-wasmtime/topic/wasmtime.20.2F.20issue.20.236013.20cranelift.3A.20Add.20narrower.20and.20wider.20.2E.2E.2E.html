<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6013 cranelift: Add narrower and wider ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236013.20cranelift.3A.20Add.20narrower.20and.20wider.20.2E.2E.2E.html">wasmtime / issue #6013 cranelift: Add narrower and wider ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="341602531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236013%20cranelift%3A%20Add%20narrower%20and%20wider%20.../near/341602531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236013.20cranelift.3A.20Add.20narrower.20and.20wider.20.2E.2E.2E.html#341602531">(Mar 14 2023 at 01:04)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/6013#issuecomment-1467188462">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6013">issue #6013</a>:</p>
<blockquote>
<blockquote>
<p>Could you also diff the generated target/debug/build/cranelift-codegen-*/out/opcodes.rs before and after this change? I'm particularly interested in making sure that OPCODE_CONSTRAINTS isn't different in any interesting way except for the five instructions you've updated to use the new derived types. There are some nice comments in the generated code for the computed value of use_typevar_operand, for example.</p>
</blockquote>
<p><code>OPCODE_CONSTRAINTS</code> only differs in that it's now 80 elements long. There are some new constraints that uses <code>Narrower</code> and <code>Wider</code>, with two previously completely free constraints being replaced with a constrained use of the controlling variable.</p>
</blockquote>



<a name="341602906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236013%20cranelift%3A%20Add%20narrower%20and%20wider%20.../near/341602906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236013.20cranelift.3A.20Add.20narrower.20and.20wider.20.2E.2E.2E.html#341602906">(Mar 14 2023 at 01:07)</a>:</h4>
<p>elliottt edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/6013#issuecomment-1467188462">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6013">issue #6013</a>:</p>
<blockquote>
<blockquote>
<p>Could you also diff the generated target/debug/build/cranelift-codegen-*/out/opcodes.rs before and after this change? I'm particularly interested in making sure that OPCODE_CONSTRAINTS isn't different in any interesting way except for the five instructions you've updated to use the new derived types. There are some nice comments in the generated code for the computed value of use_typevar_operand, for example.</p>
</blockquote>
<p><code>OPCODE_CONSTRAINTS</code> only differs in that it's now 80 elements long. There are some new constraints that use <code>Narrower</code> and <code>Wider</code>, with two previously completely free constraints being replaced with a constrained use of the controlling variable.</p>
</blockquote>



<a name="341841131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236013%20cranelift%3A%20Add%20narrower%20and%20wider%20.../near/341841131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236013.20cranelift.3A.20Add.20narrower.20and.20wider.20.2E.2E.2E.html#341841131">(Mar 14 2023 at 16:06)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/6013#issuecomment-1468389745">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6013">issue #6013</a>:</p>
<blockquote>
<p>I realized that the changes to the <code>is_ctrl_typevar_candidate</code> were only necessary when we were allowing an instructions return type to include a constrained use of the control type. As we needed to avoid that to ensure that instructions always had a well-defined return type, those changes could be reverted as well.</p>
</blockquote>



<a name="341844631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236013%20cranelift%3A%20Add%20narrower%20and%20wider%20.../near/341844631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236013.20cranelift.3A.20Add.20narrower.20and.20wider.20.2E.2E.2E.html#341844631">(Mar 14 2023 at 16:19)</a>:</h4>
<p>elliottt edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/6013#issuecomment-1468389745">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/6013">issue #6013</a>:</p>
<blockquote>
<p>I realized that the changes to the <code>is_ctrl_typevar_candidate</code> were only necessary when we were allowing an instruction's return type to include a constrained use of the control type. As we needed to avoid that to ensure that instructions always had a well-defined return type, those changes could be reverted as well.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>