<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7260 Add an asynchronous `wasi:io/output-s... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html">wasmtime / PR #7260 Add an asynchronous `wasi:io/output-s...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="396990125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/396990125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#396990125">(Oct 16 2023 at 23:05)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7260">PR #7260</a>:</p>
<blockquote>
<p>Also add language to <code>wasi:http/outgoing-body::finish</code> explaining how it interacts with pending/in-process forwarding operations.</p>
<p>Together, these changes enable use cases where an instance forwards an incoming request's or response's body to an outgoing request/response and then terminates without waiting for the entire body to be streamed.</p>
</blockquote>



<a name="396990534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/396990534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#396990534">(Oct 16 2023 at 23:08)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7260#pullrequestreview-1681076193">PR review</a>:</p>
<blockquote>
<ul>
<li>how is write readiness of the output-stream defined - I believe it should not become ready for writing until all forwarded input-streams have been fully sent.</li>
<li>if <code>future-forwarded-result</code> is dropped, what happens? I believe that we should continue to forward no matter what, but we need to make that explicit.</li>
<li>if execution traps, what happens? I think in the case of a trap we should define forwarding to stop "at some point afterwards" - I don't think we want to be on the hook to keep forwarding after a trap, nor give a guarantee that it terminates promptly.</li>
</ul>
</blockquote>



<a name="396990535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/396990535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#396990535">(Oct 16 2023 at 23:08)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7260#pullrequestreview-1681076193">PR review</a>:</p>
<blockquote>
<ul>
<li>how is write readiness of the output-stream defined - I believe it should not become ready for writing until all forwarded input-streams have been fully sent.</li>
<li>if <code>future-forwarded-result</code> is dropped, what happens? I believe that we should continue to forward no matter what, but we need to make that explicit.</li>
<li>if execution traps, what happens? I think in the case of a trap we should define forwarding to stop "at some point afterwards" - I don't think we want to be on the hook to keep forwarding after a trap, nor give a guarantee that it terminates promptly.</li>
</ul>
</blockquote>



<a name="396990536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/396990536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#396990536">(Oct 16 2023 at 23:08)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/7260#discussion_r1361341262">PR review comment</a>:</p>
<blockquote>
<p>I think this should return <code>result&lt;future-forwarded-result, tuple&lt;stream-error, input-stream&gt;&gt;</code> - returns ownership of the <code>input stream</code> on failure, and says that this <code>output-stream</code> has already closed or somehow failed.</p>
</blockquote>



<a name="396990537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/396990537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#396990537">(Oct 16 2023 at 23:08)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/7260#discussion_r1361342220">PR review comment</a>:</p>
<blockquote>
<p>I don't think we should provide multiple input-streams here, there is only one that has been taken ownership of by the <code>forward</code> function so lets only give one back here. The caller can hold onto handles for all of their future-forward-results and unwrap each of them into an <code>some(ok(err((_error, input-stream))))</code></p>
</blockquote>



<a name="401216728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237260%20Add%20an%20asynchronous%20%60wasi%3Aio/output-s.../near/401216728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237260.20Add.20an.20asynchronous.20.60wasi.3Aio.2Foutput-s.2E.2E.2E.html#401216728">(Nov 09 2023 at 18:51)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/7260">PR #7260</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>