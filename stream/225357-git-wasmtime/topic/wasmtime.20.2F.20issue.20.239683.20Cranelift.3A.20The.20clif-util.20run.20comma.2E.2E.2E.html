<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9683 Cranelift: The clif-util run comma... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html">wasmtime / issue #9683 Cranelift: The clif-util run comma...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="484454516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484454516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484454516">(Nov 26 2024 at 08:12)</a>:</h4>
<p>abc767234318 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>I constructed a clif file.</p>
<p><a href="https://github.com/user-attachments/files/17915276/multi_func15.zip">multi_func15.zip</a></p>
<p>I used the following command to run it.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">clif</span><span class="o">-</span><span class="n">util</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">multi_func15</span><span class="p">.</span><span class="n">clif</span>
</code></pre></div>
<p>But I got the following error:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Segmentation</span><span class="w"> </span><span class="n">fault</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="484461776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484461776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484461776">(Nov 26 2024 at 08:56)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2500033153">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>The test probably reads or writes to memory it shouldn't. In any case please reduce your test cases rather than making others try to extract the issue from a ton of clif ir.</p>
</blockquote>



<a name="484465686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484465686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484465686">(Nov 26 2024 at 09:18)</a>:</h4>
<p>abc767234318 <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2500078281">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<blockquote>
<p>The test probably reads or writes to memory it shouldn't. In any case please reduce your test cases rather than making others try to extract the issue from a ton of clif ir.</p>
</blockquote>
<p>Ok, I will try to reduce the size of the test case.</p>
</blockquote>



<a name="484556292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484556292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484556292">(Nov 26 2024 at 16:49)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2501392496">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>In addition to @bjorn3's request, please post CLIF snippets here directly. A zip file is not a great way to communicate these examples as developers' time here is fairly limited. (And if the zip compression is necessary to make it practical to send, then it's too large and needs to be reduced!)</p>
</blockquote>



<a name="484656311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484656311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484656311">(Nov 27 2024 at 07:37)</a>:</h4>
<p>abc767234318 <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2503122405">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>@bjorn3 @cfallin  Hi, I've extracted the function where caused the segmentation fault to reduce this test case.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">optimize</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed</span>
<span class="n">set</span><span class="w"> </span><span class="n">enable_pinned_reg</span><span class="o">=</span><span class="kc">true</span>
<span class="n">set</span><span class="w"> </span><span class="n">preserve_frame_pointers</span><span class="o">=</span><span class="kc">true</span>
<span class="n">target</span><span class="w"> </span><span class="n">s390x</span>
<span class="n">target</span><span class="w"> </span><span class="n">aarch64</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64</span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span>


<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">main</span><span class="p">(</span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">f32</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">ss1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">sig0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">fast</span>

<span class="w">    </span><span class="n">const0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x74b82aa0f192f5649620f8c17a3f6964</span>
<span class="w">    </span><span class="n">const1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xa2aa8b9ee040395c</span>

<span class="n">block0</span><span class="p">(</span><span class="n">v2</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="mi">92</span>
<span class="w">    </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="mi">1372</span>
<span class="w">    </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="o">-</span><span class="mi">493943460</span>
<span class="w">    </span><span class="n">v7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mh">0x78be_9a03_e28f_055c</span>
<span class="w">    </span><span class="n">v8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f16const</span><span class="w"> </span><span class="mh">0x0</span><span class="p">.</span><span class="n">ef4p</span><span class="o">-</span><span class="mi">14</span>
<span class="w">    </span><span class="n">v9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f32const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">be8908p</span><span class="o">-</span><span class="mi">3</span>
<span class="w">    </span><span class="n">v10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">ceaf296167eb8p</span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">i8x16</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">i16x8</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">f16x8</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">i32x4</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">f32x4</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">i64x2</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">f64x2</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v18</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vconst</span><span class="p">.</span><span class="n">i8x8</span><span class="w"> </span><span class="n">const1</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block2</span>

<span class="n">block1</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v31</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uload32</span><span class="w"> </span><span class="n">v31</span><span class="o">+</span><span class="mi">4</span>
<span class="w">    </span><span class="n">v33</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1372</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1372</span>
<span class="w">    </span><span class="n">v34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v35</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="n">i64x2</span><span class="w"> </span><span class="n">v34</span><span class="o">+</span><span class="mi">3</span>
<span class="w">    </span><span class="n">v36</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v27</span>
<span class="w">    </span><span class="n">v37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">b67f3058b67e0p</span><span class="o">-</span><span class="mi">2</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v36</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">be8908p</span><span class="o">-</span><span class="mi">3</span>

<span class="n">block2</span><span class="p">:</span>
<span class="w">    </span><span class="nc">brif</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block6</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">493943460</span>

<span class="n">block3</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v19</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotr_imm</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">17672</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1372</span>
<span class="w">    </span><span class="n">v20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urem</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v7</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x78be_9a03_e28f_055c</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x78be_9a03_e28f_055c</span>
<span class="w">    </span><span class="n">v21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">band</span><span class="p">.</span><span class="n">f16</span><span class="w"> </span><span class="n">v8</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">.</span><span class="n">ef4p</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">.</span><span class="n">ef4p</span><span class="o">-</span><span class="mi">14</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">493943460</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span>

<span class="n">block5</span><span class="p">(</span><span class="n">v60</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v61</span><span class="p">:</span><span class="w"> </span><span class="kt">i8</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v22</span><span class="o">+</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v24</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss1</span>
<span class="w">    </span><span class="n">v25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="n">f16</span><span class="w"> </span><span class="n">v60</span><span class="o">+</span><span class="mi">2</span>
<span class="w">    </span><span class="n">v26</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f32const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">a28e48p</span><span class="o">-</span><span class="mi">2</span>
<span class="w">    </span><span class="n">v27</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ishl_imm</span><span class="w"> </span><span class="n">v60</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1794784619</span>
<span class="w">    </span><span class="n">v28</span><span class="p">,</span><span class="w"> </span><span class="n">v29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umul_overflow</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v4</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span>
<span class="w">    </span><span class="n">v30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">istore16</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">v60</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">493943460</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span>

<span class="n">block6</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v38</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v38</span><span class="o">+</span><span class="mi">4</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ineg</span><span class="p">.</span><span class="n">i64x2</span><span class="w"> </span><span class="n">v16</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="o">-</span><span class="mi">794804681</span>
<span class="w">    </span><span class="n">v42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">popcnt</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">v5</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1372</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block7</span>

<span class="n">block7</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">udiv</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">v42</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1372</span>
<span class="w">    </span><span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">srem</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block9</span>

<span class="n">block9</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swizzle</span><span class="w"> </span><span class="n">v11</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">const0</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v46</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v46</span><span class="o">+</span><span class="mi">5</span>
<span class="w">    </span><span class="n">brif</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block10</span><span class="p">,</span><span class="w"> </span><span class="n">block11</span>

<span class="n">block10</span><span class="p">:</span>
<span class="w">    </span><span class="nc">v48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trunc</span><span class="p">.</span><span class="n">f32x4</span><span class="w"> </span><span class="n">v15</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v49</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">f64</span><span class="w"> </span><span class="n">v49</span><span class="o">+</span><span class="mi">4</span>
<span class="w">    </span><span class="n">v51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss1</span>
<span class="w">    </span><span class="n">v52</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atomic_load</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v51</span>
<span class="w">    </span><span class="n">v53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss1</span>
<span class="w">    </span><span class="n">v54</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sload8</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">v53</span><span class="o">+</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v55</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss1</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sload8</span><span class="p">.</span><span class="kt">i16</span><span class="w"> </span><span class="n">v55</span><span class="o">+</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v57</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urem</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">794804681</span>

<span class="w">    </span><span class="n">v63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f64const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">ceaf296167eb8p</span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">100</span>

<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block12</span><span class="p">(</span><span class="n">v52</span><span class="p">)</span>

<span class="n">block11</span><span class="p">:</span>
<span class="w">    </span><span class="nc">jump</span><span class="w"> </span><span class="n">block12</span><span class="p">(</span><span class="n">v39</span><span class="p">)</span>

<span class="n">block12</span><span class="p">(</span><span class="n">v62</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v58</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fvpromote_low</span><span class="w"> </span><span class="n">v15</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">const0</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">atomic_store</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v59</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v47</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">794804681</span>
<span class="p">}</span>


<span class="p">;</span><span class="w"> </span><span class="n">print</span><span class="p">:</span><span class="w"> </span><span class="o">%</span><span class="n">main</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1725923514</span><span class="p">)</span>
</code></pre></div>
<p>After my analysis, the segmentation fault may occur in the following code block. I think it is due to memory out of bounds for the <code>v25 = load.f16 v60+2</code> instruction.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">block5</span><span class="p">(</span><span class="n">v60</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v61</span><span class="p">:</span><span class="w"> </span><span class="kt">i8</span><span class="p">):</span>
<span class="w">    </span><span class="nc">v22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">v23</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v22</span><span class="o">+</span><span class="mi">1</span>
<span class="w">    </span><span class="n">v24</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss1</span>
<span class="w">    </span><span class="n">v25</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="n">f16</span><span class="w"> </span><span class="n">v60</span><span class="o">+</span><span class="mi">2</span>
<span class="w">    </span><span class="n">v26</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f32const</span><span class="w"> </span><span class="mh">0x1</span><span class="p">.</span><span class="n">a28e48p</span><span class="o">-</span><span class="mi">2</span>
<span class="w">    </span><span class="n">v27</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ishl_imm</span><span class="w"> </span><span class="n">v60</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1794784619</span>
<span class="w">    </span><span class="n">v28</span><span class="p">,</span><span class="w"> </span><span class="n">v29</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umul_overflow</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v4</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">92</span>
<span class="w">    </span><span class="n">v30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">ss0</span>
<span class="w">    </span><span class="n">istore16</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">v60</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">493943460</span>
<span class="w">    </span><span class="n">jump</span><span class="w"> </span><span class="n">block1</span>
</code></pre></div>
<p>And the following instruction with segmentation fault might be the assembler instruction corresponding to <code>v25 = load.f16 v60+2</code>.<br>
![image](<a href="https://github.com/user-attachments/assets/892dcb85-2c6a-4900-b743-e1df193d0413">https://github.com/user-attachments/assets/892dcb85-2c6a-4900-b743-e1df193d0413</a>)</p>
</blockquote>



<a name="484658750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484658750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484658750">(Nov 27 2024 at 07:57)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2503161167">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>Hi @abc767234318 -- to be blunt, bug reports with this much un-minimized detail and this little analysis are not very useful to us. You are likely generating this from fuzzing or some other random testing strategy (yes?) and submitting any crashes you find. That takes very little effort. The hard part is determining whether the issue is "real" -- that is, due to a bug in Cranelift, rather than your testing infrastructure or your assumptions.</p>
<p>When we get a flood of reports like this (7 from you in the past 6 days, by my count) it is basically performing a human denial-of-service attack on our project. We are interested in bugs, of course, but the social contract of open-source is that you need to participate fairly and do your share of the work.</p>
<p>Could you please, for this and any future bug reports you submit, add analysis that indicates <em>why</em> you believe the program should not behave the way it does? Here, for example, could you indicate why you believe the load should not be out of bounds, what the value of the address operand is, whether the code runs successfully on other ISAs or the CLIF interpreter if applicable, and any other questions you can think of to help reduce the issue?</p>
</blockquote>



<a name="484664830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/484664830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#484664830">(Nov 27 2024 at 08:37)</a>:</h4>
<p>abc767234318 <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2503248043">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<blockquote>
<p>Hi @abc767234318 -- to be blunt, bug reports with this much un-minimized detail and this little analysis are not very useful to us. You are likely generating this from fuzzing or some other random testing strategy (yes?) and submitting any crashes you find. That takes very little effort. The hard part is determining whether the issue is "real" -- that is, due to a bug in Cranelift, rather than your testing infrastructure or your assumptions.</p>
<p>When we get a flood of reports like this (7 from you in the past 6 days, by my count) it is basically performing a human denial-of-service attack on our project. We are interested in bugs, of course, but the social contract of open-source is that you need to participate fairly and do your share of the work.</p>
<p>Could you please, for this and any future bug reports you submit, add analysis that indicates _why_ you believe the program should not behave the way it does? Here, for example, could you indicate why you believe the load should not be out of bounds, what the value of the address operand is, whether the code runs successfully on other ISAs or the CLIF interpreter if applicable, and any other questions you can think of to help reduce the issue?</p>
</blockquote>
<p>I apologize for not providing sufficient detail and analysis in my reports. I appreciate the importance of thorough investigations in identifying real issues, especially in an open-source project. I want to clarify that my reports are generated from fuzzing and random testing strategies, as you suspected, and I understand that this approach may not always yield the most actionable insights. My current understanding of cranelift compiler and its internals is limited, which has contributed to the lack of detailed analysis in my reports.</p>
<p>I will strive to include more context and reasoning in my reports. I’ll make sure to analyze the behavior of the program more thoroughly, including addressing the specific points you mentioned.</p>
<p>Thank you for your patience, and I appreciate your guidance as I work to improve my contributions.</p>
</blockquote>



<a name="486584478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239683%20Cranelift%3A%20The%20clif-util%20run%20comma.../near/486584478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239683.20Cranelift.3A.20The.20clif-util.20run.20comma.2E.2E.2E.html#486584478">(Dec 06 2024 at 19:51)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9683#issuecomment-2524044426">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9683">issue #9683</a>:</p>
<blockquote>
<p>Not directly applicable to clif test cases, but you may find <a href="https://docs.wasmtime.dev/contributing-reducing-test-cases.html">https://docs.wasmtime.dev/contributing-reducing-test-cases.html</a> enlightening.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>