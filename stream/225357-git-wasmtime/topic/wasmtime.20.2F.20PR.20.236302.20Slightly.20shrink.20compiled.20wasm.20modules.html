<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6302 Slightly shrink compiled wasm modules · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html">wasmtime / PR #6302 Slightly shrink compiled wasm modules</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="353536038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353536038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353536038">(Apr 27 2023 at 23:20)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a> from <code>alexcrichton:shrink-trampolines</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit shuffles trampolines to the end of a compiled ELF file instead of interspersed throughout. Additionally trampolines are no longer given a higher alignment requirement than is required by the ISA as is given to functions since they're not perf critical.</p>
<p>The savings here are quite minor, only 0.3% locally on spidermonkey.wasm.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="353536040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353536040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353536040">(Apr 27 2023 at 23:20)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="353536042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353536042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353536042">(Apr 27 2023 at 23:20)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="353536044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353536044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353536044">(Apr 27 2023 at 23:20)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="353550654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353550654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353550654">(Apr 28 2023 at 00:10)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="353551133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353551133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353551133">(Apr 28 2023 at 00:12)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#pullrequestreview-1405063642">PR review</a>:</p>
<blockquote>
<p>Nice, I think this looks good overall. And 0.3% ain't nothing.</p>
<p>I would like to ask for a <code>struct Alignment</code> with named fields for <code>minimum</code> and <code>preferred</code>, rather than trying to match up the tuple field order with the name of the function it comes from.</p>
</blockquote>



<a name="353551134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353551134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353551134">(Apr 28 2023 at 00:12)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#discussion_r1179814330">PR review comment</a>:</p>
<blockquote>
<p>What would you say to removing this method from the <code>compiler</code> trait entirely? If it's only used for <code>append_func</code>, which already has an <code>alignment</code> parameter, maybe we should just pass the desired alignment at <code>append_func</code>'s callers.</p>
</blockquote>



<a name="353551136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353551136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353551136">(Apr 28 2023 at 00:12)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#pullrequestreview-1405063642">PR review</a>:</p>
<blockquote>
<p>Nice, I think this looks good overall. And 0.3% ain't nothing.</p>
<p>I would like to ask for a <code>struct Alignment</code> with named fields for <code>minimum</code> and <code>preferred</code>, rather than trying to match up the tuple field order with the name of the function it comes from.</p>
</blockquote>



<a name="353922858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353922858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353922858">(Apr 28 2023 at 15:07)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="353984426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/353984426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#353984426">(Apr 28 2023 at 17:05)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#pullrequestreview-1406312779">PR review</a>.</p>



<a name="354009840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354009840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354009840">(Apr 28 2023 at 18:02)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#pullrequestreview-1406359606">PR review</a>:</p>
<blockquote>
<p>Other than getting very confused in one spot, this looks good to me.</p>
</blockquote>



<a name="354009847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354009847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354009847">(Apr 28 2023 at 18:02)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#pullrequestreview-1406359606">PR review</a>:</p>
<blockquote>
<p>Other than getting very confused in one spot, this looks good to me.</p>
</blockquote>



<a name="354009851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354009851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354009851">(Apr 28 2023 at 18:02)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#discussion_r1180667303">PR review comment</a>:</p>
<blockquote>
<p>I first read this as forcing constants to be aligned to at least the function's minimum alignment, but this <code>alignment</code> variable is not used for the constant's alignment. It's just collecting the maximum alignment of any constant or, now, the function's minimum alignment.</p>
<p>Is there some way to make that more clear? I think renaming the variable to <code>function_alignment</code> would have kept me from being confused, at least.</p>
</blockquote>



<a name="354060280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354060280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354060280">(Apr 28 2023 at 22:01)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="354060321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354060321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354060321">(Apr 28 2023 at 22:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6302#discussion_r1180847084">PR review comment</a>:</p>
<blockquote>
<p>Ah good point!</p>
</blockquote>



<a name="354060346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354060346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354060346">(Apr 28 2023 at 22:01)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<a name="354084524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236302%20Slightly%20shrink%20compiled%20wasm%20modules/near/354084524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236302.20Slightly.20shrink.20compiled.20wasm.20modules.html#354084524">(Apr 28 2023 at 23:18)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6302">PR #6302</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>