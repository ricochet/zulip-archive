<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5288 Function references · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html">wasmtime / PR #5288 Function references</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="310544692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310544692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310544692">(Nov 17 2022 at 04:42)</a>:</h4>
<p>CosineP opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>This patch, written by @dhil and I, implements the (complete) <a href="https://github.com/WebAssembly/function-references">function references proposal</a>, forming the wasmtime side of the existing pull request <a href="https://github.com/bytecodealliance/wasm-tools/issues/701">bytecodealliance/wasm-tools#701</a>.   It is missing some obvious things:</p>
<ul>
<li>call_ref is simply translated as a cranelift indirect_call.    A faster cranelift indirect call that does not check the callee signature can (and should) eventually be added and used.</li>
<li>The wasm-tools PR has advanced past the version we depend on here.    We hope to update all at once, once the wasm-tools side has fully settled.    This will result in the removal of a number of ValType::Bot branches, the addition of the type annotation on call_ref, and a handful of other convenient things.    The version we depend on is called <a href="https://github.com/effect-handlers/wasm-tools/tree/func-ref-2">func-ref-2</a>, if you need to reference it*.</li>
<li>Wasmtime, too, has of course advanced past our parent.   I tried to rebase on the latest changes, but due to particular Cargo.toml changes, I think this will be much easier when we've retargetted to the latest wasm-tools#701 and can keep our dependencies consistent in the history</li>
</ul>
<p>Otherwise, things should be mostly obvious.    Typed function references are represented by the existing untyped function references.   Even though it's held up by wasm-tools, we ended up with a fairly polished changeset that we figured we could send out and get feedback on.    There's no rush on our end, as we've been happily using this in our typed continuations work for some time now.    But we're happy to discuss any changes, problems, or suggestions!</p>
<p>\* We added a public peek method to the validator to attain a signature for call_ref.   This is now unnecesary because call_ref comes with a type annotation, and will disappear fairly conveniently.</p>
</blockquote>



<a name="310544858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310544858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310544858">(Nov 17 2022 at 04:45)</a>:</h4>
<p>CosineP edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>This patch, written by @dhil and I, implements the (complete) <a href="https://github.com/WebAssembly/function-references">function references proposal</a>, forming the wasmtime side of the existing pull request <a href="https://github.com/bytecodealliance/wasm-tools/issues/701">bytecodealliance/wasm-tools#701</a>.   It is missing some obvious things:</p>
<ul>
<li>call_ref is simply translated as a cranelift indirect_call.    A faster cranelift indirect call that does not check the callee signature can (and should) eventually be added and used.   Further, no null check is elided.</li>
<li>The wasm-tools PR has advanced past the version we depend on here.    We hope to update all at once, once the wasm-tools side has fully settled.    This will result in the removal of a number of ValType::Bot branches, the addition of the type annotation on call_ref, and a handful of other convenient things.    The version we depend on is called <a href="https://github.com/effect-handlers/wasm-tools/tree/func-ref-2">func-ref-2</a>, if you need to reference it*.</li>
<li>Wasmtime, too, has of course advanced past our parent.   I tried to rebase on the latest changes, but due to particular Cargo.toml changes, I think this will be much easier when we've retargetted to the latest wasm-tools#701 and can keep our dependencies consistent in the history</li>
</ul>
<p>Otherwise, things should be mostly obvious.    Typed function references are represented by the existing untyped function references.   Even though it's held up by wasm-tools, we ended up with a fairly polished changeset that we figured we could send out and get feedback on.    There's no rush on our end, as we've been happily using this in our typed continuations work for some time now.    But we're happy to discuss any changes, problems, or suggestions!</p>
<p>\* We added a public peek method to the validator to attain a signature for call_ref.   This is now unnecesary because call_ref comes with a type annotation, and will disappear fairly conveniently.</p>
</blockquote>



<a name="310645654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645654">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1184566309">PR review</a>.</p>



<a name="310645655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645655">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1184566309">PR review</a>.</p>



<a name="310645657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645657">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025373874">PR review comment</a>:</p>
<blockquote>
<p>This feels sort of wrong in the sense that <code>R64</code> is going to be used to represent a family of types so it's not necessarily possible to go backwards from a cranelift type to a wasm type (like could be done historically). Reading over this thought this function is only used for <code>ModuleTranslationState::from_func_sigs</code> which I think is otherwise dead code. I opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5290">https://github.com/bytecodealliance/wasmtime/pull/5290</a> to remove this code which should help address this.</p>
</blockquote>



<a name="310645658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645658">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025362890">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps reuse the <code>IndirectCallToNull</code>? While not technically the exact same error conditions it still captures the case that this comes up with <code>call_ref</code> to a <code>null</code> table entry.</p>
</blockquote>



<a name="310645659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645659">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025368291">PR review comment</a>:</p>
<blockquote>
<p>It's ok to skip this attribute, we don't run clippy in this repository on CI or such.</p>
</blockquote>



<a name="310645660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645660">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025377009">PR review comment</a>:</p>
<blockquote>
<p>I think that this is also dead code, which I've now added to <a href="https://github.com/bytecodealliance/wasmtime/pull/5290">https://github.com/bytecodealliance/wasmtime/pull/5290</a> to get removed.</p>
</blockquote>



<a name="310645661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645661">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025366554">PR review comment</a>:</p>
<blockquote>
<p>FWIW I think now that <code>CallRef</code> carries its type payload the need for <code>ty: Option&lt;ValType&gt;</code> will probably go away, although this won't otherwise change significantly I suspect.</p>
</blockquote>



<a name="310645662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645662">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025369570">PR review comment</a>:</p>
<blockquote>
<p>FWIW this is one of the reasons that I preferred to keep <code>Bot</code> out of the public API of <code>wasmparser</code> since it prevents consumers like this from having to have <code>panic!(...)</code> branches for something that shouldn't ever be reachable.</p>
</blockquote>



<a name="310645663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645663">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025387738">PR review comment</a>:</p>
<blockquote>
<p>Actually if we wanted to get _super_ clever here (which is totally ok if you'd rather not) I think that this check can be entirely skipped. The <code>.load()</code> below will segfault if the <code>callee</code> is a null pointer which we can catch in a signal handler to report a trap, which means that technically speaking we can skip the check entirely here. I think the codegen may need to get changed slightly since the <code>MemFlags::trusted</code> used when loading the <code>func_addr</code> may or may not be right (a Cranelift expert would want to weigh in).</p>
<p>Anyway just a tiny optimization that probably doesn't matter too much in the grand scheme of things, and more than ok to defer to later.</p>
</blockquote>



<a name="310645664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645664">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025402754">PR review comment</a>:</p>
<blockquote>
<p>For this I think it's fine to generate a <code>Func</code> for a typed function index. There's no real way to propagate the type runtime type information into the Rust type system so I think it's best to return <code>Func</code> here and then embedders can used <code>.typed()</code> as today to get the typed view.</p>
</blockquote>



<a name="310645665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645665">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025380378">PR review comment</a>:</p>
<blockquote>
<p>I think it's ok to leave this as-is, and if it's ever a perf-issue we can always reach for a <code>SmallVec</code> here or something like that.</p>
</blockquote>



<a name="310645666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645666">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025381835">PR review comment</a>:</p>
<blockquote>
<p>Should This also match <code>WasmHeapType::Index(_)</code>?</p>
<p>(if so could a test be added too?)</p>
</blockquote>



<a name="310645667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645667">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025384997">PR review comment</a>:</p>
<blockquote>
<p>I think that the translation here is actually almost-perfect. The <code>call_indirect</code> instruction in Cranelift isn't the same as the one in wasm and doesn't perform any type checks or anything, it's as raw as it gets. In that sense the performance of <code>call_ref</code> is only mildly hampered where if the callee is known to be non-null a null-check still happens. Otherwise though I think that the generation here should be optimal.</p>
</blockquote>



<a name="310645668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645668">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025395988">PR review comment</a>:</p>
<blockquote>
<p>I think definitely for the case of the the <code>wasmtime</code> crate's public API we'll want to hide <code>Bot</code>, even if it ends up getting exposed in <code>wasmparser</code>.</p>
</blockquote>



<a name="310645669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645669">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025392797">PR review comment</a>:</p>
<blockquote>
<p>I went ahead an opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5291">https://github.com/bytecodealliance/wasmtime/issues/5291</a> since this applies to <code>call_indirect</code> as well.</p>
</blockquote>



<a name="310645670"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645670" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645670">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025383002">PR review comment</a>:</p>
<blockquote>
<p>Should <code>Index</code> be matched here as well?</p>
</blockquote>



<a name="310645671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645671">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025398728">PR review comment</a>:</p>
<blockquote>
<p>In retrospect, I think this might be better modeled as perhaps:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">ValType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">EXTERNREF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasmRefType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">EXTERN</span>: <span class="nc">WasmRefType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>basically just using associated <code>const</code>s to namespace things instead of splatting it into the module namespace here.</p>
</blockquote>



<a name="310645672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645672">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025394229">PR review comment</a>:</p>
<blockquote>
<p>I think that this condition isn't quite right, you'll probably want to <code>match</code> on the <code>heap_type</code> here and explicitly reject <code>externref</code> but both typed functions and normal functions should be able to fall through.</p>
</blockquote>



<a name="310645673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645673">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025401183">PR review comment</a>:</p>
<blockquote>
<p>This won't actually be stored as a field in <code>Config</code> but rather <code>self.features</code>, so this field can be omitted from the Wasmtime crate.</p>
</blockquote>



<a name="310645674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645674">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025400509">PR review comment</a>:</p>
<blockquote>
<p>This'll want to be omitted I believe until the proposal is stabilized.</p>
</blockquote>



<a name="310645675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645675">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025399035">PR review comment</a>:</p>
<blockquote>
<p>As a bit of a bikeshed, perhaps <code>RefType</code> instead of <code>Wasm*</code>?</p>
</blockquote>



<a name="310645677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645677">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025409870">PR review comment</a>:</p>
<blockquote>
<p>I think that this <code>match</code> is going to need to grow more cases or otherwise embedders can't interact with typed function tables in the embedder API. That's ok for a first pass and can be deferred to a future PR but it's functionality we'll eventually want to fill out.</p>
</blockquote>



<a name="310645679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310645679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310645679">(Nov 17 2022 at 16:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025407441">PR review comment</a>:</p>
<blockquote>
<p>At the layer of the Wasmtime embedding here it's unfortunately not longer suitable to use a <code>u32</code> here since there's not actually any way to translate this <code>u32</code> to an actual type to inspect.</p>
<p>This actually raises a particularly interesting embedding question for me, though, which is how an embedder is expected to invoke an exported function from a wasm module which takes a typed function reference as an argument (or returns such a result).</p>
<p>I can talk more with y'all if you'd like for something like this, but the <code>u32</code> here more-or-less needs to become something like a <code>FuncType</code>, but not literally that given how lightweight <code>ValType</code> is supposed to be relative to hwo heavyweight <code>FuncType</code> is. We'll probably want some form of indexing or such but this is moving into the realm of relatively large-ish changes which y'all may want to defer to later if possible.</p>
</blockquote>



<a name="310697829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310697829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310697829">(Nov 17 2022 at 20:56)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025715729">PR review comment</a>:</p>
<blockquote>
<p>This is due to some vestigial bits from when we had extended basic blocks instead of plain basic blocks. Because we have basic blocks, we can't add new non-block-terminating instructions after a <code>brz</code>. But also we don't currently have a two-way conditional branch instruction, so blocks ending in control flow splits have to end with something like <code>brz L1; jump L2</code> instead. We have general plans to clean this stuff up in the not super distant future, but thats the state of affairs for now.</p>
</blockquote>



<a name="310697830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310697830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310697830">(Nov 17 2022 at 20:56)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185079496">PR review</a>.</p>



<a name="310697863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310697863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310697863">(Nov 17 2022 at 20:56)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025715729">PR review comment</a>.</p>



<a name="310699724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310699724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310699724">(Nov 17 2022 at 21:08)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185096205">PR review</a>.</p>



<a name="310699726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310699726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310699726">(Nov 17 2022 at 21:08)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025734326">PR review comment</a>:</p>
<blockquote>
<p>Indeed, we would want to remove the <code>trusted</code> flag here, if the load can trap, and this would require a bit more plumbing to emit the right trap code associated with this load's PC (it's no longer a heap-out-of-bounds). But this is probably an O(tens of lines)-sized change, not too bad. Happy to dig a bit and point out specific bits if you want to do this in a followup PR.</p>
</blockquote>



<a name="310703503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703503">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185084890">PR review</a>.</p>



<a name="310703505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703505">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1185084890">PR review</a>.</p>



<a name="310703506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703506">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025720628">PR review comment</a>:</p>
<blockquote>
<p>Should this case be unreachable given that we've checked that the instruction is valid? If so, then this can be an <code>unreachable!()</code> instead. If not, then it should return a proper error instead of panicking.</p>
</blockquote>



<a name="310703507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703507">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025749498">PR review comment</a>:</p>
<blockquote>
<p>lol not the best situation, yes, but this is the one that is generally public-facing rather than an implementation detail, so it should really have Proper(tm) docs with punctuation and a helpful description and all that.</p>
</blockquote>



<a name="310703508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703508">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025736879">PR review comment</a>:</p>
<blockquote>
<p>Following up on Alex's question: do the spec tests for typed function references not exercise tables of typed function references (and all the various table operations on them like <code>table.fill</code>)? If so, that seems like something where it is worth sending a PR upstream for or at least filing an issue.</p>
</blockquote>



<a name="310703509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/310703509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#310703509">(Nov 17 2022 at 21:35)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1025744337">PR review comment</a>:</p>
<blockquote>
<p>Why is this a <code>TryFrom</code> impl instead of a <code>From</code> impl? It appears to be infallible.</p>
</blockquote>



<a name="314150256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314150256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314150256">(Dec 06 2022 at 00:18)</a>:</h4>
<p>CosineP submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1205521799">PR review</a>.</p>



<a name="314150257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314150257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314150257">(Dec 06 2022 at 00:18)</a>:</h4>
<p>CosineP created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1040252011">PR review comment</a>:</p>
<blockquote>
<p>Fortunately this whole expression disappears on merge because call_ref has gained a proper type annotation</p>
</blockquote>



<a name="314151693"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314151693" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314151693">(Dec 06 2022 at 00:34)</a>:</h4>
<p>CosineP submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1205535397">PR review</a>.</p>



<a name="314151703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314151703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314151703">(Dec 06 2022 at 00:34)</a>:</h4>
<p>CosineP created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1040261402">PR review comment</a>:</p>
<blockquote>
<p>Oh gosh I'm sorry haha, I guess this somehow made it through the "rebase and sanitize 12am thoughts" process</p>
</blockquote>



<a name="314151736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314151736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314151736">(Dec 06 2022 at 00:34)</a>:</h4>
<p>CosineP updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="314271829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314271829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314271829">(Dec 06 2022 at 16:22)</a>:</h4>
<p>CosineP submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1206908002">PR review</a>.</p>



<a name="314271830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314271830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314271830">(Dec 06 2022 at 16:22)</a>:</h4>
<p>CosineP created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1041185988">PR review comment</a>:</p>
<blockquote>
<p>Should the pre-existing WasmType be renamed as well?</p>
</blockquote>



<a name="314272286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/314272286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#314272286">(Dec 06 2022 at 16:24)</a>:</h4>
<p>CosineP updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="329762400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/329762400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#329762400">(Feb 23 2023 at 16:22)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="336555489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555489">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1313875636">PR review</a>.</p>



<a name="336555491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555491">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1313875636">PR review</a>.</p>



<a name="336555492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555492">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117283484">PR review comment</a>:</p>
<blockquote>
<p>Stray change?</p>
</blockquote>



<a name="336555493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555493">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117284971">PR review comment</a>:</p>
<blockquote>
<p>I think this may need to be <code>null_reference</code> since I think this is used during parsing of the <code>*.clif</code> IR which wouldn't work with a space in the middle I think</p>
</blockquote>



<a name="336555496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555496">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117285632">PR review comment</a>:</p>
<blockquote>
<p>This file may have snuck in during the merge?</p>
</blockquote>



<a name="336555498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555498">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117283312">PR review comment</a>:</p>
<blockquote>
<p>I think this file snuck back in from the recent merge?</p>
</blockquote>



<a name="336555501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555501">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117287116">PR review comment</a>:</p>
<blockquote>
<p>I think this can be written as <code>u32::from(*type_idx)</code> to be a bit more concise.</p>
</blockquote>



<a name="336555502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555502">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117456482">PR review comment</a>:</p>
<blockquote>
<p>Could the <code>nullable</code> field here be filled out based on whether the value is <code>Some</code> or <code>None</code>?</p>
</blockquote>



<a name="336555503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555503">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117303486">PR review comment</a>:</p>
<blockquote>
<p>These two values are showing up quite a lot in tests, so I think it might be good to refactor this to have, at the definition:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">RefType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">EXTERNREF</span>: <span class="nc">RefType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FUNCREF</span>: <span class="nc">RefType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span>
<span class="p">}</span>
</code></pre></div>
<p>and probably similarly for <code>ValType</code></p>
</blockquote>



<a name="336555504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555504">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117458230">PR review comment</a>:</p>
<blockquote>
<p>I think this will want to match <code>nullable: true</code> since storing a null funcref into a table that is non-nullable should be an error</p>
</blockquote>



<a name="336555505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555505">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117461627">PR review comment</a>:</p>
<blockquote>
<p>I'll bump this again, this is a serious issue which must be addressed before the PR is merged. As I mentioned before though this has far-reaching implications and is unfortunately not going to be easy to handle. For example the <code>PartialEq</code>/<code>Eq</code> implementations for this type (and transitively for <code>ValType</code>) aren't valid any more to go through <code>u32</code> since two different modules could have the same <code>u32</code> pointing at different types.</p>
</blockquote>



<a name="336555506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/336555506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#336555506">(Feb 24 2023 at 18:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1117459209">PR review comment</a>:</p>
<blockquote>
<p>To bump this, I think it would be good to have at least have a specific error for <code>HeapType::Index</code> which indicates that support is missing.</p>
</blockquote>



<a name="338315337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315337">(Feb 27 2023 at 12:37)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315497701">PR review</a>.</p>



<a name="338315339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315339">(Feb 27 2023 at 12:37)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118682127">PR review comment</a>:</p>
<blockquote>
<p>Yes! Thank you.</p>
</blockquote>



<a name="338315452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315452">(Feb 27 2023 at 12:38)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315498312">PR review</a>.</p>



<a name="338315454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315454">(Feb 27 2023 at 12:38)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118682548">PR review comment</a>:</p>
<blockquote>
<p>Yep! I'll remove it.</p>
</blockquote>



<a name="338315527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315527">(Feb 27 2023 at 12:38)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315498986">PR review</a>.</p>



<a name="338315529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315529">(Feb 27 2023 at 12:38)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683069">PR review comment</a>:</p>
<blockquote>
<p>Got it!</p>
</blockquote>



<a name="338315607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315607">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683448">PR review comment</a>:</p>
<blockquote>
<p>Yep, it looks that way. I quite possibly missed "a deleted by them" during the merge.</p>
</blockquote>



<a name="338315608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315608">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315499519">PR review</a>.</p>



<a name="338315627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315627">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315499715">PR review</a>.</p>



<a name="338315629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315629">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118683591">PR review comment</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="338315738"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315738" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315738">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315500494">PR review</a>.</p>



<a name="338315740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315740">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118684093">PR review comment</a>:</p>
<blockquote>
<p>What would be the right place to store this shared logic for testing?</p>
</blockquote>



<a name="338315772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338315772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338315772">(Feb 27 2023 at 12:39)</a>:</h4>
<p>dhil edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118684093">PR review comment</a>.</p>



<a name="338316375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338316375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338316375">(Feb 27 2023 at 12:42)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315504691">PR review</a>.</p>



<a name="338316377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338316377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338316377">(Feb 27 2023 at 12:42)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118686913">PR review comment</a>:</p>
<blockquote>
<p>Yep, it is technically possible since it is valid to use a non-nullable reference in place of a nullable reference. However, it does come with a cost -- which I think is inevitable anyways -- which is that we must perform a subtype check where we would previously perform a standard equality <code>==</code> check.</p>
</blockquote>



<a name="338316410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338316410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338316410">(Feb 27 2023 at 12:42)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315504971">PR review</a>.</p>



<a name="338316412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338316412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338316412">(Feb 27 2023 at 12:42)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118687084">PR review comment</a>:</p>
<blockquote>
<p>Good catch! Thanks. I will add a couple of test cases.</p>
</blockquote>



<a name="338316499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338316499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338316499">(Feb 27 2023 at 12:43)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="338318299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338318299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338318299">(Feb 27 2023 at 12:50)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315516761">PR review</a>.</p>



<a name="338318303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338318303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338318303">(Feb 27 2023 at 12:50)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118694996">PR review comment</a>:</p>
<blockquote>
<p>So would we need to equip the type with some sort of provenance that can inform us about the origin module?</p>
</blockquote>



<a name="338318367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338318367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338318367">(Feb 27 2023 at 12:51)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315517219">PR review</a>.</p>



<a name="338318368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338318368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338318368">(Feb 27 2023 at 12:51)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118695266">PR review comment</a>:</p>
<blockquote>
<p>Added, thanks!</p>
</blockquote>



<a name="338332131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338332131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338332131">(Feb 27 2023 at 13:51)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="338332758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338332758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338332758">(Feb 27 2023 at 13:55)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1315636427">PR review</a>.</p>



<a name="338332762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338332762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338332762">(Feb 27 2023 at 13:55)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118767872">PR review comment</a>:</p>
<blockquote>
<p>It now reads:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span><span class="p">.</span><span class="n">table_plans</span><span class="p">[</span><span class="n">segment</span><span class="p">.</span><span class="n">table_index</span><span class="p">]</span>
<span class="w">                </span><span class="p">.</span><span class="n">table</span>
<span class="w">                </span><span class="p">.</span><span class="n">wasm_ty</span>
<span class="w">                </span><span class="p">.</span><span class="n">heap_type</span>
<span class="w">                </span><span class="o">==</span><span class="w"> </span><span class="n">WasmHeapType</span>::<span class="n">Extern</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">leftovers</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">segment</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
</code></pre></div>
<p>Is this close enough to what you had in mind? Alternatively, we can match explicitly on <code>heap_type</code> to make this code more robust against changes to <code>WasmHeapType</code>.</p>
</blockquote>



<a name="338333035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338333035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338333035">(Feb 27 2023 at 13:56)</a>:</h4>
<p>dhil edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1118767872">PR review comment</a>.</p>



<a name="338669669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669669">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1318332703">PR review</a>.</p>



<a name="338669671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669671">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1318332703">PR review</a>.</p>



<a name="338669674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669674">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120614524">PR review comment</a>:</p>
<blockquote>
<p>I think this may also need <code>s/ /_/</code>?</p>
</blockquote>



<a name="338669677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669677">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120617719">PR review comment</a>:</p>
<blockquote>
<p>This is a "dummy" implementation anyway so this representation is fine FWIW (should be ok to drop the comment here)</p>
</blockquote>



<a name="338669678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669678">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120615519">PR review comment</a>:</p>
<blockquote>
<p>I think these comments may be leftover from prior refactorings? (and some below this as well)</p>
</blockquote>



<a name="338669680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669680">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120628362">PR review comment</a>:</p>
<blockquote>
<p>I think this may not be correct in the sense that <code>EXTERNREF</code> is "nullable <code>ref extern</code>" but non-nullable externs should still use this code path which does reference counting.</p>
</blockquote>



<a name="338669681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669681">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120616421">PR review comment</a>:</p>
<blockquote>
<p>It's ok to drop this as we don't have a ton of rhyme or reason to the current opcode ordering at this time.</p>
</blockquote>



<a name="338669682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669682">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120629137">PR review comment</a>:</p>
<blockquote>
<p>Like above I think this needs to handle non-nullable externrefs here as well to destroy them properly</p>
</blockquote>



<a name="338669684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669684">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120632985">PR review comment</a>:</p>
<blockquote>
<p>This makes sense to me to add, but can <code>PartialEq</code> and <code>Eq</code> be removed from <code>ValType</code> as well? (to force callers to use this function)</p>
</blockquote>



<a name="338669685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338669685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338669685">(Feb 28 2023 at 19:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1120642776">PR review comment</a>:</p>
<blockquote>
<p>More-or-less yeah. In some sense this "needs" to become <code>FuncType</code> which internally has a params/results list. I don't think we can literally do that though because of the performance ramifications (e.g. that's an owned list, requires extra allocations to move around, etc). </p>
<p>An alternative would be something akin to <code>VMSharedSignatureIndex</code> which is a unique 32-bit integer deduplicating function types within an <code>Engine</code>. That wouldn't work literally as well either though because indices different engines can't be compared. Additionally this wouldn't work because when performing a subtype check you'd need to be able to walk through the indices to perform a deep subtyping check on params/results of functions.</p>
<p>One possibility would be to perhaps:</p>
<ul>
<li>Assign a unique 32-bit id to each <code>Engine</code> (similar to how a store gets an id today)</li>
<li>Provide an <code>Engine</code> in the subtyping check</li>
<li>Store an engine id and a shared signature index here.</li>
</ul>
<p>Even with all this though that's still unfortunately pretty expansive and I'm not sure whether it would work out. So with all that in mind I would propose an alternative. I suspect that the modules you're interested in running don't use funcrefs "at the boundary" in the sense of imported/exported functions from the module that the host interacts with. In that sense I think it's fine to just fail to compile any module that has a funcref/etc in imports/exports in Wasmtime for now. Filling out support for that is fine to have as a "TODO" at some point.</p>
<p>Basically my point is that I think it's fine to implement the "runtime" half of the function-references proposal without implementing the "embedder half". It means Wasmtime won't be able to run every module under the sun that's valid for function-references but it'll probably still run at least the most interesting ones. If you decide to go down this route, though, it will involve a number of changes to the <code>wasmtime</code> crate, namely to basically back out any function-references support and to thread errors through from "when function references are encountered at the import/export level an error is returned"</p>
</blockquote>



<a name="338847337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338847337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338847337">(Mar 01 2023 at 13:57)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="338865443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865443">(Mar 01 2023 at 15:00)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031452">PR review</a>.</p>



<a name="338865450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865450">(Mar 01 2023 at 15:00)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874371">PR review comment</a>:</p>
<blockquote>
<p>I will tidy this up.</p>
</blockquote>



<a name="338865461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865461">(Mar 01 2023 at 15:00)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031698">PR review</a>.</p>



<a name="338865463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865463">(Mar 01 2023 at 15:00)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874431">PR review comment</a>:</p>
<blockquote>
<p>Ok, I will remove the todo.</p>
</blockquote>



<a name="338865464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865464">(Mar 01 2023 at 15:00)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874255">PR review comment</a>:</p>
<blockquote>
<p>Yes!</p>
</blockquote>



<a name="338865475"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865475" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865475">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031605">PR review</a>.</p>



<a name="338865478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865478">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874506">PR review comment</a>:</p>
<blockquote>
<p>Ok, thanks!</p>
</blockquote>



<a name="338865485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865485">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031898">PR review</a>.</p>



<a name="338865507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865507">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031989">PR review</a>.</p>



<a name="338865508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865508">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874687">PR review comment</a>:</p>
<blockquote>
<p>Got it!</p>
</blockquote>



<a name="338865511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865511">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320031796">PR review</a>.</p>



<a name="338865521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865521">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1320032088">PR review</a>.</p>



<a name="338865522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865522">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874588">PR review comment</a>:</p>
<blockquote>
<p>Yes, good catch!</p>
</blockquote>



<a name="338865531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/338865531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#338865531">(Mar 01 2023 at 15:01)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1121874779">PR review comment</a>:</p>
<blockquote>
<p>Interesting suggestion. Doing this revealed some potential bugs. It did require me to change the <code>assert_eq!</code> in the <code>func</code> and <code>host_func</code> tests as they extensively relied on the ability to use the <code>PartialEq</code> operator for comparisons.</p>
<p>There is one place where I am not entirely sure that we want to do subtyping: in <a href="https://github.com/bytecodealliance/wasmtime/blob/63ff410119e90f340fdc91ccaba65fddcc3ebe3a/crates/wasi-threads/src/lib.rs#L173"><code>wasi-threads</code></a> used a strict equality check; I have preserved this for now because I don't know enough about what's going on there.</p>
</blockquote>



<a name="339348170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/339348170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#339348170">(Mar 03 2023 at 13:42)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a> from <code>function-references</code> to <code>main</code>.</p>



<a name="339353856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/339353856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#339353856">(Mar 03 2023 at 14:05)</a>:</h4>
<p>dhil submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1323859288">PR review</a>.</p>



<a name="339353858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/339353858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#339353858">(Mar 03 2023 at 14:05)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1124499953">PR review comment</a>:</p>
<blockquote>
<p>It sounds like to me it might be worth to survey the design space a little more before committing to implementing a particular design. I think what I would like to do is to separate the work into a "runtime half" PR and at a later stage an "embedder half" PR. It sounds less risky to me personally, and I think you are right, that for my research I do not yet need things to work at the boundary.</p>
</blockquote>



<a name="339894433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/339894433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#339894433">(Mar 06 2023 at 15:12)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1326528506">PR review</a>.</p>



<a name="339894434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/339894434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#339894434">(Mar 06 2023 at 15:12)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1126569577">PR review comment</a>:</p>
<blockquote>
<p>Yeah that's reasonable to me and I think would work out well. You may have to add a few more error-paths in places that may be infallible but that's ok, at the top-level I think everything is fallible to communicate the necessary errors here so it'd just be internal refactoring.</p>
</blockquote>



<a name="349023901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023901">(Apr 13 2023 at 07:36)</a>:</h4>
<p><strong>dhil</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349023902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023902">(Apr 13 2023 at 07:36)</a>:</h4>
<p><strong>dhil</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349023907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023907">(Apr 13 2023 at 07:36)</a>:</h4>
<p><strong>dhil</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349023908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023908">(Apr 13 2023 at 07:36)</a>:</h4>
<p><strong>dhil</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349023910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023910">(Apr 13 2023 at 07:36)</a>:</h4>
<p><strong>dhil</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349023911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349023911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349023911">(Apr 13 2023 at 07:36)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="349026875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/349026875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#349026875">(Apr 13 2023 at 07:50)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="350437194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/350437194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#350437194">(Apr 17 2023 at 08:16)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="350693282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/350693282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#350693282">(Apr 18 2023 at 07:27)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="350837648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/350837648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#350837648">(Apr 18 2023 at 16:54)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351018099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351018099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351018099">(Apr 19 2023 at 11:37)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351049995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351049995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351049995">(Apr 19 2023 at 13:32)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351050542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351050542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351050542">(Apr 19 2023 at 13:34)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351234172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351234172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351234172">(Apr 20 2023 at 07:37)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351359316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351359316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351359316">(Apr 20 2023 at 15:26)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="351360774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/351360774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#351360774">(Apr 20 2023 at 15:31)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="352535661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/352535661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#352535661">(Apr 25 2023 at 13:18)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="353157209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/353157209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#353157209">(Apr 27 2023 at 08:18)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="355380813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/355380813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#355380813">(May 03 2023 at 09:54)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="355381138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/355381138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#355381138">(May 03 2023 at 09:55)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="358656266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/358656266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#358656266">(May 16 2023 at 08:28)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="358968463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/358968463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#358968463">(May 17 2023 at 12:20)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="359630456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/359630456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#359630456">(May 19 2023 at 11:40)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="360237579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360237579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360237579">(May 22 2023 at 11:23)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="360506897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360506897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360506897">(May 23 2023 at 11:50)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="360511341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360511341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360511341">(May 23 2023 at 12:08)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="360703047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360703047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360703047">(May 24 2023 at 06:48)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="360812353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360812353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360812353">(May 24 2023 at 14:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1442094245">PR review</a>:</p>
<blockquote>
<p>Ok this looks good to go to me, thanks again @CosineP and @dhil!</p>
<p>I'd like another pair of eyes on this though given what's changing here, so I'm going to request that @fitzgen take a look as well. If y'all would be ok opening up a tracking issue for the remaining items that'd be appreciated!</p>
</blockquote>



<a name="360812397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/360812397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#360812397">(May 24 2023 at 14:47)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="361122708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361122708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361122708">(May 25 2023 at 17:22)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="361153081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361153081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361153081">(May 25 2023 at 19:46)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1444478345">PR review</a>:</p>
<blockquote>
<p>Let's get this merged! Thanks @dhil and @CosineP!</p>
</blockquote>



<a name="361153082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361153082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361153082">(May 25 2023 at 19:46)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#pullrequestreview-1444478345">PR review</a>:</p>
<blockquote>
<p>Let's get this merged! Thanks @dhil and @CosineP!</p>
</blockquote>



<a name="361153083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361153083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361153083">(May 25 2023 at 19:46)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1205905935">PR review comment</a>:</p>
<blockquote>
<p>Can we file an issue to track this?</p>
</blockquote>



<a name="361153084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361153084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361153084">(May 25 2023 at 19:46)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1205897529">PR review comment</a>:</p>
<blockquote>
<p>This function's allocations were previously showing up in DHAT for some profiling I did, which is why we ended up wit the super generic interface to this function and weird <code>&amp;'static [_]</code> stuff going on. All that is to say that I think we should probably use a small vec here.</p>
<p>Fine to do as a follow up.</p>
</blockquote>



<a name="361250795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361250795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361250795">(May 26 2023 at 08:21)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="361253266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361253266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361253266">(May 26 2023 at 08:31)</a>:</h4>
<p>dhil created <a href="https://github.com/bytecodealliance/wasmtime/pull/5288#discussion_r1206423254">PR review comment</a>:</p>
<blockquote>
<p>I've added this to #6455. I can hoist it into a separate issue if need be.</p>
</blockquote>



<a name="361354769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361354769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361354769">(May 26 2023 at 14:59)</a>:</h4>
<p>dhil updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="361357571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361357571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361357571">(May 26 2023 at 15:08)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<a name="361373930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235288%20Function%20references/near/361373930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235288.20Function.20references.html#361373930">(May 26 2023 at 16:06)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5288">PR #5288</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>