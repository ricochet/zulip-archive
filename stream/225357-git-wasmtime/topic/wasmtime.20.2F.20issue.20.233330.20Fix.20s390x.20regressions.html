<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3330 Fix s390x regressions · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html">wasmtime / issue #3330 Fix s390x regressions</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="252908944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/252908944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#252908944">(Sep 11 2021 at 13:17)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-917406226">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>Note: In addition to this PR, the endian fix in PR #3329 and the rsix build fix <a href="https://github.com/bytecodealliance/rsix/pull/53">https://github.com/bytecodealliance/rsix/pull/53</a> are required to make the CI tests fully pass again on s390x.</p>
</blockquote>



<a name="252909193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/252909193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#252909193">(Sep 11 2021 at 13:21)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-917406800">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>Also: Using qemu 6.1 we should now be able to turn on upstream CI for the s390x platform.</p>
</blockquote>



<a name="252909831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/252909831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#252909831">(Sep 11 2021 at 13:33)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-917408475">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="252918489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/252918489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#252918489">(Sep 11 2021 at 16:00)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-917430237">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>I opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3331">https://github.com/bytecodealliance/wasmtime/pull/3331</a> to pull in the s390x fix in <code>rsix</code>.</p>
</blockquote>



<a name="252921686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/252921686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#252921686">(Sep 11 2021 at 16:54)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-917438055">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<p>I opened #3331 to pull in the s390x fix in <code>rsix</code>.</p>
</blockquote>
<p>Thanks, @sunfishcode !</p>
</blockquote>



<a name="253111563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253111563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253111563">(Sep 13 2021 at 15:42)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-918322414">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>@alexcrichton you were right, I just had to add a single <code>saturating_add</code>.    Given that this is just a one-line obvious fix to common code,  I've now updated this PR after all.   Let me know if you'd prefer me to take it out again.</p>
<p>Note that BranchRI max ranges were just completely wrong, but that type isn't currently used anywhere so it didn't matter.  I've now fixed this and used precise max ranges for all types, only capped by a max of 0xffff_ffff due to the u32 type.</p>
</blockquote>



<a name="253151820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253151820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253151820">(Sep 13 2021 at 20:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-918535369">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>Nah yeah that's what I would have expected for a <code>saturating_add</code> and it looks good to me! I think someone will still want to look over the sconst changes to the s390x backend though.</p>
</blockquote>



<a name="253427356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253427356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253427356">(Sep 15 2021 at 14:52)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-920092232">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<p>Also: Using qemu 6.1 we should now be able to turn on upstream CI for the s390x platform.</p>
</blockquote>
<p>Just want to mention that we have now upgraded to 6.1 in #3325</p>
</blockquote>



<a name="253433327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253433327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253433327">(Sep 15 2021 at 15:27)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-920123364">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<p>Nah yeah that's what I would have expected for a <code>saturating_add</code> and it looks good to me! I think someone will still want to look over the sconst changes to the s390x backend though.</p>
</blockquote>
<p>Thanks!   @cfallin do you want to have a look at those?<br>
</p>
</blockquote>



<a name="253433511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253433511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253433511">(Sep 15 2021 at 15:29)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-920124237">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>Also: Using qemu 6.1 we should now be able to turn on upstream CI for the s390x platform.</p>
</blockquote>
<p>Just want to mention that we have now upgraded to 6.1 in #3325</p>
</blockquote>
<p>Excellent.   Not sure exactly what we need to do to add a CI job for s390x, I haven't done much with GitHub actions before ...</p>
</blockquote>



<a name="253436320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253436320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253436320">(Sep 15 2021 at 15:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-920138451">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>To add a CI job theoretically all that needs to be done is to copy/paste <a href="https://github.com/bytecodealliance/wasmtime/blob/d20194fa4c45c68ff1fea315eabc262e854c3074/.github/workflows/main.yml#L230-L237">this block</a> to add another entry below it, and then update the various values for s390x instead of aarch64.</p>
</blockquote>



<a name="253437007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/253437007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#253437007">(Sep 15 2021 at 15:49)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-920141963">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<p>To add a CI job theoretically all that needs to be done is to copy/paste <a href="https://github.com/bytecodealliance/wasmtime/blob/d20194fa4c45c68ff1fea315eabc262e854c3074/.github/workflows/main.yml#L230-L237">this block</a> to add another entry below it, and then update the various values for s390x instead of aarch64.</p>
</blockquote>
<p>Thanks!  I'll give it a try once the two PRs are merged.</p>
</blockquote>



<a name="254031161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/254031161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#254031161">(Sep 20 2021 at 10:59)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-922824216">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<p>So can this be merged now?   This is now the final bit blocking successful builds on s390x ...</p>
</blockquote>



<a name="254075033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233330%20Fix%20s390x%20regressions/near/254075033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233330.20Fix.20s390x.20regressions.html#254075033">(Sep 20 2021 at 16:09)</a>:</h4>
<p>uweigand <a href="https://github.com/bytecodealliance/wasmtime/pull/3330#issuecomment-923068746">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3330">issue #3330</a>:</p>
<blockquote>
<blockquote>
<p>To add a CI job theoretically all that needs to be done is to copy/paste <a href="https://github.com/bytecodealliance/wasmtime/blob/d20194fa4c45c68ff1fea315eabc262e854c3074/.github/workflows/main.yml#L230-L237">this block</a> to add another entry below it, and then update the various values for s390x instead of aarch64.</p>
</blockquote>
<p>This is now <a href="https://github.com/bytecodealliance/wasmtime/pull/3372">https://github.com/bytecodealliance/wasmtime/pull/3372</a> .   I also had to disable the lightbeam tests (just like on aarch64).</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>