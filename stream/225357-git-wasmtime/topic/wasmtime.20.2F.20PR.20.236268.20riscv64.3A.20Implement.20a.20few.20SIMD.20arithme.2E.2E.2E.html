<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6268 riscv64: Implement a few SIMD arithme... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html">wasmtime / PR #6268 riscv64: Implement a few SIMD arithme...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="352045605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352045605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352045605">(Apr 23 2023 at 11:33)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a> from <code>afonso360:riscv-vec-arithmetic</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR Implements a few more arithmetic ops, I didn't want to implement too many since I want to get the wasmtime testsuite working to get better test coverage.</p>
<p>Similarly to #6266, I've also switched the scalar rules to match only scalars, since most of them used <code>fits_in_64</code> which also matches vectors.</p>
<p>I also had accidentally switched the order of the registers in <code>VecAluRRR</code>, which I only noticed when implementing <code>isub</code>.</p>
<p>Implemented ops are:</p>
<ul>
<li><code>isub</code></li>
<li><code>imul</code></li>
<li><code>smulhi</code></li>
<li><code>umulhi</code></li>
<li><code>band</code></li>
<li><code>bor</code></li>
<li><code>bxor</code></li>
</ul>
<p>This PR is based on #6266, I'll rebase when that lands.</p>
</blockquote>



<a name="352045606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352045606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352045606">(Apr 23 2023 at 11:33)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352045607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352045607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352045607">(Apr 23 2023 at 11:33)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352048178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352048178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352048178">(Apr 23 2023 at 11:47)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352291042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352291042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352291042">(Apr 24 2023 at 14:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#pullrequestreview-1396989522">PR review</a>.</p>



<a name="352291043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352291043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352291043">(Apr 24 2023 at 14:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#pullrequestreview-1396989522">PR review</a>.</p>



<a name="352291044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352291044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352291044">(Apr 24 2023 at 14:19)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1174652369">PR review comment</a>:</p>
<blockquote>
<p>This seems like it may be likely be called relatively frequently, so could this perhaps be calculated when the <code>IsleContext</code> is created and reused from that?</p>
</blockquote>



<a name="352291045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352291045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352291045">(Apr 24 2023 at 14:19)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1175355800">PR review comment</a>:</p>
<blockquote>
<p>One thing that may be worth adding here is presets perhaps? For example on x64 <code>sse42</code> is a preset which automatically sets <code>has_sse41</code> and <code>has_sse42</code>, so if all of these imply the others then <code>zvl65536b</code> could perhaps be a preset that implies all the others?</p>
</blockquote>



<a name="352572361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352572361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352572361">(Apr 25 2023 at 15:31)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352575488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352575488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352575488">(Apr 25 2023 at 15:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#pullrequestreview-1400217758">PR review</a>.</p>



<a name="352575489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352575489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352575489">(Apr 25 2023 at 15:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#pullrequestreview-1400217758">PR review</a>.</p>



<a name="352575490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352575490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352575490">(Apr 25 2023 at 15:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1176707860">PR review comment</a>:</p>
<blockquote>
<p>Mind copying over the <code>target x86_64 has_sse41=false</code> line as well from the original test? (maybe lost through a rebase by accident)</p>
</blockquote>



<a name="352575491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352575491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352575491">(Apr 25 2023 at 15:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1176704550">PR review comment</a>:</p>
<blockquote>
<p>If these all follow the same pattern, one thing I found helpful for AVX was do do something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"{self:?}"</span><span class="p">);</span>
<span class="n">s</span><span class="p">.</span><span class="n">make_ascii_lowercase</span><span class="p">();</span>
<span class="n">s</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">".vv"</span><span class="p">);</span>
<span class="n">f</span><span class="p">.</span><span class="n">write_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>
<p>which can cut down on codegen times and additionally make this a bit easier to maintain. If the instructions have all sorts of different names though this may not work out well</p>
</blockquote>



<a name="352575493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352575493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352575493">(Apr 25 2023 at 15:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1176708589">PR review comment</a>:</p>
<blockquote>
<p>This also makes me idly think that perhaps there should be a <code>; skip: riscv</code> directive for filetests or similar, but not something to be added in this PR of course.</p>
</blockquote>



<a name="352576437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352576437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352576437">(Apr 25 2023 at 15:46)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1176713879">PR review comment</a>:</p>
<blockquote>
<p>We also have another variant for all of these, which is <code>v*.vx</code>. however, it should still be fairly easy to fit into that scheme when we do need it.</p>
</blockquote>



<a name="352577427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352577427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352577427">(Apr 25 2023 at 15:50)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6268#discussion_r1176713879">PR review comment</a>.</p>



<a name="352580405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352580405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352580405">(Apr 25 2023 at 16:02)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352586804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352586804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352586804">(Apr 25 2023 at 16:29)</a>:</h4>
<p>afonso360 has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<a name="352597835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236268%20riscv64%3A%20Implement%20a%20few%20SIMD%20arithme.../near/352597835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236268.20riscv64.3A.20Implement.20a.20few.20SIMD.20arithme.2E.2E.2E.html#352597835">(Apr 25 2023 at 17:16)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6268">PR #6268</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>