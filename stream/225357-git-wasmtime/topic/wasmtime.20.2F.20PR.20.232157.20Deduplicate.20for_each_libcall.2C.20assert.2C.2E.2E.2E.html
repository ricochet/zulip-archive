<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2157 Deduplicate for_each_libcall, assert,... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html">wasmtime / PR #2157 Deduplicate for_each_libcall, assert,...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="207687027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207687027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207687027">(Aug 21 2020 at 21:30)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2157">PR #2157</a> from <code>libcalls-wasmtime</code> to <code>main</code>:</p>
<blockquote>
<p>We don't have listed all Libcalls in the <code>for_each_libcall</code> at the moment. (And I noticed <code>Libcall::Probestack</code> reloc record in one of the large WASI programs)</p>
<p>This patch:</p>
<ul>
<li>[x] removes for_each_libcall macro from the obj crate</li>
<li>[x] adds __assert_all_for_each_libcalls to catch missing Libcall (and warns for duplicate)</li>
<li>[x] Implement wasmtime_memXXX and stub rest</li>
</ul>
<p>Not sure what are the plans. Can we use stuff from the compiler-builtins crate here?</p>
</blockquote>



<a name="207687596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207687596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207687596">(Aug 21 2020 at 21:36)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-472830835">PR Review</a>.</p>



<a name="207687597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207687597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207687597">(Aug 21 2020 at 21:36)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-472830835">PR Review</a>.</p>



<a name="207687598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207687598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207687598">(Aug 21 2020 at 21:36)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r474979469">PR Review Comment</a>:</p>
<blockquote>
<p>This can be <code>unreachable!()</code>. Wasmtime doesn't use TLS in the jitted code.</p>
</blockquote>



<a name="207687599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207687599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207687599">(Aug 21 2020 at 21:36)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r474980424">PR Review Comment</a>:</p>
<blockquote>
<p>You would have to use something like <code>extern "C" { #[linkage_name = "__rust_probestack"] fn wasmtime_probestack(); }</code>. The abi of probestack is incompatible with C, so using a wrapper function with abi C won't work.</p>
</blockquote>



<a name="207861962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207861962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207861962">(Aug 24 2020 at 16:06)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-473643903">PR Review</a>.</p>



<a name="207861963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207861963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207861963">(Aug 24 2020 at 16:06)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-473643903">PR Review</a>.</p>



<a name="207861965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207861965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207861965">(Aug 24 2020 at 16:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r475725052">PR Review Comment</a>:</p>
<blockquote>
<p>Could this actually get removed since I don't think it's used anywhere any more?</p>
</blockquote>



<a name="207861966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207861966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207861966">(Aug 24 2020 at 16:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r475725276">PR Review Comment</a>:</p>
<blockquote>
<p>Out of curiosity, where do these get generated in cranelift?</p>
</blockquote>



<a name="207862716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207862716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207862716">(Aug 24 2020 at 16:13)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-473650914">PR Review</a>.</p>



<a name="207862717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207862717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207862717">(Aug 24 2020 at 16:13)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r475730365">PR Review Comment</a>:</p>
<blockquote>
<p>I assume they will be generated when implementing the bulk memory wasm proposal.</p>
</blockquote>



<a name="207868383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207868383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207868383">(Aug 24 2020 at 17:04)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#pullrequestreview-473690781">PR Review</a>.</p>



<a name="207868384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/207868384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#207868384">(Aug 24 2020 at 17:04)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#discussion_r475763667">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I'm getting <code>Libcall::Probestack</code> relocation entries in large code base. (I'll find out where exactly it is coming from.)</p>
</blockquote>



<a name="426246404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/426246404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#426246404">(Mar 13 2024 at 02:18)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/2157">PR #2157</a>.</p>



<a name="426246406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232157%20Deduplicate%20for_each_libcall%2C%20assert%2C.../near/426246406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232157.20Deduplicate.20for_each_libcall.2C.20assert.2C.2E.2E.2E.html#426246406">(Mar 13 2024 at 02:18)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2157#issuecomment-1993147692">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2157">PR #2157</a>:</p>
<blockquote>
<p>This PR is pretty old in Wasmtime now and would need a good bit of rebasing to get it applying again. Enough time has passed as well that enough has changed under the hood, so I'm going to close this</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>