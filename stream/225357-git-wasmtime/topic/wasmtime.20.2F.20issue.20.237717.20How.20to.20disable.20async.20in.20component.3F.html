<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7717 How to disable async in component? · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html">wasmtime / issue #7717 How to disable async in component?</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="409345551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/409345551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#409345551">(Dec 21 2023 at 09:23)</a>:</h4>
<p><a href="https://github.com/k82cn">k82cn</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">Issue #7717</a>.</p>



<a name="409345554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/409345554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#409345554">(Dec 21 2023 at 09:23)</a>:</h4>
<p>k82cn opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><strong>WIT</strong>: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">component</span>:<span class="nc">adder</span><span class="p">;</span>

<span class="sd">/// An example world for the component to target.</span>
<span class="n">world</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">add</span>: <span class="nc">func</span><span class="p">(</span><span class="n">x</span>: <span class="nc">s32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="nc">s32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s32</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>WASM</strong>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Context</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">component</span>::<span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="p">{</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">};</span>

<span class="n">wasmtime</span>::<span class="n">component</span>::<span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">path</span>: <span class="s">"adder.wit"</span><span class="p">,</span>
<span class="w">    </span><span class="n">world</span>: <span class="s">"example"</span><span class="p">,</span>
<span class="w">    </span><span class="k">async</span>: <span class="nc">false</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">wasmtime</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">default</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">async_support</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Add the command world (aka WASI CLI) to the linker</span>
<span class="w">    </span><span class="n">command</span>::<span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">).</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to link command world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// environment::add_to_linker(&amp;mut linker, |x| x)?;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi_view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ServerWasiView</span>::<span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">wasi_view</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">Component</span>::<span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"adder.wasm"</span><span class="p">).</span><span class="n">context</span><span class="p">(</span><span class="s">"Component file not found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Example</span>::<span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to instantiate the example world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="n">instance</span>
<span class="w">        </span><span class="p">.</span><span class="n">call_add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to call add function"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span>: <span class="nc">Table</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Table</span>::<span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span>::<span class="n">new</span><span class="p">().</span><span class="n">inherit_stdio</span><span class="p">().</span><span class="n">build</span><span class="p">();</span>

<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Table</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">table_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Table</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">ctx_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[tokio::main]</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">wasmtime</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>build wasm <code>cargo component build</code></li>
<li>build main/engine <code>cargo build</code></li>
<li>run engine: <code>./target/debug/host-add</code></li>
</ul>
<h3>Expected Results</h3>
<p>The wasm main/engine exectue as async example.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">host</span><span class="o">-</span><span class="n">add</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">320</span>:<span class="mi">9</span>:
<span class="nc">cannot</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">func_wrap_async</span><span class="err">`</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">config</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">rust_begin_unwind</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">597</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">72</span>:<span class="mi">14</span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">wasmtime</span>::<span class="n">component</span>::<span class="n">linker</span>::<span class="n">LinkerInstance</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">func_wrap_async</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">320</span>:<span class="mi">9</span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">wasi</span>::<span class="n">filesystem</span>::<span class="n">types</span>::<span class="n">add_to_linker</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">preview2</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">94</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">command</span>::<span class="n">add_to_linker</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">preview2</span><span class="o">/</span><span class="n">command</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">host_add</span>::<span class="n">add</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">22</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">host_add</span>::<span class="n">main</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">13</span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">park</span>::<span class="n">CachedParkThread</span>::<span class="n">block_on</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">park</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">282</span>:<span class="mi">63</span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">coop</span>::<span class="n">with_budget</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">coop</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">107</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">coop</span>::<span class="n">budget</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">coop</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">5</span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">park</span>::<span class="n">CachedParkThread</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">park</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">282</span>:<span class="mi">31</span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">context</span>::<span class="n">blocking</span>::<span class="n">BlockingRegionGuard</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">blocking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">9</span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">scheduler</span>::<span class="n">multi_thread</span>::<span class="n">MultiThread</span>::<span class="n">block_on</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">scheduler</span><span class="o">/</span><span class="n">multi_thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">87</span>:<span class="mi">13</span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">context</span>::<span class="n">runtime</span>::<span class="n">enter_runtime</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">runtime</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">16</span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">scheduler</span>::<span class="n">multi_thread</span>::<span class="n">MultiThread</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">scheduler</span><span class="o">/</span><span class="n">multi_thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">86</span>:<span class="mi">9</span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">runtime</span>::<span class="n">Runtime</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">runtime</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">350</span>:<span class="mi">45</span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">host_add</span>::<span class="n">main</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">75</span>:<span class="mi">5</span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">250</span>:<span class="mi">5</span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit:  wasmtime: 15, rust/cargo: 1.74.1</p>
<p>Operating system: ubuntu 22.04</p>
<p>Architecture: x86<br>
</p>
</blockquote>



<a name="409596527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/409596527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#409596527">(Dec 22 2023 at 15:01)</a>:</h4>
<p>StaffEngineer <a href="https://github.com/bytecodealliance/wasmtime/issues/7717#issuecomment-1867787188">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<p>You need to call sync version of add to linker: <code>sync::add_to_linker(&amp;mut linker)?;</code>.</p>
</blockquote>



<a name="409598580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/409598580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#409598580">(Dec 22 2023 at 15:15)</a>:</h4>
<p>StaffEngineer edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7717#issuecomment-1867787188">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<p>You need to call add to linker from sync: <code>sync::add_to_linker(&amp;mut linker)?;</code>.</p>
</blockquote>



<a name="410863841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/410863841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#410863841">(Jan 02 2024 at 15:36)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p><strong>WIT</strong>: </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">component</span>:<span class="nc">adder</span><span class="p">;</span>

<span class="sd">/// An example world for the component to target.</span>
<span class="n">world</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">export</span><span class="w"> </span><span class="n">add</span>: <span class="nc">func</span><span class="p">(</span><span class="n">x</span>: <span class="nc">s32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="nc">s32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s32</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>WASM</strong>:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Context</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">PathBuf</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">component</span>::<span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="p">{</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">Table</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtx</span><span class="p">,</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">WasiView</span><span class="p">};</span>

<span class="n">wasmtime</span>::<span class="n">component</span>::<span class="n">bindgen</span><span class="o">!</span><span class="p">({</span>
<span class="w">    </span><span class="n">path</span>: <span class="s">"adder.wit"</span><span class="p">,</span>
<span class="w">    </span><span class="n">world</span>: <span class="s">"example"</span><span class="p">,</span>
<span class="w">    </span><span class="k">async</span>: <span class="nc">false</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">wasmtime</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">default</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_component_model</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">async_support</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Add the command world (aka WASI CLI) to the linker</span>
<span class="w">    </span><span class="n">command</span>::<span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">).</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to link command world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// environment::add_to_linker(&amp;mut linker, |x| x)?;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi_view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ServerWasiView</span>::<span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">wasi_view</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">Component</span>::<span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"adder.wasm"</span><span class="p">).</span><span class="n">context</span><span class="p">(</span><span class="s">"Component file not found"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Example</span>::<span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">linker</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to instantiate the example world"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="n">instance</span>
<span class="w">        </span><span class="p">.</span><span class="n">call_add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">context</span><span class="p">(</span><span class="s">"Failed to call add function"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nc">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">table</span>: <span class="nc">Table</span><span class="p">,</span>
<span class="w">    </span><span class="n">ctx</span>: <span class="nc">WasiCtx</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Table</span>::<span class="n">new</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span>::<span class="n">new</span><span class="p">().</span><span class="n">inherit_stdio</span><span class="p">().</span><span class="n">build</span><span class="p">();</span>

<span class="w">        </span><span class="bp">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">WasiView</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ServerWasiView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">table</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Table</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">table_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Table</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">table</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">ctx</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">ctx_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">WasiCtx</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[tokio::main]</span>
<span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">wasmtime</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>build wasm <code>cargo component build</code></li>
<li>build main/engine <code>cargo build</code></li>
<li>run engine: <code>./target/debug/host-add</code></li>
</ul>
<h3>Expected Results</h3>
<p>The wasm main/engine exectue as async example.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">host</span><span class="o">-</span><span class="n">add</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">320</span>:<span class="mi">9</span>:
<span class="nc">cannot</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">func_wrap_async</span><span class="err">`</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">config</span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">rust_begin_unwind</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">597</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">72</span>:<span class="mi">14</span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">wasmtime</span>::<span class="n">component</span>::<span class="n">linker</span>::<span class="n">LinkerInstance</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">func_wrap_async</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">component</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">320</span>:<span class="mi">9</span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">wasi</span>::<span class="n">filesystem</span>::<span class="n">types</span>::<span class="n">add_to_linker</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">preview2</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">94</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">command</span>::<span class="n">add_to_linker</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wasi</span><span class="o">-</span><span class="mf">15.0.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">preview2</span><span class="o">/</span><span class="n">command</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">host_add</span>::<span class="n">add</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">22</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">host_add</span>::<span class="n">main</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">13</span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">park</span>::<span class="n">CachedParkThread</span>::<span class="n">block_on</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">park</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">282</span>:<span class="mi">63</span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">coop</span>::<span class="n">with_budget</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">coop</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">107</span>:<span class="mi">5</span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">coop</span>::<span class="n">budget</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">coop</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">5</span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">park</span>::<span class="n">CachedParkThread</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">park</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">282</span>:<span class="mi">31</span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">context</span>::<span class="n">blocking</span>::<span class="n">BlockingRegionGuard</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">blocking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">9</span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">scheduler</span>::<span class="n">multi_thread</span>::<span class="n">MultiThread</span>::<span class="n">block_on</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">scheduler</span><span class="o">/</span><span class="n">multi_thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">87</span>:<span class="mi">13</span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">context</span>::<span class="n">runtime</span>::<span class="n">enter_runtime</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">context</span><span class="o">/</span><span class="n">runtime</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">16</span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">scheduler</span>::<span class="n">multi_thread</span>::<span class="n">MultiThread</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">scheduler</span><span class="o">/</span><span class="n">multi_thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">86</span>:<span class="mi">9</span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">tokio</span>::<span class="n">runtime</span>::<span class="n">runtime</span>::<span class="n">Runtime</span>::<span class="n">block_on</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">hpc</span><span class="o">/</span><span class="n">mtr_scrap</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">klausm</span><span class="o">/</span><span class="n">cargo_home</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">tokio</span><span class="o">-</span><span class="mf">1.35.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">runtime</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">350</span>:<span class="mi">45</span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">host_add</span>::<span class="n">main</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">75</span>:<span class="mi">5</span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">a28077b28a02b92985b3a3faecf92813155f1ea1</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">250</span>:<span class="mi">5</span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit:  wasmtime: 15, rust/cargo: 1.74.1</p>
<p>Operating system: ubuntu 22.04</p>
<p>Architecture: x86<br>
</p>
</blockquote>



<a name="410863842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/410863842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#410863842">(Jan 02 2024 at 15:36)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7717#issuecomment-1874183282">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<p>I believe this is answered by @StaffEngineer, so I'm going to close this. Thanks for the report though!</p>
</blockquote>



<a name="411002400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237717%20How%20to%20disable%20async%20in%20component%3F/near/411002400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237717.20How.20to.20disable.20async.20in.20component.3F.html#411002400">(Jan 03 2024 at 12:02)</a>:</h4>
<p>k82cn <a href="https://github.com/bytecodealliance/wasmtime/issues/7717#issuecomment-1875266333">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7717">issue #7717</a>:</p>
<blockquote>
<p>yes, <code>sync::add_to_linker(&amp;mut linker)?;</code> works.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>