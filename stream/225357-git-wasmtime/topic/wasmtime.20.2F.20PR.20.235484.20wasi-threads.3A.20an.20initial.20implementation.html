<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5484 wasi-threads: an initial implementation · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html">wasmtime / PR #5484 wasi-threads: an initial implementation</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="317061285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/317061285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#317061285">(Dec 20 2022 at 23:49)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>:</p>
<blockquote>
<p>This PR builds on several other under-review PRs to demonstrate a working wasi-threads implementation in Wasmtime. The first three commits are cherry-picked from the following PRs:</p>
<ul>
<li>#5326 </li>
<li>#5471</li>
<li>#5475 </li>
</ul>
<p>The last two commits build on these to expose the wasi-threads API to WebAssembly modules. Upon building and running Wasmtime with the right flags, one can then run multi-threaded WebAssembly programs:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>cargo run --features wasi-threads -- <span class="se">\</span>
    --wasm-features threads --wasi-modules experimental-wasi-threads <span class="se">\</span>
    &lt;a threads-enabled module&gt;
</code></pre></div>
<p>Due to Cargo feature issues in 05020d4, this PR is not yet expected to compile but, perhaps more interestingly, one can use these changes to run some simple pthread tests over in the wasi-libc repository: <a href="https://github.com/WebAssembly/wasi-libc/pull/369">https://github.com/WebAssembly/wasi-libc/pull/369</a>.</p>
</blockquote>



<a name="317061372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/317061372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#317061372">(Dec 20 2022 at 23:50)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>:</p>
<blockquote>
<p>This PR builds on several other under-review PRs to demonstrate a working wasi-threads implementation in Wasmtime. The first three commits are cherry-picked from the following PRs:</p>
<ul>
<li>#5326 </li>
<li>#5471</li>
<li>#5475 </li>
</ul>
<p>The last two commits build on these to expose the wasi-threads API to WebAssembly modules. Upon building and running Wasmtime with the right flags, one can then run multi-threaded WebAssembly programs:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">$ </span>cargo run --features wasi-threads -- <span class="se">\</span>
    --wasm-features threads --wasi-modules experimental-wasi-threads <span class="se">\</span>
    &lt;a threads-enabled module&gt;
</code></pre></div>
<p>Due to Cargo feature issues in 05020d4, this PR is not yet expected to pass all CI tasks but, perhaps more interestingly, one can use these changes to run some simple pthread tests over in the wasi-libc repository: <a href="https://github.com/WebAssembly/wasi-libc/pull/369">https://github.com/WebAssembly/wasi-libc/pull/369</a>.</p>
</blockquote>



<a name="319231073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231073">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1234780101">PR review</a>.</p>



<a name="319231074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231074">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1234780101">PR review</a>.</p>



<a name="319231078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231078">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060736262">PR review comment</a>:</p>
<blockquote>
<p>It's ok to leave this file out</p>
</blockquote>



<a name="319231079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231079">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060742240">PR review comment</a>:</p>
<blockquote>
<p>If possible I think this would be best avoided because a <code>Linker&lt;T&gt;</code> is a costly thing to clone.</p>
<p>One option is to wrap it up in an <code>Arc</code>, and another would be to thread the <code>get_cx</code> callback through to <code>spawn</code> so the <code>host</code> argument could be projected into a <code>&amp;WasiThreadsCtx&lt;T&gt;</code></p>
</blockquote>



<a name="319231080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231080">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060735492">PR review comment</a>:</p>
<blockquote>
<p>Could you file an issue and list a TODO here for "we shouldn't serialize calls to <code>random_get</code>"?</p>
</blockquote>



<a name="319231081"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231081" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231081">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060746323">PR review comment</a>:</p>
<blockquote>
<p>I feel like this is a little tricky. Panicking on errors here doesn't feel like the right thing to do since these panics can theoreteically get triggered. In that sense I think that the errors need to be handled here. As you've probably noticed, however, there's nowhere to communicate the error to. One option would be to move the initialization here to the thread calling spawn, but that feels sort of wrong since it sort of belongs in the child thread.</p>
<p>Overall I think this might be best left as an issue on the <code>wasi-threads</code> repository. Basically how would a thread spawn operation get notified that the thread was spawned but something else failed? Or otherwise how are traps handled and/or other fatal errors in the threads proposal? (that is the <code>panic!</code> below also needs better handling I think)</p>
</blockquote>



<a name="319231082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231082">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060740086">PR review comment</a>:</p>
<blockquote>
<p>Technically this can be done today, but I think this might be best done as some sort of "join" API from the host which isn't currently specified for <code>wasi-threads</code>, so while wait/notify could be added here there's no way to actually wait until all the child threads have exited.</p>
</blockquote>



<a name="319231083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319231083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319231083">(Jan 03 2023 at 16:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1060736499">PR review comment</a>:</p>
<blockquote>
<p>If possible I think we're omitting LICENSE files except for the one at the top of the repo</p>
</blockquote>



<a name="319882657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319882657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319882657">(Jan 06 2023 at 23:46)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="319883294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319883294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319883294">(Jan 06 2023 at 23:53)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1239537904">PR review</a>.</p>



<a name="319883295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319883295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319883295">(Jan 06 2023 at 23:53)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1063889895">PR review comment</a>:</p>
<blockquote>
<p>It felt strange to create an issue for yet-to-be-merged code; I will do this as a follow-up.</p>
</blockquote>



<a name="319883918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319883918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319883918">(Jan 07 2023 at 00:00)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1063892181">PR review comment</a>:</p>
<blockquote>
<p>Yeah, I've looked into this more since you reviewed this. There has been some discussion <a href="https://github.com/WebAssembly/wasi-threads/pull/17/files">in a wasi-threads issue</a> which boils down to "any <code>proc_exit</code> or trap in any thread exits the program." I was looking at <a href="https://github.com/bytecodealliance/wasmtime/blob/main/src/commands/run.rs#L215-L246">what <code>run.rs</code> does</a> for traps and I think we would want to do something similar here--essentially call <code>std::process::exit</code>. The problem is that calling <code>std::process::exit</code> is likely not what one wants to do in an embedding scenario. I would suggest we do implement wasi-threads to initially <code>std::process::exit</code> and then open an issue to think about this for the embedding scenario: I suspect users here would want a trap or <code>proc_exit</code> to kill all the threads but not kill the original program calling Wasmtime but, with no great way to cancel threads in Rust, I think this might be kind of difficult.</p>
</blockquote>



<a name="319883919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/319883919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#319883919">(Jan 07 2023 at 00:00)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1239540807">PR review</a>.</p>



<a name="320245461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/320245461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#320245461">(Jan 09 2023 at 14:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1240621012">PR review</a>.</p>



<a name="320245463"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/320245463" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#320245463">(Jan 09 2023 at 14:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1064724423">PR review comment</a>:</p>
<blockquote>
<p>I'm ok with this all being a TODO and not necessarily covered here. At the very least this PR is a good step forward to being able to spawn threads.</p>
<p>I do think these issues need to be resolved before stabilization, but perhaps it's best to track these sorts of things in the wasi-threads repository?</p>
</blockquote>



<a name="320320187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/320320187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#320320187">(Jan 09 2023 at 20:03)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="320322892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/320322892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#320322892">(Jan 09 2023 at 20:16)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1241143703">PR review</a>.</p>



<a name="320322895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/320322895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#320322895">(Jan 09 2023 at 20:16)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1065068600">PR review comment</a>:</p>
<blockquote>
<p>Ok, to resolve this I rebased again on <code>main</code> and applied <a href="https://github.com/bytecodealliance/wasmtime/pull/5484/commits/2ba9f11b56adaef32f5bc2596cafab8328e52ae4">2ba9f11</a>.</p>
</blockquote>



<a name="323943199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323943199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323943199">(Jan 27 2023 at 01:43)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1272011242">PR review</a>.</p>



<a name="323943200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323943200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323943200">(Jan 27 2023 at 01:43)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1088507665">PR review comment</a>:</p>
<blockquote>
<p>Looking at this again, I think I can rewrite this with a "join" loop after the spawn calls: each thread will atomically increment a memory location and notify the main thread; the main thread waits in a loop and only exits once the read memory equals the number of threads we are waiting for. This fixup could come after this PR merges?</p>
</blockquote>



<a name="323943247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323943247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323943247">(Jan 27 2023 at 01:44)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="323944573"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323944573" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323944573">(Jan 27 2023 at 02:00)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="323944807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323944807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323944807">(Jan 27 2023 at 02:03)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="323957295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323957295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323957295">(Jan 27 2023 at 03:43)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="323958265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/323958265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#323958265">(Jan 27 2023 at 03:58)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="324128390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128390">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1273076070">PR review</a>.</p>



<a name="324128392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128392">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1273076070">PR review</a>.</p>



<a name="324128393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128393">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089204556">PR review comment</a>:</p>
<blockquote>
<p>It's ok to not add this since it's implicit from the dependency</p>
</blockquote>



<a name="324128395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128395">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089284916">PR review comment</a>:</p>
<blockquote>
<p>Oh I had forgotten to mention this earlier, but now that other bits and pieces are cleaned up I think most of these changes should no longer be necessary? I think the <code>BorrowedFile</code> type should be able to be removed now along with all other changes necessary for this.</p>
</blockquote>



<a name="324128396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128396">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089294658">PR review comment</a>:</p>
<blockquote>
<p>There are two unwraps below during the <code>spawn</code> operation's closure: </p>
<ul>
<li>Using <code>Linker::instantiate</code></li>
<li>The call to <code>get_typed_func</code></li>
</ul>
<p>Both of these, however, can be type-checked ahead of time at this location I believe by inspecting <code>Module</code> and <code>Linker&lt;T&gt;</code>. Could you either add a TODO to perform such type-checking here or implement it in this PR?</p>
</blockquote>



<a name="324128397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128397">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089288218">PR review comment</a>:</p>
<blockquote>
<p>Like with files I think this can all go away now</p>
</blockquote>



<a name="324128398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128398">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089291471">PR review comment</a>:</p>
<blockquote>
<p>Could you add a <code>TODO</code> here that the <code>Mutex</code> here shouldn't be necessary? Something along the lines that this forces threads to serialize on their acquisition of randomness but there's need for such serialization.</p>
</blockquote>



<a name="324128399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128399">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089286415">PR review comment</a>:</p>
<blockquote>
<p>Similar to above I think many of these changes can go away now too</p>
</blockquote>



<a name="324128400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324128400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324128400">(Jan 27 2023 at 18:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1089296337">PR review comment</a>:</p>
<blockquote>
<p>One possibility that isn't caught by this is the <code>.call(..)</code> function panicking, such as trying to use wasi-nn in a threaded context. If a panic happens that leaves all other threads alive and running and just this thread exits. For that it may be worthwhile, for now at least, to catch panics here as well and abort the whole process if one is caught.</p>
</blockquote>



<a name="324797196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324797196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324797196">(Jan 30 2023 at 23:18)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="324810248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324810248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324810248">(Jan 31 2023 at 01:15)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="324811719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/324811719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#324811719">(Jan 31 2023 at 01:32)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325021462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325021462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325021462">(Jan 31 2023 at 21:39)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325021852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325021852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325021852">(Jan 31 2023 at 21:41)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325031555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325031555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325031555">(Jan 31 2023 at 22:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1278128391">PR review</a>.</p>



<a name="325031557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325031557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325031557">(Jan 31 2023 at 22:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1092556310">PR review comment</a>:</p>
<blockquote>
<p>I think this type can be dropped as well? (a cursory look and I'm not seeing anywhere else it's used at least)</p>
</blockquote>



<a name="325031627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325031627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325031627">(Jan 31 2023 at 22:39)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1278128947">PR review</a>.</p>



<a name="325031628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325031628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325031628">(Jan 31 2023 at 22:39)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1092556720">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps <code>s/Error/thread panicked/</code> to clearly indicate a panic happen?</p>
</blockquote>



<a name="325053556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325053556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325053556">(Feb 01 2023 at 01:36)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325062182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325062182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325062182">(Feb 01 2023 at 03:24)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325192473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325192473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325192473">(Feb 01 2023 at 15:40)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325205562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325205562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325205562">(Feb 01 2023 at 16:35)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> as ready for review.</p>



<a name="325206085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325206085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325206085">(Feb 01 2023 at 16:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1279475529">PR review</a>.</p>



<a name="325206086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325206086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325206086">(Feb 01 2023 at 16:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1279475529">PR review</a>.</p>



<a name="325206087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325206087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325206087">(Feb 01 2023 at 16:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093468136">PR review comment</a>:</p>
<blockquote>
<p>Could this be <code>module</code> with something like this in the body of the function:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// silence unused warning as it's only used with wasi-threads</span>
<span class="nb">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="n">module</span><span class="p">);</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="325206088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325206088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325206088">(Feb 01 2023 at 16:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093470276">PR review comment</a>:</p>
<blockquote>
<p>Could the <code>Arc</code> type be imported into this module? (it's used in a number of places and should avoid the <code>std::sync::...</code> prefix)</p>
<p>Additionally can you leave some comments here for what's going on? Basically something along the lines of how <code>wasi-crypto</code> the implementation is not ready for threads yet so the <code>get_mut</code> implementation here will succeed only if a thread hasn't been spawned. If a thread is spawned, however, this will panic and indicate to the user that work needs to happen to integrate wasi-crypto and threads.</p>
<p>(and then a comment on <code>wasi-nn</code> below referring to this comment as well)</p>
</blockquote>



<a name="325223320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325223320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325223320">(Feb 01 2023 at 17:31)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325236880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325236880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325236880">(Feb 01 2023 at 18:29)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325250434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325250434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325250434">(Feb 01 2023 at 19:31)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325286351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325286351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325286351">(Feb 01 2023 at 23:03)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325289306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325289306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325289306">(Feb 01 2023 at 23:27)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280037803">PR review</a>.</p>



<a name="325289307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325289307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325289307">(Feb 01 2023 at 23:27)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093846444">PR review comment</a>:</p>
<blockquote>
<p>bikeshed, but I think NOTSUP is a more appropriate error code for this</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            Err(Error::not_supported())
</code></pre></div><br>
</p>
</blockquote>



<a name="325290621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290621">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280038951">PR review</a>.</p>



<a name="325290622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290622">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093847695">PR review comment</a>:</p>
<blockquote>
<p>Same</p>
</blockquote>



<a name="325290623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290623">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280038951">PR review</a>.</p>



<a name="325290624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290624">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093847496">PR review comment</a>:</p>
<blockquote>
<p>Could we return an error instead of panic if for some reason this lock is poisoned? </p>
</blockquote>



<a name="325290626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290626">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093852130">PR review comment</a>:</p>
<blockquote>
<p>Terminating the parent process is a really heavy hammer and makes this whole crate unsuitable for use in multi-tenant embeddings. It would be helpful to understand exactly why this crate had to make that design choice, and to please note it somewhere high level, like in a crate-level README</p>
</blockquote>



<a name="325290628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325290628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325290628">(Feb 01 2023 at 23:38)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093851340">PR review comment</a>:</p>
<blockquote>
<p>I'd reword "CLI usage" to something like its "for usage where it is acceptable for wasmtime failures to terminate the parent process, such as in the wasmtime CLI", and say something like "not suitable for use in multi-tenant embeddings" as a more obvious warning? Could we hide the presence of this function behind an off-by-default cargo feature, to give more assurance to multi-tenant embeddings that they are safe from this?</p>
</blockquote>



<a name="325297440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325297440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325297440">(Feb 02 2023 at 00:42)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325297495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325297495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325297495">(Feb 02 2023 at 00:43)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280101882">PR review</a>.</p>



<a name="325297496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325297496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325297496">(Feb 02 2023 at 00:43)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093891273">PR review comment</a>:</p>
<blockquote>
<p>Ended up doing this anyways in this PR to try to get CI to go green.</p>
</blockquote>



<a name="325298758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325298758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325298758">(Feb 02 2023 at 00:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280110351">PR review</a>.</p>



<a name="325298759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325298759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325298759">(Feb 02 2023 at 00:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093897679">PR review comment</a>:</p>
<blockquote>
<p>Sure, but which: <code>perm</code>? <code>invalid_argument</code>? <code>not_supported</code>? I don't know if any fit well.</p>
</blockquote>



<a name="325299062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325299062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325299062">(Feb 02 2023 at 00:59)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280115266">PR review</a>.</p>



<a name="325299063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325299063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325299063">(Feb 02 2023 at 00:59)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093899843">PR review comment</a>:</p>
<blockquote>
<p>Also, if the <code>Mutex</code> ever does get poisoned (which doesn't seem likely to happen?) wouldn't we want to crash Wasmtime to figure out what is going on rather than letting the Wasm module proceed?</p>
</blockquote>



<a name="325300636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325300636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325300636">(Feb 02 2023 at 01:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="325300873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325300873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325300873">(Feb 02 2023 at 01:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280139053">PR review</a>.</p>



<a name="325300874"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325300874" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325300874">(Feb 02 2023 at 01:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093915837">PR review comment</a>:</p>
<blockquote>
<p>Hopefully this hammer is only temporary; @alexcrichton and I had discussed some early thoughts on how we might shut down all of the threads when necessary. It is complex to do so, though, so providing experimental wasi-threads access sooner for some users seemed more valuable than solving the problem and waiting longer.</p>
</blockquote>



<a name="325302277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325302277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325302277">(Feb 02 2023 at 01:42)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280150579">PR review</a>.</p>



<a name="325302279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325302279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325302279">(Feb 02 2023 at 01:42)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1093925602">PR review comment</a>:</p>
<blockquote>
<p>Yeah, nevermind, I guess I didn't think this through - this is a per-ctx mutex so it would only get poisoned if another thread panicked already, so panicking more in the same store is fine.</p>
</blockquote>



<a name="325302723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/325302723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#325302723">(Feb 02 2023 at 01:49)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1280155245">PR review</a>.</p>



<a name="326435929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326435929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326435929">(Feb 07 2023 at 19:01)</a>:</h4>
<p>tschneidereit submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1287807514">PR review</a>.</p>



<a name="326448334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326448334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326448334">(Feb 07 2023 at 20:10)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a> from <code>wasi-threads-revisited</code> to <code>main</code>.</p>



<a name="326463938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326463938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326463938">(Feb 07 2023 at 21:43)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5484">PR #5484</a>.</p>



<a name="326769114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326769114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326769114">(Feb 09 2023 at 09:45)</a>:</h4>
<p>yamt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1290746559">PR review</a>.</p>



<a name="326769115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326769115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326769115">(Feb 09 2023 at 09:45)</a>:</h4>
<p>yamt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1290746559">PR review</a>.</p>



<a name="326769116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326769116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326769116">(Feb 09 2023 at 09:45)</a>:</h4>
<p>yamt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1101200012">PR review comment</a>:</p>
<blockquote>
<p>if i read this correctly, this <code>wait</code> would always return 1 immediately without sleeping.</p>
</blockquote>



<a name="326769117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326769117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326769117">(Feb 09 2023 at 09:45)</a>:</h4>
<p>yamt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1101198113">PR review comment</a>:</p>
<blockquote>
<p>unused local</p>
</blockquote>



<a name="326769118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/326769118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#326769118">(Feb 09 2023 at 09:45)</a>:</h4>
<p>yamt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1101201739">PR review comment</a>:</p>
<blockquote>
<p>this function doesn't seem thread-safe.</p>
</blockquote>



<a name="327125438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327125438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327125438">(Feb 10 2023 at 19:00)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1293823116">PR review</a>.</p>



<a name="327125439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327125439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327125439">(Feb 10 2023 at 19:00)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1103123333">PR review comment</a>:</p>
<blockquote>
<p>Ah, yeah, this is a mistake due to a refactoring: originally I intended the <code>i</code> local (unused now) to keep track of the expected values but that was lost as I changed things. I'll add a note to fix this...</p>
</blockquote>



<a name="327125870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327125870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327125870">(Feb 10 2023 at 19:02)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1293825808">PR review</a>.</p>



<a name="327125871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327125871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327125871">(Feb 10 2023 at 19:02)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1103125091">PR review comment</a>:</p>
<blockquote>
<p>Are you thinking about atomic stores or a lock around the <code>$__wasi_fd_write</code> call? (Recall that <code>wasi-common</code> has some internal locking).</p>
</blockquote>



<a name="327191127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327191127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327191127">(Feb 11 2023 at 05:27)</a>:</h4>
<p>yamt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1294428725">PR review</a>.</p>



<a name="327191129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/327191129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#327191129">(Feb 11 2023 at 05:27)</a>:</h4>
<p>yamt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1103529651">PR review comment</a>:</p>
<blockquote>
<p>no. it's about the linear memory used for iovec.</p>
</blockquote>



<a name="336362969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/336362969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#336362969">(Feb 23 2023 at 23:28)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#pullrequestreview-1312293273">PR review</a>.</p>



<a name="336362970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235484%20wasi-threads%3A%20an%20initial%20implementation/near/336362970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235484.20wasi-threads.3A.20an.20initial.20implementation.html#336362970">(Feb 23 2023 at 23:28)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5484#discussion_r1116352591">PR review comment</a>:</p>
<blockquote>
<p>Fixed in #5858</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>