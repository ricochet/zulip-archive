<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4086 runtime: refactor `Memory` to always ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html">wasmtime / PR #4086 runtime: refactor `Memory` to always ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="280534170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280534170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280534170">(Apr 28 2022 at 18:11)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>:</p>
<blockquote>
<p>While working with the runtime <code>Memory</code> object, it became clear that<br>
some refactoring was needed. In order to implement shared memory from<br>
the threads proposal, we must be able to atomically change the memory<br>
size. Previously, the split into variants, <code>Memory::Static</code> and<br>
<code>Memory::Dynamic</code>, made any attempt to lock forced us to duplicate logic<br>
in various places.</p>
<p>This change moves <code>enum Memory { Static..., Dynamic... }</code> to simply<br>
<code>struct Memory(Box&lt;dyn RuntimeLinearMemory&gt;)</code>. A new type,<br>
<code>ExternalMemory</code>, takes the place of <code>Memory::Static</code> and also<br>
implements the <code>RuntimeLinearMemory</code> trait, allowing <code>Memory</code> to contain<br>
the same two options as before: <code>MmapMemory</code> for <code>Memory::Dynamic</code> and<br>
<code>ExternalMemory</code> for <code>Memory::Static</code>. To interface with the<br>
<code>PoolingAllocator</code>, this change also required the ability to downcast to<br>
the internal representation.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="280534180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280534180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280534180">(Apr 28 2022 at 18:11)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a>.</p>



<a name="280534437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280534437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280534437">(Apr 28 2022 at 18:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280534890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280534890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280534890">(Apr 28 2022 at 18:16)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>:</p>
<blockquote>
<p>While working with the runtime <code>Memory</code> object, it became clear that<br>
some refactoring was needed. In order to implement shared memory from<br>
the threads proposal, we must be able to atomically change the memory<br>
size. Previously, the split into variants, <code>Memory::Static</code> and<br>
<code>Memory::Dynamic</code>, made any attempt to lock duplicate logic<br>
in various places.</p>
<p>This change moves <code>enum Memory { Static..., Dynamic... }</code> to simply<br>
<code>struct Memory(Box&lt;dyn RuntimeLinearMemory&gt;)</code>. A new type,<br>
<code>ExternalMemory</code>, takes the place of <code>Memory::Static</code> and also<br>
implements the <code>RuntimeLinearMemory</code> trait, allowing <code>Memory</code> to contain<br>
the same two options as before: <code>MmapMemory</code> for <code>Memory::Dynamic</code> and<br>
<code>ExternalMemory</code> for <code>Memory::Static</code>. To interface with the<br>
<code>PoolingAllocator</code>, this change also required the ability to downcast to<br>
the internal representation.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="280536765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536765">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-956877618">PR review</a>.</p>



<a name="280536767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536767">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-956877618">PR review</a>.</p>



<a name="280536768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536768">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861198994">PR review comment</a>:</p>
<blockquote>
<p>I think this can be an assert since this should have already been checked in <code>Memory::grow</code></p>
</blockquote>



<a name="280536769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536769">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861198498">PR review comment</a>:</p>
<blockquote>
<p>I think this may actually be historical at this point, while you're here could you try removing this (and dependants) and see if it's actually still needed?</p>
</blockquote>



<a name="280536770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536770">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861197823">PR review comment</a>:</p>
<blockquote>
<p>I think with my above suggestion this could ideally be a private-to-this-module structure</p>
</blockquote>



<a name="280536771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536771">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861201323">PR review comment</a>:</p>
<blockquote>
<p>(I think this was also present in the original code where this check wasn't necessary)</p>
</blockquote>



<a name="280536772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536772">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861196282">PR review comment</a>:</p>
<blockquote>
<p>Putting the <code>downcast</code> here and dealing with <code>ExternalMemory</code> I think would be better inside of <code>memory.rs</code> because otherwise it's created via <code>Memory::new_static</code> but then open-coded here that we're reaching into the internals.</p>
<p>Perhaps something like <code>Memory::unwrap_static_image</code> which returns <code>Option&lt;MemoryImage&gt;</code> which is used here to call <code>clear_and_remain_ready</code> and such?</p>
</blockquote>



<a name="280536773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536773">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861199722">PR review comment</a>:</p>
<blockquote>
<p>If possible, like above, I think it'd be best for this to not be <code>pub(crate)</code> but that may not be possible (if it's needed it's needed, can fix later)</p>
</blockquote>



<a name="280536774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536774">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861200175">PR review comment</a>:</p>
<blockquote>
<p>Could this get folded into <code>ExternalMemory::new</code>?</p>
</blockquote>



<a name="280536775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536775">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861199176">PR review comment</a>:</p>
<blockquote>
<p>This happens below as well so I think this one can be removed</p>
</blockquote>



<a name="280536776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280536776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280536776">(Apr 28 2022 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861202653">PR review comment</a>:</p>
<blockquote>
<p>These last two statements are pretty good now to be a <code>match</code> perhaps? (since handling both cases is trivial)</p>
</blockquote>



<a name="280540269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280540269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280540269">(Apr 28 2022 at 18:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-956915083">PR review</a>.</p>



<a name="280540271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280540271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280540271">(Apr 28 2022 at 18:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861222937">PR review comment</a>:</p>
<blockquote>
<p>I tried... <code>mem::take</code> in <code>pooling.rs</code> requires a <code>Memory</code> to be <code>Default</code>. Is there another way to do something equivalent there?</p>
</blockquote>



<a name="280543385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280543385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280543385">(Apr 28 2022 at 19:23)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-956940004">PR review</a>.</p>



<a name="280543387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280543387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280543387">(Apr 28 2022 at 19:23)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861240728">PR review comment</a>:</p>
<blockquote>
<p>Ah that can be replaced with <code>mem::take</code> of the <code>memories</code> list itself rather than each individual memory I thin</p>
</blockquote>



<a name="280543403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280543403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280543403">(Apr 28 2022 at 19:23)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861240728">PR review comment</a>.</p>



<a name="280550980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280550980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280550980">(Apr 28 2022 at 20:25)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957002477">PR review</a>.</p>



<a name="280550981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280550981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280550981">(Apr 28 2022 at 20:25)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861283952">PR review comment</a>:</p>
<blockquote>
<p>I see other checks in <code>Memory::grow</code> but none that are equivalent to this one. Do you mean that we should move this check back to the <code>Memory::grow</code> function and duplicate it here and in <code>MmapMemory</code> as a <code>debug_assert!</code>?</p>
</blockquote>



<a name="280551348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280551348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280551348">(Apr 28 2022 at 20:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861286281">PR review comment</a>:</p>
<blockquote>
<p>I think it's covered by <a href="https://github.com/bytecodealliance/wasmtime/blob/128c42fa0931611b620021fee69a5f2c2c2c0bb1/crates/runtime/src/memory.rs#L519-L525">this check</a> since this variant always has a <code>maximum_byte_size</code> of <code>Some</code>, but yeah here I think this check can be an <code>assert!</code> or a <code>debug_assert!</code></p>
</blockquote>



<a name="280551349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280551349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280551349">(Apr 28 2022 at 20:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957005869">PR review</a>.</p>



<a name="280552355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280552355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280552355">(Apr 28 2022 at 20:38)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957014947">PR review</a>.</p>



<a name="280552356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280552356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280552356">(Apr 28 2022 at 20:38)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861292603">PR review comment</a>:</p>
<blockquote>
<p>Ok, I did it. I was hoping I could get rid of <code>RuntimeLinearMemory::into_any</code> but I don't see how: I still need to be able to convert <code>Box&lt;dyn RuntimeLinearMemory&gt;</code> to <code>Box&lt;dyn Any&gt;</code> in the new <code>Memory::unwrap_image_slot</code>. Let me know if there's something preferable... I do see a lot more <code>#[cfg(feature = "pooling-allocator")]</code> here.</p>
<p>I also felt like I had to add back in a way to assert that only external memory is used in the pooling allocator, as was done previously; see the new <code>Memory::is_external</code>.</p>
</blockquote>



<a name="280552403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280552403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280552403">(Apr 28 2022 at 20:39)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280552569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280552569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280552569">(Apr 28 2022 at 20:40)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957017062">PR review</a>.</p>



<a name="280552570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280552570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280552570">(Apr 28 2022 at 20:40)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861294103">PR review comment</a>:</p>
<blockquote>
<p>Can we? <code>memory</code> is coming from <code>self.memories.get(instance_index)</code> so I don't think I can just take from the iterator? Maybe I'm just not seeing it...</p>
</blockquote>



<a name="280553385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280553385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280553385">(Apr 28 2022 at 20:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280554192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280554192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280554192">(Apr 28 2022 at 20:55)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957029962">PR review</a>.</p>



<a name="280554193"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280554193" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280554193">(Apr 28 2022 at 20:55)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957029962">PR review</a>.</p>



<a name="280554195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280554195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280554195">(Apr 28 2022 at 20:55)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861303218">PR review comment</a>:</p>
<blockquote>
<p>I might be doing this wrong... I'm trying to get to a <code>&amp;dyn Any</code> so I can check the downcast is of the right kind but I'm concerned that I have the wrong type. I see a <a href="https://github.com/bytecodealliance/wasmtime/runs/6218369357?check_suite_focus=true#step:5:584">failure</a> building the benchmarks that I don't think should happen. Rust help needed!</p>
</blockquote>



<a name="280556147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556147">(Apr 28 2022 at 21:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957043426">PR review</a>.</p>



<a name="280556148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556148">(Apr 28 2022 at 21:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957043426">PR review</a>.</p>



<a name="280556149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556149">(Apr 28 2022 at 21:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861312680">PR review comment</a>:</p>
<blockquote>
<p>Yeah I don't think this is correct, you'll need to change the trait's <code>into_any</code> method into something like <code>as_any</code> and use that to get the <code>&amp;Any</code> to test</p>
</blockquote>



<a name="280556150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556150">(Apr 28 2022 at 21:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861313327">PR review comment</a>:</p>
<blockquote>
<p>Yes with <code>memory: &amp;mut PrimaryMap&lt;K, V&gt;</code> you can <code>mem::take</code>. Only the <code>base</code> comes from <code>self.memories.get(instance_index)</code></p>
</blockquote>



<a name="280556275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556275">(Apr 28 2022 at 21:12)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957045394">PR review</a>.</p>



<a name="280556276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280556276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280556276">(Apr 28 2022 at 21:12)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861314160">PR review comment</a>:</p>
<blockquote>
<p>I'd personally prefer to make "external" memory an internal implementation detail of the <code>memory.rs</code> module if we can. Right now it has a <code>Memory::new_static</code> constructor so in theory we would have something like <code>Memory::unwrap_static_image</code> where we keep the "static" name and the <code>unwrap</code> bit implies the assertion and the method takes out the input argument to <code>Memory::new_static</code></p>
</blockquote>



<a name="280561863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280561863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280561863">(Apr 28 2022 at 22:05)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280562054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562054">(Apr 28 2022 at 22:07)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957095919">PR review</a>.</p>



<a name="280562055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562055">(Apr 28 2022 at 22:07)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861345211">PR review comment</a>:</p>
<blockquote>
<p>Ok, had to add <code>RuntimeLinearMemory::as_any</code> (even more pooling-allocator-specific trait functions!) but that seems to be correct. I can't use <code>into_any</code> because that takes a <code>Box&lt;Self&gt;</code>.</p>
</blockquote>



<a name="280562119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562119">(Apr 28 2022 at 22:08)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957096132">PR review</a>.</p>



<a name="280562120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562120">(Apr 28 2022 at 22:08)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861345354">PR review comment</a>:</p>
<blockquote>
<p>Oh, you're right! Sorry, wasn't looking closely enough.</p>
</blockquote>



<a name="280562543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562543">(Apr 28 2022 at 22:12)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280562643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280562643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280562643">(Apr 28 2022 at 22:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280563426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280563426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280563426">(Apr 28 2022 at 22:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957104839">PR review</a>.</p>



<a name="280563427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280563427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280563427">(Apr 28 2022 at 22:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#discussion_r861352020">PR review comment</a>:</p>
<blockquote>
<p>Ok, I changed all of the <code>pub</code> functions to use the same naming: <code>is_static</code> and <code>unwrap_static_image</code> now match <code>new_static</code>. I left the struct as <code>ExternalMemory</code> (instead of <code>StaticMemory</code>, though I can change it to that if so desired) because I started to feel that this static/dynamic nomenclature here isn't actually the most accurate. Sure, the old <code>Memory::Static</code> had a static starting address, but it turns out <code>Memory::Dynamic</code> could as well (e.g., <code>MemoryStyle::Static</code>)! Static/dynamic are rather overloaded terms anyways, so I started thinking of this structure in terms of external/internal. External memory is managed "outside the engine" by, e.g., the pooling allocator, and internal memory is managed directly by the engine; this mental switch helped me understand more clearly why we need more than one option here and perhaps it would be the same for others. What do you think? If you agree, I can take up this renaming in a separate PR.</p>
</blockquote>



<a name="280563465"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280563465" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280563465">(Apr 28 2022 at 22:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4086#pullrequestreview-957105204">PR review</a>.</p>



<a name="280636060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280636060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280636060">(Apr 29 2022 at 13:56)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280639202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280639202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280639202">(Apr 29 2022 at 14:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a> from <code>refactor-static-memory</code> to <code>main</code>.</p>



<a name="280645968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234086%20runtime%3A%20refactor%20%60Memory%60%20to%20always%20.../near/280645968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234086.20runtime.3A.20refactor.20.60Memory.60.20to.20always.20.2E.2E.2E.html#280645968">(Apr 29 2022 at 15:12)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4086">PR #4086</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>