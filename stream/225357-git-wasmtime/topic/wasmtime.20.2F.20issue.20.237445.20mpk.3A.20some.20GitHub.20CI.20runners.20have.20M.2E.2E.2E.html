<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7445 mpk: some GitHub CI runners have M... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html">wasmtime / issue #7445 mpk: some GitHub CI runners have M...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="399762121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399762121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399762121">(Nov 01 2023 at 16:45)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>.</p>



<a name="399762774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399762774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399762774">(Nov 01 2023 at 16:50)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>GitHub CI runners are showing some strange behavior: on certain runners (unknown which ones), the CPUID bits claim that MPK is supported, but running any MPK code (e.g., <code>RDPKRU</code>) causes a <code>SIGILL</code> crash. #7446 disables MPK until this is resolved.</p>
<p>Some instances of this failure:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/actions/runs/6721387888/job/18267026371#step:15:3283">https://github.com/bytecodealliance/wasmtime/actions/runs/6721387888/job/18267026371#step:15:3283</a></li>
<li><a href="https://github.com/bytecodealliance/wasmtime/actions/runs/6714337681/job/18247418366?pr=7335#step:15:3280">https://github.com/bytecodealliance/wasmtime/actions/runs/6714337681/job/18247418366?pr=7335#step:15:3280</a></li>
</ul>
</blockquote>



<a name="399771563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399771563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399771563">(Nov 01 2023 at 17:51)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1789397271">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>Finally got a reproduction that includes the <code>lscpu</code> output: <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/6722788583/job/18272718138?pr=7448#step:4:20">https://github.com/bytecodealliance/wasmtime/actions/runs/6722788583/job/18272718138?pr=7448#step:4:20</a>. Something must be different about how that <code>AMD EPYC 7763</code> sets up its CPUID bits.</p>
</blockquote>



<a name="399771848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399771848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399771848">(Nov 01 2023 at 17:53)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1789400501">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>Nice! Seems like this should be easy enough to manage by updating the supported check to require Intel CPUs and filter out AMD ones then?</p>
</blockquote>



<a name="399773331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399773331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399773331">(Nov 01 2023 at 18:03)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1789413012">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>That's an option; I was also thinking about looking up how the Linux kernel sets the <code>pku</code> flag. They probably have to deal with this exact issue there. There might even more special cases there to be aware of...</p>
</blockquote>



<a name="399774451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/399774451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#399774451">(Nov 01 2023 at 18:10)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1789423419">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>Yeah, it appears that Intel and AMD differ on what is presented in that <code>CPUID</code> leaf:</p>
<ul>
<li><a href="https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/arch/x86/include/asm/cpufeatures.h#L380-L383">https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/arch/x86/include/asm/cpufeatures.h#L380-L383</a></li>
<li><a href="https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/tools/testing/selftests/mm/pkey-x86.h#L65C1-L66">https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/tools/testing/selftests/mm/pkey-x86.h#L65C1-L66</a></li>
<li><a href="https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/tools/testing/selftests/kvm/include/x86_64/processor.h#L122-L155">https://github.com/torvalds/linux/blob/8bc9e6515183935fa0cccaf67455c439afe4982b/tools/testing/selftests/kvm/include/x86_64/processor.h#L122-L155</a></li>
</ul>
</blockquote>



<a name="400726794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/400726794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#400726794">(Nov 07 2023 at 12:10)</a>:</h4>
<p>nagisa <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1798379956">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>I can reproduce this issue locally reliably on my 2nd generation EPYC and can test things out it helps anyway.</p>
</blockquote>



<a name="400727468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/400727468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#400727468">(Nov 07 2023 at 12:14)</a>:</h4>
<p>nagisa edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7445#issuecomment-1798379956">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>I can reproduce this issue (the SIGILL) locally &amp; reliably on my 2nd generation EPYC and can test things out it helps anyway.</p>
</blockquote>



<a name="401224327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237445%20mpk%3A%20some%20GitHub%20CI%20runners%20have%20M.../near/401224327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237445.20mpk.3A.20some.20GitHub.20CI.20runners.20have.20M.2E.2E.2E.html#401224327">(Nov 09 2023 at 19:42)</a>:</h4>
<p>abrown closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7445">issue #7445</a>:</p>
<blockquote>
<p>GitHub CI runners are showing some strange behavior: on certain runners (unknown which ones), the CPUID bits claim that MPK is supported, but running any MPK code (e.g., <code>RDPKRU</code>) causes a <code>SIGILL</code> crash. #7446 disables MPK until this is resolved.</p>
<p>Some instances of this failure:</p>
<ul>
<li><a href="https://github.com/bytecodealliance/wasmtime/actions/runs/6721387888/job/18267026371#step:15:3283">https://github.com/bytecodealliance/wasmtime/actions/runs/6721387888/job/18267026371#step:15:3283</a></li>
<li><a href="https://github.com/bytecodealliance/wasmtime/actions/runs/6714337681/job/18247418366?pr=7335#step:15:3280">https://github.com/bytecodealliance/wasmtime/actions/runs/6714337681/job/18247418366?pr=7335#step:15:3280</a></li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>