<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9953 Explain details of compile · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html">wasmtime / issue #9953 Explain details of compile</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="492618083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492618083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492618083">(Jan 09 2025 at 02:30)</a>:</h4>
<p>guest271314 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>I'm running a live Linux USB. If/when that temporary file system freezes during one of my experiments I lose that live session. I store my experiments and applications on a different USB.</p>
<p>Every time I use <code>wasmtime compile file.wasm</code> that produces <code>f.cwasm</code>, and I lose the current filesystem, when I launch another live Linux session <code>wasmtime file.cwasm</code> fails to run.</p>
<p>That behaviour reminds me of how </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">bun</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">compile</span>
<span class="err">```</span><span class="w"> </span><span class="n">and</span>
<span class="err">```</span><span class="n">npx</span><span class="w"> </span><span class="n">postject</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">NODE_SEA_BLOB</span><span class="w"> </span><span class="n">sea</span><span class="o">-</span><span class="n">prep</span><span class="p">.</span><span class="n">blob</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="o">--</span><span class="n">sentinel</span><span class="o">-</span><span class="n">fuse</span><span class="w"> </span><span class="n">NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2</span>
</code></pre></div>
<p>work to compile executables. When the source file system is no more the executable doesn't work anymore. The executable expectes the source files to be referenced on the file system.</p>
<p>COuld be something else in <code>wasmtime</code>. Don't know. I know what I describe above has happened multiple times when I try to run that same <code>.,cwasm</code> file produced by <code>wasmtime</code> that executed before I didn't have the exact same file system to execute that file on.</p>
<p>What's going on with the output of <code>wasmtime compile</code> here?<br>
</p>
</blockquote>



<a name="492630308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492630308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492630308">(Jan 09 2025 at 04:38)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>I'm running a live Linux USB. If/when that temporary file system freezes during one of my experiments I lose that live session. I store my experiments and applications on a different USB.</p>
<p>Every time I use <code>wasmtime compile file.wasm</code> that produces <code>f.cwasm</code>, and I lose the current filesystem, when I launch another live Linux session <code>wasmtime file.cwasm</code> fails to run.</p>
<p>That behaviour reminds me of how </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">bun</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">compile</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="npx"><pre><span></span><code>    --sentinel-fuse NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2
</code></pre></div>
<p>work to compile executables. When the source file system is no more the executable doesn't work anymore. The executable expectes the source files to be referenced on the file system.</p>
<p>COuld be something else in <code>wasmtime</code>. Don't know. I know what I describe above has happened multiple times when I try to run that same <code>.,cwasm</code> file produced by <code>wasmtime</code> that executed before I didn't have the exact same file system to execute that file on.</p>
<p>What's going on with the output of <code>wasmtime compile</code> here?<br>
</p>
</blockquote>



<a name="492630317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492630317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492630317">(Jan 09 2025 at 04:38)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>I'm running a live Linux USB. If/when that temporary file system freezes during one of my experiments I lose that live session. I store my experiments and applications on a different USB.</p>
<p>Every time I use <code>wasmtime compile file.wasm</code> that produces <code>f.cwasm</code>, and I lose the current filesystem, when I launch another live Linux session <code>wasmtime file.cwasm</code> fails to run.</p>
<p>That behaviour reminds me of how </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">bun</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">compile</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">npx</span><span class="w"> </span><span class="n">postject</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">NODE_SEA_BLOB</span><span class="w"> </span><span class="n">sea</span><span class="o">-</span><span class="n">prep</span><span class="p">.</span><span class="n">blob</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="o">--</span><span class="n">sentinel</span><span class="o">-</span><span class="n">fuse</span><span class="w"> </span><span class="n">NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2</span>
</code></pre></div>
<p>work to compile executables. When the source file system is no more the executable doesn't work anymore. The executable expectes the source files to be referenced on the file system.</p>
<p>COuld be something else in <code>wasmtime</code>. Don't know. I know what I describe above has happened multiple times when I try to run that same <code>.,cwasm</code> file produced by <code>wasmtime</code> that executed before I didn't have the exact same file system to execute that file on.</p>
<p>What's going on with the output of <code>wasmtime compile</code> here?<br>
</p>
</blockquote>



<a name="492630604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492630604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492630604">(Jan 09 2025 at 04:41)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2579169035">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>Would you be able to paste any details of snippets or commands you're running? You refer to <code>f.cwasm</code> as the output of <code>wasmtime compile file.wasm</code> but then you later refer to <code>file.cwasm</code> (note <code>f</code> vs <code>file</code> in the filename). I mostly want to confirm there's not a typo in the commands that you're running.</p>
<p>Otherwise to answer your question here: no, a <code>*.cwasm</code> artifact does not depend on the filesystem in any way and can be transferred to another machine as-is and executed there. I'm not familiar with either <code>npx</code> or <code>bun</code> but your <code>file.cwasm</code> produced should be a standalone file disconnected from anything else on the filesystem. The only requirement is that it's loaded into a compatible version of <code>wasmtime</code>-the-CLI. If you're using the same binary though that shouldn't be a concern.</p>
</blockquote>



<a name="492644825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492644825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492644825">(Jan 09 2025 at 06:43)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2579286226">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>Soource code <a href="https://github.com/guest271314/native-messaging-webassembly/blob/main/nm_javy.js">https://github.com/guest271314/native-messaging-webassembly/blob/main/nm_javy.js</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">javy</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">nm_javy</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">nm_javy</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">https</span><span class="p">:</span><span class="c1">//github.com/guest271314/native-messaging-webassembly/blob/main/nm_javy.js</span>
</code></pre></div>
<p><code>chmod +x</code> doesn't work. I have to recompile every I reboot a new live Linux sesssion. I don't have to do that with the C source code compiled to WASM in the same repository.</p>
</blockquote>



<a name="492645084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492645084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492645084">(Jan 09 2025 at 06:45)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2579288689">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>This is how the binary is executed <a href="https://github.com/guest271314/native-messaging-webassembly/blob/main/nm_c_wasm.sh">https://github.com/guest271314/native-messaging-webassembly/blob/main/nm_c_wasm.sh</a></p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S /home/user/1234/native-messaging-webassembly/wasmtime -C cache=n --allow-precompiled /home/user/1234/native-messaging-webassembly/nm_javy.cwasm</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="492741531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492741531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492741531">(Jan 09 2025 at 14:52)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2580472757">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>@alexcrichton I realize it's perhaps a bit much to reproduce exactly the steps I describe above. Just something I noticed and shared here. </p>
<p>This is what I'm talking about re <code>bun build</code> and Node.js's implementation of their SEA; cf. <code>deno compile</code> <a href="https://gist.github.com/guest271314/9b1adad3db3deba64e118f844a77bad6">Compiling a standalone executable using modern JavaScript/TypeScript runtimes</a>, <a href="https://gist.github.com/guest271314/c9543a19d8ccf72881355b27d0107551">Compiling npm to a standalone executable: Which runtime can do this out of the box; node, deno, or bun?</a>, <a href="https://github.com/oven-sh/bun/issues/14676">bun build --compile does not produce a standalone executable - still depends on external files #14676</a>.</p>
<p>Undoubtedly this current live Linux session I'm running now will freeze up at some point then I'll have the <code>nm_javy.cwasm</code> file and the same <code>wasmtime</code> executable I have now. So perhaps at that point the file can be disaaembled and analyzed.</p>
<p>The reason I know that this is happening with <code>wasmtime</code> and that <code>.cwasm</code> file is when I fetch Chromium when I start a new live Linux session I run a file that lists the time each programming language or JavaScript engine or runtime takes to read <code>stdin</code> and write to <code>stdout</code>. I always have to recompile that <code>.cwasm</code> file produced by <code>wasmtime</code>. Same <code>wasmtime</code> executable stored on an external USB copied to the new temporary file system operating in RAM. Same <code>.cwasm</code> file.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="mi">0</span><span class="w">   </span><span class="o">'</span><span class="na">nm_wasm</span><span class="o">'</span><span class="w">   </span><span class="mi">0</span>
<span class="mi">1</span><span class="w">   </span><span class="o">'</span><span class="na">nm_qjs</span><span class="o">'</span><span class="w">    </span><span class="mf">0.11310000002384185</span>
<span class="mi">2</span><span class="w">   </span><span class="o">'</span><span class="na">nm_c</span><span class="o">'</span><span class="w">  </span><span class="mf">0.11989999997615815</span>
<span class="mi">3</span><span class="w">   </span><span class="o">'</span><span class="na">nm_rust</span><span class="o">'</span><span class="w">   </span><span class="mf">0.12069999998807907</span>
<span class="mi">4</span><span class="w">   </span><span class="o">'</span><span class="na">nm_cpp</span><span class="o">'</span><span class="w">    </span><span class="mf">0.129</span>
<span class="mi">5</span><span class="w">   </span><span class="o">'</span><span class="na">nm_tjs</span><span class="o">'</span><span class="w">    </span><span class="mf">0.2415999999642372</span>
<span class="mi">6</span><span class="w">   </span><span class="o">'</span><span class="na">nm_deno</span><span class="o">'</span><span class="w">   </span><span class="mf">0.27840000003576276</span>
<span class="mi">7</span><span class="w">   </span><span class="o">'</span><span class="na">nm_bun</span><span class="o">'</span><span class="w">    </span><span class="mf">0.29010000002384184</span>
<span class="mi">8</span><span class="w">   </span><span class="o">'</span><span class="na">nm_nodejs</span><span class="o">'</span><span class="w"> </span><span class="mf">0.366</span>
<span class="mi">9</span><span class="w">   </span><span class="o">'</span><span class="na">nm_python</span><span class="o">'</span><span class="w"> </span><span class="mf">0.41009999996423724</span>
<span class="mi">10</span><span class="w">  </span><span class="o">'</span><span class="na">nm_d8</span><span class="o">'</span><span class="w"> </span><span class="mf">0.4128999999761581</span>
<span class="mi">11</span><span class="w">  </span><span class="o">'</span><span class="na">nm_typescript</span><span class="o">'</span><span class="w"> </span><span class="mf">0.4516000000238419</span>
<span class="mi">12</span><span class="w">  </span><span class="o">'</span><span class="na">nm_spidermonkey</span><span class="o">'</span><span class="w">   </span><span class="mf">0.4697000000476837</span>
<span class="mi">13</span><span class="w">  </span><span class="o">'</span><span class="na">nm_llrt</span><span class="o">'</span><span class="w">   </span><span class="mf">0.844</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="492754610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492754610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492754610">(Jan 09 2025 at 15:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2580621380">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>Ideally to help investigate this further on our end we'd need information such as steps to reproduce (e.g. exact commands, but we probably don't need to reproduce your entire environment exactly) along with logs/errors/etc that you're seeing. Without that the best we can to is piece together this from what you've listed here.</p>
<p>I can again reiterate though that <code>*.cwasm</code> files don't depend on external files. It sounds like you're running into a situation where you think that they do, but without error messages or a means of reproduction it's hard to say much more. </p>
</blockquote>



<a name="492755695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492755695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492755695">(Jan 09 2025 at 15:54)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2580631902">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>The linked repository includes complete source code and instructions. I'm using <code>wasmtime</code> and the <code>.cwasm</code> file as a Native Messaging host <a href="https://github.com/guest271314/NativeMessagingHosts#native-messaging-documentation">https://github.com/guest271314/NativeMessagingHosts#native-messaging-documentation</a>. Here's the test that generates the table data <a href="https://gist.github.com/guest271314/7d2118bd395bf1e3475b70b0187910f2">https://gist.github.com/guest271314/7d2118bd395bf1e3475b70b0187910f2</a>. </p>
<p>The running a live Linux USB/CD is perhaps somewhat involved, though possible.</p>
<p>I don't know why what I describe happens.</p>
</blockquote>



<a name="492758961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492758961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492758961">(Jan 09 2025 at 16:08)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2580675346">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>@guest271314 Alex had asked for</p>
<blockquote>
<p>along with logs/errors/etc that you're seeing.</p>
</blockquote>
<p>You say only "fails to run"; could you show us what the actual error is?</p>
<p>Given that we know how our system is meant to operate -- <code>.cwasm</code> files are independent artifacts, and the same wasmtime binary running the same cwasm file should either work or not work deterministically -- my first suspicion would be something about your setup that is corrupting the file. Can you take a hash (e.g. sha256) of the file when it works and when it doesn't, as well as a hash of the wasmtime binary that you're using in both cases?</p>
</blockquote>



<a name="492847243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492847243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492847243">(Jan 10 2025 at 00:27)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2581499893">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>@cfallin </p>
<p>Here's the current <code>.cwasm</code> file that is now working after re-compilation, and the original <code>.wasm</code> file. The regular <code>.wasm</code> file works as expected when I boot a new live Linux session. The <code>.cwasm</code> file doesn't.</p>
<p>I understand how you expect the compilation to work. That's what I expect, too.</p>
<p>Nonetheless I've encountered similar cases in different runtimes that also expected the same, and people have filed bugs to fix what is broken. Not saying that's what's going on here. </p>
<p>I don't look forward to my system freezing and starting a new live Linux session,. Though I've done it a few thousand times now. I have a startup script that basically gets me right back to where I am now. </p>
<p>The only way for me to reproduce this is to reboot the machine and run the code.</p>
<p>Would that help you analyze what's going on here?</p>
</blockquote>



<a name="492847404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492847404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492847404">(Jan 10 2025 at 00:28)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2581501029">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p><a href="https://github.com/user-attachments/files/18368922/wasm-cwasm.tar.gz">wasm-cwasm.tar.gz</a><br>
</p>
</blockquote>



<a name="492852720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492852720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492852720">(Jan 10 2025 at 01:14)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2581543994">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>@cfallin Alright, here's what connecting to the <em>working</em> <code>.cwasm</code> file  WebAssembly Native Messaging host using this shell script</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">javy</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">nm_javy</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">nm_javy</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="o">--</span><span class="n">optimize</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="n">s</span><span class="w"> </span><span class="n">nm_javy</span><span class="p">.</span><span class="n">wasm</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S /home/user/native-messaging-webassembly/wasmtime -C cache=n --allow-precompiled /home/user/native-messaging-webassembly/nm_javy.cwasm</span>
</code></pre></div>
<p>looks like from the browser.</p>
<p>![Screenshot_2025-01-09_17-00-14](<a href="https://github.com/user-attachments/assets/c81aa0a7-49ae-40ef-9b29-f98e612dafa4">https://github.com/user-attachments/assets/c81aa0a7-49ae-40ef-9b29-f98e612dafa4</a>).</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="mf">28.0.0</span><span class="w"> </span><span class="p">(</span><span class="mf">2e584</span><span class="n">e841</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<p>I want to make I'm checking everything when I turn off and turn back on this machine.</p>
<ul>
<li>Make sure the <code>.sh</code> file is executable</li>
<li>Make sure <code>wasmtime</code> is executable</li>
<li>Make sure it's not the test script I'm running, so I'll just repeat what I posted above directly, without connecting to all the hosts I have in that script</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">var</span><span class="w"> </span><span class="n">runtimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Map</span><span class="p">([</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_nodejs"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_deno"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_bun"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_tjs"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_qjs"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_spidermonkey"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_d8"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_typescript"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_llrt"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_rust"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_cpp"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_c"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_python"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_wasm"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_c"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="p">[</span><span class="s">"nm_cpp"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span>


<span class="p">]);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="p">[</span><span class="n">runtime</span><span class="p">]</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">runtimes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">resolve</span><span class="p">,</span>
<span class="w">      </span><span class="n">reject</span><span class="p">,</span>
<span class="w">      </span><span class="n">promise</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Promise</span><span class="p">.</span><span class="n">withResolvers</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performance</span><span class="p">.</span><span class="n">now</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chrome</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">connectNative</span><span class="p">(</span><span class="n">runtime</span><span class="p">);</span>
<span class="w">    </span><span class="n">port</span><span class="p">.</span><span class="n">onMessage</span><span class="p">.</span><span class="n">addListener</span><span class="p">((</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">console</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">209715</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="p">});</span>
<span class="w">      </span><span class="n">runtimes</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">runtime</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">performance</span><span class="p">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">now</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">      </span><span class="n">port</span><span class="p">.</span><span class="n">disconnect</span><span class="p">();</span>
<span class="w">      </span><span class="n">resolve</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">port</span><span class="p">.</span><span class="n">onDisconnect</span><span class="p">.</span><span class="n">addListener</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">reject</span><span class="p">(</span><span class="n">chrome</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">lastError</span><span class="p">));</span>
<span class="w">    </span><span class="n">port</span><span class="p">.</span><span class="n">postMessage</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Array</span><span class="p">(</span><span class="mi">209715</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">runtime</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s">"nm_spidermonkey"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">port</span><span class="p">.</span><span class="n">postMessage</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="n">promise</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="p">);</span>
<span class="w">    </span><span class="k">continue</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">var</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">..</span><span class="p">.</span><span class="n">runtimes</span><span class="p">].</span><span class="n">sort</span><span class="p">(([,</span><span class="w"> </span><span class="n">a</span><span class="p">],</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="n">b</span><span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">console</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">sorted</span><span class="p">);</span>
</code></pre></div>
<p>![Screenshot_2025-01-09_17-13-44](<a href="https://github.com/user-attachments/assets/bc9c29a1-359c-4c76-8684-4ad138fd4024">https://github.com/user-attachments/assets/bc9c29a1-359c-4c76-8684-4ad138fd4024</a>)</p>
<p>I don't think I'm missing any particulars about what I need to do after I reboot and test from Chromium Dev Channel. </p>
<p>Anything particular I should do that I didn't list above?</p>
</blockquote>



<a name="492880777"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492880777" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492880777">(Jan 10 2025 at 05:43)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2581823753">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>Hi @guest271314 -- unfortunately you didn't provide the information that I asked for. To reiterate from above:</p>
<blockquote>
<p>You say only "fails to run"; could you show us what the actual error is?</p>
</blockquote>
<p>In other words, please copy and paste from a shell session where you run <code>wasmtime</code> and see that it cannot run a <code>.cwasm</code> file that you expect to be runnable and that was previously runnable. Please copy and paste exactly the output, including the command. To reduce unknowns, I would ask you to please try to reproduce this from the command line: you appear to have a quite custom runner setup involving a JavaScript top-level and a browser with subprocesses. To determine whether the problem is Wasmtime and narrow it down if so, let's stick to the CLI.</p>
<blockquote>
<p>Can you take a hash (e.g. sha256) of the file when it works and when it doesn't, as well as a hash of the wasmtime binary that you're using in both cases?</p>
</blockquote>
<p>Please copy and paste the hash of the wasmtime binary and your cwasm file both in the case that execution works and the case that execution doesn't, to verify that they are the same.</p>
<p>I cannot offer any more advice until you provide the information above. Thanks!</p>
</blockquote>



<a name="492886638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492886638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492886638">(Jan 10 2025 at 06:44)</a>:</h4>
<p>guest271314 closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<p>I'm running a live Linux USB. If/when that temporary file system freezes during one of my experiments I lose that live session. I store my experiments and applications on a different USB.</p>
<p>Every time I use <code>wasmtime compile file.wasm</code> that produces <code>f.cwasm</code>, and I lose the current filesystem, when I launch another live Linux session <code>wasmtime file.cwasm</code> fails to run.</p>
<p>That behaviour reminds me of how </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">bun</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">compile</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">npx</span><span class="w"> </span><span class="n">postject</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">NODE_SEA_BLOB</span><span class="w"> </span><span class="n">sea</span><span class="o">-</span><span class="n">prep</span><span class="p">.</span><span class="n">blob</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="o">--</span><span class="n">sentinel</span><span class="o">-</span><span class="n">fuse</span><span class="w"> </span><span class="n">NODE_SEA_FUSE_fce680ab2cc467b6e072b8b5df1996b2</span>
</code></pre></div>
<p>work to compile executables. When the source file system is no more the executable doesn't work anymore. The executable expectes the source files to be referenced on the file system.</p>
<p>COuld be something else in <code>wasmtime</code>. Don't know. I know what I describe above has happened multiple times when I try to run that same <code>.,cwasm</code> file produced by <code>wasmtime</code> that executed before I didn't have the exact same file system to execute that file on.</p>
<p>What's going on with the output of <code>wasmtime compile</code> here?<br>
</p>
</blockquote>



<a name="492886641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239953%20Explain%20details%20of%20compile/near/492886641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239953.20Explain.20details.20of.20compile.html#492886641">(Jan 10 2025 at 06:44)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/9953#issuecomment-2581903390">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9953">issue #9953</a>:</p>
<blockquote>
<blockquote>
<p>In other words, please copy and paste from a shell session where you run wasmtime and see that it cannot run a .cwasm file</p>
</blockquote>
<p>I did. I posted code and screenshots of Chromium browser DevTools =&gt; Sources =&gt; Snippets where I run the code from.</p>
<p>Native Messaging protocol (see <a href="https://github.com/guest271314/NativeMessagingHosts?tab=readme-ov-file#native-messaging-documentation">https://github.com/guest271314/NativeMessagingHosts?tab=readme-ov-file#native-messaging-documentation</a>) provides a communication channel over IPC between the browser and native applications. So the screenshot is literally be executing </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S /home/user/native-messaging-webassembly/wasmtime -C cache=n --allow-precompiled /homeuser/native-messaging-webassembly/nm_javy.cwasm</span>
</code></pre></div>
<p>from the browser. Sending JSON, getting JSON back in the form of a plain JavaScript object in the browser.</p>
<p>In the above screenshot I'm benchmarking C, C++, Rust, JavaScript, Python, WASM in the form of JavaScript compiled to WASM with <code>javy</code> then <code>.wasm</code> compiled to <code>.cwasm</code> with <code>wasmtime</code> , et al. Native Messaging hosts. See <a href="https://github.com/guest271314/NativeMessagingHosts">https://github.com/guest271314/NativeMessagingHosts</a>. </p>
<p>The benchmark is testing the speed to send 1 MB from the browser console to the Native Messaging hosts, and the hosts sending back 1 MB back to the browser.</p>
<p>In other Native Messaging hosts I do other stuff, like stream real-time audio to the browser from the native application.</p>
<p>Above I'm just testing the relative speed of different JavaScript runtimes and programming languages, and WASM, and C and C++ and JavaScript compiled to WASM, and that WASM compiled to <code>.cwasm</code> - because I've observed the file size is greater, though the <code>.cwasm</code> is faster then executing the original <code>.wasm</code> file.</p>
<p>Compare the first using <code>.cwasm</code>, second using <code>.wasm</code>.</p>
<p>![Screenshot_2025-01-09_22-39-59](<a href="https://github.com/user-attachments/assets/0b3fa144-63c8-42e7-80f9-9e45fe9a352c">https://github.com/user-attachments/assets/0b3fa144-63c8-42e7-80f9-9e45fe9a352c</a>)<br>
![Screenshot_2025-01-09_22-40-25](<a href="https://github.com/user-attachments/assets/5eaed90d-85bc-4d4d-b536-73e176de9e97">https://github.com/user-attachments/assets/5eaed90d-85bc-4d4d-b536-73e176de9e97</a>)</p>
<p>Got it working.</p>
<p>Recompiled during previous session.</p>
<p>Made sure I am using newest <code>wasmtime</code>.</p>
<p>Turned off machine.</p>
<p>Turned machine back on. Ran startup script. Tested on Chromium Version 134.0.6949.0 (Developer Build) (64-bit).</p>
<p>Thanks.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>