<html>
<head><meta charset="utf-8"><title>wasmtime / issue #2299 Cranelift: Support stack probes wi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html">wasmtime / issue #2299 Cranelift: Support stack probes wi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="255808329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232299%20Cranelift%3A%20Support%20stack%20probes%20wi.../near/255808329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html#255808329">(Oct 01 2021 at 21:12)</a>:</h4>
<p>akirilov-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2299">issue #2299</a>:</p>
<blockquote>
<p>&lt;!-- Please try to describe precisely what you would like to do in<br>
Cranelift/Wasmtime and/or expect from it. You can answer the questions below if<br>
they're relevant and delete this text before submitting. Thanks for opening an<br>
issue! --&gt;</p>
<h4>Feature</h4>
<p>LLVM has support for performing the stack probes directly in the function prologue instead of calling an external function. (see <a href="https://github.com/rust-lang/rust/pull/77885">https://github.com/rust-lang/rust/pull/77885</a> for using this in Rust)</p>
<h4>Benefit</h4>
<p>This can be faster due to being able to unroll the stack probe loop. It also avoids having to provide an external stack probe function. This makes it possible to enable stack probing in cg_clif. (<a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/661">https://github.com/bjorn3/rustc_codegen_cranelift/issues/661</a>)</p>
<h4>Implementation</h4>
<p>This should only be implemented for the machinst backends. It should probably be added to either the <code>gen_prologue</code> implementation or <code>gen_prologue</code> caller.</p>
<h4>Alternatives</h4>
<p>Keep using an external stack probe function with the associated drawbacks.<br>
</p>
</blockquote>



<a name="296710145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232299%20Cranelift%3A%20Support%20stack%20probes%20wi.../near/296710145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html#296710145">(Sep 01 2022 at 22:32)</a>:</h4>
<p>jameysharp closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2299">issue #2299</a>:</p>
<blockquote>
<p>&lt;!-- Please try to describe precisely what you would like to do in<br>
Cranelift/Wasmtime and/or expect from it. You can answer the questions below if<br>
they're relevant and delete this text before submitting. Thanks for opening an<br>
issue! --&gt;</p>
<h4>Feature</h4>
<p>LLVM has support for performing the stack probes directly in the function prologue instead of calling an external function. (see <a href="https://github.com/rust-lang/rust/pull/77885">https://github.com/rust-lang/rust/pull/77885</a> for using this in Rust)</p>
<h4>Benefit</h4>
<p>This can be faster due to being able to unroll the stack probe loop. It also avoids having to provide an external stack probe function. This makes it possible to enable stack probing in cg_clif. (<a href="https://github.com/bjorn3/rustc_codegen_cranelift/issues/661">https://github.com/bjorn3/rustc_codegen_cranelift/issues/661</a>)</p>
<h4>Implementation</h4>
<p>This should only be implemented for the machinst backends. It should probably be added to either the <code>gen_prologue</code> implementation or <code>gen_prologue</code> caller.</p>
<h4>Alternatives</h4>
<p>Keep using an external stack probe function with the associated drawbacks.<br>
</p>
</blockquote>



<a name="296757964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232299%20Cranelift%3A%20Support%20stack%20probes%20wi.../near/296757964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html#296757964">(Sep 02 2022 at 06:31)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2299#issuecomment-1235120726">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2299">issue #2299</a>:</p>
<blockquote>
<p>Neither AArch64, nor s390x has support for this yet.</p>
</blockquote>



<a name="296771190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232299%20Cranelift%3A%20Support%20stack%20probes%20wi.../near/296771190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html#296771190">(Sep 02 2022 at 08:22)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/2299#issuecomment-1235215869">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2299">issue #2299</a>:</p>
<blockquote>
<p>Right, should we reopen this or open issues against both backends?</p>
</blockquote>



<a name="296771673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%232299%20Cranelift%3A%20Support%20stack%20probes%20wi.../near/296771673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.232299.20Cranelift.3A.20Support.20stack.20probes.20wi.2E.2E.2E.html#296771673">(Sep 02 2022 at 08:25)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2299#issuecomment-1235218733">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2299">issue #2299</a>:</p>
<blockquote>
<p>Opened #4846 and #4847.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>