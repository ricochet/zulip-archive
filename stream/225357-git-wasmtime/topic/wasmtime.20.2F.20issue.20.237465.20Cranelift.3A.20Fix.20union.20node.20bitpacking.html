<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7465 Cranelift: Fix union node bitpacking · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html">wasmtime / issue #7465 Cranelift: Fix union node bitpacking</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="400162048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400162048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400162048">(Nov 03 2023 at 15:59)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792702087">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Last merge-queue test run seemed to show a real assert failure during compilation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">assertion</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ir</span><span class="o">/</span><span class="n">dfg</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">557</span>:<span class="mi">9</span>
</code></pre></div>
<p>weird that it only reproduces on the MSRV run and for an integration test?</p>
</blockquote>



<a name="400162956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400162956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400162956">(Nov 03 2023 at 16:03)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792708254">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>I'm going to remove from the queue due to ^</p>
</blockquote>



<a name="400163255"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400163255" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400163255">(Nov 03 2023 at 16:04)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792709876">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>It looks like we are creating a union of two values and the values' indices don't fit in the packed representation</p>
</blockquote>



<a name="400165567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400165567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400165567">(Nov 03 2023 at 16:16)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792735949">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Does anyone know how to run the tokio example, or at least build the wasms that it uses?</p>
<p><code>cargo build --target wasm32-wasi</code> inside <code>examples/tokio/wasm</code> doesn't seem to actually produce any wasm files for me.</p>
</blockquote>



<a name="400166327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400166327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400166327">(Nov 03 2023 at 16:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792742011">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">--</span><span class="n">manifest</span><span class="o">-</span><span class="n">path</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span><span class="n">tokio</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">Cargo</span><span class="p">.</span><span class="n">toml</span>
<span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">example</span><span class="w"> </span><span class="n">tokio</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">wasi</span><span class="o">/</span><span class="n">tokio</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="400184791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400184791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400184791">(Nov 03 2023 at 18:14)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792917531">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hm I can't reproduce the assertion failure for that example.</p>
<p>But I did find an off-by-one bug in the assertion. It allows <code>0x00ff_ffff</code> to be encoded as-is but that conflicts with the sentinal we use to represent <code>0xffff_ffff</code>. Tweaked to fix the assertion.</p>
</blockquote>



<a name="400184935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400184935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400184935">(Nov 03 2023 at 18:15)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792917531">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hm I can't reproduce the assertion failure for that example.</p>
<p>But I did find an off-by-one bug in the assertion. It allows <code>0x0000_0fff</code> to be encoded as-is but that conflicts with the sentinal we use to represent <code>0xffff_ffff</code>. Tweaked to fix the assertion.</p>
</blockquote>



<a name="400186846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400186846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400186846">(Nov 03 2023 at 18:30)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792941423">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Okay I was able to repro with the 1.71.0 toolchain. Interestingly enough, it seemed to hang for a while before actually panicking, when the other toolchains ran to completion almost immediately.</p>
</blockquote>



<a name="400192716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400192716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400192716">(Nov 03 2023 at 19:14)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792970129">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Still going (it is generating a lot of output) but it looks like we've gone into some kind of loop where we are unioning values like <code>x, x+1, x+2, ...</code>. Since this only shows up on 1.71.0, I'm thinking this might be a miscompile in rustc/llvm?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db4</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d09</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db6</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db7</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db8</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90db9</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d09</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dba</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dbb</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d1f</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dbc</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dbd</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dbe</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d09</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dbf</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dc0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dc1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dc2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xe90dc3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d09</span><span class="p">)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="400192794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400192794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400192794">(Nov 03 2023 at 19:15)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792970807">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Yep, it just finished:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffff9</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffffa</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffffb</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffffc</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffffd</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xfffffe</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29d09</span><span class="p">)</span>
<span class="n">FITZGEN</span>: <span class="nc">packing</span><span class="w"> </span><span class="k">union</span><span class="p">(</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffffff</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xc29cf9</span><span class="p">)</span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="mi">16777215</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="p">(</span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="mi">16777215</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="mh">0xffffffff</span><span class="w"> </span><span class="n">sentinal</span><span class="p">)</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ir</span><span class="o">/</span><span class="n">dfg</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">558</span>:<span class="mi">9</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="400200958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400200958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400200958">(Nov 03 2023 at 20:25)</a>:</h4>
<p>fitzgen edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1792917531">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hm I can't reproduce the assertion failure for that example.</p>
<p>But I did find an off-by-one bug in the assertion. It allows <code>0x00ff_ffff</code> to be encoded as-is but that conflicts with the sentinal we use to represent <code>0xffff_ffff</code>. Tweaked to fix the assertion.</p>
</blockquote>



<a name="400227309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400227309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400227309">(Nov 04 2023 at 01:03)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1793280046">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="400581400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400581400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400581400">(Nov 06 2023 at 17:34)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1795610122">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>I can't reproduce the test failure in CI. I'm also on linux x64 and using rust 1.73. Not sure what is up here.</p>
</blockquote>



<a name="400700107"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400700107" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400700107">(Nov 07 2023 at 09:35)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1798133745">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hey, I ran the fuzzer on RISC-V overnight on this branch, to check if there is something wrong with the RISC-V backend. I don't know if there is yet, but I think I got a reproduction of the issue that was happening in CI earlier.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Testcase&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">case</span>

<span class="n">test</span><span class="w"> </span><span class="n">interpret</span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64gc</span><span class="w"> </span><span class="n">has_zca</span><span class="w"> </span><span class="n">has_zcd</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ss1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">49</span>
<span class="w">    </span><span class="n">ss3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">52</span>
<span class="w">    </span><span class="n">ss4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v54</span><span class="w"> </span>-&gt; <span class="nc">v1</span>
<span class="w">    </span><span class="n">v37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v38</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v37</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v38</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v43</span><span class="p">,</span><span class="w"> </span><span class="n">v43</span>
<span class="w">    </span><span class="n">v55</span><span class="w"> </span>-&gt; <span class="nc">v44</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v42</span>
<span class="w">    </span><span class="n">v46</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v45</span>
<span class="w">    </span><span class="n">v47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v47</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v49</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span>
<span class="w">    </span><span class="n">v50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v49</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v50</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v52</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v51</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v52</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span>-&gt; <span class="nc">v53</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v54</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span>
<span class="w">    </span><span class="n">v57</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v56</span><span class="p">,</span><span class="w"> </span><span class="n">v56</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v58</span>
<span class="w">    </span><span class="n">v61</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v61</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span>
<span class="w">    </span><span class="n">v64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v63</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v65</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v64</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v66</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v65</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v67</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v66</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotr</span><span class="w"> </span><span class="n">v67</span><span class="p">,</span><span class="w"> </span><span class="n">v54</span>
<span class="w">    </span><span class="n">v69</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v68</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v70</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v69</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v71</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v70</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v72</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v71</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v73</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v72</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v73</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">4474</span><span class="p">,</span><span class="w"> </span><span class="mi">4803839602528529</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10005959247738946646150328352768</span><span class="p">,</span><span class="w"> </span><span class="mi">19070975</span><span class="p">,</span><span class="w"> </span><span class="mi">281564249487374563584566874706289408</span><span class="p">,</span><span class="w"> </span><span class="mi">8440</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">34</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>main</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v82</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v85</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v82</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v88</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v85</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v88</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v89</span>
<span class="w">    </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v217</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v217</span>
<span class="w">    </span><span class="n">v308</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v310</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v308</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v311</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ineg</span><span class="w"> </span><span class="n">v310</span>
<span class="w">    </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v406</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v311</span><span class="p">,</span><span class="w"> </span><span class="n">v404</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v408</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v406</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v408</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>fix-egraph-union</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v93</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v93</span>
<span class="w">    </span><span class="n">v176</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v130</span>
<span class="w">    </span><span class="n">v177</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v176</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v177</span>
<span class="w">    </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v681</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v679</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v681</span>
<span class="w">    </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1116</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v1161</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v376</span><span class="p">,</span><span class="w"> </span><span class="n">v1116</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1936</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v1161</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v1936</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>This testcase spends a huge amount of time in egraphs with this PR and it now fails where it didn't before. Although I'm not 100% sure this isn't a bug in one of the rules that wasn't discovered previously.</p>
<p>I'm going to look into this again later today</p>
</blockquote>



<a name="400700384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400700384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400700384">(Nov 07 2023 at 09:37)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1798133745">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hey, I ran the fuzzer on RISC-V overnight on this branch to check if there is something wrong with the RISC-V backend. I don't know if there is yet, but I think I got a reproduction of the issue that was happening in CI earlier.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Testcase&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">case</span>

<span class="n">test</span><span class="w"> </span><span class="n">interpret</span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64gc</span><span class="w"> </span><span class="n">has_zca</span><span class="w"> </span><span class="n">has_zcd</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ss1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">49</span>
<span class="w">    </span><span class="n">ss3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">52</span>
<span class="w">    </span><span class="n">ss4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v54</span><span class="w"> </span>-&gt; <span class="nc">v1</span>
<span class="w">    </span><span class="n">v37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v38</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v37</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v38</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v43</span><span class="p">,</span><span class="w"> </span><span class="n">v43</span>
<span class="w">    </span><span class="n">v55</span><span class="w"> </span>-&gt; <span class="nc">v44</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v42</span>
<span class="w">    </span><span class="n">v46</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v45</span>
<span class="w">    </span><span class="n">v47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v47</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v49</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span>
<span class="w">    </span><span class="n">v50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v49</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v50</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v52</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v51</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v52</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span>-&gt; <span class="nc">v53</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v54</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span>
<span class="w">    </span><span class="n">v57</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v56</span><span class="p">,</span><span class="w"> </span><span class="n">v56</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v58</span>
<span class="w">    </span><span class="n">v61</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v61</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span>
<span class="w">    </span><span class="n">v64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v63</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v65</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v64</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v66</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v65</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v67</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v66</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotr</span><span class="w"> </span><span class="n">v67</span><span class="p">,</span><span class="w"> </span><span class="n">v54</span>
<span class="w">    </span><span class="n">v69</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v68</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v70</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v69</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v71</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v70</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v72</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v71</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v73</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v72</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v73</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">4474</span><span class="p">,</span><span class="w"> </span><span class="mi">4803839602528529</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10005959247738946646150328352768</span><span class="p">,</span><span class="w"> </span><span class="mi">19070975</span><span class="p">,</span><span class="w"> </span><span class="mi">281564249487374563584566874706289408</span><span class="p">,</span><span class="w"> </span><span class="mi">8440</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">34</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>main</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v82</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v85</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v82</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v88</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v85</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v88</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v89</span>
<span class="w">    </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v217</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v217</span>
<span class="w">    </span><span class="n">v308</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v310</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v308</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v311</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ineg</span><span class="w"> </span><span class="n">v310</span>
<span class="w">    </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v406</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v311</span><span class="p">,</span><span class="w"> </span><span class="n">v404</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v408</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v406</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v408</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>fix-egraph-union</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v93</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v93</span>
<span class="w">    </span><span class="n">v176</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v130</span>
<span class="w">    </span><span class="n">v177</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v176</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v177</span>
<span class="w">    </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v681</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v679</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v681</span>
<span class="w">    </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1116</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v1161</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v376</span><span class="p">,</span><span class="w"> </span><span class="n">v1116</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1936</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v1161</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v1936</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>This testcase spends a huge amount of time in egraphs with this PR and it now fails where it didn't before. Although I'm not 100% sure this isn't a bug in one of the rules that wasn't discovered previously.</p>
<p>I'm going to look into this again later today</p>
</blockquote>



<a name="400713220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400713220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400713220">(Nov 07 2023 at 10:44)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1798133745">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hey, I ran the fuzzer on RISC-V overnight on this branch to check if there is something wrong with the RISC-V backend. I don't know if there is yet, but I think I got a reproduction of the issue that was happening in CI earlier.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Testcase&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">case</span>

<span class="n">test</span><span class="w"> </span><span class="n">interpret</span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64gc</span><span class="w"> </span><span class="n">has_zca</span><span class="w"> </span><span class="n">has_zcd</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ss1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">49</span>
<span class="w">    </span><span class="n">ss3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">52</span>
<span class="w">    </span><span class="n">ss4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v54</span><span class="w"> </span>-&gt; <span class="nc">v1</span>
<span class="w">    </span><span class="n">v37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v38</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v37</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v38</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v43</span><span class="p">,</span><span class="w"> </span><span class="n">v43</span>
<span class="w">    </span><span class="n">v55</span><span class="w"> </span>-&gt; <span class="nc">v44</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v42</span>
<span class="w">    </span><span class="n">v46</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v45</span>
<span class="w">    </span><span class="n">v47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v47</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v49</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span>
<span class="w">    </span><span class="n">v50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v49</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v50</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v52</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v51</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v52</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span>-&gt; <span class="nc">v53</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v54</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span>
<span class="w">    </span><span class="n">v57</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v56</span><span class="p">,</span><span class="w"> </span><span class="n">v56</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v58</span>
<span class="w">    </span><span class="n">v61</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v61</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span>
<span class="w">    </span><span class="n">v64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v63</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v65</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v64</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v66</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v65</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v67</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v66</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotr</span><span class="w"> </span><span class="n">v67</span><span class="p">,</span><span class="w"> </span><span class="n">v54</span>
<span class="w">    </span><span class="n">v69</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v68</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v70</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v69</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v71</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v70</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v72</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v71</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v73</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v72</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v73</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">4474</span><span class="p">,</span><span class="w"> </span><span class="mi">4803839602528529</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10005959247738946646150328352768</span><span class="p">,</span><span class="w"> </span><span class="mi">19070975</span><span class="p">,</span><span class="w"> </span><span class="mi">281564249487374563584566874706289408</span><span class="p">,</span><span class="w"> </span><span class="mi">8440</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">34</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>main</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v82</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v85</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v82</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v88</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v85</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v88</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v89</span>
<span class="w">    </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v217</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v217</span>
<span class="w">    </span><span class="n">v308</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v310</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v308</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v311</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ineg</span><span class="w"> </span><span class="n">v310</span>
<span class="w">    </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v406</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v311</span><span class="p">,</span><span class="w"> </span><span class="n">v404</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v408</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v406</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v408</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>fix-egraph-union</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v93</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v93</span>
<span class="w">    </span><span class="n">v176</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v130</span>
<span class="w">    </span><span class="n">v177</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v176</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v177</span>
<span class="w">    </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v681</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v679</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v681</span>
<span class="w">    </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1116</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v1161</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v376</span><span class="p">,</span><span class="w"> </span><span class="n">v1116</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1936</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v1161</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v1936</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>~This testcase spends a huge amount of time in egraphs with this PR and it now fails where it didn't before. Although I'm not 100% sure this isn't a bug in one of the rules that wasn't discovered previously.~</p>
<p>~I'm going to look into this again later today~</p>
<p>Edit: This ended up being a RISC-V bug, but I think it's still worth looking at the testcase, we now spend a bunch of time building values which I'm not sure is intended.</p>
</blockquote>



<a name="400713306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400713306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400713306">(Nov 07 2023 at 10:45)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1798133745">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Hey, I ran the fuzzer on RISC-V overnight on this branch to check if there is something wrong with the RISC-V backend. I don't know if there is yet, but I think I got a reproduction of the issue that was happening in CI earlier.</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Testcase&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;;</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">case</span>

<span class="n">test</span><span class="w"> </span><span class="n">interpret</span>
<span class="n">test</span><span class="w"> </span><span class="n">run</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64gc</span><span class="w"> </span><span class="n">has_zca</span><span class="w"> </span><span class="n">has_zcd</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">29</span>
<span class="w">    </span><span class="n">ss1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">49</span>
<span class="w">    </span><span class="n">ss3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">52</span>
<span class="w">    </span><span class="n">ss4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>
<span class="w">    </span><span class="n">ss5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">17</span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v54</span><span class="w"> </span>-&gt; <span class="nc">v1</span>
<span class="w">    </span><span class="n">v37</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v38</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v37</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v38</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v39</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v41</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v44</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v43</span><span class="p">,</span><span class="w"> </span><span class="n">v43</span>
<span class="w">    </span><span class="n">v55</span><span class="w"> </span>-&gt; <span class="nc">v44</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v42</span>
<span class="w">    </span><span class="n">v46</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v45</span>
<span class="w">    </span><span class="n">v47</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v48</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v47</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v49</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span><span class="p">,</span><span class="w"> </span><span class="n">v48</span>
<span class="w">    </span><span class="n">v50</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v49</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v50</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v52</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v51</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v53</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v52</span><span class="p">,</span><span class="w"> </span><span class="n">v44</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span>-&gt; <span class="nc">v53</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v54</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span><span class="p">,</span><span class="w"> </span><span class="n">v55</span>
<span class="w">    </span><span class="n">v57</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bxor_not</span><span class="w"> </span><span class="n">v56</span><span class="p">,</span><span class="w"> </span><span class="n">v56</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="n">v58</span>
<span class="w">    </span><span class="n">v61</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v61</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span><span class="p">,</span><span class="w"> </span><span class="n">v62</span>
<span class="w">    </span><span class="n">v64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v63</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v65</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v64</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v66</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v65</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v67</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v66</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v68</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotr</span><span class="w"> </span><span class="n">v67</span><span class="p">,</span><span class="w"> </span><span class="n">v54</span>
<span class="w">    </span><span class="n">v69</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v68</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v70</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v69</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v71</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v70</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v72</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v71</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="n">v73</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v72</span><span class="p">,</span><span class="w"> </span><span class="n">v57</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v73</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">4474</span><span class="p">,</span><span class="w"> </span><span class="mi">4803839602528529</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10005959247738946646150328352768</span><span class="p">,</span><span class="w"> </span><span class="mi">19070975</span><span class="p">,</span><span class="w"> </span><span class="mi">281564249487374563584566874706289408</span><span class="p">,</span><span class="w"> </span><span class="mi">8440</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">34</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>main</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v91</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v82</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v85</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v82</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v88</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v85</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v89</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v88</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v89</span>
<span class="w">    </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v217</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v217</span>
<span class="w">    </span><span class="n">v308</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v310</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v308</span><span class="p">,</span><span class="w"> </span><span class="n">v215</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v215</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">v311</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ineg</span><span class="w"> </span><span class="n">v310</span>
<span class="w">    </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v406</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v311</span><span class="p">,</span><span class="w"> </span><span class="n">v404</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v404</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffb</span>
<span class="w">    </span><span class="n">v408</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v406</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v408</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;Egraphs Result <code>fix-egraph-union</code>&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">(</span><span class="kt">i8</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i128</span><span class="w"> </span><span class="n">uext</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">sext</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sext</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i8</span> <span class="nc">fast</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i8</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v4</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v6</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v7</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v8</span>: <span class="kt">i64</span><span class="p">,</span><span class="w"> </span><span class="n">v9</span>: <span class="kt">i128</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">v11</span>: <span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">v12</span>: <span class="kt">i64</span><span class="p">)</span>:
    <span class="nc">v43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v56</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select_spectre_guard</span><span class="w"> </span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span><span class="p">,</span><span class="w"> </span><span class="n">v251</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_ffff</span>
<span class="w">    </span><span class="n">v76</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v79</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v76</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v93</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v79</span><span class="p">,</span><span class="w"> </span><span class="n">v10</span>
<span class="w">    </span><span class="n">v130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v93</span>
<span class="w">    </span><span class="n">v176</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="w"> </span><span class="n">v10</span><span class="p">,</span><span class="w"> </span><span class="n">v130</span>
<span class="w">    </span><span class="n">v177</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v176</span>
<span class="w">    </span><span class="n">v45</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v177</span>
<span class="w">    </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v681</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v45</span><span class="p">,</span><span class="w"> </span><span class="n">v679</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v679</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">v59</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bitrev</span><span class="w"> </span><span class="n">v681</span>
<span class="w">    </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1116</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v1</span>
<span class="w">    </span><span class="n">v1161</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isub</span><span class="w"> </span><span class="n">v376</span><span class="p">,</span><span class="w"> </span><span class="n">v1116</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v376</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffff_fffd</span>
<span class="w">    </span><span class="n">v1936</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rotl</span><span class="w"> </span><span class="n">v59</span><span class="p">,</span><span class="w"> </span><span class="n">v1161</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v1936</span>
<span class="p">}</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>~This testcase spends a huge amount of time in egraphs with this PR and it now fails where it didn't before. Although I'm not 100% sure this isn't a bug in one of the rules that wasn't discovered previously.~</p>
<p>~I'm going to look into this again later today~</p>
<p>Edit: This ended up being a RISC-V bug (#7491), but I think it's still worth looking at the testcase, we now spend a bunch of time building values which I'm not sure is intended.</p>
</blockquote>



<a name="400784524"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237465%20Cranelift%3A%20Fix%20union%20node%20bitpacking/near/400784524" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237465.20Cranelift.3A.20Fix.20union.20node.20bitpacking.html#400784524">(Nov 07 2023 at 17:17)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/7465#issuecomment-1799274044">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7465">issue #7465</a>:</p>
<blockquote>
<p>Thanks for digging into that @afonso360!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>