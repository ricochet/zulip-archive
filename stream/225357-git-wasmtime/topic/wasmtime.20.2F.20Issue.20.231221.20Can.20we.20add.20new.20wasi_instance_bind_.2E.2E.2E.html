<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1221 Can we add new wasi_instance_bind_... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html">wasmtime / Issue #1221 Can we add new wasi_instance_bind_...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="189676406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/189676406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#189676406">(Mar 04 2020 at 10:08)</a>:</h4>
<p>rene-fonseca <a href="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-594432738" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-594432738">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a>:</p>
<blockquote>
<p>Sounds ok to me.</p>
</blockquote>



<a name="190308314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/190308314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#190308314">(Mar 11 2020 at 17:22)</a>:</h4>
<p>fitzgen labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a> (assigned to peterhuene):</p>
<blockquote>
<p>Since the WASI spec is still volatile it makes sense to support any module name to be able to let the caller control which functions to bind.</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212" target="_blank" title="https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212">https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212</a></p>
<p><code>wasi_instance_bind_import</code> currently only accepts "wasi_snapshot_preview1". But for my testing I need "wasi_unstable". If wasmtime at some point only accepts a specific module - we should have a way to tell which modules are accepted by wasmtime wasi implementation. But hopefully all modules will be backwards compatible per API function. If that isn't true, we would maybe need something like glibc version per function.</p>
<p>Alternatively we could have a wasi_instance_bind_import API which ignores the module - and lets it be up to the caller fully. wasi_instance_bind_import would still check function type and name.</p>
</blockquote>



<a name="190308327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/190308327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#190308327">(Mar 11 2020 at 17:22)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-597762676" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-597762676">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>This issue or pull request has been labeled "wasmtime:c-api".</p>
<p>&lt;details&gt; &lt;summary&gt;Users Subscribed to "wasmtime:c-api"&lt;/summary&gt;</p>
<ul>
<li>@peterhuene</li>
</ul>
<p>&lt;/details&gt;</p>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" target="_blank" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a></p>
</blockquote>



<a name="191307694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/191307694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#191307694">(Mar 20 2020 at 21:54)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-601926635" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-601926635">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a>:</p>
<blockquote>
<p>So the problem with representing a WASI instance as a <code>wasm_instance_t</code> is that <code>wasm_instance_exports</code> will return a 1:1 mapping between the underlying <code>wasm_module_t</code>'s exports and the module's exports are what describe the symbolic name.  Thus the instance's exports don't provide any symbolic name information because normally you would know which instance extern goes to which module export based on array index.</p>
<p>With a WASI instance, there is no <code>wasm_module_t</code> representation, so there's no way to describe what <code>wasm_instance_exports</code> would be returning (i.e. "what is the name of the function?").</p>
<p>So I think we'll still need <code>wasi_instance_t</code>, but I think creating the instance should take the name of the WASI module to support different versions.</p>
</blockquote>



<a name="191317033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/191317033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#191317033">(Mar 20 2020 at 23:59)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-601958763" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-601958763">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" target="_blank" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a>:</p>
<blockquote>
<p>I decided to fix this by transparently supporting <code>wasi_unstable</code> from the current API.  I've submitted PR #1376 which should hopefully work for you.</p>
</blockquote>



<a name="191937890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/191937890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#191937890">(Mar 26 2020 at 19:35)</a>:</h4>
<p>peterhuene closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a> (assigned to peterhuene):</p>
<blockquote>
<p>Since the WASI spec is still volatile it makes sense to support any module name to be able to let the caller control which functions to bind.</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212" title="https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212">https://github.com/bytecodealliance/wasmtime/blob/78b32e2527e1d857638f284153c308879828a5cd/crates/c-api/src/wasi.rs#L205-L212</a></p>
<p><code>wasi_instance_bind_import</code> currently only accepts "wasi_snapshot_preview1". But for my testing I need "wasi_unstable". If wasmtime at some point only accepts a specific module - we should have a way to tell which modules are accepted by wasmtime wasi implementation. But hopefully all modules will be backwards compatible per API function. If that isn't true, we would maybe need something like glibc version per function.</p>
<p>Alternatively we could have a wasi_instance_bind_import API which ignores the module - and lets it be up to the caller fully. wasi_instance_bind_import would still check function type and name.</p>
</blockquote>



<a name="191938393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231221%20Can%20we%20add%20new%20wasi_instance_bind_.../near/191938393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231221.20Can.20we.20add.20new.20wasi_instance_bind_.2E.2E.2E.html#191938393">(Mar 26 2020 at 19:40)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-604644220" title="https://github.com/bytecodealliance/wasmtime/issues/1221#issuecomment-604644220">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1221" title="https://github.com/bytecodealliance/wasmtime/issues/1221">Issue #1221</a>:</p>
<blockquote>
<p>So <code>wasi_instance_new</code> now takes a parameter for requesting a supported WASI module name and will return a trap if the module isn't supported.  Currently Wasmtime supports <code>wasm_unstable</code> and <code>wasi_snapshot_preview1</code> for WASI module names.</p>
<p>The .NET API has also been radically changed to make it easier to instantiate modules in a customized host environment.</p>
<p>Now you can configure a host to offer both versions of WASI to its modules, if desired:</p>
<div class="codehilite"><pre><span></span><span class="kt">var</span> <span class="n">host</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Wasmtime</span><span class="p">.</span><span class="n">Host</span><span class="p">();</span>

<span class="n">host</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">(</span><span class="s">&quot;wasi_unstable&quot;</span><span class="p">);</span>
<span class="n">host</span><span class="p">.</span><span class="n">DefineWasi</span><span class="p">(</span><span class="s">&quot;wasi_snapshot_preview1&quot;</span><span class="p">);</span>

<span class="n">host</span><span class="p">.</span><span class="n">DefineFunction</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">module</span> <span class="p">=</span> <span class="n">host</span><span class="p">.</span><span class="n">LoadModule</span><span class="p">(</span><span class="s">&quot;example.wasm&quot;</span><span class="p">);</span>

<span class="kt">dynamic</span> <span class="n">instance</span> <span class="p">=</span> <span class="n">host</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">module</span><span class="p">);</span>

<span class="n">instance</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
</pre></div>


</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>