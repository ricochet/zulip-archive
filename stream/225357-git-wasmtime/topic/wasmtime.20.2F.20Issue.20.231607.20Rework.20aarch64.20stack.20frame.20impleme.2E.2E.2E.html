<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1607 Rework aarch64 stack frame impleme... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html">wasmtime / Issue #1607 Rework aarch64 stack frame impleme...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="195479812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195479812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195479812">(Apr 27 2020 at 21:51)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-620254754" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-620254754">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @bnjbvr</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:aarch64"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>bnjbvr: cranelift</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action" title="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="195535084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195535084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195535084">(Apr 28 2020 at 08:54)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-620473265" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-620473265">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>Will this still work if <code>alloca</code> is introduced in the future?</p>
</blockquote>



<a name="195733014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195733014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195733014">(Apr 29 2020 at 16:05)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621308556" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621308556">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>Thanks! Fixed the comment nits.</p>
</blockquote>



<a name="195736965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195736965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195736965">(Apr 29 2020 at 16:35)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621325301" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621325301">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>@bjorn3:</p>
<blockquote>
<p>Will this still work if alloca is introduced in the future?</p>
</blockquote>
<p>That's a good point; we'll need to do something else in this case. I'll have to look at what other compilers do on aarch64 -- perhaps they just accept the cost of negative offsets from <code>fp</code>, or perhaps they put the fixed <code>fp</code>/<code>lr</code> frame below the stackslots/clobbers since aarch64 allows that flexibility... for now, though, since we don't have <code>alloca</code>, I think I'll want to save this as a future improvement.</p>
</blockquote>



<a name="195738520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195738520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195738520">(Apr 29 2020 at 16:46)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621331712" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621331712">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<blockquote>
<p>for now, though, since we don't have alloca, I think I'll want to save this as a future improvement.</p>
</blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I just wanted to prevent any decisions that would make it much harder to support <code>alloca</code>.</p>
</blockquote>



<a name="195739307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195739307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195739307">(Apr 29 2020 at 16:54)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621335574" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-621335574">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>@bjorn3: yup, thanks for bringing it up, as it hadn't occurred to me! One solution (to record my thought for the future) might be to simply allocate a vreg as our "stackslot area base" and copy SP before we do any dynamic adjustments, and perhaps revert to this only if, on a scan, we see that an alloca is present.</p>
</blockquote>



<a name="195914634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/195914634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#195914634">(Apr 30 2020 at 23:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-622170909" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-622170909">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>Pushed a rebase over the recent file-split commit just now.</p>
</blockquote>



<a name="196346045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/196346045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#196346045">(May 05 2020 at 18:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-624226382" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-624226382">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>Thanks! Updated, PTAL.</p>
<blockquote>
<p>I think <code>lower_addr</code> may reuse the temporary spill registers as well, can you please take a look?</p>
</blockquote>
<p>Fixed (I assume you meant <code>load_addr</code>?) -- using <code>tmp2</code> now and added a comment to justify why it's safe.</p>
</blockquote>



<a name="196346351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231607%20Rework%20aarch64%20stack%20frame%20impleme.../near/196346351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231607.20Rework.20aarch64.20stack.20frame.20impleme.2E.2E.2E.html#196346351">(May 05 2020 at 18:26)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-624227626" title="https://github.com/bytecodealliance/wasmtime/pull/1607#issuecomment-624227626">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1607" title="https://github.com/bytecodealliance/wasmtime/pull/1607">Issue #1607</a>:</p>
<blockquote>
<p>And, I should note I built a SpiderMonkey JS shell with this commit vendored in, and all jit-tests pass; so I think the Baldrdash-related stuff is still correct.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>