<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4562 Allow multiple `_` definitions in ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234562.20Allow.20multiple.20.60_.60.20definitions.20in.20.2E.2E.2E.html">wasmtime / issue #4562 Allow multiple `_` definitions in ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="291393491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234562%20Allow%20multiple%20%60_%60%20definitions%20in%20.../near/291393491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234562.20Allow.20multiple.20.60_.60.20definitions.20in.20.2E.2E.2E.html#291393491">(Jul 29 2022 at 23:37)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/4562#issuecomment-1200034219">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4562">issue #4562</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:aarch64", "cranelift:area:x64", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="291599246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234562%20Allow%20multiple%20%60_%60%20definitions%20in%20.../near/291599246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234562.20Allow.20multiple.20.60_.60.20definitions.20in.20.2E.2E.2E.html#291599246">(Aug 01 2022 at 16:24)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4562#issuecomment-1201426350">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4562">issue #4562</a>:</p>
<blockquote>
<p>It might be better to implement full shadowing instead, which would resolve #3526.</p>
</blockquote>



<a name="291621510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234562%20Allow%20multiple%20%60_%60%20definitions%20in%20.../near/291621510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234562.20Allow.20multiple.20.60_.60.20definitions.20in.20.2E.2E.2E.html#291621510">(Aug 01 2022 at 19:25)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4562#issuecomment-1201619506">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4562">issue #4562</a>:</p>
<blockquote>
<p>@cfallin I went the route of implementing shadowing instead, as it seems like a more complete solution to the problem. To resolve the issue of restoring the previous bindings, I turned the <code>TypeEnv::sym_map</code> field into a vector of maps, ensuring that the vector is never empty. I'd be happy to replace the vector of maps with a more efficient implementation <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="291625804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234562%20Allow%20multiple%20%60_%60%20definitions%20in%20.../near/291625804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234562.20Allow.20multiple.20.60_.60.20definitions.20in.20.2E.2E.2E.html#291625804">(Aug 01 2022 at 20:01)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4562#issuecomment-1201652437">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4562">issue #4562</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for pushing further and doing full shadowing!</p>
<p>However I think there may be a simpler way to do this. I didn't expect the symbol-interning itself to become aware of nested scopes, and in fact that could (?) lead to unexpected behavior later if we remove a binding. Basically I had meant for that to be an interning layer so that we could use <code>Sym</code> indices everywhere as a substitute for string identifiers.</p>
<p>Instead I had expected <code>bindings</code> to handle the scope entry and exit. It was actually structured originally with the intent of supporting shadowing some day: it remains an ordered list of bindings (in order of introduction). We truncate away all bindings within the <code>let</code> after we process the <code>let</code>'s body. I suspect all we need to do is to remove the "am I shadowing another binding" check (line 1954 in the original <code>sema.rs</code>), and ensure that the search for a binding occurs as a reverse search from the end (I _believe_ it already might). Does that make sense?</p>
</blockquote>
<p>This makes sense, and is indeed a much simpler approach. The var lookup already searches backwards through the bindings, so this really might be as simple as removing the check for duplicate bindings.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>