<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3780 Add the instance allocation strategy ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html">wasmtime / PR #3780 Add the instance allocation strategy ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="271201910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271201910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271201910">(Feb 08 2022 at 22:37)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds support for generating configs with arbitrary instance<br>
allocation strategies.</p>
<p>With this, the pooling allocator will be fuzzed as part of the existing fuzz<br>
targets.</p>
</blockquote>



<a name="271201916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271201916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271201916">(Feb 08 2022 at 22:37)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a>.</p>



<a name="271203125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271203125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271203125">(Feb 08 2022 at 22:48)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-876738536">PR review</a>.</p>



<a name="271203622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271203622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271203622">(Feb 08 2022 at 22:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-876737367">PR review</a>.</p>



<a name="271203623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271203623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271203623">(Feb 08 2022 at 22:53)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-876737367">PR review</a>.</p>



<a name="271203625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271203625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271203625">(Feb 08 2022 at 22:53)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802123353">PR review comment</a>:</p>
<blockquote>
<p>MAX_TABLES here?</p>
<p>In general it seems maybe there should be a <code>MAX_*</code> constant for each kind of entity (functions, tables, memories, globals) and then imported_[entity] and [entity] both lie in that range -- or otherwise, maybe a comment why some limits have specific bounds and others are generic <code>MAXIMUM</code>?</p>
</blockquote>



<a name="271205022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271205022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271205022">(Feb 08 2022 at 23:05)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-876750814">PR review</a>.</p>



<a name="271205023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271205023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271205023">(Feb 08 2022 at 23:05)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802133436">PR review comment</a>:</p>
<blockquote>
<p>I'll make this more consistent.</p>
</blockquote>



<a name="271206280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271206280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271206280">(Feb 08 2022 at 23:16)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271206281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271206281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271206281">(Feb 08 2022 at 23:16)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-876758101">PR review</a>.</p>



<a name="271206283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271206283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271206283">(Feb 08 2022 at 23:16)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802139051">PR review comment</a>:</p>
<blockquote>
<p>I've added constants for each type to make it clearer.</p>
<p>Note that for limits like <code>functions</code>, it denotes the _defined_ function limit and not the total function limit, thus <code>imported_functions</code> isn't bound in the range <code>(0..=MAX_FUNCTIONS)</code>, for example.</p>
</blockquote>



<a name="271206414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271206414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271206414">(Feb 08 2022 at 23:17)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271228971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271228971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271228971">(Feb 09 2022 at 04:16)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271229000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271229000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271229000">(Feb 09 2022 at 04:17)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271229071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271229071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271229071">(Feb 09 2022 at 04:18)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a>.</p>



<a name="271229072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271229072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271229072">(Feb 09 2022 at 04:18)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a>.</p>



<a name="271229467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271229467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271229467">(Feb 09 2022 at 04:26)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds support for generating configs with arbitrary instance<br>
allocation strategies.</p>
<p>With this, the pooling allocator will be fuzzed as part of the existing fuzz<br>
targets and also with the new <code>pooling</code> fuzz target.</p>
</blockquote>



<a name="271296218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271296218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271296218">(Feb 09 2022 at 15:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-877648519">PR review</a>.</p>



<a name="271296219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271296219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271296219">(Feb 09 2022 at 15:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-877648519">PR review</a>.</p>



<a name="271296220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271296220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271296220">(Feb 09 2022 at 15:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802794409">PR review comment</a>:</p>
<blockquote>
<p>Was this necessary to split out the memory configuration like this? I figured we'd just ignore irrelevant settings with the pooling allocator but I wouldn't be surprised if sanity checks prevented some of this</p>
</blockquote>



<a name="271296221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271296221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271296221">(Feb 09 2022 at 15:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802797307">PR review comment</a>:</p>
<blockquote>
<p>I think that we should be able to relatively easily control the limits on the wasm-smith-generated-module, could one of the methods on <code>Config</code> automatically apply the configuration of the pooling allocator to the wasm-smith module limits perhaps? </p>
<p>(that'd avoid the need to duplicate this error handling below as well)</p>
</blockquote>



<a name="271296222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271296222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271296222">(Feb 09 2022 at 15:38)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802798003">PR review comment</a>:</p>
<blockquote>
<p>I would naively expect that fuzzing here with the on-demand allocator would be fine, so could this be removed to naturally fuzz with both given the config generated above?</p>
</blockquote>



<a name="271319169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271319169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271319169">(Feb 09 2022 at 17:50)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-877844956">PR review</a>.</p>



<a name="271319174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271319174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271319174">(Feb 09 2022 at 17:50)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r802936595">PR review comment</a>:</p>
<blockquote>
<p>The pooling allocator does check if <code>memory_pages</code> in the configured module limit exceeds the static memory bound and will fail the creation of the engine when that is the case.</p>
<p>I can make this less verbose, at least, by only setting <code>static_memory_maximum_size</code> in either branch based on the strategy being on-demand.</p>
</blockquote>



<a name="271333381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271333381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271333381">(Feb 09 2022 at 19:24)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-877951890">PR review</a>.</p>



<a name="271333382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271333382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271333382">(Feb 09 2022 at 19:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803013941">PR review comment</a>:</p>
<blockquote>
<p>Would it be possible to massage the configuration settings to be correct for cases like that? Such as tweaking the instantiation limit bounds or these arguments to be the minimum of each one or something like that. </p>
</blockquote>



<a name="271360228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271360228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271360228">(Feb 09 2022 at 22:57)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-878150543">PR review</a>.</p>



<a name="271360229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271360229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271360229">(Feb 09 2022 at 22:57)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803160125">PR review comment</a>:</p>
<blockquote>
<p>So we can't completely avoid this check as currently there's no way to constrain table type minimums in <code>wasm-smith</code> like we can with memory types. The pooling instance allocator may place limits on the maximum elements in a table and will error if a table type has a minimum that exceeds the allocator's limit.</p>
<p>I have some changes that makes hitting this error much less likely where we constraint the generated module based on the arbitrary pooling limits (if arbitrarily configured to use pooling), but we'll need to update <code>wasm-smith</code> to fully remove these two checks, I believe.</p>
</blockquote>



<a name="271361072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271361072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271361072">(Feb 09 2022 at 23:04)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803160125">PR review comment</a>.</p>



<a name="271361123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271361123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271361123">(Feb 09 2022 at 23:05)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803160125">PR review comment</a>.</p>



<a name="271363686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271363686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271363686">(Feb 09 2022 at 23:31)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803177680">PR review comment</a>:</p>
<blockquote>
<p>This will be removed and we'll fuzz on any arbitrary strategy (the target has subsequently been renamed to <code>instantiate-many</code>).</p>
</blockquote>



<a name="271363687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271363687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271363687">(Feb 09 2022 at 23:31)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-878172956">PR review</a>.</p>



<a name="271365243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271365243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271365243">(Feb 09 2022 at 23:48)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds support for generating configs with arbitrary instance<br>
allocation strategies.</p>
<p>With this, the pooling allocator will be fuzzed as part of the existing fuzz<br>
targets and also with the new <code>instantiate-many</code> fuzz target.</p>
</blockquote>



<a name="271386131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271386131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271386131">(Feb 10 2022 at 04:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271386177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271386177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271386177">(Feb 10 2022 at 04:54)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a>.</p>



<a name="271392466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271392466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271392466">(Feb 10 2022 at 06:57)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-878401323">PR review</a>.</p>



<a name="271395984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271395984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271395984">(Feb 10 2022 at 07:38)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271445119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271445119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271445119">(Feb 10 2022 at 15:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-878991766">PR review</a>.</p>



<a name="271445120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271445120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271445120">(Feb 10 2022 at 15:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803781936">PR review comment</a>:</p>
<blockquote>
<p>I'm a little worried about this change in that above there's a <code>.min(0x1000..)</code> to I think make the cap still the same but randomly choosing a 64-bit number seems like it'll almost always use the 0x1000.. limit instead of something smaller? Overall I'm wondering if this 64-bit space heavily weights the fuzzing to always choose the same result and whether that has an affect.</p>
</blockquote>



<a name="271445148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271445148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271445148">(Feb 10 2022 at 15:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-878991940">PR review</a>.</p>



<a name="271473243"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271473243" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271473243">(Feb 10 2022 at 18:25)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-879267647">PR review</a>.</p>



<a name="271473244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271473244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271473244">(Feb 10 2022 at 18:25)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r803982181">PR review comment</a>:</p>
<blockquote>
<p>That's an excellent point. Let me fix that.</p>
</blockquote>



<a name="271478324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271478324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271478324">(Feb 10 2022 at 19:02)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271478363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271478363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271478363">(Feb 10 2022 at 19:02)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#pullrequestreview-879315761">PR review</a>.</p>



<a name="271478367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271478367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271478367">(Feb 10 2022 at 19:02)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/3780#discussion_r804017288">PR review comment</a>:</p>
<blockquote>
<p>Fixed with latest push.</p>
</blockquote>



<a name="271479410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271479410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271479410">(Feb 10 2022 at 19:10)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a> from <code>fuzz-pooling-allocator</code> to <code>main</code>.</p>



<a name="271485479"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233780%20Add%20the%20instance%20allocation%20strategy%20.../near/271485479" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233780.20Add.20the.20instance.20allocation.20strategy.20.2E.2E.2E.html#271485479">(Feb 10 2022 at 19:55)</a>:</h4>
<p>peterhuene merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3780">PR #3780</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>