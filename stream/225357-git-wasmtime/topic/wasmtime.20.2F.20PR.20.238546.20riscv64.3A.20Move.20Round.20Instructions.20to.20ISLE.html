<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8546 riscv64: Move Round Instructions to ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html">wasmtime / PR #8546 riscv64: Move Round Instructions to ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="436945115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436945115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436945115">(May 03 2024 at 19:20)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>.</p>



<a name="436945117"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436945117" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436945117">(May 03 2024 at 19:20)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>.</p>



<a name="436945118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436945118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436945118">(May 03 2024 at 19:20)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a> from <code>afonso360:riscv-isle-round</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR is a small cleanup to our lowerings for rounding instructions (<code>ceil</code>/<code>floor</code>/<code>trunc</code>/<code>nearest</code>). It moves the generated code from a single pseudo-instruction into an ISLE lowering. </p>
<p>The rounding lowering remains mostly the same, except it removes an extraneous <code>fadd</code> that we ended up not really needing. It also improves the constant codegen since we have a more advanced algorithm in ISLE that does better pattern matching.</p>
<p>This PR also moves the ISA tests to separate files, but that is done on the first commit, so looking at the second commit individually gives the actual changes to the assembly output.</p>
</blockquote>



<a name="436945562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436945562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436945562">(May 03 2024 at 19:24)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR is a small cleanup to our lowerings for rounding instructions (<code>ceil</code>/<code>floor</code>/<code>trunc</code>/<code>nearest</code>). It moves the generated code from a single pseudo-instruction into an ISLE lowering. </p>
<p>The rounding lowering remains mostly the same, except it removes an extraneous <code>fadd</code> that we ended up not really needing. It also improves the constant codegen since we have a more advanced algorithm in ISLE that does better pattern matching.</p>
<p>This PR also moves the ISA tests to separate files, but that is done on the first commit, so looking at the second commit individually gives the actual changes to the assembly output.</p>
<p>Also, FloatRound was the only instruction in the <code>riscv64_worst_case_instruction_size</code> but the <code>worst_case_size</code> was way larger than what was actually needed for that instruction. I suspect there is some other instruction that may need that much size. I added a few cases, but none ended up at the 124 bytes that it is currently set to. Something to track down later...</p>
</blockquote>



<a name="436945619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436945619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436945619">(May 03 2024 at 19:24)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR is a small cleanup to our lowerings for rounding instructions (<code>ceil</code>/<code>floor</code>/<code>trunc</code>/<code>nearest</code>). It moves the generated code from a single pseudo-instruction into an ISLE lowering. </p>
<p>The rounding lowering remains mostly the same, except it removes an extraneous <code>fadd</code> that we ended up not really needing. It also improves the constant codegen since we have a more advanced algorithm in ISLE that does better pattern matching.</p>
<p>This PR also moves the ISA tests to separate files, but that is done on the first commit, so looking at the second commit individually gives the actual changes to the assembly output.</p>
<p>Also, FloatRound was the only instruction in the <code>riscv64_worst_case_instruction_size</code> test but the <code>worst_case_size</code> was way larger than what was actually needed for that instruction. I suspect there is some other instruction that may need that much size. I added a few cases, but none ended up at the 124 bytes that it is currently set to. Something to track down later...</p>
</blockquote>



<a name="436948496"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/436948496" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#436948496">(May 03 2024 at 19:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8546#pullrequestreview-2038896066">PR review</a>:</p>
<blockquote>
<p>Very nice refactoring <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="437009077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/437009077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#437009077">(May 04 2024 at 10:02)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>.</p>



<a name="437009999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/437009999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#437009999">(May 04 2024 at 10:16)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>.</p>



<a name="437036706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238546%20riscv64%3A%20Move%20Round%20Instructions%20to%20ISLE/near/437036706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238546.20riscv64.3A.20Move.20Round.20Instructions.20to.20ISLE.html#437036706">(May 04 2024 at 17:23)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8546">PR #8546</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>