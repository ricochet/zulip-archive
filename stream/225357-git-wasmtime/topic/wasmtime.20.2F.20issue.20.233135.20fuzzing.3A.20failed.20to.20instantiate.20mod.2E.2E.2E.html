<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3135 fuzzing: failed to instantiate mod... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html">wasmtime / issue #3135 fuzzing: failed to instantiate mod...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="247936853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247936853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247936853">(Aug 02 2021 at 16:05)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span> <span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">eqz</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w">  </span><span class="p">;;</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="n">unreachable</span><span class="w"></span>
<span class="w">        </span><span class="n">end</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">sub</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1000</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"</span><span class="se">\0</span><span class="s">e"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">249</span><span class="p">)</span><span class="w"> </span><span class="s">""</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>Configuration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">opt_level</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">debug_info</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">canonicalize_nans</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">interruptable</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">consume_fuel</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_maximum_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">dynamic_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">guard_before_linear_memory</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Checkout the branch from #3124</li>
<li>Either run to failure (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run</code>) or use the following crash artifact (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b</code>):<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/6918145/crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt">crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt</a></li>
</ul>
<p>I have verified that running Wasmtime directly on this module (<code>cargo +nightly run -- run -g scratch.wat</code>) does not fail so I think the bug is related to how things are configured in the fuzzing oracles.</p>
<h3>Expected Results</h3>
<p>Instantiate the module while fuzzing.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">Wasmtime</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">module</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">oracles</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">820</span>:<span class="mi">10</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="o">==</span><span class="mi">1092110</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">deadly</span><span class="w"> </span><span class="n">signal</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x564048087231</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__sanitizer_print_stack_trace</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_stack</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">86</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56404ca2b3f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">PrintStackTrace</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff83f8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x56404ca4d8b5</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">CrashCallback</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601a8b5</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x7f4a185bca1f</span><span class="w">  </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libpthread</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span><span class="mh">0x13a1f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x7f4a182ca2a1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x3d2a1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x7f4a182b38a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x268a3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56404cac60f6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h41ede9a5caf8d829</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">255</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x564048000a45</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">h1cff6c22924aaee7</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1957</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x56404ca1b7bb</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h9890a57d769a69b1</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe87bb</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x56404cab94f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h3039e236b6ca482c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x56404cab8fb6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h884fbab544ffd91c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">519</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x56404cab54ab</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">hdaf2e18ba3d91210</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x56404cab8f18</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x564048003180</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hcf5f6d96e1dd7099</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x564048003272</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">he898b02f57993c42</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1599</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5640484fb300</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">run_in_wasmtime</span>::<span class="n">h575888b49fa4ed1e</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac8300</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5640484f7de6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">differential_spec_execution</span>::<span class="n">h74b73ab98332e7b0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac4de6</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x564048298e2e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1865e2e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x56404ca1b8f0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe88f0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x56404ca1b07f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe807f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x56404ca4ddf1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601adf1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x56404ca52969</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">RunOne</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">InputInfo</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601f969</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x56404ca537e8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">MutateAndTestOne</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x60207e8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">23</span><span class="w"> </span><span class="mh">0x56404ca55b77</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">Loop</span><span class="p">(</span><span class="n">std</span>::<span class="n">vector</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">fuzzer_allocator</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x6022b77</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">24</span><span class="w"> </span><span class="mh">0x56404ca297f9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff67f9</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">25</span><span class="w"> </span><span class="mh">0x564048003992</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0992</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">26</span><span class="w"> </span><span class="mh">0x7f4a182b4b74</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x27b74</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">27</span><span class="w"> </span><span class="mh">0x564048003b3d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0b3d</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <a href="https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing">https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing</a></p>
<p>Operating system: Linux</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>This bug is for a yet-to-be-merged fuzzing oracle (#3124) so it may not apply to released Wasmtime or HEAD. I felt it was better to report it, though, and see if anyone can shed light on what is going on in this failure in case it actually does apply to more than just the fuzzing oracle.<br>
</p>
</blockquote>



<a name="247936854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247936854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247936854">(Aug 02 2021 at 16:05)</a>:</h4>
<p>abrown labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span> <span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">eqz</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w">  </span><span class="p">;;</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="n">unreachable</span><span class="w"></span>
<span class="w">        </span><span class="n">end</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">sub</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1000</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"</span><span class="se">\0</span><span class="s">e"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">249</span><span class="p">)</span><span class="w"> </span><span class="s">""</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>Configuration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">opt_level</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">debug_info</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">canonicalize_nans</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">interruptable</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">consume_fuel</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_maximum_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">dynamic_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">guard_before_linear_memory</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Checkout the branch from #3124</li>
<li>Either run to failure (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run</code>) or use the following crash artifact (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b</code>):<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/6918145/crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt">crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt</a></li>
</ul>
<p>I have verified that running Wasmtime directly on this module (<code>cargo +nightly run -- run -g scratch.wat</code>) does not fail so I think the bug is related to how things are configured in the fuzzing oracles.</p>
<h3>Expected Results</h3>
<p>Instantiate the module while fuzzing.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">Wasmtime</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">module</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">oracles</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">820</span>:<span class="mi">10</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="o">==</span><span class="mi">1092110</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">deadly</span><span class="w"> </span><span class="n">signal</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x564048087231</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__sanitizer_print_stack_trace</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_stack</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">86</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56404ca2b3f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">PrintStackTrace</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff83f8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x56404ca4d8b5</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">CrashCallback</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601a8b5</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x7f4a185bca1f</span><span class="w">  </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libpthread</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span><span class="mh">0x13a1f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x7f4a182ca2a1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x3d2a1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x7f4a182b38a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x268a3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56404cac60f6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h41ede9a5caf8d829</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">255</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x564048000a45</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">h1cff6c22924aaee7</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1957</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x56404ca1b7bb</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h9890a57d769a69b1</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe87bb</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x56404cab94f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h3039e236b6ca482c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x56404cab8fb6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h884fbab544ffd91c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">519</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x56404cab54ab</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">hdaf2e18ba3d91210</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x56404cab8f18</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x564048003180</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hcf5f6d96e1dd7099</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x564048003272</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">he898b02f57993c42</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1599</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5640484fb300</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">run_in_wasmtime</span>::<span class="n">h575888b49fa4ed1e</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac8300</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5640484f7de6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">differential_spec_execution</span>::<span class="n">h74b73ab98332e7b0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac4de6</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x564048298e2e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1865e2e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x56404ca1b8f0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe88f0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x56404ca1b07f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe807f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x56404ca4ddf1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601adf1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x56404ca52969</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">RunOne</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">InputInfo</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601f969</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x56404ca537e8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">MutateAndTestOne</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x60207e8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">23</span><span class="w"> </span><span class="mh">0x56404ca55b77</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">Loop</span><span class="p">(</span><span class="n">std</span>::<span class="n">vector</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">fuzzer_allocator</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x6022b77</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">24</span><span class="w"> </span><span class="mh">0x56404ca297f9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff67f9</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">25</span><span class="w"> </span><span class="mh">0x564048003992</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0992</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">26</span><span class="w"> </span><span class="mh">0x7f4a182b4b74</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x27b74</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">27</span><span class="w"> </span><span class="mh">0x564048003b3d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0b3d</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <a href="https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing">https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing</a></p>
<p>Operating system: Linux</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>This bug is for a yet-to-be-merged fuzzing oracle (#3124) so it may not apply to released Wasmtime or HEAD. I felt it was better to report it, though, and see if anyone can shed light on what is going on in this failure in case it actually does apply to more than just the fuzzing oracle.<br>
</p>
</blockquote>



<a name="247937640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247937640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247937640">(Aug 02 2021 at 16:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891153222">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>Looking at that module the "faulty" bit appears to be:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(module
      (memory (;0;) 0 1)
      (data (;0;) (i32.const 249) ""))
</code></pre></div>
<p>where a data segment, which is empty, is being written to memory where memory has size 0 at the beginning. I instantiated this locally with <code>wasmtime foo.wat</code> and it gave a trap (as expected).</p>
<p>Double-checking the spec <a href="https://webassembly.github.io/spec/core/exec/modules.html#instantiation">instantiation</a> delegates data segment initialization to <code>memory.init</code> which is <a href="https://webassembly.github.io/spec/core/exec/instructions.html#xref-syntax-instructions-syntax-instr-memory-mathsf-memory-init-x">specified to still trap even with zero-length copies</a>, so I think Wasmtime has the right behavior here?</p>
<p>Is this something that the spec interpreter doesn't trap on but Wasmtime traps on?</p>
</blockquote>



<a name="247937800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247937800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247937800">(Aug 02 2021 at 16:17)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891154784">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>er disregard all that, I reread and things make more sense now</p>
</blockquote>



<a name="247938353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247938353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247938353">(Aug 02 2021 at 16:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891158819">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>er sorry for the spam, I'm actually extra confused now. On your branch the oracle is <a href="https://github.com/abrown/wasmtime/blob/ec21ece9fab3b9d6869b6ee6042a7601b58ef2c2/crates/fuzzing/src/oracles.rs#L819-L820">configured to panic</a> if instantiation fails, but instantiation is expected to fail here, so I think that's a bug in the oracle where it should allow instantiation to fail and then assert that the spec interpreter also fails instantiation.</p>
<p>You then also say, though, that <code>cargo +nightly run -- run -g scratch.wat</code> does not fail, but testing locally myself shows that it does indeed fail instantiation. Are you sure that <code>scratch.wat</code> is the right file? (the one in this issue?)</p>
</blockquote>



<a name="247939791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247939791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247939791">(Aug 02 2021 at 16:37)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891168404">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>Ok, yeah, this makes more sense now: indeed I copied in the wrong thing to <code>scratch.wat</code> and when I do copy the right thing I see the expected failure: <code>wasm trap: out of bounds memory access</code>. </p>
<p>So this snippet should indeed fail but not fail with a panic, right? I'll make it a regular <code>Result</code> error instead. What is interesting here is that the instantiation code I use is the same as that of the <code>differential_wasmi</code> oracle (<a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/fuzzing/src/oracles.rs#L635-L638">https://github.com/bytecodealliance/wasmtime/blob/main/crates/fuzzing/src/oracles.rs#L635-L638</a>) so I'm surprised that we don't see a similar crash there? Or do we not run that fuzz target on oss-fuzz?</p>
</blockquote>



<a name="247939972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247939972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247939972">(Aug 02 2021 at 16:40)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891169891">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>And actually thinking about it more, it seems like there should be some way to distinguish between "we failed instantiation because something broke in Wasmtime" and "we failed instantiation because the input WebAssembly is invalid," right?</p>
</blockquote>



<a name="247940779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247940779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247940779">(Aug 02 2021 at 16:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891174531">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>I believe the target is run on oss-fuzz, and I think the failure to instantiate is handled <a href="https://github.com/bytecodealliance/wasmtime/blob/87fefd8a21e41e0f096257ababd41772e31f5854/crates/fuzzing/src/oracles.rs#L617-L618">here</a> where we instantiate with wasmi first and if that fails we don't even hit wasmtime.</p>
<p>Ideally, though, for the spec interpreter we'd separate the instantiate/invoke steps to ensure that wasmtime has the same behavior.</p>
</blockquote>



<a name="247943569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247943569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247943569">(Aug 02 2021 at 17:08)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/3135#issuecomment-891188518">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<p>Ok, sounds like this is resolved... thanks!</p>
</blockquote>



<a name="247943572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233135%20fuzzing%3A%20failed%20to%20instantiate%20mod.../near/247943572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233135.20fuzzing.3A.20failed.20to.20instantiate.20mod.2E.2E.2E.html#247943572">(Aug 02 2021 at 17:08)</a>:</h4>
<p>abrown closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3135">issue #3135</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k">type</span> <span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span> <span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">eqz</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w">  </span><span class="p">;;</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="n">unreachable</span><span class="w"></span>
<span class="w">        </span><span class="n">end</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">get</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="kt">i32</span><span class="p">.</span><span class="n">sub</span><span class="w"></span>
<span class="w">        </span><span class="n">global</span><span class="p">.</span><span class="n">set</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">global</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1000</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"</span><span class="se">\0</span><span class="s">e"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">249</span><span class="p">)</span><span class="w"> </span><span class="s">""</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>Configuration:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">opt_level</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">debug_info</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">canonicalize_nans</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">interruptable</span>: <span class="nc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">consume_fuel</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_maximum_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">static_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">dynamic_memory_guard_size</span>: <span class="nb">None</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">guard_before_linear_memory</span>: <span class="nc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Checkout the branch from #3124</li>
<li>Either run to failure (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run</code>) or use the following crash artifact (<code>RUST_LOG=wasmtime_fuzzing=debug cargo +nightly fuzz run crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b</code>):<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/6918145/crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt">crash-7917bec186800932a70ad9d9a8c49a6c8d266a5b.txt</a></li>
</ul>
<p>I have verified that running Wasmtime directly on this module (<code>cargo +nightly run -- run -g scratch.wat</code>) does not fail so I think the bug is related to how things are configured in the fuzzing oracles.</p>
<h3>Expected Results</h3>
<p>Instantiate the module while fuzzing.</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">Wasmtime</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">module</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">access</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">fuzzing</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">oracles</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">820</span>:<span class="mi">10</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="o">==</span><span class="mi">1092110</span><span class="o">==</span><span class="w"> </span><span class="n">ERROR</span>: <span class="nc">libFuzzer</span>: <span class="nc">deadly</span><span class="w"> </span><span class="n">signal</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x564048087231</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__sanitizer_print_stack_trace</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_stack</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">86</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x56404ca2b3f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">PrintStackTrace</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff83f8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x56404ca4d8b5</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">CrashCallback</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601a8b5</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x7f4a185bca1f</span><span class="w">  </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libpthread</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span><span class="mh">0x13a1f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x7f4a182ca2a1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x3d2a1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x7f4a182b38a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x268a3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x56404cac60f6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h41ede9a5caf8d829</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">255</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x564048000a45</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">h1cff6c22924aaee7</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1957</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x56404ca1b7bb</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h9890a57d769a69b1</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe87bb</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x56404cab94f8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h3039e236b6ca482c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x56404cab8fb6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h884fbab544ffd91c</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">519</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x56404cab54ab</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">hdaf2e18ba3d91210</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x56404cab8f18</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x564048003180</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hcf5f6d96e1dd7099</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x564048003272</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">he898b02f57993c42</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">b41936b92cd8463020207cb2f62a4247942ef2e4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1599</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5640484fb300</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">run_in_wasmtime</span>::<span class="n">h575888b49fa4ed1e</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac8300</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5640484f7de6</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">differential_spec_execution</span>::<span class="n">h74b73ab98332e7b0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1ac4de6</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x564048298e2e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1865e2e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x56404ca1b8f0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe88f0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x56404ca1b07f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5fe807f</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x56404ca4ddf1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601adf1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x56404ca52969</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">RunOne</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">InputInfo</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x601f969</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x56404ca537e8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">MutateAndTestOne</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x60207e8</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">23</span><span class="w"> </span><span class="mh">0x56404ca55b77</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">Loop</span><span class="p">(</span><span class="n">std</span>::<span class="n">vector</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">fuzzer_allocator</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x6022b77</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">24</span><span class="w"> </span><span class="mh">0x56404ca297f9</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5ff67f9</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">25</span><span class="w"> </span><span class="mh">0x564048003992</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0992</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">26</span><span class="w"> </span><span class="mh">0x7f4a182b4b74</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x27b74</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">27</span><span class="w"> </span><span class="mh">0x564048003b3d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x15d0b3d</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: <a href="https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing">https://github.com/abrown/wasmtime/tree/wasm-spec-fuzzing</a></p>
<p>Operating system: Linux</p>
<p>Architecture: x64</p>
<h3>Extra Info</h3>
<p>This bug is for a yet-to-be-merged fuzzing oracle (#3124) so it may not apply to released Wasmtime or HEAD. I felt it was better to report it, though, and see if anyone can shed light on what is going on in this failure in case it actually does apply to more than just the fuzzing oracle.<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>