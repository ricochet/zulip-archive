<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4313 [Cranelift] Implement scalar min/m... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html">wasmtime / issue #4313 [Cranelift] Implement scalar min/m...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="287332217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/287332217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#287332217">(Jun 24 2022 at 13:43)</a>:</h4>
<p>sparker-arm opened <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>The CLIF operators: umin, smin, imin and imax all support scalars, as well as vectors, but AArch64 currently only implements support for vectors. The backend will panic given the scalar versions.</p>
</blockquote>



<a name="287332218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/287332218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#287332218">(Jun 24 2022 at 13:43)</a>:</h4>
<p>sparker-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>The CLIF operators: umin, smin, imin and imax all support scalars, as well as vectors, but AArch64 currently only implements support for vectors. The backend will panic given the scalar versions.</p>
</blockquote>



<a name="287341976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/287341976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#287341976">(Jun 24 2022 at 14:59)</a>:</h4>
<p>sparker-arm closed <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>The CLIF operators: umin, smin, imin and imax all support scalars, as well as vectors, but AArch64 currently only implements support for vectors. The backend will panic given the scalar versions.</p>
</blockquote>



<a name="305818334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/305818334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#305818334">(Oct 24 2022 at 13:25)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/4313#issuecomment-1289031621">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>Hey, I just hit this with the fuzzer, Is there a reason as to why this is not planned?</p>
</blockquote>



<a name="305819436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/305819436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#305819436">(Oct 24 2022 at 13:30)</a>:</h4>
<p>sparker-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/4313#issuecomment-1289040118">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>Oh... I don't remember closing this! Considering it happened on the same day, I'm assuming I did so by accident.</p>
</blockquote>



<a name="305819438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/305819438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#305819438">(Oct 24 2022 at 13:30)</a>:</h4>
<p>sparker-arm reopened <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>The CLIF operators: umin, smin, imin and imax all support scalars, as well as vectors, but AArch64 currently only implements support for vectors. The backend will panic given the scalar versions.</p>
</blockquote>



<a name="305822952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/305822952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#305822952">(Oct 24 2022 at 13:46)</a>:</h4>
<p>sparker-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/4313#issuecomment-1289061816">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>Another realistic option, is that is a duplicate of another issue and I've just failed to link it.</p>
</blockquote>



<a name="338637679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/338637679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#338637679">(Feb 28 2023 at 16:48)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/4313#issuecomment-1448512303">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>Fuzzgen just rediscovered this issue again on this CLIF input:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">compile</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">aarch64</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i128</span> <span class="nc">system_v</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span>:
    <span class="nc">v83</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v83</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v83</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v80</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v80</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v80</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>
<span class="w">    </span><span class="n">v84</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v84</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v84</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v86</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v86</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v86</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">brif</span><span class="w"> </span><span class="n">v4</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">block1</span><span class="w"> </span><span class="n">cold</span>:
    <span class="nc">brif</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v58</span><span class="p">),</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">block2</span><span class="p">(</span><span class="n">v18</span>: <span class="kt">i128</span><span class="p">)</span><span class="w"> </span><span class="n">cold</span>:
    <span class="nc">return</span><span class="w"> </span><span class="n">v62</span>
<span class="p">}</span>
</code></pre></div>
<p>This is due to the rules added in #5546</p>
</blockquote>



<a name="338641835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234313%20%5BCranelift%5D%20Implement%20scalar%20min/m.../near/338641835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234313.20.5BCranelift.5D.20Implement.20scalar.20min.2Fm.2E.2E.2E.html#338641835">(Feb 28 2023 at 17:04)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/4313#issuecomment-1448512303">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4313">issue #4313</a>:</p>
<blockquote>
<p>Fuzzgen just rediscovered this issue (for i128's) again on this CLIF input:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">compile</span>
<span class="n">set</span><span class="w"> </span><span class="n">opt_level</span><span class="o">=</span><span class="n">speed_and_size</span>
<span class="n">target</span><span class="w"> </span><span class="n">aarch64</span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">a</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i128</span> <span class="nc">system_v</span><span class="w"> </span><span class="p">{</span>
<span class="n">block0</span>:
    <span class="nc">v83</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v83</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v83</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v80</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v80</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v80</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v40</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">slt</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span>
<span class="w">    </span><span class="n">v58</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">v40</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span>
<span class="w">    </span><span class="n">v84</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v84</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v84</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v86</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">v62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uextend</span><span class="p">.</span><span class="kt">i128</span><span class="w"> </span><span class="n">v86</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v86</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">brif</span><span class="w"> </span><span class="n">v4</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">block1</span><span class="w"> </span><span class="n">cold</span>:
    <span class="nc">brif</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v6</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v58</span><span class="p">),</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v17</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">block2</span><span class="p">(</span><span class="n">v18</span>: <span class="kt">i128</span><span class="p">)</span><span class="w"> </span><span class="n">cold</span>:
    <span class="nc">return</span><span class="w"> </span><span class="n">v62</span>
<span class="p">}</span>
</code></pre></div>
<p>This is due to the rules added in #5546</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>