<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3124 Fuzz Wasmtime against the official... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html">wasmtime / issue #3124 Fuzz Wasmtime against the official...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="247517234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/247517234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#247517234">(Jul 28 2021 at 21:03)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-888619840">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="247527949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/247527949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#247527949">(Jul 28 2021 at 23:03)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-888675482">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>All, thanks for the comments. I've fixed most of the small stuff but I've left open the ones that I still need help on (how and when to build <code>wasm-spec-interpreter</code>, e.g.).</p>
</blockquote>



<a name="248294829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/248294829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#248294829">(Aug 03 2021 at 23:53)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-892242786">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>I rebased this on <code>main</code> and condensed it to five commits. I think this is almost good for a final review except for the issue I raised in <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#discussion_r678631805">https://github.com/bytecodealliance/wasmtime/pull/3124#discussion_r678631805</a> about unsafe behavior. Something is not right there and we should wait to merge this until it is resolved. I can make the fuzzer crash by running <code>cargo +nightly fuzz run differential_spec</code> locally:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">2512589415</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">699235</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">699235</span><span class="w"> </span><span class="p">[</span><span class="mh">0x5557756ba9da</span><span class="p">,</span><span class="w"> </span><span class="mh">0x55577576553d</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">699235</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">699235</span><span class="w"> </span><span class="p">[</span><span class="mh">0x555775765540</span><span class="p">,</span><span class="mh">0x555776210b70</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>:     <span class="mi">1425</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">corpus</span><span class="o">/</span><span class="n">differential_spec</span><span class="w"></span>
<span class="n">INFO</span>: <span class="o">-</span><span class="n">max_len</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">provided</span><span class="p">;</span><span class="w"> </span><span class="n">libFuzzer</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="n">bytes</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">seed</span><span class="w"> </span><span class="n">corpus</span>: <span class="nc">files</span>: <span class="mi">1425</span><span class="w"> </span><span class="n">min</span>: <span class="mi">1</span><span class="n">b</span><span class="w"> </span><span class="n">max</span>: <span class="mi">63</span><span class="n">b</span><span class="w"> </span><span class="n">total</span>: <span class="mi">52307</span><span class="n">b</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">72</span><span class="n">Mb</span><span class="w"></span>
#<span class="mi">1024</span><span class="w">   </span><span class="n">pulse</span><span class="w">  </span><span class="n">cov</span>: <span class="mi">16016</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">34393</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">418</span><span class="o">/</span><span class="mi">12380</span><span class="n">b</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">33</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">572</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">57.199999999999996</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
#<span class="mi">2048</span><span class="w">   </span><span class="n">pulse</span><span class="w">  </span><span class="n">cov</span>: <span class="mi">17686</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">41583</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">838</span><span class="o">/</span><span class="mi">28</span><span class="n">Kb</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">28</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">992</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">49.6</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>

<span class="p">[</span><span class="o">..</span><span class="p">.</span><span class="n">time</span><span class="w"> </span><span class="n">passes</span><span class="p">]</span><span class="w"></span>

#<span class="mi">3227</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18157</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47066</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1060</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">35</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">47</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CrossOver</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3268</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18157</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47074</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1061</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">35</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">48</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CrossOver</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3309</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18158</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47076</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1062</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">36</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">64</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3346</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18158</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47077</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1063</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">36</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">38</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">ChangeByte</span><span class="o">-</span><span class="n">InsertByte</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3397</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18158</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47079</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1064</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">37</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">36</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">ChangeASCIIInt</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3445</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18158</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47108</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1065</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">37</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">41</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">3</span><span class="w"> </span><span class="n">ChangeASCIIInt</span><span class="o">-</span><span class="n">InsertByte</span><span class="o">-</span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
#<span class="mi">3452</span><span class="w">   </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">18158</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">47113</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">1066</span><span class="o">/</span><span class="mi">39</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">68</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">37</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">429</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">58</span><span class="o">/</span><span class="mi">68</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">InsertRepeatedBytes</span><span class="o">-</span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
<span class="err">────────────────────────────────────────────────────────────────────────────────</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">Fuzz</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">signal</span>: <span class="mi">11</span><span class="w"></span>
</code></pre></div>
<p>No core dump is associated with this crash so it's hard to tell what is going on. I would appreciate someone else trying to run this, or even any suggestions on how to narrow down what is going wrong.</p>
</blockquote>



<a name="248540448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/248540448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#248540448">(Aug 05 2021 at 21:37)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-893825462">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>I tried again to get this working locally, and I believe my <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#pullrequestreview-717479608">previous build error</a> was due to an older <code>ocamlc</code> in PATH than what was needed here (according to The Internet). I figured out how to wrangle opam and such and I got things working with 4.12.0.</p>
<p>I got a different error than you did initially, and it's behavior I've never seen before. The fuzzer would just stop after a few hundreds runs and print that it detected a leak:</p>
<p>&lt;details&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">=================================================================</span><span class="w"></span>
<span class="o">==</span><span class="mi">44138</span><span class="o">==</span><span class="n">ERROR</span>: <span class="nc">LeakSanitizer</span>: <span class="nc">detected</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">leaks</span><span class="w"></span>

<span class="n">Direct</span><span class="w"> </span><span class="n">leak</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">object</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">from</span>:
    #<span class="mi">0</span><span class="w"> </span><span class="mh">0xaaaaac28c01c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">calloc</span><span class="w"> </span><span class="o">/</span><span class="n">checkout</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">asan</span><span class="o">/</span><span class="n">asan_malloc_linux</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">154</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0xffffb372e3f0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__cxa_thread_atexit_impl</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">pfQmxL</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.28</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">cxa_thread_atexit_impl</span><span class="p">.</span><span class="n">c</span>:<span class="mi">106</span>:<span class="mi">27</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0xaaaab0a73074</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">thread_local_dtor</span>::<span class="n">register_dtor</span>::<span class="n">h901a681bd6e662af</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">25</span><span class="n">b764849625cb090e8b81d12d2bb2295d073788</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">thread_local_dtor</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">36</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0xaaaaaea5e224</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="cp">$LT$T$GT$</span>::<span class="n">with</span>::<span class="n">h9f753ffa090280d6</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x3df3224</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0xaaaaaeb0f3dc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">raw</span>::<span class="n">replace</span>::<span class="n">h66677875f2db8192</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x3ea43dc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0xaaaaac512d60</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="n">h4626657d9defd11e</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x18a7d60</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0xaaaaac676480</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">invoke_wasm_and_catch_traps</span>::<span class="n">hd21244aafcd451e9</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1a0b480</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0xaaaaac679638</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call_impl</span>::<span class="n">hb80934ccfb58865f</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1a0e638</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0xaaaaac717d64</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">run_in_wasmtime</span>::<span class="n">hb0614ee0e39ac4f8</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1aacd64</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0xaaaaac715330</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">wasmtime_fuzzing</span>::<span class="n">oracles</span>::<span class="n">differential_spec_execution</span>::<span class="n">h71bb42d8a0672244</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1aaa330</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0xaaaaac4ad54c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x184254c</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0xaaaab09d2d50</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d67d50</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0xaaaab09d2428</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d67428</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0xaaaab09d7534</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d6c534</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0xaaaab09db6d4</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">RunOne</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">InputInfo</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d706d4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0xaaaab09dd4b0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">MutateAndTestOne</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d724b0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0xaaaab09e0bbc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">Loop</span><span class="p">(</span><span class="n">std</span>::<span class="n">vector</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="p">,</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">fuzzer_allocator</span><span class="o">&lt;</span><span class="n">fuzzer</span>::<span class="n">SizedFile</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d75bbc</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0xaaaab09f8974</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x5d8d974</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0xaaaaac202930</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1597930</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0xffffb3719d20</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">pfQmxL</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.28</span><span class="o">/</span><span class="n">csu</span><span class="o">/../</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">    </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0xaaaaac202a5c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">aarch64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">+</span><span class="mh">0x1597a5c</span><span class="p">)</span><span class="w"></span>

<span class="n">SUMMARY</span>: <span class="nc">AddressSanitizer</span>: <span class="mi">32</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">leaked</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">allocation</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">to</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="n">leaks</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">libFuzzer</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">detect_leaks</span><span class="o">=</span><span class="mf">0.</span><span class="w"></span>

<span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="p">;</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">unit</span>: <span class="mi">5080</span><span class="n">fd9c0bf811fe129fd0db4e1158b53926333c</span><span class="w"></span>
<span class="mh">0xa</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="w"></span>
<span class="err">\</span><span class="n">x0a</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xff</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="err">\</span><span class="n">xf4</span><span class="w"></span>
<span class="n">artifact_prefix</span><span class="o">='</span><span class="p">.</span><span class="o">/'</span><span class="p">;</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">leak</span><span class="o">-</span><span class="mi">8</span><span class="n">ce318eb459e74f96cb3214962087900c5ce2cea</span><span class="w"></span>
<span class="n">Base64</span>: <span class="nc">CvT09PT09PT09PT09PT09PT09PT0</span><span class="c1">//T09A==</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>This doesn't really have anything to do with Wasmtime, it's just standard registration of a TLS destructor... Also I'm not sure why the fuzzer would just halt after a bunch of runs and it feels like it spuriously detects the leak. Unsure!</p>
<p>Anyway after I passed <code>-detect_leaks=0</code> to the fuzzer it so far hasn't crashed yet. Right now I'm at</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">124756</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">256000</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">48.7328125</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
</code></pre></div>
<p>I'm also on an AArch64 machine, which may make a difference. @abrown what version of ocaml are you using? Perhaps you also need to update to 4.12.0 and they fixed something in the meantime?</p>
</blockquote>



<a name="248544836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/248544836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#248544836">(Aug 05 2021 at 22:20)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-893858902">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>Good to see you got things running! I also have have version 4.12.0 of <code>ocamlc</code> and <code>ocamlopt</code>.</p>
<p>Since this morning I tried to:</p>
<ul>
<li>run the fuzz target in LLDB but that eventually fails with <code>LeakSanitizer does not work under ptrace (strace, gdb, etc)</code></li>
<li>run the fuzz target in Valgrind but that immediately fails with <code>Shadow memory range interleaves with an existing memory mapping. ASan cannot proceed correctly. ABORTING.</code> (I think libFuzzer's ASAN and Valgrind's ASAN and interfering?)</li>
<li>force OCaml's <code>Gc.compact</code> on every invocation of the spec interpreter--still crashes</li>
<li>guard invocations of the spec interpreter with a mutex--still crashes</li>
<li>avoid detecting leaks, like you did (e.g. <code>cargo +nightly fuzz run differential_spec -- -detect_leaks=0</code>)--still crashes</li>
</ul>
<p>I guess I should try this out on another machine in case there is something specific about a compiler, library, etc. that is local to mine. In any case, @cfallin and I were going to get together to look at this tomorrow afternoon and it would be great fun (<span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span>) if you wanted to join.</p>
</blockquote>



<a name="248626709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/248626709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#248626709">(Aug 06 2021 at 15:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-894344161">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>Sure I'm happy to help out!</p>
</blockquote>



<a name="248676622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233124%20Fuzz%20Wasmtime%20against%20the%20official.../near/248676622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233124.20Fuzz.20Wasmtime.20against.20the.20official.2E.2E.2E.html#248676622">(Aug 06 2021 at 22:38)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/3124#issuecomment-894551330">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3124">issue #3124</a>:</p>
<blockquote>
<p>The latest rebased commits happily fuzz away on my x86_64 Linux machine, where previously the fuzzer would crash after ~2k-4k cases:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="o">+</span><span class="n">nightly</span><span class="w"> </span><span class="n">fuzz</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">differential_spec</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">[</span><span class="n">optimized</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.10</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">differential_spec</span><span class="w"> </span><span class="o">-</span><span class="n">artifact_prefix</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">artifacts</span><span class="o">/</span><span class="n">differential_spec</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">corpus</span><span class="o">/</span><span class="n">differential_spec</span><span class="err">`</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Running</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">entropic</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">schedule</span><span class="w"> </span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Seed</span>: <span class="mi">62986658</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">modules</span><span class="w">   </span><span class="p">(</span><span class="mi">720350</span><span class="w"> </span><span class="n">inline</span><span class="w"> </span><span class="mi">8</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">counters</span><span class="p">)</span>: <span class="mi">720350</span><span class="w"> </span><span class="p">[</span><span class="mh">0x558bd3a2529a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x558bd3ad5078</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">Loaded</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="p">(</span><span class="mi">720350</span><span class="w"> </span><span class="n">PCs</span><span class="p">)</span>: <span class="mi">720350</span><span class="w"> </span><span class="p">[</span><span class="mh">0x558bd3ad5078</span><span class="p">,</span><span class="mh">0x558bd45d2e58</span><span class="p">),</span><span class="w"></span>
<span class="n">INFO</span>:     <span class="mi">7169</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abrown</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">corpus</span><span class="o">/</span><span class="n">differential_spec</span><span class="w"></span>
<span class="n">INFO</span>: <span class="o">-</span><span class="n">max_len</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">provided</span><span class="p">;</span><span class="w"> </span><span class="n">libFuzzer</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="n">bytes</span><span class="w"></span>
<span class="n">INFO</span>: <span class="nc">seed</span><span class="w"> </span><span class="n">corpus</span>: <span class="nc">files</span>: <span class="mi">7169</span><span class="w"> </span><span class="n">min</span>: <span class="mi">1</span><span class="n">b</span><span class="w"> </span><span class="n">max</span>: <span class="mi">180</span><span class="n">b</span><span class="w"> </span><span class="n">total</span>: <span class="mi">725327</span><span class="n">b</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">79</span><span class="n">Mb</span><span class="w"></span>
#<span class="mi">512</span><span class="w">    </span><span class="n">pulse</span><span class="w">  </span><span class="n">cov</span>: <span class="mi">12621</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">21502</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">178</span><span class="o">/</span><span class="mi">4261</span><span class="n">b</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">51</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">301</span><span class="n">Mb</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
#<span class="mi">22307</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">22079</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">93916</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">5068</span><span class="o">/</span><span class="mi">507</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">187</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">52</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">649</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">111</span><span class="o">/</span><span class="mi">187</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">4</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="n">CMP</span><span class="o">-</span><span class="n">ChangeBit</span><span class="o">-</span><span class="n">CrossOver</span><span class="o">-</span><span class="w"> </span><span class="n">DE</span>: <span class="s">"\xff\xff\xff\xff\xff\xff\xff("</span><span class="o">-</span><span class="w"></span>
#<span class="mi">22438</span><span class="w">  </span><span class="n">REDUCE</span><span class="w"> </span><span class="n">cov</span>: <span class="mi">22079</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">93916</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">5068</span><span class="o">/</span><span class="mi">507</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">187</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">52</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">649</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">127</span><span class="o">/</span><span class="mi">187</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
#<span class="mi">22580</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">22079</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">93918</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">5069</span><span class="o">/</span><span class="mi">508</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">187</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">52</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">649</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">180</span><span class="o">/</span><span class="mi">187</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">ChangeBinInt</span><span class="o">-</span><span class="n">ChangeByte</span><span class="o">-</span><span class="w"></span>
#<span class="mi">22612</span><span class="w">  </span><span class="n">REDUCE</span><span class="w"> </span><span class="n">cov</span>: <span class="mi">22079</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">93918</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">5069</span><span class="o">/</span><span class="mi">508</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">187</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">52</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">649</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">119</span><span class="o">/</span><span class="mi">187</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
<span class="o">===</span><span class="w"> </span><span class="n">Execution</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="mi">5510</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">20000</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">modules</span><span class="p">)</span>: <span class="mf">27.55</span><span class="o">%</span><span class="w"> </span><span class="o">===</span><span class="w"></span>
</code></pre></div>
<p>The ratio of executable modules steadily decreases but that's a separate problem so I'm going to mark this ready for review.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>