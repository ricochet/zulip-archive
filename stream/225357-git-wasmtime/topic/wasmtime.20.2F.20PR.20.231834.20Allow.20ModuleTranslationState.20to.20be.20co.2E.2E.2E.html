<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1834 Allow ModuleTranslationState to be co... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html">wasmtime / PR #1834 Allow ModuleTranslationState to be co...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199948120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/199948120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#199948120">(Jun 06 2020 at 00:35)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1834">PR #1834</a> from <code>module-translation-state-multivalue</code> to <code>master</code>:</p>
<blockquote>
<p>This is needed to allow SpiderMonkey to provide function signature types<br>
to the wasm translator when it uses Cranelift as a backend without<br>
using the wasm translator to parse the entire module. There is perhaps a<br>
better long-term design here where we allow an embedding that already<br>
parses the Wasm module (such as SpiderMonkey) to provide information in<br>
a more principled way, this suffices for now.</p>
<p>Patch is inspired by @bnjbvr's patch in<br>
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641504">https://bugzilla.mozilla.org/show_bug.cgi?id=1641504</a>, but does not<br>
expose <code>wasmparser</code> types directly, instead using Cranelift types across<br>
the API boundary.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="199948121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/199948121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#199948121">(Jun 06 2020 at 00:35)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1834">PR #1834</a>.</p>



<a name="200115108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200115108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200115108">(Jun 08 2020 at 15:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#discussion_r436797305">PR Review Comment</a>:</p>
<blockquote>
<p>Could the type of the two parameters be <code>&amp;[Type]</code>, instead? it would be slightly simpler for users, and wouldn't require the extra call to <code>into_boxed_slice</code> on the Spidermonkey side.</p>
</blockquote>



<a name="200115109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200115109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200115109">(Jun 08 2020 at 15:32)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#pullrequestreview-426359609">PR Review</a>.</p>



<a name="200115110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200115110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200115110">(Jun 08 2020 at 15:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#discussion_r436798048">PR Review Comment</a>:</p>
<blockquote>
<p>(am i understanding correctly that there's Something that infers that we want a <code>Result&lt;Vec&lt;T&gt;&gt;</code> from a <code>Vec&lt;Result&lt;T&gt;&gt;</code>? I can imagine how this works, but I didn't know it was available, this is brilliant!)</p>
</blockquote>



<a name="200115113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200115113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200115113">(Jun 08 2020 at 15:32)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#pullrequestreview-426359609">PR Review</a>.</p>



<a name="200143847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200143847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200143847">(Jun 08 2020 at 19:19)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1834">PR #1834</a> from <code>module-translation-state-multivalue</code> to <code>master</code>:</p>
<blockquote>
<p>This is needed to allow SpiderMonkey to provide function signature types<br>
to the wasm translator when it uses Cranelift as a backend without<br>
using the wasm translator to parse the entire module. There is perhaps a<br>
better long-term design here where we allow an embedding that already<br>
parses the Wasm module (such as SpiderMonkey) to provide information in<br>
a more principled way, this suffices for now.</p>
<p>Patch is inspired by @bnjbvr's patch in<br>
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641504">https://bugzilla.mozilla.org/show_bug.cgi?id=1641504</a>, but does not<br>
expose <code>wasmparser</code> types directly, instead using Cranelift types across<br>
the API boundary.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="200143852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200143852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200143852">(Jun 08 2020 at 19:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#pullrequestreview-426549077">PR Review</a>.</p>



<a name="200143853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200143853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200143853">(Jun 08 2020 at 19:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#discussion_r436945113">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="200143938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200143938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200143938">(Jun 08 2020 at 19:20)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#pullrequestreview-426549550">PR Review</a>.</p>



<a name="200143939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200143939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200143939">(Jun 08 2020 at 19:20)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1834#discussion_r436945518">PR Review Comment</a>:</p>
<blockquote>
<p>Indeed, there is apparently a <code>FromIterator</code> implementation for <code>Result</code> that makes this work!</p>
</blockquote>



<a name="200148478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231834%20Allow%20ModuleTranslationState%20to%20be%20co.../near/200148478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231834.20Allow.20ModuleTranslationState.20to.20be.20co.2E.2E.2E.html#200148478">(Jun 08 2020 at 20:00)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1834">PR #1834</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>