<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4604 components: ignore export aliases to ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html">wasmtime / PR #4604 components: ignore export aliases to ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="291949037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/291949037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#291949037">(Aug 04 2022 at 00:34)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a>.</p>



<a name="291949038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/291949038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#291949038">(Aug 04 2022 at 00:34)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a> from <code>ignore-alias-exports-for-types</code> to <code>main</code>:</p>
<blockquote>
<p>Currently, translation is ignoring type exports from components during<br>
translation by skipping over them before adding them to the exports map.</p>
<p>If a component instantiates an inner component and aliases a type export of<br>
that instance, it will cause wasmtime to panic with a failure to find the<br>
export in the exports map.</p>
<p>The fix is to add a representation for exported types to the map that is simply<br>
ignored when encountered. This also makes it easier to track places where we<br>
would have to support type exports in translation in the future.</p>
</blockquote>



<a name="292020326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292020326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292020326">(Aug 04 2022 at 15:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062080335">PR review</a>.</p>



<a name="292020327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292020327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292020327">(Aug 04 2022 at 15:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062080335">PR review</a>.</p>



<a name="292020328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292020328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292020328">(Aug 04 2022 at 15:05)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r937901295">PR review comment</a>:</p>
<blockquote>
<p>I think that this may not be quite right to ignore because this should add an item to the type namespace but this isn't doing that? I think that means that types defined after this <code>alias</code> wouldn't be numbered correctly.</p>
</blockquote>



<a name="292045967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292045967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292045967">(Aug 04 2022 at 17:48)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062363372">PR review</a>.</p>



<a name="292045969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292045969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292045969">(Aug 04 2022 at 17:48)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r938087699">PR review comment</a>:</p>
<blockquote>
<p>That's a good point. Here's what I think might solve this:</p>
<ol>
<li>When we pop a type scope (i.e. finish parsing a component), associate it with the current translation to signify its statically-known types.</li>
<li>Add a <code>ComponentTypeIndex</code> to the <code>ComponentItem::Type</code> variant.</li>
<li>When processing an alias to an exported type, lookup the <code>TypeDef</code> via the referenced translation's types and push it to the current type scope.</li>
</ol>
<p>Does that sound about right?</p>
</blockquote>



<a name="292046744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292046744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292046744">(Aug 04 2022 at 17:54)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r938087699">PR review comment</a>.</p>



<a name="292056263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292056263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292056263">(Aug 04 2022 at 19:14)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r938166866">PR review comment</a>:</p>
<blockquote>
<p>Thinking about this and also from our discussion in video just now, I think what I'm getting at is that I would naively expect this to be <code>enum ComponentItem { Type(TypeDef) }</code> where unlike the other variants of <code>ComponentItem</code> types are "fully resolved" to a final type information which means we don't need to keep around the type scope information. Otherwise my worry is that when you import and instance with a type export and then alias a type from that during the <code>translate.rs</code> phase we don't otherwise have a type scope to associate with that because we don't know how the import was satisfied.</p>
</blockquote>



<a name="292056264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292056264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292056264">(Aug 04 2022 at 19:14)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062475335">PR review</a>.</p>



<a name="292058937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292058937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292058937">(Aug 04 2022 at 19:35)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062496259">PR review</a>.</p>



<a name="292058938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292058938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292058938">(Aug 04 2022 at 19:35)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r938181589">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah, that makes more sense, no need to look up by index here, just push the <code>TypeDef</code> into the local type scope. I'll push up the fix.</p>
</blockquote>



<a name="292060661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292060661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292060661">(Aug 04 2022 at 19:48)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a> from <code>ignore-alias-exports-for-types</code> to <code>main</code>.</p>



<a name="292060683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292060683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292060683">(Aug 04 2022 at 19:48)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062509745">PR review</a>.</p>



<a name="292060684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292060684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292060684">(Aug 04 2022 at 19:48)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#discussion_r938191097">PR review comment</a>:</p>
<blockquote>
<p>Pushed up the fix. Working on test cases to these two PRs now.</p>
</blockquote>



<a name="292063585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292063585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292063585">(Aug 04 2022 at 20:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4604#pullrequestreview-1062533487">PR review</a>.</p>



<a name="292072348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292072348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292072348">(Aug 04 2022 at 21:29)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a> from <code>ignore-alias-exports-for-types</code> to <code>main</code>.</p>



<a name="292072640"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292072640" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292072640">(Aug 04 2022 at 21:31)</a>:</h4>
<p>peterhuene has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a>.</p>



<a name="292079674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234604%20components%3A%20ignore%20export%20aliases%20to%20.../near/292079674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234604.20components.3A.20ignore.20export.20aliases.20to.20.2E.2E.2E.html#292079674">(Aug 04 2022 at 22:45)</a>:</h4>
<p>peterhuene merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4604">PR #4604</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>