<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1796 wiggle: support logging via `traci... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html">wasmtime / Issue #1796 wiggle: support logging via `traci...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199285917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199285917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199285917">(May 31 2020 at 02:18)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-636410493">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>Currently a very sketchy WIP. I made an example inside test-helpers (because it was most convenient to reuse the test-helpers HostMemory and WasiCtx) that demonstrates that tracing integration works at all, but I'm not sure where the best place to stick that in the long run is. In order to provide an example we have to take on <code>tracing</code> and <code>tracing_subscriber</code> as a <code>dev-dependency</code>, which are not especially heavyweight.</p>
</blockquote>



<a name="199285999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199285999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199285999">(May 31 2020 at 02:20)</a>:</h4>
<p>pchickey edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-636410493">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>Currently a very sketchy WIP, just wanted to show I could factor it out to provide either logging setup as a config option to the macro. Need to still finish factoring out all the log statements into helper funcs, and also setup tracing spans per function.</p>
<p>I made an example inside test-helpers (because it was most convenient to reuse the test-helpers HostMemory and WasiCtx) that demonstrates that tracing integration works at all, but I'm not sure where the best place to stick that in the long run is. In order to provide an example we have to take on <code>tracing</code> and <code>tracing_subscriber</code> as a <code>dev-dependency</code>, which are not especially heavyweight.</p>
</blockquote>



<a name="199286539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199286539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199286539">(May 31 2020 at 02:39)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-636412000">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @kubkon</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasi"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>kubkon: wasi</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="199343786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199343786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199343786">(Jun 01 2020 at 07:40)</a>:</h4>
<p>kubkon <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-636670064">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>This looks interesting, thanks Pat! I haven’t looked over the code properly yet, however, one observation about removing <code>log</code> altogether is that this will probably force every user of <code>libwasmtime</code> to rely on <code>tracing</code> crate which i don’t think is a good idea. I think if I was a developer making use of the library, I’d rather have the choice or at the very least expect <code>log</code> support by default which seems to be the “industry” standard.</p>
</blockquote>



<a name="199385482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199385482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199385482">(Jun 01 2020 at 15:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-636934281">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>This seems reasonable to me to add as a feature, but I'm also hesitant about deleting <code>log</code>. It looks like <code>tracing</code> is a pretty hefty dependency, and I'm not sure all users of <code>wasmtime</code> will want to take that on.</p>
<blockquote>
<p>(stable) support for structured fields</p>
</blockquote>
<p>FWIW this seems like a good reason to poke upstream about the support here, I know it's been in limbo for awhile but upstream may have thoughts about stabilizing.</p>
<blockquote>
<p>tracing statements that are disabled (marked as uninteresting, essentially) by the backend are very low overhead - its one atomic load to determine whether a hook is disabled.</p>
</blockquote>
<p>I know this is also true for <code>log</code>, so I don't think there should be any speed difference.</p>
</blockquote>



<a name="199406386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199406386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199406386">(Jun 01 2020 at 18:38)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-637034743">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>Cool, thanks for the input and the context. I'll move forward with this patch which will make the logging choice an either/or <code>log</code>/<code>tracing</code>. I'm not going to pull on the thread of structured fields in <code>log</code> for lack of time to do so, but I'd welcome any help with that.</p>
</blockquote>



<a name="199436883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199436883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199436883">(Jun 01 2020 at 23:49)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-637185032">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>I thought about this more and got some feedback from @hawkw and @fitzgen -</p>
<ul>
<li>taking a dep on <code>tracing</code> implies <code>tracing-core</code> and <code>tracing-attributes</code>, which in turn pull in <code>lazy_static</code>, <code>cfg-if</code>, and the standard proc macro crates (proc-macro2, syn, quote). <code>wasi-common</code> already has all of those deps transitively, so, this is not so heavyweight. <code>tracing-subscriber</code> is the heavyweight crate, just like the backend crates in the <code>log</code> ecosystem.</li>
<li>when the <code>log</code> feature is enabled for <code>tracing</code>, the <code>log</code> system is used as the backend for the <code>tracing</code> macros. This allows the existing users who just want <code>log</code> in their system to use wasi-common just as they did before. Since the <code>tracing</code> dep isn't very heavy, this seems preferable than having a switch throughout wiggle codegen to emit one kind of log or another</li>
<li>If we want to completely disable any code footprint from <code>tracing</code> or <code>log</code>, Wiggle can emit macros that point to <code>wiggle::tracing_impl::(macro)</code>, and use a feature flag in <code>wiggle/src/tracing_impl.rs</code> to substitute between <code>pub use tracing::*</code> and a module that defines no-op versions of each macro. This is suitable for use cases that are very sensitive about vendoring in additional deps, or where the code size of always-runtime-disabled macros is an issue.</li>
</ul>
</blockquote>



<a name="199563589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199563589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199563589">(Jun 02 2020 at 22:59)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-637850788">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>Unfortunately, we can't switch between the <code>tracing</code> macros and no-op versions, while keeping that api re-exported inside a module scope like <code>wiggle::tracing</code> (and its a fairly big API, so i think we really need to), without defining a whole other <code>tracing_noop</code> crate, because much of the API is in terms of <code>macro_rules</code> which can only be exported at the top level of a crate. So, Rust visibility rules got us here.</p>
<p>At some point, the cranelift project will need to implement a <code>tracing_noop</code> crate in order to turn off <code>tracing</code> deps for use inside spidermonkey. Until then, we'll do a mandatory dep on <code>tracing</code>, with just a feature to set it in <code>log</code> mode.</p>
</blockquote>



<a name="199571692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199571692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199571692">(Jun 03 2020 at 01:24)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-637899025">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>The failures in <code>wasi-common</code> are due to a fixed bug in <code>tracing</code> that will be part of the 0.1.15 release, which will happen shortly since we need it to merge this.</p>
</blockquote>



<a name="199572625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199572625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199572625">(Jun 03 2020 at 01:46)</a>:</h4>
<p>hawkw <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-637904583">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<blockquote>
<p>The failures in <code>wasi-common</code> are due to a fixed bug in <code>tracing</code> that will be part of the 0.1.15 release, which will happen shortly since we need it to merge this.</p>
</blockquote>
<p>Hot off the presses: <a href="https://crates.io/crates/tracing/0.1.15">https://crates.io/crates/tracing/0.1.15</a></p>
<p>Sorry for any inconvenience! :)</p>
</blockquote>



<a name="199653742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231796%20wiggle%3A%20support%20logging%20via%20%60traci.../near/199653742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231796.20wiggle.3A.20support.20logging.20via.20.60traci.2E.2E.2E.html#199653742">(Jun 03 2020 at 17:56)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/1796#issuecomment-638363227">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1796">Issue #1796</a>:</p>
<blockquote>
<p>I believe this is ready for review.</p>
<p>The example program at <code>crates/wiggle/test-helpers/examples/tracing.rs</code> demonstrates the use of <code>tracing-subscriber</code> and <code>log</code> as backends to the tracing statements emitted by wiggle. If you set the <code>RUST_LOG</code> environment variable, itll use <code>env_logger</code> to output, otherwise it'll use <code>tracing-subscriber</code>.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>