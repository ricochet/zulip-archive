<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9485 Wasmtime toplevel module: re-export w... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html">wasmtime / PR #9485 Wasmtime toplevel module: re-export w...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="477709759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477709759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477709759">(Oct 18 2024 at 18:34)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a> from <code>cfallin:reexport-wasmparser</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In some use-cases, an embedder might also use wasmparser directly. It might be useful in these cases to keep the version the embedder uses in sync with the version that Wasmtime uses, both for exact feature-support compatibility reasons and to remove the redundancy in the dependency tree.</p>
<p><code>wasmparser</code> is a required dependency of the <code>wasmtime-environ</code> crate, even in builds without compiler backends, so this re-exports the crate at the <code>wasmtime</code> crate level through that path.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="477709762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477709762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477709762">(Oct 18 2024 at 18:34)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>.</p>



<a name="477709763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477709763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477709763">(Oct 18 2024 at 18:34)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>.</p>



<a name="477710364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477710364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477710364">(Oct 18 2024 at 18:39)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>.</p>



<a name="477710398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477710398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477710398">(Oct 18 2024 at 18:39)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>:</p>
<blockquote>
<p>In some use-cases, an embedder might also use wasmparser directly. It might be useful in these cases to keep the version the embedder uses in sync with the version that Wasmtime uses, both for exact feature-support compatibility reasons and to remove the redundancy in the dependency tree.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="477711372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477711372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477711372">(Oct 18 2024 at 18:46)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#pullrequestreview-2378768646">PR review</a>:</p>
<blockquote>
<p>I have some concerns around semver here.</p>
<p>This public dependency means that, in practice, we can't change our <code>wasmparser</code> dependency as part of any bug fixes that we want to backport, say for a security bug, because <code>wasmparser</code> doesn't really do patch releases. We don't usually do patch releases for <code>wasm-tools</code> because there are too many tools and crates and types and APIs to keep track of whether we had breaking changes or not, which are exactly the same difficulties we would run into here when backporting patches. And if we get this wrong, then we break embedders' compilations, which is a terrible downstream experience.</p>
<p>I also recognize that staying in sync with wasmtime's parsing is a valid use case, so I'm not sure what to do.</p>
<ul>
<li>Am I overly worried about the semver issues? Making this a bigger deal than it should be?</li>
<li>Does it make sense to put this behind a cargo feature and document that we don't necessarily follow semver for this feature and its re-export?</li>
<li>Is there an alternative solution for this use case that I'm not aware of?</li>
</ul>
</blockquote>



<a name="477712780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477712780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477712780">(Oct 18 2024 at 18:55)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#issuecomment-2423059338">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>:</p>
<blockquote>
<p>Excellent points. In a vacuum I agree it'd make sense to minimize what we promise -- the wasmtime API should be about Wasm execution only -- but as you note, this is motivated by a real issue on the other side, too.</p>
<p>I think it might be worth thinking about the bugfix case further. If the embedder has the requirement that its wasmparser dependency matches its parsing behavior with Wasmtime's, and if we need to support this requirement, then <em>already</em> wasmparser's behavior is relevant when we think about a wasmtime patch release. So I think this already means that we either need to have the property that backports work with the version of wasmparser matched with the old version of wasmtime, or if not, we do a patch release of wasm-tools. In practice I can't think of any backported bugfixes we've had recently at least that were tied closely to a version of wasmparser; are you aware of any?</p>
<p>I'm also totally fine with putting this re-export behind a feature. The question still remains whether we follow semver or whether it's a "semver-exempt" corner of the API when the feature is on; obviously the former is a nicer experience for any embedder with this requirement.</p>
<p>Anyway, my personal opinion is that as long as this use-case exists out there, we don't gain much in terms of global simplicity or ease of maintenance by pushing the requirement outside of our own local semver bounds, but I'd be curious what others (@alexcrichton ?) think too!</p>
</blockquote>



<a name="477714381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477714381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477714381">(Oct 18 2024 at 19:06)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#issuecomment-2423075371">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>:</p>
<blockquote>
<p>I'm not aware of any security backports that required <code>wasmparser</code> bumps. Again, maybe I'm being paranoid.</p>
<p>But for the use case of "I need to use the <em>exact</em> same parser as wasmtime" then I think it really does make sense to say "you really get the exact same parser that wasmtime uses, regardless of the versioning that wasmtime is otherwise using" and that semver opt-out motivates putting this behind a cargo feature, IMO. Taken altogether, that feels like a consistent approach.</p>
</blockquote>



<a name="477717886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477717886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477717886">(Oct 18 2024 at 19:31)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>.</p>



<a name="477717989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477717989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477717989">(Oct 18 2024 at 19:32)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#issuecomment-2423110749">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>:</p>
<blockquote>
<p>OK, cool, I've added an off-by-default feature that gates this re-export -- thanks!</p>
</blockquote>



<a name="477726568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477726568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477726568">(Oct 18 2024 at 20:01)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#pullrequestreview-2378882993">PR review</a>.</p>



<a name="477726569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477726569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477726569">(Oct 18 2024 at 20:01)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#discussion_r1806965421">PR review comment</a>:</p>
<blockquote>
<p>Thanks for writing this up!</p>
</blockquote>



<a name="477728592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/477728592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#477728592">(Oct 18 2024 at 20:17)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>.</p>



<a name="478001775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239485%20Wasmtime%20toplevel%20module%3A%20re-export%20w.../near/478001775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239485.20Wasmtime.20toplevel.20module.3A.20re-export.20w.2E.2E.2E.html#478001775">(Oct 21 2024 at 09:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9485#issuecomment-2426088617">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9485">PR #9485</a>:</p>
<blockquote>
<blockquote>
<p>Am I overly worried about the semver issues? Making this a bigger deal than it should be?</p>
</blockquote>
<p>Personally I think this may be the case, I'm not too worried about this. I think this is something we'd have to be cognizant of when responding to a security issue but it wouldn't be the end of the world to issue backports for wasmparser too.</p>
<p>That being said I think the docs added here are fine. We can just see how it goes over time!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>