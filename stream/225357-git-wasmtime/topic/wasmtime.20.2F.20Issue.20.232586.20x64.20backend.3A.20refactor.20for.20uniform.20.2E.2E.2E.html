<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2586 x64 backend: refactor for uniform ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html">wasmtime / Issue #2586 x64 backend: refactor for uniform ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="222796625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/222796625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#222796625">(Jan 14 2021 at 22:47)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>Currently, the new x64 backend encodes operand-size information into <code>x64::Inst</code>s in various ways, depending on the arm of the enum. We should refactor so that we use an <code>OperandSize</code> universally; this would cut down a bit on boilerplate and would add some clarity.</p>
<p>Related to that, we also have some fairly subtle logic surrounding REX-prefix emission. We should modify <code>RexFlags</code> so that it takes an <code>OperandSize</code> in its constructor, to make REX-prefix errors less likely.</p>
</blockquote>



<a name="224145486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/224145486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#224145486">(Jan 27 2021 at 06:42)</a>:</h4>
<p>kaseyc <a href="https://github.com/bytecodealliance/wasmtime/issues/2586#issuecomment-768070854">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>Hi Chris, </p>
<p>From looking at inst/mod.rs refactoring Inst to use OperandSize seems straightforward enough on the surface (famous last words).</p>
<p>Do you mind if I take a stab at it?<br>
</p>
</blockquote>



<a name="224203634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/224203634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#224203634">(Jan 27 2021 at 16:05)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>Currently, the new x64 backend encodes operand-size information into <code>x64::Inst</code>s in various ways, depending on the arm of the enum. We should refactor so that we use an <code>OperandSize</code> universally; this would cut down a bit on boilerplate and would add some clarity.</p>
<p>Related to that, we also have some fairly subtle logic surrounding REX-prefix emission. We should modify <code>RexFlags</code> so that it takes an <code>OperandSize</code> in its constructor, to make REX-prefix errors less likely.</p>
</blockquote>



<a name="224203635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/224203635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#224203635">(Jan 27 2021 at 16:05)</a>:</h4>
<p>bnjbvr labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>Currently, the new x64 backend encodes operand-size information into <code>x64::Inst</code>s in various ways, depending on the arm of the enum. We should refactor so that we use an <code>OperandSize</code> universally; this would cut down a bit on boilerplate and would add some clarity.</p>
<p>Related to that, we also have some fairly subtle logic surrounding REX-prefix emission. We should modify <code>RexFlags</code> so that it takes an <code>OperandSize</code> in its constructor, to make REX-prefix errors less likely.</p>
</blockquote>



<a name="224206380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/224206380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#224206380">(Jan 27 2021 at 16:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2586#issuecomment-768402093">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>@kaseyc -- please do! This is a pretty well-scoped issue I think -- you should be able to change the <code>Inst</code> enum first and then just follow the type errors all the way. Thanks!</p>
</blockquote>



<a name="226760431"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232586%20x64%20backend%3A%20refactor%20for%20uniform%20.../near/226760431" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232586.20x64.20backend.3A.20refactor.20for.20uniform.20.2E.2E.2E.html#226760431">(Feb 18 2021 at 03:27)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2586">Issue #2586</a>:</p>
<blockquote>
<p>Currently, the new x64 backend encodes operand-size information into <code>x64::Inst</code>s in various ways, depending on the arm of the enum. We should refactor so that we use an <code>OperandSize</code> universally; this would cut down a bit on boilerplate and would add some clarity.</p>
<p>Related to that, we also have some fairly subtle logic surrounding REX-prefix emission. We should modify <code>RexFlags</code> so that it takes an <code>OperandSize</code> in its constructor, to make REX-prefix errors less likely.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>