<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2738 No way to access stackmaps using c... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232738.20No.20way.20to.20access.20stackmaps.20using.20c.2E.2E.2E.html">wasmtime / Issue #2738 No way to access stackmaps using c...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="230895051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232738%20No%20way%20to%20access%20stackmaps%20using%20c.../near/230895051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232738.20No.20way.20to.20access.20stackmaps.20using.20c.2E.2E.2E.html#230895051">(Mar 18 2021 at 16:23)</a>:</h4>
<p>wrbs opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2738">Issue #2738</a>:</p>
<blockquote>
<p>In #1184 and #1214 <code>cranelift-module</code> was extended to add support for passing in a trap sink while compiling a function. However there's no support for doing the same with a <code>StackMapSink</code> and it looks like at the time this was deferred to later.</p>
<p>I'm interested in using the GC support for something which would use the <code>cranelift-jit</code> interface but there's currently no way to access stackmaps when doing that.</p>
<p>I'm not sure what the best way to fix this is. One method could be adding a <code>stack_map_sink: &amp;mut dyn StackMapSink</code> argument to <code>define_function</code> but that would require all users of the interface (most of who don't use stack maps) to pass in a <code>&amp;mut NullStackMapSink {}</code> in the same way as passing a <code>NullTrapSink</code> is required. However if breaking changes to the API are ok this fits the existing convention.</p>
<p>I'm thinking of sending a PR with this approach but I'd like to know if this is acceptable.</p>
</blockquote>



<a name="230895480"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232738%20No%20way%20to%20access%20stackmaps%20using%20c.../near/230895480" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232738.20No.20way.20to.20access.20stackmaps.20using.20c.2E.2E.2E.html#230895480">(Mar 18 2021 at 16:26)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/2738#issuecomment-802071546">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2738">Issue #2738</a>:</p>
<blockquote>
<p>That sounds like a fine approach - please do send a PR!</p>
</blockquote>



<a name="230959033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232738%20No%20way%20to%20access%20stackmaps%20using%20c.../near/230959033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232738.20No.20way.20to.20access.20stackmaps.20using.20c.2E.2E.2E.html#230959033">(Mar 19 2021 at 00:49)</a>:</h4>
<p>pchickey closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2738">Issue #2738</a>:</p>
<blockquote>
<p>In #1184 and #1214 <code>cranelift-module</code> was extended to add support for passing in a trap sink while compiling a function. However there's no support for doing the same with a <code>StackMapSink</code> and it looks like at the time this was deferred to later.</p>
<p>I'm interested in using the GC support for something which would use the <code>cranelift-jit</code> interface but there's currently no way to access stackmaps when doing that.</p>
<p>I'm not sure what the best way to fix this is. One method could be adding a <code>stack_map_sink: &amp;mut dyn StackMapSink</code> argument to <code>define_function</code> but that would require all users of the interface (most of who don't use stack maps) to pass in a <code>&amp;mut NullStackMapSink {}</code> in the same way as passing a <code>NullTrapSink</code> is required. However if breaking changes to the API are ok this fits the existing convention.</p>
<p>I'm thinking of sending a PR with this approach but I'd like to know if this is acceptable.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>