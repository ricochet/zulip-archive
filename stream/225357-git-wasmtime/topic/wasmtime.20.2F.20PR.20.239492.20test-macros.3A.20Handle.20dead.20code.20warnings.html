<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9492 test-macros: Handle dead code warnings · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html">wasmtime / PR #9492 test-macros: Handle dead code warnings</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="478124051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478124051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478124051">(Oct 21 2024 at 18:27)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9492">PR #9492</a> from <code>saulecabrera:test-macros-handle-dead-code-warnings</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit handles dead code warnings produced by the compiler when the macro is invoked as:</p>
<div class="codehilite"><pre><span></span><code>#[wasmtime_test(strategies(not(Cranelift))]
</code></pre></div>

<p>Which occur because Winch currently only offers support for x86_64.</p>
<p>The motivation behind this change comes from<br>
<a href="https://github.com/bytecodealliance/wasmtime/pull/9490">https://github.com/bytecodealliance/wasmtime/pull/9490</a>, which is where the warnings surfaced.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="478124052"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478124052" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478124052">(Oct 21 2024 at 18:27)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9492">PR #9492</a>.</p>



<a name="478124053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478124053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478124053">(Oct 21 2024 at 18:27)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9492">PR #9492</a>.</p>



<a name="478124069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478124069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478124069">(Oct 21 2024 at 18:27)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9492">PR #9492</a>.</p>



<a name="478302792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478302792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478302792">(Oct 22 2024 at 14:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#pullrequestreview-2385454234">PR review</a>.</p>



<a name="478302794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478302794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478302794">(Oct 22 2024 at 14:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#discussion_r1810879979">PR review comment</a>:</p>
<blockquote>
<p>As an alternative instead of <code>#[cfg(target_arch = "x86_64")]</code> being emitted, how about <code>#[cfg_attr(target_arch = "x86_64", ignore)]</code>? That way we wouldn't have to worry about unused warnings or dead code I think</p>
</blockquote>



<a name="478312759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478312759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478312759">(Oct 22 2024 at 15:25)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#discussion_r1810945167">PR review comment</a>:</p>
<blockquote>
<p>I briefly tried this approach, I didn't continue down this route because the compiler was complaining about <code>multiple cfg predicates are specified</code>, presumably because some tests have other extra attributes like <code>#[cfg_attr(miri, ignore)]</code> -- I think we could parse those attributes and modify them, however, since this is "temporary" (i.e., once we can fully test <code>aarch64</code>) I thought it might make sense to go with this approach. </p>
</blockquote>



<a name="478312760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478312760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478312760">(Oct 22 2024 at 15:25)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#pullrequestreview-2385564697">PR review</a>.</p>



<a name="478313235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478313235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478313235">(Oct 22 2024 at 15:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#pullrequestreview-2385574087">PR review</a>.</p>



<a name="478313237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478313237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478313237">(Oct 22 2024 at 15:27)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#discussion_r1810951409">PR review comment</a>:</p>
<blockquote>
<p>Ah ok makes sense yeah. I wonder though, could we take a leaf out of the book of <code>tests/wast.rs</code> and do <code>#[cfg_attr(...,  should_fail)]</code> instead? That way we're guaranteed to run the test and we just assert that it's an error instead of passing.</p>
</blockquote>



<a name="478331131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478331131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478331131">(Oct 22 2024 at 17:06)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#pullrequestreview-2385819904">PR review</a>.</p>



<a name="478331132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478331132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478331132">(Oct 22 2024 at 17:06)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9492#discussion_r1811096183">PR review comment</a>:</p>
<blockquote>
<p>Had an offline discussion and concluded that <code>should_panic</code> probably won't play nicely with tests that return <code>Result</code>, so we're moving forward with the current approach. </p>
</blockquote>



<a name="478333399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239492%20test-macros%3A%20Handle%20dead%20code%20warnings/near/478333399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239492.20test-macros.3A.20Handle.20dead.20code.20warnings.html#478333399">(Oct 22 2024 at 17:21)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9492">PR #9492</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>