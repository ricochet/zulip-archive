<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9799 Allow `wasmtime serve` command&#x27;s L... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html">wasmtime / issue #9799 Allow `wasmtime serve` command&#x27;s L...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="488540014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239799%20Allow%20%60wasmtime%20serve%60%20command%27s%20L.../near/488540014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html#488540014">(Dec 12 2024 at 02:38)</a>:</h4>
<p>jzhn opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">issue #9799</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>
<h4>Benefit</h4>
<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/">Grafana Loki</a> and <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs">AWS CloudWatch</a></p>
<h4>Implementation</h4>
<p>Hopefully it's as simple as adding a coupld CLI flags.</p>
<h4>Alternatives</h4>
<p>No workarounds/alternatives I could think of.<br>
</p>
</blockquote>



<a name="488540044"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239799%20Allow%20%60wasmtime%20serve%60%20command%27s%20L.../near/488540044" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html#488540044">(Dec 12 2024 at 02:39)</a>:</h4>
<p>jzhn edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">issue #9799</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>
<h4>Benefit</h4>
<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/">Grafana Loki</a> and <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs">AWS CloudWatch</a></p>
<h4>Implementation</h4>
<p>Hopefully it's as simple as adding a coupld CLI flags, to make <a href="https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149">https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149</a> configurable.</p>
<h4>Alternatives</h4>
<p>No workarounds/alternatives I could think of.<br>
</p>
</blockquote>



<a name="488540295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239799%20Allow%20%60wasmtime%20serve%60%20command%27s%20L.../near/488540295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html#488540295">(Dec 12 2024 at 02:42)</a>:</h4>
<p>jzhn edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">issue #9799</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Currently, the <code>wasmtime serve</code> always prefixes the stdout and stderr output of http handlers. This prevents users from implementing structured logs like json.</p>
<h5>Expected behaviour</h5>
<p>logging from http handler in json will be logged by <code>wasmtime serve</code> as-is, without any prefixes.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">{</span><span class="s">"timestamp"</span><span class="p">:</span><span class="s">"2024-12-12T02:01:04.794485Z"</span><span class="p">,</span><span class="s">"level"</span><span class="p">:</span><span class="s">"INFO"</span><span class="p">,</span><span class="s">"fields"</span><span class="p">:{</span><span class="s">"message"</span><span class="p">:</span><span class="s">"hello world"</span><span class="p">,</span><span class="s">"log.target"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">,</span><span class="s">"log.module_path"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">,</span><span class="s">"log.file"</span><span class="p">:</span><span class="s">"webservice/src/lib.rs"</span><span class="p">,</span><span class="s">"log.line"</span><span class="p">:</span><span class="mi">237</span><span class="p">},</span><span class="s">"target"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">}</span>
</code></pre></div>
<h5>Actual behaviour</h5>
<p>handler logs are prefixed with <code>stdout [{req_id}] :: </code>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">stdout</span><span class="w"> </span><span class="p">[</span><span class="mi">176</span><span class="p">]</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">{</span><span class="s">"timestamp"</span><span class="p">:</span><span class="s">"2024-12-12T02:01:04.794485Z"</span><span class="p">,</span><span class="s">"level"</span><span class="p">:</span><span class="s">"INFO"</span><span class="p">,</span><span class="s">"fields"</span><span class="p">:{</span><span class="s">"message"</span><span class="p">:</span><span class="s">"hello world"</span><span class="p">,</span><span class="s">"log.target"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">,</span><span class="s">"log.module_path"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">,</span><span class="s">"log.file"</span><span class="p">:</span><span class="s">"webservice/src/lib.rs"</span><span class="p">,</span><span class="s">"log.line"</span><span class="p">:</span><span class="mi">237</span><span class="p">},</span><span class="s">"target"</span><span class="p">:</span><span class="s">"webservice"</span><span class="p">}</span>
</code></pre></div>
<h4>Benefit</h4>
<p>If <code>wasmtime serve</code> allows customizing log prefixes, it would allow users to implement structured logging at their http handlers, like json, so the stdout and stderr logs from wasmtime serve can be easily parsed by popular log management tools like <a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/json/">Grafana Loki</a> and <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html#CWL_AnalyzeLogData-discoverable-JSON-logs">AWS CloudWatch</a></p>
<h4>Implementation</h4>
<p>Hopefully it's as simple as adding a coupld CLI flags, to make <a href="https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149">https://github.com/bytecodealliance/wasmtime/blob/9aa048b0eb0caf2bbd85a24bdada33928e42ad3b/src/commands/serve.rs#L141-L149</a> configurable.</p>
<h4>Alternatives</h4>
<p>No workarounds/alternatives I could think of.<br>
</p>
</blockquote>



<a name="488715092"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239799%20Allow%20%60wasmtime%20serve%60%20command%27s%20L.../near/488715092" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html#488715092">(Dec 12 2024 at 20:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9799#issuecomment-2539981133">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">issue #9799</a>:</p>
<blockquote>
<p>Sounds reasonable to me to have some CLI flags for this yeah, would you be interested in sending a PR? Perhaps we could start out with a flag to just turn off the prefixes?</p>
</blockquote>



<a name="488948706"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239799%20Allow%20%60wasmtime%20serve%60%20command%27s%20L.../near/488948706" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239799.20Allow.20.60wasmtime.20serve.60.20command.27s.20L.2E.2E.2E.html#488948706">(Dec 14 2024 at 01:47)</a>:</h4>
<p>jzhn <a href="https://github.com/bytecodealliance/wasmtime/issues/9799#issuecomment-2542653737">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9799">issue #9799</a>:</p>
<blockquote>
<p>@alexcrichton : I'm fairly new to Rust and WASM, but with your encouragement I've created a PR for this. Please take a look and let me know your feedbacks. Thank you!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>