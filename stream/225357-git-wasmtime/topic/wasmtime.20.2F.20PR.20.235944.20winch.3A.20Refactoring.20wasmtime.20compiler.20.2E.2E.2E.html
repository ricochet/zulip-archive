<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5944 winch: Refactoring wasmtime compiler ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html">wasmtime / PR #5944 winch: Refactoring wasmtime compiler ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="339962757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339962757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339962757">(Mar 06 2023 at 20:32)</a>:</h4>
<p>KevinRizzoTO opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
<p>As discussed with @saulecabrera and @alexcrichton, this PR adds in some refactors that will make the initial Winch integration with <code>wasmtime</code> smoother. At a high level:</p>
<ul>
<li>move shared code into the new <code>wasmtime-cranelift-shared</code> crate, which will provide a temporary location to put shared code between Winch and Cranelift while we see what patterns need to be abtracted</li>
<li>combine some Isa operations under a shared <code>IsaBuilder</code> trait</li>
<li>have the <code>enable_incremental_compilation</code> method on the <code>wasmtime_environ::CompilerBuilder</code> trait return a <code>Result</code> so the implementation can decide if it's supported or not</li>
</ul>
<p>Big thanks to @alexcrichton for helping out here! I ended up using a lot of his first pass (compared to my much messier version <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span>).<br>
</p>
</blockquote>



<a name="339963522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339963522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339963522">(Mar 06 2023 at 20:37)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="339982444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339982444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339982444">(Mar 06 2023 at 22:47)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1327333143">PR review</a>.</p>



<a name="339982445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339982445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339982445">(Mar 06 2023 at 22:47)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1127127149">PR review comment</a>:</p>
<blockquote>
<p>These don't look like they are used.</p>
</blockquote>



<a name="339983217"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339983217" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339983217">(Mar 06 2023 at 22:53)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1327339999">PR review</a>.</p>



<a name="339983218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339983218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339983218">(Mar 06 2023 at 22:53)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1127133611">PR review comment</a>:</p>
<blockquote>
<p>Why is this no longer consuming the builder? I don't see a reason why you would want to resue the builder across building multiple TargetIsa. Nornally you did either build once or build multiple times but with different settings.</p>
</blockquote>



<a name="339983387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/339983387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#339983387">(Mar 06 2023 at 22:54)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1127133611">PR review comment</a>.</p>



<a name="340126220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340126220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340126220">(Mar 07 2023 at 14:40)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340129923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340129923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340129923">(Mar 07 2023 at 14:54)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1328699523">PR review</a>.</p>



<a name="340129927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340129927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340129927">(Mar 07 2023 at 14:54)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1127993616">PR review comment</a>:</p>
<blockquote>
<p>Looking through this a bit, it seems like we don't necessarily have to make this change.</p>
<p>However, you can see <a href="https://github.com/bytecodealliance/wasmtime/pull/5944/files#diff-4f5aab5323544d319ac344b7f711167c204d0afb53625530f09e90c190994e0aL103-R72">here</a> that previously, even though we were consuming the builder when calling <code>finish</code>, we ended up cloning the builder anyways to get around moving the value behind a shared reference. It might make more sense to not explicitly move the value out when calling <code>finish</code> if it means the builder is more ergonomic to use in other places. Also cc @alexcrichton in case you have thoughts on this.</p>
</blockquote>



<a name="340145539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340145539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340145539">(Mar 07 2023 at 15:52)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a>.</p>



<a name="340154823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340154823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340154823">(Mar 07 2023 at 16:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1327261728">PR review</a>.</p>



<a name="340154824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340154824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340154824">(Mar 07 2023 at 16:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1327261728">PR review</a>.</p>



<a name="340154825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340154825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340154825">(Mar 07 2023 at 16:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1127080576">PR review comment</a>:</p>
<blockquote>
<p>Are these still necessary? (I may be missing the changes where they get applied)</p>
</blockquote>



<a name="340154827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340154827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340154827">(Mar 07 2023 at 16:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128151471">PR review comment</a>:</p>
<blockquote>
<p>Ah I've forgotten why I originally did it. At some point along the way when I was originally refactoring I needed to do this to resolve some compile error somewhere but I've lost the context so it might be worth backing out this part and seeing what happens?</p>
</blockquote>



<a name="340158239"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340158239" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340158239">(Mar 07 2023 at 16:43)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329052628">PR review</a>.</p>



<a name="340158240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340158240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340158240">(Mar 07 2023 at 16:43)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128194028">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah I had to do a bit of git surgery to split out some of the major winch changes to be included in a later PR, so I think this slipped through. It's been removed</p>
</blockquote>



<a name="340158963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340158963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340158963">(Mar 07 2023 at 16:46)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329060968">PR review</a>.</p>



<a name="340158965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340158965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340158965">(Mar 07 2023 at 16:46)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128199008">PR review comment</a>:</p>
<blockquote>
<p>Yeah I took a stab at moving back! It can be done but it requires cloning the builder in other places (it's <code>&amp;self</code> all the way down). I don't have a preference really but I can move it back if that's easier.</p>
</blockquote>



<a name="340160039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340160039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340160039">(Mar 07 2023 at 16:51)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340165183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340165183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340165183">(Mar 07 2023 at 17:13)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340165382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340165382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340165382">(Mar 07 2023 at 17:14)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128246724">PR review comment</a>:</p>
<blockquote>
<p>I gave it a try <a href="https://github.com/bytecodealliance/wasmtime/pull/5944/commits/60b6947ffff7e24fc434a008f5f278ead023afb7">here</a> and it seems to work fine, but it requires adding clone support in a few more places.</p>
</blockquote>



<a name="340165383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340165383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340165383">(Mar 07 2023 at 17:14)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329117820">PR review</a>.</p>



<a name="340166425"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340166425" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340166425">(Mar 07 2023 at 17:19)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340167317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167317">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1328862994">PR review</a>.</p>



<a name="340167318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167318">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1328862994">PR review</a>.</p>



<a name="340167320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167320">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128081103">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>/// Type alias of `IsaBuilder` used for building Cranelift's ISAs.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167325">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128233368">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        // See `cranelift_codegen`'s value of this for more information.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167327">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128235146">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    /// See `cranelift_codegen::isa::TargetIsa::create_systemv_cie`.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167328">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128235868">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        // By default, an ISA cannot create a System V CIE.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167330">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128237238">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    /// See `cranelift_codegen::isa::TargetIsa::function_alignment`.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167331">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128238200">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        // See `cranelift_codegen::isa::TargetIsa::function_alignment`.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167333">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128239471">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        // By default, an ISA cannot create a System V CIE.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167334">(Mar 07 2023 at 17:23)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128236636">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    /// See `cranelift_codegen::isa::TargetIsa::text_section_builder`.
</code></pre></div><br>
</p>
</blockquote>



<a name="340167417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340167417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340167417">(Mar 07 2023 at 17:23)</a>:</h4>
<p>KevinRizzoTO edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128246724">PR review comment</a>.</p>



<a name="340168759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340168759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340168759">(Mar 07 2023 at 17:29)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340169316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340169316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340169316">(Mar 07 2023 at 17:31)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340169383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340169383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340169383">(Mar 07 2023 at 17:31)</a>:</h4>
<p>KevinRizzoTO edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128246724">PR review comment</a>.</p>



<a name="340178157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340178157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340178157">(Mar 07 2023 at 18:10)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340199797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340199797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340199797">(Mar 07 2023 at 19:50)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340199837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340199837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340199837">(Mar 07 2023 at 19:51)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340201029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201029">(Mar 07 2023 at 19:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329406806">PR review</a>.</p>



<a name="340201032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201032">(Mar 07 2023 at 19:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128487429">PR review comment</a>:</p>
<blockquote>
<p>Not something that needs to be handled here in this PR, but in the future this will need to be invoked by winch and I _think_ that most of the arguments here can simply become the output of <code>MachBuffer</code>'s compilation step since I think it's largely all packaged in there already (except maybe alignment IIRC). Just something to keep in mind though as more of the winch bits are filled out.</p>
</blockquote>



<a name="340201033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201033">(Mar 07 2023 at 19:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329406806">PR review</a>.</p>



<a name="340201034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201034">(Mar 07 2023 at 19:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128489717">PR review comment</a>:</p>
<blockquote>
<p>I see the refactoring in cranelift-native, but I think that the usage of <code>cranelift_native</code> here may be lost? I think part of <code>IsaBuilder::new</code> may want to pass the configured flags to the native configuration crate as well?</p>
</blockquote>



<a name="340201257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201257">(Mar 07 2023 at 19:58)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329411388">PR review</a>.</p>



<a name="340201258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340201258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340201258">(Mar 07 2023 at 19:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128490840">PR review comment</a>:</p>
<blockquote>
<p>Oh sorry forgot to mention just now, but I do not personally have any preference on which way this goes. I don't know of any reason myself to preserve the current functionality nor necessarily any reason to move to the borrowed version.</p>
</blockquote>



<a name="340202650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340202650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340202650">(Mar 07 2023 at 20:04)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329422771">PR review</a>.</p>



<a name="340202651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340202651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340202651">(Mar 07 2023 at 20:04)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128498393">PR review comment</a>:</p>
<blockquote>
<p>Oh yes thanks good catch! This needs to be added back in</p>
</blockquote>



<a name="340203972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340203972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340203972">(Mar 07 2023 at 20:12)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329453970">PR review</a>.</p>



<a name="340203974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340203974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340203974">(Mar 07 2023 at 20:12)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128530569">PR review comment</a>:</p>
<blockquote>
<p>Ah I see, I didn't realize that the initial version of <code>isa_flags</code> is this builder returned from <code>cranelift_native</code> but any time you call <code>target</code> uses the <code>lookup</code> function from the <code>isa</code> module <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> I'll have to rework this a bit so the caller can pass an initial builder that might differ from the one <code>lookup</code> returns.</p>
</blockquote>



<a name="340204141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340204141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340204141">(Mar 07 2023 at 20:13)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329455708">PR review</a>.</p>



<a name="340204143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340204143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340204143">(Mar 07 2023 at 20:13)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128531699">PR review comment</a>:</p>
<blockquote>
<p>So my commit messed a few things on the <code>winch</code> side that's making me think the borrowed version might be a bit easier. Needing to <code>clone</code> the builder in a call is a bit tricky, since the winch and Cranelift currently use different return types with the <code>IsaBuilder</code>. I could unify them in theory, but I'm thinking it might be better to use the borrowing strategy here while we are still figuring what needs to be common.</p>
</blockquote>



<a name="340205606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340205606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340205606">(Mar 07 2023 at 20:22)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340205641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340205641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340205641">(Mar 07 2023 at 20:22)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329468321">PR review</a>.</p>



<a name="340205646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340205646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340205646">(Mar 07 2023 at 20:22)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128541571">PR review comment</a>:</p>
<blockquote>
<p>Ah nvm on that, I see your previous change with the <code>infer_native_flags</code>. I've added this back in</p>
</blockquote>



<a name="340216315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340216315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340216315">(Mar 07 2023 at 21:20)</a>:</h4>
<p>KevinRizzoTO edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128531699">PR review comment</a>.</p>



<a name="340224702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340224702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340224702">(Mar 07 2023 at 22:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329625958">PR review</a>.</p>



<a name="340226936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340226936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340226936">(Mar 07 2023 at 22:30)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340227141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340227141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340227141">(Mar 07 2023 at 22:32)</a>:</h4>
<p>KevinRizzoTO submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329655072">PR review</a>.</p>



<a name="340227143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340227143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340227143">(Mar 07 2023 at 22:32)</a>:</h4>
<p>KevinRizzoTO created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128678956">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton @saulecabrera let me know if this works to add this here to pass merge queue CI, or if we should be adding <code>publish = false</code> to the new <code>Cargo.toml</code> file</p>
</blockquote>



<a name="340229857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340229857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340229857">(Mar 07 2023 at 22:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#pullrequestreview-1329677260">PR review</a>.</p>



<a name="340229859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340229859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340229859">(Mar 07 2023 at 22:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5944#discussion_r1128703067">PR review comment</a>:</p>
<blockquote>
<p>Yeah this is the expected fix</p>
</blockquote>



<a name="340229868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340229868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340229868">(Mar 07 2023 at 22:51)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a>.</p>



<a name="340372846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340372846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340372846">(Mar 08 2023 at 14:17)</a>:</h4>
<p>KevinRizzoTO updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a> from <code>compiler-refactor</code> to <code>main</code>.</p>



<a name="340399401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235944%20winch%3A%20Refactoring%20wasmtime%20compiler%20.../near/340399401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235944.20winch.3A.20Refactoring.20wasmtime.20compiler.20.2E.2E.2E.html#340399401">(Mar 08 2023 at 15:51)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5944">PR #5944</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>