<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2323 Rewrite interpreter generically · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html">wasmtime / PR #2323 Rewrite interpreter generically</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="214532244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/214532244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#214532244">(Oct 26 2020 at 04:31)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="214532245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/214532245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#214532245">(Oct 26 2020 at 04:31)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a>.</p>



<a name="214617151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/214617151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#214617151">(Oct 26 2020 at 18:48)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="214638803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/214638803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#214638803">(Oct 26 2020 at 22:01)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="214749703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/214749703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#214749703">(Oct 27 2020 at 19:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="215133271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133271">(Oct 30 2020 at 18:25)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-520838161">PR Review</a>.</p>



<a name="215133272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133272">(Oct 30 2020 at 18:25)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-520838161">PR Review</a>.</p>



<a name="215133273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133273">(Oct 30 2020 at 18:25)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515226424">PR Review Comment</a>:</p>
<blockquote>
<p>You should be able to avoid the <code>is_nan()</code> checks and just defer to <code>f32</code>'s <code>PartialOrd</code> implementation, as it does these same NaN checks.</p>
</blockquote>



<a name="215133275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133275">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515240978">PR Review Comment</a>:</p>
<blockquote>
<p>seems like this doc comment never got finished</p>
</blockquote>



<a name="215133276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133276">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515236857">PR Review Comment</a>:</p>
<blockquote>
<p>It seems strange that we have an empty <code>Interpreter</code> struct and all of its methods take <code>&amp;mut InterpreterState</code> as its first parameter. It seems like it would make sense to put merge them together and make all of these methods take <code>&amp;mut self</code>. I see this is <em>sort of</em> similar to what used to exist, so I'm unclear on the motivation for the split as it currently is written.</p>
</blockquote>



<a name="215133277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133277">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515228552">PR Review Comment</a>:</p>
<blockquote>
<p>It seems strange that the interpreter enables all target architectures. I would expect it to be possible to enable <em>none</em> of them, and simply use the interpreter to execute target-independent clif.</p>
</blockquote>



<a name="215133278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133278">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515226612">PR Review Comment</a>:</p>
<blockquote>
<p>ditto</p>
</blockquote>



<a name="215133279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133279">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515277064">PR Review Comment</a>:</p>
<blockquote>
<p>This code is really macro heavy. I understand the draw here: there is a lot of duplication going on. But it is pretty hard to understand, with all of the implicitly closed over arguments, and macro rules being kinda hard to read in general.</p>
<p>Would it be possible to refactor these helpers into closures? I think that would help readability a bunch. For example the <code>arg!</code> macro and calls like <code>arg!(1)</code> would become</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">value_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">args</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">state</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">value_ref</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">ok_or</span><span class="p">(</span><span class="n">StepError</span>::<span class="n">UnknownValue</span><span class="p">(</span><span class="n">value_ref</span><span class="p">))</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="n">arg</span><span class="p">(</span><span class="n">inst_context</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="w"></span>
</code></pre></div>

<p>(You may have to add some type annotations to the closures, but I think it would be an improvement nonetheless)</p>
<p>Also a quick sentence in a documentation comment for each helper would help readers understand what they're looking at here.</p>
</blockquote>



<a name="215133280"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133280" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133280">(Oct 30 2020 at 18:25)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515225499">PR Review Comment</a>:</p>
<blockquote>
<p>Any reason in particular not to do this instead:</p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        f32::from_bits(self.0).is_nan()
</code></pre></div>

<p>?</p>
</blockquote>



<a name="215133281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133281">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515280669">PR Review Comment</a>:</p>
<blockquote>
<p>ditto</p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                _ =&gt; unreachable!(),
</code></pre></div>

</blockquote>



<a name="215133282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133282">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515253781">PR Review Comment</a>:</p>
<blockquote>
<p>I feel like this trait's overview documentation could use some love:</p>
<ul>
<li>Explain <em>why</em> the interpreter is generic over a trait, and what this enables</li>
<li>Give an overview of the different things that the trait abstracts -- frames, values, flags, heap memory, and stack memory -- and what they are and how they're used.</li>
<li>A sketch of an example of implementing this trait (def not full impl, just informative sketch) for simple abstract interpretation (maybe signedness of values only and ignoring memory/flags/etc?) and a link to concrete implementations that exist.</li>
</ul>
</blockquote>



<a name="215133283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133283">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515279099">PR Review Comment</a>:</p>
<blockquote>
<p>because other opcodes should actually be impossible:</p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                _ =&gt; unreachable!(),
</code></pre></div>

</blockquote>



<a name="215133284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215133284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215133284">(Oct 30 2020 at 18:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515286359">PR Review Comment</a>:</p>
<blockquote>
<p>Out of curiosity, how do your static analyses handle control flow joins and loops? I don't see anything in this interpreter to handle that.</p>
</blockquote>



<a name="215266111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266111">(Nov 01 2020 at 22:39)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521269229">PR Review</a>.</p>



<a name="215266112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266112">(Nov 01 2020 at 22:39)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515682034">PR Review Comment</a>:</p>
<blockquote>
<p>Yup, that makes more sense--changed them. I've been thinking a lot about how to interpret FP arithmetic correctly (e.g. apfloat, softfloat) so I started thinking that I would have to be very explicit everywhere.</p>
</blockquote>



<a name="215266118"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266118" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266118">(Nov 01 2020 at 22:39)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521269246">PR Review</a>.</p>



<a name="215266119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266119">(Nov 01 2020 at 22:39)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515682057">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>
</blockquote>



<a name="215266230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266230">(Nov 01 2020 at 22:41)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521269433">PR Review</a>.</p>



<a name="215266231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266231">(Nov 01 2020 at 22:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515682305">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, we should remove this once the old x86 backend goes away. I only had to enable this because otherwise somewhere in the CI a non-x86 build is triggered that doesn't contain all of the <code>Opcode::X86...</code> variants, causing compilation failures.</p>
</blockquote>



<a name="215266853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266853">(Nov 01 2020 at 22:57)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521270910">PR Review</a>.</p>



<a name="215266854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215266854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215266854">(Nov 01 2020 at 22:57)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515684133">PR Review Comment</a>:</p>
<blockquote>
<p>Good point. I think I was running into lifetime issues and went the static method route to resolve them. I've changed them back now to <code>&amp;mut self</code>.</p>
</blockquote>



<a name="215267773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215267773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215267773">(Nov 01 2020 at 23:20)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521273088">PR Review</a>.</p>



<a name="215267774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215267774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215267774">(Nov 01 2020 at 23:20)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515686703">PR Review Comment</a>:</p>
<blockquote>
<p>Yup... this was left a bit unfinished because I was (and am still) debating whether this should be a tree of traits instead of a single level. For example, <code>State</code> could contain <code>fn iflags() -&gt; impl Flags&lt;IntCC&gt;</code> and then separately I could define <code>has/set/clear</code> for <code>Flags</code>. Why I haven't done this? I'm concerned that, since <code>impl Flags</code> is likely not correct (though it expresses what I mean), I will be caught up in <code>dyn</code> issues, possible lifetime issues, mutable vs. non-mutable issues, etc. Do you have an opinion on this? </p>
</blockquote>



<a name="215268375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215268375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215268375">(Nov 01 2020 at 23:36)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="215276526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215276526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215276526">(Nov 02 2020 at 03:30)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="215279406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215279406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215279406">(Nov 02 2020 at 04:53)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="215279507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215279507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215279507">(Nov 02 2020 at 04:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521331385">PR Review</a>.</p>



<a name="215279508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215279508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215279508">(Nov 02 2020 at 04:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515740085">PR Review Comment</a>:</p>
<blockquote>
<p>Ok, I replaced the macros with closures in 5a121dd. I like the idea of closures better than macros but it made a few things a bit harder to read so I left it as a separate commit in case we want to revert.</p>
</blockquote>



<a name="215279657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215279657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215279657">(Nov 02 2020 at 05:01)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521332557">PR Review</a>.</p>



<a name="215279658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215279658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215279658">(Nov 02 2020 at 05:01)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r515741110">PR Review Comment</a>:</p>
<blockquote>
<p>In the constant folding code, I added a <code>PhiValues</code> structure that scans through a function twice, first to capture all block parameters and secondly to map the SSA values that could be inputs to those block parameters (e.g. from a <code>jump</code>). I perform lookups into that mapping when I need to join. Perhaps there is something like <code>PhiValues</code> somewhere but I couldn't find it?</p>
</blockquote>



<a name="215352725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215352725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215352725">(Nov 02 2020 at 17:41)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521857471">PR Review</a>.</p>



<a name="215352726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215352726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215352726">(Nov 02 2020 at 17:41)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r516147059">PR Review Comment</a>:</p>
<blockquote>
<p>FYI, traits can't contain <code>-&gt; impl Trait</code> methods, you would have to have an associated type that is returned instead:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">trait</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">type</span> <span class="nc">IFlags</span>: <span class="nc">IFlagsState</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">iflags</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">Self</span>::<span class="n">Iflags</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// etc...</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I generally don't think it is worth it to do this sort of thing unless there is code that will be generic over just <code>IFlagsState</code> and not the whole <code>State</code>, which I suspect isn't the case here.</p>
</blockquote>



<a name="215353248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215353248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215353248">(Nov 02 2020 at 17:45)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521860519">PR Review</a>.</p>



<a name="215353249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215353249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215353249">(Nov 02 2020 at 17:45)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r516149700">PR Review Comment</a>:</p>
<blockquote>
<p>We don't have anything generic AFAIK, but you could take a look at the LICM and GVN implementations and see if they have anything we can factor out.</p>
<p>I must admit that I'm more interested in the design of the trait though. Don't have anything off the top of my head, just think it will need something like a <code>join</code> or <code>meet</code> method depending which way we are modeling our lattices, as well as a "should I take both branches?" predicate.</p>
</blockquote>



<a name="215363079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215363079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215363079">(Nov 02 2020 at 19:03)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521915570">PR Review</a>.</p>



<a name="215363080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215363080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215363080">(Nov 02 2020 at 19:03)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r516192859">PR Review Comment</a>:</p>
<blockquote>
<p>I'll upstream that constant folding after this PR is merged and we can iterate on the design.</p>
</blockquote>



<a name="215364378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215364378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215364378">(Nov 02 2020 at 19:13)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a> from <code>generic-interpreter</code> to <code>main</code>:</p>
<blockquote>
<p>This change re-implements the Cranelift interpreter to use generic values; this makes it possible to do abstract interpretation of Cranelift instructions. In doing so, the interpretation state is extracted from the <code>Interpreter</code> structure and is accessed via a <code>State</code> trait; this makes it possible to not only more clearly observe the interpreter's state but also to interpret using a dummy state (e.g. <code>ImmutableRegisterState</code>). This addition made it possible to implement more of the Cranelift instructions (~70%, ignoring the x86-specific instructions).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="215364537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215364537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215364537">(Nov 02 2020 at 19:14)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#pullrequestreview-521922367">PR Review</a>.</p>



<a name="215364538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215364538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215364538">(Nov 02 2020 at 19:14)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2323#discussion_r516198175">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> I documented it better and left it as-is.</p>
</blockquote>



<a name="215373820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232323%20Rewrite%20interpreter%20generically/near/215373820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232323.20Rewrite.20interpreter.20generically.html#215373820">(Nov 02 2020 at 20:28)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2323">PR #2323</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>