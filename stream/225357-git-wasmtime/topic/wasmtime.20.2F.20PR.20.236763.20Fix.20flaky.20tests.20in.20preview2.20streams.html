<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6763 Fix flaky tests in preview2 streams · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html">wasmtime / PR #6763 Fix flaky tests in preview2 streams</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="378283351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378283351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378283351">(Jul 24 2023 at 21:52)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a> from <code>bytecodealliance:pch/preview2_streams_flaky_tests</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>#6556 introduced (at least) 2 flaky tests:</p>
<ul>
<li>I made a bug in the <code>sink_write_stream</code> test in pipes. This test has been fixed, and the comment describes the race.</li>
<li><code>poll_oneoff_stdio</code> is failing non-deterministically in CI. We have only observed the failures in macos, but we don't yet have a way to reproduce this bug. The test is marked as ignore on macos for now.</li>
</ul>
</blockquote>



<a name="378283352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378283352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378283352">(Jul 24 2023 at 21:52)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378283353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378283353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378283353">(Jul 24 2023 at 21:52)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378285129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378285129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378285129">(Jul 24 2023 at 22:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6763#pullrequestreview-1544345925">PR review</a>.</p>



<a name="378285135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378285135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378285135">(Jul 24 2023 at 22:05)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378289744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378289744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378289744">(Jul 24 2023 at 22:38)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378289866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378289866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378289866">(Jul 24 2023 at 22:39)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>:</p>
<blockquote>
<p>#6556 introduced (at least) 2 flaky tests:</p>
<ul>
<li>I made a bug in the <code>sink_write_stream</code> test in pipes. This test has been fixed, and the comment describes the race.</li>
<li><code>poll_oneoff_stdio</code> is failed nondeterministically in the <code>wasi-preview2-components-sync</code> suite. We found a typo in the sync-to-async translation that caused this bug.</li>
</ul>
<p>Thanks @silentbicycle, we used autoclave to reproduce this after a few hundred iterations:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">RUST_LOG</span><span class="o">=</span><span class="n">wasmtime_wasi</span><span class="o">=</span><span class="n">trace</span><span class="w"> </span><span class="n">autoclave</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">test_programs</span><span class="w"> </span><span class="o">--</span><span class="n">test</span><span class="w"> </span><span class="n">wasi</span><span class="o">-</span><span class="n">preview2</span><span class="o">-</span><span class="n">components</span><span class="o">-</span><span class="n">sync</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">poll_oneoff_stdio</span><span class="w"> </span><span class="o">--</span><span class="n">nocapture</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="378289875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378289875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378289875">(Jul 24 2023 at 22:39)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378289997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378289997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378289997">(Jul 24 2023 at 22:40)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6763#pullrequestreview-1544384916">PR review</a>.</p>



<a name="378290137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378290137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378290137">(Jul 24 2023 at 22:42)</a>:</h4>
<p>pchickey has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<a name="378296691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236763%20Fix%20flaky%20tests%20in%20preview2%20streams/near/378296691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236763.20Fix.20flaky.20tests.20in.20preview2.20streams.html#378296691">(Jul 24 2023 at 23:39)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6763">PR #6763</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>