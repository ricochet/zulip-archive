<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6939 cranelift-interpreter: Fix SIMD shift... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html">wasmtime / PR #6939 cranelift-interpreter: Fix SIMD shift...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="388302368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388302368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388302368">(Aug 31 2023 at 11:28)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a> from <code>afonso360:fuzz-more-ops</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR fixes the <code>ishl</code>/<code>{s,u}shr</code> instructions for SIMD in the interpreter. The main issue is that while the LHS is a vector the RHS is a scalar and that was causing issues. The solution is to splat the RHS into a similar sized vector and perform the normal operation individually.</p>
<p>This PR also enables these operations in fuzzgen. As well as <code>ineg</code> (fixed in #6844) and <code>bitselect</code> with floats (which was working previously)</p>
</blockquote>



<a name="388302371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388302371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388302371">(Aug 31 2023 at 11:28)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<a name="388302373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388302373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388302373">(Aug 31 2023 at 11:28)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<a name="388302404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388302404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388302404">(Aug 31 2023 at 11:29)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR fixes the <code>ishl</code>/<code>{s,u}shr</code>/<code>rot{r,l}</code> instructions for SIMD in the interpreter. The main issue is that while the LHS is a vector the RHS is a scalar and that was causing issues. The solution is to splat the RHS into a similar sized vector and perform the normal operation individually.</p>
<p>This PR also enables these operations in fuzzgen. As well as <code>ineg</code> (fixed in #6844) and <code>bitselect</code> with floats (which was working previously)</p>
</blockquote>



<a name="388302457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388302457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388302457">(Aug 31 2023 at 11:29)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR fixes the <code>ishl</code>/<code>{s,u}shr</code>/<code>rot{r,l}</code> instructions for SIMD in the interpreter. The main issue is that while the LHS is a vector the RHS is a scalar and by default we perform the operations lanewise. The solution is to splat the RHS into a similar sized vector and perform the normal operation individually.</p>
<p>This PR also enables these operations in fuzzgen. As well as <code>ineg</code> (fixed in #6844) and <code>bitselect</code> with floats (which was working previously)</p>
</blockquote>



<a name="388320077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388320077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388320077">(Aug 31 2023 at 13:05)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<a name="388361641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388361641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388361641">(Aug 31 2023 at 16:17)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6939#pullrequestreview-1605122410">PR review</a>:</p>
<blockquote>
<p>I like this approach and also it's always nice to enable more in fuzzgen. Thanks!</p>
</blockquote>



<a name="388361643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388361643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388361643">(Aug 31 2023 at 16:17)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6939#pullrequestreview-1605122410">PR review</a>:</p>
<blockquote>
<p>I like this approach and also it's always nice to enable more in fuzzgen. Thanks!</p>
</blockquote>



<a name="388361645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388361645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388361645">(Aug 31 2023 at 16:17)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/6939#discussion_r1311862659">PR review comment</a>:</p>
<blockquote>
<p>Not important but I think I'd find it easier to understand this match arm (and similar ones below) if written this way:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                    &amp;[I8X16 | I16X8 | I32X4 | I64X2, I128]
</code></pre></div><br>
</p>
</blockquote>



<a name="388364213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388364213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388364213">(Aug 31 2023 at 16:28)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<a name="388364260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388364260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388364260">(Aug 31 2023 at 16:28)</a>:</h4>
<p>afonso360 has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<a name="388378852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236939%20cranelift-interpreter%3A%20Fix%20SIMD%20shift.../near/388378852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236939.20cranelift-interpreter.3A.20Fix.20SIMD.20shift.2E.2E.2E.html#388378852">(Aug 31 2023 at 17:56)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6939">PR #6939</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>