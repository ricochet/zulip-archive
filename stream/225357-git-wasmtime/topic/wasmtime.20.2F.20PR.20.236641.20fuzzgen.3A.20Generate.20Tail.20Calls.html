<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6641 fuzzgen: Generate Tail Calls · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html">wasmtime / PR #6641 fuzzgen: Generate Tail Calls</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="369504957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369504957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369504957">(Jun 25 2023 at 21:05)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a> from <code>afonso360:fuzzgen-tail-calls</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR is a follow up to  #6635 and it allows fuzzgen to generate <code>return_call</code> and <code>return_indirect_call</code> instructions. These are modeled as any other control flow instruction however they have a bunch of restrictions before we are actually able to insert them.</p>
<p>I'm opening this as a draft since it has found some issues and I can't run it for too long before it crashes, and I'm not entirely sure it's generating correct code under all inputs. Just leaving this open if anyone wants to test with it (@fitzgen  <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> ).<br>
</p>
</blockquote>



<a name="369504959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369504959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369504959">(Jun 25 2023 at 21:05)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="369504961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369504961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369504961">(Jun 25 2023 at 21:05)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="369504963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369504963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369504963">(Jun 25 2023 at 21:05)</a>:</h4>
<p><strong>afonso360</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="369505381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369505381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369505381">(Jun 25 2023 at 21:09)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR is a follow up to  #6635 and it allows fuzzgen to generate <code>return_call</code> and <code>return_indirect_call</code> instructions. These are modeled as any other control flow instruction however they have a bunch of restrictions before we are actually able to insert them.</p>
<p>As with the other control flow instructions, we try to include as much info as possible in the CFG before inserting it. It doesn't seem as relevant with tail calls as it is with blocks, but I figured it is still worth it. (The alternative would be to pick the tail call target at instruction insertion time, but I think that would actually make this slightly more complicated)</p>
<p>I'm opening this as a draft since it has found some issues and I can't run it for too long before it crashes, and I'm not entirely sure it's generating correct code under all inputs. Just leaving this open if anyone wants to test with it (@fitzgen  <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> ).<br>
</p>
</blockquote>



<a name="369583348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/369583348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#369583348">(Jun 26 2023 at 07:06)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="370173886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370173886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370173886">(Jun 27 2023 at 18:55)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="370218994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370218994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370218994">(Jun 27 2023 at 22:19)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="370219048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370219048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370219048">(Jun 27 2023 at 22:19)</a>:</h4>
<p><strong>afonso360</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a> as ready for review.</p>



<a name="370825813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370825813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370825813">(Jun 29 2023 at 15:25)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6641#pullrequestreview-1505547860">PR review</a>:</p>
<blockquote>
<p>Looks great! Thanks a ton!</p>
</blockquote>



<a name="370825816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370825816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370825816">(Jun 29 2023 at 15:25)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6641#pullrequestreview-1505547860">PR review</a>:</p>
<blockquote>
<p>Looks great! Thanks a ton!</p>
</blockquote>



<a name="370825818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370825818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370825818">(Jun 29 2023 at 15:25)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6641#discussion_r1246780958">PR review comment</a>:</p>
<blockquote>
<p>Can we maybe factor this out to a helper that checks <code>cfg!(target_pointer_width = "64")</code> and then has an <code>else</code> that panics with a helpful message? Just to future proof this a little bit.</p>
</blockquote>



<a name="370858034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370858034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370858034">(Jun 29 2023 at 17:01)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="370858464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370858464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370858464">(Jun 29 2023 at 17:02)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/6641#discussion_r1246908354">PR review comment</a>:</p>
<blockquote>
<p>Turns out we can already query the ISA's pointer type directly, so I've done just that.</p>
</blockquote>



<a name="370859000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370859000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370859000">(Jun 29 2023 at 17:04)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<a name="370899589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236641%20fuzzgen%3A%20Generate%20Tail%20Calls/near/370899589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236641.20fuzzgen.3A.20Generate.20Tail.20Calls.html#370899589">(Jun 29 2023 at 19:17)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6641">PR #6641</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>