<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2528 Add safe Memory::read and Memory::wri... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html">wasmtime / PR #2528 Add safe Memory::read and Memory::wri...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="220495481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/220495481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#220495481">(Dec 20 2020 at 00:49)</a>:</h4>
<p>theduke opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> .<br>
</p>
</blockquote>



<a name="220495533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/220495533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#220495533">(Dec 20 2020 at 00:50)</a>:</h4>
<p>theduke edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="220496237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/220496237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#220496237">(Dec 20 2020 at 01:11)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="221548204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221548204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221548204">(Jan 04 2021 at 16:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561176595">PR Review</a>.</p>



<a name="221548205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221548205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221548205">(Jan 04 2021 at 16:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551435286">PR Review Comment</a>:</p>
<blockquote>
<p>Could this documentation detail the error cases as well? It also might be good to mention that the size of the copy is the size of the buffer itself.</p>
</blockquote>



<a name="221548206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221548206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221548206">(Jan 04 2021 at 16:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561176595">PR Review</a>.</p>



<a name="221548207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221548207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221548207">(Jan 04 2021 at 16:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551434519">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I don't think that we'll ever need this error because we'll basically be implementing <code>memory.copy</code> semantics which would never need an error for this.</p>
</blockquote>



<a name="221548208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221548208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221548208">(Jan 04 2021 at 16:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551435547">PR Review Comment</a>:</p>
<blockquote>
<p>I think here this will want to use <code>checked_add</code> to avoid overflow.</p>
</blockquote>



<a name="221567668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221567668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221567668">(Jan 04 2021 at 19:19)</a>:</h4>
<p>theduke submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561277155">PR Review</a>.</p>



<a name="221567669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221567669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221567669">(Jan 04 2021 at 19:19)</a>:</h4>
<p>theduke created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551515342">PR Review Comment</a>:</p>
<blockquote>
<p>In that case ... should the error just be a struct? </p>
<p>I don't see any other relevant error conditions.</p>
</blockquote>



<a name="221568170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221568170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221568170">(Jan 04 2021 at 19:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561279648">PR Review</a>.</p>



<a name="221568171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221568171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221568171">(Jan 04 2021 at 19:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551517266">PR Review Comment</a>:</p>
<blockquote>
<p>That's true yeah, and I think we could go ahead and have it just be an opaque structure with a singular private field so we can add more to it later if we want.</p>
</blockquote>



<a name="221571166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571166">(Jan 04 2021 at 19:46)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="221571213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571213">(Jan 04 2021 at 19:47)</a>:</h4>
<p>theduke submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561295658">PR Review</a>.</p>



<a name="221571214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571214">(Jan 04 2021 at 19:47)</a>:</h4>
<p>theduke created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551530228">PR Review Comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="221571325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571325">(Jan 04 2021 at 19:47)</a>:</h4>
<p>theduke created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551530658">PR Review Comment</a>:</p>
<blockquote>
<p>Ah yeah, I'm too used to <code>debug</code> semantics for overflow checking...</p>
<p>Both <code>read</code> and <code>write</code> now use <code>checked_add</code>.</p>
</blockquote>



<a name="221571327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571327">(Jan 04 2021 at 19:47)</a>:</h4>
<p>theduke submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561296237">PR Review</a>.</p>



<a name="221571434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571434">(Jan 04 2021 at 19:48)</a>:</h4>
<p>theduke submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561296593">PR Review</a>.</p>



<a name="221571435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571435">(Jan 04 2021 at 19:48)</a>:</h4>
<p>theduke created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551530952">PR Review Comment</a>:</p>
<blockquote>
<p>I expanded the docs for both <code>read</code> and <code>write</code> a bit.</p>
</blockquote>



<a name="221571849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221571849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221571849">(Jan 04 2021 at 19:51)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="221573507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221573507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221573507">(Jan 04 2021 at 20:04)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="221575914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221575914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221575914">(Jan 04 2021 at 20:24)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="221576599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576599">(Jan 04 2021 at 20:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561321873">PR Review</a>.</p>



<a name="221576600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576600">(Jan 04 2021 at 20:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551550735">PR Review Comment</a>:</p>
<blockquote>
<p>I think it should be ok to drop the <code>PartialEq</code> here</p>
</blockquote>



<a name="221576601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576601">(Jan 04 2021 at 20:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561321873">PR Review</a>.</p>



<a name="221576603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576603">(Jan 04 2021 at 20:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551550926">PR Review Comment</a>:</p>
<blockquote>
<p>It's ok to remove this comment, I don't think it adds much over what the existence of the <code>checked_add</code> already implies.</p>
</blockquote>



<a name="221576604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576604">(Jan 04 2021 at 20:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551551553">PR Review Comment</a>:</p>
<blockquote>
<p>Although thinking about this again, another perhaps safer way to write these methods would be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">data_unchecked</span><span class="p">().</span><span class="n">get</span><span class="p">(</span><span class="n">offset</span><span class="o">..</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="n">buffer</span><span class="p">.</span><span class="n">copy_from_slice</span><span class="p">(</span><span class="n">src</span><span class="p">);</span><span class="w"></span>
<span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
</code></pre></div>
<p>(and something similar below)</p>
</blockquote>



<a name="221576685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576685">(Jan 04 2021 at 20:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#pullrequestreview-561323563">PR Review</a>.</p>



<a name="221576686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/221576686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#221576686">(Jan 04 2021 at 20:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2528#discussion_r551552037">PR Review Comment</a>:</p>
<blockquote>
<p>Or actually to avoid having to do checked arithmetic:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">data_unchecked</span><span class="p">().</span><span class="n">get</span><span class="p">(</span><span class="n">offset</span><span class="o">..</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="o">..</span><span class="n">buffer</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="223995077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/223995077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#223995077">(Jan 26 2021 at 04:04)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="223995190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/223995190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#223995190">(Jan 26 2021 at 04:07)</a>:</h4>
<p>theduke updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a> from <code>issue-2484-safe-memory-access</code> to <code>main</code>:</p>
<blockquote>
<p>Introduce <code>Memory::read</code> and <code>Memory::write</code> methods for accessing memory contents safely.</p>
<p>Also adds a test and mentions the  the new methods in the <code>Memory</code> docs.</p>
<p>Fixes #2484.</p>
<p>Currently most fallible methods use <code>anyhow::Error</code>. <br>
I have instead added a new <code>MemoryError</code>, since recovering from such errors is possible and it's more expressive.<br>
(future proofed with <code>#[non_exhaustive]</code>).</p>
<p>Could to change it to a <code>anyhow::Error</code> if that's the preferred strategy (or wrap the MemoryError with anyhow).</p>
<p>I also already added a <code>MemoryError::Locked</code> variant, which is not required yet, but apparently will be once threading support lands. Happy to remove it or slap on a <code>#[doc(hidden)]</code> to prevent confusion.<br>
</p>
</blockquote>



<a name="224052056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232528%20Add%20safe%20Memory%3A%3Aread%20and%20Memory%3A%3Awri.../near/224052056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232528.20Add.20safe.20Memory.3A.3Aread.20and.20Memory.3A.3Awri.2E.2E.2E.html#224052056">(Jan 26 2021 at 15:09)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2528">PR #2528</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>