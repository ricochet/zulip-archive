<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9263 Use `instrument` in generated `call_`... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html">wasmtime / PR #9263 Use `instrument` in generated `call_`...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="470822481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470822481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470822481">(Sep 17 2024 at 03:37)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a> from <code>elliottt:trevor/instrument-call-functions</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Following on from #9217, generate <code>call_*</code> functions that use <code>tracing::Instrument</code> instead of <code>Span::enter</code>.</p>
<p>To test this change I added an additional set of generated files that corresponds to the combination of <code>async: true</code> and <code>tracing: true</code>. This way we can verify that the changes in #9217 and this PR remove uses of <code>Span::enter</code> from the code generated by the <code>bindgen!</code> macro.<br>
</p>
</blockquote>



<a name="470822483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470822483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470822483">(Sep 17 2024 at 03:37)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>.</p>



<a name="470822485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470822485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470822485">(Sep 17 2024 at 03:37)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>.</p>



<a name="470822646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470822646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470822646">(Sep 17 2024 at 03:38)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>.</p>



<a name="470822736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470822736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470822736">(Sep 17 2024 at 03:39)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>:</p>
<blockquote>
<p>Following on from #9217, generate <code>call_*</code> functions that use <code>tracing::Instrument</code> instead of <code>Span::enter</code>.</p>
<p>To test this change I added an additional set of generated files that corresponds to the combination of <code>async: true</code> and <code>tracing: true</code>. This way we can verify that the changes in #9217 and this PR remove uses of <code>Span::enter</code> from the code generated by the <code>bindgen!</code> macro.</p>
<p>The additional exp files add an awful lot to this diff, and I think it would be reasonable to remove them before merging. The meat of the changes is in the middle commit, 4c1a4f0998b8f3ebca9e6873a781be69a9121a82.</p>
</blockquote>



<a name="470854844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470854844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470854844">(Sep 17 2024 at 03:55)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>:</p>
<blockquote>
<p>Following on from #9217, generate <code>call_*</code> functions that use <code>tracing::Instrument</code> instead of <code>Span::enter</code>.</p>
<p>To test this change I added an additional set of generated files that corresponds to the combination of <code>async: true</code> and <code>tracing: true</code>. This way we can verify that the changes in #9217 and this PR remove uses of <code>Span::enter</code> from the code generated by the <code>bindgen!</code> macro.</p>
<p>The additional exp files add an awful lot to this diff, and I think it would be reasonable to remove them before merging. The meat of the changes is in the middle commit, 4c1a4f0998b8f3ebca9e6873a781be69a9121a82, and the final commit shows the differences to the generated code that the middle commit introduces. I believe this catches all outstanding uses of <code>enter</code> for the combination of <code>async: true</code> and <code>tracing: true</code>.</p>
</blockquote>



<a name="470856648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470856648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470856648">(Sep 17 2024 at 04:00)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9263#pullrequestreview-2308206077">PR review</a>.</p>



<a name="470856649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470856649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470856649">(Sep 17 2024 at 04:00)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9263#discussion_r1762249767">PR review comment</a>:</p>
<blockquote>
<p>This all feels a bit verbose, but it seemed slightly easier to read than the version where I inlined the conditional into the args to the format string. Happy to add the inlined version if that's preferred.</p>
</blockquote>



<a name="470862961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470862961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470862961">(Sep 17 2024 at 04:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9263#pullrequestreview-2308230924">PR review</a>.</p>



<a name="470872148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239263%20Use%20%60instrument%60%20in%20generated%20%60call_%60.../near/470872148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239263.20Use.20.60instrument.60.20in.20generated.20.60call_.60.2E.2E.2E.html#470872148">(Sep 17 2024 at 05:19)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9263">PR #9263</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>