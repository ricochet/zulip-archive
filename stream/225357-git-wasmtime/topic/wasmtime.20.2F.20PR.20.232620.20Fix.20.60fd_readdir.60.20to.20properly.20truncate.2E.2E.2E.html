<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2620 Fix `fd_readdir` to properly truncate... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html">wasmtime / PR #2620 Fix `fd_readdir` to properly truncate...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="224390199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224390199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224390199">(Jan 28 2021 at 20:45)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a> from <code>fix-fd-readdir</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, <code>fd_readdir</code> was truncating directory entry names based on the<br>
calculation of <code>min(name_len, buf_len - bufused)</code>, but <code>bufused</code> was not being<br>
updated after writing in the <code>dirent</code> structure to the buffer.</p>
<p>This allowed <code>bufused</code> to be incremented beyond <code>buf_len</code> and returned as the<br>
number of bytes written to the buffer, which is invalid.</p>
<p>This fix adjusts <code>bufused</code> when the buffer is written to for the <code>dirent</code> so<br>
that name truncation happens as expected.</p>
<p>Fixes #2618.</p>
</blockquote>



<a name="224390200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224390200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224390200">(Jan 28 2021 at 20:45)</a>:</h4>
<p><strong>peterhuene</strong> requested <a href="https://github.com/sunfishcode">sunfishcode</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a>.</p>



<a name="224390539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224390539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224390539">(Jan 28 2021 at 20:48)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a> from <code>fix-fd-readdir</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, <code>fd_readdir</code> was truncating directory entry names based on the<br>
calculation of <code>min(name_len, buf_len - bufused)</code>, but <code>bufused</code> was not being<br>
updated after writing in the <code>dirent</code> structure to the buffer.</p>
<p>This allowed <code>bufused</code> to be incremented beyond <code>buf_len</code> and returned as the<br>
number of bytes written to the buffer, which is invalid.</p>
<p>This fix adjusts <code>bufused</code> when the buffer is written to for the <code>dirent</code> so<br>
that name truncation happens as expected.</p>
<p>Fixes #2618.</p>
</blockquote>



<a name="224404123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224404123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224404123">(Jan 28 2021 at 22:33)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a> from <code>fix-fd-readdir</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, <code>fd_readdir</code> was truncating directory entry names based on the<br>
calculation of <code>min(name_len, buf_len - bufused)</code>, but <code>bufused</code> was not being<br>
updated after writing in the <code>dirent</code> structure to the buffer.</p>
<p>This allowed <code>bufused</code> to be incremented beyond <code>buf_len</code> and returned as the<br>
number of bytes written to the buffer, which is invalid.</p>
<p>This fix adjusts <code>bufused</code> when the buffer is written to for the <code>dirent</code> so<br>
that name truncation happens as expected.</p>
<p>Fixes #2618.</p>
</blockquote>



<a name="224405037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224405037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224405037">(Jan 28 2021 at 22:42)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a> from <code>fix-fd-readdir</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, <code>fd_readdir</code> was truncating directory entry names based on the<br>
calculation of <code>min(name_len, buf_len - bufused)</code>, but <code>bufused</code> was not being<br>
updated after writing in the <code>dirent</code> structure to the buffer.</p>
<p>This allowed <code>bufused</code> to be incremented beyond <code>buf_len</code> and returned as the<br>
number of bytes written to the buffer, which is invalid.</p>
<p>This fix adjusts <code>bufused</code> when the buffer is written to for the <code>dirent</code> so<br>
that name truncation happens as expected.</p>
<p>Fixes #2618.</p>
</blockquote>



<a name="224775198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224775198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224775198">(Feb 01 2021 at 19:06)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2620#pullrequestreview-580675125">PR Review</a>.</p>



<a name="224775199"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224775199" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224775199">(Feb 01 2021 at 19:06)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2620#discussion_r568069966">PR Review Comment</a>:</p>
<blockquote>
<p>the <code>buf.add(dirent_copy_len)?</code> performs this overflow check, so bufused doesnt have to have a checked add</p>
</blockquote>



<a name="224775329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224775329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224775329">(Feb 01 2021 at 19:07)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2620#pullrequestreview-580676197">PR Review</a>.</p>



<a name="224775331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224775331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224775331">(Feb 01 2021 at 19:07)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2620#discussion_r568070778">PR Review Comment</a>:</p>
<blockquote>
<p>same here, no need to check the add</p>
</blockquote>



<a name="224775728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224775728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224775728">(Feb 01 2021 at 19:10)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2620#pullrequestreview-580678149">PR Review</a>.</p>



<a name="224780215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224780215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224780215">(Feb 01 2021 at 19:41)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a> from <code>fix-fd-readdir</code> to <code>main</code>:</p>
<blockquote>
<p>Previously, <code>fd_readdir</code> was truncating directory entry names based on the<br>
calculation of <code>min(name_len, buf_len - bufused)</code>, but <code>bufused</code> was not being<br>
updated after writing in the <code>dirent</code> structure to the buffer.</p>
<p>This allowed <code>bufused</code> to be incremented beyond <code>buf_len</code> and returned as the<br>
number of bytes written to the buffer, which is invalid.</p>
<p>This fix adjusts <code>bufused</code> when the buffer is written to for the <code>dirent</code> so<br>
that name truncation happens as expected.</p>
<p>Fixes #2618.</p>
</blockquote>



<a name="224786190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232620%20Fix%20%60fd_readdir%60%20to%20properly%20truncate.../near/224786190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232620.20Fix.20.60fd_readdir.60.20to.20properly.20truncate.2E.2E.2E.html#224786190">(Feb 01 2021 at 20:29)</a>:</h4>
<p>peterhuene merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2620">PR #2620</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>