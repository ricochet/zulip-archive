<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4537 implement fuzzing for component types · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html">wasmtime / PR #4537 implement fuzzing for component types</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="291350834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291350834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291350834">(Jul 29 2022 at 16:48)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>:</p>
<blockquote>
<p>This is the first part of my work to address #4307.  We now generate 1000<br>
arbitrary types and tests for those types at build time.  Each test includes a<br>
component which imports and exports functions that take and return its<br>
respective type.  The exported function calls the imported function, which is<br>
implemented by the host, and the host verifies that both the host function<br>
argument and the guest function return value match the original input value.</p>
<p>In terms of #4307, this includes the test case generator and the static API<br>
oracle.  I'll follow up with a dynamic API oracle in a subsequent PR.</p>
<p>Signed-off-by: Joel Dice &lt;<a href="mailto:joel.dice@fermyon.com">joel.dice@fermyon.com</a>&gt;</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="291350916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291350916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291350916">(Jul 29 2022 at 16:49)</a>:</h4>
<p>dicej edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>:</p>
<blockquote>
<p>This addresses #4307.</p>
<p>For the static API we generate 100 arbitrary test cases at build time, each of<br>
which includes 0-5 parameter types, a result type, and a WAT fragment containing<br>
an imported function and an exported function.  The exported function calls the<br>
imported function, which is implemented by the host.  At runtime, the fuzz test<br>
selects a test case at random and feeds it zero or more sets of arbitrary<br>
parameters and results, checking that values which flow host-to-guest and<br>
guest-to-host make the transition unchanged.</p>
<p>The fuzz test for the dynamic API follows a similar pattern, the only difference<br>
being that test cases are generated at runtime.</p>
<p>Signed-off-by: Joel Dice &lt;<a href="mailto:joel.dice@fermyon.com">joel.dice@fermyon.com</a>&gt;</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="291350981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291350981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291350981">(Jul 29 2022 at 16:49)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291358846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358846">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055863475">PR review</a>.</p>



<a name="291358847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358847">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055863475">PR review</a>.</p>



<a name="291358848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358848">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933486670">PR review comment</a>:</p>
<blockquote>
<p>It's ok to omit this if it's empty</p>
</blockquote>



<a name="291358849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358849">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933476888">PR review comment</a>:</p>
<blockquote>
<p>Is this necessary for this PR? (I think this might affect <code>cargo fuzz build --no-default-features</code> as still trying to build the spec interpreter)</p>
</blockquote>



<a name="291358851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358851">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933480643">PR review comment</a>:</p>
<blockquote>
<p>Like you mentioned in the issue this can lead to too-deep recursion in the text format. I think a better strategy might be to generate a <code>(type $name (record ...))</code> for each layer of a <code>Type</code> perhaps? That would avoid the <code>*.wast</code> limitations while still helping to fuzz super-deep type hierarchies in Wasmtime (which I think would actually be quite useful, so I'd rescind my other suggestion of limiting the depth here)</p>
</blockquote>



<a name="291358852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358852">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933488105">PR review comment</a>:</p>
<blockquote>
<p>Was this for correctnes or a refactoring? Fine either way of course, just curious for my own edification</p>
</blockquote>



<a name="291358853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358853">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933486399">PR review comment</a>:</p>
<blockquote>
<p>Currently the general style of this crate is that the <code>oracles</code> here don't take <code>Unstructured</code> but rather take a list of inputs. I think that would be  possible to do here? This would take a <code>TestCase</code> as input as well as a <code>Vec&lt;(...)&gt;</code> for inputs/outputs of each run.</p>
</blockquote>



<a name="291358854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358854">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933489517">PR review comment</a>:</p>
<blockquote>
<p>as a stylistic nit could this <code>]</code> go on a separate line?</p>
</blockquote>



<a name="291358855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358855">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933493856">PR review comment</a>:</p>
<blockquote>
<p>Currently the way time allotment on oss-fuzz works is that we're given a fixed time slice to balance between all of our fuzzing executables. In that sense the more fuzzers we have the more they take time away from other fuzzers. Since these are fuzzing the same thing in spirit could these two fuzzers be folded into one? The fuzz input could be used to determine whether the dynamic or static API could be fuzzed then I think.</p>
</blockquote>



<a name="291358856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358856">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933494969">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps be replaced with something that dynamically fills out more of the <code>bytes</code> vector when an error is encountered? Otherwise this could run into a possible issue where unrelated changes to the fuzz generator could cause this build to fail if just-the-wrong-seed is chosen.</p>
</blockquote>



<a name="291358858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291358858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291358858">(Jul 29 2022 at 17:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933493088">PR review comment</a>:</p>
<blockquote>
<p>I'm a little worried about the impact that this will have on build times because it means that <code>cargo fuzz build</code> will build all of Wasmtime once for the host and then once again for the "target". This is a case where from Cargo's perspective when you execute <code>cargo build --target $the_host_target</code> it's considered a cross-compilation and packages shared between the two are built twice.</p>
<p>Improving this situation though is likely to not really be that easy. The "easy" thing to do is to split out the bits you need from <code>wasmtime-fuzzing</code> into their own separate crate. Splitting crates though is not always the easiest and ideally the pieces you're using to generate test cases here would ideally reuse the bits from <code>wasmtime-environ</code> as well to avoid duplicating things.</p>
<p>Overall though I do think that this is something that should be solved before landing due to how heavyweight this dependency is when fuzzing. This'll link in <code>v8</code>, for example, to the build script which is no small feat.</p>
</blockquote>



<a name="291361835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291361835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291361835">(Jul 29 2022 at 18:15)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291362250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362250">(Jul 29 2022 at 18:19)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055918223">PR review</a>.</p>



<a name="291362251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362251">(Jul 29 2022 at 18:19)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933515349">PR review comment</a>:</p>
<blockquote>
<p>Oops, I didn't see this until after I wrote <a href="https://github.com/bytecodealliance/wasmtime/pull/4537/commits/8fceba5be1f00c72582b5deaf6b490e421dfc887">https://github.com/bytecodealliance/wasmtime/pull/4537/commits/8fceba5be1f00c72582b5deaf6b490e421dfc887</a>.  Should I undo that and use this approach instead?</p>
</blockquote>



<a name="291362359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362359">(Jul 29 2022 at 18:19)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055918916">PR review</a>.</p>



<a name="291362360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362360">(Jul 29 2022 at 18:19)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933515870">PR review comment</a>:</p>
<blockquote>
<p>Not sure where that came from, honestly.  I should be able to remove it.</p>
</blockquote>



<a name="291362839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362839">(Jul 29 2022 at 18:23)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055922003">PR review</a>.</p>



<a name="291362842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291362842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291362842">(Jul 29 2022 at 18:23)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933518082">PR review comment</a>:</p>
<blockquote>
<p>Correctness.  The original code meant that each argument would overwrite any that came before it in the list.  This was the first bug the fuzz tests found.</p>
</blockquote>



<a name="291363284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363284">(Jul 29 2022 at 18:26)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933524232">PR review comment</a>:</p>
<blockquote>
<p>Aah yes indeed I see the issue now!</p>
</blockquote>



<a name="291363285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363285">(Jul 29 2022 at 18:26)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055929273">PR review</a>.</p>



<a name="291363434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363434">(Jul 29 2022 at 18:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055930405">PR review</a>.</p>



<a name="291363435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363435">(Jul 29 2022 at 18:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933525021">PR review comment</a>:</p>
<blockquote>
<p>Ah sorry for giving conflicting advice! I think it would be best to exercise as interesting type hierarchies as we can (including weirdly deep ones) so I think it'd be better to skip the <code>*.wast</code>-based limits. That being said if you'd prefer to get something working first I'm definitely ok having a follow-up issue for this.</p>
</blockquote>



<a name="291363439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363439">(Jul 29 2022 at 18:28)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933525046">PR review comment</a>:</p>
<blockquote>
<p>Ugh, <a href="https://github.com/bytecodealliance/wasmtime/commit/8fceba5be1f00c72582b5deaf6b490e421dfc887">https://github.com/bytecodealliance/wasmtime/commit/8fceba5be1f00c72582b5deaf6b490e421dfc887</a> didn't really address the issue anyway, so I'll try your approach.</p>
</blockquote>



<a name="291363440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291363440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291363440">(Jul 29 2022 at 18:28)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1055930439">PR review</a>.</p>



<a name="291372534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291372534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291372534">(Jul 29 2022 at 19:50)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1056002179">PR review</a>.</p>



<a name="291372535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291372535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291372535">(Jul 29 2022 at 19:50)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933575263">PR review comment</a>:</p>
<blockquote>
<p>I'm not sure how to do that, given that we can't create an instance of <code>Val</code> without first getting the <code>Type</code>s from a <code>Func</code> from an <code>Instance</code>, and the fuzzer has no way to do that.</p>
</blockquote>



<a name="291372879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291372879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291372879">(Jul 29 2022 at 19:54)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933577153">PR review comment</a>:</p>
<blockquote>
<p>I guess I do know a way -- I used to have a <code>Value</code> enum in <code>generator::component_types</code> which could be constructed independently and then later converted to a <code>Val</code> when the <code>Type</code> was available.  I had removed that because it was redundant in the current approach, but I could restore it.</p>
</blockquote>



<a name="291372880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291372880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291372880">(Jul 29 2022 at 19:54)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1056004928">PR review</a>.</p>



<a name="291374020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291374020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291374020">(Jul 29 2022 at 20:04)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1056013564">PR review</a>.</p>



<a name="291374021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291374021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291374021">(Jul 29 2022 at 20:04)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933583182">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton How strongly do you feel about this?  I think it would require adding a substantial amount of code.</p>
</blockquote>



<a name="291383772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291383772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291383772">(Jul 29 2022 at 21:37)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291390046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291390046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291390046">(Jul 29 2022 at 22:44)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291390097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291390097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291390097">(Jul 29 2022 at 22:44)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1056124065">PR review</a>.</p>



<a name="291390098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291390098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291390098">(Jul 29 2022 at 22:44)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r933664476">PR review comment</a>:</p>
<blockquote>
<p>This wasn't too painful to address.  See my latest commit.</p>
</blockquote>



<a name="291593259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291593259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291593259">(Aug 01 2022 at 15:45)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291594786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594786">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934666804">PR review comment</a>:</p>
<blockquote>
<p>Given recent spec clarifications it's ok for thi sto have 0 flags, so I think it's ok to remove the "non empty" part here</p>
</blockquote>



<a name="291594787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594787">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934667304">PR review comment</a>:</p>
<blockquote>
<p>I think we'll want to allow this to have zero fields as well as <code>Flags</code> below to exercise the zero-size case.</p>
</blockquote>



<a name="291594788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594788">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057494072">PR review</a>.</p>



<a name="291594789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594789">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934667600">PR review comment</a>:</p>
<blockquote>
<p>Similar to the cases below I think that we'll want to remove this to allow testing zero-sized tuples as well.</p>
</blockquote>



<a name="291594790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594790">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934683754">PR review comment</a>:</p>
<blockquote>
<p>Ah sorry I forgot to review this in the initial first pass. We won't want to have this implementation though because the <code>IntoComponentFunc</code> impl is only intended for host functions where the component-type of the function can be statically inferred. As you have probably surmised with the lock/etc in typechecking for these functions the "dynamic" interface here doesn't really match the interface for static functions.</p>
<p>Instead what we'll want to do is something along the lines of the difference between <code>wasmtime::Func::{wrap,new}</code> where here you're defining the <code>new</code> equivalent. That will grow a new function <code>component::Linker::func_new</code> which will take the type of the function as its argument as well as a closure. The return values of the closure are then type-checked against the original type at runtime before yielding the result back to the original component.</p>
<p>This may be worth splitting to its own PR if you'd prefer. I'm also happy to review it here as well though.</p>
</blockquote>



<a name="291594791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594791">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934661087">PR review comment</a>:</p>
<blockquote>
<p>Could this be updated to match the <a href="https://github.com/WebAssembly/component-model/blob/main/design/mvp/CanonicalABI.md#size">canonical definition</a> which aligns-up the summation of the discriminant and the max variant size rather than aligning-up each individual summation? I think it probably ends up being the same thing but figure it may be best to align (heh) with the spec where we can.</p>
</blockquote>



<a name="291594792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594792">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934664298">PR review comment</a>:</p>
<blockquote>
<p>Similar comment as to above about aligning the result of the summation instead of each individual component to match the spec (although again I don't think it affects the results)</p>
</blockquote>



<a name="291594793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594793">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934668582">PR review comment</a>:</p>
<blockquote>
<p>One thing I did for the <code>fact-valid-module</code> fuzzer was to just <a href="https://github.com/bytecodealliance/wasmtime/blob/8d0224341c3336330b548c9c9e845da42a883080/crates/environ/fuzz/fuzz_targets/fact-valid-module.rs#L59">specify this as a <code>usize</code></a> as well.</p>
</blockquote>



<a name="291594795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594795">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934672362">PR review comment</a>:</p>
<blockquote>
<p>Could the seed be printed here to assist debugging in case the build script later returns an error?</p>
</blockquote>



<a name="291594796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594796">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934676568">PR review comment</a>:</p>
<blockquote>
<p>Oh right sorry yes I forgot that we need the component on-hand to generate the values. Yeah in that case the refactor isn't worth it and the current structure is good <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="291594797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291594797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291594797">(Aug 01 2022 at 15:55)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057494072">PR review</a>.</p>



<a name="291595317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291595317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291595317">(Aug 01 2022 at 15:58)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291597418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291597418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291597418">(Aug 01 2022 at 16:11)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934697455">PR review comment</a>:</p>
<blockquote>
<p>I was thinking a zero-sized tuple was just a <code>unit</code> and thus redundant.  Should we also allow zero-sized records, variants, unions, etc.?  I.e. should I remove the <code>NonEmptyArray</code> type entirely?</p>
</blockquote>



<a name="291597419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291597419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291597419">(Aug 01 2022 at 16:11)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057545710">PR review</a>.</p>



<a name="291598038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291598038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291598038">(Aug 01 2022 at 16:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057551277">PR review</a>.</p>



<a name="291598039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291598039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291598039">(Aug 01 2022 at 16:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934701144">PR review comment</a>:</p>
<blockquote>
<p>We should allow  zero-size records, yeah, but variants/unions/enums all require at least one case so the <code>NonEmptyArray</code> there is correct. You're right that in Rust an empty tuple will translate to a <code>()</code>, but for fuzzing here I think it's best to exercise as many cases as possible.</p>
</blockquote>



<a name="291610617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291610617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291610617">(Aug 01 2022 at 17:53)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291612717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291612717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291612717">(Aug 01 2022 at 18:11)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934789723">PR review comment</a>:</p>
<blockquote>
<p>Would you mind sketching out an example of how your proposed API would be used?  I'm specifically interested in where the user would get the type of the function to pass to <code>component::Linker::func_new</code>.  Would they query the <code>Component</code> for the things it imports, find the function of interest, and get the type from that?</p>
</blockquote>



<a name="291612719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291612719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291612719">(Aug 01 2022 at 18:11)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057676870">PR review</a>.</p>



<a name="291613007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291613007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291613007">(Aug 01 2022 at 18:13)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057679433">PR review</a>.</p>



<a name="291613008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291613008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291613008">(Aug 01 2022 at 18:13)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934791520">PR review comment</a>:</p>
<blockquote>
<p>Yeah that is indeed a good question. In core wasm users would do <code>FuncType::new(...)</code> and create their own function type. In the fullness of time I'd expect the same operation to be available to components where function types could be manufactured in addition to being learned from components. That's a big missing piece of the embedding API for components right now though so, yeah, getting it from a component seems the most reasonable for now.</p>
</blockquote>



<a name="291647802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291647802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291647802">(Aug 01 2022 at 23:45)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291647910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291647910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291647910">(Aug 01 2022 at 23:46)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r934998157">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton I've just pushed an update per your suggested API.  Let me know what you think.</p>
</blockquote>



<a name="291647911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291647911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291647911">(Aug 01 2022 at 23:46)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1057966694">PR review</a>.</p>



<a name="291710994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710994">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058788910">PR review</a>.</p>



<a name="291710995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710995">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935609075">PR review comment</a>:</p>
<blockquote>
<p>Personally I think that this needs to change in the future to taking the function type as the argument. That being said this works well enough for now and it's ok to extend this later, so I think this should stay as-is.</p>
<p>Otherwise though eventually this will require filling out more of the <code>component::types</code> submodule in the same manner as <code>wasmtime::types</code> which is able to describe imports/exports/etc. I think the implementation will be roughly the same as what you have already with <code>Arc&lt;Types&gt;</code> and <code>FooIndex</code> paired together, but again it's ok to defer this to later.</p>
</blockquote>



<a name="291710996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710996">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935611615">PR review comment</a>:</p>
<blockquote>
<p>Eventually I think this will need to be filled out when the function type is an argument to <code>func_new</code>. Additionally for now I think it would be good to go ahead and fill out to have an "extra layer" of defense against bugs.</p>
<p>For now I think the <code>new_dynamic</code> here could take a <code>TypeFuncIndex</code> and the implementation could basically test that the two function indices are the same (since everything comes from within the same component right now)</p>
</blockquote>



<a name="291710997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710997">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935606272">PR review comment</a>:</p>
<blockquote>
<p>Given that <code>func_new</code> is somewhat rare and already fairly verbose I think it's ok to skip the variant-without-<code>StoreContextMut</code> and go straight to requiring the argument during <code>func_new</code></p>
</blockquote>



<a name="291710998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710998">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058788910">PR review</a>.</p>



<a name="291710999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291710999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291710999">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935615130">PR review comment</a>:</p>
<blockquote>
<p>Similar to <code>TypedFunc::call</code> vs <code>Func::call</code>, is it possible to share this code with the existing entrypoint above? Given how different the parameters are represented it may be too onerous though.</p>
</blockquote>



<a name="291711000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291711000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291711000">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935618522">PR review comment</a>:</p>
<blockquote>
<p>Above the 2x2 matrix of "params direct/indirect" x "results direct/indirect" is expressed with 4 different cases but the main reason for that is to get all the fiddly bits around the types to work out. Otherwise here though this may be more amenable to a straightforward "load the params, do the call, store the result" without having to specify 4 different cases (which leads to a fair bit of duplication between everything)</p>
</blockquote>



<a name="291711001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291711001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291711001">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935612119">PR review comment</a>:</p>
<blockquote>
<p>Are these new <code>'static</code> bounds still required?</p>
</blockquote>



<a name="291711002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291711002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291711002">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935607454">PR review comment</a>:</p>
<blockquote>
<p>This looks like it's basically copying the results of <code>ty</code>, but could <code>ty</code> be used as-is? The pairing of <code>index: TypeFuncIndex</code> and <code>&amp;Arc&lt;Types&gt;</code> I think should be enough to type-check everything</p>
</blockquote>



<a name="291711003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291711003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291711003">(Aug 02 2022 at 13:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935616082">PR review comment</a>:</p>
<blockquote>
<p>Could this specify both the rhs and the lhs of the transmute? (stylistically I prefer to do that given how dangerous <code>transmute</code> is in general)</p>
</blockquote>



<a name="291714213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291714213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291714213">(Aug 02 2022 at 14:07)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935642227">PR review comment</a>:</p>
<blockquote>
<p>We need to represent them as <code>component::Type</code>s in <code>call_host_dynamic</code> in order to use <code>Type::flatten_count</code>, <code>Type::next_field</code>, <code>Val::lift</code>, <code>Val::store</code>, etc.   I figured since we'd eventually convert them to <code>component::Type</code>s anyway, might as well do it once here rather than every time <code>call_host_dynamic</code> is invoked.</p>
</blockquote>



<a name="291714214"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291714214" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291714214">(Aug 02 2022 at 14:07)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058840357">PR review</a>.</p>



<a name="291715830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291715830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291715830">(Aug 02 2022 at 14:20)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058862392">PR review</a>.</p>



<a name="291715831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291715831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291715831">(Aug 02 2022 at 14:20)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935657860">PR review comment</a>:</p>
<blockquote>
<p>That was my first thought, but I couldn't see an elegant way to do it.  With <code>Func::call</code> I was able to reuse <code>call_raw</code> by using <code>[ValRaw: MAX_FLAT_PARAMS]</code> as the <code>LowerParams</code> generic parameter.  I can't use that trick with <code>call_host</code>, though, since the space for the parameters has already been allocated by the caller.</p>
<p>There probably is a way to refactor <code>call_host</code> to work in both contexts, but I expect it would be pretty ugly.</p>
</blockquote>



<a name="291716490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291716490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291716490">(Aug 02 2022 at 14:24)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058870795">PR review</a>.</p>



<a name="291716491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291716491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291716491">(Aug 02 2022 at 14:24)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935663778">PR review comment</a>:</p>
<blockquote>
<p>Ok that seems reasonable, this can be iterated on later if necessary.</p>
</blockquote>



<a name="291716590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291716590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291716590">(Aug 02 2022 at 14:25)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058871877">PR review</a>.</p>



<a name="291716591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291716591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291716591">(Aug 02 2022 at 14:25)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935664520">PR review comment</a>:</p>
<blockquote>
<p>Ok no worries, but in that case can you duplicate some of the more interesting test cases for imports for <code>func_new</code>-defined imports as well?</p>
</blockquote>



<a name="291719310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291719310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291719310">(Aug 02 2022 at 14:45)</a>:</h4>
<p>dicej created <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#discussion_r935688403">PR review comment</a>:</p>
<blockquote>
<p>It will be required now that we're making <code>HostFunc::typecheck</code> more than a no-op for the dynamic case, since I'll need to convert the type of that field back to a <code>Box&lt;dyn Fn...&gt;</code> so it can store a closure which captures the <code>TypeFuncIndex</code>.</p>
</blockquote>



<a name="291719314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291719314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291719314">(Aug 02 2022 at 14:45)</a>:</h4>
<p>dicej submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1058906520">PR review</a>.</p>



<a name="291736380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291736380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291736380">(Aug 02 2022 at 16:49)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="291858561"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291858561" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291858561">(Aug 03 2022 at 14:35)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4537#pullrequestreview-1060422758">PR review</a>.</p>



<a name="291861821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/291861821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#291861821">(Aug 03 2022 at 14:57)</a>:</h4>
<p>dicej updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a> from <code>component-fuzz-generator</code> to <code>main</code>.</p>



<a name="292036642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234537%20implement%20fuzzing%20for%20component%20types/near/292036642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234537.20implement.20fuzzing.20for.20component.20types.html#292036642">(Aug 04 2022 at 17:02)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4537">PR #4537</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>