<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7637 `Error: failed to create memory po... ¬∑ git-wasmtime ¬∑ Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html">wasmtime / issue #7637 `Error: failed to create memory po...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="406152785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406152785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406152785">(Dec 05 2023 at 20:21)</a>:</h4>
<p><a href="https://github.com/btwiuse">btwiuse</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">Issue #7637</a>.</p>



<a name="406152788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406152788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406152788">(Dec 05 2023 at 20:21)</a>:</h4>
<p>btwiuse opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>This error was first discovered when I tried to compile and run the polkadot binary (<a href="https://github.com/paritytech/polkadot-sdk">https://github.com/paritytech/polkadot-sdk</a>) on linux aarch64 native environment.</p>
<p>The binary won't be able to work unless I change <code>--wasmtime-instantiation-strategy</code> to a non-pooling option, i.e.:</p>
<p>these don't work</p>
<ul>
<li>pooling-copy-on-write</li>
<li>pooling</li>
</ul>
<p>only these work</p>
<ul>
<li>recreate-instance-copy-on-write</li>
<li>recreate-instance</li>
<li>legacy-instance-reuse</li>
</ul>
<p>Here is what the error looks like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gear</span><span class="w"> </span><span class="o">--</span><span class="n">tmp</span><span class="w"> </span><span class="o">--</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">instantiation</span><span class="o">-</span><span class="n">strategy</span><span class="w"> </span><span class="n">pooling</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Node</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚úåÔ∏è</span><span class="w">  </span><span class="n">version</span><span class="w"> </span><span class="mf">1.0.3</span><span class="o">-</span><span class="n">b46adb6363f</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚ù§Ô∏è</span><span class="w">  </span><span class="n">by</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Technologies</span><span class="p">,</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">2023</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üìã</span><span class="w"> </span><span class="n">Chain</span><span class="w"> </span><span class="n">specification</span>: <span class="nc">Vara</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">Testnet</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üè∑</span><span class="w">  </span><span class="n">Node</span><span class="w"> </span><span class="n">name</span>: <span class="nc">ethereal</span><span class="o">-</span><span class="n">oranges</span><span class="o">-</span><span class="mi">7690</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üë§</span><span class="w"> </span><span class="n">Role</span>: <span class="nc">FULL</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üíæ</span><span class="w"> </span><span class="n">Database</span>: <span class="nc">RocksDb</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">substratesSLmp4</span><span class="o">/</span><span class="n">chains</span><span class="o">/</span><span class="n">vara_network_testnet</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">full</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚õì</span><span class="w">  </span><span class="n">Native</span><span class="w"> </span><span class="n">runtime</span>: <span class="nc">vara</span><span class="o">-</span><span class="mi">1030</span><span class="w"> </span><span class="p">(</span><span class="n">vara</span><span class="o">-</span><span class="mf">1.</span><span class="n">tx1</span><span class="p">.</span><span class="n">au1</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="err">üî®</span><span class="w"> </span><span class="n">Initializing</span><span class="w"> </span><span class="n">Genesis</span><span class="w"> </span><span class="n">block</span><span class="o">/</span><span class="n">state</span><span class="w"> </span><span class="p">(</span><span class="n">state</span>: <span class="mh">0x174f</span><span class="err">‚Ä¶</span><span class="n">af08</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-</span><span class="n">hash</span>: <span class="mh">0x5256</span><span class="err">‚Ä¶</span><span class="mi">36</span><span class="n">d6</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="err">üë¥</span><span class="w"> </span><span class="n">Loading</span><span class="w"> </span><span class="n">GRANDPA</span><span class="w"> </span><span class="n">authority</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">genesis</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">startup</span><span class="p">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">Other</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)</span>
<span class="n">Error</span>: <span class="nc">Service</span><span class="p">(</span><span class="n">Client</span><span class="p">(</span><span class="n">VersionInvalid</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)))</span>
</code></pre></div>
<p>(Using a binary from <a href="https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz">https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz</a> here cuz polkadot doesn't provide an official build for linux/aarch64, but the error is the same for polkadot)</p>
<p>The wasmtime version used by substrate is 8.0.1, and I'm able to reproduce it under the latest 15.0.1 release, so it's reasonable to assume any version in between are also affected</p>
<h3>Test Case</h3>
<p>wasmtime version: 15.0.1</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">InstanceAllocationStrategy</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_good</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// ok for both amd64 and aarch64</span>

<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">allocation_strategy</span><span class="p">(</span><span class="n">InstanceAllocationStrategy</span>::<span class="n">pooling</span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_linux_aarch64_bad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// failed for aarch64, but ok for amd64</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ol>
<li>clone <a href="https://github.com/btwiuse/wasmtime-linux-aarch64-dbg">https://github.com/btwiuse/wasmtime-linux-aarch64-dbg</a></li>
<li>cargo run under linux/amd64 environment, the program runs to completion</li>
<li>cargo run under linux/aarch64 environment, the program fails on the second <code>Engine::new(...)?</code></li>
</ol>
<h3>Expected Results</h3>
<p>the program runs to completion on both architectures</p>
<h3>Actual Results</h3>
<p>the program panics under linux/aarch64</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">mapping</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">mmap</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="mh">0x5dc80000000</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">Cannot</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 8.0.1 &amp; 15.0.1</p>
<p>Operating system: linux</p>
<p>Architecture: aarch64</p>
<h3>Extra Info</h3>
<p>If you don't have a aarch64 linux server, you can try it in a qemu virtual machine. I tested it under a aarch64 crostini vm on chromeos, and termux proot environment on Android 14.</p>
</blockquote>



<a name="406153361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406153361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406153361">(Dec 05 2023 at 20:25)</a>:</h4>
<p>btwiuse edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>This error was first discovered when I tried to compile and run the polkadot binary (<a href="https://github.com/paritytech/polkadot-sdk">https://github.com/paritytech/polkadot-sdk</a>) on linux aarch64 native environment.</p>
<p>The binary won't be able to work unless I change <code>--wasmtime-instantiation-strategy</code> to a non-pooling option, i.e.:</p>
<p>these don't work</p>
<ul>
<li>pooling-copy-on-write</li>
<li>pooling</li>
</ul>
<p>only these work</p>
<ul>
<li>recreate-instance-copy-on-write</li>
<li>recreate-instance</li>
<li>legacy-instance-reuse</li>
</ul>
<p>Here is what the error looks like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gear</span><span class="w"> </span><span class="o">--</span><span class="n">tmp</span><span class="w"> </span><span class="o">--</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">instantiation</span><span class="o">-</span><span class="n">strategy</span><span class="w"> </span><span class="n">pooling</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Node</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚úåÔ∏è</span><span class="w">  </span><span class="n">version</span><span class="w"> </span><span class="mf">1.0.3</span><span class="o">-</span><span class="n">b46adb6363f</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚ù§Ô∏è</span><span class="w">  </span><span class="n">by</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Technologies</span><span class="p">,</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">2023</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üìã</span><span class="w"> </span><span class="n">Chain</span><span class="w"> </span><span class="n">specification</span>: <span class="nc">Vara</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">Testnet</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üè∑</span><span class="w">  </span><span class="n">Node</span><span class="w"> </span><span class="n">name</span>: <span class="nc">ethereal</span><span class="o">-</span><span class="n">oranges</span><span class="o">-</span><span class="mi">7690</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üë§</span><span class="w"> </span><span class="n">Role</span>: <span class="nc">FULL</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">üíæ</span><span class="w"> </span><span class="n">Database</span>: <span class="nc">RocksDb</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">substratesSLmp4</span><span class="o">/</span><span class="n">chains</span><span class="o">/</span><span class="n">vara_network_testnet</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">full</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">19</span><span class="w"> </span><span class="err">‚õì</span><span class="w">  </span><span class="n">Native</span><span class="w"> </span><span class="n">runtime</span>: <span class="nc">vara</span><span class="o">-</span><span class="mi">1030</span><span class="w"> </span><span class="p">(</span><span class="n">vara</span><span class="o">-</span><span class="mf">1.</span><span class="n">tx1</span><span class="p">.</span><span class="n">au1</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="err">üî®</span><span class="w"> </span><span class="n">Initializing</span><span class="w"> </span><span class="n">Genesis</span><span class="w"> </span><span class="n">block</span><span class="o">/</span><span class="n">state</span><span class="w"> </span><span class="p">(</span><span class="n">state</span>: <span class="mh">0x174f</span><span class="err">‚Ä¶</span><span class="n">af08</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-</span><span class="n">hash</span>: <span class="mh">0x5256</span><span class="err">‚Ä¶</span><span class="mi">36</span><span class="n">d6</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="err">üë¥</span><span class="w"> </span><span class="n">Loading</span><span class="w"> </span><span class="n">GRANDPA</span><span class="w"> </span><span class="n">authority</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">genesis</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">startup</span><span class="p">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span>:<span class="mi">01</span>:<span class="mi">21</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">Other</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)</span>
<span class="n">Error</span>: <span class="nc">Service</span><span class="p">(</span><span class="n">Client</span><span class="p">(</span><span class="n">VersionInvalid</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)))</span>
</code></pre></div>
<p>(Using a binary from <a href="https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz">https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz</a> here cuz polkadot doesn't provide an official build for linux/aarch64, but the error is the same for polkadot)</p>
<p>The wasmtime version used by substrate is 8.0.1, and I'm able to reproduce it under the latest 15.0.1 release, so it's reasonable to assume any version in between are also affected</p>
<h3>Test Case</h3>
<p>wasmtime version: 15.0.1</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">InstanceAllocationStrategy</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_good</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// ok for both amd64 and aarch64</span>

<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">allocation_strategy</span><span class="p">(</span><span class="n">InstanceAllocationStrategy</span>::<span class="n">pooling</span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_linux_aarch64_bad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// failed for aarch64, but ok for amd64</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ol>
<li>clone <a href="https://github.com/btwiuse/wasmtime-linux-aarch64-dbg">https://github.com/btwiuse/wasmtime-linux-aarch64-dbg</a></li>
<li>cargo run under linux/amd64 environment, the program runs to completion</li>
<li>cargo run under linux/aarch64 environment, the program fails on the second <code>Engine::new(...)?</code></li>
</ol>
<h3>Expected Results</h3>
<p>the program runs to completion on both architectures</p>
<h3>Actual Results</h3>
<p>the program panics under linux/aarch64</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">mapping</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">mmap</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="mh">0x5dc80000000</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">Cannot</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 8.0.1 &amp; 15.0.1</p>
<p>Operating system: linux</p>
<p>Architecture: aarch64</p>
<h3>Extra Info</h3>
<p>If you don't have a aarch64 linux server, you can try it in a qemu virtual machine. I tested it under a aarch64 crostini vm on chromeos, and termux proot environment on a android 14 phone with 24 GB ram. I'm pretty sure the error isn't caused by insufficient memory.</p>
</blockquote>



<a name="406154627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406154627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406154627">(Dec 05 2023 at 20:35)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841573132">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>Thanks for the detailed report! The error here though could mean a number of different things, however. The two primary reasons I can think of for this failing are:</p>
<ol>
<li>ENOMEM indicates that the virtual address space was exhausted. This is unlikely given your small reproduction program but could theoretically be the case for the original program (although still unlikely).</li>
<li>ENOMEM can also indicate that the kernel ran out of memory allocating data structures tracking virtual memory usage. On Linux this can be affected by <code>sudo sysctl vm.max_map_count</code>. You can try raising that with <code>sudo sysctl vm.max_map_count=N</code> and see if that helps?</li>
</ol>
<p>If <code>sysctl</code> fixes things then either that's the fix or Wasmtime's memory pool should be configured with fewer slots. That would likely be done through the embedding that's using Wasmtime as it seems like you're probably not configuring Wasmtime directly but rather indirectly.</p>
<p>Also, FWIW, this isn't failing locally for me on arm64 Linux, so my best guess is that it's a difference in <code>sysctl vm.max_map_count</code> settings. That being said locally I had to turn that setting into the ~2k range to get failures which is well below the default 65k, so I'm not 100% sure about this.</p>
<p>Can you paste the output of <code>sysctl vm.max_map_count</code> and also provide more kernel/OS information?</p>
</blockquote>



<a name="406159251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406159251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406159251">(Dec 05 2023 at 21:06)</a>:</h4>
<p>btwiuse <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841610899">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>On my crostini vm, it shows</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span>
<span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">262144</span>
</code></pre></div>
<p>Unfortunately I can't change it because I don't have root permission on the vm host</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="o">=</span><span class="mi">333333</span>
<span class="n">sysctl</span>: <span class="nc">permission</span><span class="w"> </span><span class="n">denied</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="s">"vm.max_map_count"</span>
</code></pre></div>
<p>Here is the system info:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">btwiuse</span><span class="o">@</span><span class="n">penguin</span>:<span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="cp">$</span><span class="w"> </span><span class="n">lscpu</span>
<span class="n">Architecture</span>:                       <span class="nc">aarch64</span>
<span class="n">CPU</span><span class="w"> </span><span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                     <span class="mi">32</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="n">Byte</span><span class="w"> </span><span class="n">Order</span>:                         <span class="nc">Little</span><span class="w"> </span><span class="n">Endian</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                             <span class="mi">8</span>
<span class="n">On</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">list</span>:                <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>
<span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>:                 <span class="mi">1</span>
<span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>:                 <span class="mi">8</span>
<span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                          <span class="mi">1</span>
<span class="n">Vendor</span><span class="w"> </span><span class="n">ID</span>:                          <span class="nc">ARM</span>
<span class="n">Model</span>:                              <span class="mi">4</span>
<span class="n">Model</span><span class="w"> </span><span class="n">name</span>:                         <span class="nc">Cortex</span><span class="o">-</span><span class="n">A53</span>
<span class="n">Stepping</span>:                           <span class="nc">r0p4</span>
<span class="n">BogoMIPS</span>:                           <span class="mf">26.00</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Gather</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sampling</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Itlb</span><span class="w"> </span><span class="n">multihit</span>:        <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">L1tf</span>:                 <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Mds</span>:                  <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Meltdown</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Mmio</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="n">data</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Retbleed</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Spec</span><span class="w"> </span><span class="n">rstack</span><span class="w"> </span><span class="n">overflow</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Spec</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">bypass</span>:    <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v1</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">sanitization</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v2</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="n">predictor</span><span class="w"> </span><span class="n">hardening</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">BHB</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Srbds</span>:                <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Vulnerability</span><span class="w"> </span><span class="n">Tsx</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">abort</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="n">Flags</span>:                              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">cpuid</span>
<span class="n">btwiuse</span><span class="o">@</span><span class="n">penguin</span>:<span class="o">~/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="cp">$</span><span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">Linux</span><span class="w"> </span><span class="n">penguin</span><span class="w"> </span><span class="mf">6.1.60</span><span class="o">-</span><span class="mi">08585</span><span class="o">-</span><span class="n">g3c866855af53</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PREEMPT</span><span class="w"> </span><span class="n">Sun</span><span class="w"> </span><span class="n">Nov</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mi">17</span>:<span class="mi">38</span>:<span class="mi">41</span><span class="w"> </span><span class="n">PST</span><span class="w"> </span><span class="mi">2023</span><span class="w"> </span><span class="n">aarch64</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
</code></pre></div>
<p>![image](<a href="https://github.com/bytecodealliance/wasmtime/assets/54848194/6986bac8-9264-460b-b242-927ff837691c">https://github.com/bytecodealliance/wasmtime/assets/54848194/6986bac8-9264-460b-b242-927ff837691c</a>)</p>
</blockquote>



<a name="406159636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406159636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406159636">(Dec 05 2023 at 21:08)</a>:</h4>
<p>btwiuse <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841613940">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>My phone is not rooted, so can't get the max_map_count:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span>
<span class="n">sysctl</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">max_map_count</span>: <span class="nc">Permission</span><span class="w"> </span><span class="n">denied</span>
</code></pre></div>
<p>![image](<a href="https://github.com/bytecodealliance/wasmtime/assets/54848194/5f5355f5-25bb-48d5-b26e-0e5d6e65eaae">https://github.com/bytecodealliance/wasmtime/assets/54848194/5f5355f5-25bb-48d5-b26e-0e5d6e65eaae</a>)</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">alarm</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">Linux</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="mf">6.2.1</span><span class="o">-</span><span class="n">PRoot</span><span class="o">-</span><span class="n">Distro</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PREEMPT</span><span class="w"> </span><span class="n">Wed</span><span class="w"> </span><span class="n">Oct</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span>:<span class="mi">42</span>:<span class="mi">48</span><span class="w"> </span><span class="n">UTC</span><span class="w"> </span><span class="mi">2023</span><span class="w"> </span><span class="n">aarch64</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
<span class="p">[</span><span class="n">alarm</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">lscpu</span>
<span class="n">Architecture</span>:           <span class="nc">aarch64</span>
<span class="w">  </span><span class="n">CPU</span><span class="w"> </span><span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:       <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="w">  </span><span class="n">Byte</span><span class="w"> </span><span class="n">Order</span>:           <span class="nc">Little</span><span class="w"> </span><span class="n">Endian</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                 <span class="mi">8</span>
<span class="w">  </span><span class="n">On</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">list</span>:  <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>
<span class="n">Vendor</span><span class="w"> </span><span class="n">ID</span>:              <span class="nc">ARM</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A520</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">2</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p1</span>
<span class="w">    </span><span class="n">Frequency</span><span class="w"> </span><span class="n">boost</span>:    <span class="nc">enabled</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">25</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">2265.6001</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">364.8000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">38.40</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">atomics</span><span class="w"> </span><span class="n">fphp</span><span class="w"> </span><span class="n">asimdhp</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">asimdrdm</span><span class="w"> </span><span class="n">jscvt</span><span class="w"> </span><span class="n">fcma</span><span class="w"> </span><span class="n">lrcpc</span><span class="w"> </span><span class="n">dcpop</span><span class="w"> </span><span class="n">sha3</span><span class="w"> </span><span class="n">s</span>
<span class="w">                        </span><span class="n">m3</span><span class="w"> </span><span class="n">sm4</span><span class="w"> </span><span class="n">asimddp</span><span class="w"> </span><span class="n">sha512</span><span class="w"> </span><span class="n">asimdfhm</span><span class="w"> </span><span class="n">dit</span><span class="w"> </span><span class="n">uscat</span><span class="w"> </span><span class="n">ilrcpc</span><span class="w"> </span><span class="n">flagm</span><span class="w"> </span><span class="n">ssbs</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="n">paca</span><span class="w"> </span><span class="n">pacg</span><span class="w"> </span><span class="n">dcpodp</span><span class="w"> </span><span class="n">flagm2</span><span class="w"> </span><span class="n">frint</span><span class="w"> </span><span class="n">i8mm</span><span class="w"> </span><span class="n">bf16</span><span class="w"> </span><span class="n">dgh</span><span class="w"> </span><span class="n">bt</span>
<span class="w">                        </span><span class="n">i</span><span class="w"> </span><span class="n">ecv</span><span class="w"> </span><span class="n">afp</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A720</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">5</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p1</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">20</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">3148.8000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">499.2000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">38.40</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">atomics</span><span class="w"> </span><span class="n">fphp</span><span class="w"> </span><span class="n">asimdhp</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">asimdrdm</span><span class="w"> </span><span class="n">jscvt</span><span class="w"> </span><span class="n">fcma</span><span class="w"> </span><span class="n">lrcpc</span><span class="w"> </span><span class="n">dcpop</span><span class="w"> </span><span class="n">sha3</span><span class="w"> </span><span class="n">s</span>
<span class="w">                        </span><span class="n">m3</span><span class="w"> </span><span class="n">sm4</span><span class="w"> </span><span class="n">asimddp</span><span class="w"> </span><span class="n">sha512</span><span class="w"> </span><span class="n">asimdfhm</span><span class="w"> </span><span class="n">dit</span><span class="w"> </span><span class="n">uscat</span><span class="w"> </span><span class="n">ilrcpc</span><span class="w"> </span><span class="n">flagm</span><span class="w"> </span><span class="n">ssbs</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="n">paca</span><span class="w"> </span><span class="n">pacg</span><span class="w"> </span><span class="n">dcpodp</span><span class="w"> </span><span class="n">flagm2</span><span class="w"> </span><span class="n">frint</span><span class="w"> </span><span class="n">i8mm</span><span class="w"> </span><span class="n">bf16</span><span class="w"> </span><span class="n">dgh</span><span class="w"> </span><span class="n">bt</span>
<span class="w">                        </span><span class="n">i</span><span class="w"> </span><span class="n">ecv</span><span class="w"> </span><span class="n">afp</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="o">-</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">20</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">3302.3999</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">480.0000</span>
<span class="n">Vulnerabilities</span>:
  <span class="nc">Itlb</span><span class="w"> </span><span class="n">multihit</span>:        <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">L1tf</span>:                 <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mds</span>:                  <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Meltdown</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mmio</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="n">data</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Retbleed</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">bypass</span>:    <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">Speculative</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">Bypass</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">prctl</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v1</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">sanitization</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v2</span>:           <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Srbds</span>:                <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Tsx</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">abort</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406159709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406159709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406159709">(Dec 05 2023 at 21:09)</a>:</h4>
<p>btwiuse edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841613940">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>My phone is not rooted, so can't get the max_map_count:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span>
<span class="n">sysctl</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">max_map_count</span>: <span class="nc">Permission</span><span class="w"> </span><span class="n">denied</span>
</code></pre></div>
<p>![image](<a href="https://github.com/bytecodealliance/wasmtime/assets/54848194/5f5355f5-25bb-48d5-b26e-0e5d6e65eaae">https://github.com/bytecodealliance/wasmtime/assets/54848194/5f5355f5-25bb-48d5-b26e-0e5d6e65eaae</a>)</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">alarm</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">Linux</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="mf">6.2.1</span><span class="o">-</span><span class="n">PRoot</span><span class="o">-</span><span class="n">Distro</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PREEMPT</span><span class="w"> </span><span class="n">Wed</span><span class="w"> </span><span class="n">Oct</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="mi">10</span>:<span class="mi">42</span>:<span class="mi">48</span><span class="w"> </span><span class="n">UTC</span><span class="w"> </span><span class="mi">2023</span><span class="w"> </span><span class="n">aarch64</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
<span class="p">[</span><span class="n">alarm</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">dbg</span><span class="p">]</span><span class="cp">$</span><span class="w"> </span><span class="n">lscpu</span>
<span class="n">Architecture</span>:           <span class="nc">aarch64</span>
<span class="w">  </span><span class="n">CPU</span><span class="w"> </span><span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:       <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
<span class="w">  </span><span class="n">Byte</span><span class="w"> </span><span class="n">Order</span>:           <span class="nc">Little</span><span class="w"> </span><span class="n">Endian</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                 <span class="mi">8</span>
<span class="w">  </span><span class="n">On</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">list</span>:  <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>
<span class="n">Vendor</span><span class="w"> </span><span class="n">ID</span>:              <span class="nc">ARM</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A520</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">2</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p1</span>
<span class="w">    </span><span class="n">Frequency</span><span class="w"> </span><span class="n">boost</span>:    <span class="nc">enabled</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">25</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">2265.6001</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">364.8000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">38.40</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">atomics</span><span class="w"> </span><span class="n">fphp</span><span class="w"> </span><span class="n">asimdhp</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">asimdrdm</span><span class="w"> </span><span class="n">jscvt</span><span class="w"> </span><span class="n">fcma</span><span class="w"> </span><span class="n">lrcpc</span><span class="w"> </span><span class="n">dcpop</span><span class="w"> </span><span class="n">sha3</span><span class="w"> </span><span class="n">s</span>
<span class="w">                        </span><span class="n">m3</span><span class="w"> </span><span class="n">sm4</span><span class="w"> </span><span class="n">asimddp</span><span class="w"> </span><span class="n">sha512</span><span class="w"> </span><span class="n">asimdfhm</span><span class="w"> </span><span class="n">dit</span><span class="w"> </span><span class="n">uscat</span><span class="w"> </span><span class="n">ilrcpc</span><span class="w"> </span><span class="n">flagm</span><span class="w"> </span><span class="n">ssbs</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="n">paca</span><span class="w"> </span><span class="n">pacg</span><span class="w"> </span><span class="n">dcpodp</span><span class="w"> </span><span class="n">flagm2</span><span class="w"> </span><span class="n">frint</span><span class="w"> </span><span class="n">i8mm</span><span class="w"> </span><span class="n">bf16</span><span class="w"> </span><span class="n">dgh</span><span class="w"> </span><span class="n">bt</span>
<span class="w">                        </span><span class="n">i</span><span class="w"> </span><span class="n">ecv</span><span class="w"> </span><span class="n">afp</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A720</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">5</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p1</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">20</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">3148.8000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">499.2000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">38.40</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">atomics</span><span class="w"> </span><span class="n">fphp</span><span class="w"> </span><span class="n">asimdhp</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">asimdrdm</span><span class="w"> </span><span class="n">jscvt</span><span class="w"> </span><span class="n">fcma</span><span class="w"> </span><span class="n">lrcpc</span><span class="w"> </span><span class="n">dcpop</span><span class="w"> </span><span class="n">sha3</span><span class="w"> </span><span class="n">s</span>
<span class="w">                        </span><span class="n">m3</span><span class="w"> </span><span class="n">sm4</span><span class="w"> </span><span class="n">asimddp</span><span class="w"> </span><span class="n">sha512</span><span class="w"> </span><span class="n">asimdfhm</span><span class="w"> </span><span class="n">dit</span><span class="w"> </span><span class="n">uscat</span><span class="w"> </span><span class="n">ilrcpc</span><span class="w"> </span><span class="n">flagm</span><span class="w"> </span><span class="n">ssbs</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="n">paca</span><span class="w"> </span><span class="n">pacg</span><span class="w"> </span><span class="n">dcpodp</span><span class="w"> </span><span class="n">flagm2</span><span class="w"> </span><span class="n">frint</span><span class="w"> </span><span class="n">i8mm</span><span class="w"> </span><span class="n">bf16</span><span class="w"> </span><span class="n">dgh</span><span class="w"> </span><span class="n">bt</span>
<span class="w">                        </span><span class="n">i</span><span class="w"> </span><span class="n">ecv</span><span class="w"> </span><span class="n">afp</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="o">-</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">1</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">20</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">3302.3999</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">480.0000</span>
<span class="n">Vulnerabilities</span>:
  <span class="nc">Itlb</span><span class="w"> </span><span class="n">multihit</span>:        <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">L1tf</span>:                 <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mds</span>:                  <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Meltdown</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mmio</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="n">data</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Retbleed</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">bypass</span>:    <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">Speculative</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">Bypass</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">prctl</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v1</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">sanitization</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v2</span>:           <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Srbds</span>:                <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Tsx</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">abort</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406163285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406163285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406163285">(Dec 05 2023 at 21:34)</a>:</h4>
<p>btwiuse <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841649331">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>Oh, I forgot the ChromeOS itself is based on Linux and I have developer mode turned on. </p>
<p>My device is Lenovo Chromebook Duet 10.1 inch with 4GB of ram.</p>
<p>I still get the same error if I execute the binary on chromeos</p>
<p>the default value is</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65530</span>
</code></pre></div>
<p>and the error persists even after I change it to 99999999</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="o">=</span><span class="mi">99999999</span>
<span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99999999</span>

<span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">w</span>
<span class="p">[</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">debug_info</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">parse_wasm_debuginfo</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_threads</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_reference_types</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_function_references</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_bulk_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_relaxed_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_multi_value</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_maximum_size</span>: <span class="mi">4294967296</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_guard_size</span>: <span class="mi">2147483648</span><span class="p">,</span>
<span class="w">    </span><span class="n">dynamic_memory_guard_size</span>: <span class="mi">65536</span><span class="p">,</span>
<span class="w">    </span><span class="n">guard_before_linear_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">parallel_compilation</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">compiler_config</span>: <span class="nc">CompilerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">strategy</span>: <span class="nc">Auto</span><span class="p">,</span>
<span class="w">        </span><span class="n">target</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">settings</span>: <span class="p">{</span>
<span class="w">            </span><span class="s">"enable_verifier"</span>: <span class="s">"false"</span><span class="p">,</span>
<span class="w">            </span><span class="s">"opt_level"</span>: <span class="s">"speed"</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">flags</span>: <span class="p">{},</span>
<span class="w">        </span><span class="n">cache_store</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">clif_dir</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">wmemcheck</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">debug_info</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">parse_wasm_debuginfo</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_threads</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_reference_types</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_function_references</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_bulk_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_relaxed_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_multi_value</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_maximum_size</span>: <span class="mi">4294967296</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_guard_size</span>: <span class="mi">2147483648</span><span class="p">,</span>
<span class="w">    </span><span class="n">dynamic_memory_guard_size</span>: <span class="mi">65536</span><span class="p">,</span>
<span class="w">    </span><span class="n">guard_before_linear_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">parallel_compilation</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">compiler_config</span>: <span class="nc">CompilerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">strategy</span>: <span class="nc">Auto</span><span class="p">,</span>
<span class="w">        </span><span class="n">target</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">settings</span>: <span class="p">{</span>
<span class="w">            </span><span class="s">"enable_verifier"</span>: <span class="s">"false"</span><span class="p">,</span>
<span class="w">            </span><span class="s">"opt_level"</span>: <span class="s">"speed"</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">flags</span>: <span class="p">{},</span>
<span class="w">        </span><span class="n">cache_store</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">clif_dir</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">wmemcheck</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">mapping</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">mmap</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="mh">0x5dc80000000</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">Out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<p>system info:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">Linux</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="mf">5.10.199</span><span class="o">-</span><span class="mi">23580</span><span class="o">-</span><span class="n">g85923a9daa67</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PREEMPT</span><span class="w"> </span><span class="n">Mon</span><span class="w"> </span><span class="n">Nov</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">18</span>:<span class="mi">56</span>:<span class="mi">13</span><span class="w"> </span><span class="n">PST</span><span class="w"> </span><span class="mi">2023</span><span class="w"> </span><span class="n">aarch64</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
<span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">lscpu</span>
<span class="n">Architecture</span>:           <span class="nc">aarch64</span>
<span class="w">  </span><span class="n">Byte</span><span class="w"> </span><span class="n">Order</span>:           <span class="nc">Little</span><span class="w"> </span><span class="n">Endian</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                 <span class="mi">8</span>
<span class="w">  </span><span class="n">On</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">list</span>:  <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>
<span class="n">Vendor</span><span class="w"> </span><span class="n">ID</span>:              <span class="nc">ARM</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A53</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">4</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">4</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p4</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">87</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">1989.0000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">793.0000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">26.00</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">cpuid</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A73</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">2</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">4</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p2</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">40</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">1989.0000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">793.0000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">26.00</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">cpuid</span>
<span class="n">Vulnerabilities</span>:
  <span class="nc">Gather</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sampling</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Itlb</span><span class="w"> </span><span class="n">multihit</span>:        <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">L1tf</span>:                 <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mds</span>:                  <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Meltdown</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mmio</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="n">data</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Retbleed</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">rstack</span><span class="w"> </span><span class="n">overflow</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">bypass</span>:    <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v1</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">sanitization</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v2</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="n">predictor</span><span class="w"> </span><span class="n">hardening</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">BHB</span>
<span class="w">  </span><span class="n">Srbds</span>:                <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Tsx</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">abort</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406163606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406163606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406163606">(Dec 05 2023 at 21:36)</a>:</h4>
<p>btwiuse <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841654358">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>I have included precompiled binaries in <a href="https://github.com/btwiuse/wasmtime-linux-aarch64-dbg">https://github.com/btwiuse/wasmtime-linux-aarch64-dbg</a></p>
<p>It's interesting when I execute it with <code>qemu-user-static</code> on a linux/amd64 host, it doesn't show the error:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">qemu</span><span class="o">-</span><span class="n">aarch64</span><span class="o">-</span><span class="k">static</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">aarch64</span><span class="o">-</span><span class="n">dbg</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406164131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406164131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406164131">(Dec 05 2023 at 21:40)</a>:</h4>
<p>btwiuse edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841649331">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>Oh, I forgot the ChromeOS itself is based on Linux and I have developer mode turned on. </p>
<p>My device is Lenovo Chromebook Duet 10.1 inch with 4GB of ram.</p>
<p>I still get the same error if I execute the binary directly on the chromeos host</p>
<p>the default value for <code>vm.max_map_count</code> on the host is</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65530</span>
</code></pre></div>
<p>and the error persists even after I change it to 99999999</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">sysctl</span><span class="w"> </span><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="o">=</span><span class="mi">99999999</span>
<span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">99999999</span>

<span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">w</span>
<span class="p">[</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">debug_info</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">parse_wasm_debuginfo</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_threads</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_reference_types</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_function_references</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_bulk_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_relaxed_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_multi_value</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_maximum_size</span>: <span class="mi">4294967296</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_guard_size</span>: <span class="mi">2147483648</span><span class="p">,</span>
<span class="w">    </span><span class="n">dynamic_memory_guard_size</span>: <span class="mi">65536</span><span class="p">,</span>
<span class="w">    </span><span class="n">guard_before_linear_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">parallel_compilation</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">compiler_config</span>: <span class="nc">CompilerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">strategy</span>: <span class="nc">Auto</span><span class="p">,</span>
<span class="w">        </span><span class="n">target</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">settings</span>: <span class="p">{</span>
<span class="w">            </span><span class="s">"enable_verifier"</span>: <span class="s">"false"</span><span class="p">,</span>
<span class="w">            </span><span class="s">"opt_level"</span>: <span class="s">"speed"</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">flags</span>: <span class="p">{},</span>
<span class="w">        </span><span class="n">cache_store</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">clif_dir</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">wmemcheck</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">debug_info</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">parse_wasm_debuginfo</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_threads</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_reference_types</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_function_references</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_bulk_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_relaxed_simd</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">wasm_multi_value</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_maximum_size</span>: <span class="mi">4294967296</span><span class="p">,</span>
<span class="w">    </span><span class="n">static_memory_guard_size</span>: <span class="mi">2147483648</span><span class="p">,</span>
<span class="w">    </span><span class="n">dynamic_memory_guard_size</span>: <span class="mi">65536</span><span class="p">,</span>
<span class="w">    </span><span class="n">guard_before_linear_memory</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">parallel_compilation</span>: <span class="nc">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">compiler_config</span>: <span class="nc">CompilerConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">strategy</span>: <span class="nc">Auto</span><span class="p">,</span>
<span class="w">        </span><span class="n">target</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">settings</span>: <span class="p">{</span>
<span class="w">            </span><span class="s">"enable_verifier"</span>: <span class="s">"false"</span><span class="p">,</span>
<span class="w">            </span><span class="s">"opt_level"</span>: <span class="s">"speed"</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">flags</span>: <span class="p">{},</span>
<span class="w">        </span><span class="n">cache_store</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">clif_dir</span>: <span class="nb">None</span><span class="p">,</span>
<span class="w">        </span><span class="n">wmemcheck</span>: <span class="nc">false</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">mapping</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">mmap</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="mh">0x5dc80000000</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">Out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<p>system info:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">Linux</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="mf">5.10.199</span><span class="o">-</span><span class="mi">23580</span><span class="o">-</span><span class="n">g85923a9daa67</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">SMP</span><span class="w"> </span><span class="n">PREEMPT</span><span class="w"> </span><span class="n">Mon</span><span class="w"> </span><span class="n">Nov</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">18</span>:<span class="mi">56</span>:<span class="mi">13</span><span class="w"> </span><span class="n">PST</span><span class="w"> </span><span class="mi">2023</span><span class="w"> </span><span class="n">aarch64</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span>
<span class="n">krane</span><span class="o">-</span><span class="n">rev4</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">stateful_partition</span><span class="o">/</span><span class="n">dev_image</span><span class="w"> </span>#<span class="w"> </span><span class="n">lscpu</span>
<span class="n">Architecture</span>:           <span class="nc">aarch64</span>
<span class="w">  </span><span class="n">Byte</span><span class="w"> </span><span class="n">Order</span>:           <span class="nc">Little</span><span class="w"> </span><span class="n">Endian</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:                 <span class="mi">8</span>
<span class="w">  </span><span class="n">On</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">list</span>:  <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>
<span class="n">Vendor</span><span class="w"> </span><span class="n">ID</span>:              <span class="nc">ARM</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A53</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">4</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">4</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p4</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">87</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">1989.0000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">793.0000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">26.00</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">cpuid</span>
<span class="w">  </span><span class="n">Model</span><span class="w"> </span><span class="n">name</span>:           <span class="nc">Cortex</span><span class="o">-</span><span class="n">A73</span>
<span class="w">    </span><span class="n">Model</span>:              <span class="mi">2</span>
<span class="w">    </span><span class="n">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">core</span>: <span class="mi">1</span>
<span class="w">    </span><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">socket</span>: <span class="mi">4</span>
<span class="w">    </span><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>:          <span class="mi">1</span>
<span class="w">    </span><span class="n">Stepping</span>:           <span class="nc">r0p2</span>
<span class="w">    </span><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">scaling</span><span class="w"> </span><span class="n">MHz</span>: <span class="mi">40</span><span class="o">%</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">1989.0000</span>
<span class="w">    </span><span class="n">CPU</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="n">MHz</span>:        <span class="mf">793.0000</span>
<span class="w">    </span><span class="n">BogoMIPS</span>:           <span class="mf">26.00</span>
<span class="w">    </span><span class="n">Flags</span>:              <span class="nc">fp</span><span class="w"> </span><span class="n">asimd</span><span class="w"> </span><span class="n">evtstrm</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="n">pmull</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">sha2</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="n">cpuid</span>
<span class="n">Vulnerabilities</span>:
  <span class="nc">Gather</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sampling</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Itlb</span><span class="w"> </span><span class="n">multihit</span>:        <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">L1tf</span>:                 <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mds</span>:                  <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Meltdown</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Mmio</span><span class="w"> </span><span class="n">stale</span><span class="w"> </span><span class="n">data</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Retbleed</span>:             <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">rstack</span><span class="w"> </span><span class="n">overflow</span>: <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spec</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">bypass</span>:    <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v1</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">sanitization</span>
<span class="w">  </span><span class="n">Spectre</span><span class="w"> </span><span class="n">v2</span>:           <span class="nc">Mitigation</span><span class="p">;</span><span class="w"> </span><span class="n">Branch</span><span class="w"> </span><span class="n">predictor</span><span class="w"> </span><span class="n">hardening</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">BHB</span>
<span class="w">  </span><span class="n">Srbds</span>:                <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
<span class="w">  </span><span class="n">Tsx</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">abort</span>:      <span class="nc">Not</span><span class="w"> </span><span class="n">affected</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406166108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406166108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406166108">(Dec 05 2023 at 21:57)</a>:</h4>
<p>btwiuse <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841683441">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>I just applied the patch from <a href="https://github.com/bytecodealliance/wasmtime/issues/6003">https://github.com/bytecodealliance/wasmtime/issues/6003</a> and it fixed the error</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">diff</span>
<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>
<span class="n">index</span><span class="w"> </span><span class="mf">0e6</span><span class="n">b7dd</span><span class="o">..</span><span class="mf">6e72</span><span class="n">a69</span><span class="w"> </span><span class="mi">100644</span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="w"> </span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">InstanceAllocationStrategy</span><span class="p">};</span>
<span class="w"> </span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span>


<span class="o">+</span><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">static_memory_maximum_size</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+</span><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">dynamic_memory_reserved_for_growth</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+</span><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">static_memory_guard_size</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+</span><span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">dynamic_memory_guard_size</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="o">+</span>
<span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_good</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>

<span class="w">     </span><span class="n">config</span><span class="p">.</span><span class="n">allocation_strategy</span><span class="p">(</span><span class="n">InstanceAllocationStrategy</span>::<span class="n">pooling</span><span class="p">());</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="406169541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/406169541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#406169541">(Dec 05 2023 at 22:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-1841720395">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>Thanks for the extra info! Given what you're seeing it seems unlikely you're running into <code>vm.max_map_count</code> as a limit. That being said my guess is you're running into some limit somewhere which is what's causing ENOMEM, and at this point your guess as to being able to pinpoint which limit is being hit is as good as mine.</p>
<p>The configuration you applied I'll note has a large impact on the performance of WebAssembly, so it's not really a "fix" per se but is a set of knobs that can be turned in theory. For example with those knobs you've greatly reduced the virtual memory allocation so it succeeds.</p>
<p>Some other things you might want to try:</p>
<ul>
<li>I took a look at <code>sysctl -a | rg '^vm'</code> and the only other one that seemed relevant was <code>vm.overcommit_memory</code>. Is that nonzero on your systems? Alternatively, could you paste the output of <code>sysctl -a | rg '^vm'</code> on a system that fails to run this program?</li>
<li>Could you try bisecting the size necessary to trip the allocation failure? That can be done by tuning <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.PoolingAllocationConfig.html#method.total_memories"><code>PoolingAllocationConfig::total_memories</code></a>.</li>
</ul>
<p>Other than that though I'm running out of ideas myself :(</p>
</blockquote>



<a name="482668486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/482668486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#482668486">(Nov 15 2024 at 18:09)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>This error was first discovered when I tried to compile and run the polkadot binary (<a href="https://github.com/paritytech/polkadot-sdk">https://github.com/paritytech/polkadot-sdk</a>) on linux aarch64 native environment.</p>
<p>The binary won't be able to work unless I change <code>--wasmtime-instantiation-strategy</code> to a non-pooling option, i.e.:</p>
<p>these don't work</p>
<ul>
<li>pooling-copy-on-write</li>
<li>pooling</li>
</ul>
<p>only these work</p>
<ul>
<li>recreate-instance-copy-on-write</li>
<li>recreate-instance</li>
<li>legacy-instance-reuse</li>
</ul>
<p>Here is what the error looks like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gear</span><span class="w"> </span><span class="o">--</span><span class="n">tmp</span><span class="w"> </span><span class="o">--</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">instantiation</span><span class="o">-</span><span class="n">strategy</span><span class="w"> </span><span class="n">pooling</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Node</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">‚úåÔ∏è</span><span class="w">  </span><span class="n">version</span><span class="w"> </span><span class="mf">1.0.3</span><span class="o">-</span><span class="n">b46adb6363f</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">‚ù§Ô∏è</span><span class="w">  </span><span class="n">by</span><span class="w"> </span><span class="n">Gear</span><span class="w"> </span><span class="n">Technologies</span><span class="p">,</span><span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">2023</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">üìã</span><span class="w"> </span><span class="n">Chain</span><span class="w"> </span><span class="n">specification</span><span class="p">:</span><span class="w"> </span><span class="nc">Vara</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">Testnet</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">üè∑</span><span class="w">  </span><span class="n">Node</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">ethereal</span><span class="o">-</span><span class="n">oranges</span><span class="o">-</span><span class="mi">7690</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">üë§</span><span class="w"> </span><span class="n">Role</span><span class="p">:</span><span class="w"> </span><span class="nc">FULL</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">üíæ</span><span class="w"> </span><span class="n">Database</span><span class="p">:</span><span class="w"> </span><span class="nc">RocksDb</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">substratesSLmp4</span><span class="o">/</span><span class="n">chains</span><span class="o">/</span><span class="n">vara_network_testnet</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">full</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="err">‚õì</span><span class="w">  </span><span class="n">Native</span><span class="w"> </span><span class="n">runtime</span><span class="p">:</span><span class="w"> </span><span class="nc">vara</span><span class="o">-</span><span class="mi">1030</span><span class="w"> </span><span class="p">(</span><span class="n">vara</span><span class="o">-</span><span class="mf">1.</span><span class="n">tx1</span><span class="p">.</span><span class="n">au1</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="err">üî®</span><span class="w"> </span><span class="n">Initializing</span><span class="w"> </span><span class="n">Genesis</span><span class="w"> </span><span class="n">block</span><span class="o">/</span><span class="n">state</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="mh">0x174f</span><span class="err">‚Ä¶</span><span class="n">af08</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-</span><span class="n">hash</span><span class="p">:</span><span class="w"> </span><span class="mh">0x5256</span><span class="err">‚Ä¶</span><span class="mi">36</span><span class="n">d6</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="err">üë¥</span><span class="w"> </span><span class="n">Loading</span><span class="w"> </span><span class="n">GRANDPA</span><span class="w"> </span><span class="n">authority</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">genesis</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">appears</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">startup</span><span class="p">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">Other</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)</span>
<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">Service</span><span class="p">(</span><span class="n">Client</span><span class="p">(</span><span class="n">VersionInvalid</span><span class="p">(</span><span class="s">"cannot create the wasmtime engine: failed to create memory pool mapping: mmap failed to allocate 0x3080000000 bytes: Out of memory (os error 12)"</span><span class="p">)))</span>
</code></pre></div>
<p>(Using a binary from <a href="https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz">https://get.gear.rs/gear-nightly-aarch64-unknown-linux-musl.tar.xz</a> here cuz polkadot doesn't provide an official build for linux/aarch64, but the error is the same for polkadot)</p>
<p>The wasmtime version used by substrate is 8.0.1, and I'm able to reproduce it under the latest 15.0.1 release, so it's reasonable to assume any version in between are also affected</p>
<h3>Test Case</h3>
<p>wasmtime version: 15.0.1</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">InstanceAllocationStrategy</span><span class="p">};</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_good</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// ok for both amd64 and aarch64</span>

<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">allocation_strategy</span><span class="p">(</span><span class="n">InstanceAllocationStrategy</span><span class="p">::</span><span class="n">pooling</span><span class="p">());</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_engine_linux_aarch64_bad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="fm">dbg!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// failed for aarch64, but ok for amd64</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ol>
<li>clone <a href="https://github.com/btwiuse/wasmtime-linux-aarch64-dbg">https://github.com/btwiuse/wasmtime-linux-aarch64-dbg</a></li>
<li>cargo run under linux/amd64 environment, the program runs to completion</li>
<li>cargo run under linux/aarch64 environment, the program fails on the second <code>Engine::new(...)?</code></li>
</ol>
<h3>Expected Results</h3>
<p>the program runs to completion on both architectures</p>
<h3>Actual Results</h3>
<p>the program panics under linux/aarch64</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="n">mapping</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">mmap</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="mh">0x5dc80000000</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">Cannot</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 8.0.1 &amp; 15.0.1</p>
<p>Operating system: linux</p>
<p>Architecture: aarch64</p>
<h3>Extra Info</h3>
<p>If you don't have a aarch64 linux server, you can try it in a qemu virtual machine. I tested it under a aarch64 crostini vm on chromeos, and termux proot environment on a android 14 phone with 24 GB ram. I'm pretty sure the error isn't caused by insufficient memory.</p>
</blockquote>



<a name="482668489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237637%20%60Error%3A%20failed%20to%20create%20memory%20po.../near/482668489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237637.20.60Error.3A.20failed.20to.20create.20memory.20po.2E.2E.2E.html#482668489">(Nov 15 2024 at 18:09)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7637#issuecomment-2479641945">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7637">issue #7637</a>:</p>
<blockquote>
<p>I'm going to close this issue since I don't think there's much in Wasmtime we can do about this. What I can recommend though is a block <a href="https://github.com/bytecodealliance/wasmtime/blob/f145135db302d1339c15250c660e368127564649/src/commands/serve.rs#L620-L656">like this</a> where <code>wasmtime serve</code> will dynamically detect it shouldn't use the pooling allocator on some aarch64 configurations. I suspect that's what was happening here where the virtual address space only has 39 bits instead of the expected 48 which resulted in these errors.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>