<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8603 aarch64: Add support for `fnmadd`/... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html">wasmtime / issue #8603 aarch64: Add support for `fnmadd`/...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="438213407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/438213407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#438213407">(May 12 2024 at 21:28)</a>:</h4>
<p><a href="https://github.com/afonso360">afonso360</a> added the cranelift:E-easy label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">Issue #8603</a>.</p>



<a name="438213408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/438213408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#438213408">(May 12 2024 at 21:28)</a>:</h4>
<p><a href="https://github.com/afonso360">afonso360</a> added the cranelift:area:aarch64 label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">Issue #8603</a>.</p>



<a name="438213409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/438213409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#438213409">(May 12 2024 at 21:28)</a>:</h4>
<p><a href="https://github.com/afonso360">afonso360</a> added the cranelift:E-compiler-easy label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">Issue #8603</a>.</p>



<a name="438213410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/438213410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#438213410">(May 12 2024 at 21:28)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">issue #8603</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<h4>Feature</h4>
<p>Add support for the <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMADD--Floating-point-Negated-fused-Multiply-Add--scalar--"><code>fnmadd</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FMSUB--Floating-point-Fused-Multiply-Subtract--scalar--"><code>fmsub</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMSUB--Floating-point-Negated-fused-Multiply-Subtract--scalar--"><code>fnmsub</code></a> instructions in the aarch64 backend.</p>
<h4>Benefit</h4>
<p>This improves instruction selection quality for a few special fma cases.</p>
<h4>Implementation</h4>
<p>We already have support for the scalar <code>fmadd</code> instruction <a href="https://github.com/bytecodealliance/wasmtime/blob/e6f9ca5efa0c4bf59c9cf133d9abeaab63ec07bb/cranelift/codegen/src/isa/aarch64/lower.isle#L516-L517">here</a>. So we adding support for these instructions should be a matter of introducing the new opcodes and implementing lowering rules similar to what already exists today.</p>
<p>Something similar was done in #8588 for the RISC-V backend.</p>
</blockquote>



<a name="438213433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/438213433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#438213433">(May 12 2024 at 21:29)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">issue #8603</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<h4>Feature</h4>
<p>Add support for the <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMADD--Floating-point-Negated-fused-Multiply-Add--scalar--"><code>fnmadd</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FMSUB--Floating-point-Fused-Multiply-Subtract--scalar--"><code>fmsub</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMSUB--Floating-point-Negated-fused-Multiply-Subtract--scalar--"><code>fnmsub</code></a> instructions in the aarch64 backend.</p>
<h4>Benefit</h4>
<p>This improves instruction selection quality for a few special fma cases.</p>
<h4>Implementation</h4>
<p>We already have support for the scalar <code>fmadd</code> instruction <a href="https://github.com/bytecodealliance/wasmtime/blob/e6f9ca5efa0c4bf59c9cf133d9abeaab63ec07bb/cranelift/codegen/src/isa/aarch64/lower.isle#L516-L517">here</a>. So we adding support for these instructions should be a matter of introducing the new opcodes and implementing lowering rules similar to what already exists today.</p>
<p>Something similar was done in #8588 for the RISC-V backend. If anyone needs help implementing this, let me know!</p>
</blockquote>



<a name="475011181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/475011181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#475011181">(Oct 05 2024 at 19:18)</a>:</h4>
<p>aidenfoxivey <a href="https://github.com/bytecodealliance/wasmtime/issues/8603#issuecomment-2395163728">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">issue #8603</a>:</p>
<blockquote>
<p>@afonso360 Seems like this issue is solved.</p>
</blockquote>



<a name="475012802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/475012802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#475012802">(Oct 05 2024 at 19:31)</a>:</h4>
<p>afonso360 closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">issue #8603</a>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<h4>Feature</h4>
<p>Add support for the <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMADD--Floating-point-Negated-fused-Multiply-Add--scalar--"><code>fnmadd</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FMSUB--Floating-point-Fused-Multiply-Subtract--scalar--"><code>fmsub</code></a> / <a href="https://developer.arm.com/documentation/ddi0602/2024-03/SIMD-FP-Instructions/FNMSUB--Floating-point-Negated-fused-Multiply-Subtract--scalar--"><code>fnmsub</code></a> instructions in the aarch64 backend.</p>
<h4>Benefit</h4>
<p>This improves instruction selection quality for a few special fma cases.</p>
<h4>Implementation</h4>
<p>We already have support for the scalar <code>fmadd</code> instruction <a href="https://github.com/bytecodealliance/wasmtime/blob/e6f9ca5efa0c4bf59c9cf133d9abeaab63ec07bb/cranelift/codegen/src/isa/aarch64/lower.isle#L516-L517">here</a>. So we adding support for these instructions should be a matter of introducing the new opcodes and implementing lowering rules similar to what already exists today.</p>
<p>Something similar was done in #8588 for the RISC-V backend. If anyone needs help implementing this, let me know!</p>
</blockquote>



<a name="475012804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238603%20aarch64%3A%20Add%20support%20for%20%60fnmadd%60/.../near/475012804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238603.20aarch64.3A.20Add.20support.20for.20.60fnmadd.60.2F.2E.2E.2E.html#475012804">(Oct 05 2024 at 19:31)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/8603#issuecomment-2395167259">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8603">issue #8603</a>:</p>
<blockquote>
<p>That's right, thanks for letting me know!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>