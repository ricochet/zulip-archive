<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1995 x64 new backend: most integer opcodes... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html">wasmtime / PR #1995 x64 new backend: most integer opcodes...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="203294803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203294803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203294803">(Jul 08 2020 at 17:09)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>I've implemented basic support for Baldrdash so as to be able to run the extensive Spidermonkey test suite, and then could get back to fix a few integer operators implemented before. Also implemented most of the integer opcodes required for wasm; I could start to run successfully a few large wasm integer-only programs with wasmtime too.</p>
<p>I plan on enabling limited testing of wast files on CI soon, to catch future regressions in codegen.</p>
<p>Sorry about the large PR!</p>
</blockquote>



<a name="203294805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203294805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203294805">(Jul 08 2020 at 17:09)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a>.</p>



<a name="203361726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203361726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203361726">(Jul 09 2020 at 08:31)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>I've implemented basic support for Baldrdash so as to be able to run the extensive Spidermonkey test suite, and then could get back to fix a few integer operators implemented before. Also implemented most of the integer opcodes required for wasm; I could start to run successfully a few large wasm integer-only programs with wasmtime too.</p>
<p>I plan on enabling limited testing of wast files on CI soon, to catch future regressions in codegen.</p>
<p>Sorry about the large PR!</p>
</blockquote>



<a name="203471337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471337">(Jul 10 2020 at 05:45)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-446134861">PR Review</a>.</p>



<a name="203471338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471338">(Jul 10 2020 at 05:45)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r452633693">PR Review Comment</a>:</p>
<blockquote>
<p>Rotate in shift enum ... making the naming a little inconsistent from the first 3? Perhaps a more generic name (and comment update) for the Enum to show that Rotate is also housed. Also for consistency could prepend shift to Left, RightZ, and RightS, i.e. ShiftLeft, ShiftRightZ, ShiftRightS.</p>
</blockquote>



<a name="203471691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471691">(Jul 10 2020 at 05:52)</a>:</h4>
<p>jlb6740 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r452633693">PR Review Comment</a>.</p>



<a name="203471700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471700">(Jul 10 2020 at 05:53)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-446137281">PR Review</a>.</p>



<a name="203471701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471701">(Jul 10 2020 at 05:53)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-446137281">PR Review</a>.</p>



<a name="203471702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203471702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203471702">(Jul 10 2020 at 05:53)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r452635799">PR Review Comment</a>:</p>
<blockquote>
<p>Rotate in shift enum ... making the naming a little inconsistent from the first 3? Perhaps a more generic name (and comment update) for the Enum to show that Rotate is also housed. Also for consistency could prepend shift to Left, RightZ, and RightS, i.e. ShiftLeft, ShiftRightZ, ShiftRightS.</p>
</blockquote>



<a name="203941559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203941559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203941559">(Jul 15 2020 at 11:11)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin">cfallin</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a>.</p>



<a name="203983722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203983722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203983722">(Jul 15 2020 at 17:08)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449151499">PR Review</a>.</p>



<a name="203983723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203983723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203983723">(Jul 15 2020 at 17:08)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455201984">PR Review Comment</a>:</p>
<blockquote>
<p>+1 for that suggestion.</p>
</blockquote>



<a name="203984367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984367">(Jul 15 2020 at 17:13)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449158603">PR Review</a>.</p>



<a name="203984369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984369">(Jul 15 2020 at 17:13)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455205381">PR Review Comment</a>:</p>
<blockquote>
<p>Could you clarify the register usage in this comment a bit?  Something like: <code>RDX:RAX &lt;- RAX * rhs</code>.</p>
</blockquote>



<a name="203984729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984729">(Jul 15 2020 at 17:16)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449162732">PR Review</a>.</p>



<a name="203984730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984730">(Jul 15 2020 at 17:16)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455207387">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, <code>gen_move</code> has its destination on the left?  That feels inconsistent with the rest of the x64 stuff, which I thought had destinations as the rightmost argument.  But maybe that's because <code>gen_move</code> is from the applies-to-all-targets <code>trait Inst</code>, right?  I guess the use of <code>Writable</code> guarantees we're safe here.</p>
</blockquote>



<a name="203984972"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984972" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984972">(Jul 15 2020 at 17:18)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455208772">PR Review Comment</a>:</p>
<blockquote>
<p><code>ReadOnlyGprRmR*</code> feels a bit cumbersome to me (and did when I looked at it some days ago).  Would you consider instead <code>UnaryRmR</code> (and consistent renaming for the derived-from-it names?)</p>
</blockquote>



<a name="203984973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203984973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203984973">(Jul 15 2020 at 17:18)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449165932">PR Review</a>.</p>



<a name="203985595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203985595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203985595">(Jul 15 2020 at 17:24)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449172926">PR Review</a>.</p>



<a name="203985596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203985596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203985596">(Jul 15 2020 at 17:24)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455212202">PR Review Comment</a>:</p>
<blockquote>
<p>nit-level, at best, but .. (eg) <code>*Extend32</code> doesn't make it obvious to the casual reader whether the 32 is the source or dest width.  Would you consider adding <code>To</code> in front of the number?  eg <code>*ExtendTo32</code> ?</p>
</blockquote>



<a name="203987167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987167">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449135814">PR Review</a>.</p>



<a name="203987169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987169">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449135814">PR Review</a>.</p>



<a name="203987170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987170">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455207356">PR Review Comment</a>:</p>
<blockquote>
<p>Add a comment giving the instruction this is emitting? <code>movq $imm64, %dst</code> or similar...</p>
</blockquote>



<a name="203987171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987171">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455210992">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps for a future refactor, but IMHO we should move from <code>is_64</code> bools to a purpose-built enum.</p>
</blockquote>



<a name="203987172"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987172" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987172">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455191626">PR Review Comment</a>:</p>
<blockquote>
<p>Just a stylistic preference, but I tend to prefer panics for things like this, e.g. <code>_ =&gt; panic!("Int args only supported for SysV calling conventions")</code> or somesuch...</p>
<p>(similar comment below)</p>
</blockquote>



<a name="203987173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987173">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455208788">PR Review Comment</a>:</p>
<blockquote>
<p>Drive-by / pre-existing, but perhaps we could turn <code>is_div</code> and <code>is_signed</code> into their own (combined) enum -- SDiv, UDiv, SRem, URem?</p>
</blockquote>



<a name="203987175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/203987175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#203987175">(Jul 15 2020 at 17:34)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455212310">PR Review Comment</a>:</p>
<blockquote>
<p>I know this is just following the aarch64 backend (so it's OK for now!), but I'm wondering if we should make the pinned register a flags option, and then set it explicitly in Baldrdash, to avoid the hardcoded reference to SpiderMonkey here. Perhaps for a future refactor?</p>
</blockquote>



<a name="204051505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051505">(Jul 16 2020 at 06:59)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449556217">PR Review</a>.</p>



<a name="204051506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051506">(Jul 16 2020 at 06:59)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455552268">PR Review Comment</a>:</p>
<blockquote>
<p>I'm sure this works correctly, but it concerns me in two ways:</p>
<ul>
<li>
<p>The text here is long and it's (almost) exactly a 6-way unrolled loop in the 64-bit case.  Would it be possible to do this by having a loop here (in <a href="http://lower.rs">lower.rs</a>, not the generated code) which reads a table of constants?  In the style of <a href="https://sourceware.org/git/?p=valgrind.git;a=blob;f=VEX/priv/guest_amd64_toIR.c;h=fadf47d41d6ba6f63a5ca3800409b11da94c5f7e;hb=HEAD#l4948">https://sourceware.org/git/?p=valgrind.git;a=blob;f=VEX/priv/guest_amd64_toIR.c;h=fadf47d41d6ba6f63a5ca3800409b11da94c5f7e;hb=HEAD#l4948</a></p>
</li>
<li>
<p>I see an integer multiply at the end.  In the sequences I'm familiar with, that doesn't appear.  It's probably a 3-cycle latency, compared with the 1-cycle latency and parallelisable over #-available-basic-ALUs for a sequence using only and/or/add/sub/shifts.</p>
</li>
</ul>
<p>Given that the current goal is to get correct x64 code generation landed, I'd be happy for these to be looked at in a followup.  They don't need to block landing.</p>
</blockquote>



<a name="204051743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051743">(Jul 16 2020 at 07:03)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449558202">PR Review</a>.</p>



<a name="204051744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051744">(Jul 16 2020 at 07:03)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455553887">PR Review Comment</a>:</p>
<blockquote>
<p>+1 for that; please add comments always, indicating what insns are being emitted.  Inferring from the opcodes is nearly impossible.</p>
</blockquote>



<a name="204051879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051879">(Jul 16 2020 at 07:05)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449559466">PR Review</a>.</p>



<a name="204051880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204051880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204051880">(Jul 16 2020 at 07:05)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455554916">PR Review Comment</a>:</p>
<blockquote>
<p>Also .. is there a typo in the commit message?  "movaps" isn't the insn you mean AFAIK; that's an aligned SSE load (move-aligned-packed-singleprecision).  Maybe you mean "movabsq" ?</p>
</blockquote>



<a name="204052093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052093">(Jul 16 2020 at 07:08)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449561617">PR Review</a>.</p>



<a name="204052094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052094">(Jul 16 2020 at 07:08)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455556594">PR Review Comment</a>:</p>
<blockquote>
<p>If it's an outright bug that should never happen, then +1 for panicing rather than continuing (returning <code>false</code> or whatever).  I'm not convinced that's the case here, though (can't infer)</p>
</blockquote>



<a name="204052230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052230">(Jul 16 2020 at 07:11)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449563436">PR Review</a>.</p>



<a name="204052231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052231">(Jul 16 2020 at 07:11)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455558095">PR Review Comment</a>:</p>
<blockquote>
<p>I just want to check here that these changes to the register numbering don't change the order at which they appear in the final <code>RealRegUniverse</code>.  (To be specific: you are not reordering registers within each reg-class, in the universe).  Is that true?  I ask because the ordering of regs within each reg class is relevant -- at least for RA/BT -- to whether caller- or callee-saved registers are used in preference, and that has an effect on the quality of the generated allocation.</p>
</blockquote>



<a name="204052351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052351">(Jul 16 2020 at 07:13)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449564608">PR Review</a>.</p>



<a name="204052352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052352">(Jul 16 2020 at 07:13)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455558979">PR Review Comment</a>:</p>
<blockquote>
<p>+1; losing <code>r15</code> in configurations where that isn't necessary would be unfortunate, given that there are only circa 12 int regs available for allocation anyway.  And in the 32-bit x86 case (if we ever do that) it would be quite serious.</p>
</blockquote>



<a name="204052526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204052526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204052526">(Jul 16 2020 at 07:16)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449566068">PR Review</a>.</p>



<a name="204053258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204053258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204053258">(Jul 16 2020 at 07:28)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449577252">PR Review</a>.</p>



<a name="204053259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204053259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204053259">(Jul 16 2020 at 07:28)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455566742">PR Review Comment</a>:</p>
<blockquote>
<p>Please can this be upgraded to a release assert, or at least somehow be checked even in release builds?  If for whatever reason <code>ty</code> of <code>I16</code> or <code>I8</code> ever gets here, we will silently generate wrong code and it could be hard to track down.</p>
</blockquote>



<a name="204061279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204061279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204061279">(Jul 16 2020 at 09:16)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449667561">PR Review</a>.</p>



<a name="204061281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204061281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204061281">(Jul 16 2020 at 09:16)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455644149">PR Review Comment</a>:</p>
<blockquote>
<p>Also .. for "Make sure to zero %rdx right before this instruction!" please add a line explaining why this is necessary and what will (or might) happen if you don't.</p>
</blockquote>



<a name="204064281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204064281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204064281">(Jul 16 2020 at 09:53)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449695847">PR Review</a>.</p>



<a name="204064282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204064282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204064282">(Jul 16 2020 at 09:53)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455666944">PR Review Comment</a>:</p>
<blockquote>
<p><code>CallConv::Fast</code> and <code>CallConv::Cold</code> can also reach this I think.</p>
</blockquote>



<a name="204064883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204064883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204064883">(Jul 16 2020 at 10:00)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449701281">PR Review</a>.</p>



<a name="204064884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204064884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204064884">(Jul 16 2020 at 10:00)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455671477">PR Review Comment</a>:</p>
<blockquote>
<p>If you implement <code>Display</code> instead, you get <code>ToString</code> for free.</p>
</blockquote>



<a name="204065095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204065095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204065095">(Jul 16 2020 at 10:03)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449703480">PR Review</a>.</p>



<a name="204065096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204065096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204065096">(Jul 16 2020 at 10:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455673176">PR Review Comment</a>:</p>
<blockquote>
<p>It is already conditionally used as pinned register: <a href="https://github.com/bytecodealliance/wasmtime/pull/1995/files#diff-d4cd987e797b464cfda540d1f41fcfb3R200-R210">https://github.com/bytecodealliance/wasmtime/pull/1995/files#diff-d4cd987e797b464cfda540d1f41fcfb3R200-R210</a></p>
</blockquote>



<a name="204077156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204077156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204077156">(Jul 16 2020 at 12:42)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449808507">PR Review</a>.</p>



<a name="204077158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204077158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204077158">(Jul 16 2020 at 12:42)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455756253">PR Review Comment</a>:</p>
<blockquote>
<p>Indeed, <code>gen_move</code> is on the target-independent trait. Maybe we can change this at some point, if the aarch64 backend agrees with the x64 convention?</p>
</blockquote>



<a name="204079000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079000">(Jul 16 2020 at 12:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449821591">PR Review</a>.</p>



<a name="204079001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079001">(Jul 16 2020 at 12:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455766275">PR Review Comment</a>:</p>
<blockquote>
<p>Yes! Recent PRs with <code>OperandSize</code> enum have inspired me... Added to the backlog!</p>
</blockquote>



<a name="204079123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079123">(Jul 16 2020 at 13:00)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449822229">PR Review</a>.</p>



<a name="204079124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079124">(Jul 16 2020 at 13:00)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455766771">PR Review Comment</a>:</p>
<blockquote>
<p>+1 to what @bjorn3 said, its usage is opt-in, disabled by default.</p>
</blockquote>



<a name="204079283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079283">(Jul 16 2020 at 13:01)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449823259">PR Review</a>.</p>



<a name="204079286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204079286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204079286">(Jul 16 2020 at 13:01)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455767583">PR Review Comment</a>:</p>
<blockquote>
<p>I've mostly ported what the old backend did, and I'm happy to revisit it later when this has landed. Thanks for the comments!</p>
</blockquote>



<a name="204080127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204080127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204080127">(Jul 16 2020 at 13:08)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449829126">PR Review</a>.</p>



<a name="204080128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204080128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204080128">(Jul 16 2020 at 13:08)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455772030">PR Review Comment</a>:</p>
<blockquote>
<p>It's a long story, but... yes, this does put R15 at the end of the allocatable list.</p>
<p>The reason is the following: regalloc has the concept of overall allocatable registers. So if in certain modes (i.e. when the use_pinned_reg flag is true), we want to mark one register as allocatable or not, then it must be at the edge of the "allocatable" list, so at the end of its register class (otherwise its register index changes when the pinned reg is in use).</p>
<p>To keep BT happy with the order of caller or callee-saved registers, I guess we could have a different register index for r15, according to whether it's pinned or not. I think it might cause more churn for other registers (namely, those which will be placed after r15). So maybe this justifies a completely different <code>RegUniverse</code> of its own? If that's ok, i'd like to defer this. We may need having different RegUniverse for respecting the win64 calling convention.</p>
</blockquote>



<a name="204081301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204081301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204081301">(Jul 16 2020 at 13:16)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-449835658">PR Review</a>.</p>



<a name="204081302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204081302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204081302">(Jul 16 2020 at 13:16)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r455776959">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>If that's ok, i'd like to defer this.</p>
</blockquote>
<p>Oh, definitely defer.  Let's get this landed and running first, then we can come back and optimise later.  (Sorry .. I should have made this clearer in the comment)</p>
</blockquote>



<a name="204082410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204082410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204082410">(Jul 16 2020 at 13:24)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>I've implemented basic support for Baldrdash so as to be able to run the extensive Spidermonkey test suite, and then could get back to fix a few integer operators implemented before. Also implemented most of the integer opcodes required for wasm; I could start to run successfully a few large wasm integer-only programs with wasmtime too.</p>
<p>I plan on enabling limited testing of wast files on CI soon, to catch future regressions in codegen.</p>
<p>Sorry about the large PR!</p>
</blockquote>



<a name="204099872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204099872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204099872">(Jul 16 2020 at 15:29)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a> from <code>x64</code> to <code>main</code>:</p>
<blockquote>
<p>I've implemented basic support for Baldrdash so as to be able to run the extensive Spidermonkey test suite, and then could get back to fix a few integer operators implemented before. Also implemented most of the integer opcodes required for wasm; I could start to run successfully a few large wasm integer-only programs with wasmtime too.</p>
<p>I plan on enabling limited testing of wast files on CI soon, to catch future regressions in codegen.</p>
<p>Sorry about the large PR!</p>
</blockquote>



<a name="204107288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204107288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204107288">(Jul 16 2020 at 16:21)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1995">PR #1995</a>.</p>



<a name="204182038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204182038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204182038">(Jul 17 2020 at 08:28)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#pullrequestreview-450470308">PR Review</a>.</p>



<a name="204182039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231995%20x64%20new%20backend%3A%20most%20integer%20opcodes.../near/204182039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231995.20x64.20new.20backend.3A.20most.20integer.20opcodes.2E.2E.2E.html#204182039">(Jul 17 2020 at 08:28)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1995#discussion_r456298279">PR Review Comment</a>:</p>
<blockquote>
<p>Well, aarch64 has destinations on the left.  So it's never going to agree with x64 (the AT&amp;T conventions, at least.).</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>