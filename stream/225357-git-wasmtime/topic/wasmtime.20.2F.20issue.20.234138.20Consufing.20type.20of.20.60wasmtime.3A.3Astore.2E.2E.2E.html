<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4138 Consufing type of `wasmtime::store... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html">wasmtime / issue #4138 Consufing type of `wasmtime::store...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281950244"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950244" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950244">(May 11 2022 at 11:28)</a>:</h4>
<p>jlkiri opened <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <code>limiter</code> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">satisfied</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950627">(May 11 2022 at 11:32)</a>:</h4>
<p>jlkiri edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">satisfied</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950851">(May 11 2022 at 11:34)</a>:</h4>
<p>jlkiri edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's [<code>StoreLimits</code>](<a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html">https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html</a><br>
It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">satisfied</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950855">(May 11 2022 at 11:34)</a>:</h4>
<p>jlkiri edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html"><code>StoreLimits</code></a><br>
It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">satisfied</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950858">(May 11 2022 at 11:34)</a>:</h4>
<p>jlkiri edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html"><code>StoreLimits</code></a>. It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">45</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                             </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">bounds</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">satisfied</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">140</span>:<span class="mi">35</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">140</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">()</span><span class="o">|</span><span class="w"> </span><span class="n">lim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950912">(May 11 2022 at 11:35)</a>:</h4>
<p>jlkiri edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html"><code>StoreLimits</code></a>. It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">compatible</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281950985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281950985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281950985">(May 11 2022 at 11:35)</a>:</h4>
<p>jlkiri <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123626378">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>Why can't the API just take <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html">StoreLimits</a> itself?</p>
</blockquote>



<a name="281951030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281951030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281951030">(May 11 2022 at 11:36)</a>:</h4>
<p>jlkiri edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123626378">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>Why can't the API just take <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html">StoreLimits</a> itself, direcly?</p>
</blockquote>



<a name="281951060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281951060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281951060">(May 11 2022 at 11:36)</a>:</h4>
<p>jlkiri edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123626378">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>Why can't the API just take an owned / reference of <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html">StoreLimits</a> itself, direcly?</p>
</blockquote>



<a name="281951171"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281951171" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281951171">(May 11 2022 at 11:37)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123627773">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I believe you are supposed to store the <code>ResourceLimiter</code> implementation in the <code>Store</code> state and then return a reference to it from the closure you pass to <code>limiter</code>.</p>
</blockquote>



<a name="281975162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281975162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281975162">(May 11 2022 at 14:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123861880">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>Indeed the limits are intended to live within the <code>T</code> of the store, and the main reason for this is to avoid plumbing a generic <code>U</code> for the limiter everywhere in wasmtime. When working with <code>dyn</code> trait objects in this case the closure can't return <code>impl ResourceLimiter</code> or something like that.</p>
<p>I think the documentation could be improved here, though, with better examples and more words about how to use the API for sure!</p>
</blockquote>



<a name="281975174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281975174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281975174">(May 11 2022 at 14:39)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html"><code>StoreLimits</code></a>. It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">compatible</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<a name="281975264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/281975264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#281975264">(May 11 2022 at 14:39)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1123863001">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="282116866"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/282116866" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#282116866">(May 12 2022 at 14:47)</a>:</h4>
<p>jlkiri <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1125087381">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>@alexcrichton @bjorn3 Thanks! Putting the limiter in the store solved the problem</p>
</blockquote>



<a name="282116891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/282116891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#282116891">(May 12 2022 at 14:47)</a>:</h4>
<p>jlkiri edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/4138#issuecomment-1125087381">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>@alexcrichton @bjorn3 Thanks! Putting the limiter in the store solved the immediate problem</p>
</blockquote>



<a name="283099204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234138%20Consufing%20type%20of%20%60wasmtime%3A%3Astore.../near/283099204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234138.20Consufing.20type.20of.20.60wasmtime.3A.3Astore.2E.2E.2E.html#283099204">(May 20 2022 at 17:06)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/4138">issue #4138</a>:</p>
<blockquote>
<p>I am struggling with applying a limiter to the wasmtime store by using the <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.Store.html#method.limiter"><code>limiter</code></a> API.</p>
<p>Here's the code I have.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">module_bytes</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StoreLimits</span>::<span class="n">default</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>StoreLimits is wasmtime's <a href="https://docs.rs/wasmtime/0.36.0/wasmtime/struct.StoreLimits.html"><code>StoreLimits</code></a>. It doesn't compile and gives me the error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0495</span><span class="p">]</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">conflicting</span><span class="w"> </span><span class="n">requirements</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">first</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="err">`</span><span class="o">'</span><span class="nb">_</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">closure</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="err">`</span><span class="n">store_limits</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">but</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">lifetime</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">here</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="n">note</span>: <span class="o">..</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">compatible</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">handler</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">139</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">139</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">store</span><span class="p">.</span><span class="n">limiter</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store_limits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">ResourceLimiter</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                       </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">expected</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>
<span class="w">               </span><span class="n">found</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="k">dyn</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">ResourceLimiter</span><span class="err">`</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0495</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>I know that my usage might be wrong but I just can't make it work so I would appreciate an example.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>