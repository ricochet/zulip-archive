<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2513 Test large multi threads got panic · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html">wasmtime / Issue #2513 Test large multi threads got panic</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="220081743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220081743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220081743">(Dec 16 2020 at 06:25)</a>:</h4>
<p>leenux opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue?<br>
Change <code>N_THREADS</code> from <code>10</code> to <code>200000</code> for mock 200000 users run wasm.<br>
<code>cargo run --example threads</code><br>
If <code>N_THREADS &lt; 20000</code> its work fine and no panic.</p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?</p>
</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">mainCreating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">thread</span><span class="w"> </span><span class="o">'</span><span class="na">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spawn</span><span class="w"> </span><span class="n">thread</span>: <span class="nc">Os</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span>: <span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">WouldBlock</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="s">"Resource temporarily unavailable"</span><span class="w"> </span><span class="p">}</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">leenux</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">stable</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rsInstantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span>:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="mi">610</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span>::<span class="o">'</span> <span class="nc">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="mi">29156</span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span><span class="w"></span>
:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs13</span>:
<span class="mi">156</span>:<span class="mi">13</span><span class="w"></span>
<span class="n">Instantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Extracting</span><span class="w"> </span><span class="n">export</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">fatal</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">initiate</span><span class="w"> </span><span class="n">panic</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Aborted</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>Which Wasmtime version / commit hash / branch are you using?<br>
0.21</p>
</li>
<li>
<p>If relevant, can you include some extra information about your environment?<br>
  (Rust version, operating system, architecture...)<br>
rust:1.48<br>
os:ubuntu 20.04<br>
arch:x86-64<br>
</p>
</li>
</ul>
</blockquote>



<a name="220081744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220081744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220081744">(Dec 16 2020 at 06:25)</a>:</h4>
<p>leenux labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue?<br>
Change <code>N_THREADS</code> from <code>10</code> to <code>200000</code> for mock 200000 users run wasm.<br>
<code>cargo run --example threads</code><br>
If <code>N_THREADS &lt; 20000</code> its work fine and no panic.</p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?</p>
</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">mainCreating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">thread</span><span class="w"> </span><span class="o">'</span><span class="na">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spawn</span><span class="w"> </span><span class="n">thread</span>: <span class="nc">Os</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span>: <span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">WouldBlock</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="s">"Resource temporarily unavailable"</span><span class="w"> </span><span class="p">}</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">leenux</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">stable</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rsInstantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span>:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="mi">610</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span>::<span class="o">'</span> <span class="nc">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="mi">29156</span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span><span class="w"></span>
:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs13</span>:
<span class="mi">156</span>:<span class="mi">13</span><span class="w"></span>
<span class="n">Instantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Extracting</span><span class="w"> </span><span class="n">export</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">fatal</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">initiate</span><span class="w"> </span><span class="n">panic</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Aborted</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>Which Wasmtime version / commit hash / branch are you using?<br>
0.21</p>
</li>
<li>
<p>If relevant, can you include some extra information about your environment?<br>
  (Rust version, operating system, architecture...)<br>
rust:1.48<br>
os:ubuntu 20.04<br>
arch:x86-64<br>
</p>
</li>
</ul>
</blockquote>



<a name="220082303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220082303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220082303">(Dec 16 2020 at 06:37)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-745799715">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>This doesn't seem to be a wasmtime problem. Rust itself fails to setup a stack guard: <a href="https://github.com/rust-lang/rust/blob/95b4a4f0eee935f9e0c80b0ceef34866bcb72ca3/library/std/src/sys/unix/stack_overflow.rs#L156">https://github.com/rust-lang/rust/blob/95b4a4f0eee935f9e0c80b0ceef34866bcb72ca3/library/std/src/sys/unix/stack_overflow.rs#L156</a> This seems to simply be resource exhaustion.</p>
</blockquote>



<a name="220084817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220084817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220084817">(Dec 16 2020 at 07:30)</a>:</h4>
<p>leenux <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-745830145">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>@bjorn3 It doesn't look like resource exhaustion from <code>top</code></p>
</blockquote>



<a name="220085470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220085470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220085470">(Dec 16 2020 at 07:43)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-745847298">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>@leenux this looks like <a href="https://github.com/rust-lang/rust/issues/78497">rust-lang/rust#78497</a>. Basically, the Rust standard library's code that sets up a guard-page mapping for a thread's stack is creating a new virtual-memory mapping for that guard page; and the Linux kernel has a limit on the number of individual virtual-memory mappings in a single address space. By default this limit is 65530 (just under 2^16), and a thread requires two new mappings (the stack, and the guard page under the stack), so by default you'll hit the limit after creating a little over 32000 threads in one process.</p>
<p>It looks like the sysctl for this is adjustable, though performance isn't going to be great (on any OS) with that many entries in the VM map. I might suggest green threads/fibers or an event-driven async model if you need to handle that many simultaneous requests :-)</p>
</blockquote>



<a name="220087677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220087677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220087677">(Dec 16 2020 at 08:19)</a>:</h4>
<p>leenux <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-745895098">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>@cfallin Do wasmtime has any plans to add async feature?I intend to use wasmtime to execute their own workflow script.200000 concurrent is the minimum requirement.</p>
</blockquote>



<a name="220133610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220133610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220133610">(Dec 16 2020 at 15:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-746529986">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>You can read up more on proposed <code>async</code> support in Wasmtime at <a href="https://github.com/bytecodealliance/rfcs/pull/2">https://github.com/bytecodealliance/rfcs/pull/2</a>, although depending on your use case it may not escape the virtual memory limits yet.</p>
</blockquote>



<a name="220577966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220577966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220577966">(Dec 21 2020 at 12:21)</a>:</h4>
<p>leenux <a href="https://github.com/bytecodealliance/wasmtime/issues/2513#issuecomment-748946432">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<p>I'm using async to run wasm bytecode, benchmark is ok for our service</p>
</blockquote>



<a name="220577967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232513%20Test%20large%20multi%20threads%20got%20panic/near/220577967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232513.20Test.20large.20multi.20threads.20got.20panic.html#220577967">(Dec 21 2020 at 12:21)</a>:</h4>
<p>leenux closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2513">Issue #2513</a>:</p>
<blockquote>
<ul>
<li>
<p>What are the steps to reproduce the issue?<br>
Change <code>N_THREADS</code> from <code>10</code> to <code>200000</code> for mock 200000 users run wasm.<br>
<code>cargo run --example threads</code><br>
If <code>N_THREADS &lt; 20000</code> its work fine and no panic.</p>
</li>
<li>
<p>What do you expect to happen? What does actually happen? Does it panic, and<br>
  if so, with which assertion?</p>
</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">mainCreating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">thread</span><span class="w"> </span><span class="o">'</span><span class="na">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">spawn</span><span class="w"> </span><span class="n">thread</span>: <span class="nc">Os</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span>: <span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">kind</span>: <span class="nc">WouldBlock</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="s">"Resource temporarily unavailable"</span><span class="w"> </span><span class="p">}</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'/</span><span class="n">home</span><span class="o">/</span><span class="n">leenux</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">stable</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rsInstantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span>:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="mi">610</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span>::<span class="o">'</span> <span class="nc">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="mi">29156</span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="n">page</span><span class="w"></span>
:<span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">stack_overflow</span><span class="p">.</span><span class="n">rs13</span>:
<span class="mi">156</span>:<span class="mi">13</span><span class="w"></span>
<span class="n">Instantiating</span><span class="w"> </span><span class="n">module</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Extracting</span><span class="w"> </span><span class="n">export</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">fatal</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">initiate</span><span class="w"> </span><span class="n">panic</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Creating</span><span class="w"> </span><span class="n">callback</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="n">Aborted</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="w"> </span><span class="n">dumped</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>
<p>Which Wasmtime version / commit hash / branch are you using?<br>
0.21</p>
</li>
<li>
<p>If relevant, can you include some extra information about your environment?<br>
  (Rust version, operating system, architecture...)<br>
rust:1.48<br>
os:ubuntu 20.04<br>
arch:x86-64<br>
</p>
</li>
</ul>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>