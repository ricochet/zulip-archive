<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6443 winch: Drop `FuncEnv` trait · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html">wasmtime / PR #6443 winch: Drop `FuncEnv` trait</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="360792921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792921">(May 24 2023 at 13:38)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360792922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792922">(May 24 2023 at 13:38)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a> from <code>saulecabrera:winch-drop-func-env</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit is a small cleanup to drop the usage of the <code>FuncEnv</code> trait.</p>
<p>In <a href="https://github.com/bytecodealliance/wasmtime/pull/6358">https://github.com/bytecodealliance/wasmtime/pull/6358</a>, we agreed on making <code>winch-codegen</code> directly depend on <code>wasmtime-environ</code>.</p>
<p>Introducing a direct relatioship between <code>winch-codegen</code> and <code>wasmtime-environ</code> means that the <code>FuncEnv</code> trait is no longer serving its original purpose, and we can drop the usage of the trait and use the types exposed from <code>winch-codegen</code> directly instead.</p>
<p>Even though this change drops the <code>FuncEnv</code> trait, it still keeps a <code>FuncEnv</code> struct, which is used during code generation.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="360792928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792928">(May 24 2023 at 13:38)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360792929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792929">(May 24 2023 at 13:38)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360792931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792931">(May 24 2023 at 13:38)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360792932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360792932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360792932">(May 24 2023 at 13:38)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360796774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360796774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360796774">(May 24 2023 at 13:52)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360814590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360814590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360814590">(May 24 2023 at 14:54)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#pullrequestreview-1442110260">PR review</a>.</p>



<a name="360814592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360814592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360814592">(May 24 2023 at 14:54)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#pullrequestreview-1442110260">PR review</a>.</p>



<a name="360814593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360814593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360814593">(May 24 2023 at 14:54)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#discussion_r1204315672">PR review comment</a>:</p>
<blockquote>
<p>I'm not all that familiar with the design of these generics, but I would naively expect that a choice of either <code>MacroAssembler</code> or <code>ABI</code> would imply <code>PtrSize</code>. If that's the case would it perhaps be possible to have <code>P</code> be an associated type of either prior trait?</p>
<p>Or would it, for example, make sense to put both <code>ABI</code> and <code>PtrSize</code> inside of the <code>MacroAssembler</code> trait as an associated type?</p>
</blockquote>



<a name="360819748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360819748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360819748">(May 24 2023 at 15:12)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#discussion_r1204357383">PR review comment</a>:</p>
<blockquote>
<p>That makes sense. Taking a closer look, I'm leaning towards having the <code>PtrSize</code> as an associated type inside the <code>ABI</code> trait, which already provides similar information (e.g. <code>word_bytes</code>).</p>
</blockquote>



<a name="360840763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360840763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360840763">(May 24 2023 at 16:35)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#discussion_r1204487626">PR review comment</a>:</p>
<blockquote>
<p>Upon a second look, having both of these as associated types in the <code>MacroAssembler</code> makes more sense I think, and it's going to result in quite a decent cut in boilerplate. I started working on the change, but I'm anticipating that it's going to be a decent amount of changes unrelated to this PR, so I think I prefer landing this and putting the refactor once this lands. </p>
</blockquote>



<a name="360841212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360841212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360841212">(May 24 2023 at 16:37)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/6443#discussion_r1204489442">PR review comment</a>:</p>
<blockquote>
<p>It's also in my todo to standardize the signatures in the <code>ABI</code> trait (e.g. there's no reason to have them borrow <code>&amp;self</code>), so I'm thinking I'll bundle those improvements in the refactoring too. </p>
</blockquote>



<a name="360848406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360848406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360848406">(May 24 2023 at 17:08)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<a name="360863729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236443%20winch%3A%20Drop%20%60FuncEnv%60%20trait/near/360863729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236443.20winch.3A.20Drop.20.60FuncEnv.60.20trait.html#360863729">(May 24 2023 at 18:16)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6443">PR #6443</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>