<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9196 Use the CallHook::CallingHost and Ret... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html">wasmtime / PR #9196 Use the CallHook::CallingHost and Ret...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="467297259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467297259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467297259">(Sep 03 2024 at 15:49)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a> from <code>elliottt:trevor/component-host-call-hooks</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>We never implemented calling the CallingHost and ReturningFromHost hooks<br>
for component host calls.</p>
<p>co-authored-by: Nick Fitzgerald &lt;<a href="mailto:fitzgen@gmail.com">fitzgen@gmail.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="467322068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467322068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467322068">(Sep 03 2024 at 17:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2278072324">PR review</a>:</p>
<blockquote>
<p>Thanks! Mind also adding some tests for this? There's some previous call-hook-related tests which might be good to copy/augment.</p>
<p>Additionally can you double-check that invoking the malloc function calls the hook as well? And also that we call the hooks on entry to wasm?</p>
</blockquote>



<a name="467322069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467322069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467322069">(Sep 03 2024 at 17:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1742438146">PR review comment</a>:</p>
<blockquote>
<p>Could you expand the <code>catch_unwind_and_longjmp</code> to encompass the invocation of the call hooks too?</p>
</blockquote>



<a name="467610569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467610569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467610569">(Sep 04 2024 at 17:12)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467610614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467610614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467610614">(Sep 04 2024 at 17:12)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a> as ready for review.</p>



<a name="467610620"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467610620" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467610620">(Sep 04 2024 at 17:13)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467610621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467610621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467610621">(Sep 04 2024 at 17:13)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467611063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467611063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467611063">(Sep 04 2024 at 17:14)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467611246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467611246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467611246">(Sep 04 2024 at 17:15)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467611490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467611490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467611490">(Sep 04 2024 at 17:16)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2280822918">PR review</a>.</p>



<a name="467611491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467611491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467611491">(Sep 04 2024 at 17:16)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744157703">PR review comment</a>:</p>
<blockquote>
<p>This differs from the core wasm behavior, in that trapping in <code>f</code> does not register the return from host or return from wasm hooks. @alexcrichton, is this reasonable, or is there something missing from this PR?</p>
</blockquote>



<a name="467612192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467612192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467612192">(Sep 04 2024 at 17:20)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2280829088">PR review</a>.</p>



<a name="467612195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467612195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467612195">(Sep 04 2024 at 17:20)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744161720">PR review comment</a>:</p>
<blockquote>
<p>I think I've answered my own question: we shouldn't be using <code>and_then</code> to guard the exiting hook.</p>
</blockquote>



<a name="467612893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467612893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467612893">(Sep 04 2024 at 17:23)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467613224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467613224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467613224">(Sep 04 2024 at 17:24)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>:</p>
<blockquote>
<p>We never implemented calling the CallingHost and ReturningFromHost hooks for component host calls. This PR supports those hooks, and adds some tests.</p>
<p>co-authored-by: Nick Fitzgerald &lt;<a href="mailto:fitzgen@gmail.com">fitzgen@gmail.com</a>&gt;</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="467617966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467617966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467617966">(Sep 04 2024 at 17:44)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467629119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629119">(Sep 04 2024 at 18:31)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2280959669">PR review</a>:</p>
<blockquote>
<p>Nice tests <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
<p>I think this will be good to go with additional tests for using the <code>realloc</code> and <code>post-return</code> canonical options since I suspect those aren't covered by call hooks just yet</p>
</blockquote>



<a name="467629120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629120">(Sep 04 2024 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744247777">PR review comment</a>:</p>
<blockquote>
<p>I think this is the same as <code>call_wrapped_async_func</code>?</p>
</blockquote>



<a name="467629121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629121">(Sep 04 2024 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744242736">PR review comment</a>:</p>
<blockquote>
<p>To avoid needing to call this twice could the above use <code>store.as_context_mut()</code> as an argument? That should effectively reborrow to allow <code>store</code> to be used here again</p>
</blockquote>



<a name="467629122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629122">(Sep 04 2024 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744245231">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps be <code>use</code>'d from the other call hook test?</p>
</blockquote>



<a name="467629123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629123">(Sep 04 2024 at 18:31)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744243068">PR review comment</a>:</p>
<blockquote>
<p>Could this be <code>call_hook(...)?</code>? (notably using <code>?</code> instead of <code>if let</code>)</p>
</blockquote>



<a name="467629951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467629951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467629951">(Sep 04 2024 at 18:35)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467647099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467647099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467647099">(Sep 04 2024 at 19:52)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467648001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467648001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467648001">(Sep 04 2024 at 19:56)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467651153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467651153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467651153">(Sep 04 2024 at 20:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744354880">PR review comment</a>:</p>
<blockquote>
<p>Could you shift this to being a result of a list? As-is this doesn't require a realloc, but as a return value it'll require a realloc</p>
</blockquote>



<a name="467651154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467651154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467651154">(Sep 04 2024 at 20:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2281145367">PR review</a>.</p>



<a name="467651155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467651155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467651155">(Sep 04 2024 at 20:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744355448">PR review comment</a>:</p>
<blockquote>
<p>Instead of defining this here you can also use the <code>"realloc"</code> export of the <code>$libc</code> module</p>
</blockquote>



<a name="467676763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467676763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467676763">(Sep 04 2024 at 23:08)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467677043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467677043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467677043">(Sep 04 2024 at 23:11)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467681185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681185">(Sep 04 2024 at 23:50)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467681263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681263">(Sep 04 2024 at 23:51)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2281602745">PR review</a>.</p>



<a name="467681264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681264">(Sep 04 2024 at 23:51)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744630405">PR review comment</a>:</p>
<blockquote>
<p>Here are the assertions about <code>post-return</code>, you  can see that the wasm calls increment after the <code>.post_return()</code> call.</p>
</blockquote>



<a name="467681318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681318">(Sep 04 2024 at 23:52)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467681414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681414">(Sep 04 2024 at 23:53)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2281604044">PR review</a>.</p>



<a name="467681415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681415">(Sep 04 2024 at 23:53)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1744631298">PR review comment</a>:</p>
<blockquote>
<p>Here's the handling of the allocated result, and the assertions about the number of host calls encountered. There is only one host call counted, as only <code>realloc</code> is used. However, there are two wasm calls for the <code>realloc</code> of the <code>list&lt;u8&gt;</code> argument, and the <code>list8-to-str</code> call itself.</p>
</blockquote>



<a name="467681493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467681493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467681493">(Sep 04 2024 at 23:54)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467940143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467940143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467940143">(Sep 05 2024 at 18:06)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2283760133">PR review</a>.</p>



<a name="467940144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467940144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467940144">(Sep 05 2024 at 18:06)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1745963120">PR review comment</a>:</p>
<blockquote>
<p>Here and below I think this is <code>CallingWasm</code> and <code>ReturningFromWasm</code>?</p>
<p>Also would it be possible to push this further down into the <code>realloc</code> call below? Or, I'm not sure if this works, even further into <code>TypedFunc::unchecked_call</code>? (or w/e API this bottoms out to)</p>
</blockquote>



<a name="467946493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467946493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467946493">(Sep 05 2024 at 18:30)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<a name="467947187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467947187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467947187">(Sep 05 2024 at 18:32)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#pullrequestreview-2283809150">PR review</a>.</p>



<a name="467947188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467947188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467947188">(Sep 05 2024 at 18:32)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/9196#discussion_r1745993300">PR review comment</a>:</p>
<blockquote>
<p>It turns out this is already counted as a wasm call, and the host call hooks were just unnecessary and incorrect. I had an incorrect assumption about what the <code>Options::realloc</code> function was doing, and assumed it was handling host-side reallocs. Given that those aren't a thing and we're already accounting for wasm hooks, the changes to this module were unnecessary.</p>
</blockquote>



<a name="467956162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239196%20Use%20the%20CallHook%3A%3ACallingHost%20and%20Ret.../near/467956162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239196.20Use.20the.20CallHook.3A.3ACallingHost.20and.20Ret.2E.2E.2E.html#467956162">(Sep 05 2024 at 19:04)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9196">PR #9196</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>