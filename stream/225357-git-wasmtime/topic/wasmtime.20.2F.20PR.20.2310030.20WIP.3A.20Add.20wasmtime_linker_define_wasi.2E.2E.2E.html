<html>
<head><meta charset="utf-8"><title>wasmtime / PR #10030 WIP: Add wasmtime_linker_define_wasi... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html">wasmtime / PR #10030 WIP: Add wasmtime_linker_define_wasi...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="494064143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494064143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494064143">(Jan 16 2025 at 04:23)</a>:</h4>
<p>thewtex opened <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a> from <code>thewtex:c-api-wasi-threads</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>To define <code>wasi_threads</code> on the linker to support rrunning wasm threads.<br>
</p>
</blockquote>



<a name="494064304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494064304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494064304">(Jan 16 2025 at 04:25)</a>:</h4>
<p>thewtex edited <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a>:</p>
<blockquote>
<p>To define <code>wasi_threads</code> on the linker to support running wasi-threads modules.<br>
</p>
</blockquote>



<a name="494191435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494191435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494191435">(Jan 16 2025 at 16:46)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/pull/10030#issuecomment-2596218604">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a>:</p>
<blockquote>
<p>The wasi-threads implementation is not compatible with the wasmtime-wasi implementation. They require the wasi-common implementation, which is legacy and only remains in the tree because it is compatible with wasi-threads. We offer it in the CLI right now but adding support for threads to the C API is a big undertaking and requires more than just this linker addition.</p>
<p>I am not super enthusiastic about adding support for wasi-threads because it is a dead end proposal: it is a prototype that won’t ever progress past its current phase, and all effort on that work has shifted to fixing the deficiencies in the core wasm thread model that it uncovered, in the <a href="https://github.com/WebAssembly/shared-everything-threads">https://github.com/WebAssembly/shared-everything-threads</a> proposal. Any support for threading with wasmtime-wasi needs shared-everything-threads to land in wasmtime first.</p>
<p>I don’t think that making wasi-threads available in more contexts serves our ecosystem well, because the binaries will not be compatible with the shared-everything approach that everyone believes is the future path.</p>
</blockquote>



<a name="494233186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494233186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494233186">(Jan 16 2025 at 21:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/10030#issuecomment-2596894779">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a>:</p>
<blockquote>
<p>For some added context the discussion here started over in <a href="https://github.com/bytecodealliance/wasmtime-py/issues/253">https://github.com/bytecodealliance/wasmtime-py/issues/253</a> which led to this. I didn't realize (or more accurately, forgot) what it would take to support wasi-threads in its current state in the C API. I for example forgot that it needed <code>wasi-common</code> and that reintegrating that into <code>wasmtime-c-api</code> would be relatively significant.</p>
<p>Given that and what @pchickey mentioned above I'm shifting stances on this myself. I agree we probably shouldn't go down this road which would mean that <a href="https://github.com/bytecodealliance/wasmtime-py/issues/253">https://github.com/bytecodealliance/wasmtime-py/issues/253</a> would be closed as "this won't be supported". I apologize for the runaround here @thewtex I can try to do more homework on my end next time!</p>
</blockquote>



<a name="494248299"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494248299" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494248299">(Jan 16 2025 at 22:57)</a>:</h4>
<p>thewtex closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a>.</p>



<a name="494248300"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%2310030%20WIP%3A%20Add%20wasmtime_linker_define_wasi.../near/494248300" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.2310030.20WIP.3A.20Add.20wasmtime_linker_define_wasi.2E.2E.2E.html#494248300">(Jan 16 2025 at 22:57)</a>:</h4>
<p>thewtex <a href="https://github.com/bytecodealliance/wasmtime/pull/10030#issuecomment-2597073976">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/10030">PR #10030</a>:</p>
<blockquote>
<p>I understand the reasoning, but I am disappointed that there is currently no way to have threading outside the CLI. <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>