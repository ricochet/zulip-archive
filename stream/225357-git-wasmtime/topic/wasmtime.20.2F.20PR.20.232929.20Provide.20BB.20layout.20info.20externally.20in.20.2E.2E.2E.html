<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2929 Provide BB layout info externally in ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html">wasmtime / PR #2929 Provide BB layout info externally in ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="240074060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240074060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240074060">(May 24 2021 at 16:19)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a>.</p>



<a name="240074062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240074062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240074062">(May 24 2021 at 16:19)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a> from <code>bb-offsets</code> to <code>main</code>:</p>
<blockquote>
<p>This is sometimes useful when performing analyses on the generated<br>
machine code: for example, some kinds of code verifiers will want to do<br>
a control-flow analysis, and it is much easier to do this if one does<br>
not have to recover the CFG from the machine code (doing so requires<br>
heavyweight analysis when indirect branches are involved). If one trusts<br>
the control-flow lowering and only needs to verify other properties of<br>
the code, this can be very useful.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="240074567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240074567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240074567">(May 24 2021 at 16:23)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-666943206">PR review</a>.</p>



<a name="240074568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240074568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240074568">(May 24 2021 at 16:23)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638097644">PR review comment</a>:</p>
<blockquote>
<p>Can this be a <code>PrimaryMap</code> from <code>Block</code> to <code>CodeOffset</code>?</p>
</blockquote>



<a name="240074619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240074619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240074619">(May 24 2021 at 16:23)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638097644">PR review comment</a>.</p>



<a name="240082146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240082146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240082146">(May 24 2021 at 17:18)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a> from <code>bb-offsets</code> to <code>main</code>.</p>



<a name="240082166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240082166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240082166">(May 24 2021 at 17:19)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-666990210">PR review</a>.</p>



<a name="240082167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240082167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240082167">(May 24 2021 at 17:19)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638135012">PR review comment</a>:</p>
<blockquote>
<p>Yes, that makes more sense, I agree; updated. Thanks!</p>
</blockquote>



<a name="240084185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240084185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240084185">(May 24 2021 at 17:35)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638144147">PR review comment</a>:</p>
<blockquote>
<p>This doesn't exactly correspond with cranelift ir level blocks, right? That was my suggestion. And now that I think about it you may need to use <code>SecondaryMap</code> to be able to use the right index.</p>
</blockquote>



<a name="240084186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240084186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240084186">(May 24 2021 at 17:35)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-667001925">PR review</a>.</p>



<a name="240085177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240085177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240085177">(May 24 2021 at 17:42)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a> from <code>bb-offsets</code> to <code>main</code>.</p>



<a name="240085680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240085680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240085680">(May 24 2021 at 17:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-667009988">PR review</a>.</p>



<a name="240085681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240085681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240085681">(May 24 2021 at 17:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638150542">PR review comment</a>:</p>
<blockquote>
<p>Ah, actually, now that I page this back in, I realize that it probably makes more sense not to try to provide a mapping from Cranelift-level blocks to machine code offsets.</p>
<p>The reason is that blocks can be reordered, sometimes prepended or appended with edge blocks, or elided completely. The intent of this change is to instead provide an independent CFG overlay on the final code that can be used for further analysis; the use-case it's built for (VeriWasm, specifically) doesn't need the correspondence with the CLIF-level CFG.</p>
<p>So I've reverted this back to the <code>Vec&lt;CodeOffset&gt;</code>. If we later want to connect <code>Block</code>s to <code>CodeOffset</code>s we could definitely extend this, but I would want to think about the types and how to make it safer to use first.</p>
</blockquote>



<a name="240089886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240089886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240089886">(May 24 2021 at 18:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a> from <code>bb-offsets</code> to <code>main</code>.</p>



<a name="240096806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240096806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240096806">(May 24 2021 at 19:06)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-667090107">PR review</a>.</p>



<a name="240096807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240096807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240096807">(May 24 2021 at 19:06)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638209914">PR review comment</a>:</p>
<blockquote>
<p>i see you said "updated" but it's still <code>Vec&lt;CodeOffset&gt;</code> in the PR ... missing commit somewhere?</p>
</blockquote>



<a name="240096896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240096896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240096896">(May 24 2021 at 19:06)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-667090597">PR review</a>.</p>



<a name="240096897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240096897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240096897">(May 24 2021 at 19:06)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#discussion_r638210228">PR review comment</a>:</p>
<blockquote>
<p>oh i sse the other resolved conversation about this, disregard!</p>
</blockquote>



<a name="240096967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240096967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240096967">(May 24 2021 at 19:07)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2929#pullrequestreview-667091047">PR review</a>.</p>



<a name="240103932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240103932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240103932">(May 24 2021 at 20:01)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a> from <code>bb-offsets</code> to <code>main</code>.</p>



<a name="240114364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232929%20Provide%20BB%20layout%20info%20externally%20in%20.../near/240114364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232929.20Provide.20BB.20layout.20info.20externally.20in.20.2E.2E.2E.html#240114364">(May 24 2021 at 21:27)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2929">PR #2929</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>