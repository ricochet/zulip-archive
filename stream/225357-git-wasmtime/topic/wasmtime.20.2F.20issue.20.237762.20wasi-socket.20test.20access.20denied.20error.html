<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7762 wasi-socket test access denied error · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html">wasmtime / issue #7762 wasi-socket test access denied error</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="411965626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/411965626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#411965626">(Jan 09 2024 at 16:06)</a>:</h4>
<p>Greensue opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Hi, I have met a "Access denied " error, when run wasi-socket tests using wasm cmd. please help me to check what it's the reason.<br>
Really appreciate it.</p>
<p>After build the artifacts under the test-programs,I got the .wasm file of the bin files under the test-programs(the .wasm file in my host under the dir /Wasmtime/target/debug/build/test-programs-artifacts-10901ff28f726621/out/wasm32-wasi/debug ). And then I execute the command:<br>
<code> ~/work/Git/Wasmtime/target/debug/wasmtime run --wasm component-model preview2_udp_connect.component.wasm</code></p>
<p>And then, error happends:<br>
<code>thread 'main' panicked at crates/test-programs/src/bin/preview2_udp_connect.rs:14:50:
called </code>Result::unwrap()<code> on an </code>Err<code> value: ErrorCode { code: 1, name: "access-denied", message: "Access denied.\n                \n                POSIX equivalent: EACCES, EPERM" }
note: run with </code>RUST_BACKTRACE=1<code> environment variable to display a backtrace
Error: failed to run main module </code>preview2_udp_connect.component.wasm`</p>
<p>Caused by:<br>
    0: failed to invoke <code>run</code> function<br>
    1: error while executing at wasm backtrace:<br>
           0: 0x10a67 - &lt;unknown&gt;!__rust_start_panic<br>
           1: 0x108e3 - &lt;unknown&gt;!rust_panic<br>
           2: 0x10816 - &lt;unknown&gt;!std::panicking::rust_panic_with_hook::h9c783872fdb901cc<br>
           3: 0xfc4e - &lt;unknown&gt;!std::panicking::begin_panic_handler::{{closure}}::h6f255f7e971e1b6b<br>
           4: 0xfb7d - &lt;unknown&gt;!std::sys_common::backtrace::__rust_end_short_backtrace::h1f5fd5151e12b76f<br>
           5: 0x101f8 - &lt;unknown&gt;!rust_begin_unwind<br>
           6: 0x14fd3 - &lt;unknown&gt;!core::panicking::panic_fmt::h4ed481ff677a9793<br>
           7: 0x166f8 - &lt;unknown&gt;!core::result::unwrap_failed::h2af8885cc6bf29d0<br>
           8: 0x1bae - &lt;unknown&gt;!core::result::Result&lt;T,E&gt;::unwrap::h5a6e23b18a4964d8<br>
           9: 0x25b2 - &lt;unknown&gt;!preview2_udp_connect::test_udp_connect_disconnect_reconnect::h145f524d4d36d695<br>
          10: 0x4ee6 - &lt;unknown&gt;!preview2_udp_connect::main::h97037918226e3811<br>
          11: 0x21a6 - &lt;unknown&gt;!core::ops::function::FnOnce::call_once::hf213c3f9fe036fc6<br>
          12: 0x51e2 - &lt;unknown&gt;!std::sys_common::backtrace::__rust_begin_short_backtrace::hade486873dc3ce94<br>
          13: 0x209f - &lt;unknown&gt;!std::rt::lang_start::{{closure}}::hc2f7acdd2103b085<br>
          14: 0xe5d6 - &lt;unknown&gt;!std::rt::lang_start_internal::hd6912adb8d399251<br>
          15: 0x204a - &lt;unknown&gt;!std::rt::lang_start::h3e409c9ea6a77da0<br>
          16: 0x50c5 - &lt;unknown&gt;!__main_void<br>
          17: 0x1960 - &lt;unknown&gt;!_start<br>
          18: 0x2cd9e4 - wit-component:adapter:wasi_snapshot_preview1!wasi:cli/run@0.2.0-rc-2023-12-05#run<br>
       note: using the <code>WASMTIME_BACKTRACE_DETAILS=1</code> environment variable may show more debugging information<br>
    2: wasm trap: wasm <code>unreachable</code> instruction executed<br>
<code>
the content of preview2_udp_connect.rs:14:50 is :
</code> 13     let client = UdpSocket::new(family).unwrap();<br>
 14     client.blocking_bind(&amp;net, unspecified_addr).unwrap();<br>
 15 <br>
 16     _ = client.stream(None).unwrap();`</p>
<p>And I found many files if it executing the blocking_bind() func, it would triggle this Error Code.<br>
And I found it both in linux and macos.</p>
</blockquote>



<a name="411980898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/411980898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#411980898">(Jan 09 2024 at 17:26)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Hi, I have met a "Access denied " error, when run wasi-socket tests using wasm cmd. please help me to check what it's the reason.<br>
Really appreciate it.</p>
<p>After build the artifacts under the test-programs,I got the .wasm file of the bin files under the test-programs(the .wasm file in my host under the dir /Wasmtime/target/debug/build/test-programs-artifacts-10901ff28f726621/out/wasm32-wasi/debug ). And then I execute the command:<br>
<code> ~/work/Git/Wasmtime/target/debug/wasmtime run --wasm component-model preview2_udp_connect.component.wasm</code></p>
<p>And then, error happends:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">preview2_udp_connect</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">14</span>:<span class="mi">50</span>:
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">ErrorCode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="s">"access-denied"</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="s">"Access denied.</span><span class="se">\n</span><span class="s">                </span><span class="se">\n</span><span class="s">                POSIX equivalent: EACCES, EPERM"</span><span class="w"> </span><span class="p">}</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">preview2_udp_connect</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="n">run</span><span class="err">`</span><span class="w"> </span><span class="n">function</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x10a67</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__rust_start_panic</span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x108e3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">rust_panic</span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x10816</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h9c783872fdb901cc</span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0xfc4e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h6f255f7e971e1b6b</span>
<span class="w">           </span><span class="mi">4</span>: <span class="mh">0xfb7d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">h1f5fd5151e12b76f</span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x101f8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">rust_begin_unwind</span>
<span class="w">           </span><span class="mi">6</span>: <span class="mh">0x14fd3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">h4ed481ff677a9793</span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x166f8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h2af8885cc6bf29d0</span>
<span class="w">           </span><span class="mi">8</span>: <span class="mh">0x1bae</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">E</span><span class="o">&gt;</span>::<span class="n">unwrap</span>::<span class="n">h5a6e23b18a4964d8</span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x25b2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">preview2_udp_connect</span>::<span class="n">test_udp_connect_disconnect_reconnect</span>::<span class="n">h145f524d4d36d695</span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x4ee6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">preview2_udp_connect</span>::<span class="n">main</span>::<span class="n">h97037918226e3811</span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x21a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">hf213c3f9fe036fc6</span>
<span class="w">          </span><span class="mi">12</span>: <span class="mh">0x51e2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">hade486873dc3ce94</span>
<span class="w">          </span><span class="mi">13</span>: <span class="mh">0x209f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hc2f7acdd2103b085</span>
<span class="w">          </span><span class="mi">14</span>: <span class="mh">0xe5d6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">hd6912adb8d399251</span>
<span class="w">          </span><span class="mi">15</span>: <span class="mh">0x204a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h3e409c9ea6a77da0</span>
<span class="w">          </span><span class="mi">16</span>: <span class="mh">0x50c5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__main_void</span>
<span class="w">          </span><span class="mi">17</span>: <span class="mh">0x1960</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">_start</span>
<span class="w">          </span><span class="mi">18</span>: <span class="mh">0x2cd9e4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span>:<span class="nc">adapter</span>:<span class="nc">wasi_snapshot_preview1</span><span class="o">!</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span>#<span class="n">run</span>
<span class="w">       </span><span class="n">note</span>: <span class="nc">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">WASMTIME_BACKTRACE_DETAILS</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="n">information</span>
<span class="w">    </span><span class="mi">2</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>the content of preview2_udp_connect.rs:14:50 is :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="mi">13</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UdpSocket</span>::<span class="n">new</span><span class="p">(</span><span class="n">family</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w"> </span><span class="mi">14</span><span class="w">     </span><span class="n">client</span><span class="p">.</span><span class="n">blocking_bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">unspecified_addr</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w"> </span><span class="mi">15</span>
<span class="w"> </span><span class="mi">16</span><span class="w">     </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">stream</span><span class="p">(</span><span class="nb">None</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<p>And I found many files if it executing the blocking_bind() func, it would triggle this Error Code.<br>
And I found it both in linux and macos.</p>
</blockquote>



<a name="411981148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/411981148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#411981148">(Jan 09 2024 at 17:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1883485681">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Would you perhaps have ipv6 disabled on your machine? If that's not the case this'll probably need some more debugging prints added to the tests to understand why this is failing.</p>
<p>cc @badeend as well as you might have an idea too</p>
</blockquote>



<a name="412011993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/412011993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#412011993">(Jan 09 2024 at 21:05)</a>:</h4>
<p>badeend <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1883790132">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Nothing spings to mind. Like Alex said, it would be good to know whether this happens on a specific IP version or not. At the bottom of the test file you can comment out all Ipv6 invocations and see whether that changes anything, if not; maybe check with the Ipv4 tests commented out instead.</p>
</blockquote>



<a name="412454782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/412454782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#412454782">(Jan 12 2024 at 01:17)</a>:</h4>
<p>Greensue <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1888239652">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>I've tried removing the ipv6 related test functions, but it comes out the same error</p>
</blockquote>



<a name="413068507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/413068507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#413068507">(Jan 16 2024 at 02:44)</a>:</h4>
<p>Greensue <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1892989472">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>I fond the SocketAddrCheck  func are false as default, and I change that to True , then the  test passed. @badeend</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SocketAddrCheck</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">default</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">(</span><span class="n">Arc</span>::<span class="n">new</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="kc">false</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>![image](<a href="https://github.com/bytecodealliance/wasmtime/assets/23025897/4ced9b1b-51db-4224-9be4-476d3e6bc0c4">https://github.com/bytecodealliance/wasmtime/assets/23025897/4ced9b1b-51db-4224-9be4-476d3e6bc0c4</a>)</p>
</blockquote>



<a name="415937189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/415937189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#415937189">(Jan 17 2024 at 02:19)</a>:</h4>
<p>Greensue <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1894829589">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>another way to avoid access denied error:<br>
![image](<a href="https://github.com/bytecodealliance/wasmtime/assets/23025897/f3cb68cc-0f53-411f-a400-beb551b55755">https://github.com/bytecodealliance/wasmtime/assets/23025897/f3cb68cc-0f53-411f-a400-beb551b55755</a>)</p>
</blockquote>



<a name="416061701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/416061701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#416061701">(Jan 17 2024 at 15:59)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Hi, I have met a "Access denied " error, when run wasi-socket tests using wasm cmd. please help me to check what it's the reason.<br>
Really appreciate it.</p>
<p>After build the artifacts under the test-programs,I got the .wasm file of the bin files under the test-programs(the .wasm file in my host under the dir /Wasmtime/target/debug/build/test-programs-artifacts-10901ff28f726621/out/wasm32-wasi/debug ). And then I execute the command:<br>
<code> ~/work/Git/Wasmtime/target/debug/wasmtime run --wasm component-model preview2_udp_connect.component.wasm</code></p>
<p>And then, error happends:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">programs</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">preview2_udp_connect</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">14</span>:<span class="mi">50</span>:
<span class="nc">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">ErrorCode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="s">"access-denied"</span><span class="p">,</span><span class="w"> </span><span class="n">message</span>: <span class="s">"Access denied.</span><span class="se">\n</span><span class="s">                </span><span class="se">\n</span><span class="s">                POSIX equivalent: EACCES, EPERM"</span><span class="w"> </span><span class="p">}</span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">preview2_udp_connect</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="n">run</span><span class="err">`</span><span class="w"> </span><span class="n">function</span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x10a67</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__rust_start_panic</span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x108e3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">rust_panic</span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x10816</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h9c783872fdb901cc</span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0xfc4e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h6f255f7e971e1b6b</span>
<span class="w">           </span><span class="mi">4</span>: <span class="mh">0xfb7d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">h1f5fd5151e12b76f</span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x101f8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">rust_begin_unwind</span>
<span class="w">           </span><span class="mi">6</span>: <span class="mh">0x14fd3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">h4ed481ff677a9793</span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x166f8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h2af8885cc6bf29d0</span>
<span class="w">           </span><span class="mi">8</span>: <span class="mh">0x1bae</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">E</span><span class="o">&gt;</span>::<span class="n">unwrap</span>::<span class="n">h5a6e23b18a4964d8</span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x25b2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">preview2_udp_connect</span>::<span class="n">test_udp_connect_disconnect_reconnect</span>::<span class="n">h145f524d4d36d695</span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x4ee6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">preview2_udp_connect</span>::<span class="n">main</span>::<span class="n">h97037918226e3811</span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x21a6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">hf213c3f9fe036fc6</span>
<span class="w">          </span><span class="mi">12</span>: <span class="mh">0x51e2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">hade486873dc3ce94</span>
<span class="w">          </span><span class="mi">13</span>: <span class="mh">0x209f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hc2f7acdd2103b085</span>
<span class="w">          </span><span class="mi">14</span>: <span class="mh">0xe5d6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">hd6912adb8d399251</span>
<span class="w">          </span><span class="mi">15</span>: <span class="mh">0x204a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h3e409c9ea6a77da0</span>
<span class="w">          </span><span class="mi">16</span>: <span class="mh">0x50c5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__main_void</span>
<span class="w">          </span><span class="mi">17</span>: <span class="mh">0x1960</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">_start</span>
<span class="w">          </span><span class="mi">18</span>: <span class="mh">0x2cd9e4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">component</span>:<span class="nc">adapter</span>:<span class="nc">wasi_snapshot_preview1</span><span class="o">!</span><span class="n">wasi</span>:<span class="nc">cli</span><span class="o">/</span><span class="n">run</span><span class="o">@</span><span class="mf">0.2.0</span><span class="o">-</span><span class="n">rc</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span>#<span class="n">run</span>
<span class="w">       </span><span class="n">note</span>: <span class="nc">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">WASMTIME_BACKTRACE_DETAILS</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="n">information</span>
<span class="w">    </span><span class="mi">2</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">wasm</span><span class="w"> </span><span class="err">`</span><span class="n">unreachable</span><span class="err">`</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">executed</span>
</code></pre></div>
<p>the content of preview2_udp_connect.rs:14:50 is :</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="mi">13</span><span class="w">     </span><span class="kd">let</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UdpSocket</span>::<span class="n">new</span><span class="p">(</span><span class="n">family</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w"> </span><span class="mi">14</span><span class="w">     </span><span class="n">client</span><span class="p">.</span><span class="n">blocking_bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">unspecified_addr</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w"> </span><span class="mi">15</span>
<span class="w"> </span><span class="mi">16</span><span class="w">     </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">stream</span><span class="p">(</span><span class="nb">None</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div>
<p>And I found many files if it executing the blocking_bind() func, it would triggle this Error Code.<br>
And I found it both in linux and macos.</p>
</blockquote>



<a name="416061703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237762%20wasi-socket%20test%20access%20denied%20error/near/416061703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237762.20wasi-socket.20test.20access.20denied.20error.html#416061703">(Jan 17 2024 at 15:59)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7762#issuecomment-1896109816">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7762">issue #7762</a>:</p>
<blockquote>
<p>Aha I see what's going on here, I missed this earlier. Yes running the binaries from the CLI by default will require the <code>-Sinherit-network</code> option to be specified. The CLI disables network access by default, and the tests assume network access. This is configured as part of the test runner by when running outside of the runner you'll need to configure network access to be available.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>