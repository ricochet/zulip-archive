<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2874 Support IBM z/Architecture · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html">wasmtime / PR #2874 Support IBM z/Architecture</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="237194539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237194539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237194539">(May 03 2021 at 17:11)</a>:</h4>
<p>uweigand opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> from <code>s390x-backend</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for the IBM z/Architecture (s390x-ibm-linux).</p>
<p>The status of the s390x backend in its current form is:</p>
<ul>
<li>Wasmtime is fully functional and passes all tests on s390x.</li>
<li>All back-end features supported, with the exception of SIMD.</li>
<li>There is still a lot of potential for performance improvements.</li>
<li>Currently the only supported processor type is z15.</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="237195017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237195017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237195017">(May 03 2021 at 17:14)</a>:</h4>
<p>cfallin assigned <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> to cfallin.</p>



<a name="237207460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237207460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237207460">(May 03 2021 at 18:32)</a>:</h4>
<p>uweigand updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> (assigned to cfallin) from <code>s390x-backend</code> to <code>main</code>.</p>



<a name="237207945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237207945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237207945">(May 03 2021 at 18:35)</a>:</h4>
<p>uweigand updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> (assigned to cfallin) from <code>s390x-backend</code> to <code>main</code>.</p>



<a name="237213839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237213839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237213839">(May 03 2021 at 19:17)</a>:</h4>
<p>uweigand updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> (assigned to cfallin) from <code>s390x-backend</code> to <code>main</code>.</p>



<a name="237865929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865929">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-654713713">PR Review</a>.</p>



<a name="237865930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865930">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628393456">PR Review Comment</a>:</p>
<blockquote>
<p>It might be good to have a note here about the fact that no FP is used; this is slightly different than e.g. what the ASCII-art doc comment in <code>abi_impl.rs</code> describes for vanilla/common ABI details. Specifically, documenting how the SP is decremented once, including the maximum-needed outgoing args space, would be helpful, I think.</p>
</blockquote>



<a name="237865932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865932">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628396851">PR Review Comment</a>:</p>
<blockquote>
<p>AArch64-ism left in the comments here (but I think the same thing is true of this platform, namely that no addressing modes that modify registers are used?).</p>
</blockquote>



<a name="237865933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865933">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-654713713">PR Review</a>.</p>



<a name="237865934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865934">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628397642">PR Review Comment</a>:</p>
<blockquote>
<p>Same comment here as above -- assert our assumption re: register range.</p>
</blockquote>



<a name="237865935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865935">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628397361">PR Review Comment</a>:</p>
<blockquote>
<p>Can we assert that this is only used in a way that is consistent with the regalloc metadata we generate (if I understand correctly, that would be <code>rt2 == rt + 1</code> or similar)?</p>
</blockquote>



<a name="237865936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865936">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628402287">PR Review Comment</a>:</p>
<blockquote>
<p>It might be useful to factor out helpers for bit-manipulation like this (this is a sign-extend IIUC, so maybe <code>sign_extend_to_u64</code>?); I know we've been far from consistent about this in the rest of the backends, but there is no better time to start :-)</p>
<p>Same comment to the masking below, too (<code>mask_to_bits</code> or similar).</p>
</blockquote>



<a name="237865937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865937">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628400866">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be <code>Load64SExt8</code>? (I'm not sure if a 1-to-64-bit extension is common -- perhaps this arises in <code>Bextend</code>? -- but this caught my eye, and deserves a comment if correct to note why it differs)</p>
</blockquote>



<a name="237865940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237865940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237865940">(May 07 2021 at 18:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628406298">PR Review Comment</a>:</p>
<blockquote>
<p>This and the below load-op fusion cases are <em>I think</em> similar to this bug we saw on x64: #2576.</p>
<p>The fundamental issue was that we were lowering (and thus matching on the load and sinking it) a compare multiple times, whenever its flags output was used, because we do not handle flags the same way we handle other registers (and it looks like this backend is the same). The input-matching and sinking support in the core lowering logic assumes that one will only match and then sink once; in certain cases the repeats interact poorly with instruction ordering and cause undefined values to be used.</p>
<p>We really should come up with an impossible-to-do-by-construction way of encoding this restriction in the <code>LowerCtx</code> API, but until then, <em>if</em> this is also the case here (again, I'm pattern-matching on the bug but am not certain everything is the same in this backend!), the simplest fix is just to avoid load-op merging with compares.</p>
</blockquote>



<a name="237886418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237886418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237886418">(May 07 2021 at 20:35)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-654846900">PR Review</a>.</p>



<a name="237886419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/237886419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#237886419">(May 07 2021 at 20:35)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r628501436">PR Review Comment</a>:</p>
<blockquote>
<p>I would assume that <code>Load64SExt8</code> is wrong here too. The loaded bool is likely stored as a zero extended byte, not sign extended byte and as such it would need to be a load + arithmetic shift left of 63 bits I think.</p>
</blockquote>



<a name="238146773"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238146773" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238146773">(May 10 2021 at 14:01)</a>:</h4>
<p>uweigand updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a> (assigned to cfallin) from <code>s390x-backend</code> to <code>main</code>.</p>



<a name="238146990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238146990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238146990">(May 10 2021 at 14:02)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655682406">PR Review</a>.</p>



<a name="238146991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238146991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238146991">(May 10 2021 at 14:02)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629386893">PR Review Comment</a>:</p>
<blockquote>
<p>OK, added comment.</p>
</blockquote>



<a name="238147145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147145">(May 10 2021 at 14:03)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655683368">PR Review</a>.</p>



<a name="238147146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147146">(May 10 2021 at 14:03)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629387566">PR Review Comment</a>:</p>
<blockquote>
<p>This comment is obsolete anyway (copied from a old version) - the current mapper design doesn't even distinguish between a pre- and post-map any more.  I've removed the comment.</p>
</blockquote>



<a name="238147290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147290">(May 10 2021 at 14:04)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655684247">PR Review</a>.</p>



<a name="238147291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147291">(May 10 2021 at 14:04)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629388123">PR Review Comment</a>:</p>
<blockquote>
<p>No, it will actually be used with larger ranges.  I've now just implemented the correct semantics for all cases.</p>
</blockquote>



<a name="238147564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147564">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655686032">PR Review</a>.</p>



<a name="238147565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147565">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629389346">PR Review Comment</a>:</p>
<blockquote>
<p>Here, we cannot implement the correct semantics, because the remapper will not map one contiguous range to another contiguous range.  But here this really doesn't matter -- this code will never get called since these instructions are never present before register allocation.  (The only user of these instructions is the prologue/epilogue code.)</p>
</blockquote>



<a name="238147648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147648">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655686651">PR Review</a>.</p>



<a name="238147649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147649">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629389776">PR Review Comment</a>:</p>
<blockquote>
<p>This is also moot.  There actually are no 1-bit memory access instructions in cranelift, so this can never happen.  I've removed all the 1-bit cases here.</p>
</blockquote>



<a name="238147673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147673">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629389913">PR Review Comment</a>:</p>
<blockquote>
<p>OK, done.</p>
</blockquote>



<a name="238147674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238147674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238147674">(May 10 2021 at 14:06)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655686846">PR Review</a>.</p>



<a name="238148235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238148235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238148235">(May 10 2021 at 14:10)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629392770">PR Review Comment</a>:</p>
<blockquote>
<p>Good point.   It actually depends on the caller -- if <code>lower_icmp_to_flags</code> is used to lower a plain <code>Icmp</code>, then it is actually correct to sink memory loads (just like for any other instruction where we're sinking memory accesses).  However, <code>lower_icmp_to_flags</code> is also used to combine longer instruction sequences, and in those cases, sinking memory loads is only legal if all intermediate instructions only have a single user (there is currently no obvious way to check for that condition in the back-end, unfortunately).  I've now added a <code>may_sink_memory</code> flag to the routine, which is set by the caller (somewhat conservatively at the moment, this can be improved once we have support for better checks).</p>
</blockquote>



<a name="238148236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238148236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238148236">(May 10 2021 at 14:10)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-655690812">PR Review</a>.</p>



<a name="238148293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238148293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238148293">(May 10 2021 at 14:10)</a>:</h4>
<p>uweigand edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629392770">PR Review Comment</a>.</p>



<a name="238209163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209163">(May 10 2021 at 20:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-656071096">PR Review</a>.</p>



<a name="238209164"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209164" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209164">(May 10 2021 at 20:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629672582">PR Review Comment</a>:</p>
<blockquote>
<p>Right, I agree -- the issue is precisely when <code>icmp</code>'s result is matched more than once as an operand of another instruction. The fix looks good -- thanks!</p>
</blockquote>



<a name="238209474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209474">(May 10 2021 at 20:49)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-656072631">PR Review</a>.</p>



<a name="238209475"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209475" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209475">(May 10 2021 at 20:49)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629673735">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, yes, this makes sense -- thanks.</p>
</blockquote>



<a name="238209735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209735">(May 10 2021 at 20:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-656073651">PR Review</a>.</p>



<a name="238209736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238209736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238209736">(May 10 2021 at 20:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#discussion_r629674541">PR Review Comment</a>:</p>
<blockquote>
<p>Perfect, this is very helpful -- thank you!</p>
</blockquote>



<a name="238210068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238210068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238210068">(May 10 2021 at 20:52)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2874#pullrequestreview-656075439">PR Review</a>.</p>



<a name="238210133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232874%20Support%20IBM%20z/Architecture/near/238210133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232874.20Support.20IBM.20z.2FArchitecture.html#238210133">(May 10 2021 at 20:53)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2874">PR #2874</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>