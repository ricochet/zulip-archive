<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3202 Fix validating wasm stores of boolean... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html">wasmtime / PR #3202 Fix validating wasm stores of boolean...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="249869989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249869989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249869989">(Aug 18 2021 at 15:49)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3202">PR #3202</a> from <code>fix-simd-store</code> to <code>main</code>:</p>
<blockquote>
<p>Previously cranelift's wasm code generator would emit a raw <code>store</code><br>
instruction for all wasm types, regardless of what the cranelift operand<br>
type was. Cranelift's <code>store</code> instruction, however, isn't valid for<br>
boolean vector types. This commit fixes this issue by inserting a<br>
bitcast specifically for the store instruction if a boolean vector type<br>
is being stored, continuing to avoid the bitcast for all other vector types.</p>
<p>Closes #3099</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="249870352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249870352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249870352">(Aug 18 2021 at 15:51)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#pullrequestreview-733071758">PR review</a>.</p>



<a name="249872908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249872908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249872908">(Aug 18 2021 at 16:09)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#pullrequestreview-733091903">PR review</a>.</p>



<a name="249872909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249872909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249872909">(Aug 18 2021 at 16:09)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#discussion_r691402673">PR review comment</a>:</p>
<blockquote>
<p>Should we instead define that boolean vectors can be stored using <code>store</code> directly and are stored as all-zero or all-one lanes?</p>
</blockquote>



<a name="249874553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249874553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249874553">(Aug 18 2021 at 16:22)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#pullrequestreview-733105403">PR review</a>.</p>



<a name="249874554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249874554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249874554">(Aug 18 2021 at 16:22)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#discussion_r691412910">PR review comment</a>:</p>
<blockquote>
<p>That is a good approach but I don't mind what @alexcrichton tried here because:</p>
<ul>
<li>vector translation already involves a lot of bitcasting so this doesn't make the problem worse; if we want to solve the bitcasting we should just solve all of and close #1147</li>
<li>changing <code>load</code> and <code>store</code> to allow boolean vectors but not boolean scalars seems like it might cause errors somewhere; this fix would immediately fix a fuzz bug</li>
<li>I wouldn't mind settling the general issue about <code>load</code>s and <code>store</code>s with booleans once for all: I've seen mention recently of setting a memory representation for boolean scalars... If we settle it once for all (do we have an issue for this?) and document it then it might make sense to avoid the bitcast (if that's what is decided).</li>
</ul>
</blockquote>



<a name="249874591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249874591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249874591">(Aug 18 2021 at 16:22)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#discussion_r691412910">PR review comment</a>.</p>



<a name="249880409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249880409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249880409">(Aug 18 2021 at 17:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#pullrequestreview-733146527">PR review</a>.</p>



<a name="249880410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249880410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249880410">(Aug 18 2021 at 17:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#discussion_r691445274">PR review comment</a>:</p>
<blockquote>
<p>I just created #3205 for this. Agreed that for now, the immediate fuzzbug fix is fine.</p>
</blockquote>



<a name="249882202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249882202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249882202">(Aug 18 2021 at 17:16)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#pullrequestreview-733157504">PR review</a>.</p>



<a name="249882203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249882203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249882203">(Aug 18 2021 at 17:16)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3202#discussion_r691453536">PR review comment</a>:</p>
<blockquote>
<p>Ok I'm gonna go ahead and merge this fix for now and defer to #3205 for future updates.</p>
</blockquote>



<a name="249882208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233202%20Fix%20validating%20wasm%20stores%20of%20boolean.../near/249882208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233202.20Fix.20validating.20wasm.20stores.20of.20boolean.2E.2E.2E.html#249882208">(Aug 18 2021 at 17:16)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3202">PR #3202</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>