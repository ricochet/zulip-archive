<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9126 CMake build for c-api failes to ge... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html">wasmtime / issue #9126 CMake build for c-api failes to ge...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="462348756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462348756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462348756">(Aug 14 2024 at 13:41)</a>:</h4>
<p><a href="https://github.com/dev-null-undefined">dev-null-undefined</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">Issue #9126</a>.</p>



<a name="462348760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462348760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462348760">(Aug 14 2024 at 13:41)</a>:</h4>
<p>dev-null-undefined opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">issue #9126</a>:</p>
<blockquote>
<p>Error that you get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unterminated</span><span class="w"> </span><span class="p">#</span><span class="n">ifndef</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sd">/** * \file wasmtime/conf.h * * \brief Build-time defines for how the C API was built. */</span><span class="p">#</span><span class="n">ifndef</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="p">#</span><span class="n">define</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="c1">// WASMTIME_FEATURE_LIST#define WASMTIME_FEATURE_PROFILING#define WASMTIME_FEATURE_WAT#define WASMTIME_FEATURE_CACHE#define WASMTIME_FEATURE_PARALLEL_COMPILATION#define WASMTIME_FEATURE_WASI#define WASMTIME_FEATURE_LOGGING/* #undef WASMTIME_FEATURE_DISABLE_LOGGING */#define WASMTIME_FEATURE_COREDUMP#define WASMTIME_FEATURE_ADDR2LINE#define WASMTIME_FEATURE_DEMANGLE#define WASMTIME_FEATURE_THREADS#define WASMTIME_FEATURE_GC#define WASMTIME_FEATURE_ASYNC#define WASMTIME_FEATURE_CRANELIFT#define WASMTIME_FEATURE_WINCH// ... if you add a line above this be sure to change the other locations// marked WASMTIME_FEATURE_LIST#if defined(WASMTIME_FEATURE_CRANELIFT) || defined(WASMTIME_FEATURE_WINCH)#define WASMTIME_FEATURE_COMPILER#endif#endif // WASMTIME_CONF_H</span>
<span class="w">      </span><span class="o">|</span>
<span class="n">In</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
<span class="w">                 </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">193</span><span class="p">,</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Follow the steps to build wasmtime from source <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md</a></li>
<li>Check the <code>target/c-api/include/wasmtime/conf.h</code> see that there are missing new lines</li>
<li>Try to compile anything with the c-api</li>
</ul>
<h3>Versions and Environment</h3>
<ul>
<li>Use cmake version 3.18.4 (for example from a docker container)</li>
</ul>
<div class="codehilite" data-code-language="Docker"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">debian:bullseye</span>
<span class="k">ARG</span><span class="w"> </span>RELEASE

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>build-essential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cmake<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>curl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">'=https'</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>--<span class="w"> </span>-y
</code></pre></div>
<p>Wasmtime version or commit: v23.0.2</p>
<p>Operating system: NixOs, but running in dockercontainer debian:bullseye</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Managed to fix the issue by changing <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14</a></p>
<p><div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">- file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}")</span>
<span class="gi">+ file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}" NEWLINE_STYLE LF)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="462348787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462348787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462348787">(Aug 14 2024 at 13:41)</a>:</h4>
<p>dev-null-undefined edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">issue #9126</a>:</p>
<blockquote>
<p>Error that you get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unterminated</span><span class="w"> </span><span class="p">#</span><span class="n">ifndef</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sd">/** * \file wasmtime/conf.h * * \brief Build-time defines for how the C API was built. */</span><span class="p">#</span><span class="n">ifndef</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="p">#</span><span class="n">define</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="c1">// WASMTIME_FEATURE_LIST#define WASMTIME_FEATURE_PROFILING#define WASMTIME_FEATURE_WAT#define WASMTIME_FEATURE_CACHE#define WASMTIME_FEATURE_PARALLEL_COMPILATION#define WASMTIME_FEATURE_WASI#define WASMTIME_FEATURE_LOGGING/* #undef WASMTIME_FEATURE_DISABLE_LOGGING */#define WASMTIME_FEATURE_COREDUMP#define WASMTIME_FEATURE_ADDR2LINE#define WASMTIME_FEATURE_DEMANGLE#define WASMTIME_FEATURE_THREADS#define WASMTIME_FEATURE_GC#define WASMTIME_FEATURE_ASYNC#define WASMTIME_FEATURE_CRANELIFT#define WASMTIME_FEATURE_WINCH// ... if you add a line above this be sure to change the other locations// marked WASMTIME_FEATURE_LIST#if defined(WASMTIME_FEATURE_CRANELIFT) || defined(WASMTIME_FEATURE_WINCH)#define WASMTIME_FEATURE_COMPILER#endif#endif // WASMTIME_CONF_H</span>
<span class="w">      </span><span class="o">|</span>
<span class="n">In</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
<span class="w">                 </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">193</span><span class="p">,</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Follow the steps to build wasmtime from source <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md</a></li>
<li>Check the <code>target/c-api/include/wasmtime/conf.h</code> see that there are missing new lines</li>
<li>Try to compile anything with the c-api</li>
</ul>
<h3>Versions and Environment</h3>
<ul>
<li>Use cmake version 3.18.4 (for example from a docker container)</li>
</ul>
<div class="codehilite" data-code-language="Docker"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">debian:bullseye</span>
<span class="k">ARG</span><span class="w"> </span>RELEASE

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>build-essential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cmake<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>curl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">'=https'</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>--<span class="w"> </span>-y
</code></pre></div>
<p>Wasmtime version or commit: v23.0.2</p>
<p>Operating system: NixOs, but running in dockercontainer debian:bullseye</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Managed to fix the issue by changing <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14</a></p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">- file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}")</span>
<span class="gi">+ file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}" NEWLINE_STYLE LF)</span>
</code></pre></div>
<p>```[tasklist]</p>
<h3>Tasks</h3>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">~~~</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="462348799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462348799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462348799">(Aug 14 2024 at 13:41)</a>:</h4>
<p>dev-null-undefined edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">issue #9126</a>:</p>
<blockquote>
<p>Error that you get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unterminated</span><span class="w"> </span><span class="p">#</span><span class="n">ifndef</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sd">/** * \file wasmtime/conf.h * * \brief Build-time defines for how the C API was built. */</span><span class="p">#</span><span class="n">ifndef</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="p">#</span><span class="n">define</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="c1">// WASMTIME_FEATURE_LIST#define WASMTIME_FEATURE_PROFILING#define WASMTIME_FEATURE_WAT#define WASMTIME_FEATURE_CACHE#define WASMTIME_FEATURE_PARALLEL_COMPILATION#define WASMTIME_FEATURE_WASI#define WASMTIME_FEATURE_LOGGING/* #undef WASMTIME_FEATURE_DISABLE_LOGGING */#define WASMTIME_FEATURE_COREDUMP#define WASMTIME_FEATURE_ADDR2LINE#define WASMTIME_FEATURE_DEMANGLE#define WASMTIME_FEATURE_THREADS#define WASMTIME_FEATURE_GC#define WASMTIME_FEATURE_ASYNC#define WASMTIME_FEATURE_CRANELIFT#define WASMTIME_FEATURE_WINCH// ... if you add a line above this be sure to change the other locations// marked WASMTIME_FEATURE_LIST#if defined(WASMTIME_FEATURE_CRANELIFT) || defined(WASMTIME_FEATURE_WINCH)#define WASMTIME_FEATURE_COMPILER#endif#endif // WASMTIME_CONF_H</span>
<span class="w">      </span><span class="o">|</span>
<span class="n">In</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
<span class="w">                 </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">193</span><span class="p">,</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Follow the steps to build wasmtime from source <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md</a></li>
<li>Check the <code>target/c-api/include/wasmtime/conf.h</code> see that there are missing new lines</li>
<li>Try to compile anything with the c-api</li>
</ul>
<h3>Versions and Environment</h3>
<ul>
<li>Use cmake version 3.18.4 (for example from a docker container)</li>
</ul>
<div class="codehilite" data-code-language="Docker"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">debian:bullseye</span>
<span class="k">ARG</span><span class="w"> </span>RELEASE

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>build-essential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cmake<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>curl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">'=https'</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>--<span class="w"> </span>-y
</code></pre></div>
<p>Wasmtime version or commit: v23.0.2</p>
<p>Operating system: NixOs, but running in dockercontainer debian:bullseye</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Managed to fix the issue by changing <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14</a></p>
<p><div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">- file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}")</span>
<span class="gi">+ file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}" NEWLINE_STYLE LF)</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="462396354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462396354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462396354">(Aug 14 2024 at 18:16)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9126#issuecomment-2289519184">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">issue #9126</a>:</p>
<blockquote>
<p>Thanks for the report! Looks like this is due to an older CMake version and should be fixed in <a href="https://github.com/bytecodealliance/wasmtime/pull/9131">https://github.com/bytecodealliance/wasmtime/pull/9131</a></p>
</blockquote>



<a name="462400157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239126%20CMake%20build%20for%20c-api%20failes%20to%20ge.../near/462400157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239126.20CMake.20build.20for.20c-api.20failes.20to.20ge.2E.2E.2E.html#462400157">(Aug 14 2024 at 18:45)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9126">issue #9126</a>:</p>
<blockquote>
<p>Error that you get:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">unterminated</span><span class="w"> </span><span class="p">#</span><span class="n">ifndef</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sd">/** * \file wasmtime/conf.h * * \brief Build-time defines for how the C API was built. */</span><span class="p">#</span><span class="n">ifndef</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="p">#</span><span class="n">define</span><span class="w"> </span><span class="n">WASMTIME_CONF_H</span><span class="c1">// WASMTIME_FEATURE_LIST#define WASMTIME_FEATURE_PROFILING#define WASMTIME_FEATURE_WAT#define WASMTIME_FEATURE_CACHE#define WASMTIME_FEATURE_PARALLEL_COMPILATION#define WASMTIME_FEATURE_WASI#define WASMTIME_FEATURE_LOGGING/* #undef WASMTIME_FEATURE_DISABLE_LOGGING */#define WASMTIME_FEATURE_COREDUMP#define WASMTIME_FEATURE_ADDR2LINE#define WASMTIME_FEATURE_DEMANGLE#define WASMTIME_FEATURE_THREADS#define WASMTIME_FEATURE_GC#define WASMTIME_FEATURE_ASYNC#define WASMTIME_FEATURE_CRANELIFT#define WASMTIME_FEATURE_WINCH// ... if you add a line above this be sure to change the other locations// marked WASMTIME_FEATURE_LIST#if defined(WASMTIME_FEATURE_CRANELIFT) || defined(WASMTIME_FEATURE_WINCH)#define WASMTIME_FEATURE_COMPILER#endif#endif // WASMTIME_CONF_H</span>
<span class="w">      </span><span class="o">|</span>
<span class="n">In</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
<span class="w">                 </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">wasmtime</span><span class="p">.</span><span class="n">h</span><span class="p">:</span><span class="mi">193</span><span class="p">,</span>
</code></pre></div>
<h3>Steps to Reproduce</h3>
<ul>
<li>Follow the steps to build wasmtime from source <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/README.md</a></li>
<li>Check the <code>target/c-api/include/wasmtime/conf.h</code> see that there are missing new lines</li>
<li>Try to compile anything with the c-api</li>
</ul>
<h3>Versions and Environment</h3>
<ul>
<li>Use cmake version 3.18.4 (for example from a docker container)</li>
</ul>
<div class="codehilite" data-code-language="Docker"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">debian:bullseye</span>
<span class="k">ARG</span><span class="w"> </span>RELEASE

<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--no-install-suggests<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>build-essential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>cmake<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>curl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">'=https'</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>--<span class="w"> </span>-y
</code></pre></div>
<p>Wasmtime version or commit: v23.0.2</p>
<p>Operating system: NixOs, but running in dockercontainer debian:bullseye</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Managed to fix the issue by changing <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14">https://github.com/bytecodealliance/wasmtime/blob/main/crates/c-api/cmake/install-headers.cmake#L14</a></p>
<p><div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">- file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}")</span>
<span class="gi">+ file(CONFIGURE OUTPUT "${dst}/wasmtime/conf.h" CONTENT "${conf_h}" NEWLINE_STYLE LF)</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>