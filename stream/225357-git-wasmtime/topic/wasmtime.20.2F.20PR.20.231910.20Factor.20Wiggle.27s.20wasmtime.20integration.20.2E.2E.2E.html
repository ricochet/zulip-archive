<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1910 Factor Wiggle&#x27;s wasmtime integration ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html">wasmtime / PR #1910 Factor Wiggle&#x27;s wasmtime integration ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="201682953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201682953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201682953">(Jun 23 2020 at 02:36)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which I'll rename shortly.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="201682956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201682956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201682956">(Jun 23 2020 at 02:36)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a>.</p>



<a name="201683035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201683035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201683035">(Jun 23 2020 at 02:39)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on (<code>lucet-wiggle</code>)[https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle], which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201683152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201683152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201683152">(Jun 23 2020 at 02:42)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201771409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201771409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201771409">(Jun 23 2020 at 19:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436091065">PR Review</a>.</p>



<a name="201771410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201771410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201771410">(Jun 23 2020 at 19:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r444457897">PR Review Comment</a>:</p>
<blockquote>
<p>Technically this isn't quite true since wasi-common supports virtual handles, right?</p>
</blockquote>



<a name="201771412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201771412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201771412">(Jun 23 2020 at 19:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436091065">PR Review</a>.</p>



<a name="201779305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201779305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201779305">(Jun 23 2020 at 20:36)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r444491688">PR Review Comment</a>:</p>
<blockquote>
<p>The <code>Handle</code> trait doesn't expose <code>GuestPtr</code> or any types which contain one, so I think technically we are ok. All of the interesting uses of <code>GuestPtr</code> get translated into <code>std::io::IoSlice{Mut}</code> before being passed to the <code>Handle</code> methods.</p>
</blockquote>



<a name="201779306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201779306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201779306">(Jun 23 2020 at 20:36)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436135751">PR Review</a>.</p>



<a name="201785093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201785093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201785093">(Jun 23 2020 at 21:21)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436167378">PR Review</a>.</p>



<a name="201785094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201785094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201785094">(Jun 23 2020 at 21:21)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r444515759">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not necessarily worried about <code>GuestPtr</code>, moreso that if you run arbitrary code it could reenter wasm which could invalidate <code>GuestPtr</code> values on the stack previously. The <code>Handle</code> type I think can run arbitrary code, right? (and internally it can call something which reenters the original wasm module)</p>
</blockquote>



<a name="201787969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201787969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201787969">(Jun 23 2020 at 21:46)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436182062">PR Review</a>.</p>



<a name="201787970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201787970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201787970">(Jun 23 2020 at 21:46)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r444527476">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, right, I forgot about that aspect. Yes, <code>Handle</code> impls can execute whatever code they like, so it is definitely possible for them to re-enter the instance. That means we should be finding some way to provide a <code>BorrowChecker</code> that has the same lifetime as the instance, because the lifetime of the call into these functions is no longer sufficient.</p>
<p>I'm not sure how to do that, but I can fix it in this PR if you can outline how I should, or we can leave it for a separate PR.</p>
</blockquote>



<a name="201791932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201791932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201791932">(Jun 23 2020 at 22:27)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201792010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201792010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201792010">(Jun 23 2020 at 22:28)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201797157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201797157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201797157">(Jun 23 2020 at 23:29)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201801548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201801548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201801548">(Jun 24 2020 at 00:42)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201803115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201803115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201803115">(Jun 24 2020 at 01:11)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201859488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201859488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201859488">(Jun 24 2020 at 15:04)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-436739275">PR Review</a>.</p>



<a name="201859490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201859490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201859490">(Jun 24 2020 at 15:04)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r444963814">PR Review Comment</a>:</p>
<blockquote>
<p>There's a number of ways that we could do this, but I don't think any of them are relatively easy. What we probably want to do is to integrate this into <code>wasmtime</code>-the-crate itself, and that way entering into wasm could <em>always</em> check to make sure there are no active borrows because we have tight control over the wasm entry points.</p>
<p>Perhaps we could have a discussion in an issue about how to best integrate this tightly with the wasmtime crate itself? I feel like borrowing from guest memory is so common it's justified to put this in the core functionality.</p>
</blockquote>



<a name="201894702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201894702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201894702">(Jun 24 2020 at 19:47)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201906807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201906807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201906807">(Jun 24 2020 at 21:34)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> from <code>pch/separate_wasmtime_wiggle_crate</code> to <code>master</code>:</p>
<blockquote>
<p>Presently, integrating wiggle with wasmtime is taken care of as a one-off proc macro in wasi-common's <code>wig</code> crate.</p>
<p>It would be ideal to provide a single proc macro that generates the adapter between <code>wiggle::from_witx!</code> -generated code and Wasmtime. This can be used as a substitute for the <code>wig</code> code in <code>wasmtime-wasi</code>, and in other crates.</p>
<p>The design of this crate is based on <a href="https://github.com/bytecodealliance/lucet/tree/master/lucet-wiggle"><code>lucet-wiggle</code></a>, which provides the same adapter between wiggle and <code>lucet-runtime</code>.</p>
<p>This PR moves and refactors the <code>wig</code> implementation of this adapter code to be general purpose.</p>
<ul>
<li>Creates a new crate <code>wasmtime-wiggle</code> at <code>crates/wiggle/wasmtime</code>. This re-exports <code>wiggle</code> (so users of the adapter only need to track one dep), defines the reusable runtime component <code>WasmtimeGuestMemory</code>, which has an <code>impl GuestMemory</code>, and exports the adapter macro</li>
<li>New crate <code>wasmtime-wiggle-macro</code> is a proc-macro lib at <code>crates/wiggle/wasmtime/macro</code>. This exports <code>define_struct_for_wiggle</code>, which isn't an ideal name anymore, and I'll have to fix.</li>
</ul>
<p>The configuration options for <code>define_struct_for_wiggle</code> are dramatically expanded, and re-use some code and the style of parsing configuration options from <code>wiggle_generate</code>.</p>
</blockquote>



<a name="201908374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201908374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201908374">(Jun 24 2020 at 21:52)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-437032635">PR Review</a>.</p>



<a name="201908375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201908375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201908375">(Jun 24 2020 at 21:52)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#discussion_r445192658">PR Review Comment</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/issues/1917">https://github.com/bytecodealliance/wasmtime/issues/1917</a></p>
</blockquote>



<a name="201908390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201908390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201908390">(Jun 24 2020 at 21:52)</a>:</h4>
<p><strong>pchickey</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a> as ready for review.</p>



<a name="201908396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201908396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201908396">(Jun 24 2020 at 21:52)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a>.</p>



<a name="201975207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201975207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201975207">(Jun 25 2020 at 14:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1910#pullrequestreview-437543166">PR Review</a>.</p>



<a name="201993041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231910%20Factor%20Wiggle%27s%20wasmtime%20integration%20.../near/201993041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231910.20Factor.20Wiggle.27s.20wasmtime.20integration.20.2E.2E.2E.html#201993041">(Jun 25 2020 at 16:34)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1910">PR #1910</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>