<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4947 fix: check filetype in `path_open` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html">wasmtime / PR #4947 fix: check filetype in `path_open`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="300382053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300382053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300382053">(Sep 23 2022 at 14:44)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>:</p>
<blockquote>
<p>Using the <code>directory</code> [open flag] to determine whether the entity being opened is a directory or a file is undefined behavior, since that means that the only way to acquire a usable directory is to specify the flag.</p>
<p>Instead of relying on the [open flag] value to determine the filetype, issue <code>get_path_filestat</code> first to determine it and then perform appropriate operation depending on the value.</p>
<p>Note that this also slightly changes the behavior, where <code>create</code> [open flag] is not dropped anymore, but rather passed through to the <code>open_dir</code> call.</p>
<p>@pchickey seems to be the last person making any significant changes in this method, so assigning him for review</p>
<p>[open flag]: <a href="https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record">https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record</a></p>
<p>Signed-off-by: Roman Volosatovs &lt;<a href="mailto:roman@profian.com">roman@profian.com</a>&gt;</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="300382096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300382096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300382096">(Sep 23 2022 at 14:44)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>:</p>
<blockquote>
<p>Using the <code>directory</code> [open flag] to determine whether the entity being opened is a directory or a file is undefined behavior, since that means that the only way to acquire a usable directory is to specify the flag.</p>
<p>Instead of relying on the [open flag] value to determine the filetype, issue <code>get_path_filestat</code> first to determine it and then perform appropriate operation depending on the value.</p>
<p>Note that this also slightly changes the behavior, where <code>create</code> [open flag] is not dropped anymore, but rather passed through to the <code>open_dir</code> call.</p>
<p>@pchickey seems to be the last person making any significant changes in this method, so assigning him for review</p>
<p>[open flag]: <a href="https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record">https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record</a></p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="300420088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300420088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300420088">(Sep 23 2022 at 17:49)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a>.</p>



<a name="300420681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300420681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300420681">(Sep 23 2022 at 17:52)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300420795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300420795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300420795">(Sep 23 2022 at 17:53)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300421071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300421071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300421071">(Sep 23 2022 at 17:54)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300424851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300424851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300424851">(Sep 23 2022 at 18:13)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>:</p>
<blockquote>
<p>Using the <code>directory</code> [open flag] to determine whether the entity being opened is a directory or a file is undefined behavior, since that means that the only way to acquire a usable directory is to specify the flag.</p>
<p>Instead of relying on the [open flag] value to determine the filetype, issue <code>get_path_filestat</code> first to determine it and then perform appropriate operation depending on the value.</p>
<p>~Note that this also slightly changes the behavior, where <code>create</code> [open flag] is not dropped anymore, but rather passed through to the <code>open_dir</code> call.~</p>
<p>@pchickey seems to be the last person making any significant changes in this method, so assigning him for review</p>
<p>[open flag]: <a href="https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record">https://github.com/WebAssembly/WASI/blob/main/phases/snapshot/docs.md#-oflags-record</a></p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="300454728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300454728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300454728">(Sep 23 2022 at 21:37)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> as ready for review.</p>



<a name="300802442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300802442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300802442">(Sep 26 2022 at 12:28)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300810329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300810329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300810329">(Sep 26 2022 at 13:07)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300812391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300812391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300812391">(Sep 26 2022 at 13:18)</a>:</h4>
<p>rvolosatovs submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#pullrequestreview-1120214207">PR review</a>.</p>



<a name="300812392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300812392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300812392">(Sep 26 2022 at 13:18)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#discussion_r980025673">PR review comment</a>:</p>
<blockquote>
<p>Ideally, I would want to fail here if error is not <code>not found</code>, but that would require either cloning the error (to be able to propagate it if it does not match) and then converting it into a <code>types::Errno</code>. Alternatively, it should be possible to downcast the error, but would require matching on all possible error types, which seems like the wrong thing to do as well.<br>
Is there a reasonable way to do that? I'm looking for <code>Error::not_found(&amp;self) -&gt; bool</code><br>
Discard the error instead and preserve the original behavior.</p>
</blockquote>



<a name="300812538"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300812538" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300812538">(Sep 26 2022 at 13:19)</a>:</h4>
<p>rvolosatovs edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#discussion_r980025673">PR review comment</a>.</p>



<a name="300816596"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300816596" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300816596">(Sep 26 2022 at 13:40)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a> from <code>fix/path_open</code> to <code>main</code>.</p>



<a name="300869025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300869025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300869025">(Sep 26 2022 at 17:49)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#pullrequestreview-1120661695">PR review</a>.</p>



<a name="300869026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300869026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300869026">(Sep 26 2022 at 17:49)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#pullrequestreview-1120661695">PR review</a>.</p>



<a name="300869027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300869027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300869027">(Sep 26 2022 at 17:49)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#discussion_r980332448">PR review comment</a>:</p>
<blockquote>
<p>I think it is reasonable to downcast_ref and match for an ErrorKind::Noent, and if that fails downcast to a std::io::Error with the appropriate check there as well. This is a big janky, and I think if I had to redesign wasi-common I probably wouldn't use a fully dynamic error type and instead make <code>enum Error { Std(std::io::Error), Wasi(ErrorKind) }</code> or something like that, but its been a while since I had this system in my head so I'm not sure why I didn't do that in the first place.</p>
</blockquote>



<a name="300900404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300900404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300900404">(Sep 26 2022 at 21:09)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#pullrequestreview-1120913949">PR review</a>.</p>



<a name="300900405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300900405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300900405">(Sep 26 2022 at 21:09)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#discussion_r980506965">PR review comment</a>:</p>
<blockquote>
<p>I am concerned about this <code>get_path_filestat</code>, because it does a second path lookup. There's a window for a race condition here, where a directory could be replaced by something which is not a directory. I don't yet have a clear view of the consequences of the open succeeding on an unexpected type, so this is something I want to investigate more.</p>
<p>I wonder if it would be possible to instead do something like:</p>
<ul>
<li>Attempt to open with open_dir; if that works, create a <code>DirEntry</code> entry.</li>
<li>If that fails with <code>Notdir</code>, open it with regular <code>open</code>.<br>
Would that work?</li>
</ul>
<p>I know that this is redundant on POSIX hosts, and possibly we could optimize things even more there, but this code is currently written to support Windows also.</p>
</blockquote>



<a name="300925630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300925630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300925630">(Sep 27 2022 at 01:37)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#discussion_r980647102">PR review comment</a>:</p>
<blockquote>
<p>I now have an implementation of this here: <a href="https://github.com/bytecodealliance/wasmtime/pull/4967">https://github.com/bytecodealliance/wasmtime/pull/4967</a></p>
<p>It uses the same testcase as this PR, so it fixes the same bug, but does so in a way that doesn't require doing a stat followed by a separate open. There's more room for improvement beyond that, but hopefully that's a good step.</p>
</blockquote>



<a name="300925631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/300925631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#300925631">(Sep 27 2022 at 01:37)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4947#pullrequestreview-1121102596">PR review</a>.</p>



<a name="351692860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234947%20fix%3A%20check%20filetype%20in%20%60path_open%60/near/351692860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234947.20fix.3A.20check.20filetype.20in.20.60path_open.60.html#351692860">(Apr 21 2023 at 17:33)</a>:</h4>
<p>pchickey closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/4947">PR #4947</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>