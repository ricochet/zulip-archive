<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3302 cranelift: Add heap support to the in... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html">wasmtime / PR #3302 cranelift: Add heap support to the in...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="252021848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252021848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252021848">(Sep 04 2021 at 19:46)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a> from <code>interp-heap</code> to <code>main</code>:</p>
<blockquote>
<p>Hey!</p>
<p>This PR adds heap support to the interpreter and support for heap tests for <code>test interpret</code>.</p>
</blockquote>



<a name="252022290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252022290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252022290">(Sep 04 2021 at 19:54)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-746592014">PR review</a>.</p>



<a name="252022291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252022291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252022291">(Sep 04 2021 at 19:54)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702322139">PR review comment</a>:</p>
<blockquote>
<p>I'm not entirely sure this belongs here.</p>
<p>I had this separately in <code>InterpreterState::get_heap_address</code>, but I didn't want to duplicate the bounds checking done on this function.</p>
<p>Since bounds checking is only required as part of the runtime guarantees (for <code>heap_address</code> in addressable memory), I think it would make sense to put this back in <code>get_heap_address</code>, but also means we then have <code>InterpreterState::get_heap_address</code> and <code>InterpreterState::heap_address</code> which do something different.</p>
</blockquote>



<a name="252022814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252022814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252022814">(Sep 04 2021 at 20:03)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-746592583">PR review</a>.</p>



<a name="252022815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252022815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252022815">(Sep 04 2021 at 20:03)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702323004">PR review comment</a>:</p>
<blockquote>
<p>I'm not too happy with this interface as a way to register a VMContext struct.</p>
<p>We need to have a way to address this struct, and currently we only have Stack and Heap addresses. Adding a whole new region just for VMContext structs seems a bit much, but this is also not very clear.</p>
</blockquote>



<a name="252022920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252022920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252022920">(Sep 04 2021 at 20:05)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702322139">PR review comment</a>.</p>



<a name="252023192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252023192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252023192">(Sep 04 2021 at 20:10)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702323004">PR review comment</a>.</p>



<a name="252047058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252047058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252047058">(Sep 05 2021 at 03:53)</a>:</h4>
<p>afonso360 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702323004">PR review comment</a>.</p>



<a name="252069522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252069522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252069522">(Sep 05 2021 at 11:16)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r702322139">PR review comment</a>.</p>



<a name="252938082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/252938082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#252938082">(Sep 11 2021 at 21:55)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a> from <code>interp-heap</code> to <code>main</code>.</p>



<a name="256633675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633675">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-774245721">PR review</a>.</p>



<a name="256633676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633676">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r724460344">PR review comment</a>:</p>
<blockquote>
<p>At a high level, I'm not sure I fully grok what's going on here: the heap base is itself an address with a heap and offset component? In other words, do heaps resolve into regions within other heaps? If so, could you add a comment here (or a toplevel one somewhere) describing how the resolution works?</p>
</blockquote>



<a name="256633677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633677">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r724458458">PR review comment</a>:</p>
<blockquote>
<p>Should this be <code>!= 0</code>? (I haven't fully internalized the interpreter state data structures so I could be misunderstanding what <code>frame_stack</code> actually means.)</p>
</blockquote>



<a name="256633678"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633678" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633678">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-774245721">PR review</a>.</p>



<a name="256633679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633679">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r724423566">PR review comment</a>:</p>
<blockquote>
<p>Is there a reason for the trailing underscore here? Otherwise <code>static_heap_i64</code> seems fine to me.</p>
</blockquote>



<a name="256633680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/256633680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#256633680">(Oct 07 2021 at 19:14)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r724424624">PR review comment</a>:</p>
<blockquote>
<p>Ah -- does this have to do with the maximum test identifier length? If so, just choosing shorter names (rather than truncating them) seems like a good solution. </p>
</blockquote>



<a name="287505310"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287505310" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287505310">(Jun 26 2022 at 17:45)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1019461624">PR review</a>.</p>



<a name="287505311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287505311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287505311">(Jun 26 2022 at 17:45)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r906851238">PR review comment</a>:</p>
<blockquote>
<p>Oh wow, yes it should. And the branches in the if are also swapped. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
</blockquote>



<a name="287573848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287573848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287573848">(Jun 27 2022 at 13:00)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a> from <code>interp-heap</code> to <code>main</code>.</p>



<a name="287574137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287574137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287574137">(Jun 27 2022 at 13:02)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a> from <code>interp-heap</code> to <code>main</code>.</p>



<a name="287575113"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287575113" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287575113">(Jun 27 2022 at 13:09)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1020172003">PR review</a>.</p>



<a name="287575114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287575114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287575114">(Jun 27 2022 at 13:09)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r907371365">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>the heap base is itself an address with a heap and offset component?<br>
Well, yes it could be. Resolving global values means that that address could be anywhere in memory, even in the stack. </p>
</blockquote>
<blockquote>
<p>In other words, do heaps resolve into regions within other heaps?<br>
Yes, we can have multiple CLIF Heaps that resolve to the same heap in the interpreter.</p>
</blockquote>
<p>This function was quite a bit confusing because we used the same <code>Heap</code> type to mean both a CLIF Heap and a Interpreter Heap. I've now separated those two into separate types, and the function now<br>
only does CLIF Heap resolution.</p>
</blockquote>



<a name="287575220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287575220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287575220">(Jun 27 2022 at 13:10)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r907371365">PR review comment</a>.</p>



<a name="287575232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287575232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287575232">(Jun 27 2022 at 13:11)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r907371365">PR review comment</a>.</p>



<a name="287575249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/287575249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#287575249">(Jun 27 2022 at 13:11)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r907371365">PR review comment</a>.</p>



<a name="288195531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195531">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912099781">PR review comment</a>:</p>
<blockquote>
<p>If I understand this right, it is building a vmctx out of a linear layout of (base, length) tuples, but don't the heap directives at least for the runtests allow us to put the base and length pointers at arbitrary vmctx offsets? Do we need to consider that here? (If not, a comment would help!)</p>
</blockquote>



<a name="288195532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195532">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912102990">PR review comment</a>:</p>
<blockquote>
<p>Do we need to check here that the length of the backing vec is at least as large as the size that was claimed in the <code>; heap: ...</code> directives, or somehow connect to that? Or is there an invariant that we will extend it if needed?</p>
</blockquote>



<a name="288195533"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195533" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195533">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912101950">PR review comment</a>:</p>
<blockquote>
<p>s/its/it's/</p>
</blockquote>



<a name="288195534"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195534" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195534">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912101652">PR review comment</a>:</p>
<blockquote>
<p>s/essential/essentially/</p>
</blockquote>



<a name="288195535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195535">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1026425171">PR review</a>.</p>



<a name="288195536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195536">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912104103">PR review comment</a>:</p>
<blockquote>
<p>stray type annotation in comment -- remove?</p>
</blockquote>



<a name="288195537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288195537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288195537">(Jul 01 2022 at 16:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1026425171">PR review</a>.</p>



<a name="288272653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288272653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288272653">(Jul 02 2022 at 14:18)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1026762226">PR review</a>.</p>



<a name="288272654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288272654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288272654">(Jul 02 2022 at 14:18)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912367304">PR review comment</a>:</p>
<blockquote>
<p>We had that design at the beginning but eventually settled on having the annotations in the <code>; heap</code> directive but forcing them to a linear layout of tuples. This is enforced when parsing the heap directives.</p>
<p>I've added a comment clarifying this.<br>
</p>
</blockquote>



<a name="288273581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288273581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288273581">(Jul 02 2022 at 14:36)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1026763553">PR review</a>.</p>



<a name="288273582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288273582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288273582">(Jul 02 2022 at 14:36)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912368933">PR review comment</a>:</p>
<blockquote>
<p>This function here is somewhat independent of the testing infrastructure. And the interpreter doesn't really care about the size of the backing memory, since out of bounds writes/reads generate a trap.</p>
<p>The memory is allocated by the <code>RuntestEnvironment</code> struct which is the same struct that parses the <code>heap</code> directives. From there we just pass that memory directly into the interpreter, this happens in <code>test_interpret.rs</code> that's where we enforce that the heaps have the same size as the directives.</p>
</blockquote>



<a name="288273589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288273589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288273589">(Jul 02 2022 at 14:37)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#discussion_r912368933">PR review comment</a>.</p>



<a name="288273674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288273674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288273674">(Jul 02 2022 at 14:39)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a> from <code>interp-heap</code> to <code>main</code>.</p>



<a name="288552036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288552036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288552036">(Jul 05 2022 at 16:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3302#pullrequestreview-1028878904">PR review</a>.</p>



<a name="288552056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233302%20cranelift%3A%20Add%20heap%20support%20to%20the%20in.../near/288552056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233302.20cranelift.3A.20Add.20heap.20support.20to.20the.20in.2E.2E.2E.html#288552056">(Jul 05 2022 at 16:05)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3302">PR #3302</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>