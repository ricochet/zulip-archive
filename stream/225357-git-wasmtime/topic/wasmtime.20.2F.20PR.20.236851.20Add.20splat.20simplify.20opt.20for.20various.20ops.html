<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6851 Add splat simplify opt for various ops · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html">wasmtime / PR #6851 Add splat simplify opt for various ops</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="385334109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385334109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385334109">(Aug 16 2023 at 04:03)</a>:</h4>
<p>gurry opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a> from <code>gurry:issue-6828</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Fixes #6828</p>
</blockquote>



<a name="385400360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385400360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385400360">(Aug 16 2023 at 08:17)</a>:</h4>
<p>gurry updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385442013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385442013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385442013">(Aug 16 2023 at 11:30)</a>:</h4>
<p>gurry updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385459920"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385459920" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385459920">(Aug 16 2023 at 13:14)</a>:</h4>
<p>gurry updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385583267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385583267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385583267">(Aug 17 2023 at 02:51)</a>:</h4>
<p><strong>gurry</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a> as ready for review.</p>



<a name="385583269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385583269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385583269">(Aug 17 2023 at 02:51)</a>:</h4>
<p><strong>gurry</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385583270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385583270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385583270">(Aug 17 2023 at 02:51)</a>:</h4>
<p><strong>gurry</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385658901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385658901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385658901">(Aug 17 2023 at 11:59)</a>:</h4>
<p>gurry updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385663807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385663807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385663807">(Aug 17 2023 at 12:30)</a>:</h4>
<p><strong>gurry</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a> as ready for review.</p>



<a name="385733901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385733901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385733901">(Aug 17 2023 at 18:57)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#pullrequestreview-1583276742">PR review</a>.</p>



<a name="385733903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385733903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385733903">(Aug 17 2023 at 18:57)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#discussion_r1297621146">PR review comment</a>:</p>
<blockquote>
<p>I think <code>avg_round</code> might also not have a scalar substitute at least the <a href="https://docs.rs/cranelift-codegen/latest/cranelift_codegen/ir/trait.InstBuilder.html#method.avg_round">docs</a> don't claim it does.</p>
</blockquote>



<a name="385735057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385735057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385735057">(Aug 17 2023 at 19:04)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#pullrequestreview-1583287330">PR review</a>:</p>
<blockquote>
<p>This looks great! Thanks for working through this.</p>
<p>I've had a look at the rest of our opcodes and I don't think we are missing any of them (at least for integers)!</p>
<p>I think it's possible to do a transform from <code>splat+icmp</code> into <code>icmp+bmask+splat</code>, but leaving that for a future PR is also OK!</p>
<p>I've also run our fuzzer on this PR for a couple of hours and nothing has come up.</p>
</blockquote>



<a name="385735224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385735224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385735224">(Aug 17 2023 at 19:05)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#pullrequestreview-1583287330">PR review</a>:</p>
<blockquote>
<p>This looks great! Thanks for working through this.</p>
<p>I've had a look at the rest of our opcodes and I don't think we are missing any of them (at least for integers)!</p>
<p>I think it's possible to do a transform from <code>splat+icmp</code> into <code>icmp+bmask+splat</code>, but leaving that for a future PR is also OK! I'm also not sure if this is a good transform to do. Since I think it would be the only one that actually adds instructions rather than reducing them.</p>
<p>I've also run our fuzzer on this PR for a couple of hours and nothing has come up.</p>
</blockquote>



<a name="385812366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385812366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385812366">(Aug 18 2023 at 04:00)</a>:</h4>
<p>gurry updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<a name="385817489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385817489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385817489">(Aug 18 2023 at 04:33)</a>:</h4>
<p>gurry submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#pullrequestreview-1583835825">PR review</a>.</p>



<a name="385817490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385817490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385817490">(Aug 18 2023 at 04:33)</a>:</h4>
<p>gurry created <a href="https://github.com/bytecodealliance/wasmtime/pull/6851#discussion_r1297994325">PR review comment</a>:</p>
<blockquote>
<p>Thanks for spotting that. Removed it.</p>
</blockquote>



<a name="385865537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236851%20Add%20splat%20simplify%20opt%20for%20various%20ops/near/385865537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236851.20Add.20splat.20simplify.20opt.20for.20various.20ops.html#385865537">(Aug 18 2023 at 09:02)</a>:</h4>
<p>afonso360 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6851">PR #6851</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>