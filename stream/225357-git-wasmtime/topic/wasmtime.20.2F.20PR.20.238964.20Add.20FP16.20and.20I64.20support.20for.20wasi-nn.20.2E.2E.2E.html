<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8964 Add FP16 and I64 support for wasi-nn ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html">wasmtime / PR #8964 Add FP16 and I64 support for wasi-nn ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="451763227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451763227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451763227">(Jul 16 2024 at 13:48)</a>:</h4>
<p>jianjunz opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a> from <code>jianjunz:f16-i64</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Some devices may not support FP32.</p>
</blockquote>



<a name="451915927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451915927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451915927">(Jul 17 2024 at 02:22)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451918402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451918402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451918402">(Jul 17 2024 at 02:48)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451925151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451925151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451925151">(Jul 17 2024 at 03:56)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451968291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451968291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451968291">(Jul 17 2024 at 07:21)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451985935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451985935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451985935">(Jul 17 2024 at 08:29)</a>:</h4>
<p><strong>jianjunz</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a> as ready for review.</p>



<a name="451985942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451985942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451985942">(Jul 17 2024 at 08:29)</a>:</h4>
<p><strong>jianjunz</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451985945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451985945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451985945">(Jul 17 2024 at 08:29)</a>:</h4>
<p><strong>jianjunz</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="451985948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/451985948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#451985948">(Jul 17 2024 at 08:29)</a>:</h4>
<p><strong>jianjunz</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="452091765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452091765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452091765">(Jul 17 2024 at 14:30)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="452456369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456369">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187025186">PR review</a>.</p>



<a name="452456370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456370">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683580278">PR review comment</a>:</p>
<blockquote>
<p>When is this needed?</p>
</blockquote>



<a name="452456371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456371">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683594469">PR review comment</a>:</p>
<blockquote>
<p>Are we sure <code>cast</code> is right here? Poking around in <code>windows-rs</code>, I see that it has a <code>CanInto</code> implementation for <code>TensorFeatureDescriptor</code> <a href="https://microsoft.github.io/windows-docs-rs/doc/windows/AI/MachineLearning/struct.ILearningModelFeatureDescriptor.html#impl-CanInto%3CILearningModelFeatureDescriptor%3E-for-TensorFeatureDescriptor">here</a> &mdash; doesn't that mean we should be using <code>into()</code> instead?</p>
</blockquote>



<a name="452456372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456372">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683580761">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        let inspectable =
</code></pre></div><br>
</p>
</blockquote>



<a name="452456373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456373">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683580043">PR review comment</a>:</p>
<blockquote>
<p>You probably only need <code>implement</code> for this PR, right?</p>
</blockquote>



<a name="452456374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456374">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683581846">PR review comment</a>:</p>
<blockquote>
<p>Is this correct? ONNX is going to represent this type with 4 bytes instead of 2 bytes? If so, maybe we should add a comment describing why this is the case and linking to some documentation; otherwise, it's a bit surprising.</p>
</blockquote>



<a name="452456375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456375">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683579488">PR review comment</a>:</p>
<blockquote>
<p>I don't think this makes sense. The <code>cargo test</code> above runs both the unit tests within the library as well as the integration tests in the <code>tests</code> directory.</p>
</blockquote>



<a name="452456376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456376">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683599370">PR review comment</a>:</p>
<blockquote>
<p>Not sure if it's any faster, but this would avoid the size calculation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="kt">f32</span><span class="p">::</span><span class="n">to_le_bytes</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span>
</code></pre></div>
<p>We might want to note somewhere that the LE ordering is here to match WebAssembly's ordering, not the platform we're running on (in which case always doing LE could be incorrect).</p>
</blockquote>



<a name="452456377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456377">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683596555">PR review comment</a>:</p>
<blockquote>
<p>We can do this once at the top of the function.</p>
</blockquote>



<a name="452456378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456378">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683603918">PR review comment</a>:</p>
<blockquote>
<p>When doing this <code>unsafe</code> "cast" to a slice, we also need to make sure that the <code>u8</code> pointer to <code>tensor.data</code> is aligned in such a way that the <code>f32</code>s in <code>data</code> will also be aligned to their 4-byte alignment. Here's an <a href="https://github.com/intel/openvino-rs/blob/main/crates/openvino/src/tensor.rs#L124-L151">example</a> of how to do the check from <code>openvino-rs</code>. And the <a href="https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html">docs for <code>std::slice::from_raw_parts</code></a> have all the details. I think it would be fine here to fail if things aren't aligned correctly (instead of trying to shift everything!), at least for the time being.</p>
</blockquote>



<a name="452456379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456379">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683593805">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                _ =&gt; unimplemented!("the winml backend only supports tensors, found: {}", kind),
</code></pre></div><br>
</p>
</blockquote>



<a name="452456380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456380">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683588027">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                tensor.data.as_ptr().cast&lt;i64&gt;,
</code></pre></div>
<p>These days clippy tells me this is the preferred way to do this.</p>
</blockquote>



<a name="452456381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456381">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683595054">PR review comment</a>:</p>
<blockquote>
<p>This kind of comment can be moved from here to the <code>unimplemented!()</code> at the end of <code>to_tensor</code> so that both users and code readers can take advantage of this information.</p>
</blockquote>



<a name="452456382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456382">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683595950">PR review comment</a>:</p>
<blockquote>
<p>E.g., <a href="https://microsoft.github.io/windows-docs-rs/doc/windows/AI/MachineLearning/struct.TensorFloat16Bit.html#method.CreateFromArray">https://microsoft.github.io/windows-docs-rs/doc/windows/AI/MachineLearning/struct.TensorFloat16Bit.html#method.CreateFromArray</a>.</p>
</blockquote>



<a name="452456383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456383">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683586704">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        TensorType::Fp32 =&gt; unsafe {
</code></pre></div>
<p>Isn't <code>TensorType</code> already imported?</p>
</blockquote>



<a name="452456384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452456384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452456384">(Jul 18 2024 at 23:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683605409">PR review comment</a>:</p>
<blockquote>
<p>It took me a second to understand that what we're trying to do is "roundtrip" a tensor through <code>to_inspectable</code> and back through <code>to_tensor</code>. To make this more clear, can you look at factoring out some of the duplication here?</p>
</blockquote>



<a name="452468668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452468668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452468668">(Jul 19 2024 at 01:40)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="452468909"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452468909" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452468909">(Jul 19 2024 at 01:44)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187139282">PR review</a>.</p>



<a name="452468910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452468910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452468910">(Jul 19 2024 at 01:44)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683663453">PR review comment</a>:</p>
<blockquote>
<p>You're right. The <code>cargo test</code> above also runs unit tests. <a href="https://github.com/bytecodealliance/wasmtime/actions/runs/9969920948/job/27547820669#step:8:409">https://github.com/bytecodealliance/wasmtime/actions/runs/9969920948/job/27547820669#step:8:409</a></p>
</blockquote>



<a name="452468949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452468949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452468949">(Jul 19 2024 at 01:45)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187140182">PR review</a>.</p>



<a name="452468950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452468950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452468950">(Jul 19 2024 at 01:45)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683664333">PR review comment</a>:</p>
<blockquote>
<p>Removed. They're not needed for this one.</p>
</blockquote>



<a name="452472888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452472888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452472888">(Jul 19 2024 at 02:33)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187166401">PR review</a>.</p>



<a name="452472889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452472889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452472889">(Jul 19 2024 at 02:33)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683693053">PR review comment</a>:</p>
<blockquote>
<p><code>output_tensor</code>'s type is unknown at the top of the function.</p>
</blockquote>



<a name="452472890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452472890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452472890">(Jul 19 2024 at 02:33)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683684552">PR review comment</a>:</p>
<blockquote>
<p>WinML may report an error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="bp">self</span><span class="p">.</span><span class="n">binding</span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="s">"input"</span><span class="p">,</span><span class="w"> </span><span class="n">tensor</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
<span class="bp">self</span><span class="p">.</span><span class="n">binding</span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="s">"input"</span><span class="p">,</span><span class="w"> </span><span class="n">tensor</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span><span class="w">  </span><span class="o">&lt;--</span><span class="w"> </span><span class="n">error</span>
</code></pre></div>
<p>But it works</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="bp">self</span><span class="p">.</span><span class="n">binding</span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="s">"input"</span><span class="p">,</span><span class="w"> </span><span class="n">tensor</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
<span class="bp">self</span><span class="p">.</span><span class="n">binding</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="bp">self</span><span class="p">.</span><span class="n">binding</span><span class="p">.</span><span class="n">Bind</span><span class="p">(</span><span class="s">"input"</span><span class="p">,</span><span class="w"> </span><span class="n">tensor</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>
</code></pre></div>
</blockquote>



<a name="452472891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452472891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452472891">(Jul 19 2024 at 02:33)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683689938">PR review comment</a>:</p>
<blockquote>
<p>WinML may use 2 bytes internally because it's fp16, but f16 is not officially supported by Rust stable, so we use f32 here.</p>
</blockquote>



<a name="452486315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486315">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187187727">PR review</a>.</p>



<a name="452486318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486318">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683702229">PR review comment</a>:</p>
<blockquote>
<p>Removed <code>crate::wit::types::</code>.</p>
</blockquote>



<a name="452486319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486319">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683700252">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="452486320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486320">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683700900">PR review comment</a>:</p>
<blockquote>
<p>Removed.</p>
</blockquote>



<a name="452486321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486321">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683700731">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="452486322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452486322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452486322">(Jul 19 2024 at 04:52)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683785231">PR review comment</a>:</p>
<blockquote>
<p><code>view</code>'s type is <code>IVectorView</code>, not a rust collection, so the short version doesn't work here.</p>
</blockquote>



<a name="452497774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452497774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452497774">(Jul 19 2024 at 06:27)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187427836">PR review</a>.</p>



<a name="452497776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452497776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452497776">(Jul 19 2024 at 06:27)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683872294">PR review comment</a>:</p>
<blockquote>
<p>My understanding is <code>cast</code> here is for COM interfaces, similar as <a href="https://learn.microsoft.com/en-us/cpp/atl/queryinterface">QueryInterface</a>, while <code>into</code> is for converting derived class into base class?</p>
</blockquote>



<a name="452497922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452497922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452497922">(Jul 19 2024 at 06:28)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="452498441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452498441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452498441">(Jul 19 2024 at 06:33)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187437959">PR review</a>.</p>



<a name="452498443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452498443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452498443">(Jul 19 2024 at 06:33)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683879869">PR review comment</a>:</p>
<blockquote>
<p>Replaced with <code>cast</code>.</p>
</blockquote>



<a name="452514572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452514572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452514572">(Jul 19 2024 at 08:10)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="452514832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452514832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452514832">(Jul 19 2024 at 08:11)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187609333">PR review</a>.</p>



<a name="452514834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452514834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452514834">(Jul 19 2024 at 08:11)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683989592">PR review comment</a>:</p>
<blockquote>
<p>Thanks for the info. Added assertion when getting length.</p>
</blockquote>



<a name="452514983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452514983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452514983">(Jul 19 2024 at 08:12)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2187612344">PR review</a>.</p>



<a name="452514986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/452514986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#452514986">(Jul 19 2024 at 08:12)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1683991834">PR review comment</a>:</p>
<blockquote>
<p>Implemented <code>PartialEq</code> for <code>Tensor</code>, so we don't need a lot of <code>assert_eq!</code> here.</p>
</blockquote>



<a name="453575832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575832">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2195431250">PR review</a>.</p>



<a name="453575835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575835">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1688990550">PR review comment</a>:</p>
<blockquote>
<p>Ok, so this needs to be fixed then in this PR?</p>
</blockquote>



<a name="453575836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575836">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689005796">PR review comment</a>:</p>
<blockquote>
<p>No, I don't think that is not correct. I checked out the code and <code>let data = view.into_iter().flat_map(f32::to_le_bytes).collect();</code> (changing <code>map</code> to <code>flat_map</code>) seems to compile ok.</p>
</blockquote>



<a name="453575837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575837">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689009482">PR review comment</a>:</p>
<blockquote>
<p>We should probably be using <code>shape</code> here to verify that <code>tensor.dimensions</code> matches.</p>
</blockquote>



<a name="453575838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575838">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1688991490">PR review comment</a>:</p>
<blockquote>
<p>Not sure that answers the question...</p>
</blockquote>



<a name="453575839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453575839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453575839">(Jul 24 2024 at 02:41)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1688992428">PR review comment</a>:</p>
<blockquote>
<p>If you'd like to do this in a more standard way, I just learned of <code>align_to</code> which <a href="https://github.com/intel/openvino-rs/pull/135/files">can be used</a> to do the same thing.</p>
</blockquote>



<a name="453604003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604003">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="453604039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604039">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2195651268">PR review</a>.</p>



<a name="453604040"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604040" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604040">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689160383">PR review comment</a>:</p>
<blockquote>
<p>I mean <code>cast</code> here queries if the COM object can be convert into a derived class, while <code>into</code> is used to convert into a base class. That's my understanding.</p>
</blockquote>



<a name="453604041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604041">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689139129">PR review comment</a>:</p>
<blockquote>
<p>No, not in this one. It cannot be easily fixed by adding a <code>self.binding.Clear()</code> here because a model may have multiple input features. In this case, application calls <code>set_input</code> more than once. </p>
</blockquote>



<a name="453604042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604042">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689185258">PR review comment</a>:</p>
<blockquote>
<p>Thanks for pointing out the duplication here. I think we don't need to verify shape here, WinML will check it later, so <code>shape</code> is removed.</p>
</blockquote>



<a name="453604069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604069">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2195727451">PR review</a>.</p>



<a name="453604070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453604070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453604070">(Jul 24 2024 at 06:13)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1689193831">PR review comment</a>:</p>
<blockquote>
<p><code>flat_map</code> works. Thanks.</p>
</blockquote>



<a name="453626975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/453626975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#453626975">(Jul 24 2024 at 08:22)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="456734509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734509">(Aug 06 2024 at 00:34)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2220042244">PR review</a>.</p>



<a name="456734512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734512">(Aug 06 2024 at 00:34)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704750163">PR review comment</a>:</p>
<blockquote>
<p>I think I understand what you're saying about <code>Clear</code>: it erases _all_ the bindings, even for other model inputs. We can't have that. But what happens in this conceivable sequence?</p>
<ul>
<li>Wasm guest calls <code>set_input</code> on input N with shape A</li>
<li>Wasm guest again calls <code>set_input</code> on input N with shape B</li>
</ul>
<p>This is valid, though silly. The user should not have to face an error from wasi-nn in this case, right? But, if WinML is going to raise an error, then should we protect this some other way, e.g., by checking that the tensor shape is what the model expects (either A or B)?</p>
</blockquote>



<a name="456734513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734513">(Aug 06 2024 at 00:34)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704755399">PR review comment</a>:</p>
<blockquote>
<p>How about</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">itensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inspectable</span><span class="p">.</span><span class="n">cast</span><span class="o">&lt;</span><span class="n">ITensor</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimensions_as_u32</span><span class="p">(</span><span class="o">&amp;</span><span class="n">itensor</span><span class="p">.</span><span class="n">Shape</span><span class="p">()</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
<p>or something like that?</p>
</blockquote>



<a name="456734514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734514">(Aug 06 2024 at 00:34)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704753541">PR review comment</a>:</p>
<blockquote>
<p>Ok, please add a comment explaining that and link to the docs I mentioned.</p>
</blockquote>



<a name="456734515"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734515" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734515">(Aug 06 2024 at 00:34)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704752891">PR review comment</a>:</p>
<blockquote>
<p>I'm not familiar enough with COM so I'll take your word for it that this is the right approach.</p>
</blockquote>



<a name="456734766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734766">(Aug 06 2024 at 00:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2220051801">PR review</a>.</p>



<a name="456734768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456734768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456734768">(Aug 06 2024 at 00:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704756896">PR review comment</a>:</p>
<blockquote>
<p>Probably should just <code>#[derive(PartialEq)]</code> since it's equivalent to this I think.</p>
</blockquote>



<a name="456747607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456747607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456747607">(Aug 06 2024 at 02:16)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="456750632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456750632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456750632">(Aug 06 2024 at 02:43)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2220071307">PR review</a>.</p>



<a name="456750633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456750633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456750633">(Aug 06 2024 at 02:43)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704771196">PR review comment</a>:</p>
<blockquote>
<p>That's a variable input, accepts both A and B (like a string with different length). I feel like this is a bug of WinML, or the calling flow is incorrect. <code>Clear</code> fixes the issue but I'm not sure if that's the only solution, so I'm not adding <code>Clear</code> at this time.</p>
</blockquote>



<a name="456750634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456750634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456750634">(Aug 06 2024 at 02:43)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1704835789">PR review comment</a>:</p>
<blockquote>
<p>It works, but <code>GetAsVectorView</code> is a method of <code>TensorFloat16Bit</code>. Then we'll need to cast <code>itensor</code> again to specific tensor type. The change above makes code clean but will it be a performance issue to cast twice?</p>
</blockquote>



<a name="456821577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456821577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456821577">(Aug 06 2024 at 10:45)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="456821727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456821727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456821727">(Aug 06 2024 at 10:46)</a>:</h4>
<p>jianjunz submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2220946155">PR review</a>.</p>



<a name="456821728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/456821728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#456821728">(Aug 06 2024 at 10:46)</a>:</h4>
<p>jianjunz created <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#discussion_r1705320722">PR review comment</a>:</p>
<blockquote>
<p>It works. Thanks.</p>
</blockquote>



<a name="457226961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/457226961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#457226961">(Aug 07 2024 at 23:51)</a>:</h4>
<p>jianjunz updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="457228823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/457228823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#457228823">(Aug 08 2024 at 00:06)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<a name="457417709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/457417709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#457417709">(Aug 08 2024 at 16:38)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8964#pullrequestreview-2228380815">PR review</a>.</p>



<a name="457420364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238964%20Add%20FP16%20and%20I64%20support%20for%20wasi-nn%20.../near/457420364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238964.20Add.20FP16.20and.20I64.20support.20for.20wasi-nn.20.2E.2E.2E.html#457420364">(Aug 08 2024 at 16:54)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8964">PR #8964</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>