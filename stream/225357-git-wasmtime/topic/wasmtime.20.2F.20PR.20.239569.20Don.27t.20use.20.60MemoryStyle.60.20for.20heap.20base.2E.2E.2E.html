<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9569 Don&#x27;t use `MemoryStyle` for heap base... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html">wasmtime / PR #9569 Don&#x27;t use `MemoryStyle` for heap base...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="480818094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818094">(Nov 05 2024 at 23:54)</a>:</h4>
<p>alexcrichton assigned fitzgen to <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<a name="480818095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818095">(Nov 05 2024 at 23:54)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<a name="480818096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818096">(Nov 05 2024 at 23:54)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<a name="480818097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818097">(Nov 05 2024 at 23:54)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<a name="480818099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818099">(Nov 05 2024 at 23:54)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a> from <code>alexcrichton:heap-base-pointer</code> to <code>bytecodealliance:main</code> (assigned to fitzgen):</p>
<blockquote>
<p>Instead add a helper method to <code>Memory</code> which indicates whether the base pointer of memory can move. Use this and plumb the result around to the various locations that require it. This improves the <code>readonly</code> application of the base pointer in Cranelift by having the optimization kick in in more scenarios. It additionally fixes combining shared linear memories with 64-bit addressing or a page size of 1 by adding a runtime check before relocation of a linear memory that it's allowed to do so.</p>
<p>A few codegen tests are added to ensure that <code>readonly</code> is applied where it wasn't previously and additionally a new <code>*.wast</code> test was added with the cross product of various features of linear memories and some basic tests to ensure that the memories all work as expected.</p>
<p>This refactoring fixes two preexisting issues about <code>shared</code> memories requiring a "static" memory style. The restriction is now based on whether the pointer can relocate or not and that's upheld via the new trait method added here.</p>
<p>To account for these bug fixes the fuzzers have been updated to allow mixing the <code>threads</code> proposal with <code>memory64</code> or <code>custom-page-sizes</code>.</p>
<p>Closes #4267<br>
Closes #9523</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="480818145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480818145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480818145">(Nov 05 2024 at 23:55)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9569#issuecomment-2458431298">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>:</p>
<blockquote>
<p>I'll also notably point out that this is incompatible with <code>MemoryCreator</code> so I've filed #9568 to track that. I think there needs to be a good bit of refactoring of the internals of how we represent memory so I hope to tackle that next-ish.</p>
</blockquote>



<a name="480835150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480835150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480835150">(Nov 06 2024 at 02:55)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/9569#issuecomment-2458627745">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing", "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="480961741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480961741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480961741">(Nov 06 2024 at 16:52)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9569#pullrequestreview-2418913100">PR review</a>:</p>
<blockquote>
<p>Really like this clean up, everything is much easier to follow now. Thanks!</p>
</blockquote>



<a name="480973138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480973138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480973138">(Nov 06 2024 at 17:59)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a> (assigned to fitzgen).</p>



<a name="480973144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480973144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480973144">(Nov 06 2024 at 17:59)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<a name="480977894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239569%20Don%27t%20use%20%60MemoryStyle%60%20for%20heap%20base.../near/480977894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239569.20Don.27t.20use.20.60MemoryStyle.60.20for.20heap.20base.2E.2E.2E.html#480977894">(Nov 06 2024 at 18:28)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9569">PR #9569</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>