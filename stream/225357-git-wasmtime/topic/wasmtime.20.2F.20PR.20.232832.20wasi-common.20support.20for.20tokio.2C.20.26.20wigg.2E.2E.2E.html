<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2832 wasi-common support for tokio, &amp; wigg... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html">wasmtime / PR #2832 wasi-common support for tokio, &amp; wigg...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="237582273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237582273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237582273">(May 05 2021 at 23:19)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237582607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237582607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237582607">(May 05 2021 at 23:23)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237582619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237582619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237582619">(May 05 2021 at 23:23)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237585737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237585737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237585737">(May 06 2021 at 00:01)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>:</p>
<blockquote>
<p>This PR makes it possible for <code>wasi-common</code> to work on with async executor like <code>tokio</code>, without taking a dependency on any sort of asynchronous runtime. Existing users of <code>wasi-common</code> will not need to make any changes.</p>
<p>It introduces the new crate <code>wasi-tokio</code>, which is a sibling crate to <code>wasi-cap-std-sync</code>, and also depending on <code>wasi-cap-std-sync</code>, since much of the implementation has been reused.</p>
<p><code>wasmtime-wiggle</code> now supports running async methods via a dummy executor, in order to support running synchronous wasi-common implementations. To configure this mode in <code>wasmtime-wiggle</code>, use the new <code>block_on</code> configuration option in place of <code>async</code> as introduced in #2701. This mode executes the async methods in a "dummy executor" - a mocked <code>std::task::Waker</code> which will only poll a future correctly if it immediately returns <code>Poll::Ready</code>.</p>
<p><code>wasi-common</code> now uses an <code>async_trait</code> to make each <code>WasiFile</code>, <code>WasiDir</code>, and <code>WasiSched</code> trait method <code>async</code>. This means that any operation on files, directories, or the scheduler may return a pending future depending on the impl of those traits.</p>
<p><code>wasi-cap-std-sync</code> stays the same, modulo the code golf required to add <code>async</code> in front of some fns. All of these impls are synchronous - the futures returned by these will always be <code>Poll::Ready</code>. Therefore, it is safe to use with the dummy executor.</p>
<p>The <code>WasiFile</code> trait has two additional methods, <code>async fn readable(&amp;mut self) -&gt; Result&lt;(), Error&gt;</code> and a corresponding <code>writable</code>, which have semantics corresponding to a wasi <code>Subscription::FdRead</code> and <code>FdWrite</code> - the futures are ready when the file is ready to read or write. These methods are intended to be used by an impl of <code>WasiSched::poll_oneoff</code>.</p>
<p><code>wasi-tokio</code> is implemented mostly in terms of <code>wasi-cap-std-sync</code>. cap-std provides a robust implementation of filesystem sandboxing, which we still need to rely on. All file and directory operations delegated to the <code>wasi-cap-std-sync</code> impl are wrapped in <code>tokio::task::block_in_place</code>, which tells the tokio runtime to execute that code on a thread that may block. This is how tokio's own <code>File</code> type treats all of its IO operations as well. The departure of <code>wasi-tokio</code> from wasi-cap-std-sync is in the impl of the <code>WasiFile::{readable, writable}</code> methods, which use <code>tokio::io::unix::AsyncFd</code> when available, and the <code>WasiSched::poll_oneoff</code> method is implemented using those futures and <code>tokio::time::timeout</code>. </p>
<p>Unfortunately, tokio's AsyncFd doesn't do very much in this context on Linux (<code>epoll(2)</code> doesn't operate on regular files), and isn't available at all on Windows, but at least on Mac OS it does work well with <code>kqueue(2)</code>. So, on Linux we are basically stuck making believe that regular files are immediately readable and writable, and on Windows we fall back on using the cap-std-sync windows poll_oneoff inside a block_in_place.</p>
<p><code>wasmtime-wasi</code> now exports two different <code>Wasi</code>s - one under <code>sync::</code> when the <code>sync</code> feature is enabled (which it is by default), and one under <code>tokio::</code> when the <code>tokio</code> feature is enabled (not a default). The sync implementation is re-exported at the root of the crate, so that existing users do not have to change their code.</p>
<p>A new top-level <code>examples/tokio</code> shows using <code>wasmtime_wasi::tokio::Wasi</code> under <code>tokio</code>. It incorporates a lot of comments @alexcrichton wrote previously.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="237585753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237585753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237585753">(May 06 2021 at 00:02)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a>.</p>



<a name="237585848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237585848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237585848">(May 06 2021 at 00:03)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237585993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237585993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237585993">(May 06 2021 at 00:04)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>:</p>
<blockquote>
<p>This PR makes it possible for <code>wasi-common</code> to work on with async executor like <code>tokio</code>, without taking a dependency on any sort of asynchronous runtime. Existing users of <code>wasi-common</code> will not need to make any changes.</p>
<p>It introduces the new crate <code>wasi-tokio</code>, which is a sibling crate to <code>wasi-cap-std-sync</code>, and also depending on <code>wasi-cap-std-sync</code>, since much of the implementation has been reused.</p>
<p><code>wasmtime-wiggle</code> now supports running async methods via a dummy executor, in order to support running synchronous wasi-common implementations. To configure this mode in <code>wasmtime-wiggle</code>, use the new <code>block_on</code> configuration option in place of <code>async</code> as introduced in #2701. This mode executes the async methods in a "dummy executor" - a mocked <code>std::task::Waker</code> which will only poll a future correctly if it immediately returns <code>Poll::Ready</code>.</p>
<p><code>wasi-common</code> now uses an <code>async_trait</code> to make each <code>WasiFile</code>, <code>WasiDir</code>, and <code>WasiSched</code> trait method <code>async</code>. This means that any operation on files, directories, or the scheduler may return a pending future depending on the impl of those traits.</p>
<p><code>wasi-cap-std-sync</code> stays the same, modulo the code golf required to add <code>async</code> in front of some fns. All of these impls are synchronous - the futures returned by these will always be <code>Poll::Ready</code>. Therefore, it is safe to use with the dummy executor.</p>
<p>The <code>WasiFile</code> trait has two additional methods, <code>async fn readable(&amp;mut self) -&gt; Result&lt;(), Error&gt;</code> and a corresponding <code>writable</code>, which have semantics corresponding to a wasi <code>Subscription::FdRead</code> and <code>FdWrite</code> - the futures are ready when the file is ready to read or write. These methods are intended to be used by an impl of <code>WasiSched::poll_oneoff</code>.</p>
<p><code>wasi-tokio</code> is implemented mostly in terms of <code>wasi-cap-std-sync</code>. cap-std provides a robust implementation of filesystem sandboxing, which we still need to rely on. All file and directory operations delegated to the <code>wasi-cap-std-sync</code> impl are wrapped in <code>tokio::task::block_in_place</code>, which tells the tokio runtime to execute that code on a thread that may block. This is how tokio's own <code>File</code> type treats all of its IO operations as well. The departure of <code>wasi-tokio</code> from wasi-cap-std-sync is in the impl of the <code>WasiFile::{readable, writable}</code> methods, which use <code>tokio::io::unix::AsyncFd</code> when available, and the <code>WasiSched::poll_oneoff</code> method is implemented using those futures and <code>tokio::time::timeout</code>. </p>
<p>Unfortunately, tokio's AsyncFd doesn't do very much in this context on Linux (<code>epoll(2)</code> doesn't operate on regular files), and isn't available at all on Windows, but at least on Mac OS it does work well with <code>kqueue(2)</code>. So, on Linux we are basically stuck making believe that regular files are immediately readable and writable, which is as much as <code>select</code> does for us anyway. The futures do work properly on pipes like stdin. On Windows, tokio doesn't give us anything like AsyncFd, so we fall back on using the cap-std-sync windows poll_oneoff inside a block_in_place.</p>
<p><code>wasmtime-wasi</code> now exports two different <code>Wasi</code>s - one under <code>sync::</code> when the <code>sync</code> feature is enabled (which it is by default), and one under <code>tokio::</code> when the <code>tokio</code> feature is enabled (not a default). The sync implementation is re-exported at the root of the crate, so that existing users do not have to change their code.</p>
<p>A new top-level <code>examples/tokio</code> shows using <code>wasmtime_wasi::tokio::Wasi</code> under <code>tokio</code>. It incorporates a lot of comments @alexcrichton wrote previously.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="237669951"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669951" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669951">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653475964">PR Review</a>.</p>



<a name="237669952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669952">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653475964">PR Review</a>.</p>



<a name="237669953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669953">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627463838">PR Review Comment</a>:</p>
<blockquote>
<p>This is my personal first time seeing this, although I see that this is simply copied over from the cap-std-sync version. Could this be deduplicated between those two versions perhaps? (also if you know what this does can you add a comment here about that? I have no idea what this is configuring...)</p>
</blockquote>



<a name="237669954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669954">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627461063">PR Review Comment</a>:</p>
<blockquote>
<p>We probably don't need to be so general here, could this detect maybe "async" in the name and pass a hardcoded feature?</p>
<p>(mostly trying to keep the examples dir relatively clean)</p>
</blockquote>



<a name="237669955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669955">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627473846">PR Review Comment</a>:</p>
<blockquote>
<p>I'm a little confused by this, how come there's an <code>asyncify</code> of an <code>async</code> function?</p>
<p>Although reading the above <code>asyncify</code> again I kind of understand, but not really.</p>
</blockquote>



<a name="237669956"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669956" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669956">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627464672">PR Review Comment</a>:</p>
<blockquote>
<p>Similar to above it seems like much of this could probably be shared between at least the above function, if not with the cap-std-sync verison too ideally</p>
</blockquote>



<a name="237669957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669957">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627462350">PR Review Comment</a>:</p>
<blockquote>
<p>This isn't needed for tests though, right?</p>
</blockquote>



<a name="237669958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669958">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627466508">PR Review Comment</a>:</p>
<blockquote>
<p>I think this is only used for the <code>async_trait</code> macro, right? If that's the case could this be just the <code>async_trait</code> dependency?</p>
</blockquote>



<a name="237669959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669959">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627471157">PR Review Comment</a>:</p>
<blockquote>
<p>How come this continues polling all futures rather than just returning the first ready value immediately?</p>
</blockquote>



<a name="237669960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669960">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627484088">PR Review Comment</a>:</p>
<blockquote>
<p>I think this technically isn't <code>unsafe</code>, right? </p>
</blockquote>



<a name="237669961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669961">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627479349">PR Review Comment</a>:</p>
<blockquote>
<p>I think I'm getting a bit lost in my head thinking about this. This feels pretty backwards where we're "asyncifying" already async code, and I'm not sure that I have enough context for untangling why the backwards feeling is actually ok here.</p>
<p>The idea here is that wasi-common requires everything to be async, but then the "sync" versions just do all the blocking work in their async impls. Then when tokio builds on top of the sync versions again it just rewraps everything in <code>block_in_place</code>? Basically the <code>async</code> in cap-std-sync is a lie?</p>
<p>I think this may want a more clear comment somewhere if possible?</p>
</blockquote>



<a name="237669962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669962">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627481079">PR Review Comment</a>:</p>
<blockquote>
<p>I'm sort of confused how this works where the unix version does a bunch of fancy "first ready" stuff but on Windows we skip all that?</p>
</blockquote>



<a name="237669963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669963">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627473293">PR Review Comment</a>:</p>
<blockquote>
<p>This seems like a pretty intense file that has a helper thread to work with stdio on Windows, could this get commented with a high level overview of how all this works?</p>
<p>(I'm not actually sure off the top of my head why this is necessary)</p>
</blockquote>



<a name="237669964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669964">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627486212">PR Review Comment</a>:</p>
<blockquote>
<p>Could this function be shortened to basically "FIXME needs <a href="https://github.com/alexcrichton/rfcs-2/blob/new-api/accepted/new-api.md">https://github.com/alexcrichton/rfcs-2/blob/new-api/accepted/new-api.md</a> to be safe" or something along those lines?</p>
<p>(probably not too worth maintaining docs here about the unsafety)</p>
</blockquote>



<a name="237669965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237669965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237669965">(May 06 2021 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627486700">PR Review Comment</a>:</p>
<blockquote>
<p>This can all be folded into <code>get_typed_func</code> I think?</p>
</blockquote>



<a name="237683618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237683618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237683618">(May 06 2021 at 15:59)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653626591">PR Review</a>.</p>



<a name="237683619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237683619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237683619">(May 06 2021 at 15:59)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627553480">PR Review Comment</a>:</p>
<blockquote>
<p>Sure, I could do that. I figured that putting the features in a file would be more discoverable for someone trying to run it standalone than detecting a part of the name.</p>
</blockquote>



<a name="237684069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684069">(May 06 2021 at 16:01)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653628757">PR Review</a>.</p>



<a name="237684071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684071">(May 06 2021 at 16:01)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627555675">PR Review Comment</a>:</p>
<blockquote>
<p>Yep thats the only use. I arbitrarily decided to import it via wiggle everywhere so we wouldn't have to keep versions synced up, but realistically I don't expect async_trait to change meaningfully at this point so I could change to importing it directly.</p>
</blockquote>



<a name="237684329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684329">(May 06 2021 at 16:02)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653630049">PR Review</a>.</p>



<a name="237684330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684330">(May 06 2021 at 16:02)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627556938">PR Review Comment</a>:</p>
<blockquote>
<p>In the corner case where several of your subscriptions are ready immediately, the tests expect all of them to be reported rather than just the first. Reporting is part of the future being polled on here, so I want all of them to get a chance to run before returning. I will improve the comment.</p>
</blockquote>



<a name="237684582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684582">(May 06 2021 at 16:03)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627558550">PR Review Comment</a>:</p>
<blockquote>
<p>This code is borrowed from cap-std-sync which is in turn borrowed from the old version of wasi-common. I also don't quite understand it, and this code was highly resistant to some earlier attempts to improve it, so I have just been dragging it along. I can add better comments, though.</p>
</blockquote>



<a name="237684583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684583">(May 06 2021 at 16:03)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653631659">PR Review</a>.</p>



<a name="237684893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684893">(May 06 2021 at 16:05)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653633375">PR Review</a>.</p>



<a name="237684894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237684894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237684894">(May 06 2021 at 16:05)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627560263">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed this needs a comment. The <code>async</code> in cap-std-sync is indeed a lie.</p>
</blockquote>



<a name="237685615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237685615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237685615">(May 06 2021 at 16:09)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653637795">PR Review</a>.</p>



<a name="237685617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237685617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237685617">(May 06 2021 at 16:09)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627564781">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe I should just rename <code>asyncify</code> to <code>block_in_place</code>? I stole the <code>asyncify</code> name from tokio::File internals, but it turned into something different.</p>
</blockquote>



<a name="237685669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237685669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237685669">(May 06 2021 at 16:10)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627564781">PR Review Comment</a>.</p>



<a name="237686381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237686381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237686381">(May 06 2021 at 16:14)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653642721">PR Review</a>.</p>



<a name="237686382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237686382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237686382">(May 06 2021 at 16:14)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627570078">PR Review Comment</a>:</p>
<blockquote>
<p><code>block_on_dummy_executor</code>?</p>
</blockquote>



<a name="237686651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237686651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237686651">(May 06 2021 at 16:16)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653644427">PR Review</a>.</p>



<a name="237686652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237686652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237686652">(May 06 2021 at 16:16)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627571880">PR Review Comment</a>:</p>
<blockquote>
<p>Probably not - there is some <code>unsafe</code> under the hood but afaict that shouldnt make it unsafe itself. I debated about that keyword and ultimately threw it in there to flag "don't use this unless you are really sure", initially this was totally private code but I needed to reuse it in several crates.</p>
</blockquote>



<a name="237703571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237703571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237703571">(May 06 2021 at 18:08)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653750885">PR Review</a>.</p>



<a name="237703572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237703572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237703572">(May 06 2021 at 18:08)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627655843">PR Review Comment</a>:</p>
<blockquote>
<p>this one is async and cap-std-syncs is sync, but yeah they can be shared locally</p>
</blockquote>



<a name="237734441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237734441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237734441">(May 06 2021 at 21:34)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237742038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237742038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237742038">(May 06 2021 at 22:46)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237742548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237742548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237742548">(May 06 2021 at 22:52)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-653956191">PR Review</a>.</p>



<a name="237742549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237742549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237742549">(May 06 2021 at 22:52)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#discussion_r627814310">PR Review Comment</a>:</p>
<blockquote>
<p>I ended up refactoring this to re-use the other implementation without copy-paste, filed #2880, and added some comments.</p>
</blockquote>



<a name="237742783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237742783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237742783">(May 06 2021 at 22:55)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237745182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237745182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237745182">(May 06 2021 at 23:19)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237745518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237745518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237745518">(May 06 2021 at 23:23)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237745664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237745664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237745664">(May 06 2021 at 23:25)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237745675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237745675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237745675">(May 06 2021 at 23:25)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a>.</p>



<a name="237752417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237752417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237752417">(May 07 2021 at 00:54)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237834010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237834010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237834010">(May 07 2021 at 14:42)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2832#pullrequestreview-654534918">PR Review</a>.</p>



<a name="237876579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237876579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237876579">(May 07 2021 at 19:20)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237892726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237892726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237892726">(May 07 2021 at 21:28)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237898631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237898631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237898631">(May 07 2021 at 22:19)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237900758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237900758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237900758">(May 07 2021 at 22:42)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237901564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237901564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237901564">(May 07 2021 at 22:51)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237902941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237902941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237902941">(May 07 2021 at 23:07)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237904041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237904041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237904041">(May 07 2021 at 23:20)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a> from <code>pch/wiggle_sync_shimming</code> to <code>main</code>.</p>



<a name="237910321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232832%20wasi-common%20support%20for%20tokio%2C%20%26%20wigg.../near/237910321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232832.20wasi-common.20support.20for.20tokio.2C.20.26.20wigg.2E.2E.2E.html#237910321">(May 08 2021 at 00:43)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2832">PR #2832</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>