<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2386 Runtime panics with &#x27;every on-stac... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html">wasmtime / Issue #2386 Runtime panics with &#x27;every on-stac...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="216116700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216116700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216116700">(Nov 09 2020 at 17:27)</a>:</h4>
<p>bkolobara opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>I recently run into a flaky issue running a WASM app using Externrefs under Wasmtime.<br>
Sadly, I can't share any code related to it. Either way it's a lot of code and I'm looking more at pointers how I could debug this further by myself.</p>
<p><strong>Sometimes</strong> (8 out of 10 runs) the app would panic with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">every</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">stack</span><span class="w"> </span><span class="n">externref</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VMExternRefActivationsTable</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_mut</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">trace_fn</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">107</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">__Unwind_Backtrace</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">95</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">53</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1054</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">gc_and_insert_slow</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">585</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">insert_with_gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="k">ref</span>::<span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmTy</span><span class="o">&gt;</span>::<span class="n">into_abi_for_arg</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1238</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmRet</span><span class="o">&gt;</span>::<span class="n">into_abi_for_ret</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1350</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">,</span><span class="n">A3</span><span class="p">),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1624</span>:<span class="mi">29</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">host_trampoline</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1657</span>:<span class="mi">31</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">620</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>: <span class="nc">RegisterSetjmp</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">helpers</span><span class="p">.</span><span class="n">c</span>:<span class="mi">12</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">386</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">38</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">682</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">try_with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">272</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">248</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">674</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">385</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">invoke_wasm_and_catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">829</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">619</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>: <span class="nc">lunatic_vm</span>::<span class="n">process</span>::<span class="n">Process</span>::<span class="n">spawn</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">160</span>:<span class="mi">25</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
</code></pre></div>
<p>The code path taken by the app should always be the same and first of all I can't figure out why it only fails sometimes. Any pointers would be appreciated. </p>
</blockquote>



<a name="216116701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216116701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216116701">(Nov 09 2020 at 17:27)</a>:</h4>
<p>bkolobara labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>I recently run into a flaky issue running a WASM app using Externrefs under Wasmtime.<br>
Sadly, I can't share any code related to it. Either way it's a lot of code and I'm looking more at pointers how I could debug this further by myself.</p>
<p><strong>Sometimes</strong> (8 out of 10 runs) the app would panic with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">every</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">stack</span><span class="w"> </span><span class="n">externref</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VMExternRefActivationsTable</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_mut</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">trace_fn</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">107</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">__Unwind_Backtrace</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">95</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">53</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1054</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">gc_and_insert_slow</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">585</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">insert_with_gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="k">ref</span>::<span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmTy</span><span class="o">&gt;</span>::<span class="n">into_abi_for_arg</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1238</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmRet</span><span class="o">&gt;</span>::<span class="n">into_abi_for_ret</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1350</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">,</span><span class="n">A3</span><span class="p">),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1624</span>:<span class="mi">29</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">host_trampoline</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1657</span>:<span class="mi">31</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">620</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>: <span class="nc">RegisterSetjmp</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">helpers</span><span class="p">.</span><span class="n">c</span>:<span class="mi">12</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">386</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">38</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">682</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">try_with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">272</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">248</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">674</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">385</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">invoke_wasm_and_catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">829</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">619</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>: <span class="nc">lunatic_vm</span>::<span class="n">process</span>::<span class="n">Process</span>::<span class="n">spawn</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">160</span>:<span class="mi">25</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
</code></pre></div>
<p>The code path taken by the app should always be the same and first of all I can't figure out why it only fails sometimes. Any pointers would be appreciated. </p>
</blockquote>



<a name="216117433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216117433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216117433">(Nov 09 2020 at 17:33)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724161600">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Can you share the wasm file? That may help with debugging this problem.</p>
</blockquote>



<a name="216118226"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216118226" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216118226">(Nov 09 2020 at 17:38)</a>:</h4>
<p>bkolobara <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724164627">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Yes. This is the file.<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/5512287/wasm-experiment.wasm.zip">wasm-experiment.wasm.zip</a></p>
</blockquote>



<a name="216118290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216118290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216118290">(Nov 09 2020 at 17:39)</a>:</h4>
<p>bkolobara edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724164627">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Yes. This is the file.<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/5512287/wasm-experiment.wasm.zip">wasm-experiment.wasm.zip</a></p>
<p>this is the <code>--release</code> build. I can also provide a debug one if it helps.</p>
</blockquote>



<a name="216121196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216121196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216121196">(Nov 09 2020 at 17:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724176090">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>@bkolobara to confirm, that wasm file has no <code>externref</code> in it. Is that the one you're using? It may be that we're not returning an error when you use <code>externref</code> when we otherwise should!</p>
</blockquote>



<a name="216129676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216129676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216129676">(Nov 09 2020 at 19:06)</a>:</h4>
<p>bkolobara <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724214898">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Sorry, I forgot that there are wrapper functions created and injected in the wasm file before it's executed. This wrapper functions save the Externref in a table and return just an index. Now that I think more about it they, didn't get much of testing and could be the issue.</p>
<p>The transformation looks somewhat like this:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>;; Input
(module
  (import "lunatic" "spawn" (func (;0;) (param i32 i32 i64) (result i32)))
  (func $test (result i32)
    i32.const 0
    i32.const 0
    i64.const 0
    call 0)
)

;; Transformation:
(module
  (type (;0;) (func))
  (type (;1;) (func (result i32)))
  (type (;2;) (func (param i32)))
  (type (;3;) (func (param i32 i32 i64) (result i32)))
  (type (;4;) (func (param i32 i32 i64) (result externref)))
  (type (;5;) (func (param externref) (result i32)))

  (import "lunatic" "yield" (func (;0;) (type 0)))
  (import "lunatic" "get_externref_free_slot" (func (;1;) (type 1)))
  (import "lunatic" "set_externref_free_slot" (func (;2;) (type 2)))
  (import "lunatic" "spawn" (func (;3;) (type 4)))

  (func $test (type 1) (result i32)
    block  ;; label = @1
      global.get 0
      i32.const 1
      i32.add
      global.set 0
      global.get 0
      i32.const 10000
      i32.gt_s
      if  ;; label = @2
        call 0
        i32.const 0
        global.set 0
      else
      end
    end
    i32.const 0
    i32.const 0
    i64.const 0
    call 6)

  ;; Save externref
  (func (;5;) (type 5) (param externref) (result i32)
    (local i32)
    call 1
    local.tee 1
    table.size 0
    i32.eq
    if  ;; label = @1,
      ref.null extern
      table.size 0
      table.grow 0
      drop
    else
    end
    local.get 1
    local.get 0
    table.set 0
    local.get 1)

  ;; Swap import wrapper
  (func (;6;) (type 3) (param i32 i32 i64) (result i32)
    local.get 0
    local.get 1
    local.get 2
    call 3
    call 5)

  ;; Drop externref
  (func (;7;) (type 2) (param i32)
    local.get 0
    ref.null extern
    table.set 0
    local.get 0
    call 2)

  (table (;0;) 4 externref)
  (global (;0;) (mut i32) (i32.const 0))
  (export "__lunatic_externref_resource_table" (table 0))
  (export "_lunatic_externref_save" (func 5))
  (export "_lunatic_externref_drop" (func 7)))
</code></pre></div>
<p>The <code>Save externref</code> function is the one that preserves the externref in the table. There is also the part on the host side (get_externref_free_slot, set_externref_free_slot) that keeps track of free slots in the externref table.</p>
</blockquote>



<a name="216129875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216129875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216129875">(Nov 09 2020 at 19:08)</a>:</h4>
<p>bkolobara edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724214898">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Sorry, I forgot that there are wrapper functions created and injected in the wasm file before it's executed. This wrapper functions save the Externref in a table and return just an index. Now that I think more about it they, didn't get much of testing and could be the issue.</p>
<p>The transformation looks somewhat like this:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>;; Input
(module
  (import "lunatic" "spawn" (func (;0;) (param i32 i32 i64) (result i32)))
  (func $test (result i32)
    i32.const 0
    i32.const 0
    i64.const 0
    call 0)
)

;; Transformation:
(module
  (type (;0;) (func))
  (type (;1;) (func (result i32)))
  (type (;2;) (func (param i32)))
  (type (;3;) (func (param i32 i32 i64) (result i32)))
  (type (;4;) (func (param i32 i32 i64) (result externref)))
  (type (;5;) (func (param externref) (result i32)))

  (import "lunatic" "yield" (func (;0;) (type 0)))
  (import "lunatic" "get_externref_free_slot" (func (;1;) (type 1)))
  (import "lunatic" "set_externref_free_slot" (func (;2;) (type 2)))
  (import "lunatic" "spawn" (func (;3;) (type 4)))

  (func $test (type 1) (result i32)
    i32.const 0
    i32.const 0
    i64.const 0
    call 6)

  ;; Save externref
  (func (;5;) (type 5) (param externref) (result i32)
    (local i32)
    call 1
    local.tee 1
    table.size 0
    i32.eq
    if  ;; label = @1,
      ref.null extern
      table.size 0
      table.grow 0
      drop
    else
    end
    local.get 1
    local.get 0
    table.set 0
    local.get 1)

  ;; Spawn import wrapper
  (func (;6;) (type 3) (param i32 i32 i64) (result i32)
    local.get 0
    local.get 1
    local.get 2
    call 3
    call 5)

  ;; Drop externref
  (func (;7;) (type 2) (param i32)
    local.get 0
    ref.null extern
    table.set 0
    local.get 0
    call 2)

  (table (;0;) 4 externref)
  (global (;0;) (mut i32) (i32.const 0))
  (export "__lunatic_externref_resource_table" (table 0))
  (export "_lunatic_externref_save" (func 5))
  (export "_lunatic_externref_drop" (func 7)))
</code></pre></div>
<p>The <code>Save externref</code> function is the one that preserves the externref in the table. There is also the part on the host side (get_externref_free_slot, set_externref_free_slot) that keeps track of free slots in the externref table.</p>
</blockquote>



<a name="216131705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216131705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216131705">(Nov 09 2020 at 19:23)</a>:</h4>
<p>bkolobara <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724225772">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>I have published the code here: <a href="https://github.com/lunatic-lang/lunatic">https://github.com/lunatic-lang/lunatic</a>. You should be able to run the .wasm file with: <code>cargo run -- wasm-experiment.wasm</code>.</p>
<p>I just didn't test it on different operating systems and it may not work on Windows.</p>
</blockquote>



<a name="216132012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216132012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216132012">(Nov 09 2020 at 19:25)</a>:</h4>
<p>bkolobara edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724225772">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>I have published the code here: <a href="https://github.com/lunatic-lang/lunatic">https://github.com/lunatic-lang/lunatic</a>. You should be able to run the .wasm file with: <code>cargo run -- wasm-experiment.wasm</code>.</p>
<p>I just didn't test it on different operating systems and it may not work on Windows. Also, my usage of Wasmtime is a bit unconventional :). This could also be a source of issues.</p>
</blockquote>



<a name="216141944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216141944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216141944">(Nov 09 2020 at 20:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724273935">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Ok thanks for the repo! It looks like there's a number of <code>unsafe</code> blocks and it also looks like you're reaching into wasmtime internals (the <code>wasmtime-runtime</code> crate), so that may be what's going wrong here? Would it be possible to try to cut that back and see if it works better?</p>
</blockquote>



<a name="216144629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216144629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216144629">(Nov 09 2020 at 21:24)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724287130">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Thanks for filing a bug report @bkolobara.</p>
<p>If you could create a wasm file such that running</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
</code></pre></div>
<p>exhibits the issue, I could take it from there and reduce the test case myself.</p>
<p>But yeah, as @alexcrichton pointed out, using Wasmtime internals is super unsafe since we maintain all the safety invariants in the <code>wasmtime</code> crate, especially with reference types.</p>
</blockquote>



<a name="216144855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216144855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216144855">(Nov 09 2020 at 21:26)</a>:</h4>
<p>bkolobara <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724288387">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Yes, there is a lot going on in the codebase. It will take some time to trim back on the unsafe code. If I manage to construct a minimal reproducible example I will post an update. Thanks everyone for taking the time and looking into this!</p>
</blockquote>



<a name="216201907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216201907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216201907">(Nov 10 2020 at 12:05)</a>:</h4>
<p>bkolobara <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724659862">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>@alexcrichton @fitzgen thanks again for helping me out with this. I have managed to extract just the problematic part without any unsafe code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">ExternRef</span><span class="p">,</span><span class="w"> </span><span class="n">Linker</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,};</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"</span>
<span class="s">    (module</span>
<span class="s">        (type (;0;) (func (result i32)))</span>
<span class="s">        (type (;1;) (func (param i32 i32 i64) (result externref)))</span>
<span class="s">        (type (;2;) (func (param i32 i32 i64) (result i32)))</span>
<span class="s">        (type (;3;) (func (param externref) (result i32)))</span>
<span class="s">        (type (;4;) (func))</span>

<span class="s">        (import </span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s"> </span><span class="se">\"</span><span class="s">spawn</span><span class="se">\"</span><span class="s"> (func $spawn (type 1)))</span>

<span class="s">        (func $_start (type 4)</span>
<span class="s">            (local i32)</span>

<span class="s">            i32.const 10000</span>
<span class="s">            local.set 0</span>
<span class="s">            loop  ;; label = @1</span>
<span class="s">                i32.const 4</span>
<span class="s">                i32.const 0</span>
<span class="s">                i64.const 0</span>
<span class="s">                call $externref_wrapper_for_spawn</span>
<span class="s">                drop</span>
<span class="s">                local.get 0</span>
<span class="s">                i32.const -1</span>
<span class="s">                i32.add</span>
<span class="s">                local.tee 0</span>
<span class="s">                br_if 0 (;@1;)</span>
<span class="s">            end)</span>

<span class="s">        (func $preserve_externref_in_table (type 3) (param externref) (result i32)</span>
<span class="s">            (local i32)</span>
<span class="s">            i32.const 0</span>
<span class="s">            local.tee 1</span>
<span class="s">            table.size $externref_table</span>
<span class="s">            i32.eq</span>
<span class="s">            if (result i32)  ;; label = @1</span>
<span class="s">              ref.null extern</span>
<span class="s">              table.size $externref_table</span>
<span class="s">              table.grow $externref_table</span>
<span class="s">            else</span>
<span class="s">              local.get 1</span>
<span class="s">            end</span>
<span class="s">            local.get 0</span>
<span class="s">            table.set $externref_table</span>
<span class="s">            local.get 1)</span>

<span class="s">        (func $externref_wrapper_for_spawn (type 2) (param i32 i32 i64) (result i32)</span>
<span class="s">            local.get 0</span>
<span class="s">            local.get 1</span>
<span class="s">            local.get 2</span>
<span class="s">            call $spawn</span>
<span class="s">            call $preserve_externref_in_table)</span>

<span class="s">        (table $externref_table 4 externref)</span>
<span class="s">        (export </span><span class="se">\"</span><span class="s">_start</span><span class="se">\"</span><span class="s"> (func $_start))</span>
<span class="s">    )"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">func</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="s">"test"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"spawn"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">index</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">argument1</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">argument2</span>: <span class="kt">i64</span><span class="o">|</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nb">Some</span><span class="p">(</span><span class="n">ExternRef</span>::<span class="n">new</span><span class="p">((</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">argument1</span><span class="p">,</span><span class="w"> </span><span class="n">argument2</span><span class="p">)))</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">module</span><span class="p">.</span><span class="n">clone</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_func</span><span class="p">(</span><span class="s">"_start"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">start</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[]).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This fails on <code>wasmtime = "0.21"</code> on my Macbook with </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">every</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">stack</span><span class="w"> </span><span class="n">externref</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VMExternRefActivationsTable</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">hb4ff9014ec5817b3</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span>::<span class="n">h0d03cf0f7c5d8d01</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print_fmt</span>::<span class="n">h5b2bf2921eea85ae</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">67</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span>::<span class="n">DisplayBacktrace</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span>::<span class="n">fmt</span>::<span class="n">Display</span><span class="o">&gt;</span>::<span class="n">fmt</span>::<span class="n">h808cc0fc691f5922</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">46</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:        <span class="mh">0x10d789660</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">fmt</span>::<span class="n">write</span>::<span class="n">h0ce880d33cd2a300</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">fmt</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1076</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:        <span class="mh">0x10d767906</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span>::<span class="n">write_fmt</span>::<span class="n">h057e6b5365b25cdb</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1516</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span>::<span class="n">ha1932a5f36d2b146</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">49</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">print</span>::<span class="n">had07999cb13bdf77</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">36</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hcbe1ecfff77305a1</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">208</span>:<span class="mi">50</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:        <span class="mh">0x10d76c11d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span>::<span class="n">h8422621c02c35b35</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:        <span class="mh">0x10d76ca2b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h82b76d3adf4cbc3a</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">577</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:        <span class="mh">0x10d6da1e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h610cb27706798e28</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:        <span class="mh">0x10d6dcfb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">h02cad55c8fedcf0f</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:        <span class="mh">0x10d79ea57</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h00999f2b800d5901</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:        <span class="mh">0x10d258ab0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hb874548da7bd3130</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:        <span class="mh">0x10d293797</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_mut</span>::<span class="n">h49b4b17374a4fb04</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:        <span class="mh">0x10d29356e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">trace_fn</span>::<span class="n">h5adea0a7301c455e</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">112</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:     <span class="mh">0x7fff67d3313f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__Unwind_Backtrace</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:        <span class="mh">0x10d269d1d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">hb7d773b2da24a258</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:        <span class="mh">0x10d269d1d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span>::<span class="n">h51fd14a962d6e2bc</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:        <span class="mh">0x10d269de0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace</span>::<span class="n">h87a228ab8df6eb34</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">53</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:        <span class="mh">0x10d258340</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="n">he8a9e6a7fbc383cf</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1054</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:        <span class="mh">0x10d256eec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">gc_and_insert_slow</span>::<span class="n">h9889192c254632da</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">585</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:        <span class="mh">0x10cba3d13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">insert_with_gc</span>::<span class="n">hd1333067f4a1dc90</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:        <span class="mh">0x10cba38fb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="k">ref</span>::<span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmTy</span><span class="o">&gt;</span>::<span class="n">into_abi_for_arg</span>::<span class="n">hf23e691b1199274e</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1238</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:        <span class="mh">0x10cba5175</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmRet</span><span class="o">&gt;</span>::<span class="n">into_abi_for_ret</span>::<span class="n">hb931fe5db644ccb7</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1350</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:        <span class="mh">0x10cba9d80</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">,</span><span class="n">A3</span><span class="p">),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">h933e81e93c4f6514</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1624</span>:<span class="mi">29</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:        <span class="mh">0x10ec1a22e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:        <span class="mh">0x10ec1a0b1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:        <span class="mh">0x10ec1a357</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:        <span class="mh">0x10cbeaaac</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h0b827b767c43434d</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">620</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:        <span class="mh">0x10cc272c1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span>::<span class="n">h0433cee3ab91db78</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:        <span class="mh">0x10d28f276</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RegisterSetjmp</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">b</span><span class="w"></span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="216219944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216219944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216219944">(Nov 10 2020 at 14:36)</a>:</h4>
<p>bkolobara edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724659862">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>@alexcrichton @fitzgen thanks again for helping me out with this. I have managed to extract just the problematic part without any unsafe code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">ExternRef</span><span class="p">,</span><span class="w"> </span><span class="n">Linker</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,};</span><span class="w"></span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"</span>
<span class="s">    (module</span>
<span class="s">        (type (;0;) (func (result i32)))</span>
<span class="s">        (type (;1;) (func (param i32 i32 i64) (result externref)))</span>
<span class="s">        (type (;2;) (func (param i32 i32 i64) (result i32)))</span>
<span class="s">        (type (;3;) (func (param externref) (result i32)))</span>
<span class="s">        (type (;4;) (func))</span>

<span class="s">        (import </span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s"> </span><span class="se">\"</span><span class="s">spawn</span><span class="se">\"</span><span class="s"> (func $spawn (type 1)))</span>

<span class="s">        (func $_start (type 4)</span>
<span class="s">            (local i32)</span>

<span class="s">            i32.const 10000</span>
<span class="s">            local.set 0</span>
<span class="s">            loop  ;; label = @1</span>
<span class="s">                i32.const 4</span>
<span class="s">                i32.const 0</span>
<span class="s">                i64.const 0</span>
<span class="s">                call $externref_wrapper_for_spawn</span>
<span class="s">                drop</span>
<span class="s">                local.get 0</span>
<span class="s">                i32.const -1</span>
<span class="s">                i32.add</span>
<span class="s">                local.tee 0</span>
<span class="s">                br_if 0 (;@1;)</span>
<span class="s">            end)</span>

<span class="s">        (func $preserve_externref_in_table (type 3) (param externref) (result i32)</span>
<span class="s">            (local i32)</span>
<span class="s">            i32.const 0</span>
<span class="s">            local.tee 1</span>
<span class="s">            table.size $externref_table</span>
<span class="s">            i32.eq</span>
<span class="s">            if (result i32)  ;; label = @1</span>
<span class="s">              ref.null extern</span>
<span class="s">              table.size $externref_table</span>
<span class="s">              table.grow $externref_table</span>
<span class="s">            else</span>
<span class="s">              local.get 1</span>
<span class="s">            end</span>
<span class="s">            local.get 0</span>
<span class="s">            table.set $externref_table</span>
<span class="s">            local.get 1)</span>

<span class="s">        (func $externref_wrapper_for_spawn (type 2) (param i32 i32 i64) (result i32)</span>
<span class="s">            local.get 0</span>
<span class="s">            local.get 1</span>
<span class="s">            local.get 2</span>
<span class="s">            call $spawn</span>
<span class="s">            call $preserve_externref_in_table)</span>

<span class="s">        (table $externref_table 4 externref)</span>
<span class="s">        (export </span><span class="se">\"</span><span class="s">_start</span><span class="se">\"</span><span class="s"> (func $_start))</span>
<span class="s">    )"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">func</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="s">"test"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">"spawn"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">index</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">argument1</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">argument2</span>: <span class="kt">i64</span><span class="o">|</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nb">Some</span><span class="p">(</span><span class="n">ExternRef</span>::<span class="n">new</span><span class="p">((</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">argument1</span><span class="p">,</span><span class="w"> </span><span class="n">argument2</span><span class="p">)))</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">module</span><span class="p">.</span><span class="n">clone</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="n">get_func</span><span class="p">(</span><span class="s">"_start"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">start</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[]).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This fails on <code>wasmtime = "0.21"</code> on my Macbook with:</p>
<p>&lt;details&gt;&lt;summary&gt;Expend stacktrace&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">every</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">stack</span><span class="w"> </span><span class="n">externref</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VMExternRefActivationsTable</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">hb4ff9014ec5817b3</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">backtrace_rs</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span>::<span class="n">h0d03cf0f7c5d8d01</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/../../</span><span class="n">backtrace</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print_fmt</span>::<span class="n">h5b2bf2921eea85ae</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">67</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>:        <span class="mh">0x10d76a664</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span>::<span class="n">DisplayBacktrace</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span>::<span class="n">fmt</span>::<span class="n">Display</span><span class="o">&gt;</span>::<span class="n">fmt</span>::<span class="n">h808cc0fc691f5922</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">46</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>:        <span class="mh">0x10d789660</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">fmt</span>::<span class="n">write</span>::<span class="n">h0ce880d33cd2a300</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">fmt</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1076</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>:        <span class="mh">0x10d767906</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span>::<span class="n">write_fmt</span>::<span class="n">h057e6b5365b25cdb</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1516</span>:<span class="mi">15</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">_print</span>::<span class="n">ha1932a5f36d2b146</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">49</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">print</span>::<span class="n">had07999cb13bdf77</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">36</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>:        <span class="mh">0x10d76c459</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hcbe1ecfff77305a1</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">208</span>:<span class="mi">50</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>:        <span class="mh">0x10d76c11d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">default_hook</span>::<span class="n">h8422621c02c35b35</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>:        <span class="mh">0x10d76ca2b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h82b76d3adf4cbc3a</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">ffa2e7ae8fbf9badc035740db949b9dae271c29f</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">577</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>:        <span class="mh">0x10d6da1e7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h610cb27706798e28</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>:        <span class="mh">0x10d6dcfb8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">h02cad55c8fedcf0f</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>:        <span class="mh">0x10d79ea57</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h00999f2b800d5901</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>:        <span class="mh">0x10d258ab0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hb874548da7bd3130</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>:        <span class="mh">0x10d293797</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_mut</span>::<span class="n">h49b4b17374a4fb04</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>:        <span class="mh">0x10d29356e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">trace_fn</span>::<span class="n">h5adea0a7301c455e</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">112</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>:     <span class="mh">0x7fff67d3313f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__Unwind_Backtrace</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>:        <span class="mh">0x10d269d1d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">hb7d773b2da24a258</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>:        <span class="mh">0x10d269d1d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span>::<span class="n">h51fd14a962d6e2bc</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>:        <span class="mh">0x10d269de0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace</span>::<span class="n">h87a228ab8df6eb34</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.51</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">53</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>:        <span class="mh">0x10d258340</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="n">he8a9e6a7fbc383cf</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1054</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>:        <span class="mh">0x10d256eec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">gc_and_insert_slow</span>::<span class="n">h9889192c254632da</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">585</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>:        <span class="mh">0x10cba3d13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">insert_with_gc</span>::<span class="n">hd1333067f4a1dc90</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>:        <span class="mh">0x10cba38fb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="k">ref</span>::<span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmTy</span><span class="o">&gt;</span>::<span class="n">into_abi_for_arg</span>::<span class="n">hf23e691b1199274e</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1238</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>:        <span class="mh">0x10cba5175</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmRet</span><span class="o">&gt;</span>::<span class="n">into_abi_for_ret</span>::<span class="n">hb931fe5db644ccb7</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1350</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>:        <span class="mh">0x10cba9d80</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">,</span><span class="n">A3</span><span class="p">),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span>::<span class="n">h933e81e93c4f6514</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1624</span>:<span class="mi">29</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>:        <span class="mh">0x10ec1a22e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>:        <span class="mh">0x10ec1a0b1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>:        <span class="mh">0x10ec1a357</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>:        <span class="mh">0x10cbeaaac</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h0b827b767c43434d</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">620</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>:        <span class="mh">0x10cc272c1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span>::<span class="n">h0433cee3ab91db78</span><span class="w"></span>
<span class="w">                               </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.21.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>:        <span class="mh">0x10d28f276</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Re</span><span class="w"></span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="216226315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216226315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216226315">(Nov 10 2020 at 15:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-724770850">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Perfect, thanks!</p>
</blockquote>



<a name="216407926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216407926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216407926">(Nov 11 2020 at 22:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2386#issuecomment-725704782">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>Thanks again for the clear test case! This should be fixed in <a href="https://github.com/bytecodealliance/wasmtime/pull/2396">https://github.com/bytecodealliance/wasmtime/pull/2396</a></p>
</blockquote>



<a name="216515468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232386%20Runtime%20panics%20with%20%27every%20on-stac.../near/216515468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232386.20Runtime.20panics.20with.20.27every.20on-stac.2E.2E.2E.html#216515468">(Nov 12 2020 at 19:24)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2386">Issue #2386</a>:</p>
<blockquote>
<p>I recently run into a flaky issue running a WASM app using Externrefs under Wasmtime.<br>
Sadly, I can't share any code related to it. Either way it's a lot of code and I'm looking more at pointers how I could debug this further by myself.</p>
<p><strong>Sometimes</strong> (8 out of 10 runs) the app would panic with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">every</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">stack</span><span class="w"> </span><span class="n">externref</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Wasm</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VMExternRefActivationsTable</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1070</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_mut</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span>::<span class="n">trace_fn</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">107</span>:<span class="mi">26</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">__Unwind_Backtrace</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">libunwind</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="n">libunwind</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">95</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace_unsynchronized</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">backtrace</span>::<span class="n">backtrace</span>::<span class="n">trace</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">backtrace</span><span class="o">-</span><span class="mf">0.3.50</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backtrace</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">53</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1054</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">gc_and_insert_slow</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">585</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">externref</span>::<span class="n">VMExternRefActivationsTable</span>::<span class="n">insert_with_gc</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">externref</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">575</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="n">wasmtime</span>::<span class="k">ref</span>::<span class="n">ExternRef</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmTy</span><span class="o">&gt;</span>::<span class="n">into_abi_for_arg</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1238</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">WasmRet</span><span class="o">&gt;</span>::<span class="n">into_abi_for_ret</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1350</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">,</span><span class="n">A3</span><span class="p">),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">wasm_to_host_shim</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1624</span>:<span class="mi">29</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="o">&lt;</span><span class="n">F</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">IntoFunc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Caller</span><span class="p">,),</span><span class="n">R</span><span class="o">&gt;&gt;</span>::<span class="n">into_func</span>::<span class="n">host_trampoline</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1657</span>:<span class="mi">31</span><span class="w"></span>
<span class="w">  </span><span class="mi">23</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">620</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="mi">24</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="mi">25</span>: <span class="nc">RegisterSetjmp</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">helpers</span><span class="p">.</span><span class="n">c</span>:<span class="mi">12</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="mi">26</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">386</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">27</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">38</span><span class="w"></span>
<span class="w">  </span><span class="mi">28</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">682</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">29</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">try_with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">272</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="mi">30</span>: <span class="nc">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bkolobara</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">thread</span><span class="o">/</span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">248</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">31</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">674</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">32</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="mi">33</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">385</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">  </span><span class="mi">34</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">invoke_wasm_and_catch_traps</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">829</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="mi">35</span>: <span class="nc">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">call</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">619</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="mi">36</span>: <span class="nc">lunatic_vm</span>::<span class="n">process</span>::<span class="n">Process</span>::<span class="n">spawn</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">160</span>:<span class="mi">25</span><span class="w"></span>
<span class="o">....</span><span class="w"></span>
</code></pre></div>
<p>The code path taken by the app should always be the same and first of all I can't figure out why it only fails sometimes. Any pointers would be appreciated. </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>