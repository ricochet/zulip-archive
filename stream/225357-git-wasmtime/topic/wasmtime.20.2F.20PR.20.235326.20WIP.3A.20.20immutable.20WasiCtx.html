<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5326 WIP:  immutable WasiCtx · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html">wasmtime / PR #5326 WIP:  immutable WasiCtx</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="312218506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312218506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312218506">(Nov 25 2022 at 16:07)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a> from <code>table_immutable</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="312218722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312218722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312218722">(Nov 25 2022 at 16:08)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a> from <code>table_immutable</code> to <code>main</code>.</p>



<a name="312226445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312226445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312226445">(Nov 25 2022 at 16:54)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1194652609">PR review</a>.</p>



<a name="312226446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312226446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312226446">(Nov 25 2022 at 16:54)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1032603913">PR review comment</a>:</p>
<blockquote>
<p>Race condition here. Another call to drop_caps_to could have dropped different permissions between the capable_of_{dir,file} call and this write, which would result in capabilities being added back despite the other drop_caps_to returning a success,</p>
</blockquote>



<a name="312580323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312580323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312580323">(Nov 28 2022 at 08:58)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1195417704">PR review</a>.</p>



<a name="312580325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312580325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312580325">(Nov 28 2022 at 08:58)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033273498">PR review comment</a>:</p>
<blockquote>
<p>Thank for spotting this!</p>
</blockquote>



<a name="312585530"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312585530" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312585530">(Nov 28 2022 at 09:30)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a> from <code>table_immutable</code> to <code>main</code>.</p>



<a name="312585792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312585792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312585792">(Nov 28 2022 at 09:31)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033273498">PR review comment</a>.</p>



<a name="312655711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655711">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1196019190">PR review</a>.</p>



<a name="312655712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655712">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033688030">PR review comment</a>:</p>
<blockquote>
<p>This should be all one atomic operation which can be protected by one lock, there's no need to use both atomics and locks here.</p>
</blockquote>



<a name="312655713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655713">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033689624">PR review comment</a>:</p>
<blockquote>
<p>I don't think there's any need to serialize multiple threads like this, so the randomness provider should move to a trait with <code>&amp;self</code> rather than <code>&amp;mut self</code></p>
</blockquote>



<a name="312655714"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655714" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655714">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033686215">PR review comment</a>:</p>
<blockquote>
<p>This should probably be an atomic operation rather than two seaparate ones.</p>
</blockquote>



<a name="312655715"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655715" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655715">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1196019190">PR review</a>.</p>



<a name="312655716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655716">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033694890">PR review comment</a>:</p>
<blockquote>
<p>How come these need changing? The prior signatures I think should work?</p>
</blockquote>



<a name="312655717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655717">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033699107">PR review comment</a>:</p>
<blockquote>
<p>I think ideally this is avoided because a system file doesn't need an extra mutex around it since it should already be able to perform all necessary operations concurrently.</p>
</blockquote>



<a name="312655719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655719">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033693018">PR review comment</a>:</p>
<blockquote>
<p>Wiggle is used for more than just WASI, and I don't think it's suitable to make this change. Providing <code>&amp;mut</code> access shows how Wasmtime gives this ability even if WASI doesn't take advantage of it.</p>
<p>Instead the traits should still give access to <code>&amp;mut self</code> but <code>WasiCtx</code> would internally hold <code>Arc&lt;Table&gt;</code> or something like that which is where the requirement for locking comes in (because <code>&amp;mut Arc&lt;T&gt;</code> still only gives you <code>&amp;T</code>)</p>
</blockquote>



<a name="312655720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312655720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312655720">(Nov 28 2022 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1033696008">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps be a method on <code>DirFdStat</code>?</p>
</blockquote>



<a name="312749718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312749718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312749718">(Nov 29 2022 at 01:01)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1196750004">PR review</a>.</p>



<a name="312749719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312749719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312749719">(Nov 29 2022 at 01:01)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034198502">PR review comment</a>:</p>
<blockquote>
<p>IIRC, @sunfishcode had mentioned to me that this block of functions, being written solely to "set up the context" in a sort of builder pattern, could be re-written entirely if the locking made the current design inconvenient. I mention that because I would have expected methods like <code>set_*</code> to be <code>&amp;mut self</code>. I see why you did this though, just mentioning an alternative.</p>
</blockquote>



<a name="312785566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312785566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312785566">(Nov 29 2022 at 08:00)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197044948">PR review</a>.</p>



<a name="312785567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312785567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312785567">(Nov 29 2022 at 08:00)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034410142">PR review comment</a>:</p>
<blockquote>
<p>In the method a <code>RwLockWriteGuard&lt;BorrowedFd&gt;</code> would be produced, which can't be dereferenced for return.</p>
</blockquote>



<a name="312785629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312785629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312785629">(Nov 29 2022 at 08:01)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197045483">PR review</a>.</p>



<a name="312785630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312785630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312785630">(Nov 29 2022 at 08:01)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034410499">PR review comment</a>:</p>
<blockquote>
<p>Yeah, sure!</p>
</blockquote>



<a name="312786148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786148">(Nov 29 2022 at 08:05)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034413709">PR review comment</a>:</p>
<blockquote>
<p>Well, it's only <code>cap_std::fs::File::set_fd_flags(&amp;mut self, set_fd_flags: SetFdFlags&lt;Self&gt;) -&gt; io::Result&lt;()&gt;</code> which needs it.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">~~~</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="312786149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786149">(Nov 29 2022 at 08:05)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197050340">PR review</a>.</p>



<a name="312786174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786174">(Nov 29 2022 at 08:05)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034413709">PR review comment</a>.</p>



<a name="312786312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786312">(Nov 29 2022 at 08:06)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197051927">PR review</a>.</p>



<a name="312786313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786313">(Nov 29 2022 at 08:06)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034414770">PR review comment</a>:</p>
<blockquote>
<p>Maybe, we should start removing the <code>mut</code> there.</p>
</blockquote>



<a name="312786456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786456">(Nov 29 2022 at 08:07)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034415929">PR review comment</a>:</p>
<blockquote>
<p><code>Arc&lt;T&gt;</code> sounds like a plan. Thanks!</p>
</blockquote>



<a name="312786458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312786458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312786458">(Nov 29 2022 at 08:07)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197053538">PR review</a>.</p>



<a name="312787414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312787414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312787414">(Nov 29 2022 at 08:14)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197062577">PR review</a>.</p>



<a name="312787415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312787415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312787415">(Nov 29 2022 at 08:14)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034422352">PR review comment</a>:</p>
<blockquote>
<p>You are right! Thanks!</p>
</blockquote>



<a name="312789927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312789927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312789927">(Nov 29 2022 at 08:27)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197080028">PR review</a>.</p>



<a name="312789928"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312789928" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312789928">(Nov 29 2022 at 08:27)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034434243">PR review comment</a>:</p>
<blockquote>
<p>Yeah, sure, but it doesn't need the <code>mut</code> now anymore with the table having interior mutability</p>
</blockquote>



<a name="312807860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312807860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312807860">(Nov 29 2022 at 10:14)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034556018">PR review comment</a>:</p>
<blockquote>
<p>yes, thanks</p>
</blockquote>



<a name="312807862"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312807862" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312807862">(Nov 29 2022 at 10:14)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197264561">PR review</a>.</p>



<a name="312823485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312823485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312823485">(Nov 29 2022 at 11:44)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034646796">PR review comment</a>:</p>
<blockquote>
<p>What do you think about:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">wasi_snapshot_preview1</span>::<span class="n">WasiSnapshotPreview1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">WasiCtx</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="312823486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312823486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312823486">(Nov 29 2022 at 11:44)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197396678">PR review</a>.</p>



<a name="312838816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312838816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312838816">(Nov 29 2022 at 13:10)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197527124">PR review</a>.</p>



<a name="312838817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312838817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312838817">(Nov 29 2022 at 13:10)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034733134">PR review comment</a>:</p>
<blockquote>
<p>seems to be in crate <code>system-interface</code> ... <code>trait GetSetFdFlags</code></p>
</blockquote>



<a name="312839266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312839266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312839266">(Nov 29 2022 at 13:13)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197531539">PR review</a>.</p>



<a name="312839267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312839267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312839267">(Nov 29 2022 at 13:13)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034736237">PR review comment</a>:</p>
<blockquote>
<p>because of windows... woah... wildcard impl for all T restricted per method.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#[cfg(windows)]</span><span class="w"></span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetSetFdFlags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="sd">/// …</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">set_fd_flags</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">set_fd_flags</span>: <span class="nc">SetFdFlags</span><span class="o">&lt;</span><span class="bp">Self</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">io</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">where</span><span class="w"></span>
<span class="w">        </span><span class="bp">Self</span>: <span class="nc">AsFilelike</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">set_fd_flags</span><span class="p">.</span><span class="n">reopened</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="312843712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312843712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312843712">(Nov 29 2022 at 13:35)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197568650">PR review</a>.</p>



<a name="312843713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312843713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312843713">(Nov 29 2022 at 13:35)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034761230">PR review comment</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/system-interface/blob/da238e324e752033f315f09c082ad9ce35d42696/src/fs/fd_flags.rs#L210-L217">https://github.com/bytecodealliance/system-interface/blob/da238e324e752033f315f09c082ad9ce35d42696/src/fs/fd_flags.rs#L210-L217</a></p>
</blockquote>



<a name="312867486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312867486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312867486">(Nov 29 2022 at 15:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197781977">PR review</a>.</p>



<a name="312867490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312867490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312867490">(Nov 29 2022 at 15:27)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034904670">PR review comment</a>:</p>
<blockquote>
<p>I would personally prefer to put the <code>Arc</code> inside of the <code>WasiCtx</code> to make it more ergonomic to use but either way achieves the same goal.</p>
</blockquote>



<a name="312867958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312867958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312867958">(Nov 29 2022 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034907880">PR review comment</a>:</p>
<blockquote>
<p>Sorry let me restate. From a system API perspective a lock is not needed here, so I don't know where the rwlock is motivated from. I would expect that these signatures remain the same since this is intended for bottoming out in the underlying platform-specific interface which handles all synchronization internally in the kernel.</p>
</blockquote>



<a name="312867959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312867959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312867959">(Nov 29 2022 at 15:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197786326">PR review</a>.</p>



<a name="312868386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312868386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312868386">(Nov 29 2022 at 15:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197788799">PR review</a>.</p>



<a name="312868387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312868387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312868387">(Nov 29 2022 at 15:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034909748">PR review comment</a>:</p>
<blockquote>
<p>Maybe @sunfishcode could help here, I'm not familiar enough with any of the methods/interfaces here to know what to do off-hand. At a base level though I don't at least currently understand why an <code>RwLock</code> or other form of synchronization is required for I/O operations on system files.</p>
</blockquote>



<a name="312873187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312873187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312873187">(Nov 29 2022 at 15:53)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1034938226">PR review comment</a>:</p>
<blockquote>
<p>It's only because of <code>File::set_fd_flags()</code> needing &amp;mut self</p>
</blockquote>



<a name="312873190"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312873190" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312873190">(Nov 29 2022 at 15:53)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1197830087">PR review</a>.</p>



<a name="312988101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988101">(Nov 30 2022 at 05:13)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a> from <code>table_immutable</code> to <code>main</code>.</p>



<a name="312988564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988564">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1198697281">PR review</a>.</p>



<a name="312988565"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988565" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988565">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1035538279">PR review comment</a>:</p>
<blockquote>
<p>deferred this to a later PR</p>
</blockquote>



<a name="312988581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988581">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1198697396">PR review</a>.</p>



<a name="312988582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988582">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1035538365">PR review comment</a>:</p>
<blockquote>
<p>deferred this for a later PR</p>
</blockquote>



<a name="312988599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988599">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#pullrequestreview-1198697481">PR review</a>.</p>



<a name="312988600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988600">(Nov 30 2022 at 05:18)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/5326#discussion_r1035538428">PR review comment</a>:</p>
<blockquote>
<p>done</p>
</blockquote>



<a name="312988613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988613">(Nov 30 2022 at 05:18)</a>:</h4>
<p><strong>haraldh</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a>.</p>



<a name="312988621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988621">(Nov 30 2022 at 05:18)</a>:</h4>
<p><strong>haraldh</strong> requested <a href="https://github.com/bjorn3">bjorn3</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a>.</p>



<a name="312988633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235326%20WIP%3A%20%20immutable%20WasiCtx/near/312988633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235326.20WIP.3A.20.20immutable.20WasiCtx.html#312988633">(Nov 30 2022 at 05:18)</a>:</h4>
<p><strong>haraldh</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5326">PR #5326</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>