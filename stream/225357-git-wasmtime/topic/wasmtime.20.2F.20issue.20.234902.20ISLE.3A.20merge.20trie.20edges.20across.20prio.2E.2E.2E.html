<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4902 ISLE: merge trie edges across prio... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html">wasmtime / issue #4902 ISLE: merge trie edges across prio...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="298512335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/298512335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#298512335">(Sep 13 2022 at 04:32)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1244884155">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="298826094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/298826094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#298826094">(Sep 14 2022 at 18:25)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1247146809">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<p>Updated, thanks!</p>
</blockquote>



<a name="299611094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/299611094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#299611094">(Sep 19 2022 at 17:27)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1251323844">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<p>Does this comment need to be clarified after merging this PR?<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/562bb25360a2f366a482e15fc148bab7267a9266/cranelift/isle/isle/src/trie.rs#L102-L111">https://github.com/bytecodealliance/wasmtime/blob/562bb25360a2f366a482e15fc148bab7267a9266/cranelift/isle/isle/src/trie.rs#L102-L111</a></p>
</blockquote>



<a name="299629629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/299629629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#299629629">(Sep 19 2022 at 19:17)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1251440290">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<blockquote>
<p>Does this comment need to be clarified after merging this PR?</p>
</blockquote>
<p>Indeed, just updated; thanks!</p>
</blockquote>



<a name="299672330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/299672330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#299672330">(Sep 20 2022 at 01:47)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1251740260">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<p>I don't understand how this trie construction works, so this question may be nonsense, but is all this frontier machinery necessary? It looks to me like this PR is equivalent to inserting into a list that's sorted by <code>(Reverse&lt;Prio&gt;, TrieSymbol)</code>.</p>
<p>Here's a patch on top of 18be532c2b9b9baab654b643c2e27c135c9df673 that I think should be equivalent, using a <code>BTreeMap</code> to maintain the sort order. I haven't tried running it because I should have left work an hour or two ago, but I did verify that it builds without warnings.</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/9603353/trie-btree.txt">trie-btree.txt</a></p>
</blockquote>



<a name="299673499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/299673499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#299673499">(Sep 20 2022 at 02:02)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1251746924">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<blockquote>
<p>It looks to me like this PR is equivalent to inserting into a list that's sorted by (Reverse&lt;Prio&gt;, TrieSymbol).</p>
</blockquote>
<p>Not quite, unfortunately: the subtle difference is in the ability to merge <em>across</em> priorities. The scheme your patch introduces, with edges that are labeled by priorities, is more or less what this PR is replacing. The key invariant that makes this PR work is that edges are <em>not</em> labeled by priority, and rules of different priorities are allowed to share an edge, but we limit the overlap to maintain priority ordering (the frontier).</p>
</blockquote>



<a name="299803869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234902%20ISLE%3A%20merge%20trie%20edges%20across%20prio.../near/299803869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234902.20ISLE.3A.20merge.20trie.20edges.20across.20prio.2E.2E.2E.html#299803869">(Sep 20 2022 at 16:47)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4902#issuecomment-1252627762">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4902">issue #4902</a>:</p>
<blockquote>
<p>@elliottt and I discussed this a bit further this morning and given concerns about the potential reordering before we are fully overlap-checker-clean, we agree it probably makes sense to wait to optimize using the additional reordering flexibility until later. So I'll go ahead and close this PR for now.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>