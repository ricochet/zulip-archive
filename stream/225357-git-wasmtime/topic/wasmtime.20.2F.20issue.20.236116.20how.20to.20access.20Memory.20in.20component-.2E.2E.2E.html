<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6116 how to access Memory in component-... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html">wasmtime / issue #6116 how to access Memory in component-...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="345313108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/345313108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#345313108">(Mar 29 2023 at 07:17)</a>:</h4>
<p>Sherlock-Holo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>I'm using <code>component-model</code> feature to write a host function, however I can't get the <code>Caller</code> or <code>Store</code> to access the wasm memory through <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.Memory.html#method.data_mut">https://docs.rs/wasmtime/latest/wasmtime/struct.Memory.html#method.data_mut</a></p>
</blockquote>



<a name="345433810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/345433810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#345433810">(Mar 29 2023 at 15:08)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1488812454">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>At the component model layer of abstraction embedders don't have access to core wasm primitives such as <code>Memory</code> or <code>Func</code>. That means that the answer to your question is that the <code>Memory</code> cannot be accessed.</p>
<p>Could you perhaps elaborate though the intention for accessing memory? We can try to help out with the problem at hand via an alternative means.</p>
</blockquote>



<a name="345824302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/345824302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#345824302">(Mar 31 2023 at 02:37)</a>:</h4>
<p>Sherlock-Holo <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1491211409">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>I'm writing my udp/tcp helper, allow wasm codes can read write tcp/udp<br>
I want to let wasm codes pass the buffer offset and length to the host function, then rust codes can write data into the wasm linear memory directly or read from linear memory directly<br>
but with <code>component-model</code> feature, rust codes can't access the linear memory through <code>Caller</code> for now</p>
</blockquote>



<a name="347174251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/347174251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#347174251">(Apr 05 2023 at 14:59)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1497637420">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>Ah ok, thanks for the info! For that you'll probably want to take a look at the <a href="https://github.com/bytecodealliance/preview2-prototyping/blob/main/wit/deps/io/streams.wit"><code>stream</code> type that WASI is working on</a>. Otherwise with the component model you need to model operations with <code>list&lt;u8&gt;</code> for now. Eventually the component model will have a native stream type for these sorts of operations, but that's not available and/or designed yet.</p>
<p>Given though that the lack of access to linear memory is an intentional design decision I'm going to close this issue. If you're having trouble with streams from WASI it might be best to wait for some of the WASI bits to settle to have more examples to draw from. Otherwise though feel free to open an issue.</p>
</blockquote>



<a name="347174253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/347174253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#347174253">(Apr 05 2023 at 14:59)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>I'm using <code>component-model</code> feature to write a host function, however I can't get the <code>Caller</code> or <code>Store</code> to access the wasm memory through <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.Memory.html#method.data_mut">https://docs.rs/wasmtime/latest/wasmtime/struct.Memory.html#method.data_mut</a></p>
</blockquote>



<a name="423330269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/423330269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#423330269">(Feb 26 2024 at 06:24)</a>:</h4>
<p>BrytonLee <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1963401861">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>@alexcrichton , I have some huge data structs want to be send from host side to wasm module, can I intercept wasi file operation and encapsulate data that can be passed via file descriptor?  Do you think that WASI <code>stream</code> type would help? </p>
<p>Thank you for your guidance. </p>
</blockquote>



<a name="423423833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/423423833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#423423833">(Feb 26 2024 at 15:41)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1964451273">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>@BrytonLee that cannot be easily done today as far as I'm aware. Nowadays we'd recommend using a <code>resource</code> to model your large structure. That way the guest can have a handle on it and only request the parts it needs.</p>
</blockquote>



<a name="423517481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/423517481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#423517481">(Feb 27 2024 at 01:55)</a>:</h4>
<p>BrytonLee <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1965650449">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>Thank you very much, @alexcrichton .  </p>
<p>I think most developer care about accessing memory is due to performance concerns.  Is there any other suggestion for reducing memory copy cost? </p>
<p>From my best knowledge, 1). wasmtime component module doesn't allow to upper code access wasm module memory (return area and linear memory). 2). <code>stream</code> type implementation in wasmtime doesn't directly access linear memory neither, so it also need to copy data in/out from wasm modue.  3). <code>resource</code> is more suitable for wasm module when it only consumes part of whole data.  Are they true? </p>
<p>I saw that wasmedge rust-sdk async-wasi support VFS, it seems that async-wasi allows developer to build a virtual memory file for WASI file I/O, does wasmtime have simillar ones?  Also would wasm module develop to use something like <code>mmap</code> to share memory with wasmtime? </p>
<p>Thanks,<br>
Bryton</p>
</blockquote>



<a name="423517630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/423517630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#423517630">(Feb 27 2024 at 01:57)</a>:</h4>
<p>BrytonLee edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1965650449">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>Thank you very much, @alexcrichton .  </p>
<p>I think most developer care about accessing memory is due to performance concerns.  Is there any other suggestion for reducing memory copy cost? </p>
<p>From my best knowledge, 1). wasmtime component module doesn't allow to upper code access wasm module memory (return area and linear memory). 2). <code>stream</code> type implementation in wasmtime doesn't directly access linear memory neither, so it also need to copy data in/out from wasm modue.  3). <code>resource</code> is more suitable for wasm module when it only consumes part of whole data.  Are they true? </p>
<p>I saw that wasmedge rust-sdk async-wasi support VFS, it seems that async-wasi allows developer to build a virtual memory file for WASI file I/O, does wasmtime have simillar ones?  Also would wasm module developer can use something like <code>mmap</code> to share memory with wasmtime? </p>
<p>Thanks,<br>
Bryton</p>
</blockquote>



<a name="423854674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236116%20how%20to%20access%20Memory%20in%20component-.../near/423854674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236116.20how.20to.20access.20Memory.20in.20component-.2E.2E.2E.html#423854674">(Feb 28 2024 at 16:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6116#issuecomment-1969347332">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6116">issue #6116</a>:</p>
<blockquote>
<p>Ah I see that this discussion has been <a href="#narrow/stream/206238-general/topic/How.20many.20memory.20copy.20happens.20when.20a.20struct.20passing.20to.20guest.3F/near/423738896">taken to zulip</a>, so dropping a link here for context.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>