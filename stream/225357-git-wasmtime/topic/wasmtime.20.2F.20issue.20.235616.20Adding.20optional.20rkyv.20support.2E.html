<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5616 Adding optional rkyv support. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html">wasmtime / issue #5616 Adding optional rkyv support.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="322769382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/322769382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#322769382">(Jan 21 2023 at 19:09)</a>:</h4>
<p>jakubDoka opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Adding the <a href="https://github.com/rkyv/rkyv">rkyv</a> support behind a cargo feature.</p>
<h4>Benefit</h4>
<p>Allows zero copy serialization, which is not supported by serde formats. I particularly find it very useful in my compiler.</p>
<h4>Implementation</h4>
<p>Traits can be easily derived with proc macros, for all types that derive serde Traits. </p>
<p>I have some experience after integrating it into my project, and it is in my interest to be supported, so I can also implement this.</p>
<h4>Alternatives</h4>
<p>I don't have notion of other libraries with same capabilities.</p>
</blockquote>



<a name="322777889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/322777889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#322777889">(Jan 21 2023 at 20:48)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1399329734">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>Doesn't rkyv produce a separate type for every type which uses the derive for zero-copy deserialization? That would require duplicating a big chunk of the api surface. I believe it also doesn't allow mutating this zero-copy deserialized version, which makes it impossible to compile it without copying it into a regular mutatable Function first. Or were you not talking about adding support for it to Cranelift?</p>
</blockquote>



<a name="322780065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/322780065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#322780065">(Jan 21 2023 at 21:18)</a>:</h4>
<p>jakubDoka <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1399334444">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>Yes I mean cranelift, sorry should have hed clarified.<br>
</p>
</blockquote>



<a name="324182458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324182458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324182458">(Jan 27 2023 at 23:37)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1407192754">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>I think I'm missing something. What do you want Cranelift to use rkyv for? What do you want to serialize/deserialize, and why is it performance-critical?</p>
</blockquote>



<a name="324737090"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324737090" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324737090">(Jan 30 2023 at 17:33)</a>:</h4>
<p>jakubDoka <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1409036534">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>My <a href="https://github.com/jakubDoka/Catalyst">compiler</a> uses rkyv to cache incremental builds, and it improves size and speed at which compiler can load and save metadata. I inevitably need to serialize things like signatures and relocations. This leads to defining shadow types and lot of boilerplate. For now I transmute what I can but really don't like code necessary to work around this. </p>
</blockquote>



<a name="324740077"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324740077" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324740077">(Jan 30 2023 at 17:47)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1409055249">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>You could use a serde compatible format to serialize the cranelift types and then put the result as opaque blob of type <code>Vec&lt;u8&gt;</code> in your rkyv serializable cache.</p>
</blockquote>



<a name="324743683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324743683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324743683">(Jan 30 2023 at 18:05)</a>:</h4>
<p>jakubDoka <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1409080344">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>Welp, I don't like the idea but seems like it could do the trick. So should i close this? Is there no chance of this being added?</p>
</blockquote>



<a name="324764407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324764407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324764407">(Jan 30 2023 at 19:52)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1409242921">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>I wouldn't say there's no chance. We just need to have a clear picture of what we're signing up for, including any ongoing maintenance burden. That's a little trickier with any new dependencies like rkyv since we need to audit them, and any crates they depend on, for security concerns.</p>
<p>One way to help answer those questions is to have a proof-of-concept PR to look at. Usually I'd prefer to decide whether we want a particular feature through discussion first, such as an issue like this. But in this case it sounds to me like you're familiar enough with both Cranelift and rkyv that you could quickly put together a draft pull request illustrating the basic idea.</p>
<p>I won't promise that we'll merge it, so don't spend too much time on it. But I think for me at least it would help a lot to see what exactly is involved in doing what you're asking for.</p>
</blockquote>



<a name="324777331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235616%20Adding%20optional%20rkyv%20support./near/324777331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235616.20Adding.20optional.20rkyv.20support.2E.html#324777331">(Jan 30 2023 at 21:09)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/5616#issuecomment-1409342066">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5616">issue #5616</a>:</p>
<blockquote>
<p>We already support one serialization library. It is the most popular serialization library for Rust. I'd really rather not support additional serialization libraries unless there is a <em>very</em> good reason. Do we also support <code>miniserde</code> when someone asks for smaller binary sizes? At what point does it stop? I feel like supporting just the number one library is an incredibly reasonable place for us to be at.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>