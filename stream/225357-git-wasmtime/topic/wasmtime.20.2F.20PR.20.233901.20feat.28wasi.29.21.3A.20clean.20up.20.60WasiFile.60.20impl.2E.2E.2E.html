<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3901 feat(wasi)!: clean up `WasiFile` impl... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html">wasmtime / PR #3901 feat(wasi)!: clean up `WasiFile` impl...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="274700345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274700345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274700345">(Mar 09 2022 at 15:05)</a>:</h4>
<p>npmccallum opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a> from <code>wasi</code> to <code>main</code>:</p>
<blockquote>
<p>This effort includes two major changes:</p>
<ol>
<li>
<p>Most methods are given a default implementation. This aids<br>
implementors who only need a few of the methods and it allows us to<br>
remove a bunch of boilerplate code.</p>
</li>
<li>
<p>Most methods are changed to take a mutable reference. This is<br>
important since wasmtime cannot know ahead of time what APIs<br>
implementors are trying to adapt.</p>
</li>
</ol>
<p>BREAKING CHANGE: <code>WasiFile</code> has changed method signatures</p>
<p>Signed-off-by: Nathaniel McCallum &lt;<a href="mailto:nathaniel@profian.com">nathaniel@profian.com</a>&gt;</p>
</blockquote>



<a name="274702863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274702863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274702863">(Mar 09 2022 at 15:22)</a>:</h4>
<p>npmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a> from <code>wasi</code> to <code>main</code>.</p>



<a name="274705277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274705277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274705277">(Mar 09 2022 at 15:39)</a>:</h4>
<p>npmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a> from <code>wasi</code> to <code>main</code>.</p>



<a name="274706749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274706749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274706749">(Mar 09 2022 at 15:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904581459">PR review</a>.</p>



<a name="274706750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274706750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274706750">(Mar 09 2022 at 15:49)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904581459">PR review</a>.</p>



<a name="274706751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274706751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274706751">(Mar 09 2022 at 15:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822801799">PR review comment</a>:</p>
<blockquote>
<p>An argument against this change: Using <code>&amp;mut self</code> would require locking on the wasmtime side if multi threading support is ever implemented. <code>&amp;self</code> allows the <code>WasiFile</code> impl to avoid locking if it doesn't need it. (eg you can read from and write to an <code>&amp;std::fs::File</code> without locking. <code>&amp;mut self</code> would also require double locking in case of a shared resource accessible through multiple <code>WasiFile</code>s.</p>
</blockquote>



<a name="274706752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274706752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274706752">(Mar 09 2022 at 15:49)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822799867">PR review comment</a>:</p>
<blockquote>
<p>I think the intention here is that it will eventually be implemented once it becomes possible.</p>
</blockquote>



<a name="274710256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274710256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274710256">(Mar 09 2022 at 16:10)</a>:</h4>
<p>npmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904615772">PR review</a>.</p>



<a name="274710257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274710257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274710257">(Mar 09 2022 at 16:10)</a>:</h4>
<p>npmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822824444">PR review comment</a>:</p>
<blockquote>
<p>@bjorn3 Except that this is an async interface. I'm unware of async-aware locking primitives. And you most certainly don't want to take a lock around an IO operation.</p>
</blockquote>



<a name="274713360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274713360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274713360">(Mar 09 2022 at 16:31)</a>:</h4>
<p>npmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904645761">PR review</a>.</p>



<a name="274713361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274713361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274713361">(Mar 09 2022 at 16:31)</a>:</h4>
<p>npmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822846024">PR review comment</a>:</p>
<blockquote>
<p>@bjorn3 The existing code is inconsistent with regards to mutability. Whatever we do, it should be consistent.</p>
</blockquote>



<a name="274715553"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274715553" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274715553">(Mar 09 2022 at 16:46)</a>:</h4>
<p>npmccallum submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904669184">PR review</a>.</p>



<a name="274715554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274715554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274715554">(Mar 09 2022 at 16:46)</a>:</h4>
<p>npmccallum created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822862790">PR review comment</a>:</p>
<blockquote>
<p>@bjorn3 Also, <code>WasiSnapshotPreview1</code> takes <code>&amp;mut self</code> for all operations. That seems to gate this.</p>
</blockquote>



<a name="274718946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274718946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274718946">(Mar 09 2022 at 17:07)</a>:</h4>
<p>npmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a> from <code>wasi</code> to <code>main</code>.</p>



<a name="274719674"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274719674" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274719674">(Mar 09 2022 at 17:11)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-904705937">PR review</a>.</p>



<a name="274719676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274719676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274719676">(Mar 09 2022 at 17:11)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#discussion_r822888762">PR review comment</a>:</p>
<blockquote>
<p>I guess so.</p>
</blockquote>



<a name="274763771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274763771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274763771">(Mar 09 2022 at 22:44)</a>:</h4>
<p>npmccallum updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a> from <code>wasi</code> to <code>main</code>.</p>



<a name="274766758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274766758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274766758">(Mar 09 2022 at 23:14)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3901#pullrequestreview-905101114">PR review</a>.</p>



<a name="274767523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233901%20feat%28wasi%29%21%3A%20clean%20up%20%60WasiFile%60%20impl.../near/274767523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233901.20feat.28wasi.29.21.3A.20clean.20up.20.60WasiFile.60.20impl.2E.2E.2E.html#274767523">(Mar 09 2022 at 23:22)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3901">PR #3901</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>