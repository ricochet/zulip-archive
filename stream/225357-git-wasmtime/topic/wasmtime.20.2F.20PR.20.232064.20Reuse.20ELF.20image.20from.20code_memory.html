<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2064 Reuse ELF image from code_memory · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html">wasmtime / PR #2064 Reuse ELF image from code_memory</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="204706784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/204706784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#204706784">(Jul 22 2020 at 18:49)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2064">PR #2064</a> from <code>code-memory-reuse</code> to <code>main</code>:</p>
<blockquote>
<p>Optimization for #2020 </p>
<p>Changes:</p>
<ul>
<li>Places entire ELF image into code_memory</li>
<li>Use code_memory data as a source for <code>wasm_module_serialize</code> instead keeping pristine copy in memory</li>
<li>Use code_memory data as GDB JIT image</li>
<li>Sanitizes serialized image from current address information</li>
<li>Moves ELF patching logic into the wasmtime-obj crate, also refactored for adding other platforms.</li>
</ul>
</blockquote>



<a name="204829125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/204829125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#204829125">(Jul 23 2020 at 17:43)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2064">PR #2064</a> from <code>code-memory-reuse</code> to <code>main</code>:</p>
<blockquote>
<p>Optimization for #2020 </p>
<p>Changes:</p>
<ul>
<li>Places entire ELF image into code_memory</li>
<li>Use code_memory data as a source for <code>wasm_module_serialize</code> instead keeping pristine copy in memory</li>
<li>Use code_memory data as GDB JIT image</li>
<li>Sanitizes serialized image from current address information</li>
<li>Moves ELF patching logic into the wasmtime-obj crate, also refactored for adding other platforms.</li>
</ul>
</blockquote>



<a name="205849977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849977">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#pullrequestreview-460350156">PR Review</a>.</p>



<a name="205849978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849978">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#pullrequestreview-460350156">PR Review</a>.</p>



<a name="205849979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849979">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464670652">PR Review Comment</a>:</p>
<blockquote>
<p>While you're here, mind going ahead and changing this to an <code>anyhow::Result</code> to avoid using <code>String</code> as an error?</p>
</blockquote>



<a name="205849980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849980">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464672849">PR Review Comment</a>:</p>
<blockquote>
<p>(similar comment about unsafety as above)</p>
<p>Additionally this look looks basically the same as the one above, so could that be factored out? Something like a function that applies all relocations and uses a closure to calculate the reloc value.</p>
</blockquote>



<a name="205849981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849981">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464670954">PR Review Comment</a>:</p>
<blockquote>
<p>I think we'll probably want to resolve this before landing</p>
</blockquote>



<a name="205849982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849982">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464669400">PR Review Comment</a>:</p>
<blockquote>
<p>It looks like some of these reader methods are <a href="https://docs.rs/object/0.20.0/object/read/elf/trait.FileHeader.html#tymethod.e_ident">already on a predefined trait</a>, could that be used instead?</p>
<p>(it looks like setters aren't found there though)</p>
</blockquote>



<a name="205849983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849983">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464672478">PR Review Comment</a>:</p>
<blockquote>
<p>Could the <code>unsafe</code> be avoided here by reading the second data directly from the <code>section</code> from the iterator?</p>
</blockquote>



<a name="205849984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849984">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464673178">PR Review Comment</a>:</p>
<blockquote>
<p>This seems like it's a bit of a scary error to omit, could we return an error here instead and use error messages to guide fixing this later?</p>
</blockquote>



<a name="205849985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849985">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464673482">PR Review Comment</a>:</p>
<blockquote>
<p>Would it be possible to not add <code>unsafe</code> here? Could the code bytes be read from a safe method?</p>
</blockquote>



<a name="205849986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849986">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464673697">PR Review Comment</a>:</p>
<blockquote>
<p>Could the unsafety here be encapsulated in a safe method?</p>
</blockquote>



<a name="205849987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/205849987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#205849987">(Aug 03 2020 at 21:35)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r464673538">PR Review Comment</a>:</p>
<blockquote>
<p>How come these errors are ignored?</p>
</blockquote>



<a name="206300104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/206300104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#206300104">(Aug 07 2020 at 19:30)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#pullrequestreview-463562216">PR Review</a>.</p>



<a name="206300105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/206300105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#206300105">(Aug 07 2020 at 19:30)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#discussion_r467230486">PR Review Comment</a>:</p>
<blockquote>
<p>That is the main reason for code duplication -- I can add a comment about setters.</p>
</blockquote>



<a name="424309882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/424309882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#424309882">(Mar 01 2024 at 19:07)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/2064">PR #2064</a>.</p>



<a name="424309883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232064%20Reuse%20ELF%20image%20from%20code_memory/near/424309883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232064.20Reuse.20ELF.20image.20from.20code_memory.html#424309883">(Mar 01 2024 at 19:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2064#issuecomment-1973765655">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2064">PR #2064</a>:</p>
<blockquote>
<p>I'm going through some old PRs and this one's pretty old at this point. Enough points have changed that I don't think this is quite as applicable any more and I think much of this ended up getting landed in <code>main</code> anyway over time. </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>