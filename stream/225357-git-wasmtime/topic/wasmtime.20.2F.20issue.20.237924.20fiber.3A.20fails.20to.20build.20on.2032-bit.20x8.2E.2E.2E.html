<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7924 fiber: fails to build on 32-bit x8... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html">wasmtime / issue #7924 fiber: fails to build on 32-bit x8...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="421161423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237924%20fiber%3A%20fails%20to%20build%20on%2032-bit%20x8.../near/421161423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html#421161423">(Feb 13 2024 at 01:41)</a>:</h4>
<p>jbeich opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7924">issue #7924</a>:</p>
<blockquote>
<p>Regresed by #5459 (missed <code>x86.rs</code> and <code>arm.rs</code>). <a href="https://github.com/bytecodealliance/wasmtime/files/14254571/veloren-weekly-s20240211.log">Found</a> while <a href="https://github.com/freebsd/freebsd-ports/commit/76756d2f6d52">packaging</a> <a href="https://gitlab.com/veloren/veloren/-/commit/f56e1d84b598">Veloren</a>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">i686</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>
<span class="p">[</span><span class="o">..</span><span class="p">.]</span>
<span class="n">error</span><span class="p">[</span><span class="n">E0432</span><span class="p">]</span>: <span class="nc">unresolved</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_asm_macros</span>::<span class="n">asm_sym</span><span class="err">`</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">fiber</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">x86</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">13</span>:<span class="mi">37</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime_asm_macros</span>::<span class="p">{</span><span class="n">asm_func</span><span class="p">,</span><span class="w"> </span><span class="n">asm_sym</span><span class="p">};</span>
<span class="w">   </span><span class="o">|</span><span class="w">                                     </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="err">`</span><span class="n">asm_sym</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">root</span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0432</span><span class="err">`</span><span class="p">.</span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">lib</span><span class="p">)</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span>
</code></pre></div>
</blockquote>



<a name="421195567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237924%20fiber%3A%20fails%20to%20build%20on%2032-bit%20x8.../near/421195567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html#421195567">(Feb 13 2024 at 08:24)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/7924#issuecomment-1940720364">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7924">issue #7924</a>:</p>
<blockquote>
<p>Wasmtime doesn't work on 32bit x86 and arm32. It is not just a missing fiber implementation (that would be easy to fix), but also missing backends for both architectures in Cranelift, which is a lot harder to fix. See <a href="https://github.com/bytecodealliance/wasmtime/issues/1173">https://github.com/bytecodealliance/wasmtime/issues/1173</a> and <a href="https://github.com/bytecodealliance/wasmtime/issues/1980">https://github.com/bytecodealliance/wasmtime/issues/1980</a>.</p>
</blockquote>



<a name="421269438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237924%20fiber%3A%20fails%20to%20build%20on%2032-bit%20x8.../near/421269438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html#421269438">(Feb 13 2024 at 15:38)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7924#issuecomment-1941812025">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7924">issue #7924</a>:</p>
<blockquote>
<p>To add more on what @bjorn3 already mentioned, can you clarify what you mean by regressed by #5459? Wasmtime/Cranelift haven't had support for x86 and arm in quite some time so that PR shouldn't have regressed anything "in the large". If, however, you only need the <code>wasmtime-fiber</code> crate and nothing else then I can see that PR regressing the support there. Do you only need the <code>wasmtime-fiber</code> crate? Given the <a href="https://gitlab.com/veloren/veloren/-/commit/f56e1d84b598">commit you linked</a> it seems like you're packaging all of Wasmtime so while it doesn't seem like this is the case I wanted to ask to be sure. (if you need all of Wasmtime I'll close this in favor of the issues that @bjorn3 linked tracking 32-bit support)</p>
</blockquote>



<a name="421839331"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237924%20fiber%3A%20fails%20to%20build%20on%2032-bit%20x8.../near/421839331" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html#421839331">(Feb 16 2024 at 11:19)</a>:</h4>
<p>jbeich closed <a href="https://github.com/bytecodealliance/wasmtime/issues/7924">issue #7924</a>:</p>
<blockquote>
<p>Regresed by #5459 (missed <code>x86.rs</code> and <code>arm.rs</code>). <a href="https://github.com/bytecodealliance/wasmtime/files/14254571/veloren-weekly-s20240211.log">Found</a> while <a href="https://github.com/freebsd/freebsd-ports/commit/76756d2f6d52">packaging</a> <a href="https://gitlab.com/veloren/veloren/-/commit/f56e1d84b598">Veloren</a>.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">i686</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>
<span class="p">[</span><span class="o">..</span><span class="p">.]</span>
<span class="n">error</span><span class="p">[</span><span class="n">E0432</span><span class="p">]</span>: <span class="nc">unresolved</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_asm_macros</span>::<span class="n">asm_sym</span><span class="err">`</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">fiber</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">x86</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">13</span>:<span class="mi">37</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">13</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime_asm_macros</span>::<span class="p">{</span><span class="n">asm_func</span><span class="p">,</span><span class="w"> </span><span class="n">asm_sym</span><span class="p">};</span>
<span class="w">   </span><span class="o">|</span><span class="w">                                     </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="err">`</span><span class="n">asm_sym</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">root</span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0432</span><span class="err">`</span><span class="p">.</span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">fiber</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">lib</span><span class="p">)</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span>
</code></pre></div>
</blockquote>



<a name="421839343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237924%20fiber%3A%20fails%20to%20build%20on%2032-bit%20x8.../near/421839343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237924.20fiber.3A.20fails.20to.20build.20on.2032-bit.20x8.2E.2E.2E.html#421839343">(Feb 16 2024 at 11:19)</a>:</h4>
<p>jbeich <a href="https://github.com/bytecodealliance/wasmtime/issues/7924#issuecomment-1948208881">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7924">issue #7924</a>:</p>
<blockquote>
<p>Indeed. I've got confused by the cruft i.e., <code>x86</code> and <code>arm</code> support in <code>wasmtime-fiber</code> which is trivial to fix by removing unused <code>asm_sym</code>. Veloren then failed in <code>wasmtime-runtime</code> due to missing assembly but otherwise built fine (I've stubbed the assembly using <a href="https://github.com/bytecodealliance/wasmtime/blob/main/crates/runtime/src/arch/x86_64.rs">x86_64 as example</a> to check for more errors but didn't find any).<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>