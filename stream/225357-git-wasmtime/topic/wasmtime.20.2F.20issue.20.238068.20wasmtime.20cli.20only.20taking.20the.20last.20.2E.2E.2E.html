<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8068 wasmtime cli only taking the last ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html">wasmtime / issue #8068 wasmtime cli only taking the last ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="425533836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425533836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425533836">(Mar 08 2024 at 14:51)</a>:</h4>
<p><a href="https://github.com/mtobin-tdab">mtobin-tdab</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">Issue #8068</a>.</p>



<a name="425533839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425533839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425533839">(Mar 08 2024 at 14:51)</a>:</h4>
<p>mtobin-tdab opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p>Working on creating a test case</p>
<h3>Steps to Reproduce</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can bash <code>run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory but one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of --dir args is different however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425533942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425533942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425533942">(Mar 08 2024 at 14:52)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can bash <code>run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory but one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of --dir args is different however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425534019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425534019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425534019">(Mar 08 2024 at 14:52)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can bash <code>run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of --dir args is different however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425534314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425534314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425534314">(Mar 08 2024 at 14:54)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can bash <code>run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425534387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425534387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425534387">(Mar 08 2024 at 14:55)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can bash <code>run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425534466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425534466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425534466">(Mar 08 2024 at 14:55)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425535146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535146">(Mar 08 2024 at 14:59)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<p>**Note that it is able to read from both if the absolute path is more specific - i.e. if the absolute path is under <code>/home</code></p>
<p><code>bin/wasmtime --dir=. --dir=/home target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code><br>
will successfully read and print both files</p>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425535177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535177">(Mar 08 2024 at 14:59)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<p>** Note that it is able to read from both if the absolute path is more specific - i.e. if the absolute path is under <code>/home</code></p>
<p><code>bin/wasmtime --dir=. --dir=/home target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code><br>
will successfully read and print both files</p>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425535211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535211">(Mar 08 2024 at 14:59)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<p>** Note that it is able to read from both if the absolute path is more specific - i.e. if the absolute path is under <code>/home</code></p>
<p><code>bin/wasmtime --dir=. --dir=/home target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code><br>
will successfully read and print both files **</p>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425535253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535253">(Mar 08 2024 at 14:59)</a>:</h4>
<p>mtobin-tdab edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<p><strong>Note</strong> that it is able to read from both if the absolute path is more specific - i.e. if the absolute path is under <code>/home</code></p>
<p><code>bin/wasmtime --dir=. --dir=/home target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code><br>
will successfully read and print both files </p>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="425535342"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535342" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535342">(Mar 08 2024 at 15:00)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1985848871">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>What is the source code of this wasm module?</p>
</blockquote>



<a name="425535400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425535400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425535400">(Mar 08 2024 at 15:00)</a>:</h4>
<p>bjorn3 deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1985848871">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>What is the source code of this wasm module?</p>
</blockquote>



<a name="425536328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425536328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425536328">(Mar 08 2024 at 15:05)</a>:</h4>
<p>mtobin-tdab <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1985856891">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>@bjorn3 There is an example in the zip file attached: <a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip</a></p>
<p>It seems all versions of wasmtime have this issue (I'm using a version of wasmtime 17.0.0 but it is also true for 18.0.2 </p>
</blockquote>



<a name="425552304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425552304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425552304">(Mar 08 2024 at 16:34)</a>:</h4>
<p>mtobin-tdab deleted a <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1985856891">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>@bjorn3 There is an example in the zip file attached: <a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip</a></p>
<p>It seems all versions of wasmtime have this issue (I'm using a version of wasmtime 17.0.0 but it is also true for 18.0.2 </p>
</blockquote>



<a name="425552464"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/425552464" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#425552464">(Mar 08 2024 at 16:35)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1986017976">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>Thanks for the report! I think though it's going to be a bit tough to say where the bug is here though. With <code>--dir .</code> and <code>--dir /</code> Wasmtime is configuring the "preopens" with names <code>.</code> and <code>/</code>, as expected. In wasi-libc, however, <a href="https://github.com/WebAssembly/wasi-libc/blob/a1b4def387614c391276cc4b2d1f1bdb8994cf3e/libc-bottom-half/sources/preopens.c#L84-L102">both of these strings</a> are "normalized" to the empty string.</p>
<p>More-or-less I think the issue you're running into here is that wasi-libc's emulation of the current working directory is a bit buggy in the case of having both <code>.</code> and <code>/</code> preopens. In this case wasi-libc doesn't know what the current working directory is so the "loose convention" so far of both of those being somewhat equivalent to the current working directory clashes and then things don't work.</p>
<p>I believe that the fix for this is going to be in wasi-libc, not Wasmtime. I don't know of the best way to fix it there, though, as writing path-handling code in C is not my personal forte at least.</p>
</blockquote>



<a name="426102142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/426102142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#426102142">(Mar 12 2024 at 11:14)</a>:</h4>
<p>mtobin-tdab <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-1991404534">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>Thanks for this, very helpful! I will make an equivalent issue in the wasi-libc repo.</p>
</blockquote>



<a name="429547093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/429547093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#429547093">(Mar 26 2024 at 03:15)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>I appear to be finding that wasmtime version 17.0.0 does not handle --dir=/ --dir=.</p>
<p>I have tried different combinations of</p>
<p>--dir=. --dir . --dir .::. <br>
--dir=/ --dir / --dir /::/</p>
<p>But am finding that whichever is passed first not working as expected (i.e. files cannot be found through that file descriptor)</p>
<p>Is this a known limitation? I am running wasmtime in a docker container and my goal is to allow it access to all files on the container as well as the current directory (in order not to have to change file paths)</p>
<p>I am using cargo component build --release to build the project</p>
<h3>Test Case</h3>
<p>Here is a small project which will reproduce the issue:<br>
<a href="https://github.com/bytecodealliance/wasmtime/files/14539480/bug_demo.zip">bug_demo.zip</a></p>
<ul>
<li>The binaries are included so you can run  <code>bash run-test.sh</code> from inside the directory to run the test</li>
<li>You can also rebuild with <code>cargo component build --release</code></li>
<li>The project tries to read from two files, both in the same directory - with one referred to relative to the current directory and one with an absolute path (This is passed as an arg using ${PWD} so the absolute path relative to your machine will be used)</li>
<li>Two wasmtime commands are run:<ul>
<li><code>bin/wasmtime --dir=/ --dir=. target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
<li><code>bin/wasmtime --dir=. --dir=/ target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code></li>
</ul>
</li>
<li>Note that only the order of <code>--dir</code> args is different, however the outputs are respectively:</li>
<li></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="p">.</span><span class="o">/</span><span class="n">file2</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=</span><span class="p">.</span><span class="w"> </span><span class="n">worked</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reading</span><span class="w"> </span><span class="n">file</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mtobin</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">OctaiOxide</span><span class="o">/</span><span class="n">bug_demo</span><span class="o">/</span><span class="n">file1</span><span class="p">.</span><span class="n">txt</span><span class="o">..</span><span class="p">.</span>
<span class="o">--</span><span class="n">dir</span><span class="o">=/</span><span class="w"> </span><span class="n">worked</span><span class="p">.</span>
<span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">file</span>: <span class="nc">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">os</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="mi">44</span><span class="p">)</span>
</code></pre></div>
<p><strong>Note</strong> that it is able to read from both if the absolute path is more specific - i.e. if the absolute path is under <code>/home</code></p>
<p><code>bin/wasmtime --dir=. --dir=/home target/wasm32-wasi/release/bug_demo.wasm ${PWD}/file1.txt</code><br>
will successfully read and print both files </p>
<h3>Expected Results</h3>
<p>It should read and output content from both files</p>
<h3>Actual Results</h3>
<p>Depending on the order or dir args, runtime is able to locate one or the other</p>
<h3>Versions and Environment</h3>
<p>cargo component 0.8.0</p>
<p>Wasmtime version or commit: 17.0.0 <br>
(wasmtime binary I am using is in the zip file attached above)</p>
<p>Operating system: ubuntu20</p>
<p>Architecture: x86_64</p>
<h3>Extra Info</h3>
<p>Anything else you'd like to add?<br>
</p>
</blockquote>



<a name="429547094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238068%20wasmtime%20cli%20only%20taking%20the%20last%20.../near/429547094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238068.20wasmtime.20cli.20only.20taking.20the.20last.20.2E.2E.2E.html#429547094">(Mar 26 2024 at 03:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8068#issuecomment-2019308003">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8068">issue #8068</a>:</p>
<blockquote>
<p>Closing in favor of <a href="https://github.com/WebAssembly/wasi-libc/issues/484">https://github.com/WebAssembly/wasi-libc/issues/484</a> as I believe this is a wasi-libc issue</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>