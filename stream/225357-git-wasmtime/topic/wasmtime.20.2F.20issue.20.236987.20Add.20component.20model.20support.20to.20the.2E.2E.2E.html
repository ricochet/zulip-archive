<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6987 Add component model support to the... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html">wasmtime / issue #6987 Add component model support to the...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="390086699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390086699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390086699">(Sep 10 2023 at 02:07)</a>:</h4>
<p>seanisom opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Add component model support to the c-api (particularly the ability run a component from a c-api host). </p>
<h4>Benefit</h4>
<p>Much of the WebAssembly world is currently (re)tooling around the component model as it approaches MVP. The ability to run components will quickly become more critical with the finalization of the wasi preview 2 abi. Currently C/C++ is the only <code>wit-bindgen</code> supported guest language and example in the new <code>component-docs</code> repo that does not have a path to run from a host in the same language.</p>
<h4>Implementation</h4>
<p>I'd be happy to take a go at this modeled roughly around the Rust crate with the current c-api idioms (for example <code>wasmtime_config_wasm_component_model(conf, true);</code>, a component aware linker (perhaps <code>wasmtime_linker_define_component_model(linker);</code>), etc. I haven't looked deep enough into the implementation yet to see if there is significant core functionality to enable this past the standard glue code and lifecycle management for c objects.</p>
<h4>Alternatives</h4>
<p>Eventually this will become necessary  - it's a matter of timing. I suspect that this has just not yet been implemented due to the instability of <code>wasmtime::component</code>.</p>
<p>CC: Discussed with @sunfishcode at the BA hackathon<br>
</p>
</blockquote>



<a name="390091747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390091747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390091747">(Sep 10 2023 at 03:12)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/6987#issuecomment-1712697612">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<p>The Nginx Unit team is also interested in this</p>
</blockquote>



<a name="390116708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390116708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390116708">(Sep 10 2023 at 08:12)</a>:</h4>
<p>seanisom edited <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Add component model support to the c-api (particularly the ability run a component from a c-api host). </p>
<h4>Benefit</h4>
<p>Much of the WebAssembly world is currently (re)tooling around the component model as it approaches MVP. The ability to run components will quickly become more critical with the finalization of the wasi preview 2 abi. Currently C/C++ is the largest fully-supported language with a clear path to producing guests (through <code>wit-bindgen</code>) that does not have a path to run from a host in the same language.</p>
<h4>Implementation</h4>
<p>I can take a first step with this modeled roughly around the Rust crate with the current c-api idioms (for example <code>wasmtime_config_wasm_component_model(conf, true);</code>, a component aware linker (perhaps <code>wasmtime_linker_define_component_model(linker);</code>), etc. I haven't looked deep enough into the implementation yet to see if there is significant core functionality to enable this past the standard glue code and lifecycle management for c objects.</p>
<h4>Alternatives</h4>
<p>Eventually this will become necessary  - it's a matter of timing. I suspect that this has just not yet been implemented due to the instability of <code>wasmtime::component</code>.</p>
<p>CC: Discussed with @sunfishcode at the BA hackathon<br>
</p>
</blockquote>



<a name="390116725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390116725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390116725">(Sep 10 2023 at 08:12)</a>:</h4>
<p>seanisom edited <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Add component model support to the c-api (particularly the ability run a component from a c-api host). </p>
<h4>Benefit</h4>
<p>Much of the WebAssembly world is currently (re)tooling around the component model as it approaches MVP. The ability to run components will quickly become more critical with the finalization of the wasi preview 2 abi. Currently C/C++ is the largest fully-supported language with a clear path to producing guests (through <code>wit-bindgen</code>) that does not have a path to run from a host in the same language.</p>
<h4>Implementation</h4>
<p>I can take a first pass at this modeled roughly around the Rust crate with the current c-api idioms (for example <code>wasmtime_config_wasm_component_model(conf, true);</code>, a component aware linker (perhaps <code>wasmtime_linker_define_component_model(linker);</code>), etc. I haven't looked deep enough into the implementation yet to see if there is significant core functionality to enable this past the standard glue code and lifecycle management for c objects.</p>
<h4>Alternatives</h4>
<p>Eventually this will become necessary  - it's a matter of timing. I suspect that this has just not yet been implemented due to the instability of <code>wasmtime::component</code>.</p>
<p>CC: Discussed with @sunfishcode at the BA hackathon<br>
</p>
</blockquote>



<a name="390116772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390116772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390116772">(Sep 10 2023 at 08:13)</a>:</h4>
<p>seanisom edited <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Add component model support to the c-api (particularly the ability run a component from a c-api host). </p>
<h4>Benefit</h4>
<p>Much of the WebAssembly world is currently (re)tooling around the component model as it approaches MVP. The ability to run components will quickly become more critical with the finalization of the wasi preview 2 abi. Currently C/C++ is the largest fully-supported language with a clear path to producing component guests (through <code>wit-bindgen</code>) that does not have a path to run from a host in the same language.</p>
<h4>Implementation</h4>
<p>I can take a first pass at this modeled roughly around the Rust crate with the current c-api idioms (for example <code>wasmtime_config_wasm_component_model(conf, true);</code>, a component aware linker (perhaps <code>wasmtime_linker_define_component_model(linker);</code>), etc. I haven't looked deep enough into the implementation yet to see if there is significant core functionality to enable this past the standard glue code and lifecycle management for c objects.</p>
<h4>Alternatives</h4>
<p>Eventually this will become necessary  - it's a matter of timing. I suspect that this has just not yet been implemented due to the instability of <code>wasmtime::component</code>.</p>
<p>CC: Discussed with @sunfishcode at the BA hackathon<br>
</p>
</blockquote>



<a name="390374085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390374085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390374085">(Sep 11 2023 at 19:21)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasmtime:c-api label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">Issue #6987</a>.</p>



<a name="390374087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390374087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390374087">(Sep 11 2023 at 19:21)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:component-model label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">Issue #6987</a>.</p>



<a name="390374198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390374198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390374198">(Sep 11 2023 at 19:22)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/issues/6987#issuecomment-1714449944">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:c-api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:c-api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="390374907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/390374907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#390374907">(Sep 11 2023 at 19:28)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6987#issuecomment-1714457328">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<p>Thanks for opening an issue for this! You're right in that this hasn't quite bubbled to the top of any priority list yet which is why it isn't done, but it's something that definitely should get done!</p>
<p>My prediction for the main difficulty of this feature will be how to transfer values back and forth. The type grammar of core wasm is quite simple which made this a non-issue for core wasm's C API support, but for components it's significantly different. The easiest route is probably going to be to mirror <a href="https://docs.rs/wasmtime/latest/wasmtime/component/enum.Val.html"><code>Val</code></a> into C more-or-less. This will not be really all that efficient in terms of calls because datatypes like lists will be copied in/out and everything will be dynamically type-checked. For example I don't know how <code>wasmtime_func_call_unchecked</code> could get a C/C++ equivalent that skips all the type-checks. That's not a showstopper for any sort of initial support, however. Still though there's tricky questions around how exactly memory management will work with values. I'm not sure the best answer here.</p>
<p>More minor it might be worth bikeshedding a bit to avoid a <code>wasmtime_component_*</code> prefix on everything which is quite long. Not that I have much of an idea about a better name...</p>
</blockquote>



<a name="467659707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236987%20Add%20component%20model%20support%20to%20the.../near/467659707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236987.20Add.20component.20model.20support.20to.20the.2E.2E.2E.html#467659707">(Sep 04 2024 at 21:03)</a>:</h4>
<p>rajsite <a href="https://github.com/bytecodealliance/wasmtime/issues/6987#issuecomment-2330092184">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6987">issue #6987</a>:</p>
<blockquote>
<p>related #8036 </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>