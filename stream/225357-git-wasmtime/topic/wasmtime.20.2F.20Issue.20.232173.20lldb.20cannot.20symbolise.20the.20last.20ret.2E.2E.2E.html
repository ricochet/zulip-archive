<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2173 lldb cannot symbolise the last ret... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html">wasmtime / Issue #2173 lldb cannot symbolise the last ret...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="208434128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434128">(Aug 29 2020 at 13:31)</a>:</h4>
<p>ggreif opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
</blockquote>



<a name="208434129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434129">(Aug 29 2020 at 13:31)</a>:</h4>
<p>ggreif labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
</blockquote>



<a name="208434207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434207">(Aug 29 2020 at 13:33)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
<p>For completeness, here is the <code>wasmtime</code> patch I mentioned:</p>
<div class="codehilite"><pre><span></span><code>$ git diff
<span class="gh">diff --git a/crates/debug/src/transform/address_transform.rs b/crates/debug/src/transform/address_transform.rs</span>
<span class="gh">index 43bfc0b63..da7ae36f0 100644</span>
<span class="gd">--- a/crates/debug/src/transform/address_transform.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/address_transform.rs</span>
<span class="gu">@@ -219,6 +219,7 @@ fn build_function_addr_map(</span>
             addresses: fn_map.into_boxed_slice(),
         });
     }
<span class="gi">+    println!(&quot;map: {:?}&quot;, map);</span>
     map
 }
</code></pre></div>


</blockquote>



<a name="208434302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434302">(Aug 29 2020 at 13:34)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683290912">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Maybe a duplicate of <a href="https://github.com/bytecodealliance/wasmtime/issues/1145">https://github.com/bytecodealliance/wasmtime/issues/1145</a>?</p>
</blockquote>



<a name="208434386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434386">(Aug 29 2020 at 13:36)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How can this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
<p>For completeness, here is the <code>wasmtime</code> patch I mentioned:</p>
<div class="codehilite"><pre><span></span><code>$ git diff
<span class="gh">diff --git a/crates/debug/src/transform/address_transform.rs b/crates/debug/src/transform/address_transform.rs</span>
<span class="gh">index 43bfc0b63..da7ae36f0 100644</span>
<span class="gd">--- a/crates/debug/src/transform/address_transform.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/address_transform.rs</span>
<span class="gu">@@ -219,6 +219,7 @@ fn build_function_addr_map(</span>
             addresses: fn_map.into_boxed_slice(),
         });
     }
<span class="gi">+    println!(&quot;map: {:?}&quot;, map);</span>
     map
 }
</code></pre></div>


</blockquote>



<a name="208434942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208434942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208434942">(Aug 29 2020 at 13:51)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683292832">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>@bjorn3 possibly. At least it is not related to the DWARF <code>epilogue_begin</code> indication, since the function doesn't carry one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span><span class="kt">:</span>    <span class="n">file</span> <span class="n">format</span> <span class="kt">ELF64</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x0000007c</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000024</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">mod_time</span><span class="kt">:</span> <span class="mh">0x00000000</span>
         <span class="n">length</span><span class="kt">:</span> <span class="mh">0x00000000</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000000</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000026</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002b</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000030</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000035</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003a</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000050</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000055</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005a</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000005f</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000064</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000069</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000082</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000084</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


</blockquote>



<a name="208435007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208435007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208435007">(Aug 29 2020 at 13:52)</a>:</h4>
<p>ggreif edited <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> f1a5e55b981f141780912dfb40881cb3891d0466 <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How can this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
<p>For completeness, here is the <code>wasmtime</code> patch I mentioned:</p>
<div class="codehilite"><pre><span></span><code>$ git diff
<span class="gh">diff --git a/crates/debug/src/transform/address_transform.rs b/crates/debug/src/transform/address_transform.rs</span>
<span class="gh">index 43bfc0b63..da7ae36f0 100644</span>
<span class="gd">--- a/crates/debug/src/transform/address_transform.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/address_transform.rs</span>
<span class="gu">@@ -219,6 +219,7 @@ fn build_function_addr_map(</span>
             addresses: fn_map.into_boxed_slice(),
         });
     }
<span class="gi">+    println!(&quot;map: {:?}&quot;, map);</span>
     map
 }
</code></pre></div>


</blockquote>



<a name="208438294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208438294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208438294">(Aug 29 2020 at 15:07)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683302662">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
</code></pre></div>


<p>that is offset <code>0x8d</code>, which is exactly the end of the line program. I think it needs to continue until the end of the last instruction, not the start.</p>
</blockquote>



<a name="208440654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208440654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208440654">(Aug 29 2020 at 15:58)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683308786">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Ha, this. is a good point, indeed, I wanted to post the wasm's DWARF line program, but I slipped, and above I posted the <code>wasmtime wasm2obj</code>'s line table. Below is the untranslated one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span><span class="kt">:</span> <span class="n">file</span> <span class="n">format</span> <span class="kt">WASM</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x00000094</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">5</span>
    <span class="n">address_size</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">seg_select_size</span><span class="kt">:</span> <span class="mi">0</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000037</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">0</span>
   <span class="n">md5_checksum</span><span class="kt">:</span> <span class="mi">3444</span><span class="n">f0aa42db6d50ac2e4e57ac752c75</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000003</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000028</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002f</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000036</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000003d</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000004f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005e</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000006e</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000007c</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000083</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008a</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000091</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000a6</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000bf</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c1</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c3</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000ca</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000ce</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>The disassembly follows</p>
<div class="codehilite"><pre><span></span><code><span class="nf">$</span> <span class="no">llvm-objdump</span> <span class="p">.</span><span class="err">/</span><span class="no">fib-wasm-dwarf5.wasm</span> <span class="p">--</span><span class="no">disassemble</span>

<span class="err">./</span><span class="nl">fib-wasm-dwarf5.wasm:</span> <span class="nf">file</span> <span class="no">format</span> <span class="no">WASM</span>


<span class="nf">Disassembly</span> <span class="no">of</span> <span class="no">section</span> <span class="no">CODE</span><span class="p">:</span>

<span class="err">00000000</span> <span class="nl">CODE:</span>
        <span class="c1"># 1 functions in section.</span>
       <span class="err">1:</span> <span class="nf">cb</span>                            <span class="err">&lt;</span><span class="no">unknown</span><span class="err">&gt;</span>
       <span class="err">2:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">3:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">4:</span> <span class="err">15</span>                            <span class="err">&lt;</span><span class="nf">unknown</span><span class="err">&gt;</span>
       <span class="err">5:</span> <span class="err">7</span><span class="nf">f</span>                            <span class="no">i64.div_s</span>
       <span class="err">6:</span> <span class="err">23</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">00</span>             <span class="nf">global.get</span>  <span class="mi">0</span>
       <span class="nl">c:</span> <span class="err">21</span> <span class="err">01</span>                         <span class="nf">local.set</span>   <span class="mi">1</span>
       <span class="nl">e:</span> <span class="err">41</span> <span class="err">20</span>                         <span class="nf">i32.const</span>   <span class="mi">32</span>
      <span class="err">10:</span> <span class="err">21</span> <span class="err">02</span>                         <span class="nf">local.set</span>   <span class="mi">2</span>
<span class="err">&lt;</span><span class="nf">snip</span><span class="err">&gt;</span>
      <span class="nl">bc:</span> <span class="err">36</span> <span class="err">02</span> <span class="err">0</span><span class="nf">c</span>                      <span class="no">i32.store</span>   <span class="mi">12</span>
      <span class="nl">bf:</span> <span class="err">0</span><span class="nf">c</span> <span class="mi">00</span>                         <span class="no">br</span>          <span class="mi">0</span>
      <span class="nl">c1:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c2:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c3:</span> <span class="err">20</span> <span class="err">03</span>                         <span class="nf">local.get</span>   <span class="mi">3</span>
      <span class="nl">c5:</span> <span class="err">28</span> <span class="err">02</span> <span class="err">10</span>                      <span class="nf">i32.load</span>    <span class="mi">16</span>
      <span class="nl">c8:</span> <span class="err">21</span> <span class="err">15</span>                         <span class="nf">local.set</span>   <span class="mi">21</span>
      <span class="nl">ca:</span> <span class="err">20</span> <span class="err">15</span>                         <span class="nf">local.get</span>   <span class="mi">21</span>
      <span class="nl">cc:</span> <span class="err">0</span><span class="nf">f</span>                            <span class="no">return</span>
      <span class="nl">cd:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
</code></pre></div>


</blockquote>



<a name="208440915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208440915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208440915">(Aug 29 2020 at 16:03)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683308786">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Ha, this is a good point, indeed, I wanted to post the wasm's DWARF line program, but I slipped, and above I posted the <code>wasmtime wasm2obj</code>'s line table. <code>end_sequence</code> should belong to the offset <code>0x8e</code>, thanks for spotting! So can we assume that the Lina table is. wrongly emitted by <code>wasmtime</code>? Or is that <code>gimli</code>'s job?</p>
<p>Below is the untranslated one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span><span class="kt">:</span> <span class="n">file</span> <span class="n">format</span> <span class="kt">WASM</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x00000094</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">5</span>
    <span class="n">address_size</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">seg_select_size</span><span class="kt">:</span> <span class="mi">0</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000037</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">0</span>
   <span class="n">md5_checksum</span><span class="kt">:</span> <span class="mi">3444</span><span class="n">f0aa42db6d50ac2e4e57ac752c75</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000003</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000028</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002f</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000036</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000003d</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000004f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005e</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000006e</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000007c</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000083</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008a</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000091</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000a6</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000bf</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c1</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c3</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000ca</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000ce</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>The disassembly follows</p>
<div class="codehilite"><pre><span></span><code><span class="nf">$</span> <span class="no">llvm-objdump</span> <span class="p">.</span><span class="err">/</span><span class="no">fib-wasm-dwarf5.wasm</span> <span class="p">--</span><span class="no">disassemble</span>

<span class="err">./</span><span class="nl">fib-wasm-dwarf5.wasm:</span> <span class="nf">file</span> <span class="no">format</span> <span class="no">WASM</span>


<span class="nf">Disassembly</span> <span class="no">of</span> <span class="no">section</span> <span class="no">CODE</span><span class="p">:</span>

<span class="err">00000000</span> <span class="nl">CODE:</span>
        <span class="c1"># 1 functions in section.</span>
       <span class="err">1:</span> <span class="nf">cb</span>                            <span class="err">&lt;</span><span class="no">unknown</span><span class="err">&gt;</span>
       <span class="err">2:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">3:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">4:</span> <span class="err">15</span>                            <span class="err">&lt;</span><span class="nf">unknown</span><span class="err">&gt;</span>
       <span class="err">5:</span> <span class="err">7</span><span class="nf">f</span>                            <span class="no">i64.div_s</span>
       <span class="err">6:</span> <span class="err">23</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">00</span>             <span class="nf">global.get</span>  <span class="mi">0</span>
       <span class="nl">c:</span> <span class="err">21</span> <span class="err">01</span>                         <span class="nf">local.set</span>   <span class="mi">1</span>
       <span class="nl">e:</span> <span class="err">41</span> <span class="err">20</span>                         <span class="nf">i32.const</span>   <span class="mi">32</span>
      <span class="err">10:</span> <span class="err">21</span> <span class="err">02</span>                         <span class="nf">local.set</span>   <span class="mi">2</span>
<span class="err">&lt;</span><span class="nf">snip</span><span class="err">&gt;</span>
      <span class="nl">bc:</span> <span class="err">36</span> <span class="err">02</span> <span class="err">0</span><span class="nf">c</span>                      <span class="no">i32.store</span>   <span class="mi">12</span>
      <span class="nl">bf:</span> <span class="err">0</span><span class="nf">c</span> <span class="mi">00</span>                         <span class="no">br</span>          <span class="mi">0</span>
      <span class="nl">c1:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c2:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c3:</span> <span class="err">20</span> <span class="err">03</span>                         <span class="nf">local.get</span>   <span class="mi">3</span>
      <span class="nl">c5:</span> <span class="err">28</span> <span class="err">02</span> <span class="err">10</span>                      <span class="nf">i32.load</span>    <span class="mi">16</span>
      <span class="nl">c8:</span> <span class="err">21</span> <span class="err">15</span>                         <span class="nf">local.set</span>   <span class="mi">21</span>
      <span class="nl">ca:</span> <span class="err">20</span> <span class="err">15</span>                         <span class="nf">local.get</span>   <span class="mi">21</span>
      <span class="nl">cc:</span> <span class="err">0</span><span class="nf">f</span>                            <span class="no">return</span>
      <span class="nl">cd:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
</code></pre></div>


</blockquote>



<a name="208441002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208441002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208441002">(Aug 29 2020 at 16:05)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683292832">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>@bjorn3 possibly. At least it is not related to the DWARF <code>epilogue_begin</code> indication, since the function doesn't carry one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span><span class="kt">:</span>    <span class="n">file</span> <span class="n">format</span> <span class="kt">ELF64</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x0000007c</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000024</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">mod_time</span><span class="kt">:</span> <span class="mh">0x00000000</span>
         <span class="n">length</span><span class="kt">:</span> <span class="mh">0x00000000</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000000</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000026</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002b</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000030</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000035</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003a</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000050</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000055</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005a</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000005f</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000064</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000069</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000082</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000084</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>As @bjorn3 notes below, the last two lines should be</p>
<div class="codehilite"><pre><span></span><code><span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008e</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


</blockquote>



<a name="208441169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208441169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208441169">(Aug 29 2020 at 16:08)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683292832">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>@bjorn3 possibly. At least it is not related to the DWARF <code>epilogue_begin</code> indication, since the function doesn't carry one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span><span class="kt">:</span>    <span class="n">file</span> <span class="n">format</span> <span class="kt">ELF64</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x0000007c</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000024</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">mod_time</span><span class="kt">:</span> <span class="mh">0x00000000</span>
         <span class="n">length</span><span class="kt">:</span> <span class="mh">0x00000000</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000000</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000026</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002b</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000030</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000035</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003a</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000050</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000055</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005a</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000005f</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000064</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000069</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000082</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000084</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>As @bjorn3 notes below, the last two lines should be</p>
<div class="codehilite"><pre><span></span><code><span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008e</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>and thus in sync with <code>FunctionMap { offset: 0, len: 142, ...</code><br>
So this line table comes from <code>wasm2obj</code> and it is already buggy.</p>
</blockquote>



<a name="208441251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208441251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208441251">(Aug 29 2020 at 16:10)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683292832">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>@bjorn3 possibly. At least it is not related to the DWARF <code>epilogue_begin</code> indication, since the function doesn't carry one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">o</span><span class="kt">:</span>    <span class="n">file</span> <span class="n">format</span> <span class="kt">ELF64</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x0000007c</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000024</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">1</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">mod_time</span><span class="kt">:</span> <span class="mh">0x00000000</span>
         <span class="n">length</span><span class="kt">:</span> <span class="mh">0x00000000</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000000</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000026</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002b</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000030</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000035</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003a</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000003f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000050</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000055</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005a</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000005f</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000064</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000069</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000082</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000084</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<h3>Addendum</h3>
<p>As @bjorn3 notes below, the last two lines should be</p>
<div class="codehilite"><pre><span></span><code><span class="mh">0x000000000000008d</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008e</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">1</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>and thus in sync with <code>FunctionMap { offset: 0, len: 142, ...</code><br>
So this line table comes from <code>wasm2obj</code> and it is already buggy.</p>
<p>I am checking these next:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">end_sequence</span><span class="w"></span>
<span class="n">crates</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">line_program</span><span class="p">.</span><span class="n">rs</span>:                <span class="nc">if</span><span class="w"> </span><span class="n">row</span><span class="p">.</span><span class="n">end_sequence</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">crates</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">line_program</span><span class="p">.</span><span class="n">rs</span>:            <span class="nc">let</span><span class="w"> </span><span class="n">saved_row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">row</span><span class="p">.</span><span class="n">end_sequence</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">crates</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">line_program</span><span class="p">.</span><span class="n">rs</span>:            <span class="nc">out_program</span><span class="p">.</span><span class="n">end_sequence</span><span class="p">(</span><span class="n">end_addr</span><span class="p">);</span><span class="w"></span>
<span class="n">crates</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">transform</span><span class="o">/</span><span class="n">simulate</span><span class="p">.</span><span class="n">rs</span>:        <span class="nc">out_program</span><span class="p">.</span><span class="n">end_sequence</span><span class="p">(</span><span class="n">end_addr</span><span class="p">);</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="208441500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208441500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208441500">(Aug 29 2020 at 16:16)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683310870">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Wasmtime determines the content of the line program, gimli then encodes it in the DWARF format. I think removing the <code>- 1</code> from the following line will fix the problem: <a href="https://github.com/bytecodealliance/wasmtime/blob/79f054f77f2edf84ff9b46b1e0ad57a423e6727b/crates/debug/src/transform/line_program.rs#L274">https://github.com/bytecodealliance/wasmtime/blob/79f054f77f2edf84ff9b46b1e0ad57a423e6727b/crates/debug/src/transform/line_program.rs#L274</a></p>
</blockquote>



<a name="208441873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208441873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208441873">(Aug 29 2020 at 16:25)</a>:</h4>
<p>ggreif edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683308786">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Ha, this is a good point, indeed, I wanted to post the wasm's DWARF line program, but I slipped, and above I posted the <code>wasmtime wasm2obj</code>'s line table. <code>end_sequence</code> should belong to the offset <code>0x8e</code>, thanks for spotting! So can we assume that the line table is wrongly emitted by <code>wasmtime</code>? Or is that <code>gimli</code>'s job?</p>
<p>Below is the untranslated one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$</span> <span class="n">llvm</span><span class="o">-</span><span class="n">dwarfdump</span> <span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span> <span class="o">-</span><span class="n">debug</span><span class="o">-</span><span class="n">line</span>
<span class="o">./</span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="o">.</span><span class="n">wasm</span><span class="kt">:</span> <span class="n">file</span> <span class="n">format</span> <span class="kt">WASM</span>

<span class="o">.</span><span class="n">debug_line</span> <span class="n">contents</span><span class="kt">:</span>
<span class="nf">debug_line</span><span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span>
<span class="kt">Line</span> <span class="n">table</span> <span class="n">prologue</span><span class="kt">:</span>
    <span class="n">total_length</span><span class="kt">:</span> <span class="mh">0x00000094</span>
         <span class="n">version</span><span class="kt">:</span> <span class="mi">5</span>
    <span class="n">address_size</span><span class="kt">:</span> <span class="mi">4</span>
 <span class="n">seg_select_size</span><span class="kt">:</span> <span class="mi">0</span>
 <span class="n">prologue_length</span><span class="kt">:</span> <span class="mh">0x00000037</span>
 <span class="n">min_inst_length</span><span class="kt">:</span> <span class="mi">1</span>
<span class="nf">max_ops_per_inst</span><span class="kt">:</span> <span class="mi">1</span>
 <span class="n">default_is_stmt</span><span class="kt">:</span> <span class="mi">1</span>
       <span class="n">line_base</span><span class="kt">:</span> <span class="o">-</span><span class="mi">5</span>
      <span class="n">line_range</span><span class="kt">:</span> <span class="mi">14</span>
     <span class="n">opcode_base</span><span class="kt">:</span> <span class="mi">13</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_copy</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_advance_line</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_file</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_column</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_negate_stmt</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_basic_block</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_const_add_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_fixed_advance_pc</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_prologue_end</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_epilogue_begin</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">standard_opcode_lengths</span><span class="p">[</span><span class="kt">DW_LNS_set_isa</span><span class="p">]</span> <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">include_directories</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span> <span class="ow">=</span> <span class="s">&quot;.&quot;</span>
<span class="nf">file_names</span><span class="p">[</span>  <span class="mi">0</span><span class="p">]</span><span class="kt">:</span>
           <span class="n">name</span><span class="kt">:</span> <span class="s">&quot;fib-wasm.c&quot;</span>
      <span class="n">dir_index</span><span class="kt">:</span> <span class="mi">0</span>
   <span class="n">md5_checksum</span><span class="kt">:</span> <span class="mi">3444</span><span class="n">f0aa42db6d50ac2e4e57ac752c75</span>

<span class="kt">Address</span>            <span class="kt">Line</span>   <span class="kt">Column</span> <span class="kt">File</span>   <span class="kt">ISA</span> <span class="kt">Discriminator</span> <span class="kt">Flags</span>
<span class="c1">------------------ ------ ------ ------ --- ------------- -------------</span>
<span class="mh">0x0000000000000003</span>      <span class="mi">8</span>      <span class="mi">0</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000028</span>      <span class="mi">9</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span> <span class="n">prologue_end</span>
<span class="mh">0x000000000000002f</span>      <span class="mi">9</span>     <span class="mi">17</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000036</span>     <span class="mi">10</span>     <span class="mi">12</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x000000000000003d</span>     <span class="mi">10</span>     <span class="mi">19</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x0000000000000048</span>     <span class="mi">10</span>     <span class="mi">23</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000004f</span>     <span class="mi">10</span>     <span class="mi">21</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000005e</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000006e</span>     <span class="mi">11</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000075</span>     <span class="mi">11</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000007c</span>     <span class="mi">12</span>      <span class="mi">9</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000083</span>     <span class="mi">12</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x000000000000008a</span>     <span class="mi">13</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x0000000000000091</span>     <span class="mi">13</span>      <span class="mi">7</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000a6</span>     <span class="mi">10</span>     <span class="mi">27</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000bf</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c1</span>     <span class="mi">10</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000c3</span>     <span class="mi">15</span>     <span class="mi">10</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">is_stmt</span>
<span class="mh">0x00000000000000ca</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>
<span class="mh">0x00000000000000ce</span>     <span class="mi">15</span>      <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>             <span class="mi">0</span>  <span class="n">end_sequence</span>
</code></pre></div>


<p>The disassembly follows</p>
<div class="codehilite"><pre><span></span><code><span class="nf">$</span> <span class="no">llvm-objdump</span> <span class="p">.</span><span class="err">/</span><span class="no">fib-wasm-dwarf5.wasm</span> <span class="p">--</span><span class="no">disassemble</span>

<span class="err">./</span><span class="nl">fib-wasm-dwarf5.wasm:</span> <span class="nf">file</span> <span class="no">format</span> <span class="no">WASM</span>


<span class="nf">Disassembly</span> <span class="no">of</span> <span class="no">section</span> <span class="no">CODE</span><span class="p">:</span>

<span class="err">00000000</span> <span class="nl">CODE:</span>
        <span class="c1"># 1 functions in section.</span>
       <span class="err">1:</span> <span class="nf">cb</span>                            <span class="err">&lt;</span><span class="no">unknown</span><span class="err">&gt;</span>
       <span class="err">2:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">3:</span> <span class="err">01</span>                            <span class="nf">nop</span>
       <span class="err">4:</span> <span class="err">15</span>                            <span class="err">&lt;</span><span class="nf">unknown</span><span class="err">&gt;</span>
       <span class="err">5:</span> <span class="err">7</span><span class="nf">f</span>                            <span class="no">i64.div_s</span>
       <span class="err">6:</span> <span class="err">23</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">80</span> <span class="err">00</span>             <span class="nf">global.get</span>  <span class="mi">0</span>
       <span class="nl">c:</span> <span class="err">21</span> <span class="err">01</span>                         <span class="nf">local.set</span>   <span class="mi">1</span>
       <span class="nl">e:</span> <span class="err">41</span> <span class="err">20</span>                         <span class="nf">i32.const</span>   <span class="mi">32</span>
      <span class="err">10:</span> <span class="err">21</span> <span class="err">02</span>                         <span class="nf">local.set</span>   <span class="mi">2</span>
<span class="err">&lt;</span><span class="nf">snip</span><span class="err">&gt;</span>
      <span class="nl">bc:</span> <span class="err">36</span> <span class="err">02</span> <span class="err">0</span><span class="nf">c</span>                      <span class="no">i32.store</span>   <span class="mi">12</span>
      <span class="nl">bf:</span> <span class="err">0</span><span class="nf">c</span> <span class="mi">00</span>                         <span class="no">br</span>          <span class="mi">0</span>
      <span class="nl">c1:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c2:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
      <span class="nl">c3:</span> <span class="err">20</span> <span class="err">03</span>                         <span class="nf">local.get</span>   <span class="mi">3</span>
      <span class="nl">c5:</span> <span class="err">28</span> <span class="err">02</span> <span class="err">10</span>                      <span class="nf">i32.load</span>    <span class="mi">16</span>
      <span class="nl">c8:</span> <span class="err">21</span> <span class="err">15</span>                         <span class="nf">local.set</span>   <span class="mi">21</span>
      <span class="nl">ca:</span> <span class="err">20</span> <span class="err">15</span>                         <span class="nf">local.get</span>   <span class="mi">21</span>
      <span class="nl">cc:</span> <span class="err">0</span><span class="nf">f</span>                            <span class="no">return</span>
      <span class="nl">cd:</span> <span class="err">0</span><span class="nf">b</span>                            <span class="no">end</span>
</code></pre></div>


</blockquote>



<a name="208442277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208442277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208442277">(Aug 29 2020 at 16:33)</a>:</h4>
<p>ggreif <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683312815">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>@bjorn3 Indeed, now I get</p>
<div class="codehilite"><pre><span></span><code><span class="mh">0x000000000000008d</span><span class="w">     </span><span class="mi">15</span><span class="w">      </span><span class="mi">3</span><span class="w">      </span><span class="mi">1</span><span class="w">   </span><span class="mi">0</span><span class="w">             </span><span class="mi">0</span><span class="w"></span>
<span class="mh">0x000000000000008e</span><span class="w">     </span><span class="mi">15</span><span class="w">      </span><span class="mi">3</span><span class="w">      </span><span class="mi">1</span><span class="w">   </span><span class="mi">0</span><span class="w">             </span><span class="mi">0</span><span class="w">  </span><span class="n">end_sequence</span><span class="w"></span>
</code></pre></div>


<p>Thanks for the fix. Do you care to file a PR?</p>
</blockquote>



<a name="208442398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/208442398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#208442398">(Aug 29 2020 at 16:35)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2173#issuecomment-683313117">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>Opened #2174.</p>
</blockquote>



<a name="209296832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232173%20lldb%20cannot%20symbolise%20the%20last%20ret.../near/209296832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232173.20lldb.20cannot.20symbolise.20the.20last.20ret.2E.2E.2E.html#209296832">(Sep 07 2020 at 13:41)</a>:</h4>
<p>yurydelendik closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2173">Issue #2173</a>:</p>
<blockquote>
<p>First off, this might be an <code>lldb</code> bug. But since that SW is a bit more mature, let's start here.<br>
I have a debugging session recorded:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>
<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">all</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">testsuite</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">lldb</span><span class="o">-</span><span class="mf">10.0.1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">lldb</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="o">../../../../</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">cache</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="o">-</span><span class="n">dwarf5</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">&quot;../../../../target/debug/wasmtime&quot;</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">run</span><span class="o">-</span><span class="n">args</span><span class="w">  </span><span class="s">&quot;--disable-cache&quot;</span><span class="w"> </span><span class="s">&quot;-g&quot;</span><span class="w"> </span><span class="s">&quot;fib-wasm-dwarf5.wasm&quot;</span><span class="w"> </span><span class="s">&quot;--invoke&quot;</span><span class="w"> </span><span class="s">&quot;fib&quot;</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">fib</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">no</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span><span class="n">pending</span><span class="p">).</span><span class="w"></span>
<span class="n">WARNING</span>:  <span class="nc">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">launched</span>: <span class="err">&#39;</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ggreif</span><span class="o">/</span><span class="n">motoko</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"></span>
<span class="n">map</span>: <span class="nc">PrimaryMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">elems</span>: <span class="p">[</span><span class="n">FunctionMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span>: <span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_start</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wasm_end</span>: <span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span>: <span class="p">[</span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">4</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">6</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">22</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">29</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">37</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">38</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">44</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">51</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">58</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">63</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">67</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">74</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">91</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">102</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">75</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">108</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">112</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">121</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">126</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">135</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">140</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">147</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">156</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">163</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">168</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">181</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">125</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">188</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">191</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">132</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">197</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">AddressMap</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">generated</span>: <span class="mi">141</span><span class="p">,</span><span class="w"> </span><span class="n">wasm</span>: <span class="mi">204</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}],</span><span class="w"> </span><span class="n">unused</span>: <span class="nc">PhantomData</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>


<p>The above is just a dump of the translation map, I use <code>origin/main</code> f1a5e55b981f141780912dfb40881cb3891d0466 <code>wasmtime</code>, with this slight patch. Eyeballing doesn't seem to detect anything strange in it.</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">1.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e7026</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">9</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span><span class="w">    </span><span class="c1">//     -Wl,--no-entry,--export=fib -nostdlib -fdebug-prefix-map=$PWD=.</span>
<span class="w">   </span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span><span class="w">    </span><span class="n">int</span><span class="w"> </span><span class="n">fib</span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
-&gt; <span class="mi">9</span><span class="w">      </span><span class="n">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">10</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">11</span><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">disass</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
    <span class="mh">0x1040e7000</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7002</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">2</span><span class="o">&gt;</span>:   <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7005</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">5</span><span class="o">&gt;</span>:   <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7007</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span>:   <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e700d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x40</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7011</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">17</span><span class="o">&gt;</span>:  <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="o">-</span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7014</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ebx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">26</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ecx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">ecx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e701d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">29</span><span class="o">&gt;</span>:  <span class="nc">movq</span><span class="w">   </span><span class="mh">0x2c</span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">rsi</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7021</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
-&gt;  <span class="mh">0x1040e7026</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e702b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">43</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">ebx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7030</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7035</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">58</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x1c</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e703f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">63</span><span class="o">&gt;</span>:  <span class="nc">cmpl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7041</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span>:  <span class="nc">setl</span><span class="w">   </span><span class="o">%</span><span class="n">al</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7044</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">68</span><span class="o">&gt;</span>:  <span class="nc">movzbl</span><span class="w"> </span><span class="o">%</span><span class="n">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7048</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span>:  <span class="nc">andl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span>:  <span class="nc">testl</span><span class="w">  </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e704e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">78</span><span class="o">&gt;</span>:  <span class="nc">je</span><span class="w">     </span><span class="mh">0x1040e7084</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7050</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7055</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e705f</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">95</span><span class="o">&gt;</span>:  <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0x14</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7064</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">100</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x18</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7069</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e706e</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">110</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">edx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7070</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">112</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">edx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7075</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">117</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707a</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">122</span><span class="o">&gt;</span>: <span class="nc">addl</span><span class="w">   </span><span class="cp">$</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e707d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7082</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">130</span><span class="o">&gt;</span>: <span class="nc">jmp</span><span class="w">    </span><span class="mh">0x1040e7035</span><span class="w">               </span><span class="p">;</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">10</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7084</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">132</span><span class="o">&gt;</span>: <span class="nc">movl</span><span class="w">   </span><span class="mh">0x10</span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">,</span><span class="o">%</span><span class="n">rcx</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="n">eax</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7089</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">137</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbx</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708b</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">139</span><span class="o">&gt;</span>: <span class="nc">popq</span><span class="w">   </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mh">0x1040e708b</span><span class="w"></span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">resuming</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">break</span><span class="n">point</span><span class="w"> </span><span class="mf">2.1</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708b</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">   </span><span class="mi">12</span><span class="w">       </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">13</span><span class="w">       </span><span class="n">b</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">14</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
-&gt; <span class="mi">15</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">16</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708b</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">139</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">fib</span><span class="o">-</span><span class="n">wasm</span><span class="p">.</span><span class="n">c</span>:<span class="mi">15</span>:<span class="mi">10</span><span class="w"></span>
</code></pre></div>


<p>at this point all is fine, reverse mapping from <code>rip</code> to source works fine.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">ni</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">42125</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">&#39;com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instruction</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">over</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x00000001040e708d</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
<span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span>:
-&gt;  <span class="mh">0x1040e708d</span><span class="w"> </span><span class="o">&lt;+</span><span class="mi">141</span><span class="o">&gt;</span>: <span class="nc">retq</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e708e</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7090</span>:        <span class="nc">movq</span><span class="w">   </span><span class="o">%</span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">rbp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x1040e7093</span>:        <span class="nc">pushq</span><span class="w">  </span><span class="o">%</span><span class="n">r15</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>Now suddenly we find ourselves in assembly land. No mapping to source shown:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="n">rea</span><span class="w"> </span><span class="n">rip</span><span class="w"></span>
<span class="w">     </span><span class="n">rip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001040e708d</span><span class="w">  </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x10580d600</span><span class="p">)</span><span class="err">`</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">141</span><span class="w"></span>
</code></pre></div>


<p>How can this be debugged? Thankfully all ingredients are in the repo itself, so it should be easy to take a first step and reproduce.</p>
<p>@yurydelendik any tips?</p>
<p>For completeness, here is the <code>wasmtime</code> patch I mentioned:</p>
<div class="codehilite"><pre><span></span><code>$ git diff
<span class="gh">diff --git a/crates/debug/src/transform/address_transform.rs b/crates/debug/src/transform/address_transform.rs</span>
<span class="gh">index 43bfc0b63..da7ae36f0 100644</span>
<span class="gd">--- a/crates/debug/src/transform/address_transform.rs</span>
<span class="gi">+++ b/crates/debug/src/transform/address_transform.rs</span>
<span class="gu">@@ -219,6 +219,7 @@ fn build_function_addr_map(</span>
             addresses: fn_map.into_boxed_slice(),
         });
     }
<span class="gi">+    println!(&quot;map: {:?}&quot;, map);</span>
     map
 }
</code></pre></div>


</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>