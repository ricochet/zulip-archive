<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1669 machinst: reduce the number of memory... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html">wasmtime / PR #1669 machinst: reduce the number of memory...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="196671184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196671184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196671184">(May 06 2020 at 17:43)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin" title="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1669" title="https://github.com/bytecodealliance/wasmtime/pull/1669">PR #1669</a>.</p>



<a name="196671185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196671185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196671185">(May 06 2020 at 17:43)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1669" title="https://github.com/bytecodealliance/wasmtime/pull/1669">PR #1669</a> from <code>reduce-malloc</code> to <code>master</code>:</p>
<blockquote>
<p>This set of small changes in the code helps reducing the number of memory allocations, as reported by DHAT, during compilation of <code>regex-rs.wasm</code> with aarch64:</p>
<table>
<thead>
<tr>
<th></th>
<th>#bytes allocated</th>
<th>#blocks allocated</th>
<th>avg size of block</th>
</tr>
</thead>
<tbody>
<tr>
<td>Before</td>
<td>1 086 592 728</td>
<td>2 734 386</td>
<td>397,38</td>
</tr>
<tr>
<td>After</td>
<td>1 078 766 780</td>
<td>2 516 317</td>
<td>428,71</td>
</tr>
</tbody>
</table>
<p>So this represents an 8% reduction of the number of allocated memory blocks. This doesn't seem to show any compiler runtime performance improvement, but the whole programs compiles in less than 1.2 seconds on my machine, so it's a bit hard to distinguish what's noise and what's not.</p>
<p>Will need a <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> bump for <a href="https://github.com/bytecodealliance/regalloc.rs/pull/59" title="https://github.com/bytecodealliance/regalloc.rs/pull/59">https://github.com/bytecodealliance/regalloc.rs/pull/59</a>, so CI will fail.</p>
</blockquote>



<a name="196672303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196672303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196672303">(May 06 2020 at 17:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1669#pullrequestreview-406850020" title="https://github.com/bytecodealliance/wasmtime/pull/1669#pullrequestreview-406850020">PR Review</a>.</p>



<a name="196672304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196672304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196672304">(May 06 2020 at 17:51)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1669#pullrequestreview-406850020" title="https://github.com/bytecodealliance/wasmtime/pull/1669#pullrequestreview-406850020">PR Review</a>.</p>



<a name="196672305"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196672305" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196672305">(May 06 2020 at 17:51)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1669#discussion_r420979463" title="https://github.com/bytecodealliance/wasmtime/pull/1669#discussion_r420979463">PR Review Comment</a>:</p>
<blockquote>
<p>tiny nit: s/which/whose/ (and below too)</p>
</blockquote>



<a name="196747865"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196747865" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196747865">(May 07 2020 at 09:47)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1669" title="https://github.com/bytecodealliance/wasmtime/pull/1669">PR #1669</a> from <code>reduce-malloc</code> to <code>master</code>:</p>
<blockquote>
<p>This set of small changes in the code helps reducing the number of memory allocations, as reported by DHAT, during compilation of <code>regex-rs.wasm</code> with aarch64:</p>
<table>
<thead>
<tr>
<th></th>
<th>#bytes allocated</th>
<th>#blocks allocated</th>
<th>avg size of block</th>
</tr>
</thead>
<tbody>
<tr>
<td>Before</td>
<td>1 086 592 728</td>
<td>2 734 386</td>
<td>397,38</td>
</tr>
<tr>
<td>After</td>
<td>1 078 766 780</td>
<td>2 516 317</td>
<td>428,71</td>
</tr>
</tbody>
</table>
<p>So this represents an 8% reduction of the number of allocated memory blocks. This doesn't seem to show any compiler runtime performance improvement, but the whole programs compiles in less than 1.2 seconds on my machine, so it's a bit hard to distinguish what's noise and what's not.</p>
<p>Will need a <a href="http://regalloc.rs" title="http://regalloc.rs">regalloc.rs</a> bump for <a href="https://github.com/bytecodealliance/regalloc.rs/pull/59" title="https://github.com/bytecodealliance/regalloc.rs/pull/59">https://github.com/bytecodealliance/regalloc.rs/pull/59</a>, so CI will fail.</p>
</blockquote>



<a name="196751311"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231669%20machinst%3A%20reduce%20the%20number%20of%20memory.../near/196751311" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231669.20machinst.3A.20reduce.20the.20number.20of.20memory.2E.2E.2E.html#196751311">(May 07 2020 at 10:24)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1669" title="https://github.com/bytecodealliance/wasmtime/pull/1669">PR #1669</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>