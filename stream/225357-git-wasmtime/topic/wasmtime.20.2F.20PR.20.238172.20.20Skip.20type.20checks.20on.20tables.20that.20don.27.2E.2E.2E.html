<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8172  Skip type checks on tables that don&#x27;... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html">wasmtime / PR #8172  Skip type checks on tables that don&#x27;...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="427568346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427568346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427568346">(Mar 18 2024 at 20:23)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427568348"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427568348" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427568348">(Mar 18 2024 at 20:23)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427568349"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427568349" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427568349">(Mar 18 2024 at 20:23)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a> from <code>alexcrichton:remove-call-indirect-typecheck</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit implements an optimization to skip type checks in<br>
<code>call_indirect</code> for tables that don't require it. With the<br>
function-references proposal it's possible to have tables of a single<br>
type of function as opposed to today's default <code>funcref</code> which is a<br>
heterogenous set of functions. In this situation it's possible that a<br>
<code>call_indirect</code>'s type tag matches the type tag of a<br>
<code>table</code>-of-typed-<code>funcref</code>-values, meaning that it's impossible for the<br>
type check to fail.</p>
<p>The type check of a function pointer in <code>call_indirect</code> is refactored<br>
here to take the table's type into account. Various things are shuffled<br>
around to ensure that the right traps still show up in the right places<br>
but the important part is that, when possible, the type check is omitted<br>
entirely.</p>
</blockquote>



<a name="427568350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427568350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427568350">(Mar 18 2024 at 20:23)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427577948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427577948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427577948">(Mar 18 2024 at 21:28)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1944131959">PR review</a>:</p>
<blockquote>
<p>This makes sense to me! I really like the way you've restructured things with the <code>CheckIndirectCallTypeSignature</code> enum.</p>
</blockquote>



<a name="427577949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427577949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427577949">(Mar 18 2024 at 21:28)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1944131959">PR review</a>:</p>
<blockquote>
<p>This makes sense to me! I really like the way you've restructured things with the <code>CheckIndirectCallTypeSignature</code> enum.</p>
</blockquote>



<a name="427577950"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427577950" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427577950">(Mar 18 2024 at 21:28)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#discussion_r1529235474">PR review comment</a>:</p>
<blockquote>
<p>Extreme nit-pick:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                // succeeds then we know it won't match, so trap anyway.
</code></pre></div><br>
</p>
</blockquote>



<a name="427578488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427578488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427578488">(Mar 18 2024 at 21:32)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427578497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427578497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427578497">(Mar 18 2024 at 21:32)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427583456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427583456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427583456">(Mar 18 2024 at 22:08)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1944299981">PR review</a>.</p>



<a name="427583457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427583457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427583457">(Mar 18 2024 at 22:08)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1944299981">PR review</a>.</p>



<a name="427583458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427583458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427583458">(Mar 18 2024 at 22:08)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#discussion_r1529345284">PR review comment</a>:</p>
<blockquote>
<p>FWIW, when the GC proposal is enabled, the static immediate type on the <code>call_indirect</code> will be allowed to be a subtype of the actual function's type.</p>
<p>We don't implement this yet, but will need to.</p>
<p><a href="https://webassembly.github.io/gc/core/exec/instructions.html#exec-call-indirect">https://webassembly.github.io/gc/core/exec/instructions.html#exec-call-indirect</a></p>
</blockquote>



<a name="427584543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427584543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427584543">(Mar 18 2024 at 22:15)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8172">PR #8172</a>.</p>



<a name="427612966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427612966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427612966">(Mar 19 2024 at 03:16)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1945086748">PR review</a>.</p>



<a name="427612967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427612967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427612967">(Mar 19 2024 at 03:16)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#discussion_r1529631934">PR review comment</a>:</p>
<blockquote>
<p>Oh good point! I keep consistently forgetting that contra/covariance applies to params/results...</p>
<p>This makes me think we should remove the <code>PartialEq</code> implementation for types in wasmtime-types like we did in the embedder API as well</p>
</blockquote>



<a name="427756316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427756316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427756316">(Mar 19 2024 at 15:54)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#pullrequestreview-1946691562">PR review</a>.</p>



<a name="427756321"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238172%20%20Skip%20type%20checks%20on%20tables%20that%20don%27.../near/427756321" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238172.20.20Skip.20type.20checks.20on.20tables.20that.20don.27.2E.2E.2E.html#427756321">(Mar 19 2024 at 15:54)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8172#discussion_r1530660793">PR review comment</a>:</p>
<blockquote>
<p>Yeah that wouldn't be a bad idea.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>