<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5300 Cranelift: Add `heap_load` and `heap_... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html">wasmtime / PR #5300 Cranelift: Add `heap_load` and `heap_...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="310929613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310929613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310929613">(Nov 18 2022 at 22:02)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5300">PR #5300</a> from <code>heap-load-store</code> to <code>main</code>:</p>
<blockquote>
<p>As discussed in <a href="https://github.com/bytecodealliance/wasmtime/issues/5283">https://github.com/bytecodealliance/wasmtime/issues/5283</a>.</p>
<p>I intend to implement option (3) from that issue, but this PR doesn't actually add any legalization or backend lowerings yet, just interpreter support and a suite of tests.</p>
</blockquote>



<a name="310929616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310929616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310929616">(Nov 18 2022 at 22:02)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5300">PR #5300</a>.</p>



<a name="310930144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310930144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310930144">(Nov 18 2022 at 22:05)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186865502">PR review</a>.</p>



<a name="310930145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310930145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310930145">(Nov 18 2022 at 22:05)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026930523">PR review comment</a>:</p>
<blockquote>
<p>Not sure why this was needed but <code>rustc</code> started giving me failed-to-infer-types errors for this all of a sudden.</p>
</blockquote>



<a name="310930146"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310930146" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310930146">(Nov 18 2022 at 22:05)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186865502">PR review</a>.</p>



<a name="310933141"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310933141" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310933141">(Nov 18 2022 at 22:25)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186874265">PR review</a>.</p>



<a name="310933142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310933142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310933142">(Nov 18 2022 at 22:25)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026936046">PR review comment</a>:</p>
<blockquote>
<p>This is more than just a reference to a heap, right? It's (i) the heap reference, (ii) the access flags, and (iii) a fixed offset. Basically, everything needed for a heap load/store that is not an SSA value, if I understand right. Could we note that here?</p>
<p>Also let's note somewhere that this is a little different than other entities in CLIF: it isn't an explicitly-defined entity in the preamble (like <code>heap0 = ...</code> or <code>gv0 = ...</code>) but rather is logically a piece of an instruction (of <code>HeapLoad</code> or <code>HeapStore</code> format) and one is nominally created for each use-site (each instruction).</p>
</blockquote>



<a name="310933143"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310933143" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310933143">(Nov 18 2022 at 22:25)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026940445">PR review comment</a>:</p>
<blockquote>
<p>Why <code>saturating_add</code> here rather than e.g. <code>checked_add</code> with handling for the <code>None</code> case? I guess because these are <code>i128</code>s and not expected to actually saturate? If so could we do <code>.checked_add(...).expect("128-bit math should not overflow here")</code> or somesuch?</p>
</blockquote>



<a name="310933144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310933144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310933144">(Nov 18 2022 at 22:25)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186874265">PR review</a>.</p>



<a name="310933145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310933145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310933145">(Nov 18 2022 at 22:25)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026937208">PR review comment</a>:</p>
<blockquote>
<p>I've seen those come up when unrelated bits fail to typecheck; perplexing to me as well.</p>
<p>Now that things typecheck, though, could you try removing this?</p>
</blockquote>



<a name="310942471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942471">(Nov 18 2022 at 23:41)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186942934">PR review</a>.</p>



<a name="310942472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942472">(Nov 18 2022 at 23:41)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026976990">PR review comment</a>:</p>
<blockquote>
<p>So <code>heap_store</code> takes two <code>Value</code>s and a <code>Uimm32</code> (32 bits each), a <code>MemFlags</code> (8 bits), and a <code>Heap</code>, right? And we need two bytes in <code>InstructionData</code> for the opcode plus the enum discriminant. As a somewhat out-there suggestion: Can we make <code>Heap</code> be a <code>u8</code> underneath and avoid the side table? It would be surprising to have more than 256 separate heaps, right?</p>
</blockquote>



<a name="310942863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942863">(Nov 18 2022 at 23:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186944517">PR review</a>.</p>



<a name="310942864"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942864" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942864">(Nov 18 2022 at 23:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026978192">PR review comment</a>:</p>
<blockquote>
<p>It's pretty tempting, on the one hand... on the other hand, with component-model work, I suspect that eventually having multiple heaps accessible from one body of code (e.g. adapter functions) may be common, and 256 heaps starts to feel uncomfortably close to what may actually exist (e.g. O(100) heaps for O(100) modules in a large component graph)...</p>
</blockquote>



<a name="310942978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942978">(Nov 18 2022 at 23:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026978545">PR review comment</a>:</p>
<blockquote>
<p>(I guess in such a case one could argue that an adapter function should never need to see more than <code>from</code> and <code>to</code> heaps, rather than all heaps in the graph, so maybe it's OK. I'm not entirely sure, just trying to avoid creating surprising limits if we can)</p>
</blockquote>



<a name="310942979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310942979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310942979">(Nov 18 2022 at 23:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186945083">PR review</a>.</p>



<a name="310945367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310945367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310945367">(Nov 19 2022 at 00:08)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026986517">PR review comment</a>:</p>
<blockquote>
<p>A related question: <code>Heap</code> is an index into the heaps declared on the current function, so this hypothetical 256-heap limit would be per-function; do I have that right? So a core wasm module, or a collection of components, could still have billions of heaps as long only a few are used in each function. I think that's assumed in your comment about adapter functions, but I don't understand the heap infrastructure well so I wanted to check.</p>
<p>I don't have strong feelings on this either way, it just seems like the instruction is so close to fitting without a side table that we ought to at least think about it a little.</p>
</blockquote>



<a name="310945368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310945368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310945368">(Nov 19 2022 at 00:08)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186959681">PR review</a>.</p>



<a name="310949187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310949187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310949187">(Nov 19 2022 at 00:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1186975847">PR review</a>.</p>



<a name="310949188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/310949188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#310949188">(Nov 19 2022 at 00:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1026997012">PR review comment</a>:</p>
<blockquote>
<p>Indeed, it's per-function. I haven't looked closely at how cranelift-wasm actually defines heaps but I would suspect if it doesn't create descriptors on-demand as heaps are actually referenced, it wouldn't be hard to do so.</p>
</blockquote>



<a name="311483892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311483892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311483892">(Nov 21 2022 at 22:17)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1028565097">PR review comment</a>:</p>
<blockquote>
<p>Ah this is just a copy-paste of <code>ir::Heap</code>'s docs that I forgot to update.</p>
</blockquote>



<a name="311483893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311483893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311483893">(Nov 21 2022 at 22:17)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1189005306">PR review</a>.</p>



<a name="311484474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484474">(Nov 21 2022 at 22:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1189010626">PR review</a>.</p>



<a name="311484476"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484476" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484476">(Nov 21 2022 at 22:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1028568673">PR review comment</a>:</p>
<blockquote>
<p>Mostly because error handling in the interpreter is pretty weird and there is no easy way to turn arbitrary <code>impl Error</code> types into traps. But saturating should be correct and seems less wordy and involved than the checked adds, to me.</p>
</blockquote>



<a name="311484554"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484554" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484554">(Nov 21 2022 at 22:23)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5300">PR #5300</a> from <code>heap-load-store</code> to <code>main</code>.</p>



<a name="311484684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484684">(Nov 21 2022 at 22:24)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1189012281">PR review</a>.</p>



<a name="311484685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484685">(Nov 21 2022 at 22:24)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1028569919">PR review comment</a>:</p>
<blockquote>
<p>Right now, all of our entities are <code>u32</code> so this feels like a larger change we would want to think over a bit. As such, I'm not going to block landing this PR on thinking about that.</p>
</blockquote>



<a name="311484694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311484694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311484694">(Nov 21 2022 at 22:24)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5300">PR #5300</a>.</p>



<a name="311489335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311489335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311489335">(Nov 21 2022 at 23:00)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5300">PR #5300</a>.</p>



<a name="311496753"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311496753" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311496753">(Nov 22 2022 at 00:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#pullrequestreview-1189081775">PR review</a>.</p>



<a name="311496754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311496754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311496754">(Nov 22 2022 at 00:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1028624058">PR review comment</a>:</p>
<blockquote>
<p>I think I'd actually prefer the checked_add/expect sequence: saturating_add is explicitly <em>incorrect</em> in general for some values allowed by the types (close to the limit), and is a suspicious and unexpected thing to see in an address computation. It's correct here because of the ranges involved, but those invariants aren't implicit and not obvious to the reader at all. If we're comfortable saying that the saturation should never actually happen (in the current version), then we should be equally happy to say that the expect should never actually fail (in the proposed version), except in the latter case we'll know if we're wrong.</p>
</blockquote>



<a name="311496793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235300%20Cranelift%3A%20Add%20%60heap_load%60%20and%20%60heap_.../near/311496793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235300.20Cranelift.3A.20Add.20.60heap_load.60.20and.20.60heap_.2E.2E.2E.html#311496793">(Nov 22 2022 at 00:04)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5300#discussion_r1028624058">PR review comment</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>