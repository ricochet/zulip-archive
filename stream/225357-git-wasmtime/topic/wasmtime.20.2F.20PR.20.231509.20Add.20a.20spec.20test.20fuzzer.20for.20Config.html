<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1509 Add a spec test fuzzer for Config · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html">wasmtime / PR #1509 Add a spec test fuzzer for Config</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193949965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193949965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193949965">(Apr 14 2020 at 20:03)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1509" title="https://github.com/bytecodealliance/wasmtime/pull/1509">PR #1509</a> from <code>spectests-fuzzer</code> to <code>master</code>:</p>
<blockquote>
<p>This commit adds a new fuzzer which is intended to run on oss-fuzz. This<br>
fuzzer creates and arbitrary <code>Config</code> which <em>should</em> pass spec tests and<br>
then asserts that it does so. The goal here is to weed out any<br>
accidental bugs in global configuration which could cause<br>
non-spec-compliant behavior.</p>
</blockquote>



<a name="193949966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193949966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193949966">(Apr 14 2020 at 20:03)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen" title="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1509" title="https://github.com/bytecodealliance/wasmtime/pull/1509">PR #1509</a>.</p>



<a name="193960124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960124">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#pullrequestreview-393306549" title="https://github.com/bytecodealliance/wasmtime/pull/1509#pullrequestreview-393306549">PR Review</a>.</p>



<a name="193960126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960126">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408444613" title="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408444613">PR Review Comment</a>:</p>
<blockquote>
<p>Let's move the body of this into a function in <code>wasmtime/crates/fuzzing/src/oracles.rs</code> so that it could (theoretically) be reused with other fuzzer engines, and is consistent with how our other fuzz targets are defined.</p>
</blockquote>



<a name="193960127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960127">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#pullrequestreview-393306549" title="https://github.com/bytecodealliance/wasmtime/pull/1509#pullrequestreview-393306549">PR Review</a>.</p>



<a name="193960128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960128">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408448817" title="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408448817">PR Review Comment</a>:</p>
<blockquote>
<p>Taking the mod won't result in a uniform distribution. Instead, this should be part of the <code>Arbitrary</code> impls:</p>
<div class="codehilite"><pre><span></span><span class="k">struct</span> <span class="nc">SpecFile</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">file</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">contents</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">Arbitrary</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SpecFile</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">arbitrary</span><span class="p">(</span><span class="n">u</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Unstructured</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">arbitrary</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// NB: this does get a uniform value in the provided range.</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">int_in_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">FILES</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FILES</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">SpecFile</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">fn</span> <span class="nf">size_hint</span><span class="p">(</span><span class="n">_depth</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">()))</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


</blockquote>



<a name="193960129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960129">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408449697" title="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408449697">PR Review Comment</a>:</p>
<blockquote>
<p>This should be in <code>wasmtime/crates/fuzzing/src/generators.rs</code> with the rest of the test case generators. This allows us to reuse the concept "a spec compliant config" across different oracles, and is consistent with the rest of the infra.</p>
</blockquote>



<a name="193960131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/193960131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#193960131">(Apr 14 2020 at 21:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408450790" title="https://github.com/bytecodealliance/wasmtime/pull/1509#discussion_r408450790">PR Review Comment</a>:</p>
<blockquote>
<p>This should be a <code>log::debug!</code> so that it doesn't print except when we're debugging the test case and actually looking at the output. This should allow the fuzz target to run faster under oss-fuzz.</p>
</blockquote>



<a name="194024292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/194024292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#194024292">(Apr 15 2020 at 12:52)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1509" title="https://github.com/bytecodealliance/wasmtime/pull/1509">PR #1509</a> from <code>spectests-fuzzer</code> to <code>master</code>:</p>
<blockquote>
<p>This commit adds a new fuzzer which is intended to run on oss-fuzz. This<br>
fuzzer creates and arbitrary <code>Config</code> which <em>should</em> pass spec tests and<br>
then asserts that it does so. The goal here is to weed out any<br>
accidental bugs in global configuration which could cause<br>
non-spec-compliant behavior.</p>
</blockquote>



<a name="194024432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/194024432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#194024432">(Apr 15 2020 at 12:53)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1509" title="https://github.com/bytecodealliance/wasmtime/pull/1509">PR #1509</a> from <code>spectests-fuzzer</code> to <code>master</code>:</p>
<blockquote>
<p>This commit adds a new fuzzer which is intended to run on oss-fuzz. This<br>
fuzzer creates and arbitrary <code>Config</code> which <em>should</em> pass spec tests and<br>
then asserts that it does so. The goal here is to weed out any<br>
accidental bugs in global configuration which could cause<br>
non-spec-compliant behavior.</p>
</blockquote>



<a name="194029807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231509%20Add%20a%20spec%20test%20fuzzer%20for%20Config/near/194029807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231509.20Add.20a.20spec.20test.20fuzzer.20for.20Config.html#194029807">(Apr 15 2020 at 13:29)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1509" title="https://github.com/bytecodealliance/wasmtime/pull/1509">PR #1509</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>