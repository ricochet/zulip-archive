<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4224 cannot test if target-specific fla... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html">wasmtime / issue #4224 cannot test if target-specific fla...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="284963094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284963094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284963094">(Jun 04 2022 at 06:51)</a>:</h4>
<p>JamesMcGuigan opened <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I am trying to run linux wasmtime on Xeon E5430 CPUs (2007) without SSE4 (Streaming SIMD Extensions 4) support </p>
<p>I am getting the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Test Case</h3>
<p>WASM code is taken directly from the manual, and is 28 lines of handcoded WAT implementing the GCD (Greatest common divisor) algoritm, and compiled using <code>wat2wasm</code></p>
<ul>
<li><a href="https://docs.wasmtime.dev/lang-bash.html">https://docs.wasmtime.dev/lang-bash.html</a></li>
<li><a href="https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat">https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/JamesMcGuigan/ecosystem-research/</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ecosystem</span><span class="o">-</span><span class="n">research</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wat</span><span class="o">/</span><span class="n">gcd</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="mi">04</span><span class="n">a8056151602f6de71feb6ce12f77f0ddd3cb8e</span><span class="w"></span>
<span class="n">wat2wasm</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wat</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>WASM file can be validated through a custom nodejs runtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gcd</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
<span class="n">GCD</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
</code></pre></div>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>I have tired both with the prebuilt binary version of wasmtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">pacman</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="mf">0.36.0</span><span class="w"></span>
</code></pre></div>
<p>I have also tried installing from source:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime.git</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">--</span><span class="n">init</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"></span>
#<span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">0.38.0</span><span class="w"></span>
</code></pre></div>
<p>And then even attempting applying the following diff (which didn't help)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">iff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="n">fbef95923</span><span class="o">..</span><span class="mi">7</span><span class="n">df50ec5f</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_sse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse3"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_ssse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"ssse3"</span><span class="p">)),</span><span class="w"></span>

<span class="o">-</span><span class="w">                </span><span class="s">"has_sse41"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.1"</span><span class="p">)),</span><span class="w"></span>
<span class="o">-</span><span class="w">                </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.2"</span><span class="p">)),</span><span class="w"></span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse41" =&gt; Some(std::is_x86_feature_detected!("sse4.1")),</span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse42" =&gt; Some(std::is_x86_feature_detected!("sse4.2")),</span>
<span class="w">                 </span><span class="s">"has_popcnt"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"popcnt"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx2"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx2"</span><span class="p">)),</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="mi">08</span><span class="n">c3b06fb</span><span class="o">..</span><span class="n">c4d4350dd</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">+</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompileCommand</span>::<span class="n">try_parse_from</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">             </span><span class="s">"compile"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--disable-logging"</span><span class="p">,</span><span class="w"></span>

<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_ssse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse41"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse42"</span><span class="p">,</span><span class="w"></span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_ssse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse41",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "has_sse42",</span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"has_avx"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>Operating system: Manjaro / Arch Linux</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span><span class="w"></span>
<span class="n">DISTRIB_ID</span><span class="o">=</span><span class="n">ManjaroLinux</span><span class="w"></span>
<span class="n">DISTRIB_RELEASE</span><span class="o">=</span><span class="mf">21.2.6</span><span class="w"></span>
<span class="n">DISTRIB_CODENAME</span><span class="o">=</span><span class="n">Qonos</span><span class="w"></span>
<span class="n">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s">"Manjaro Linux"</span><span class="w"></span>
</code></pre></div>
<p>Architecture:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span><span class="w"></span>

<span class="n">vendor_id</span><span class="w">       </span>: <span class="nc">GenuineIntel</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">family</span><span class="w">      </span>: <span class="mi">6</span><span class="w"></span>
<span class="n">model</span><span class="w">           </span>: <span class="mi">23</span><span class="w"></span>
<span class="n">model</span><span class="w"> </span><span class="n">name</span><span class="w">      </span>: <span class="nc">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">CPU</span><span class="w">           </span><span class="n">E5430</span><span class="w">  </span><span class="o">@</span><span class="w"> </span><span class="mf">2.66</span><span class="n">GHz</span><span class="w"></span>
<span class="n">stepping</span><span class="w">        </span>: <span class="mi">10</span><span class="w"></span>
<span class="n">microcode</span><span class="w">       </span>: <span class="mh">0xa0b</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">MHz</span><span class="w">         </span>: <span class="mf">2660.057</span><span class="w"></span>
<span class="n">cache</span><span class="w"> </span><span class="n">size</span><span class="w">      </span>: <span class="mi">6144</span><span class="w"> </span><span class="n">KB</span><span class="w"></span>
<span class="n">physical</span><span class="w"> </span><span class="n">id</span><span class="w">     </span>: <span class="mi">1</span><span class="w"></span>
<span class="n">siblings</span><span class="w">        </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">core</span><span class="w"> </span><span class="n">id</span><span class="w">         </span>: <span class="mi">3</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">cores</span><span class="w">       </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">apicid</span><span class="w">          </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">initial</span><span class="w"> </span><span class="n">apicid</span><span class="w">  </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">fpu</span><span class="w">             </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">fpu_exception</span><span class="w">   </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">cpuid</span><span class="w"> </span><span class="n">level</span><span class="w">     </span>: <span class="mi">13</span><span class="w"></span>
<span class="n">wp</span><span class="w">              </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">flags</span><span class="w">           </span>: <span class="nc">fpu</span><span class="w"> </span><span class="n">vme</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">pse</span><span class="w"> </span><span class="n">tsc</span><span class="w"> </span><span class="n">msr</span><span class="w"> </span><span class="n">pae</span><span class="w"> </span><span class="n">mce</span><span class="w"> </span><span class="n">cx8</span><span class="w"> </span><span class="n">apic</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="n">mtrr</span><span class="w"> </span><span class="n">pge</span><span class="w"> </span><span class="n">mca</span><span class="w"> </span><span class="n">cmov</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="n">pse36</span><span class="w"> </span><span class="n">clflush</span><span class="w"> </span><span class="n">dts</span><span class="w"> </span><span class="n">acpi</span><span class="w"> </span><span class="n">mmx</span><span class="w"> </span><span class="n">fxsr</span><span class="w"> </span><span class="n">sse</span><span class="w"> </span><span class="n">sse2</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="n">pbe</span><span class="w"> </span><span class="n">syscall</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="n">constant_tsc</span><span class="w"> </span><span class="n">arch_perfmon</span><span class="w"> </span><span class="n">pebs</span><span class="w"> </span><span class="n">bts</span><span class="w"> </span><span class="n">rep_good</span><span class="w"> </span><span class="n">nopl</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">aperfmperf</span><span class="w"> </span><span class="n">pni</span><span class="w"> </span><span class="n">dtes64</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">ds_cpl</span><span class="w"> </span><span class="n">est</span><span class="w"> </span><span class="n">tm2</span><span class="w"> </span><span class="n">ssse3</span><span class="w"> </span><span class="n">cx16</span><span class="w"> </span><span class="n">xtpr</span><span class="w"> </span><span class="n">pdcm</span><span class="w"> </span><span class="n">dca</span><span class="w"> </span><span class="n">sse4_1</span><span class="w"> </span><span class="n">xsave</span><span class="w"> </span><span class="n">lahf_lm</span><span class="w"> </span><span class="n">pti</span><span class="w"> </span><span class="n">dtherm</span><span class="w"></span>
<span class="n">bugs</span><span class="w">            </span>: <span class="nc">cpu_meltdown</span><span class="w"> </span><span class="n">spectre_v1</span><span class="w"> </span><span class="n">spectre_v2</span><span class="w"> </span><span class="n">spec_store_bypass</span><span class="w"> </span><span class="n">l1tf</span><span class="w"> </span><span class="n">mds</span><span class="w"> </span><span class="n">swapgs</span><span class="w"> </span><span class="n">itlb_multihit</span><span class="w"></span>
<span class="n">bogomips</span><span class="w">        </span>: <span class="mf">5322.88</span><span class="w"></span>
<span class="n">clflush</span><span class="w"> </span><span class="n">size</span><span class="w">    </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">cache_alignment</span><span class="w"> </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">address</span><span class="w"> </span><span class="n">sizes</span><span class="w">   </span>: <span class="mi">38</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="n">physical</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="kr">virtual</span><span class="w"></span>
<span class="n">power</span><span class="w"> </span><span class="n">management</span>:
</code></pre></div><br>
</p>
</blockquote>



<a name="284963095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284963095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284963095">(Jun 04 2022 at 06:51)</a>:</h4>
<p>JamesMcGuigan labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I am trying to run linux wasmtime on Xeon E5430 CPUs (2007) without SSE4 (Streaming SIMD Extensions 4) support </p>
<p>I am getting the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Test Case</h3>
<p>WASM code is taken directly from the manual, and is 28 lines of handcoded WAT implementing the GCD (Greatest common divisor) algoritm, and compiled using <code>wat2wasm</code></p>
<ul>
<li><a href="https://docs.wasmtime.dev/lang-bash.html">https://docs.wasmtime.dev/lang-bash.html</a></li>
<li><a href="https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat">https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/JamesMcGuigan/ecosystem-research/</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ecosystem</span><span class="o">-</span><span class="n">research</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wat</span><span class="o">/</span><span class="n">gcd</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="mi">04</span><span class="n">a8056151602f6de71feb6ce12f77f0ddd3cb8e</span><span class="w"></span>
<span class="n">wat2wasm</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wat</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>WASM file can be validated through a custom nodejs runtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gcd</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
<span class="n">GCD</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
</code></pre></div>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>I have tired both with the prebuilt binary version of wasmtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">pacman</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="mf">0.36.0</span><span class="w"></span>
</code></pre></div>
<p>I have also tried installing from source:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime.git</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">--</span><span class="n">init</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"></span>
#<span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">0.38.0</span><span class="w"></span>
</code></pre></div>
<p>And then even attempting applying the following diff (which didn't help)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">iff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="n">fbef95923</span><span class="o">..</span><span class="mi">7</span><span class="n">df50ec5f</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_sse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse3"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_ssse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"ssse3"</span><span class="p">)),</span><span class="w"></span>

<span class="o">-</span><span class="w">                </span><span class="s">"has_sse41"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.1"</span><span class="p">)),</span><span class="w"></span>
<span class="o">-</span><span class="w">                </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.2"</span><span class="p">)),</span><span class="w"></span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse41" =&gt; Some(std::is_x86_feature_detected!("sse4.1")),</span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse42" =&gt; Some(std::is_x86_feature_detected!("sse4.2")),</span>
<span class="w">                 </span><span class="s">"has_popcnt"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"popcnt"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx2"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx2"</span><span class="p">)),</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="mi">08</span><span class="n">c3b06fb</span><span class="o">..</span><span class="n">c4d4350dd</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">+</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompileCommand</span>::<span class="n">try_parse_from</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">             </span><span class="s">"compile"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--disable-logging"</span><span class="p">,</span><span class="w"></span>

<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_ssse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse41"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse42"</span><span class="p">,</span><span class="w"></span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_ssse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse41",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "has_sse42",</span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"has_avx"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>Operating system: Manjaro / Arch Linux</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span><span class="w"></span>
<span class="n">DISTRIB_ID</span><span class="o">=</span><span class="n">ManjaroLinux</span><span class="w"></span>
<span class="n">DISTRIB_RELEASE</span><span class="o">=</span><span class="mf">21.2.6</span><span class="w"></span>
<span class="n">DISTRIB_CODENAME</span><span class="o">=</span><span class="n">Qonos</span><span class="w"></span>
<span class="n">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s">"Manjaro Linux"</span><span class="w"></span>
</code></pre></div>
<p>Architecture:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span><span class="w"></span>

<span class="n">vendor_id</span><span class="w">       </span>: <span class="nc">GenuineIntel</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">family</span><span class="w">      </span>: <span class="mi">6</span><span class="w"></span>
<span class="n">model</span><span class="w">           </span>: <span class="mi">23</span><span class="w"></span>
<span class="n">model</span><span class="w"> </span><span class="n">name</span><span class="w">      </span>: <span class="nc">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">CPU</span><span class="w">           </span><span class="n">E5430</span><span class="w">  </span><span class="o">@</span><span class="w"> </span><span class="mf">2.66</span><span class="n">GHz</span><span class="w"></span>
<span class="n">stepping</span><span class="w">        </span>: <span class="mi">10</span><span class="w"></span>
<span class="n">microcode</span><span class="w">       </span>: <span class="mh">0xa0b</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">MHz</span><span class="w">         </span>: <span class="mf">2660.057</span><span class="w"></span>
<span class="n">cache</span><span class="w"> </span><span class="n">size</span><span class="w">      </span>: <span class="mi">6144</span><span class="w"> </span><span class="n">KB</span><span class="w"></span>
<span class="n">physical</span><span class="w"> </span><span class="n">id</span><span class="w">     </span>: <span class="mi">1</span><span class="w"></span>
<span class="n">siblings</span><span class="w">        </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">core</span><span class="w"> </span><span class="n">id</span><span class="w">         </span>: <span class="mi">3</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">cores</span><span class="w">       </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">apicid</span><span class="w">          </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">initial</span><span class="w"> </span><span class="n">apicid</span><span class="w">  </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">fpu</span><span class="w">             </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">fpu_exception</span><span class="w">   </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">cpuid</span><span class="w"> </span><span class="n">level</span><span class="w">     </span>: <span class="mi">13</span><span class="w"></span>
<span class="n">wp</span><span class="w">              </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">flags</span><span class="w">           </span>: <span class="nc">fpu</span><span class="w"> </span><span class="n">vme</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">pse</span><span class="w"> </span><span class="n">tsc</span><span class="w"> </span><span class="n">msr</span><span class="w"> </span><span class="n">pae</span><span class="w"> </span><span class="n">mce</span><span class="w"> </span><span class="n">cx8</span><span class="w"> </span><span class="n">apic</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="n">mtrr</span><span class="w"> </span><span class="n">pge</span><span class="w"> </span><span class="n">mca</span><span class="w"> </span><span class="n">cmov</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="n">pse36</span><span class="w"> </span><span class="n">clflush</span><span class="w"> </span><span class="n">dts</span><span class="w"> </span><span class="n">acpi</span><span class="w"> </span><span class="n">mmx</span><span class="w"> </span><span class="n">fxsr</span><span class="w"> </span><span class="n">sse</span><span class="w"> </span><span class="n">sse2</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="n">pbe</span><span class="w"> </span><span class="n">syscall</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="n">constant_tsc</span><span class="w"> </span><span class="n">arch_perfmon</span><span class="w"> </span><span class="n">pebs</span><span class="w"> </span><span class="n">bts</span><span class="w"> </span><span class="n">rep_good</span><span class="w"> </span><span class="n">nopl</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">aperfmperf</span><span class="w"> </span><span class="n">pni</span><span class="w"> </span><span class="n">dtes64</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">ds_cpl</span><span class="w"> </span><span class="n">est</span><span class="w"> </span><span class="n">tm2</span><span class="w"> </span><span class="n">ssse3</span><span class="w"> </span><span class="n">cx16</span><span class="w"> </span><span class="n">xtpr</span><span class="w"> </span><span class="n">pdcm</span><span class="w"> </span><span class="n">dca</span><span class="w"> </span><span class="n">sse4_1</span><span class="w"> </span><span class="n">xsave</span><span class="w"> </span><span class="n">lahf_lm</span><span class="w"> </span><span class="n">pti</span><span class="w"> </span><span class="n">dtherm</span><span class="w"></span>
<span class="n">bugs</span><span class="w">            </span>: <span class="nc">cpu_meltdown</span><span class="w"> </span><span class="n">spectre_v1</span><span class="w"> </span><span class="n">spectre_v2</span><span class="w"> </span><span class="n">spec_store_bypass</span><span class="w"> </span><span class="n">l1tf</span><span class="w"> </span><span class="n">mds</span><span class="w"> </span><span class="n">swapgs</span><span class="w"> </span><span class="n">itlb_multihit</span><span class="w"></span>
<span class="n">bogomips</span><span class="w">        </span>: <span class="mf">5322.88</span><span class="w"></span>
<span class="n">clflush</span><span class="w"> </span><span class="n">size</span><span class="w">    </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">cache_alignment</span><span class="w"> </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">address</span><span class="w"> </span><span class="n">sizes</span><span class="w">   </span>: <span class="mi">38</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="n">physical</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="kr">virtual</span><span class="w"></span>
<span class="n">power</span><span class="w"> </span><span class="n">management</span>:
</code></pre></div><br>
</p>
</blockquote>



<a name="284987989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284987989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284987989">(Jun 04 2022 at 16:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1146645007">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>Thanks for the report! By default Wasmtime has enabled stable merged features into the WebAssembly specification, which at this time notably includes the SIMD proposal for the <code>v128</code> type. This means that by default Wasmtime is enabling SIMD support in Cranelift. Cranelift on x86_64 currently requires SSE4.2 to be available to implement the SIMD proposal, which is the source of the error here. The system you're running on does not have SSE4.2 support (which the error message alludes to but probably could be clearer) but Wasmtime requires it to be enabled.</p>
<p>You should be able to work around this by passing <code>--wasm-features=-simd</code> which should disable the SIMD proposal. When disabled Cranelift shouldn't require SSE4.2. Note though that this isn't a super-well-tested path so I'm not 10% sure that would work.</p>
<p>The OP of this issue is about <code>has_sse41</code> which isn't related to the SSE4.2 requirement, though. The diff you mentioned you applied would cause this error message and that diff isn't doing what you otherwise think it might be doing. There's unfortunately no easy way to patch Cranelift for this.</p>
<p>If you're interested, though, there are probably only a handful of SIMD instructions that require SSE4.2. Cranelift has support for generating different sequences of code depending on the active CPU features, so the real fix for this issue would be to add support to cranelift for non-SSE4.2 CPUs by adding instruction lowerings using SSE4.1 and prior instead of only having a lowering for SSE4.2 (as we do today)</p>
</blockquote>



<a name="284992196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284992196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284992196">(Jun 04 2022 at 18:05)</a>:</h4>
<p>JamesMcGuigan <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1146660898">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I have tried both</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="p">;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">Found</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="o">'--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">'</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">wasn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">isn</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">context</span><span class="w"></span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<p>How do I pass the --wasm-features=-simd flag?</p>
</blockquote>



<a name="284992666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284992666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284992666">(Jun 04 2022 at 18:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1146662661">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>The first inovcation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"></span>
</code></pre></div>
<p>is passing the flag to Cargo and Cargo doesn't understand this flag. It's actually for the <code>wasmtime</code> executable. The second invocation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
</code></pre></div>
<p>is the way to pass the flag. If that doesn't work though then alas while this is the way I believe it's supposed to work I think you're the first to test this out so it's probably not working as intended. That's a bug to fix internally I believe.</p>
</blockquote>



<a name="284998350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/284998350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#284998350">(Jun 04 2022 at 20:24)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1146680382">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>@JamesMcGuigan thank you for this report, and I'll say at a high level that the <em>goal</em> of Cranelift's x86-64 backend is to work and support Wasm-SIMD on any x86-64 machine, hence require only SSE2. We aren't quite there yet; #3810 is the tracking issue for this goal.</p>
<p>Echoing @alexcrichton , if we can't run with SIMD deselected on your system then that's a bug. @abrown would you be willing to take a look at this? Otherwise I can try to get to it soon (sometime next week).</p>
</blockquote>



<a name="285030294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285030294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285030294">(Jun 05 2022 at 10:46)</a>:</h4>
<p>JamesMcGuigan edited <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I am trying to run linux wasmtime on Xeon E5430 CPUs (2007) without SSE4 (Streaming SIMD Extensions 4) support </p>
<p>I am getting the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Test Case</h3>
<p>WASM code is taken directly from the manual, and is 28 lines of handcoded WAT implementing the GCD (Greatest common divisor) algoritm, and compiled using <code>wat2wasm</code></p>
<ul>
<li><a href="https://docs.wasmtime.dev/lang-bash.html">https://docs.wasmtime.dev/lang-bash.html</a></li>
<li><a href="https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat">https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/JamesMcGuigan/ecosystem-research/</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ecosystem</span><span class="o">-</span><span class="n">research</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wat</span><span class="o">/</span><span class="n">gcd</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="mi">04</span><span class="n">a8056151602f6de71feb6ce12f77f0ddd3cb8e</span><span class="w"></span>
<span class="n">wat2wasm</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wat</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>WASM file can be validated through a custom nodejs runtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gcd</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
<span class="n">GCD</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
</code></pre></div>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>I have tired both with the prebuilt binary version of wasmtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">pacman</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="mf">0.36.0</span><span class="w"></span>
</code></pre></div>
<p>I have also tried installing from source:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime.git</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">--</span><span class="n">init</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"></span>
#<span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">0.38.0</span><span class="w"></span>
</code></pre></div>
<p>And then even attempting applying the following diff (which didn't help)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">iff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="n">fbef95923</span><span class="o">..</span><span class="mi">7</span><span class="n">df50ec5f</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_sse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse3"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_ssse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"ssse3"</span><span class="p">)),</span><span class="w"></span>

<span class="o">-</span><span class="w">                </span><span class="s">"has_sse41"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.1"</span><span class="p">)),</span><span class="w"></span>
<span class="o">-</span><span class="w">                </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.2"</span><span class="p">)),</span><span class="w"></span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse41" =&gt; Some(std::is_x86_feature_detected!("sse4.1")),</span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse42" =&gt; Some(std::is_x86_feature_detected!("sse4.2")),</span>
<span class="w">                 </span><span class="s">"has_popcnt"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"popcnt"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx2"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx2"</span><span class="p">)),</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="mi">08</span><span class="n">c3b06fb</span><span class="o">..</span><span class="n">c4d4350dd</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">+</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompileCommand</span>::<span class="n">try_parse_from</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">             </span><span class="s">"compile"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--disable-logging"</span><span class="p">,</span><span class="w"></span>

<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_ssse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse41"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse42"</span><span class="p">,</span><span class="w"></span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_ssse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse41",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "has_sse42",</span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"has_avx"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>Operating system: Manjaro / Arch Linux</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span><span class="w"></span>
<span class="n">DISTRIB_ID</span><span class="o">=</span><span class="n">ManjaroLinux</span><span class="w"></span>
<span class="n">DISTRIB_RELEASE</span><span class="o">=</span><span class="mf">21.2.6</span><span class="w"></span>
<span class="n">DISTRIB_CODENAME</span><span class="o">=</span><span class="n">Qonos</span><span class="w"></span>
<span class="n">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s">"Manjaro Linux"</span><span class="w"></span>
</code></pre></div>
<p>Architecture:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span><span class="w"></span>

<span class="n">vendor_id</span><span class="w">       </span>: <span class="nc">GenuineIntel</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">family</span><span class="w">      </span>: <span class="mi">6</span><span class="w"></span>
<span class="n">model</span><span class="w">           </span>: <span class="mi">23</span><span class="w"></span>
<span class="n">model</span><span class="w"> </span><span class="n">name</span><span class="w">      </span>: <span class="nc">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">CPU</span><span class="w">           </span><span class="n">E5430</span><span class="w">  </span><span class="o">@</span><span class="w"> </span><span class="mf">2.66</span><span class="n">GHz</span><span class="w"></span>
<span class="n">stepping</span><span class="w">        </span>: <span class="mi">10</span><span class="w"></span>
<span class="n">microcode</span><span class="w">       </span>: <span class="mh">0xa0b</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">MHz</span><span class="w">         </span>: <span class="mf">2660.057</span><span class="w"></span>
<span class="n">cache</span><span class="w"> </span><span class="n">size</span><span class="w">      </span>: <span class="mi">6144</span><span class="w"> </span><span class="n">KB</span><span class="w"></span>
<span class="n">physical</span><span class="w"> </span><span class="n">id</span><span class="w">     </span>: <span class="mi">1</span><span class="w"></span>
<span class="n">siblings</span><span class="w">        </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">core</span><span class="w"> </span><span class="n">id</span><span class="w">         </span>: <span class="mi">3</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">cores</span><span class="w">       </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">apicid</span><span class="w">          </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">initial</span><span class="w"> </span><span class="n">apicid</span><span class="w">  </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">fpu</span><span class="w">             </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">fpu_exception</span><span class="w">   </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">cpuid</span><span class="w"> </span><span class="n">level</span><span class="w">     </span>: <span class="mi">13</span><span class="w"></span>
<span class="n">wp</span><span class="w">              </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">flags</span><span class="w">           </span>: <span class="nc">fpu</span><span class="w"> </span><span class="n">vme</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">pse</span><span class="w"> </span><span class="n">tsc</span><span class="w"> </span><span class="n">msr</span><span class="w"> </span><span class="n">pae</span><span class="w"> </span><span class="n">mce</span><span class="w"> </span><span class="n">cx8</span><span class="w"> </span><span class="n">apic</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="n">mtrr</span><span class="w"> </span><span class="n">pge</span><span class="w"> </span><span class="n">mca</span><span class="w"> </span><span class="n">cmov</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="n">pse36</span><span class="w"> </span><span class="n">clflush</span><span class="w"> </span><span class="n">dts</span><span class="w"> </span><span class="n">acpi</span><span class="w"> </span><span class="n">mmx</span><span class="w"> </span><span class="n">fxsr</span><span class="w"> </span><span class="n">sse</span><span class="w"> </span><span class="n">sse2</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="n">pbe</span><span class="w"> </span><span class="n">syscall</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="n">constant_tsc</span><span class="w"> </span><span class="n">arch_perfmon</span><span class="w"> </span><span class="n">pebs</span><span class="w"> </span><span class="n">bts</span><span class="w"> </span><span class="n">rep_good</span><span class="w"> </span><span class="n">nopl</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">aperfmperf</span><span class="w"> </span><span class="n">pni</span><span class="w"> </span><span class="n">dtes64</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">ds_cpl</span><span class="w"> </span><span class="n">est</span><span class="w"> </span><span class="n">tm2</span><span class="w"> </span><span class="n">ssse3</span><span class="w"> </span><span class="n">cx16</span><span class="w"> </span><span class="n">xtpr</span><span class="w"> </span><span class="n">pdcm</span><span class="w"> </span><span class="n">dca</span><span class="w"> </span><span class="n">sse4_1</span><span class="w"> </span><span class="n">xsave</span><span class="w"> </span><span class="n">lahf_lm</span><span class="w"> </span><span class="n">pti</span><span class="w"> </span><span class="n">dtherm</span><span class="w"></span>
<span class="n">bugs</span><span class="w">            </span>: <span class="nc">cpu_meltdown</span><span class="w"> </span><span class="n">spectre_v1</span><span class="w"> </span><span class="n">spectre_v2</span><span class="w"> </span><span class="n">spec_store_bypass</span><span class="w"> </span><span class="n">l1tf</span><span class="w"> </span><span class="n">mds</span><span class="w"> </span><span class="n">swapgs</span><span class="w"> </span><span class="n">itlb_multihit</span><span class="w"></span>
<span class="n">bogomips</span><span class="w">        </span>: <span class="mf">5322.88</span><span class="w"></span>
<span class="n">clflush</span><span class="w"> </span><span class="n">size</span><span class="w">    </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">cache_alignment</span><span class="w"> </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">address</span><span class="w"> </span><span class="n">sizes</span><span class="w">   </span>: <span class="mi">38</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="n">physical</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="kr">virtual</span><span class="w"></span>
<span class="n">power</span><span class="w"> </span><span class="n">management</span>:
</code></pre></div><br>
</p>
</blockquote>



<a name="285169750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285169750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285169750">(Jun 06 2022 at 20:45)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1147907549">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>After reading through this issue, I think that this could take some time to resolve properly: 1) identify all SSE4.2+ lowerings (these are not currently conditioned by any <code>has_...</code> predicates), 2) add <code>has_*</code> to all SSE2+ x64 lowerings, 3) figure out SSE2 lowerings for all of these cases (which could be quite a few?). Seems like a lot of work for little pay-off.</p>
<p>Since @JamesMcGuigan isn't really trying to run SIMD code, perhaps an alternative would be to start with steps 1) and 2) above and then remove the code that requires Cranelift to compile Wasm SIMD code with SSE4.2. (I assume that initially we would need to actually fail in an ISLE <code>if-let</code>--not just "not match"--if the SSE feature is not present). This way, Wasm SIMD can remain a default feature and users without SSE2+ can still compile most programs. If they run across a program that does use an SSE4.2 instruction, e.g., then they would see a targeted error message (e.g., <code>v128.splat requires </code>has_sse42<code> to compile</code>), leaving them no worse off than they are now. @cfallin, @alexcrichton: thoughts on this approach?</p>
</blockquote>



<a name="285177726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285177726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285177726">(Jun 06 2022 at 21:58)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1147974495">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I think that would work but would need more infrastructure to plumb it all the way through because currently Wasmtime will iterate over enabled features in Cranelift and pessimistically assume that every feature was used for some instruction lowering, testing that each feature is available on the host. If we switched lowerings to fail if the required feature wasn't enabled then we'd also need to track which features were actually used and have that be an additional output of compilation.</p>
<p>That being said though I think the easiest way to handle the immediate issue here would be to fix disabling the simd feature in wasmtime. Doing so should ideally disable <a href="https://github.com/bytecodealliance/wasmtime/blob/3f152273d3629689ed26a8120f631537d6452b2d/cranelift/codegen/src/isa/x64/mod.rs#L183-L195">this block</a> which should disable the need for feature sets above sse2. Currently though we may not translate <code>--wasm-features=-simd</code> to disabling the <code>"simd"</code> feature in cranelift erronerously.</p>
</blockquote>



<a name="285177737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285177737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285177737">(Jun 06 2022 at 21:58)</a>:</h4>
<p>alexcrichton edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1147974495">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I think that would work but would need more infrastructure to plumb it all the way through because currently Wasmtime will iterate over enabled features in Cranelift and pessimistically assume that every feature was used for some instruction lowering, testing that each feature is available on the host. If we switched lowerings to fail if the required feature wasn't enabled then we'd also need to track which features were actually used and have that be an additional output of compilation.</p>
<p>That being said though I think the easiest way to handle the immediate issue here would be to fix disabling the simd feature in wasmtime. Doing so should ideally disable <a href="https://github.com/bytecodealliance/wasmtime/blob/3f152273d3629689ed26a8120f631537d6452b2d/cranelift/codegen/src/isa/x64/mod.rs#L183-L195">this block</a> which should disable the need for feature sets above sse2. Currently though we may not translate <code>--wasm-features=-simd</code> to disabling the <code>"simd"</code> feature in cranelift erroneously.</p>
</blockquote>



<a name="285184681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285184681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285184681">(Jun 06 2022 at 23:07)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1148018310">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>Hmm, so I'll put up a PR in a second that at least gets further -- when emulating an SSE2-machine (by deleting the feature macro tests in <code>cranelift-native</code>), I found that the changes in #3816 to turn on SSE3, SSSE3, SSE4.1 and SSE4.2 in the default <code>Flags</code> so that a default-constructed compiler backend can work with default Wasmtime options were having an unintended effect: <code>cranelift-native</code> wouldn't actually produce flags with those off at all (because the logic was of the form "if feature present, set flag bit" starting with a default that's not all-zeroes).</p>
<p>However it seems we have some other issues in this SSE2-only world -- e.g.:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">cfallin</span><span class="o">@</span><span class="n">xap</span><span class="p">]</span><span class="o">~/</span><span class="n">work</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">%</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"> </span><span class="o">../</span><span class="n">wasm</span><span class="o">-</span><span class="n">tests</span><span class="o">/</span><span class="n">spidermonkey</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="n">simd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="n">sse3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="n">sse42</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">not</span><span class="w"> </span><span class="n">implemented</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">relocation</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">libcall</span><span class="w"> </span><span class="n">CeilF64</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">cranelift</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">obj</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">154</span>:<span class="mi">21</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
</code></pre></div>
<p>so I think to safely say that we support such platforms, even without SIMD, we'd want to add a CI target (can we use <code>qemu</code> to emulate x86-64 on x86-64, but with only SSE2?) and test it.</p>
<p>Finally, on the topic of "should we support SIMD on SSE2-only", I agree it's some amount of work, but I do think it's valuable. I don't want to fall into the trap of "most users have SSE x so we require it / make life without it increasingly painful" -- the point of Wasm is to be universal and work on all platforms, and that ethos I think should extend to having fallbacks for older CPU versions as well. It's certainly lower priority than a lot of the other backend work we have on our TODO lists (e.g. ISLE migration and the like), but we absolutely should do this audit at some point.</p>
</blockquote>



<a name="285188680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285188680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285188680">(Jun 07 2022 at 00:04)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1148051426">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>OK so I just spoke with Andrew for a bit and this is actually a really interesting and difficult design problem where we're stuck between multiple somewhat-mutually-incompatible constraints.</p>
<p>The ground truths:</p>
<ul>
<li>Wasm-SIMD is part of baseline SIMD now (ie, spec is merged), so it should be on by default in Wasmtime.</li>
<li>Our current x86-64 backend supports Wasm-SIMD with SSE4.2, but not with only SSE2.</li>
<li>Supporting it with only SSE2 would be great, but a huge amount of work and hard to motivate/justify given all the other bits of work. We should do it <em>someday</em> (but when and by whom?).</li>
<li>The Wasm-SIMD folks mostly assumed a baseline of SSE4.2 on x86-64, so polyfilling back to SSE2 is not necessarily trivial.</li>
<li>Wasmtime should support running on as many machines as possible, including SSE2-only.</li>
</ul>
<p>These are clearly in conflict; the options (at least) are:</p>
<ul>
<li>Turn off SIMD by default on x86-64. Terrible idea, let's not do this!</li>
<li>Current status quo: "default" compiler that the API will give you requires SSE4.2, and so works with default Wasmtime. With fix in #4231, <code>cranelift-native</code> on an SSE2-only system will give you the right flags and Wasmtime will refuse to construct a backend unless you explicitly turn off SIMD in the settings.</li>
<li>Use CPUID feature detection unconditionally (<code>cranelift-native</code>) for default <code>Flags</code> in:<ul>
<li><code>wasmtime-cli</code>; this is fine, AND</li>
<li>the public Wasmtime and Cranelift APIs; much more arguable! This breaks determinism: one should expect that programmatically invoking Wasmtime to compile <code>.cwasm</code>s should not depend on the host flags unless one goes out of the way to make it so.</li>
</ul>
</li>
</ul>
<p>Basically the question is: does a default Wasmtime (i) assume SSE4.2 and compile artifacts for it unconditionally, unless otherwise configured, (ii) grow some new nondeterminism and do that only on some hosts, or (iii) not support SIMD on x86-64 unless explicitly enabled. The fourth option (iv) support SIMD on SSE2 is difficult because the Wasm-SIMD design mostly assumes an SSE4.2 baseline, as per @abrown. The only tenable option seems (i) but it's kind of ugly.</p>
<p>@abrown I probably missed some things, anything else to note here?</p>
</blockquote>



<a name="285249233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285249233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285249233">(Jun 07 2022 at 13:21)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1148665744">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<blockquote>
<p>However it seems we have some other issues in this SSE2-only world -- e.g.:</p>
</blockquote>
<p>I believe this used to work historically but in some recent refactoring I couldn't figure out why we still had all these libcalls and things to handle so I ended up removing support for libcalls from Wasmtime. It wouldn't be too hard to add back support for libcalls to Wasmtime I think, we'd just have to think somewhat carefully about how to integrate it into compiled images.</p>
<p>Otherwise though I suspect that Cranelift supports everything necessary for non-SIMD wasm with just SSE2, it's the Wasmtime bits which may need some work.</p>
<hr>
<p>For what to do about the current situation, when you mention breaking determinism I think we already do exactly that today. By default <code>Engine::new()</code> will use the native host with allthe natively detected features which means that <code>wasmtime compile</code> could vary its output between hosts. This can be fixed by passing the <code>--target</code> flag, however.</p>
<p>I also would also personally advocate that it's not the correct default to disable all options and optionally enable things at runtime. Even if Cranelift and Wasmtime hypothetically supported the entire wasm spec with just SSE2 that means that to get good performance you'd have to manually opt-in to what's present on any CPU for the last decade. In my opinion it should be easy to get the native host's performance and even "target x86_64 please" in my opinion should do roughly what we do right now which is to assume SSE4.2. We should of course have knobs to still work with SSE2 but having to reach for specific support to run code on old CPUs does not seem unreasonable to me.</p>
</blockquote>



<a name="285278439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285278439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285278439">(Jun 07 2022 at 16:33)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1148904600">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>Ah, I hadn't realized that <code>Engine::new()</code> uses <code>cranelift-native</code> under the hood; if we're already in that universe, then I think this is actually a somewhat easier problem to solve, indeed. Basically we need to fix the flags detection (PR above) and then we're almost there. The SSE4.2-on-by-default-in-<code>Flags</code> bit is then mostly there to support tests, which don't use <code>cranelift-native</code> otherwise. (Maybe we could fix this too, as a shorter path to removing the hack than full SIMD-in-SSE2.)</p>
<p>Followup thoughts:</p>
<ul>
<li>I wonder if it would make sense to have an extension to <code>--target</code>, or maybe an <code>--arch</code> flag or something, for <code>wasmtime compile</code>? Basically I want the equivalent of <code>clang -march=native</code> or <code>clang -march=skylake</code>; right now we have an N-dimensional vector of feature flags (<code>--cranelift-set has_sse3=true --cranelift-set has_ssse3=true --cranelift-set has_sse41=true ...</code>).</li>
<li>If we have that, does it make sense to make a plain <code>--target x86_64</code> mean "x86_64 with SSE4.2", and require something like <code>--target x86_64:sse2</code> or <code>--target x86_64 --arch baseline</code> or something to generate a fully-compatible <code>.cwasm</code> that uses only SSE2?</li>
</ul>
</blockquote>



<a name="285280847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285280847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285280847">(Jun 07 2022 at 16:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1148922236">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>Oh sorry one thing I also forgot to mention was that we thoeretically get a good deal of coverage for target features with <a href="https://github.com/bytecodealliance/wasmtime/blob/511c53703ab6f5a7900e2bfbdfb8c7ea26fb47cc/crates/fuzzing/src/generators.rs#L728-L768">this fuzz configuration</a> which attempts to flip various flags available to cranelift to force it to generate instructions without a particular codegen feature. This testing relies on strict assertions in cranelift though about asserting that when an instruction is emitted the corresponding feature is enabled.</p>
<p>For flags the main precedent I know of is C/Rust compilers where it basically boils down to the <code>--target</code> having a default set of features enabled and then <code>-Ctarget-feature=+foo</code> flags are used to enable/disable individual features. Individual features then understand hierarchies so I think if you enable SSE4.2 you automatically get SSE4.1. </p>
</blockquote>



<a name="285505811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285505811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285505811">(Jun 09 2022 at 09:09)</a>:</h4>
<p>JamesMcGuigan <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1150869948">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>@cfallin Just tested out your patch in tags/dev after commit 5033f9994b1100d46265014c6243c07cd395789a</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="o">--</span><span class="n">all</span><span class="w"> </span><span class="o">--</span><span class="n">tags</span><span class="w"> </span><span class="o">--</span><span class="n">prune</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">co</span><span class="w"> </span><span class="n">tags</span><span class="o">/</span><span class="n">dev</span><span class="w"></span>
<span class="n">HEAD</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">823817595</span><span class="w"> </span><span class="n">Fix</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">typos</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">isle</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="p">(</span>#<span class="mi">4248</span><span class="p">)</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="p">;</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">24</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">Unsupported</span><span class="w"> </span><span class="n">feature</span>: <span class="nc">SIMD</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">SSE3</span><span class="p">,</span><span class="w"> </span><span class="n">SSSE3</span><span class="p">,</span><span class="w"> </span><span class="n">SSE4</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">SSE4</span><span class="p">.</span><span class="mi">2</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">x86_64</span><span class="p">.</span><span class="w"></span>

<span class="cp">$</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="o">=-</span><span class="n">simd</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">24</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">experimental</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">future</span><span class="w"></span>
<span class="mi">6</span><span class="w"></span>
</code></pre></div>
<p>Still need to figure out how to disable the <code>--invoke</code> warnings, but otherwise <code>wasmtime</code> now works as expected on my Xeon processors for this very simple <code>gcd.wat</code> test case. Thank you.</p>
</blockquote>



<a name="285572618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285572618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285572618">(Jun 09 2022 at 17:59)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4224#issuecomment-1151432729">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>Great, thanks for confirming @JamesMcGuigan ! Since the immediate issue here has been solved, I'm going to go ahead and close this issue, but please feel free to file any others you encounter.</p>
</blockquote>



<a name="285572623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234224%20cannot%20test%20if%20target-specific%20fla.../near/285572623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234224.20cannot.20test.20if.20target-specific.20fla.2E.2E.2E.html#285572623">(Jun 09 2022 at 17:59)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/4224">issue #4224</a>:</p>
<blockquote>
<p>I am trying to run linux wasmtime on Xeon E5430 CPUs (2007) without SSE4 (Streaming SIMD Extensions 4) support </p>
<p>I am getting the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Test Case</h3>
<p>WASM code is taken directly from the manual, and is 28 lines of handcoded WAT implementing the GCD (Greatest common divisor) algoritm, and compiled using <code>wat2wasm</code></p>
<ul>
<li><a href="https://docs.wasmtime.dev/lang-bash.html">https://docs.wasmtime.dev/lang-bash.html</a></li>
<li><a href="https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat">https://github.com/JamesMcGuigan/ecosystem-research/blob/04a8056151602f6de71feb6ce12f77f0ddd3cb8e/wasm/wat/gcd/gcd.wat</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/JamesMcGuigan/ecosystem-research/</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">ecosystem</span><span class="o">-</span><span class="n">research</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">wat</span><span class="o">/</span><span class="n">gcd</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="mi">04</span><span class="n">a8056151602f6de71feb6ce12f77f0ddd3cb8e</span><span class="w"></span>
<span class="n">wat2wasm</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wat</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>WASM file can be validated through a custom nodejs runtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">gcd</span><span class="p">.</span><span class="n">js</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>
<span class="n">GCD</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
</code></pre></div>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">gcd</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">36</span><span class="w"></span>

<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">gcd</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">compilation</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">host</span><span class="w"></span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>I have tired both with the prebuilt binary version of wasmtime</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">pacman</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="n">wasmtime</span><span class="w"> </span><span class="mf">0.36.0</span><span class="w"></span>
</code></pre></div>
<p>I have also tried installing from source:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime.git</span>
<span class="n">cd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="w"></span>
<span class="n">git</span><span class="w"> </span><span class="n">submodule</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">--</span><span class="n">init</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">clean</span><span class="w"></span>
<span class="n">cargo</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">--</span><span class="n">release</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">--</span><span class="n">version</span><span class="w"></span>
#<span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">cli</span><span class="w"> </span><span class="mf">0.38.0</span><span class="w"></span>
</code></pre></div>
<p>And then even attempting applying the following diff (which didn't help)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">iff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="n">fbef95923</span><span class="o">..</span><span class="mi">7</span><span class="n">df50ec5f</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">engine</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="mi">446</span><span class="p">,</span><span class="mi">8</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_sse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse3"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_ssse3"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"ssse3"</span><span class="p">)),</span><span class="w"></span>

<span class="o">-</span><span class="w">                </span><span class="s">"has_sse41"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.1"</span><span class="p">)),</span><span class="w"></span>
<span class="o">-</span><span class="w">                </span><span class="s">"has_sse42"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"sse4.2"</span><span class="p">)),</span><span class="w"></span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse41" =&gt; Some(std::is_x86_feature_detected!("sse4.1")),</span>
<span class="o">+</span><span class="w">                </span><span class="c1">// "has_sse42" =&gt; Some(std::is_x86_feature_detected!("sse4.2")),</span>
<span class="w">                 </span><span class="s">"has_popcnt"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"popcnt"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx"</span><span class="p">)),</span><span class="w"></span>
<span class="w">                 </span><span class="s">"has_avx2"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">std</span>::<span class="fm">is_x86_feature_detected!</span><span class="p">(</span><span class="s">"avx2"</span><span class="p">)),</span><span class="w"></span>
<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="n">index</span><span class="w"> </span><span class="mi">08</span><span class="n">c3b06fb</span><span class="o">..</span><span class="n">c4d4350dd</span><span class="w"> </span><span class="mi">100644</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span><span class="w"></span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">+</span><span class="mi">143</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="kd">let</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompileCommand</span>::<span class="n">try_parse_from</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="w"></span>
<span class="w">             </span><span class="s">"compile"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--disable-logging"</span><span class="p">,</span><span class="w"></span>

<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_ssse3"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse41"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="o">-</span><span class="w">            </span><span class="s">"has_sse42"</span><span class="p">,</span><span class="w"></span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_ssse3",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">//"has_sse41",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "--cranelift-enable",</span>
<span class="o">+</span><span class="w">            </span><span class="c1">// "has_sse42",</span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"has_avx"</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="s">"--cranelift-enable"</span><span class="p">,</span><span class="w"></span>
</code></pre></div>
<p>Operating system: Manjaro / Arch Linux</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">lsb</span><span class="o">-</span><span class="n">release</span><span class="w"></span>
<span class="n">DISTRIB_ID</span><span class="o">=</span><span class="n">ManjaroLinux</span><span class="w"></span>
<span class="n">DISTRIB_RELEASE</span><span class="o">=</span><span class="mf">21.2.6</span><span class="w"></span>
<span class="n">DISTRIB_CODENAME</span><span class="o">=</span><span class="n">Qonos</span><span class="w"></span>
<span class="n">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s">"Manjaro Linux"</span><span class="w"></span>
</code></pre></div>
<p>Architecture:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span><span class="w"></span>

<span class="n">vendor_id</span><span class="w">       </span>: <span class="nc">GenuineIntel</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">family</span><span class="w">      </span>: <span class="mi">6</span><span class="w"></span>
<span class="n">model</span><span class="w">           </span>: <span class="mi">23</span><span class="w"></span>
<span class="n">model</span><span class="w"> </span><span class="n">name</span><span class="w">      </span>: <span class="nc">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">CPU</span><span class="w">           </span><span class="n">E5430</span><span class="w">  </span><span class="o">@</span><span class="w"> </span><span class="mf">2.66</span><span class="n">GHz</span><span class="w"></span>
<span class="n">stepping</span><span class="w">        </span>: <span class="mi">10</span><span class="w"></span>
<span class="n">microcode</span><span class="w">       </span>: <span class="mh">0xa0b</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">MHz</span><span class="w">         </span>: <span class="mf">2660.057</span><span class="w"></span>
<span class="n">cache</span><span class="w"> </span><span class="n">size</span><span class="w">      </span>: <span class="mi">6144</span><span class="w"> </span><span class="n">KB</span><span class="w"></span>
<span class="n">physical</span><span class="w"> </span><span class="n">id</span><span class="w">     </span>: <span class="mi">1</span><span class="w"></span>
<span class="n">siblings</span><span class="w">        </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">core</span><span class="w"> </span><span class="n">id</span><span class="w">         </span>: <span class="mi">3</span><span class="w"></span>
<span class="n">cpu</span><span class="w"> </span><span class="n">cores</span><span class="w">       </span>: <span class="mi">4</span><span class="w"></span>
<span class="n">apicid</span><span class="w">          </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">initial</span><span class="w"> </span><span class="n">apicid</span><span class="w">  </span>: <span class="mi">7</span><span class="w"></span>
<span class="n">fpu</span><span class="w">             </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">fpu_exception</span><span class="w">   </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">cpuid</span><span class="w"> </span><span class="n">level</span><span class="w">     </span>: <span class="mi">13</span><span class="w"></span>
<span class="n">wp</span><span class="w">              </span>: <span class="nc">yes</span><span class="w"></span>
<span class="n">flags</span><span class="w">           </span>: <span class="nc">fpu</span><span class="w"> </span><span class="n">vme</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">pse</span><span class="w"> </span><span class="n">tsc</span><span class="w"> </span><span class="n">msr</span><span class="w"> </span><span class="n">pae</span><span class="w"> </span><span class="n">mce</span><span class="w"> </span><span class="n">cx8</span><span class="w"> </span><span class="n">apic</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="n">mtrr</span><span class="w"> </span><span class="n">pge</span><span class="w"> </span><span class="n">mca</span><span class="w"> </span><span class="n">cmov</span><span class="w"> </span><span class="n">pat</span><span class="w"> </span><span class="n">pse36</span><span class="w"> </span><span class="n">clflush</span><span class="w"> </span><span class="n">dts</span><span class="w"> </span><span class="n">acpi</span><span class="w"> </span><span class="n">mmx</span><span class="w"> </span><span class="n">fxsr</span><span class="w"> </span><span class="n">sse</span><span class="w"> </span><span class="n">sse2</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="n">pbe</span><span class="w"> </span><span class="n">syscall</span><span class="w"> </span><span class="n">nx</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="n">constant_tsc</span><span class="w"> </span><span class="n">arch_perfmon</span><span class="w"> </span><span class="n">pebs</span><span class="w"> </span><span class="n">bts</span><span class="w"> </span><span class="n">rep_good</span><span class="w"> </span><span class="n">nopl</span><span class="w"> </span><span class="n">cpuid</span><span class="w"> </span><span class="n">aperfmperf</span><span class="w"> </span><span class="n">pni</span><span class="w"> </span><span class="n">dtes64</span><span class="w"> </span><span class="n">monitor</span><span class="w"> </span><span class="n">ds_cpl</span><span class="w"> </span><span class="n">est</span><span class="w"> </span><span class="n">tm2</span><span class="w"> </span><span class="n">ssse3</span><span class="w"> </span><span class="n">cx16</span><span class="w"> </span><span class="n">xtpr</span><span class="w"> </span><span class="n">pdcm</span><span class="w"> </span><span class="n">dca</span><span class="w"> </span><span class="n">sse4_1</span><span class="w"> </span><span class="n">xsave</span><span class="w"> </span><span class="n">lahf_lm</span><span class="w"> </span><span class="n">pti</span><span class="w"> </span><span class="n">dtherm</span><span class="w"></span>
<span class="n">bugs</span><span class="w">            </span>: <span class="nc">cpu_meltdown</span><span class="w"> </span><span class="n">spectre_v1</span><span class="w"> </span><span class="n">spectre_v2</span><span class="w"> </span><span class="n">spec_store_bypass</span><span class="w"> </span><span class="n">l1tf</span><span class="w"> </span><span class="n">mds</span><span class="w"> </span><span class="n">swapgs</span><span class="w"> </span><span class="n">itlb_multihit</span><span class="w"></span>
<span class="n">bogomips</span><span class="w">        </span>: <span class="mf">5322.88</span><span class="w"></span>
<span class="n">clflush</span><span class="w"> </span><span class="n">size</span><span class="w">    </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">cache_alignment</span><span class="w"> </span>: <span class="mi">64</span><span class="w"></span>
<span class="n">address</span><span class="w"> </span><span class="n">sizes</span><span class="w">   </span>: <span class="mi">38</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="n">physical</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="kr">virtual</span><span class="w"></span>
<span class="n">power</span><span class="w"> </span><span class="n">management</span>:
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>