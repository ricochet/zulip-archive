<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4431 `wasmtime`: Implement fast Wasm stack... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html">wasmtime / PR #4431 `wasmtime`: Implement fast Wasm stack...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="289241274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289241274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289241274">(Jul 11 2022 at 19:48)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>:</p>
<blockquote>
<p>Why do we want Wasm stack walking to be fast? Because we capture stacks whenever<br>
there is a trap and traps actually happen fairly frequently with short-lived<br>
programs and WASI's <code>exit</code>.</p>
<p>Previously, we would rely on generating the system unwind info (e.g.<br>
<code>.eh_frame</code>) and using the system unwinder (via the <code>backtrace</code>crate) to walk<br>
the full stack and filter out any non-Wasm stack frames. This can,<br>
unfortunately, be slow for two primary reasons:</p>
<ol>
<li>
<p>The system unwinder is doing <code>O(all-kinds-of-frames)</code> work rather than<br>
<code>O(wasm-frames)</code> work.</p>
</li>
<li>
<p>System unwind info and the system unwinder need to be much more general than<br>
a purpose-built stack walker for Wasm needs to be. It has to handle any kind of<br>
stack frame that any compiler might emit where as our Wasm frames are emitted by<br>
Cranelift and always have frame pointers. This translates into implementation<br>
complexity and general overhead. There can also be unnecessary-for-our-use-cases<br>
global synchronization and locks involved, further slowing down stack walking in<br>
the presence of multiple threads trying to capture stacks in parallel.</p>
</li>
</ol>
<p>This commit introduces a purpose-built stack walker for traversing just our Wasm<br>
frames. To find all the sequences of Wasm-to-Wasm stack frames, and ignore<br>
non-Wasm stack frames, we keep a linked list of <code>(entry stack pointer, exit
frame pointer)</code> pairs. This linked list is maintained via Wasm-to-host and<br>
host-to-Wasm trampolines. Within a sequence of Wasm-to-Wasm calls, we can use<br>
frame pointers (which Cranelift preserves) to find the next older Wasm frame on<br>
the stack, and we keep doing this until we reach the entry stack pointer,<br>
meaning that the next older frame will be a host frame.</p>
<p>The trampolines need to avoid a couple stumbling blocks. First, they need to be<br>
compiled ahead of time, since we may not have access to a compiler at<br>
runtime (e.g. if the <code>cranelift</code> feature is disabled) but still want to be able<br>
to call functions that have already been compiled and get stack traces for those<br>
functions. Usually this means we would compile the appropriate trampolines<br>
inside <code>Module::new</code> and the compiled module object would hold the<br>
trampolines. However, we <em>also</em> need to support calling host functions that are<br>
wrapped into <code>wasmtime::Func</code>s and there doesn't exist <em>any</em> ahead-of-time<br>
compiled module object to hold the appropriate trampolines:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// Define a host function.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">func_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="n">FuncType</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="fm">vec!</span><span class="p">[</span><span class="n">wasmtime</span>::<span class="n">ValType</span>::<span class="n">I32</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="fm">vec!</span><span class="p">[</span><span class="n">wasmtime</span>::<span class="n">ValType</span>::<span class="n">I32</span><span class="p">],</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="kd">let</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Func</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">func_type</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="c1">// Call that host function.</span>
<span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="n">wasmtime</span>::<span class="n">Val</span>::<span class="n">I32</span><span class="p">(</span><span class="mi">0</span><span class="p">)];</span><span class="w"></span>
<span class="n">func</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="n">wasmtime</span>::<span class="n">Val</span>::<span class="n">I32</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Therefore, we define one host-to-Wasm trampoline and one Wasm-to-host trampoline<br>
in assembly that work for all Wasm and host function signatures. These<br>
trampolines are careful to only use volatile registers, avoid touching any<br>
register that is an argument in the calling convention ABI, and tail call to the<br>
target callee function. This allows forwarding any set of arguments and any<br>
returns to and from the callee, while also allowing us to maintain our linked<br>
list of Wasm stack and frame pointers before transferring control to the<br>
callee. These trampolines are not used in Wasm-to-Wasm calls, only when crossing<br>
the host-Wasm boundary, so they do not impose overhead on regular calls. (And if<br>
using one trampoline for all host-Wasm boundary crossing ever breaks branch<br>
prediction enough in the CPU to become any kind of bottleneck, we can do fun<br>
things like have multiple copies of the same trampoline and choose a random copy<br>
for each function, sharding the functions across branch predictor entries.)</p>
<p>Finally, this commit also ends the use of a synthetic <code>Module</code> and allocating a<br>
stubbed out <code>VMContext</code> for host functions. Instead, we define a<br>
<code>VMHostFuncContext</code> with its own magic value, similar to <code>VMComponentContext</code>,<br>
specifically for host functions.</p>
<p>&lt;h2&gt;Benchmarks&lt;/h2&gt;</p>
<p>&lt;h3&gt;Traps and Stack Traces&lt;/h3&gt;</p>
<p>Large improvements to taking stack traces on traps, ranging from shaving off 64%<br>
to 99.95% of the time it used to take.</p>
<p>&lt;details&gt;</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">0</span><span class="w">  </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.5686</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.5808</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.5934</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">0.0000</span><span class="w">  </span><span class="n">elem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">0.0000</span><span class="w">  </span><span class="n">elem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">0.0000</span><span class="w">  </span><span class="n">elem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">85.419</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">85.153</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">84.869</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">560.90</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">573.56</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">585.84</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">1</span><span class="w">  </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.9021</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.9167</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.9322</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">341.04</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">342.86</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">344.58</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">91.455</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">91.294</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">91.096</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">1023.1</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1048.6</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1070.3</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">2</span><span class="w">  </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.9996</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">3.0145</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">3.0295</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">660.18</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">663.47</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">666.76</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">94.040</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.910</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.762</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">1503.1</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1542.0</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1578.0</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">4</span><span class="w">  </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">5.5768</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">5.6052</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">5.6364</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">709.68</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">713.63</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">717.25</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">93.193</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.121</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.052</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">1339.2</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1353.6</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1369.1</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">8</span><span class="w">  </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">8.6408</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">9.1212</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">9.5438</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">838.24</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">877.08</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">925.84</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">94.754</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">94.473</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">94.202</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">1624.7</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1709.2</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1806.1</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">multi</span><span class="o">-</span><span class="n">threaded</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">16</span><span class="w"> </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">10.152</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">10.840</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">11.545</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">1.3858</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">1.4760</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">1.5761</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">97.042</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">96.823</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">96.577</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">2821.5</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">3048.1</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">3281.1</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>

<span class="n">many</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">registered</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.6278</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6361</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6447</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">378.11</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">379.35</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">380.55</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">85.311</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">85.108</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">84.909</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">562.65</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">571.51</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">580.76</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">9.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mf">6.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">many</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">registered</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">8</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.6294</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6460</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6623</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">3.0049</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">3.0235</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">3.0425</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">85.895</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">85.485</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">85.022</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">567.63</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">588.95</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">608.95</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">many</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">registered</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">64</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.6218</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6329</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6452</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">24.195</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">24.308</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">24.411</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">93.629</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.551</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">93.470</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">1431.4</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1450.6</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">1469.5</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="n">many</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">registered</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">512</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.6569</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6737</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.6923</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">190.17</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">191.50</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">192.71</span><span class="w"> </span><span class="n">Melem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">99.277</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">99.268</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">99.260</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mi">13417</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mi">13566</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mi">13731</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="mf">4.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="n">many</span><span class="o">-</span><span class="n">modules</span><span class="o">-</span><span class="n">registered</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">4096</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.7258</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.7390</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.7535</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">1.4876</span><span class="w"> </span><span class="n">Gelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">1.4955</span><span class="w"> </span><span class="n">Gelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">1.5027</span><span class="w"> </span><span class="n">Gelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">99.956</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">99.955</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">99.955</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mi">221417</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mi">223380</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mi">224881</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">2.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mf">1.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>

<span class="n">many</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">frames</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">1.4658</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">1.4719</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">1.4784</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">676.39</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">679.38</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mf">682.21</span><span class="w"> </span><span class="n">Kelem</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="n">change</span>:
                        <span class="nc">time</span>:   <span class="p">[</span><span class="o">-</span><span class="mf">90.368</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">89.947</span><span class="o">%</span><span class="w"> </span><span class="o">-</span><span class="mf">89.586</span><span class="o">%</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="o">+</span><span class="mf">860.23</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">894.72</span><span class="o">%</span><span class="w"> </span><span class="o">+</span><span class="mf">938.21</span><span class="o">%</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">Performance</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">improved</span><span class="p">.</span><span class="w"></span>
<span class="n">Found</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">outliers</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="p">(</span><span class="mf">8.00</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mf">5.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">mild</span><span class="w"></span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="mf">3.00</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">severe</span><span class="w"></span>
<span class="n">many</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">frames</span><span class="o">-</span><span class="n">traps</span><span class="o">/</span><span class="mi">8</span><span class="w"></span>
<span class="w">                        </span><span class="n">time</span>:   <span class="p">[</span><span class="mf">2.4772</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.4870</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="mf">2.4973</span><span class="w"> </span><span class="n">us</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="n">thrpt</span>:  <span class="p">[</span><span class="mf">3.2034</span><span class="w"></span>
<span class="p">[</span><span class="n">message</span><span class="w"> </span><span class="n">truncated</span><span class="p">]</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="289253813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253813">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1034958126">PR review</a>.</p>



<a name="289253814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253814">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1034958126">PR review</a>.</p>



<a name="289253815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253815">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r918369129">PR review comment</a>:</p>
<blockquote>
<p>I think technically this should be aligned up to the pointer size?</p>
</blockquote>



<a name="289253816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253816">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r918368133">PR review comment</a>:</p>
<blockquote>
<p>It might be worth pointing out that this is 64-bit only</p>
</blockquote>



<a name="289253817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253817">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r918374441">PR review comment</a>:</p>
<blockquote>
<p>You might want to add this constant to the asserts below as well</p>
</blockquote>



<a name="289253818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253818">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r918373695">PR review comment</a>:</p>
<blockquote>
<p>In the end this'll probably want to get folded into <code>get_pc</code> above to avoid duplicating the <code>cfg_if!</code></p>
</blockquote>



<a name="289253820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289253820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289253820">(Jul 11 2022 at 21:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r918372816">PR review comment</a>:</p>
<blockquote>
<p>We'll actually need to replace this check with some other boolean in a <code>store</code> since the non-recursive behavior here was necessary to implement the currently desired semantics (stack limit set only once) and we just piggy-backed on the canary being set.</p>
</blockquote>



<a name="289265801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289265801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289265801">(Jul 12 2022 at 00:23)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289365196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289365196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289365196">(Jul 12 2022 at 18:17)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289368822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289368822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289368822">(Jul 12 2022 at 18:46)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289526988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289526988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289526988">(Jul 13 2022 at 22:02)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r920549448">PR review comment</a>:</p>
<blockquote>
<p>Any suggestions of how to implement this check? Do we have anything already that we can piggy back on, the way we did with the stack canary, or do we need a new thing?</p>
</blockquote>



<a name="289526992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289526992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289526992">(Jul 13 2022 at 22:02)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1038030382">PR review</a>.</p>



<a name="289530356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289530356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289530356">(Jul 13 2022 at 22:41)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289533197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289533197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289533197">(Jul 13 2022 at 23:14)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289629829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289629829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289629829">(Jul 14 2022 at 18:21)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289643459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289643459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289643459">(Jul 14 2022 at 20:13)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1039425181">PR review</a>.</p>



<a name="289643460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289643460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289643460">(Jul 14 2022 at 20:13)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r921534308">PR review comment</a>:</p>
<blockquote>
<p>Sorry I meant to answer this earlier and forgot. I think <code>stack_limit</code> could be suitable for this in the <code>VMRuntimeLimits</code>. If it's <code>usize::MAX</code> then it should be reset, otherwise it should be not tampered with.</p>
</blockquote>



<a name="289643969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289643969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289643969">(Jul 14 2022 at 20:17)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289659412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289659412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289659412">(Jul 14 2022 at 22:39)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289715246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715246">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040162163">PR review</a>.</p>



<a name="289715247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715247">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040162163">PR review</a>.</p>



<a name="289715248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715248">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922073698">PR review comment</a>:</p>
<blockquote>
<p>Use either <code>X16</code> or <code>X17</code>, otherwise the code becomes incompatible with BTI.</p>
</blockquote>



<a name="289715249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715249">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922082048">PR review comment</a>:</p>
<blockquote>
<p>As line 56.</p>
</blockquote>



<a name="289715250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715250">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922076986">PR review comment</a>:</p>
<blockquote>
<p>As line 73.</p>
</blockquote>



<a name="289715251"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715251" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715251">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922081961">PR review comment</a>:</p>
<blockquote>
<p>Similarly to line 56, end with <code>.cfi_endproc</code>.</p>
</blockquote>



<a name="289715252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715252">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922082452">PR review comment</a>:</p>
<blockquote>
<p>As line 75.</p>
</blockquote>



<a name="289715253"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715253" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715253">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922082619">PR review comment</a>:</p>
<blockquote>
<p>As line 56.</p>
</blockquote>



<a name="289715254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289715254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289715254">(Jul 15 2022 at 11:35)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922082721">PR review comment</a>:</p>
<blockquote>
<p>As line 75.</p>
</blockquote>



<a name="289757329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757329">(Jul 15 2022 at 17:24)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040602911">PR review</a>.</p>



<a name="289757330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757330">(Jul 15 2022 at 17:24)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922377503">PR review comment</a>:</p>
<blockquote>
<p>All the CFI stuff will be fixed with using the macros in the <code>wasmtime-fibers</code> crate.</p>
</blockquote>



<a name="289757519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757519">(Jul 15 2022 at 17:26)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040604473">PR review</a>.</p>



<a name="289757520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757520">(Jul 15 2022 at 17:26)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922378610">PR review comment</a>:</p>
<blockquote>
<p>Specifically for the tail call, or only use these two registers in the whole trampoline? The first is very doable, the second a bit harder.</p>
</blockquote>



<a name="289757699"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757699" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757699">(Jul 15 2022 at 17:28)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040606416">PR review</a>.</p>



<a name="289757700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289757700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289757700">(Jul 15 2022 at 17:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922379969">PR review comment</a>:</p>
<blockquote>
<p>FWIW, you didn't leave a comment on line 56 so I'm not totally sure what you are referring to here. Given the context of the other comment referencing line 56, I assume this has to do with CFI pragmas? These will be handled once I start using the <code>wasmtime-fibers</code> crate's macros.</p>
</blockquote>



<a name="289758168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289758168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289758168">(Jul 15 2022 at 17:31)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040609999">PR review</a>.</p>



<a name="289758169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289758169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289758169">(Jul 15 2022 at 17:31)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922382469">PR review comment</a>:</p>
<blockquote>
<p>Just the tail call - the indirect branch is what would cause an issue.</p>
</blockquote>



<a name="289762089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762089">(Jul 15 2022 at 18:03)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="289762257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762257">(Jul 15 2022 at 18:04)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040640953">PR review</a>.</p>



<a name="289762258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762258">(Jul 15 2022 at 18:04)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922404964">PR review comment</a>:</p>
<blockquote>
<p>Please, start this function with:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">.</span><span class="n">cfi_startproc</span><span class="w"></span>
<span class="n">hint</span><span class="w"> </span>#<span class="mi">34</span><span class="w"> </span><span class="c1">// bti c</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="289762259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762259">(Jul 15 2022 at 18:04)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040640953">PR review</a>.</p>



<a name="289762365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762365">(Jul 15 2022 at 18:05)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r922405630">PR review comment</a>:</p>
<blockquote>
<p>Sorry, I must have accidentally deleted it; I have added it now.</p>
</blockquote>



<a name="289762366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289762366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289762366">(Jul 15 2022 at 18:05)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1040643034">PR review</a>.</p>



<a name="289774602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/289774602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#289774602">(Jul 15 2022 at 19:47)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290135374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290135374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290135374">(Jul 19 2022 at 17:41)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1043077511">PR review</a>.</p>



<a name="290135375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290135375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290135375">(Jul 19 2022 at 17:41)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r924245710">PR review comment</a>:</p>
<blockquote>
<p>The signature seems to be <code>[] → []</code> now</p>
</blockquote>



<a name="290135376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290135376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290135376">(Jul 19 2022 at 17:41)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1043077511">PR review</a>.</p>



<a name="290136831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290136831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290136831">(Jul 19 2022 at 17:52)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r924804070">PR review comment</a>:</p>
<blockquote>
<p>(In advance I want to apologize if this is not the right place to ask this)</p>
<p>I was working on <a href="https://github.com/bytecodealliance/wasmtime/pull/4466">this</a>, and there I was relying on the ability to dump the value of a pinned register (r15 on x86_64) to <code>VMRuntimeLimits</code> when leaving the wasm code. I'm not sure how to do the same with the tail call though. </p>
<p>Do you have any recommendations about that? Should I just introduce my own set of trampolines?</p>
<p>Thanks</p>
</blockquote>



<a name="290136832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290136832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290136832">(Jul 19 2022 at 17:52)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1043861803">PR review</a>.</p>



<a name="290167510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167510">(Jul 19 2022 at 22:06)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290167532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167532">(Jul 19 2022 at 22:07)</a>:</h4>
<p><strong>fitzgen</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> as ready for review.</p>



<a name="290167550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167550">(Jul 19 2022 at 22:07)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a>.</p>



<a name="290167557"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167557" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167557">(Jul 19 2022 at 22:07)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/akirilov-arm">akirilov-arm</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a>.</p>



<a name="290167770"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167770" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167770">(Jul 19 2022 at 22:09)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290167782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167782">(Jul 19 2022 at 22:09)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1044135797">PR review</a>.</p>



<a name="290167783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290167783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290167783">(Jul 19 2022 at 22:09)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r924996181">PR review comment</a>:</p>
<blockquote>
<p>Good eye! Fixed.</p>
</blockquote>



<a name="290168001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290168001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290168001">(Jul 19 2022 at 22:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1044137428">PR review</a>.</p>



<a name="290168002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290168002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290168002">(Jul 19 2022 at 22:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r924997482">PR review comment</a>:</p>
<blockquote>
<p>I think you can do that in these existing trampolines. Depending on the overhead, we might do it unconditionally, even if slacked fuel wasn't enabled, or we might have a different version of the Wasm-to-host trampoline for when that feature is enabled (although this risks combinatorial blow up if we have to keep adding more trampolines for more features).</p>
</blockquote>



<a name="290235649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290235649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290235649">(Jul 20 2022 at 13:39)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045049551">PR review</a>.</p>



<a name="290235650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290235650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290235650">(Jul 20 2022 at 13:39)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925620493">PR review comment</a>:</p>
<blockquote>
<p>Yeah, that was my first impression as well, but later I realized that the r15, the fuel counter, has to be dumped after the wasm returns. The tail call makes the wasm return directly to the host, skipping the trampoline on the exit path.</p>
<p>If we replaced the <code>jmp</code> with a call, we would be able to place the r15 dumping code after the call, but as you mention, that would mess up stack arguments.<br>
</p>
</blockquote>



<a name="290236074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290236074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290236074">(Jul 20 2022 at 13:43)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045055165">PR review</a>.</p>



<a name="290236076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290236076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290236076">(Jul 20 2022 at 13:43)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925624322">PR review comment</a>:</p>
<blockquote>
<p>Now, giving it a little thought, it is also unclear what "my own set of trampolines" would do, since they will have to deal with the same problem: call the wasm callee with the arguments that were passed by the host caller.</p>
<p>Perhaps something along the lines of would work:</p>
<p>In the trampoline, stash the original return address (pointing to the host) somewhere and replace it with another new address. That new address would point to a "trampoline continuation". That continuation would dump r15 into vmctx, unstash the original return address and then return.</p>
<p>There has to be a better way though...</p>
</blockquote>



<a name="290249875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249875">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045188875">PR review</a>.</p>



<a name="290249876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249876">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045188875">PR review</a>.</p>



<a name="290249877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249877">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925717382">PR review comment</a>:</p>
<blockquote>
<p>Could this be expanded with a little bit about how we do stack walking today? Mostly just mentioning that frame pointers are required in wasm code and we use custom asm trampolines when entering and exiting wasm to ensure we record the boundaries of contiguous wasm stacks.</p>
</blockquote>



<a name="290249878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249878">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925719479">PR review comment</a>:</p>
<blockquote>
<p>Could this grow some docs to explain which trampoline sets these fields and why they're expected to be valid here?</p>
</blockquote>



<a name="290249879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249879">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925715742">PR review comment</a>:</p>
<blockquote>
<p>On second thought, do we actually need this file at all? The <code>VMOffsets</code> stuff is only related to "the compiler needs to know about offsets for the target" but I don't think any compilation we do actually modfiies a <code>VMHostFuncContext</code> at all, right? We could change the test assertions for the offsets to using the real structs I think?</p>
</blockquote>



<a name="290249880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249880">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925720143">PR review comment</a>:</p>
<blockquote>
<p>I forget why this condition is necessary now, could you add some docs to this?</p>
</blockquote>



<a name="290249881"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249881" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249881">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925721354">PR review comment</a>:</p>
<blockquote>
<p>Perhaps actually remove the condition here so other platforms can add conditions as appropriate? (if they don't already fall back to this case)</p>
</blockquote>



<a name="290249882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249882">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925722673">PR review comment</a>:</p>
<blockquote>
<p>I mentioned this before, but personally I think it would be best to cut down on the <code>cfg_if!</code> here. I'd rather not have a duplicated set within each function. Could this instead move to the architecture-specific modules in the <code>wasmtime-runtime</code> crate?</p>
</blockquote>



<a name="290249883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249883">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925725376">PR review comment</a>:</p>
<blockquote>
<p>A note to fill out this TODO before landing</p>
</blockquote>



<a name="290249884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249884">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925718754">PR review comment</a>:</p>
<blockquote>
<p>Could this grow some documentation to explain what <code>initial_pc_and_fp</code> are?</p>
</blockquote>



<a name="290249885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249885">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925725795">PR review comment</a>:</p>
<blockquote>
<p>Perhaps delegate to <code>set_callee</code> above?</p>
</blockquote>



<a name="290249886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249886">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925731830">PR review comment</a>:</p>
<blockquote>
<p>note to fill this out a bit more</p>
</blockquote>



<a name="290249887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249887">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925731485">PR review comment</a>:</p>
<blockquote>
<p>Do you think it's worth going ahead and adding one of these assembly trampolines for all libcalls? Otherwise we could run the risk of if a gc happens during an otherwise-unrelated libcall that could incorrectly generate a backtrace I think?</p>
<p>Also do you think there's a way for us to guarantee that the asm wrapper is used once-per-libcall? Otherwise we might accidentally forget to use this macro.</p>
</blockquote>



<a name="290249888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249888">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925732612">PR review comment</a>:</p>
<blockquote>
<p>Could you add some notes to the docs here about the unsafety and how <code>T</code> must be carefully selected?</p>
</blockquote>



<a name="290249889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249889">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925733831">PR review comment</a>:</p>
<blockquote>
<p>I think this may actually be able to be <code>bti c</code> instead of <code>hint #34</code> since I presume LLVM's internal assembler is a bit more modern than random ancient binutils assemblers.</p>
</blockquote>



<a name="290249890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249890">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925739178">PR review comment</a>:</p>
<blockquote>
<p>We should probably ping Chris or some embark folks to double-check that this PR passes tests on macOS when CI is otherwise green here and ready to go to double-check this.</p>
</blockquote>



<a name="290249891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249891">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925734257">PR review comment</a>:</p>
<blockquote>
<p>I think we've resolved this "TODO" </p>
</blockquote>



<a name="290249892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249892">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925737928">PR review comment</a>:</p>
<blockquote>
<p>Could you add some words to why this is done?</p>
</blockquote>



<a name="290249893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249893">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925741286">PR review comment</a>:</p>
<blockquote>
<p>bump here on the TODO (and the note I had below about reusing the stack limit as the "canary" here)</p>
</blockquote>



<a name="290249894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290249894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290249894">(Jul 20 2022 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925723653">PR review comment</a>:</p>
<blockquote>
<p>Also, for each of these small helpers, could you add some architecture-specific documentation as to why the function body is the way it is?</p>
</blockquote>



<a name="290258047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290258047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290258047">(Jul 20 2022 at 16:12)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045216660">PR review</a>.</p>



<a name="290258048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290258048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290258048">(Jul 20 2022 at 16:12)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925789537">PR review comment</a>:</p>
<blockquote>
<p>Is this still needed or is it a leftover?</p>
</blockquote>



<a name="290258049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290258049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290258049">(Jul 20 2022 at 16:12)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925736356">PR review comment</a>:</p>
<blockquote>
<p>Do you think this could use the same test as for <code>wasm_to_host_trampoline_offsets_tests</code>, just for documentation purposes?</p>
</blockquote>



<a name="290258050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290258050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290258050">(Jul 20 2022 at 16:12)</a>:</h4>
<p>pepyakin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r925804464">PR review comment</a>:</p>
<blockquote>
<p>FWIW, it does not compile on my machine:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0609</span><span class="p">]</span>: <span class="nc">no</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="err">`</span><span class="n">__opaque_fp</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">__darwin_arm_thread_state64</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">unix</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">223</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">223</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">(</span><span class="o">*</span><span class="n">cx</span><span class="p">.</span><span class="n">uc_mcontext</span><span class="p">).</span><span class="n">__ss</span><span class="p">.</span><span class="n">__opaque_fp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                        </span><span class="o">^^^^^^^^^^^</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">field</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">available</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">are</span>: <span class="err">`</span><span class="n">__x</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__fp</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__lr</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__sp</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__pc</span><span class="err">`</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">others</span><span class="w"></span>
</code></pre></div>
<p>if changed to <code>__fp</code> I am getting linking errors related to libcalls</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">symbols</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">architecture</span><span class="w"> </span><span class="n">arm64</span>:
            <span class="s">"__wasmtime_out_of_gas"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_out_of_gas</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_out_of_gas</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h82a1f6dfe40ded68</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_out_of_gas</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_atomic_wait64"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_atomic_wait64</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">___wasmtime_memory_atomic_wait64</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_atomic_wait64</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h0572dbcd971fc0ae</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_table_copy"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_table_copy</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_table_copy</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h8a12719fb9aadf1b</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_table_copy</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_atomic_notify"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_atomic_notify</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_atomic_notify</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h6e6f4ca809ea38f9</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_memory_atomic_notify</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_init"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_init</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_init</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hda18b620453f6e32</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_memory_init</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_fill"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_fill</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_fill</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h16f10cadc9476e42</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_memory_fill</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_atomic_wait32"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_atomic_wait32</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_atomic_wait32</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h560d4d674b202c95</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_memory_atomic_wait32</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_table_init"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_table_init</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_table_init</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">he5e1a78b56db45b4</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_table_init</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_table_fill"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_table_fill</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_table_fill</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hf8b7ce102ac3de7a</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_table_fill</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory_copy"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory_copy</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">___wasmtime_memory_copy</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory_copy</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h89a592f83dabef04</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_table_grow"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_table_grow</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_table_grow</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hdaa1831af98473b5</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_table_grow</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_new_epoch"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_new_epoch</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_new_epoch</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h1a92330ea38f0813</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_new_epoch</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="s">"__wasmtime_memory32_grow_impl"</span><span class="p">,</span><span class="w"> </span><span class="n">referenced</span><span class="w"> </span><span class="n">from</span>:
                <span class="nc">_memory32_grow</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libwasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="n">rlib</span><span class="p">(</span><span class="n">wasmtime_runtime</span><span class="o">-</span><span class="n">dbb96764d3b18906</span><span class="p">.</span><span class="mi">44</span><span class="n">jpaurkbhy60k2w</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">maybe</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">meant</span>: <span class="nc">wasmtime_runtime</span>::<span class="n">libcalls</span>::<span class="n">__wasmtime_memory32_grow_impl</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hd067c3bee9e773e8</span><span class="p">,</span><span class="w"> </span><span class="n">___wasmtime_memory32_grow_impl</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">ld</span>: <span class="nc">symbol</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">architecture</span><span class="w"> </span><span class="n">arm64</span><span class="w"></span>
<span class="w">          </span><span class="n">clang</span>: <span class="nc">error</span>: <span class="nc">linker</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">invocation</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>If I build without <code>posix-signals-on-macos</code> I'd get this:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span><span class="p">[</span><span class="n">E0308</span><span class="p">]</span>: <span class="nc">mismatched</span><span class="w"> </span><span class="n">types</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">macos</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">388</span>:<span class="mi">33</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">388</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">state</span><span class="p">.</span><span class="n">capture_backtrace</span><span class="p">(</span><span class="n">wasm_pc</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                 </span><span class="o">^^^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="k">enum</span> <span class="err">`</span><span class="n">std</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">*-</span><span class="n">ptr</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>:     <span class="nc">expected</span><span class="w"> </span><span class="k">enum</span> <span class="err">`</span><span class="n">std</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="err">`</span><span class="w"></span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="err">`</span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u8</span><span class="err">`</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="290258051"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290258051" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290258051">(Jul 20 2022 at 16:12)</a>:</h4>
<p>pepyakin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1045216660">PR review</a>.</p>



<a name="290284274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290284274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290284274">(Jul 20 2022 at 19:13)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290284590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290284590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290284590">(Jul 20 2022 at 19:15)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290408303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290408303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290408303">(Jul 21 2022 at 17:34)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290409830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290409830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290409830">(Jul 21 2022 at 17:47)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290413520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290413520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290413520">(Jul 21 2022 at 18:17)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290418045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418045">(Jul 21 2022 at 18:51)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290418442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418442">(Jul 21 2022 at 18:54)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047003116">PR review</a>.</p>



<a name="290418444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418444">(Jul 21 2022 at 18:54)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927008740">PR review comment</a>:</p>
<blockquote>
<p>Hi @uweigand, would you mind suggesting wording for some comments for these functions similar to those in the <code>x86_64.rs</code> file just below? I'm not familiar enough to add the docs that Alex requested in review myself.</p>
</blockquote>



<a name="290418521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418521">(Jul 21 2022 at 18:54)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047003573">PR review</a>.</p>



<a name="290418522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418522">(Jul 21 2022 at 18:54)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927009057">PR review comment</a>:</p>
<blockquote>
<p>Hi @akirilov-arm, would you mind suggesting wording for some comments for these functions similar to those in the <code>x86_64.rs</code> file just below? I'm not familiar enough to add the docs that Alex requested in review myself. Thanks!</p>
</blockquote>



<a name="290418582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418582">(Jul 21 2022 at 18:55)</a>:</h4>
<p>fitzgen edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927008740">PR review comment</a>.</p>



<a name="290418853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418853">(Jul 21 2022 at 18:56)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047005438">PR review</a>.</p>



<a name="290418854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290418854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290418854">(Jul 21 2022 at 18:56)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927010402">PR review comment</a>:</p>
<blockquote>
<p>Split everything out into modules, but haven't added non-x64 docs yet (pinged folks for help with that).</p>
</blockquote>



<a name="290419540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290419540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290419540">(Jul 21 2022 at 19:01)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927014005">PR review comment</a>:</p>
<blockquote>
<p>get_next_older_pc_from_fp:</p>
<blockquote>
<p>The next older PC can be found in register %r14 at function entry, which was saved into slot 14 of the register save area pointed to by 'FP' (the backchain pointer).</p>
</blockquote>
<p>get_next_older_fp_from_fp:</p>
<blockquote>
<p>The next older 'FP' (backchain pointer) was saved in the slot pointed to by the current 'FP'.</p>
</blockquote>
<p>reached_entry_sp:</p>
<blockquote>
<p>The 'FP' (backchain pointer) holds the value of the stack pointer at function entry. If this equals the value the stack pointer had when we first entered a Wasm function, we are done.<br>
</p>
</blockquote>
</blockquote>



<a name="290419541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290419541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290419541">(Jul 21 2022 at 19:01)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047010551">PR review</a>.</p>



<a name="290419879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290419879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290419879">(Jul 21 2022 at 19:04)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047013229">PR review</a>.</p>



<a name="290419898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290419898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290419898">(Jul 21 2022 at 19:04)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927015904">PR review comment</a>:</p>
<blockquote>
<p>Not much to say about the stack alignment except that the ABI guarantees 8-byte alignment at all times, and we cannot in general expect anything more.</p>
</blockquote>



<a name="290424050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290424050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290424050">(Jul 21 2022 at 19:39)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290424282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290424282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290424282">(Jul 21 2022 at 19:41)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047053940">PR review</a>.</p>



<a name="290424283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290424283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290424283">(Jul 21 2022 at 19:41)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927042383">PR review comment</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="290435505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290435505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290435505">(Jul 21 2022 at 21:19)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290435688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290435688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290435688">(Jul 21 2022 at 21:21)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047153071">PR review</a>.</p>



<a name="290435690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290435690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290435690">(Jul 21 2022 at 21:21)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927112725">PR review comment</a>:</p>
<blockquote>
<p>We generally write failing test cases to <code>test.wa{t,sm}</code> for fuzz tests and smoke tests like this so it is easier to debug. They are only written if the test fails, so won't otherwise spew stuff to the file system during normal operation.</p>
</blockquote>



<a name="290435790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290435790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290435790">(Jul 21 2022 at 21:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927113203">PR review comment</a>:</p>
<blockquote>
<p>I intentionally chose to have two tests so that if they evolve in different directions in the future we can update each respective test and not accidentally leave one trampoline's offsets untested.</p>
</blockquote>



<a name="290435791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290435791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290435791">(Jul 21 2022 at 21:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047153815">PR review</a>.</p>



<a name="290496898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290496898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290496898">(Jul 22 2022 at 12:05)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927585678">PR review comment</a>:</p>
<blockquote>
<p>Technically there is no alignment requirement for the frame pointer - in fact, if my reading of the AAPCS64 is correct (<code>The location of the frame record within a stack frame is not specified.</code>), then it could even be completely unaligned (or at the very least aligned on 8 bytes)! However, it is probably still useful to leave this check as is.</p>
</blockquote>



<a name="290496899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290496899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290496899">(Jul 22 2022 at 12:05)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047808619">PR review</a>.</p>



<a name="290497007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290497007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290497007">(Jul 22 2022 at 12:06)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047809775">PR review</a>.</p>



<a name="290497009"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290497009" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290497009">(Jul 22 2022 at 12:06)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927586445">PR review comment</a>:</p>
<blockquote>
<p>I don't there is any need for a comment here - the assertion says everything that needs to be stated.</p>
</blockquote>



<a name="290497029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290497029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290497029">(Jul 22 2022 at 12:06)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927586445">PR review comment</a>.</p>



<a name="290501613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290501613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290501613">(Jul 22 2022 at 12:50)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927620199">PR review comment</a>:</p>
<blockquote>
<p>Here is a direct quote from <a href="https://github.com/ARM-software/abi-aa/blob/2022Q1/aapcs64/aapcs64.rst#the-frame-pointer">section 6.2.3</a> of the Procedure Call Standard for the Arm® 64-bit Architecture (AAPCS64):</p>
<blockquote>
<p>Conforming code shall construct a linked list of stack-frames. Each frame shall link to the frame of its caller by means of a frame record of two 64-bit values on the stack (independent of the data model). The frame record for the innermost frame (belonging to the most recent routine invocation) shall be pointed to by the frame pointer register (FP). The lowest addressed double-word shall point to the previous frame record and the highest addressed double-word shall contain the value passed in LR on entry to the current function. If code uses the pointer signing extension to sign return addresses, the value in LR must be signed before storing it in the frame record. The end of the frame record chain is indicated by the address zero in the address for the previous frame. The location of the frame record within a stack frame is not specified.</p>
</blockquote>
<p>It can be trimmed to:</p>
<blockquote>
<p>Each frame shall link to the frame of its caller by means of a frame record of two 64-bit values on the stack [...] The frame record for the innermost frame [...] shall be pointed to by the frame pointer register (FP). The lowest addressed double-word shall point to the previous frame record and the highest addressed double-word shall contain the value passed in LR on entry to the current function.</p>
</blockquote>
<p>I think it covers both this function and <code>get_next_older_fp_from_fp()</code>.</p>
</blockquote>



<a name="290501614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290501614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290501614">(Jul 22 2022 at 12:50)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047858710">PR review</a>.</p>



<a name="290504883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290504883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290504883">(Jul 22 2022 at 13:20)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1047895575">PR review</a>.</p>



<a name="290504884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290504884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290504884">(Jul 22 2022 at 13:20)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927645349">PR review comment</a>:</p>
<blockquote>
<p>Maybe add a comment stating that we do not support big-endian AArch64 (also on line 46)?</p>
</blockquote>



<a name="290507891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290507891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290507891">(Jul 22 2022 at 13:48)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r927586445">PR review comment</a>.</p>



<a name="290830221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290830221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290830221">(Jul 25 2022 at 23:03)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290832725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290832725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290832725">(Jul 25 2022 at 23:34)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290885123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290885123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290885123">(Jul 26 2022 at 12:42)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1050913218">PR review</a>.</p>



<a name="290885124"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290885124" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290885124">(Jul 26 2022 at 12:42)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r929915996">PR review comment</a>:</p>
<blockquote>
<p>I added comments for each function.</p>
</blockquote>



<a name="290917168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290917168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290917168">(Jul 26 2022 at 16:14)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1051271669">PR review</a>.</p>



<a name="290917169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290917169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290917169">(Jul 26 2022 at 16:14)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r930167682">PR review comment</a>:</p>
<blockquote>
<p>Thanks, I saw, just haven't gotten around to adding them yet. Appreciated!</p>
</blockquote>



<a name="290925919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290925919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290925919">(Jul 26 2022 at 17:15)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290930527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290930527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290930527">(Jul 26 2022 at 17:45)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290939991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290939991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290939991">(Jul 26 2022 at 18:56)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="290954035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/290954035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#290954035">(Jul 26 2022 at 20:48)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a>.</p>



<a name="291054391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054391">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931125713">PR review comment</a>:</p>
<blockquote>
<p>This condition feels a bit funny to me so I'm wondering if we can add more strict assertions around this perhaps. The bug with components is that the pc/fp aren't set here on exit back into the host, and I was hoping that an assertion would trip somewhere in this code to indicate such.</p>
<p>I know that we have a -1 sentinel to get encoded for a host-&gt;host call but otherwise I think we should always have this set and we can assert as much? (or... something like that)</p>
</blockquote>



<a name="291054392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054392">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931180599">PR review comment</a>:</p>
<blockquote>
<p>Is this still necessary with the <code>.iter()</code> method below?</p>
</blockquote>



<a name="291054393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054393">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931130808">PR review comment</a>:</p>
<blockquote>
<p>Could this assert that the <code>fp</code> has some relation to <code>first_wasm_sp</code>? (e.g. one of the <code>arch::*</code>-specific functions I think should return <code>true</code>?</p>
</blockquote>



<a name="291054394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054394">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931178266">PR review comment</a>:</p>
<blockquote>
<p>Personally I feel that this macro is still too complicated for its own good, but I sent you <a href="https://github.com/fitzgen/wasmtime/pull/7">https://github.com/fitzgen/wasmtime/pull/7</a> which is what I was thinking of how to simplify it.</p>
</blockquote>



<a name="291054395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054395">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052597859">PR review</a>.</p>



<a name="291054396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054396">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052597859">PR review</a>.</p>



<a name="291054397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054397">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931181703">PR review comment</a>:</p>
<blockquote>
<p>Is this still necessary? Ideally this'd stay private to this module to avoid having to reason about the rest of the crate</p>
</blockquote>



<a name="291054398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054398">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931189585">PR review comment</a>:</p>
<blockquote>
<p>Could this use <code>VMOpaqueContext::from_vm_host_func_context</code>?</p>
</blockquote>



<a name="291054399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054399">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931192518">PR review comment</a>:</p>
<blockquote>
<p>To clarify, is this something you plan to take on or is this something I should plan to look into?</p>
</blockquote>



<a name="291054400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054400">(Jul 27 2022 at 15:17)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931185683">PR review comment</a>:</p>
<blockquote>
<p>This was marked as resolved, but inside the resolved comment is an indication that this isn't the right name?</p>
<p>Locally I get:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">AR</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">CC</span><span class="o">=</span><span class="kc">true</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">aarch64</span><span class="o">-</span><span class="n">apple</span><span class="o">-</span><span class="n">darwin</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">posix</span><span class="o">-</span><span class="n">signals</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">macos</span><span class="w"></span>
<span class="w">    </span><span class="n">Checking</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">40.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">acrichto</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">runtime</span><span class="p">)</span><span class="w"></span>
<span class="n">error</span><span class="p">[</span><span class="n">E0609</span><span class="p">]</span>: <span class="nc">no</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="err">`</span><span class="n">__opaque_fp</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="n">__darwin_arm_thread_state64</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">unix</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">223</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">223</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">(</span><span class="o">*</span><span class="n">cx</span><span class="p">.</span><span class="n">uc_mcontext</span><span class="p">).</span><span class="n">__ss</span><span class="p">.</span><span class="n">__opaque_fp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                        </span><span class="o">^^^^^^^^^^^</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">field</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">available</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">are</span>: <span class="err">`</span><span class="n">__x</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__fp</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__lr</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__sp</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="err">`</span><span class="n">__pc</span><span class="err">`</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">others</span><span class="w"></span>

<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0609</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="err">`</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="291054402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291054402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291054402">(Jul 27 2022 at 15:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931129194">PR review comment</a>:</p>
<blockquote>
<p>This also of relates to the <code>if state.old_last_wasm_exit_pc == 0 {</code> below in the <code>for state in state.iter()</code> loop. Mostly I'm just curious if you can add some extra degree of assertions about perhaps some other fields or something like that.</p>
<p>Is it possible to assert <code>pc != 0</code> here? Or otherwise make this conditional on the entry sp where if the entry sp is -1 then that's a host-&gt;host <code>CallThreadState</code> which has no frames, but otherwise some wasm should have been executed to yield frames.</p>
</blockquote>



<a name="291058856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291058856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291058856">(Jul 27 2022 at 15:47)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291058996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291058996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291058996">(Jul 27 2022 at 15:48)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052745307">PR review</a>.</p>



<a name="291058997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291058997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291058997">(Jul 27 2022 at 15:48)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931228801">PR review comment</a>:</p>
<blockquote>
<p>Ah seems something got lost in a rebase.</p>
</blockquote>



<a name="291059220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291059220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291059220">(Jul 27 2022 at 15:50)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052747447">PR review</a>.</p>



<a name="291059221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291059221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291059221">(Jul 27 2022 at 15:50)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931230355">PR review comment</a>:</p>
<blockquote>
<p>I can look into the cranelift side of things but will probably need to ask you lots of questions about the component trampolines themselves.</p>
</blockquote>



<a name="291060236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291060236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291060236">(Jul 27 2022 at 15:57)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931238621">PR review comment</a>:</p>
<blockquote>
<p>The <code>backtrace</code> module has two calls to <code>tls::with(...)</code>. I guess we could do <code>pub(super::backtrace)</code> or whatever the syntax is (I think I've only ever used <code>pub(crate)</code> and <code>pub(super)</code> before). Or we could make the <code>backtrace</code> module a submodule of <code>traphandlers</code>.</p>
</blockquote>



<a name="291060238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291060238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291060238">(Jul 27 2022 at 15:57)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052758659">PR review</a>.</p>



<a name="291060470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291060470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291060470">(Jul 27 2022 at 15:59)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052761382">PR review</a>.</p>



<a name="291060471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291060471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291060471">(Jul 27 2022 at 15:59)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931240571">PR review comment</a>:</p>
<blockquote>
<p>It is used in a debug assertion inside <code>Backtrace::trace_with_trap_state</code>. Maybe I will make the <code>backtrace</code> module a submodule of <code>traphandlers</code>, since it is the only thing that wants access to these otherwise-private fields.</p>
</blockquote>



<a name="291070410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291070410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291070410">(Jul 27 2022 at 16:10)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931251895">PR review comment</a>:</p>
<blockquote>
<p>Ah ok, no need to do <code>pub(super::backtrace)</code>, but your other suggestion of moving <code>backtrace</code> as a submodule sounds reasonable to me.</p>
</blockquote>



<a name="291070412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291070412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291070412">(Jul 27 2022 at 16:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052777550">PR review</a>.</p>



<a name="291070589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291070589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291070589">(Jul 27 2022 at 16:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052779353">PR review</a>.</p>



<a name="291070590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291070590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291070590">(Jul 27 2022 at 16:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931253141">PR review comment</a>:</p>
<blockquote>
<p>Ok sounds good to me. Given cranelift "intrinsics" for getting the fp/return-pc I think it'll be relatively easy to fold in the necessary support into the component trampolines.</p>
</blockquote>



<a name="291082084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082084">(Jul 27 2022 at 17:34)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052884620">PR review</a>.</p>



<a name="291082085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082085">(Jul 27 2022 at 17:34)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052884620">PR review</a>.</p>



<a name="291082086"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082086" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082086">(Jul 27 2022 at 17:34)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931328251">PR review comment</a>:</p>
<blockquote>
<p>One small detail - <code>word</code> is a loaded term in the Arm architecture, and in this context certainly wrong, since it means 32 bits (the AAPCS64 also provides the same definition in section 5.1); up to you whether you use the architecture-neutral <code>64 bits</code> or the correct <code>double-word</code>.</p>
</blockquote>



<a name="291082088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082088">(Jul 27 2022 at 17:34)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931328401">PR review comment</a>:</p>
<blockquote>
<p>Ditto.</p>
</blockquote>



<a name="291082762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082762">(Jul 27 2022 at 17:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052889935">PR review</a>.</p>



<a name="291082763"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291082763" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291082763">(Jul 27 2022 at 17:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931331816">PR review comment</a>:</p>
<blockquote>
<p>FWIW these terms are loaded in x86-land as well: "word" means 16 bits (still to this day, e.g. with a <code>.word</code> directive in GNU as assembler), "double word" or "dword" means 32 bits, and "quad word" or "qword" means 64 bits. These names appear at least in assembly but also e.g. in Windows APIs, and differ between architectures as we see here, and so I try to avoid them altogether and just say "64 bits" / "u64" / "8 bytes above FP" / ... as appropriate for context.</p>
</blockquote>



<a name="291083641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291083641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291083641">(Jul 27 2022 at 17:44)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931337348">PR review comment</a>:</p>
<blockquote>
<p>Personally I am fine with using the loaded terms in bits of code that are obviously architecture-specific such as this file, but have no preference otherwise, other than using the correct term, of course. Note that we are providing a direct quote from the AAPCS64 that uses both kinds of terms.</p>
</blockquote>



<a name="291083642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291083642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291083642">(Jul 27 2022 at 17:44)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1052897622">PR review</a>.</p>



<a name="291089136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291089136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291089136">(Jul 27 2022 at 18:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1053010632">PR review</a>.</p>



<a name="291089137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291089137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291089137">(Jul 27 2022 at 18:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#discussion_r931421586">PR review comment</a>:</p>
<blockquote>
<p>I don't think so? Because the host has no guarantees of preserving frame pointers and the FP is the host's FP in this situation, so I don't think we can assert any sort of relation here.</p>
</blockquote>



<a name="291096215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291096215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291096215">(Jul 27 2022 at 19:07)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291104835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291104835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291104835">(Jul 27 2022 at 20:20)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4431#pullrequestreview-1053178854">PR review</a>.</p>



<a name="291113541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291113541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291113541">(Jul 27 2022 at 21:35)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291121827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291121827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291121827">(Jul 27 2022 at 23:02)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291127943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291127943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291127943">(Jul 28 2022 at 00:31)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291214781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291214781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291214781">(Jul 28 2022 at 16:04)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291218071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291218071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291218071">(Jul 28 2022 at 16:30)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291223958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291223958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291223958">(Jul 28 2022 at 17:15)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291258070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291258070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291258070">(Jul 28 2022 at 22:02)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a> from <code>fast-stack-walking</code> to <code>main</code>.</p>



<a name="291262417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234431%20%60wasmtime%60%3A%20Implement%20fast%20Wasm%20stack.../near/291262417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234431.20.60wasmtime.60.3A.20Implement.20fast.20Wasm.20stack.2E.2E.2E.html#291262417">(Jul 28 2022 at 22:46)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4431">PR #4431</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>