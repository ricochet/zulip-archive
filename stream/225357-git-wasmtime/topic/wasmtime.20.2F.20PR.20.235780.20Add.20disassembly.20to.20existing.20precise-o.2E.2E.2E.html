<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5780 Add disassembly to existing precise-o... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html">wasmtime / PR #5780 Add disassembly to existing precise-o...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="327871268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327871268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327871268">(Feb 14 2023 at 20:52)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>:</p>
<blockquote>
<ul>
<li>Add disassembly to precise-output tests</li>
<li>Bless existing tests</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="327871626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327871626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327871626">(Feb 14 2023 at 20:54)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298409869">PR review</a>.</p>



<a name="327871628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327871628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327871628">(Feb 14 2023 at 20:54)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106361091">PR review comment</a>:</p>
<blockquote>
<p>I'm not happy with how much code was inlined from clif-util here, maybe there's a better place for common testing code like this?</p>
</blockquote>



<a name="327871975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327871975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327871975">(Feb 14 2023 at 20:56)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>:</p>
<blockquote>
<p>Check both the printed vcode and capstone output in <code>precise-output</code> tests. This lets us continue to rely on printing backend-specific pseudoinstructions in the VCode output (for instance <code>br_table</code> on x64), while also checking the final output of the machinst buffer.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="327872033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872033">(Feb 14 2023 at 20:57)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> as ready for review.</p>



<a name="327872685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872685">(Feb 14 2023 at 21:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298410084">PR review</a>.</p>



<a name="327872686"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872686" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872686">(Feb 14 2023 at 21:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298410084">PR review</a>.</p>



<a name="327872687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872687">(Feb 14 2023 at 21:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106361241">PR review comment</a>:</p>
<blockquote>
<p>There are a few cases, like here, where the disassembly loses some info because it doesn't carry the metadata -- in this case, a relocation (the call target). Not so important for this particular test but it would be good to audit for this somehow -- any thoughts?</p>
</blockquote>



<a name="327872688"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872688" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872688">(Feb 14 2023 at 21:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106362830">PR review comment</a>:</p>
<blockquote>
<p>We could put a <code>.to_capstone()</code> method on <code>TargetIsa</code> and enable it only under a <code>capstone</code> Cargo feature, so we don't unconditionally pull it in but rather only for <code>cranelift-tools</code>.</p>
</blockquote>



<a name="327872689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327872689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327872689">(Feb 14 2023 at 21:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106365764">PR review comment</a>:</p>
<blockquote>
<p>We <em>probably</em> don't need the machine-code bytes alongside the instructions in the golden-compile tests (we test that separately in multiple ways, via assembler tests and end-to-end execution tests, and the point isn't to test Capstone's decoding of bytes to instructions).</p>
</blockquote>



<a name="327873095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873095">(Feb 14 2023 at 21:03)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298428486">PR review</a>.</p>



<a name="327873097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873097">(Feb 14 2023 at 21:03)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106372896">PR review comment</a>:</p>
<blockquote>
<p>Great point! The output would be a lot less noisy without that.</p>
</blockquote>



<a name="327873383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873383">(Feb 14 2023 at 21:05)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298424247">PR review</a>.</p>



<a name="327873384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873384">(Feb 14 2023 at 21:05)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298424247">PR review</a>.</p>



<a name="327873385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873385">(Feb 14 2023 at 21:05)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106370346">PR review comment</a>:</p>
<blockquote>
<p>Perhaps we should not display the instruction address here? Inserting or deleting an instruction will renumber all the later instructions, causing more diff churn in filetests later.</p>
<p>Also, it's a small thing but I'd prefer to replace all these calls to <code>.unwrap()</code> with <code>?</code>. Apparently that's straightforward since there's one <code>write!</code> invocation in this function already using <code>?</code>, so I expect it should be fine for the other writes too.</p>
<p>I hope it's also easy for the call to <code>disasm_all</code>, where it would be particularly good to handle errors gracefully since we might very well have generated invalid instructions. I haven't checked if the error type returned from that function converts to an <code>anyhow::Error</code> though.</p>
</blockquote>



<a name="327873501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873501">(Feb 14 2023 at 21:06)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298432333">PR review</a>.</p>



<a name="327873503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873503">(Feb 14 2023 at 21:06)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106375711">PR review comment</a>:</p>
<blockquote>
<p>I like that!</p>
</blockquote>



<a name="327873978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873978">(Feb 14 2023 at 21:09)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298436412">PR review</a>.</p>



<a name="327873979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327873979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327873979">(Feb 14 2023 at 21:09)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106380484">PR review comment</a>:</p>
<blockquote>
<p>I like the output without the bytes, and thanks for catching the <code>unwrap()</code> uses! (I had pulled this directly over from clif-util, and hadn't taken the time to refactor it).</p>
</blockquote>



<a name="327876963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327876963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327876963">(Feb 14 2023 at 21:27)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298457216">PR review</a>.</p>



<a name="327876966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327876966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327876966">(Feb 14 2023 at 21:27)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106398932">PR review comment</a>:</p>
<blockquote>
<p>I like the address for making jumps easier to understand, but you're right that it'll likely cause a lot of churn when updating tests. Maybe this is a good case for using <code>clif-util compile</code> when debugging, vs making the <code>precise-output</code> easier to read?</p>
</blockquote>



<a name="327877362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327877362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327877362">(Feb 14 2023 at 21:30)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>.</p>



<a name="327877666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327877666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327877666">(Feb 14 2023 at 21:31)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>.</p>



<a name="327878176"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327878176" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327878176">(Feb 14 2023 at 21:35)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298466647">PR review</a>.</p>



<a name="327878177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327878177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327878177">(Feb 14 2023 at 21:35)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106405638">PR review comment</a>:</p>
<blockquote>
<p>I removed the address as well; @jameysharp pointed out that it would make updates quite noisy as unrelated lines would change frequently.</p>
</blockquote>



<a name="327878717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327878717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327878717">(Feb 14 2023 at 21:38)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298469772">PR review</a>.</p>



<a name="327878719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327878719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327878719">(Feb 14 2023 at 21:38)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106407925">PR review comment</a>:</p>
<blockquote>
<p>I think it would be pretty easy to dump them out if they're present. I'll try that and we can see if that seems like enough information.</p>
</blockquote>



<a name="327880811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327880811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327880811">(Feb 14 2023 at 21:53)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298485925">PR review</a>.</p>



<a name="327880812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327880812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327880812">(Feb 14 2023 at 21:53)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106419635">PR review comment</a>:</p>
<blockquote>
<p>I'd propose two changes to this method:</p>
<ul>
<li>Return <code>capstone::Error</code> instead of <code>anyhow::Error</code>, since this is Capstone-specific anyway, and let the caller map the error however they need to.</li>
<li>Don't provide a default implementation (or provide one that returns <code>Err(capstone::Error::UnsupportedArch)</code>) and let the target-specific implementations figure out how to construct an appropriate <code>Capstone</code> object. This is slightly annoying since the implementations all need to be guarded with <code>#[cfg(feature = "disas")]</code> but I don't think that's a big deal.</li>
</ul>
</blockquote>



<a name="327892104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327892104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327892104">(Feb 14 2023 at 23:12)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>.</p>



<a name="327892542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327892542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327892542">(Feb 14 2023 at 23:15)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>.</p>



<a name="327892815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327892815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327892815">(Feb 14 2023 at 23:17)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298565967">PR review</a>.</p>



<a name="327892816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327892816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327892816">(Feb 14 2023 at 23:17)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106476522">PR review comment</a>:</p>
<blockquote>
<p>Much nicer, thanks!</p>
</blockquote>



<a name="327893208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327893208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327893208">(Feb 14 2023 at 23:21)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a> from <code>trevor/capstone-output-filetests</code> to <code>main</code>.</p>



<a name="327894128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327894128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327894128">(Feb 14 2023 at 23:28)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#pullrequestreview-1298574235">PR review</a>.</p>



<a name="327894132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327894132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327894132">(Feb 14 2023 at 23:28)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106482665">PR review comment</a>:</p>
<blockquote>
<p>I've inlined the relocations in the disassembled output. Here's the updated version you originally referenced:</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">;</span><span class="w">   </span><span class="n">push</span><span class="w">        </span><span class="n">rbp</span>
<span class="p">;</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">rbp</span><span class="p">,</span><span class="w"> </span><span class="n">rsp</span>
<span class="p">;</span><span class="w">   </span><span class="n">call</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">reloc_external</span><span class="w"> </span><span class="n">CallPCRel4</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">521</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span>
<span class="p">;</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">rsp</span><span class="p">,</span><span class="w"> </span><span class="n">rbp</span>
<span class="p">;</span><span class="w">   </span><span class="n">pop</span><span class="w"> </span><span class="n">rbp</span>
<span class="p">;</span><span class="w">   </span><span class="n">ret</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="327894227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327894227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327894227">(Feb 14 2023 at 23:29)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5780#discussion_r1106482665">PR review comment</a>.</p>



<a name="327894258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327894258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327894258">(Feb 14 2023 at 23:29)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a>.</p>



<a name="327894271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235780%20Add%20disassembly%20to%20existing%20precise-o.../near/327894271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235780.20Add.20disassembly.20to.20existing.20precise-o.2E.2E.2E.html#327894271">(Feb 14 2023 at 23:29)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5780">PR #5780</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>