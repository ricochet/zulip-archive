<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1506 [crash] assertion failed in wasmti... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html">wasmtime / Issue #1506 [crash] assertion failed in wasmti...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193874043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231506%20%5Bcrash%5D%20assertion%20failed%20in%20wasmti.../near/193874043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html#193874043">(Apr 14 2020 at 09:57)</a>:</h4>
<p>pventuzelo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1506" title="https://github.com/bytecodealliance/wasmtime/issues/1506">Issue #1506</a>:</p>
<blockquote>
<h1>Description</h1>
<p>I found a bug during fuzzing wasmtime with cranelift backend and almost all features enabled in the config (specifically <code>config.debug_info(true)</code>). The bug seems to be related to generation of DWARF debugging.</p>
<p>Maybe related to <a href="https://github.com/bytecodealliance/wasmtime/issues/1489" title="https://github.com/bytecodealliance/wasmtime/issues/1489">https://github.com/bytecodealliance/wasmtime/issues/1489</a><br>
@yurydelendik </p>
<h1>Crash</h1>
<div class="codehilite"><pre><span></span>./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
Start debugging of wasmtime_all_cranelift
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
note: run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span><span class="sb">`</span> environment variable to display a backtrace.
</pre></div>


<h1>What are the steps to reproduce the issue?</h1>
<p>Download the crashing file: <br>
<a href="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip" title="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip">assert_wasmtime_debug_simulated_dwarf.zip</a></p>
<p>Testing piece of code:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,</span><span class="w"> </span><span class="n">Strategy</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// read data from provided file</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_contents_from_path</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;cannot read file content&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span>::<span class="n">Cranelift</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_threads</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_simd</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_bulk_memory</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_multi_value</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h1>Which Wasmtime version / commit hash / branch are you using?</h1>
<p>crates version: <code>wasmtime = "0.15"</code></p>
<h1>BACKTRACE</h1>
<div class="codehilite"><pre><span></span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span> ./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
stack backtrace:
   <span class="m">0</span>: backtrace::backtrace::libunwind::trace
             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">11</span>: std::panicking::begin_panic
             at /rustc/85976442558bf2d09cec3aa49c9c9ba86fb15c1f/src/libstd/panicking.rs:390
  <span class="m">12</span>: gimli::write::str::StringTable::add
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/&lt;::std::macros::panic macros&gt;:2
<span class="o">==</span>&gt;  <span class="m">13</span>: wasmtime_debug::transform::simulate::generate_simulated_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/simulate.rs:293
<span class="o">==</span>&gt;  <span class="m">14</span>: wasmtime_debug::transform::transform_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/mod.rs:107
<span class="o">==</span>&gt;  <span class="m">15</span>: wasmtime_debug::emit_debugsections_image
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/lib.rs:82
  <span class="m">16</span>: wasmtime_jit::compiler::Compiler::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/compiler.rs:215
  <span class="m">17</span>: wasmtime_jit::instantiate::RawCompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:83
  <span class="m">18</span>: wasmtime_jit::instantiate::CompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:154
  <span class="m">19</span>: wasmtime::module::Module::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:366
  <span class="m">20</span>: wasmtime::module::Module::from_binary_unchecked
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:335
  <span class="m">21</span>: wasmtime::module::Module::from_binary
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:304
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">32</span>: main
  <span class="m">33</span>: __libc_start_main
  <span class="m">34</span>: _start
note: Some details are omitted, run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>full<span class="sb">`</span> <span class="k">for</span> a verbose backtrace.
</pre></div>


</blockquote>



<a name="193874045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231506%20%5Bcrash%5D%20assertion%20failed%20in%20wasmti.../near/193874045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html#193874045">(Apr 14 2020 at 09:57)</a>:</h4>
<p>pventuzelo labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/1506" title="https://github.com/bytecodealliance/wasmtime/issues/1506">Issue #1506</a>:</p>
<blockquote>
<h1>Description</h1>
<p>I found a bug during fuzzing wasmtime with cranelift backend and almost all features enabled in the config (specifically <code>config.debug_info(true)</code>). The bug seems to be related to generation of DWARF debugging.</p>
<p>Maybe related to <a href="https://github.com/bytecodealliance/wasmtime/issues/1489" title="https://github.com/bytecodealliance/wasmtime/issues/1489">https://github.com/bytecodealliance/wasmtime/issues/1489</a><br>
@yurydelendik </p>
<h1>Crash</h1>
<div class="codehilite"><pre><span></span>./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
Start debugging of wasmtime_all_cranelift
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
note: run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span><span class="sb">`</span> environment variable to display a backtrace.
</pre></div>


<h1>What are the steps to reproduce the issue?</h1>
<p>Download the crashing file: <br>
<a href="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip" title="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip">assert_wasmtime_debug_simulated_dwarf.zip</a></p>
<p>Testing piece of code:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,</span><span class="w"> </span><span class="n">Strategy</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// read data from provided file</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_contents_from_path</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;cannot read file content&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span>::<span class="n">Cranelift</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_threads</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_simd</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_bulk_memory</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_multi_value</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h1>Which Wasmtime version / commit hash / branch are you using?</h1>
<p>crates version: <code>wasmtime = "0.15"</code></p>
<h1>BACKTRACE</h1>
<div class="codehilite"><pre><span></span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span> ./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
stack backtrace:
   <span class="m">0</span>: backtrace::backtrace::libunwind::trace
             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">11</span>: std::panicking::begin_panic
             at /rustc/85976442558bf2d09cec3aa49c9c9ba86fb15c1f/src/libstd/panicking.rs:390
  <span class="m">12</span>: gimli::write::str::StringTable::add
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/&lt;::std::macros::panic macros&gt;:2
<span class="o">==</span>&gt;  <span class="m">13</span>: wasmtime_debug::transform::simulate::generate_simulated_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/simulate.rs:293
<span class="o">==</span>&gt;  <span class="m">14</span>: wasmtime_debug::transform::transform_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/mod.rs:107
<span class="o">==</span>&gt;  <span class="m">15</span>: wasmtime_debug::emit_debugsections_image
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/lib.rs:82
  <span class="m">16</span>: wasmtime_jit::compiler::Compiler::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/compiler.rs:215
  <span class="m">17</span>: wasmtime_jit::instantiate::RawCompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:83
  <span class="m">18</span>: wasmtime_jit::instantiate::CompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:154
  <span class="m">19</span>: wasmtime::module::Module::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:366
  <span class="m">20</span>: wasmtime::module::Module::from_binary_unchecked
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:335
  <span class="m">21</span>: wasmtime::module::Module::from_binary
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:304
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">32</span>: main
  <span class="m">33</span>: __libc_start_main
  <span class="m">34</span>: _start
note: Some details are omitted, run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>full<span class="sb">`</span> <span class="k">for</span> a verbose backtrace.
</pre></div>


</blockquote>



<a name="193874614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231506%20%5Bcrash%5D%20assertion%20failed%20in%20wasmti.../near/193874614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html#193874614">(Apr 14 2020 at 10:02)</a>:</h4>
<p>pventuzelo edited <a href="https://github.com/bytecodealliance/wasmtime/issues/1506" title="https://github.com/bytecodealliance/wasmtime/issues/1506">Issue #1506</a>:</p>
<blockquote>
<h1>Description</h1>
<p>I found a reachable assertion (<a href="https://cwe.mitre.org/data/definitions/617.html" title="https://cwe.mitre.org/data/definitions/617.html">CWE-617</a>) during fuzzing wasmtime with cranelift backend and almost all features enabled in the config (specifically <code>config.debug_info(true)</code>). The bug seems to be related to generation of DWARF debugging.</p>
<p>Maybe related to <a href="https://github.com/bytecodealliance/wasmtime/issues/1489" title="https://github.com/bytecodealliance/wasmtime/issues/1489">https://github.com/bytecodealliance/wasmtime/issues/1489</a><br>
@yurydelendik </p>
<h1>Crash</h1>
<div class="codehilite"><pre><span></span>./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
Start debugging of wasmtime_all_cranelift
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
note: run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span><span class="sb">`</span> environment variable to display a backtrace.
</pre></div>


<h1>What are the steps to reproduce the issue?</h1>
<p>Download the crashing file: <br>
<a href="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip" title="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip">assert_wasmtime_debug_simulated_dwarf.zip</a></p>
<p>Testing piece of code:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,</span><span class="w"> </span><span class="n">Strategy</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// read data from provided file</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_contents_from_path</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;cannot read file content&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span>::<span class="n">Cranelift</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_threads</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_simd</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_bulk_memory</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_multi_value</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h1>Which Wasmtime version / commit hash / branch are you using?</h1>
<p>crates version: <code>wasmtime = "0.15"</code></p>
<h1>BACKTRACE</h1>
<div class="codehilite"><pre><span></span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span> ./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
stack backtrace:
   <span class="m">0</span>: backtrace::backtrace::libunwind::trace
             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">11</span>: std::panicking::begin_panic
             at /rustc/85976442558bf2d09cec3aa49c9c9ba86fb15c1f/src/libstd/panicking.rs:390
  <span class="m">12</span>: gimli::write::str::StringTable::add
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/&lt;::std::macros::panic macros&gt;:2
<span class="o">==</span>&gt;  <span class="m">13</span>: wasmtime_debug::transform::simulate::generate_simulated_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/simulate.rs:293
<span class="o">==</span>&gt;  <span class="m">14</span>: wasmtime_debug::transform::transform_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/mod.rs:107
<span class="o">==</span>&gt;  <span class="m">15</span>: wasmtime_debug::emit_debugsections_image
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/lib.rs:82
  <span class="m">16</span>: wasmtime_jit::compiler::Compiler::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/compiler.rs:215
  <span class="m">17</span>: wasmtime_jit::instantiate::RawCompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:83
  <span class="m">18</span>: wasmtime_jit::instantiate::CompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:154
  <span class="m">19</span>: wasmtime::module::Module::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:366
  <span class="m">20</span>: wasmtime::module::Module::from_binary_unchecked
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:335
  <span class="m">21</span>: wasmtime::module::Module::from_binary
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:304
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">32</span>: main
  <span class="m">33</span>: __libc_start_main
  <span class="m">34</span>: _start
note: Some details are omitted, run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>full<span class="sb">`</span> <span class="k">for</span> a verbose backtrace.
</pre></div>


</blockquote>



<a name="193952115"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231506%20%5Bcrash%5D%20assertion%20failed%20in%20wasmti.../near/193952115" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html#193952115">(Apr 14 2020 at 20:21)</a>:</h4>
<p>yurydelendik closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1506" title="https://github.com/bytecodealliance/wasmtime/issues/1506">Issue #1506</a>:</p>
<blockquote>
<h1>Description</h1>
<p>I found a reachable assertion (<a href="https://cwe.mitre.org/data/definitions/617.html" title="https://cwe.mitre.org/data/definitions/617.html">CWE-617</a>) during fuzzing wasmtime with cranelift backend and almost all features enabled in the config (specifically <code>config.debug_info(true)</code>). The bug seems to be related to generation of DWARF debugging.</p>
<p>Maybe related to <a href="https://github.com/bytecodealliance/wasmtime/issues/1489" title="https://github.com/bytecodealliance/wasmtime/issues/1489">https://github.com/bytecodealliance/wasmtime/issues/1489</a><br>
@yurydelendik </p>
<h1>Crash</h1>
<div class="codehilite"><pre><span></span>./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
Start debugging of wasmtime_all_cranelift
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
note: run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span><span class="sb">`</span> environment variable to display a backtrace.
</pre></div>


<h1>What are the steps to reproduce the issue?</h1>
<p>Download the crashing file: <br>
<a href="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip" title="https://github.com/bytecodealliance/wasmtime/files/4474549/assert_wasmtime_debug_simulated_dwarf.zip">assert_wasmtime_debug_simulated_dwarf.zip</a></p>
<p>Testing piece of code:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span>::<span class="p">{</span><span class="n">Config</span><span class="p">,</span><span class="w"> </span><span class="n">Engine</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Store</span><span class="p">,</span><span class="w"> </span><span class="n">Strategy</span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// read data from provided file</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_contents_from_path</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;cannot read file content&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">strategy</span><span class="p">(</span><span class="n">Strategy</span>::<span class="n">Cranelift</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="n">config</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">debug_info</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_threads</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_reference_types</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_simd</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_bulk_memory</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_multi_value</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Engine</span>::<span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span>::<span class="n">from_binary</span><span class="p">(</span><span class="o">&amp;</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h1>Which Wasmtime version / commit hash / branch are you using?</h1>
<p>crates version: <code>wasmtime = "0.15"</code></p>
<h1>BACKTRACE</h1>
<div class="codehilite"><pre><span></span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span><span class="m">1</span> ./target/debug/debug_wasmtime_all_cranelift assert_wasmtime_debug_simulated_dwarf.wasm
file_to_process: <span class="s2">&quot;assert_wasmtime_debug_simulated_dwarf.wasm&quot;</span>
thread <span class="s1">&#39;main&#39;</span> panicked at <span class="s1">&#39;assertion failed: !bytes.contains(&amp;0)&#39;</span>, &lt;::std::macros::panic macros&gt;:2:4
stack backtrace:
   <span class="m">0</span>: backtrace::backtrace::libunwind::trace
             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">11</span>: std::panicking::begin_panic
             at /rustc/85976442558bf2d09cec3aa49c9c9ba86fb15c1f/src/libstd/panicking.rs:390
  <span class="m">12</span>: gimli::write::str::StringTable::add
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/&lt;::std::macros::panic macros&gt;:2
<span class="o">==</span>&gt;  <span class="m">13</span>: wasmtime_debug::transform::simulate::generate_simulated_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/simulate.rs:293
<span class="o">==</span>&gt;  <span class="m">14</span>: wasmtime_debug::transform::transform_dwarf
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/transform/mod.rs:107
<span class="o">==</span>&gt;  <span class="m">15</span>: wasmtime_debug::emit_debugsections_image
<span class="o">==</span>&gt;             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-debug-0.15.0/src/lib.rs:82
  <span class="m">16</span>: wasmtime_jit::compiler::Compiler::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/compiler.rs:215
  <span class="m">17</span>: wasmtime_jit::instantiate::RawCompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:83
  <span class="m">18</span>: wasmtime_jit::instantiate::CompiledModule::new
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-jit-0.15.0/src/instantiate.rs:154
  <span class="m">19</span>: wasmtime::module::Module::compile
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:366
  <span class="m">20</span>: wasmtime::module::Module::from_binary_unchecked
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:335
  <span class="m">21</span>: wasmtime::module::Module::from_binary
             at /home/scop/.cargo/registry/src/github.com-1ecc6299db9ec823/wasmtime-0.15.0/src/module.rs:304
<span class="o">[</span>...<span class="o">]</span>
  <span class="m">32</span>: main
  <span class="m">33</span>: __libc_start_main
  <span class="m">34</span>: _start
note: Some details are omitted, run with <span class="sb">`</span><span class="nv">RUST_BACKTRACE</span><span class="o">=</span>full<span class="sb">`</span> <span class="k">for</span> a verbose backtrace.
</pre></div>


</blockquote>



<a name="193952387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231506%20%5Bcrash%5D%20assertion%20failed%20in%20wasmti.../near/193952387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231506.20.5Bcrash.5D.20assertion.20failed.20in.20wasmti.2E.2E.2E.html#193952387">(Apr 14 2020 at 20:24)</a>:</h4>
<p>yurydelendik <a href="https://github.com/bytecodealliance/wasmtime/issues/1506#issuecomment-613662379" title="https://github.com/bytecodealliance/wasmtime/issues/1506#issuecomment-613662379">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1506" title="https://github.com/bytecodealliance/wasmtime/issues/1506">Issue #1506</a>:</p>
<blockquote>
<p>Thank you for the report!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>