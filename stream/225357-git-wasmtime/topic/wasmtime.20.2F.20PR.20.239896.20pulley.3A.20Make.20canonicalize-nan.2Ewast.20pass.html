<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9896 pulley: Make canonicalize-nan.wast pass · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html">wasmtime / PR #9896 pulley: Make canonicalize-nan.wast pass</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="490528830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490528830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490528830">(Dec 23 2024 at 14:30)</a>:</h4>
<p>eagr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a> from <code>eagr:canon-nan</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Helps #9783 </p>
</blockquote>



<a name="490528831"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490528831" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490528831">(Dec 23 2024 at 14:30)</a>:</h4>
<p><strong>eagr</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490528832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490528832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490528832">(Dec 23 2024 at 14:30)</a>:</h4>
<p><strong>eagr</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490528833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490528833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490528833">(Dec 23 2024 at 14:30)</a>:</h4>
<p><strong>eagr</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490529060"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490529060" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490529060">(Dec 23 2024 at 14:32)</a>:</h4>
<p><strong>eagr</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490529061"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490529061" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490529061">(Dec 23 2024 at 14:32)</a>:</h4>
<p><strong>eagr</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490529062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490529062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490529062">(Dec 23 2024 at 14:32)</a>:</h4>
<p>eagr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490531861"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490531861" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490531861">(Dec 23 2024 at 14:52)</a>:</h4>
<p>eagr <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2559845090">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">pulley</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">pulley64</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">misc_testsuite</span><span class="o">/</span><span class="n">simd</span><span class="o">/</span><span class="n">canonicalize</span><span class="o">-</span><span class="n">nan</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">nan</span><span class="o">-</span><span class="n">canonicalization</span>
</code></pre></div>
<p>Seems passing. Is it how the test supposed to run?</p>
<p>About the fn naming, I'm just kinda going along with <code>veq32x4</code> and friends. If you'd prefer, say, <code>vlef32x4</code> over <code>vlteqf32x4</code>, or <code>vueqf64x2</code> over <code>vunoeqf64x2</code>, I'm happy to change them.</p>
<p>And I haven't implemented all the float condcodes, just enough to get the tests pass. I did skim through the docs, but I don't believe I understand half of the implications. It'd great to hear your inputs before I proceed implementing others.</p>
</blockquote>



<a name="490539621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490539621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490539621">(Dec 23 2024 at 15:44)</a>:</h4>
<p>eagr edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2559845090">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">features</span><span class="w"> </span><span class="n">pulley</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">wast</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">pulley64</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">misc_testsuite</span><span class="o">/</span><span class="n">simd</span><span class="o">/</span><span class="n">canonicalize</span><span class="o">-</span><span class="n">nan</span><span class="p">.</span><span class="n">wast</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">nan</span><span class="o">-</span><span class="n">canonicalization</span>
</code></pre></div>
<p>Seems passing. Is it how the test supposed to run?</p>
<p>About the fn naming, I'm just kinda going along with <code>veq32x4</code> and friends. If you'd prefer, say, <code>vlef32x4</code> over <code>vlteqf32x4</code>, or <code>vueqf64x2</code> over <code>vunoeqf64x2</code>, I'm happy to change them.</p>
<p>And I haven't implemented all the float condcodes, just enough to get the tests pass. I did skim through the docs, but I don't believe I understand half of the implications. It'd great to hear your inputs before I proceed implementing others.</p>
<p>cc @alexcrichton </p>
</blockquote>



<a name="490557180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490557180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490557180">(Dec 23 2024 at 17:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2560088737">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "pulley"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: pulley</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="490639414"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490639414" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490639414">(Dec 24 2024 at 06:53)</a>:</h4>
<p>eagr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490669708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490669708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490669708">(Dec 24 2024 at 12:13)</a>:</h4>
<p>eagr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<a name="490951316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490951316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490951316">(Dec 27 2024 at 05:43)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2563343014">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<p>Thanks for this! I think it might be best to cut down on some of these opcodes in Pulley though since wasm doesn't actually use many of the <code>FloatCC::Unordered*</code> orderings for example. I'd recommend having a pulley opcode for wasm-based orderings but those needed only for nan canonicalization for example I think should be implemented like other lowering rules on other platforms (e.g. using combinations of opcodes instead of one). If this ever becomes performance sensitive we can of course revisit.</p>
<p>I'd recommend taking a look at how <a href="https://github.com/bytecodealliance/wasmtime/blob/6e955180deddccfc252abab7a8ad5ce7e891b23e/cranelift/codegen/src/isa/riscv64/inst_vector.isle#L1803-L1834">the riscv64 backend does this</a> for example </p>
</blockquote>



<a name="490951389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490951389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490951389">(Dec 27 2024 at 05:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2563343428">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<p>Oh I'll also note that another example is in <a href="https://github.com/bytecodealliance/wasmtime/pull/9884">https://github.com/bytecodealliance/wasmtime/pull/9884</a> (which I'm happy to merge your PR before mind and rebase around yours), which has another possible strategy for implementing some comparison-related opcodes here.</p>
</blockquote>



<a name="490957399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490957399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490957399">(Dec 27 2024 at 07:04)</a>:</h4>
<p>eagr <a href="https://github.com/bytecodealliance/wasmtime/pull/9896#issuecomment-2563394042">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>:</p>
<blockquote>
<p>I didn't notice your PR. I couldn't see this one is contributing anything on top of yours, so I guess it's faster to just close this one to get out of the way. :)</p>
</blockquote>



<a name="490959541"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239896%20pulley%3A%20Make%20canonicalize-nan.wast%20pass/near/490959541" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239896.20pulley.3A.20Make.20canonicalize-nan.2Ewast.20pass.html#490959541">(Dec 27 2024 at 07:29)</a>:</h4>
<p>eagr closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/9896">PR #9896</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>