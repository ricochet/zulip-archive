<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7001 new: declare type wasi_ctx in c-api · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html">wasmtime / PR #7001 new: declare type wasi_ctx in c-api</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="390398563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390398563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390398563">(Sep 11 2023 at 22:27)</a>:</h4>
<p>gaukas opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a> from <code>gaukas:export-wasictx</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This pull request _incompletely_ exports <code>WasiCtx</code> in C-API: </p>
<ul>
<li>Declare <code>wasi_ctx_t</code> in wasi.h.</li>
<li>Add implementation for <code>wasi_ctx_insert_file</code> and <code>wasi_ctx_push_file</code> in <a href="http://wasi.rs">wasi.rs</a>. </li>
<li>Add implementation for <code>wasmtime_context_set_default_wasi_if_not_exist</code> and <code>wasmtime_context_get_wasi_ctx</code> in <a href="http://store.rs">store.rs</a>.</li>
</ul>
<p>Discussed in <a href="https://github.com/bytecodealliance/wasmtime-go/issues/187">https://github.com/bytecodealliance/wasmtime-go/issues/187</a> with @alexcrichton. </p>
<p>The corresponding Go changes will be available in a separate pull request to wasmtime-go. </p>
<p>Please let me know if there are any issues or suggested edits. </p>
</blockquote>



<a name="390398566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390398566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390398566">(Sep 11 2023 at 22:27)</a>:</h4>
<p><strong>gaukas</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390398567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390398567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390398567">(Sep 11 2023 at 22:27)</a>:</h4>
<p><strong>gaukas</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390400089"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390400089" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390400089">(Sep 11 2023 at 22:39)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390597303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597303">(Sep 12 2023 at 21:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1622531436">PR review</a>:</p>
<blockquote>
<p>Thanks for the PR! I've noted a few issues below, but @pchickey I think the functionality added here should work both before and after preview2. This is dealing with concrete system primitives as opposed to user-defined things, so it seems reasonable to be able to add/insert those after-the-fact both during the building process and once the context is created too. </p>
<p>We'll definitely need one API for preview2 and one for preview1 (or somehow update the existing one for preview2), but I think with the various issues below addressed I'd personally be ok merging this.</p>
</blockquote>



<a name="390597304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597304">(Sep 12 2023 at 21:10)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1622531436">PR review</a>:</p>
<blockquote>
<p>Thanks for the PR! I've noted a few issues below, but @pchickey I think the functionality added here should work both before and after preview2. This is dealing with concrete system primitives as opposed to user-defined things, so it seems reasonable to be able to add/insert those after-the-fact both during the building process and once the context is created too. </p>
<p>We'll definitely need one API for preview2 and one for preview1 (or somehow update the existing one for preview2), but I think with the various issues below addressed I'd personally be ok merging this.</p>
</blockquote>



<a name="390597306"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597306" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597306">(Sep 12 2023 at 21:10)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323216971">PR review comment</a>:</p>
<blockquote>
<p>Is this necesssary to add? I would expect otherwise that <code>wasmtime_context_set_wasi</code> is sufficient?</p>
</blockquote>



<a name="390597307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597307">(Sep 12 2023 at 21:10)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323217957">PR review comment</a>:</p>
<blockquote>
<p>I don't think that this is quite correct since this is returning a clone of the original context, meaning that any mutations on the returned value won't be reflected on the original value.</p>
</blockquote>



<a name="390597560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597560">(Sep 12 2023 at 21:11)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390597824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597824">(Sep 12 2023 at 21:13)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623161111">PR review</a>.</p>



<a name="390597825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390597825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390597825">(Sep 12 2023 at 21:13)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323584237">PR review comment</a>:</p>
<blockquote>
<p>Theoretically no, but practically it enables a cleaner way to guarantee a valid wasi will be returned even if the caller is not calling SetWasi. </p>
</blockquote>



<a name="390598200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390598200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390598200">(Sep 12 2023 at 21:16)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623164308">PR review</a>.</p>



<a name="390598201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390598201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390598201">(Sep 12 2023 at 21:16)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323586219">PR review comment</a>:</p>
<blockquote>
<p>It is true, but are there any reason that the pointer would change, without calling SetWasi? </p>
<p>SetWasi is apparently something a caller shouldn't call, since I would assume all previous states saved in the older wasi will be overridden anyways. </p>
</blockquote>



<a name="390603150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390603150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390603150">(Sep 12 2023 at 21:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623249238">PR review</a>.</p>



<a name="390603151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390603151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390603151">(Sep 12 2023 at 21:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323639330">PR review comment</a>:</p>
<blockquote>
<p>Ok in that case I'd prefer to avoid adding this because the C API isn't really one geared towards ergonomics (it is C after all), but such wrappers could always be present in higher-level languages like Go for example.</p>
</blockquote>



<a name="390603287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390603287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390603287">(Sep 12 2023 at 21:58)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623250374">PR review</a>.</p>



<a name="390603288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390603288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390603288">(Sep 12 2023 at 21:58)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323640286">PR review comment</a>:</p>
<blockquote>
<p>Yes this is where I would recommend <code>wasmtime_context_*</code> methods instead of a separate <code>wasi_ctx_t</code> type. That would operate directly on a store and avoid the need to pull out a WASI pointer.</p>
</blockquote>



<a name="390605501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390605501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390605501">(Sep 12 2023 at 22:14)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623276779">PR review</a>.</p>



<a name="390605504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390605504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390605504">(Sep 12 2023 at 22:15)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323658892">PR review comment</a>:</p>
<blockquote>
<p>Would you like to suggest a specific change here? Like, tracking if <code>SetWasi</code> is ever called in the caller? </p>
</blockquote>



<a name="390605980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390605980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390605980">(Sep 12 2023 at 22:18)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323661424">PR review comment</a>:</p>
<blockquote>
<p>Yeah I would love to move this API to <code>wasmtime_context_*</code> if you see it fit, but perhaps it would cause misalignment between Rust, C-API, and caller (say Go). Exposing the same function on the same struct here seems a much straightforward approach, maybe even with some memory safety trade-offs. </p>
<p>Another way we could do is, exposing it here as <code>wasmtime_context_*</code> and implement a "fake" type <code>WasiCtx</code> in Go... </p>
</blockquote>



<a name="390605981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390605981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390605981">(Sep 12 2023 at 22:18)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623280404">PR review</a>.</p>



<a name="390607082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390607082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390607082">(Sep 12 2023 at 22:26)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623290326">PR review</a>.</p>



<a name="390607083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390607083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390607083">(Sep 12 2023 at 22:26)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323667880">PR review comment</a>:</p>
<blockquote>
<p>Yes I don't think this API should be added at this time. If a caller wants to conditionally enable WASI or not then I think that should be tracked by the caller for now.</p>
</blockquote>



<a name="390622964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390622964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390622964">(Sep 13 2023 at 01:03)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390623165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390623165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390623165">(Sep 13 2023 at 01:05)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390623433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390623433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390623433">(Sep 13 2023 at 01:07)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1623469661">PR review</a>.</p>



<a name="390623435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390623435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390623435">(Sep 13 2023 at 01:07)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1323807505">PR review comment</a>:</p>
<blockquote>
<p>Removed this function along with <code>wasmtime_context_set_default_wasi_if_not_exist</code>, added <code>wasmtime_context_insert_file</code> and <code>wasmtime_context_push_file</code> which directly call into the <code>WasiCtx</code> deep inside a <code>CStoreContextMut</code>.</p>
</blockquote>



<a name="390746906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390746906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390746906">(Sep 13 2023 at 15:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624828519">PR review</a>:</p>
<blockquote>
<p>Thanks! I'm remembering now that there's other issues related to portability which this will need to handle too</p>
</blockquote>



<a name="390746907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390746907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390746907">(Sep 13 2023 at 15:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624828519">PR review</a>:</p>
<blockquote>
<p>Thanks! I'm remembering now that there's other issues related to portability which this will need to handle too</p>
</blockquote>



<a name="390746908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390746908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390746908">(Sep 13 2023 at 15:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324684961">PR review comment</a>:</p>
<blockquote>
<p>I was looking at <code>host_fd</code> here again and first though "hm shouldn't this be <code>int</code>?" since that matches what the host has here, but then I remembered additionally that this won't work on Windows because Windows doesn't have file descriptors.</p>
<p>I think that this and the below function will need to use a different type for <code>host_fd</code> on Windows where it'll use <code>int</code> on Unix and <code>HANDLE</code> on Windows.</p>
</blockquote>



<a name="390746910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390746910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390746910">(Sep 13 2023 at 15:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324687719">PR review comment</a>:</p>
<blockquote>
<p>Also, could this document the <code>access_mode</code> values? I don't believe that maps to octal permissions like <code>0o777</code> as one might otherwise expect.</p>
</blockquote>



<a name="390746911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390746911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390746911">(Sep 13 2023 at 15:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324685766">PR review comment</a>:</p>
<blockquote>
<p>Could this documentation, and the above block, mention the requirement to configure WASI first? If that's not done then this function will abort the process due to a failed assert.</p>
</blockquote>



<a name="390755257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390755257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390755257">(Sep 13 2023 at 16:01)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624925378">PR review</a>.</p>



<a name="390755258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390755258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390755258">(Sep 13 2023 at 16:01)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324746502">PR review comment</a>:</p>
<blockquote>
<p>This is basically the same as whatever in Rust. </p>
</blockquote>



<a name="390755643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390755643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390755643">(Sep 13 2023 at 16:03)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624928355">PR review</a>.</p>



<a name="390755644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390755644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390755644">(Sep 13 2023 at 16:03)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324748410">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>I think that this and the below function will need to use a different type for host_fd on Windows where it'll use int on Unix and HANDLE on Windows.</p>
</blockquote>
<p>Would you give an example or directly push to my branch? I do not have a Windows setup for testing any change specific to Windows. </p>
</blockquote>



<a name="390755847"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390755847" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390755847">(Sep 13 2023 at 16:04)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324746502">PR review comment</a>.</p>



<a name="390756068"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390756068" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390756068">(Sep 13 2023 at 16:05)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624931334">PR review</a>.</p>



<a name="390756070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390756070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390756070">(Sep 13 2023 at 16:05)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324750254">PR review comment</a>:</p>
<blockquote>
<p>Sure, glad to make add this to the documentation. </p>
</blockquote>



<a name="390756659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390756659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390756659">(Sep 13 2023 at 16:08)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624937413">PR review</a>.</p>



<a name="390756662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390756662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390756662">(Sep 13 2023 at 16:08)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324754052">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>it'll use int on Unix</p>
</blockquote>
<p>Seems even 'int' is not the case to me. It seems to be i32 on Unix. </p>
<p>Opt to use u32 here simply for the type consistency across all fds -- iirc the returned guest_fd is in u32. I can double check. </p>
</blockquote>



<a name="390756983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390756983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390756983">(Sep 13 2023 at 16:10)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324748410">PR review comment</a>.</p>



<a name="390757094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390757094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390757094">(Sep 13 2023 at 16:10)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324748410">PR review comment</a>.</p>



<a name="390758372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390758372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390758372">(Sep 13 2023 at 16:18)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1624956337">PR review</a>.</p>



<a name="390758374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390758374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390758374">(Sep 13 2023 at 16:18)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324765555">PR review comment</a>:</p>
<blockquote>
<p>And IMO, it is Rust's fault to select i32 for file descriptors. An apparent better and more consistent choice is uintptr. </p>
<p>I'm personally against exposing host_fd as i32, but if you insist it should guarantee truthfulness (host_fd: i32, guest_fd: u32) rather than consistency, I can make the corresponding change. </p>
</blockquote>



<a name="390763901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390763901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390763901">(Sep 13 2023 at 16:52)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324750254">PR review comment</a>.</p>



<a name="390763952"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390763952" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390763952">(Sep 13 2023 at 16:52)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324765555">PR review comment</a>.</p>



<a name="390796629"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390796629" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390796629">(Sep 13 2023 at 20:23)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1625391846">PR review</a>.</p>



<a name="390796630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390796630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390796630">(Sep 13 2023 at 20:23)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1325040676">PR review comment</a>:</p>
<blockquote>
<p>I looked again and found Go will only return <code>uintptr</code> for the fd. </p>
<p>I would propose the change to always use <code>* c_void</code>(Rust)/<code>void *</code> for all guest/host fd for the interface, and leaving the type conversion inside Rust implementation. What do you think? @alexcrichton </p>
</blockquote>



<a name="390797233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390797233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390797233">(Sep 13 2023 at 20:27)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1325040676">PR review comment</a>.</p>



<a name="390799030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390799030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390799030">(Sep 13 2023 at 20:37)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1325040676">PR review comment</a>.</p>



<a name="390801103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390801103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390801103">(Sep 13 2023 at 20:52)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1324748410">PR review comment</a>.</p>



<a name="390809914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390809914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390809914">(Sep 13 2023 at 22:01)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1625517682">PR review</a>.</p>



<a name="390809915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390809915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390809915">(Sep 13 2023 at 22:01)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1325120327">PR review comment</a>:</p>
<blockquote>
<p>Sorry I don't have detailed guides and such of how to build on Windows, I also don't develop on Windows myself. This problem must be fixed to merge this PR, however, because I believe your changes will not compile on Windows due to the usage of <code>std::os::fd</code> which does not on Windows. CI is passing because only a subset of tests are run for PRs, but the full merge will run a full suite of tests. If you'd like you can include a commit with <code>prtest:full</code> somewhere in the commit message to run full CI on this PR.</p>
<p>As for types, IMO this should match what happens in the native platform. This means that <code>int</code> should be used in the header file for Unix and <code>HANDLE</code> should be used in the header file for Windows. The corresponding Rust types are <code>std::os::fd::RawFd</code> and <code>std::os::windows::io::RawHandle</code>.</p>
<p>I don't have a better idea of how to define this function other than to just have it defined differently on different platforms. </p>
</blockquote>



<a name="390810386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390810386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390810386">(Sep 13 2023 at 22:04)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="390810843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390810843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390810843">(Sep 13 2023 at 22:09)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1625524952">PR review</a>.</p>



<a name="390810844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390810844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390810844">(Sep 13 2023 at 22:09)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1325125111">PR review comment</a>:</p>
<blockquote>
<p>Luckily it worked after some reverse engineering of the CI script of wasmtime and wasmtime-go, now I can finally compile and test on Windows. </p>
<p>Just pushed a new change to use <code>void*</code>/<code>*mut c_void</code>/<code>unsafe.Pointer()</code> for <code>host_fd</code>. How does it look to you? Or would you still want different function header on different platforms. (In that case, could you please provide some guidance on how to conditionally declare function header on different platforms?) </p>
</blockquote>



<a name="390947776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/390947776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#390947776">(Sep 14 2023 at 14:49)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="391089339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391089339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391089339">(Sep 15 2023 at 06:20)</a>:</h4>
<p>gaukas updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="391090485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391090485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391090485">(Sep 15 2023 at 06:28)</a>:</h4>
<p><strong>gaukas</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<a name="391198755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198755">(Sep 15 2023 at 15:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629196966">PR review</a>.</p>



<a name="391198756"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198756" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198756">(Sep 15 2023 at 15:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629196966">PR review</a>.</p>



<a name="391198757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198757">(Sep 15 2023 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327447619">PR review comment</a>:</p>
<blockquote>
<p>I think the documentation here and below may wish to be updated where these constants are not defined by the WASI spec, they're purely an implementation detail in Wasmtime.</p>
<p>Could this additionally split out the read/write to <code>WASMTIME_WASI_FILE_{READ,WRITE}</code> perhaps as <code>#define</code>s?</p>
</blockquote>



<a name="391198758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198758">(Sep 15 2023 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327448500">PR review comment</a>:</p>
<blockquote>
<p>Like with C, can the <code>#[cfg]</code> be used to conditionally define a type and delegate to a small helper internally? As I mentioned before that would avoid duplicating the whole function.</p>
</blockquote>



<a name="391198759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198759">(Sep 15 2023 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327444410">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps do </p>
<div class="codehilite" data-code-language="C"><pre><span></span><code><span class="cp">#ifdef WASMTIME_UNIX</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">wasmtime_host_file_t</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">wasmtime_host_file_t</span><span class="p">;</span>
<span class="cp">#endif</span>
</code></pre></div>
<p>to avoid defining the function signature twice?</p>
<p>Additionally this should use <code>HANDLE</code> on Windows, not <code>void*</code>, as fixing that in Go seems like an orthogonal concern? </p>
</blockquote>



<a name="391198760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391198760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391198760">(Sep 15 2023 at 15:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327442623">PR review comment</a>:</p>
<blockquote>
<p>Could this choose names such as <code>WASMTIME_UNIX</code> or <code>WASMTIME_WINDOWS</code> to avoid clashing with other projects?</p>
</blockquote>



<a name="391304158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391304158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391304158">(Sep 16 2023 at 01:44)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629883932">PR review</a>.</p>



<a name="391304159"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391304159" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391304159">(Sep 16 2023 at 01:44)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327886338">PR review comment</a>:</p>
<blockquote>
<p>I don't think so since we have different input type. Unless you want to eliminate that? I didn't find a good way to conditionally define ONLY the func header. </p>
</blockquote>



<a name="391304486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391304486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391304486">(Sep 16 2023 at 01:46)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629884192">PR review</a>.</p>



<a name="391304488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391304488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391304488">(Sep 16 2023 at 01:46)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327886554">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>not defined by the WASI spec</p>
</blockquote>
<p>Then possibly some better documentation is needed on the wasi_common package instead. I found no indication saying this is a pure wasmtime thing. </p>
</blockquote>



<a name="391305058"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391305058" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391305058">(Sep 16 2023 at 01:50)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629884653">PR review</a>.</p>



<a name="391305059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391305059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391305059">(Sep 16 2023 at 01:50)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327886974">PR review comment</a>:</p>
<blockquote>
<p>Sure, you may just push a change for styling suggestions like that... </p>
</blockquote>



<a name="391305624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391305624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391305624">(Sep 16 2023 at 01:54)</a>:</h4>
<p>gaukas submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#pullrequestreview-1629885127">PR review</a>.</p>



<a name="391305625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391305625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391305625">(Sep 16 2023 at 01:54)</a>:</h4>
<p>gaukas created <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327887402">PR review comment</a>:</p>
<blockquote>
<p>I'm not really getting it by what do you mean here:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="n">ifdef</span><span class="w"> </span><span class="n">WASMTIME_UNIX</span>
<span class="n">typedef</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="n">wasmtime_host_file_t</span><span class="p">;</span>
#<span class="k">else</span>
<span class="n">typedef</span><span class="w"> </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">wasmtime_host_file_t</span><span class="p">;</span>
#<span class="n">endif</span>
</code></pre></div>
<p>Doesn't this just further complicates the interface by adding more layers of indirectness? </p>
<blockquote>
<p>Go seems like an orthogonal concern</p>
</blockquote>
<p>To be super honest with you, for me, my major concern is if it works in Go. So I would just save the effort. If it won't work for you, someone better at this could fix it... </p>
</blockquote>



<a name="391307604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391307604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391307604">(Sep 16 2023 at 02:08)</a>:</h4>
<p>gaukas edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7001#discussion_r1327886338">PR review comment</a>.</p>



<a name="391707726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237001%20new%3A%20declare%20type%20wasi_ctx%20in%20c-api/near/391707726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237001.20new.3A.20declare.20type.20wasi_ctx.20in.20c-api.html#391707726">(Sep 18 2023 at 14:05)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/7001">PR #7001</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>