<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7834 wasmtime-runtime: avoid references to... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html">wasmtime / PR #7834 wasmtime-runtime: avoid references to...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="418443271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418443271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418443271">(Jan 27 2024 at 20:12)</a>:</h4>
<p>Mrmaxmeier opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7834">PR #7834</a> from <code>Mrmaxmeier:runtime-signals-avoid-ref-mut-static</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Hi,<br>
recent nightly versions warn about the use of references to mutable statics in <code>signals.rs</code>:</p>
<p>&lt;details&gt;&lt;summary&gt;&lt;code&gt;warning: {shared,mutable} reference of mutable static is discouraged&lt;/code&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">warning</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">discouraged</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">signals</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">14</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">66</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">register</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">PREV_SIGSEGV</span><span class="p">,</span><span class="w"> </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="p">);</span>
<span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">114447</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/114447&gt;</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mi">2024</span><span class="w"> </span><span class="n">edition</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">statics</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">threads</span>: <span class="nc">aliasing</span><span class="w"> </span><span class="n">violations</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">races</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">behavior</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(static_mut_ref)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>
<span class="n">help</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">references</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">lives</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">UB</span><span class="p">;</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">addr_of_mut</span><span class="o">!</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">pointer</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">66</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">register</span><span class="p">(</span><span class="n">addr_of_mut</span><span class="o">!</span><span class="p">(</span><span class="n">PREV_SIGSEGV</span><span class="p">),</span><span class="w"> </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="p">);</span>
<span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="p">[</span><span class="o">..</span><span class="p">.]</span>

<span class="n">warning</span>: <span class="nc">shared</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">discouraged</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">signals</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">26</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">92</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PREV_SIGSEGV</span><span class="p">,</span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">114447</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/114447&gt;</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mi">2024</span><span class="w"> </span><span class="n">edition</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">statics</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">threads</span>: <span class="nc">aliasing</span><span class="w"> </span><span class="n">violations</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">races</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">behavior</span>
<span class="n">help</span>: <span class="nc">shared</span><span class="w"> </span><span class="n">references</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">lives</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">UB</span><span class="p">;</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">addr_of</span><span class="o">!</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">pointer</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">92</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">addr_of</span><span class="o">!</span><span class="p">(</span><span class="n">PREV_SIGSEGV</span><span class="p">),</span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="p">[</span><span class="o">..</span><span class="p">.]</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>This PR avoids references to these mutable statics and the safety concerns should now be entirely in the <code>sigaction</code> FFI calls. As far as I can tell, my changes do not affect the semantics of the code. :upside_down_face:  </p>
</blockquote>



<a name="418443272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418443272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418443272">(Jan 27 2024 at 20:12)</a>:</h4>
<p><strong>Mrmaxmeier</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7834">PR #7834</a>.</p>



<a name="418443273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418443273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418443273">(Jan 27 2024 at 20:12)</a>:</h4>
<p><strong>Mrmaxmeier</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7834">PR #7834</a>.</p>



<a name="418443597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418443597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418443597">(Jan 27 2024 at 20:18)</a>:</h4>
<p>Mrmaxmeier edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7834">PR #7834</a>:</p>
<blockquote>
<p>Hi,<br>
recent nightly versions warn about the use of references to mutable statics in <code>signals.rs</code>:</p>
<p>&lt;details&gt;&lt;summary&gt;&lt;code&gt;warning: {shared,mutable} reference of mutable static is discouraged&lt;/code&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">warning</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">discouraged</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">signals</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">14</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">66</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">register</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">PREV_SIGSEGV</span><span class="p">,</span><span class="w"> </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="p">);</span>
<span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">114447</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/114447&gt;</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mi">2024</span><span class="w"> </span><span class="n">edition</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">statics</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">threads</span>: <span class="nc">aliasing</span><span class="w"> </span><span class="n">violations</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">races</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">behavior</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(static_mut_ref)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>
<span class="n">help</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">references</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">lives</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">UB</span><span class="p">;</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">addr_of_mut</span><span class="o">!</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">pointer</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">66</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">register</span><span class="p">(</span><span class="n">addr_of_mut</span><span class="o">!</span><span class="p">(</span><span class="n">PREV_SIGSEGV</span><span class="p">),</span><span class="w"> </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="p">);</span>
<span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="p">[</span><span class="o">..</span><span class="p">.]</span>

<span class="n">warning</span>: <span class="nc">shared</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">discouraged</span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">signals</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span>:<span class="mi">26</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">92</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PREV_SIGSEGV</span><span class="p">,</span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span>
<span class="w">   </span><span class="o">|</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span>#<span class="mi">114447</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/rust/issues/114447&gt;</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">reference</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hard</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mi">2024</span><span class="w"> </span><span class="n">edition</span>
<span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">mutable</span><span class="w"> </span><span class="n">statics</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">threads</span>: <span class="nc">aliasing</span><span class="w"> </span><span class="n">violations</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">races</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">behavior</span>
<span class="n">help</span>: <span class="nc">shared</span><span class="w"> </span><span class="n">references</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">mutation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">lives</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">'</span><span class="na">s</span><span class="w"> </span><span class="n">UB</span><span class="p">;</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="n">addr_of</span><span class="o">!</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">pointer</span>
<span class="w">   </span><span class="o">|</span>
<span class="mi">92</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">libc</span>::<span class="n">SIGSEGV</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">addr_of</span><span class="o">!</span><span class="p">(</span><span class="n">PREV_SIGSEGV</span><span class="p">),</span>
<span class="w">   </span><span class="o">|</span><span class="w">                          </span><span class="o">~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="p">[</span><span class="o">..</span><span class="p">.]</span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>This PR avoids references to these mutable statics and the safety concerns should now be entirely in the <code>sigaction</code> FFI calls. As far as I can tell my changes do not affect the semantics of the code. :upside_down_face:  </p>
</blockquote>



<a name="418446293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418446293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418446293">(Jan 27 2024 at 21:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7834#pullrequestreview-1847282955">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="418447880"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237834%20wasmtime-runtime%3A%20avoid%20references%20to.../near/418447880" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237834.20wasmtime-runtime.3A.20avoid.20references.20to.2E.2E.2E.html#418447880">(Jan 27 2024 at 21:31)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7834">PR #7834</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>