<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6381 wasmtime: Refactor compilation orches... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html">wasmtime / PR #6381 wasmtime: Refactor compilation orches...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="358578041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358578041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358578041">(May 15 2023 at 21:54)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a>.</p>



<a name="358578042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358578042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358578042">(May 15 2023 at 21:54)</a>:</h4>
<p>fitzgen opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a> from <code>fitzgen:refactor-parallel-compilation</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Before, the acts of discovering what we need to compile and actually compiling those things was intertwined. This meant that we weren't fanning out as wide as we could in parallel compilation because we would do things like compile all Wasm functions in parallel, and all wasm-to-native trampolines in parallel, but not compile those two groups in parallel with each other.</p>
<p>Now we split discovery and compilation into separate phases: first we discover all the work we need to do, then we do it all in parallel at once.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="358578043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358578043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358578043">(May 15 2023 at 21:54)</a>:</h4>
<p><strong>fitzgen</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a>.</p>



<a name="358765097"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358765097" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358765097">(May 16 2023 at 15:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195325480">PR review comment</a>:</p>
<blockquote>
<p>I'm a bit scared that at some point during development an i132 was used</p>
</blockquote>



<a name="358769388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769388">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#pullrequestreview-1428845043">PR review</a>:</p>
<blockquote>
<p>Nice! I really like how this turned out <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> <br>
</p>
</blockquote>



<a name="358769389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769389">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#pullrequestreview-1428845043">PR review</a>:</p>
<blockquote>
<p>Nice! I really like how this turned out <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> <br>
</p>
</blockquote>



<a name="358769391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769391">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195334898">PR review comment</a>:</p>
<blockquote>
<p>These <code>symbol_name</code> functions may be best to move here now since they should only be called from this location?</p>
</blockquote>



<a name="358769394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769394">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195333270">PR review comment</a>:</p>
<blockquote>
<p>No changes necessary, but I've found that <code>[expr]</code> works nowadays for "iterate this thing once" which I think reads pretty well too</p>
</blockquote>



<a name="358769395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769395">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195342731">PR review comment</a>:</p>
<blockquote>
<p>This'll want a gate that there's only one translation because otherwise appending dwarf multiple times will end up with something corrupt that nothing can read</p>
</blockquote>



<a name="358769396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358769396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358769396">(May 16 2023 at 15:29)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195344307">PR review comment</a>:</p>
<blockquote>
<p>Perhaps assert that <code>self.indices</code> is empty just above this?</p>
</blockquote>



<a name="358813755"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358813755" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358813755">(May 16 2023 at 18:11)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195530566">PR review comment</a>:</p>
<blockquote>
<p>Oh nice, I always forget that arrays are useful now.</p>
</blockquote>



<a name="358813812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358813812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358813812">(May 16 2023 at 18:11)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/6381#discussion_r1195530965">PR review comment</a>:</p>
<blockquote>
<p>Maybe? I kind of like them as methods on the thing.</p>
</blockquote>



<a name="358818811"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358818811" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358818811">(May 16 2023 at 18:33)</a>:</h4>
<p>fitzgen updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a>.</p>



<a name="358818856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358818856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358818856">(May 16 2023 at 18:34)</a>:</h4>
<p>fitzgen has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a>.</p>



<a name="358828995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236381%20wasmtime%3A%20Refactor%20compilation%20orches.../near/358828995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236381.20wasmtime.3A.20Refactor.20compilation.20orches.2E.2E.2E.html#358828995">(May 16 2023 at 19:24)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6381">PR #6381</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>