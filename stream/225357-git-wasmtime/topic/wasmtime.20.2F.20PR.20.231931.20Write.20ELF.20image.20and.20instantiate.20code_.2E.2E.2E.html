<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1931 Write ELF image and instantiate code_... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html">wasmtime / PR #1931 Write ELF image and instantiate code_...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="202143681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202143681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202143681">(Jun 26 2020 at 21:17)</a>:</h4>
<p>yurydelendik opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring this crates yet. It is work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202143766"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202143766" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202143766">(Jun 26 2020 at 21:18)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202332601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332601">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-439270755">PR Review</a>.</p>



<a name="202332602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332602">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447067666">PR Review Comment</a>:</p>
<blockquote>
<p>Should this only happen if the symbol is actually referenced?</p>
</blockquote>



<a name="202332603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332603">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447087684">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I've seen this prefix in a number of places. Is there a way that we can canonicalize what's going on here? Ideally the name of a function would be contextually defined on some sort of <code>Module</code> type as well to account for the name section, but that may be a bit of a larger refactoring.</p>
</blockquote>



<a name="202332604"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332604" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332604">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-439270755">PR Review</a>.</p>



<a name="202332605"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332605" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332605">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447067199">PR Review Comment</a>:</p>
<blockquote>
<p>This list shows up in a few places, could we perhaps have an "iterator macro" which does this for us? Something like:</p>
<div class="codehilite"><pre><span></span><code><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="n">add_libcall_symbol</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>

<span class="n">for_each_libcall</span><span class="o">!</span><span class="p">(</span><span class="n">add_libcall_symbol</span><span class="p">);</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="202332608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202332608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202332608">(Jun 29 2020 at 16:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447088315">PR Review Comment</a>:</p>
<blockquote>
<p>This has a similar branch above for normal code symbols, so could these two perhaps be unified with a helper function?</p>
</blockquote>



<a name="202335979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202335979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202335979">(Jun 29 2020 at 16:37)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202358135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202358135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202358135">(Jun 29 2020 at 19:37)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202358692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202358692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202358692">(Jun 29 2020 at 19:41)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-439445268">PR Review</a>.</p>



<a name="202358694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202358694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202358694">(Jun 29 2020 at 19:41)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447208904">PR Review Comment</a>:</p>
<blockquote>
<p>it is preferable, but not necessary. To detect which libcall is used we need to to prescan relocations or track which symbols exist. We can get away with dumping all at this moment.</p>
</blockquote>



<a name="202359098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202359098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202359098">(Jun 29 2020 at 19:44)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-439447629">PR Review</a>.</p>



<a name="202359099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202359099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202359099">(Jun 29 2020 at 19:44)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447210968">PR Review Comment</a>:</p>
<blockquote>
<p>In this case these names are just unique string identifier (which can be converted back into <code>FuncIndex</code>). We can maintain separate map of FuncIndex&lt;-&gt;obj function somewhere else.</p>
</blockquote>



<a name="202375628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202375628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202375628">(Jun 29 2020 at 22:28)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202445441"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202445441" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202445441">(Jun 30 2020 at 14:46)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440092024">PR Review</a>.</p>



<a name="202445442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202445442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202445442">(Jun 30 2020 at 14:46)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447741648">PR Review Comment</a>:</p>
<blockquote>
<p>I'm mostly just a bit worried about this conversion is open-coded in a number of places. Not the worst thing in the world but it'd be great if we could centralize/document this somehow.</p>
</blockquote>



<a name="202472823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202472823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202472823">(Jun 30 2020 at 18:00)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440253548">PR Review</a>.</p>



<a name="202472824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202472824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202472824">(Jun 30 2020 at 18:00)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440253548">PR Review</a>.</p>



<a name="202472825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202472825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202472825">(Jun 30 2020 at 18:00)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r447872085">PR Review Comment</a>:</p>
<blockquote>
<p>It would be good to avoid these <code>unwrap</code>s and instead make these functions fallible, which will allow the user to recover when loading a bad object.</p>
</blockquote>



<a name="202472911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202472911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202472911">(Jun 30 2020 at 18:01)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440253548">PR Review</a>.</p>



<a name="202495365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202495365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202495365">(Jun 30 2020 at 21:10)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202506859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202506859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202506859">(Jun 30 2020 at 23:16)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="202506907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202506907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202506907">(Jun 30 2020 at 23:17)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440448343">PR Review</a>.</p>



<a name="202506908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202506908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202506908">(Jun 30 2020 at 23:17)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r448030744">PR Review Comment</a>:</p>
<blockquote>
<p>It this moment we fully trust the generated image, but in the future it might change. I added TODO comment about that.</p>
</blockquote>



<a name="202507000"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202507000" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202507000">(Jun 30 2020 at 23:18)</a>:</h4>
<p>yurydelendik submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-440448695">PR Review</a>.</p>



<a name="202507001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202507001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202507001">(Jun 30 2020 at 23:18)</a>:</h4>
<p>yurydelendik created <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#discussion_r448031059">PR Review Comment</a>:</p>
<blockquote>
<p>centralized name handling (inside <a href="http://object.rs">object.rs</a>) and added more docs</p>
</blockquote>



<a name="202573903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/202573903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#202573903">(Jul 01 2020 at 14:17)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="203039805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/203039805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#203039805">(Jul 06 2020 at 20:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1931#pullrequestreview-443402592">PR Review</a>.</p>



<a name="203042238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/203042238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#203042238">(Jul 06 2020 at 21:21)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="203112250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/203112250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#203112250">(Jul 07 2020 at 14:49)</a>:</h4>
<p>yurydelendik updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>Pilot usage of <code>serde</code> to save all compilation artifacts</li>
</ul>
</blockquote>



<a name="203120080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/203120080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#203120080">(Jul 07 2020 at 15:44)</a>:</h4>
<p>yurydelendik edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a> from <code>compiler-elf</code> to <code>main</code>:</p>
<blockquote>
<p>The following refactoring is a first step towards #1779 .</p>
<p>The main idea is to create object/ELF image as the result of the compilation (which can be saved/serialized in the future). The linker will work with this image directly after it is allocated in the <code>CodeMemory</code>. In the past, we did the similar thing with debug image created for GDB JIT interface. Now, we can use the ELF image created after compilation, and convert it to an loadable object.</p>
<p>There is somewhat common/duplicated code in <code>cranelift-object</code> and <code>creates/obj</code>, this PR is not refactoring these crates yet. It is a work for follow up PRs.</p>
<p>The changes:</p>
<ul>
<li>Create the ELF image from <code>Compilation</code></li>
<li>Create <code>CodeMemory</code> from the ELF image</li>
<li>Link using ELF image</li>
<li>Remove creation of GDB JIT images from <code>crates/debug</code></li>
<li>Move <code>make_trampoline</code> from <a href="http://compiler.rs">compiler.rs</a></li>
<li>&lt;del&gt;Pilot usage of <code>serde</code> to save all compilation artifacts&lt;/del&gt;</li>
</ul>
</blockquote>



<a name="203136485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231931%20Write%20ELF%20image%20and%20instantiate%20code_.../near/203136485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231931.20Write.20ELF.20image.20and.20instantiate.20code_.2E.2E.2E.html#203136485">(Jul 07 2020 at 17:51)</a>:</h4>
<p>yurydelendik merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1931">PR #1931</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>