<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2428 wiggle: support overlapping immutable... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html">wasmtime / PR #2428 wiggle: support overlapping immutable...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="217209266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217209266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217209266">(Nov 18 2020 at 23:08)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217209267"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217209267" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217209267">(Nov 18 2020 at 23:08)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a>.</p>



<a name="217209285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217209285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217209285">(Nov 18 2020 at 23:08)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217210617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217210617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217210617">(Nov 18 2020 at 23:26)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217304177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304177">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-534687569">PR Review</a>.</p>



<a name="217304178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304178">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527072178">PR Review Comment</a>:</p>
<blockquote>
<p>This looks like it's probably the same as <code>as_slice_mut</code> (for the most part), so could some of the internal bits be refactored into a helper called from both functions?</p>
</blockquote>



<a name="217304179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304179">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-534687569">PR Review</a>.</p>



<a name="217304181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304181">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527071303">PR Review Comment</a>:</p>
<blockquote>
<p>Perhaps eliding the <code>!</code> and switching to <code>any</code>?</p>
</blockquote>



<a name="217304182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304182">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527072366">PR Review Comment</a>:</p>
<blockquote>
<p>(same thoughts as above for slices)</p>
</blockquote>



<a name="217304183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304183">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527072791">PR Review Comment</a>:</p>
<blockquote>
<p>We technically statically know whether this is a shared or mutable borrow, so could there be two unborrow methods instead of one that checks both maps?</p>
</blockquote>



<a name="217304184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217304184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217304184">(Nov 19 2020 at 17:36)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527073121">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW this is excluded from publication so it's fine to avoid bumping the version here.</p>
</blockquote>



<a name="217310322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217310322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217310322">(Nov 19 2020 at 18:24)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-534718901">PR Review</a>.</p>



<a name="217310323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217310323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217310323">(Nov 19 2020 at 18:24)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527095582">PR Review Comment</a>:</p>
<blockquote>
<p>The comments for <code>mut_borrow</code> can now refer to <code>GuestSliceMut</code> and <code>GuestStrMut</code>. And this comment can be adapted for <code>immut_borrow</code> below to refer to <code>GuestSlice</code> and <code>GuestStr</code>, <code>&amp;</code> access, and to drop the "at most one" language.</p>
</blockquote>



<a name="217310324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217310324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217310324">(Nov 19 2020 at 18:24)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527100149">PR Review Comment</a>:</p>
<blockquote>
<p>This <code>unsafe</code> could use a coment similar to above; <code>SAFETY: iff there are no overlapping borrows it is ok to construct a &amp;mut str</code>.</p>
</blockquote>



<a name="217310325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217310325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217310325">(Nov 19 2020 at 18:24)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527099310">PR Review Comment</a>:</p>
<blockquote>
<p>Should this say "no overlapping <em>mut</em> borrows it is ok to construct a <em>&amp;str</em>`?</p>
</blockquote>



<a name="217310327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217310327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217310327">(Nov 19 2020 at 18:24)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-534718901">PR Review</a>.</p>



<a name="217344854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217344854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217344854">(Nov 19 2020 at 23:29)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217351695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217351695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217351695">(Nov 20 2020 at 01:14)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527331425">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> This is a helpful change for users who may want to reuse this script to install OpenVINO; not sure why the paths seem messed up in the CI (I usually use a simpler version of "find the directory this script lives in," FWIW). If you want, you could use Bash variables defaults for the version, <code>${1:-"..."}</code>.</p>
</blockquote>



<a name="217351696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217351696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217351696">(Nov 20 2020 at 01:14)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535003814">PR Review</a>.</p>



<a name="217421602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217421602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217421602">(Nov 20 2020 at 16:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535565296">PR Review</a>.</p>



<a name="217421603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217421603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217421603">(Nov 20 2020 at 16:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527796912">PR Review Comment</a>:</p>
<blockquote>
<p>Is it possible to <code>debug_assert!</code> that this did a removal?</p>
</blockquote>



<a name="217438550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438550">(Nov 20 2020 at 18:12)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535668656">PR Review</a>.</p>



<a name="217438551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438551">(Nov 20 2020 at 18:12)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527886371">PR Review Comment</a>:</p>
<blockquote>
<p>I don't know bash very well, this is just a copypaste of what stackoverflow says to do... I'll see what went wrong in CI</p>
</blockquote>



<a name="217438592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438592">(Nov 20 2020 at 18:13)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535668899">PR Review</a>.</p>



<a name="217438593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438593">(Nov 20 2020 at 18:13)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527886556">PR Review Comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="217438677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438677">(Nov 20 2020 at 18:13)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535669433">PR Review</a>.</p>



<a name="217438679"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217438679" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217438679">(Nov 20 2020 at 18:13)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527886932">PR Review Comment</a>:</p>
<blockquote>
<p>Great idea</p>
</blockquote>



<a name="217446666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217446666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217446666">(Nov 20 2020 at 19:18)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535712245">PR Review</a>.</p>



<a name="217446667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217446667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217446667">(Nov 20 2020 at 19:18)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527920594">PR Review Comment</a>:</p>
<blockquote>
<p>I looked into this and because of the interleaving of the mut/shared with validation theres really only opportunity to factor out the top two statements into a func, which I don't think is worth the readability hit.</p>
</blockquote>



<a name="217446955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217446955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217446955">(Nov 20 2020 at 19:20)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217447269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217447269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217447269">(Nov 20 2020 at 19:23)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217447293"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217447293" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217447293">(Nov 20 2020 at 19:23)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#pullrequestreview-535715274">PR Review</a>.</p>



<a name="217447294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217447294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217447294">(Nov 20 2020 at 19:23)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2428#discussion_r527923021">PR Review Comment</a>:</p>
<blockquote>
<p>The script error was a simple typo, should be fixed now</p>
</blockquote>



<a name="217449619"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217449619" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217449619">(Nov 20 2020 at 19:42)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217450048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217450048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217450048">(Nov 20 2020 at 19:46)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217463842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217463842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217463842">(Nov 20 2020 at 21:56)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a> from <code>pch/wiggle_immut_borrows</code> to <code>main</code>:</p>
<blockquote>
<p>This PR renames the existing <code>GuestSlice</code> and <code>GuestStr</code> (which impl both <code>Deref</code> and <code>DerefMut</code>) to <code>GuestSliceMut</code> and <code>GuestStrMut</code>, and makes an immutable version of each called <code>GuestSlice</code> and <code>GuestStr</code>, which only impl <code>Deref</code>.</p>
<p>The borrow checker now distinguishes between mutable and immutable borrows, allowing overlapping immutable borrows, while still requiring mutable borrows be exclusive. Tests have been updated to exercise this, and wasi-common has been ported to borrow mutable strs and slices where necessary.</p>
<p>This also moves the borrow checker implementation, which was duplicated under <code>wiggle/wasmtime</code> and <code>wiggle/test-helpers</code> (and additionally over in Lucet), into its own crate <code>wiggle-borrow</code> at <code>wiggle/borrow</code>. Users can still choose whether to use it to <code>impl GuestMemory</code> or not, but putting it in a crate gets rid of some code duplication, which I care about now that the code actually changed.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="217473642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232428%20wiggle%3A%20support%20overlapping%20immutable.../near/217473642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232428.20wiggle.3A.20support.20overlapping.20immutable.2E.2E.2E.html#217473642">(Nov 20 2020 at 23:58)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2428">PR #2428</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>