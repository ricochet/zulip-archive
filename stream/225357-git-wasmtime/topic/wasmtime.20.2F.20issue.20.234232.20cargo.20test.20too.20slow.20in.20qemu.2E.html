<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4232 cargo test too slow in qemu. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html">wasmtime / issue #4232 cargo test too slow in qemu.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="285197577"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234232%20cargo%20test%20too%20slow%20in%20qemu./near/285197577" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html#285197577">(Jun 07 2022 at 02:46)</a>:</h4>
<p>yuyang-ok opened <a href="https://github.com/bytecodealliance/wasmtime/issues/4232">issue #4232</a>:</p>
<blockquote>
<p>I want to test riscv64 backend, but the build is just to slow.<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/docs/testing.md">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/docs/testing.md</a></p>
<p>cargo </p>
</blockquote>
<p>root@debian:~/projects/wasmtime# cargo version<br>
cargo 1.63.0-nightly (38472bc19 2022-05-31)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">qemu</span><span class="w"></span>
</code></pre></div>
<p>yuyang@yuyang-vmwarevirtualplatform:~/debian-rv64/artifacts$ qemu-system-riscv64 --version<br>
QEMU emulator version 6.2.0 (Debian 1:6.2+dfsg-2ubuntu6)<br>
Copyright (c) 2003-2021 Fabrice Bellard and the QEMU Project developers</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w">  </span><span class="n">test</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="285198369"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234232%20cargo%20test%20too%20slow%20in%20qemu./near/285198369" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html#285198369">(Jun 07 2022 at 03:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/4232#issuecomment-1148139358">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4232">issue #4232</a>:</p>
<blockquote>
<p>Hi @yuyang-ok, for clarity, are you running the compiler (<code>cargo test</code> command) inside a RISC-V emulated virtual machine? Or are you using the qemu emulator just to run the compiled binary, after cross-compiling?</p>
<p>There is some documentation <a href="https://github.com/bytecodealliance/wasmtime/blob/main/docs/contributing-building.md#cross-compiling-wasmtime">here</a> about how to cross-compile Wasmtime/Cranelift and set the right environment variables so that <code>cargo test</code> running on your native system can invoke just the test binaries under emulation.</p>
<p>That said, this isn't really an issue with Wasmtime -- emulation is known to be slow, and it's kind of a fundamental downside of the approach compared to native hardware -- so I'm going to close this issue now.</p>
</blockquote>



<a name="285198372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234232%20cargo%20test%20too%20slow%20in%20qemu./near/285198372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html#285198372">(Jun 07 2022 at 03:01)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/4232">issue #4232</a>:</p>
<blockquote>
<p>I want to test riscv64 backend, but the build is just to slow.<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/docs/testing.md">https://github.com/bytecodealliance/wasmtime/blob/main/cranelift/docs/testing.md</a></p>
<p>cargo </p>
</blockquote>
<p>root@debian:~/projects/wasmtime# cargo version<br>
cargo 1.63.0-nightly (38472bc19 2022-05-31)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">qemu</span><span class="w"></span>
</code></pre></div>
<p>yuyang@yuyang-vmwarevirtualplatform:~/debian-rv64/artifacts$ qemu-system-riscv64 --version<br>
QEMU emulator version 6.2.0 (Debian 1:6.2+dfsg-2ubuntu6)<br>
Copyright (c) 2003-2021 Fabrice Bellard and the QEMU Project developers</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="o">'</span><span class="na">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w">  </span><span class="n">test</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="285206635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234232%20cargo%20test%20too%20slow%20in%20qemu./near/285206635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html#285206635">(Jun 07 2022 at 05:52)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/issues/4232#issuecomment-1148225663">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4232">issue #4232</a>:</p>
<blockquote>
<p>I am just  running the compiler (cargo test command) inside a RISC-V emulated.</p>
</blockquote>



<a name="285247624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234232%20cargo%20test%20too%20slow%20in%20qemu./near/285247624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234232.20cargo.20test.20too.20slow.20in.20qemu.2E.html#285247624">(Jun 07 2022 at 13:09)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/4232#issuecomment-1148651002">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/4232">issue #4232</a>:</p>
<blockquote>
<p>One other thing to watch out for when running Wasmtime tests is that Wasmtime makes very large virtual address space reservations by default and if emulation doesn't do the right thing then this can be excessively slow. We <a href="https://github.com/bytecodealliance/wasmtime/blob/3f152273d3629689ed26a8120f631537d6452b2d/.github/workflows/main.yml#L261-L263">do some tricks in CI</a> to make this faster which if you're trying to run in emulation you may be interested in mirroring.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>