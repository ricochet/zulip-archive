<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2060 Add support for f32x4 and f64x2 arith... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html">wasmtime / PR #2060 Add support for f32x4 and f64x2 arith...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="204617472"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204617472" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204617472">(Jul 22 2020 at 00:05)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<a name="204617473"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204617473" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204617473">(Jul 22 2020 at 00:05)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204638982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638982">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453079682">PR Review</a>.</p>



<a name="204638983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638983">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458605237">PR Review Comment</a>:</p>
<blockquote>
<p>This is because the <code>dst</code> operand in <code>xmm_rm_r</code> is the read-write operand, so we need to generate a move here, at the virtual register level. It doesn't necessarily materialize as a move instruction, because regalloc will try hard to coalesce the two virtual registers (and assign them the same physical register).</p>
</blockquote>



<a name="204638984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638984">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453079682">PR Review</a>.</p>



<a name="204638986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638986">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458606132">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, as Chris noted, we need a way to "connect" the input and output registers, so we need to generate a move instruction here; again, it won't necessarily materialize as a move instruction.</p>
</blockquote>



<a name="204638987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638987">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458606386">PR Review Comment</a>:</p>
<blockquote>
<p>pre-existing: can you use <code>Inst::gen_move</code> here, instead? (and fill in the right bits in <code>gen_move</code> to support vector instructions)?</p>
</blockquote>



<a name="204638988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638988">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458605553">PR Review Comment</a>:</p>
<blockquote>
<p>I expect this to be incomplete, or a typo :-)</p>
</blockquote>



<a name="204638989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204638989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204638989">(Jul 22 2020 at 07:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458606821">PR Review Comment</a>:</p>
<blockquote>
<p>Can we tweak this to add a check that the vector type is 128-bits wide?</p>
</blockquote>



<a name="204692062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204692062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204692062">(Jul 22 2020 at 16:51)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453505753">PR Review</a>.</p>



<a name="204692064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204692064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204692064">(Jul 22 2020 at 16:51)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r458939469">PR Review Comment</a>:</p>
<blockquote>
<p>Yup, good catch <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span>.</p>
</blockquote>



<a name="204720798"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204720798" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204720798">(Jul 22 2020 at 20:47)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204723337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204723337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204723337">(Jul 22 2020 at 21:08)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204736423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736423">(Jul 22 2020 at 23:52)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204736648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736648">(Jul 22 2020 at 23:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453761189">PR Review</a>.</p>



<a name="204736650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736650">(Jul 22 2020 at 23:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459147982">PR Review Comment</a>:</p>
<blockquote>
<p>@cfallin I had to switch over to this version of <code>fneg</code> due to negating signed 0s (previously I had the "subtract the value from 0.0 version") but I believe that using this temporary register is causing this to fail again in the register allocator?</p>
<p><code>thread '&lt;unnamed&gt;' panicked at 'register allocation: Analysis(EntryLiveinValues)', cranelift/codegen/src/machinst/compile.rs:73:9</code> </p>
</blockquote>



<a name="204736707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736707">(Jul 22 2020 at 23:57)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453761619">PR Review</a>.</p>



<a name="204736708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736708">(Jul 22 2020 at 23:57)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459148342">PR Review Comment</a>:</p>
<blockquote>
<p>I should have different paths for scalar and vector values here at some point but currently I am only running <code>simd_f32x4_arith.wast</code>.</p>
</blockquote>



<a name="204736788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736788">(Jul 22 2020 at 23:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453761923">PR Review</a>.</p>



<a name="204736789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204736789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204736789">(Jul 22 2020 at 23:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459148614">PR Review Comment</a>:</p>
<blockquote>
<p>Should there be a <code>gen_move</code> here as well (for <code>Opcode::Sqrt</code>)?</p>
</blockquote>



<a name="204737653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204737653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204737653">(Jul 23 2020 at 00:11)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453766015">PR Review</a>.</p>



<a name="204737654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204737654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204737654">(Jul 23 2020 at 00:11)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459152147">PR Review Comment</a>:</p>
<blockquote>
<p>We don't necessarily have to things this way--an alternate approach would be to have all of the different opcodes for packed shifts live separately under <code>SseOpcode</code>. I only did this to match what I saw for scalar shifts.</p>
</blockquote>



<a name="204739599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204739599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204739599">(Jul 23 2020 at 00:41)</a>:</h4>
<p>abrown edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459152147">PR Review Comment</a>.</p>



<a name="204739834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204739834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204739834">(Jul 23 2020 at 00:45)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453775568">PR Review</a>.</p>



<a name="204739835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204739835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204739835">(Jul 23 2020 at 00:45)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459160799">PR Review Comment</a>:</p>
<blockquote>
<p>@cfallin proposed to add a <code>Inst::InputInvariant</code> (or perhaps <code>Input::InputClobber</code>) that would allow us to use <code>PXOR</code>, <code>CMPEQPS</code>, etc., to generate certain constants. That new <code>Inst</code> would have a single <code>Writable&lt;Reg&gt;</code> and it's <code>get_reg</code> would contain one def and no uses.</p>
</blockquote>



<a name="204761778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204761778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204761778">(Jul 23 2020 at 05:24)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453842407">PR Review</a>.</p>



<a name="204761779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204761779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204761779">(Jul 23 2020 at 05:24)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459220462">PR Review Comment</a>:</p>
<blockquote>
<p>@bnjbvr and I discussed this (the use of <code>PXOR r,r</code>, <code>CMPEQPS r,r</code> etc) to generate constants in registers, and the effect on the regalloc.  All that is needed to keep regalloc happy is for <code>get_regs</code> to spot such cases (where the two registers are the same) and report a single <code>def</code> for the register, instead of the usual <code>use+mod</code> pair.  No need for any <code>Inst::InputInvariant</code> or <code>Input::InputClobber</code> or any other form of hinting.</p>
</blockquote>



<a name="204761828"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204761828" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204761828">(Jul 23 2020 at 05:25)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453842764">PR Review</a>.</p>



<a name="204761829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204761829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204761829">(Jul 23 2020 at 05:25)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459220781">PR Review Comment</a>:</p>
<blockquote>
<p>I agree with that; shifts are not magically different here, so they should just be part of <code>SseOpcode</code>.</p>
</blockquote>



<a name="204765074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204765074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204765074">(Jul 23 2020 at 06:47)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-453870262">PR Review</a>.</p>



<a name="204765075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204765075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204765075">(Jul 23 2020 at 06:47)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459244717">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, ignore my previous comment.  In fact vector shifts by immediates do need a separate <code>Inst</code> case because they have a different "shape" from normal XMM insns -- the read-only (<code>src</code>) operand is an immediate, not a RM.  Note that <code>RegMemImm</code> has no place in XMM-world as far as I know.  Hence I suggest the following:</p>
<div class="codehilite"><pre><span></span><code>/// XMM shifts by immediates.
XmmShiftByImm {
   opcode: SseOpcode,
   amount: u8,
   dst: Writable&lt;Reg&gt;
}
</code></pre></div>


<p>Then add the necessary extra entries to <code>SseOpcode</code>, and have the emit function panic for <code>Inst::XmmShiftByImm</code> if <code>opcode</code> is not one of the few acceptable values.</p>
<p>Maybe this should even be called <code>XMM_I_R</code> (so as to be consistent with naming <code>XMM_RM_R</code>).  Then we could use it for any XMM insn which takes an immediate and a modifiable register.  I can't think of any except the abovementioned shifts though.</p>
</blockquote>



<a name="204766873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204766873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204766873">(Jul 23 2020 at 07:21)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459244717">PR Review Comment</a>.</p>



<a name="204790459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790459">(Jul 23 2020 at 12:36)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454085513">PR Review</a>.</p>



<a name="204790460"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790460" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790460">(Jul 23 2020 at 12:36)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459415685">PR Review Comment</a>:</p>
<blockquote>
<p>I don't think so, since sqrt doesn't have any read-write operand. Am i missing something?</p>
</blockquote>



<a name="204790492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790492">(Jul 23 2020 at 12:37)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454085938">PR Review</a>.</p>



<a name="204790494"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790494" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790494">(Jul 23 2020 at 12:37)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459416010">PR Review Comment</a>:</p>
<blockquote>
<p>+1 to @julian-seward1's suggestion to reuse the existing instructions for this purpose.</p>
</blockquote>



<a name="204790681"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790681" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790681">(Jul 23 2020 at 12:39)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454087095">PR Review</a>.</p>



<a name="204790682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204790682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204790682">(Jul 23 2020 at 12:39)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459416956">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed here; the "shape" is equivalent to the <code>InstructionFormat</code> here, so it makes sense to add a new vcode inst.</p>
<p>tiny nit re: naming, since we're moving to some more Rusty-like naming, I'd rather go for properly camelCased <code>XmmImmReg</code> here (there's going to be a PR to make the names more consistent soonish).</p>
</blockquote>



<a name="204794432"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204794432" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204794432">(Jul 23 2020 at 13:09)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454113873">PR Review</a>.</p>



<a name="204794433"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204794433" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204794433">(Jul 23 2020 at 13:09)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459436058">PR Review Comment</a>:</p>
<blockquote>
<p>I agree with @bnjbvr; the insn reads its input register and writes a different output register, but there's no <code>mod</code>-ify style behaviour.  Note that <code>get_regs</code> for <code>XMM_RegMem_Reg</code> will have to take this into account; that it, it will have to special-case <code>SseOpcode::Sqrtss</code> et al accordingly.</p>
</blockquote>



<a name="204795877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204795877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204795877">(Jul 23 2020 at 13:22)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454123997">PR Review</a>.</p>



<a name="204795878"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204795878" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204795878">(Jul 23 2020 at 13:22)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459444011">PR Review Comment</a>:</p>
<blockquote>
<p>@julian-seward1 Sqrtss uses a different Vcode inst because of this, since it's rather an "unary" opcode (see also <code>XmmUnaryRmR</code>).</p>
</blockquote>



<a name="204809083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204809083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204809083">(Jul 23 2020 at 15:02)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454226391">PR Review</a>.</p>



<a name="204809084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204809084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204809084">(Jul 23 2020 at 15:02)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459517516">PR Review Comment</a>:</p>
<blockquote>
<p>Ok, makes sense.</p>
</blockquote>



<a name="204809718"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204809718" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204809718">(Jul 23 2020 at 15:06)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454230850">PR Review</a>.</p>



<a name="204809719"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204809719" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204809719">(Jul 23 2020 at 15:06)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459520841">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>Note that RegMemImm has no place in XMM-world as far as I know</p>
</blockquote>
<p>I think in this case it does. Packed shifts accept either an <code>imm8</code> or a <code>xmm/m128</code> as operands. So there should be a new <code>Inst</code> like:</p>
<div class="codehilite"><pre><span></span><code>... {
  opcode: SseOpcode,
  src: RegMemImm,
  dst: Writable&lt;Reg&gt;
}
</code></pre></div>


<p>Right? But what do I call it?</p>
</blockquote>



<a name="204822724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204822724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204822724">(Jul 23 2020 at 16:46)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454316786">PR Review</a>.</p>



<a name="204822725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204822725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204822725">(Jul 23 2020 at 16:46)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459587213">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, ok.  So the src operand does have to be <code>RegMemImm</code>.</p>
<p>As for a name, what it really wants to have is <code>Xmm_RegMemImm_Reg</code>.  But the Rust naming rules would require jamming all that together, <code>XmmRegMemImmReg</code>, which is ambiguous: the underscores give meaning.  @bnjbvr do you think this is one place where we might apply for an exemption to the normal rules?</p>
</blockquote>



<a name="204823204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204823204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204823204">(Jul 23 2020 at 16:51)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454320269">PR Review</a>.</p>



<a name="204823205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204823205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204823205">(Jul 23 2020 at 16:51)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459589948">PR Review Comment</a>:</p>
<blockquote>
<p>In Zulip @bnjbvr suggested <code>XmmRmiReg</code> which is shorter and avoids the ambiguity.</p>
</blockquote>



<a name="204829396"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204829396" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204829396">(Jul 23 2020 at 17:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454360866">PR Review</a>.</p>



<a name="204829397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204829397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204829397">(Jul 23 2020 at 17:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459621850">PR Review Comment</a>:</p>
<blockquote>
<p>One concern I'd have in using the same instruction format for both e.g. <code>PXOR</code> and <code>PAND</code> (if that's a thing? let's say it exists as a straw-instruction if not), with the <code>get_regs</code> logic to special-case the same-register case, is that the input-invariant behavior really does depend on the opcode. So <code>PXOR r1, r1</code> zeroes <code>r1</code>, and doesn't use its initial value; but <code>PAND r1, r1</code> leaves <code>r1</code>'s final value equal to its initial value (so uses <code>r1</code>).</p>
<p>Using a <code>mod</code> for the first reg would solve this issue (<code>PAND</code> would still be correct), but then doesn't give us the behavior we want for <code>PXOR</code>, because <code>r1</code> is still (incorrectly, or rather imprecisely) seen as an input, even though the instruction semantically does <code>r1 := 0</code> no matter what.</p>
<p>So I think we either need variants of <code>Inst</code>, or else we need a flag inside of this variant, or else we need logic in <code>get_regs</code> to look at the opcode, to know the difference between ops where <code>a OP b = constant</code> and <code>a OP b = f(a, b)</code>. I'd prefer the first (it feels cleanest), but any is fine. Thoughts?</p>
</blockquote>



<a name="204834566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204834566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204834566">(Jul 23 2020 at 18:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454387719">PR Review</a>.</p>



<a name="204834567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204834567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204834567">(Jul 23 2020 at 18:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459643001">PR Review Comment</a>:</p>
<blockquote>
<p>(Actually, I'm warming up to the third option now; basically we want a helper <code>op_on_self_yields_constant</code> or somesuch, and call that in <code>get_regs</code>, which is just a match yielding a bool, which is simple enough.)</p>
</blockquote>



<a name="204875317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204875317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204875317">(Jul 24 2020 at 03:10)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-454613643">PR Review</a>.</p>



<a name="204875318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204875318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204875318">(Jul 24 2020 at 03:10)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r459832455">PR Review Comment</a>:</p>
<blockquote>
<p>For me, the simplest and most obvious solution is also the third.  In short we want <code>get_regs</code> to always tell us the exact truth, and if it requires looking at the opcode and/or operands, so be it.  To allow a situation where it doesn't tell us the exact truth strikes me as setting a dangerous precedent.</p>
<p>I wouldn't even bother with a helper -- these cases are sufficiently rare to make that unnecessary.  I'd just write something like</p>
<div class="codehilite"><pre><span></span><code>if opcode == XOR &amp;&amp; src.isReg() &amp;&amp; src.Reg() == dst { // special case }
</code></pre></div>


<p>It's one extra line (more or less).</p>
</blockquote>



<a name="204956276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204956276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204956276">(Jul 24 2020 at 19:23)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204959603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204959603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204959603">(Jul 24 2020 at 19:57)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204963210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963210">(Jul 24 2020 at 20:32)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204963246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963246">(Jul 24 2020 at 20:33)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> as ready for review.</p>



<a name="204963250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963250">(Jul 24 2020 at 20:33)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<a name="204963252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963252">(Jul 24 2020 at 20:33)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> and <a href="https://github.com/bnjbvr">bnjbvr</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<a name="204963260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963260">(Jul 24 2020 at 20:33)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a>, <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<a name="204963677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204963677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204963677">(Jul 24 2020 at 20:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="204968965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204968965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204968965">(Jul 24 2020 at 21:29)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-455192022">PR Review</a>.</p>



<a name="204968966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204968966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204968966">(Jul 24 2020 at 21:29)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-455192022">PR Review</a>.</p>



<a name="204968967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204968967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204968967">(Jul 24 2020 at 21:29)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460293705">PR Review Comment</a>:</p>
<blockquote>
<p>Given that this logic is duplicated, let's pull it out into a helper to ensure the two locations stay in sync.</p>
</blockquote>



<a name="204968968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204968968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204968968">(Jul 24 2020 at 21:29)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460293433">PR Review Comment</a>:</p>
<blockquote>
<p>I'd prefer to add a bit more detail here -- something like:</p>
<p>"In certain cases, instructions of this format can act as a definition of an XMM register, producing a value that is independent of its initial value. For example, a vector equality comparison (<code>cmppd</code> or <code>cmpps</code>) that compares a register to itself will generate all ones as a result, regardless of its value. From the register allocator's point of view, we should (i) record the first register, which is normally a mod, as a def instread; and (ii) not record the second register as a use, because it is the same as the first register (already handed)."</p>
<p>Maybe also "Any opcode for which <code>a OP b = constant</code> is true can be included here; we may add more in the future, such as <code>XOR</code>."?</p>
</blockquote>



<a name="204968969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204968969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204968969">(Jul 24 2020 at 21:29)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460294606">PR Review Comment</a>:</p>
<blockquote>
<p>We should be able to do something like:</p>
<div class="codehilite"><pre><span></span><code>match (a_op_b_is_constant(op), src) {
    (true, RegMem::Reg { reg }) if *reg == dst.to_reg() =&gt; { ... }
    _ =&gt; { ... }
</code></pre></div>


<p>to combine the <code>if</code>s. (And probably ignore my half-baked name for the helper...)</p>
</blockquote>



<a name="204969625"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204969625" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204969625">(Jul 24 2020 at 21:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-455199013">PR Review</a>.</p>



<a name="204969627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/204969627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#204969627">(Jul 24 2020 at 21:37)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460299211">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, nice, let me try that...</p>
</blockquote>



<a name="205130978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130978">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-455850088">PR Review</a>.</p>



<a name="205130979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130979">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-455850088">PR Review</a>.</p>



<a name="205130980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130980">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460942376">PR Review Comment</a>:</p>
<blockquote>
<p>Can you please add a TODO comment about the fact that it might incur a cross-domain penalty for packed ints, and that we might want to specialize the move later?</p>
</blockquote>



<a name="205130981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130981">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460946386">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, it could be at an arbitrary offset. Do you mind implementing it in this PR, please?</p>
</blockquote>



<a name="205130982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130982">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460942980">PR Review Comment</a>:</p>
<blockquote>
<p>preexisting, but maybe we could remove <code>I128</code> and <code>B128</code> from this list, and have another match arm below with only the v128 test?</p>
</blockquote>



<a name="205130983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130983">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460946588">PR Review Comment</a>:</p>
<blockquote>
<p>ditto here</p>
</blockquote>



<a name="205130984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130984">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460954127">PR Review Comment</a>:</p>
<blockquote>
<p>nit: if no other instruction you've implemented in this PR uses this Vcode inst, how about inlining the value of <code>0x0fc2</code> where it's used, instead?</p>
</blockquote>



<a name="205130985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130985">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460954516">PR Review Comment</a>:</p>
<blockquote>
<p>nit: can you add in comments an example of this instruction?</p>
</blockquote>



<a name="205130986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130986">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460947251">PR Review Comment</a>:</p>
<blockquote>
<p>It's weird to have a commit that introduces this but don't use it directly; no need to worry, we'll just squash before merging.</p>
</blockquote>



<a name="205130987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130987">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460953196">PR Review Comment</a>:</p>
<blockquote>
<p>Since we also use ucomiss/ucomisd for float comparisons, and those don't have the same set of encodable conditions, could you rename this? Good names are hard to distinguish between other float CCs and these. The main difference is that the cmpps family returns a boolean mask in the dst operand, so how about <code>CmpMaskPredicate</code>? (as opposed to the valid set of predicates that can be used in ucomiss as <code>CmpFlagsPredicate</code>, if there was the need for such an enum)</p>
</blockquote>



<a name="205130988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130988">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460954759">PR Review Comment</a>:</p>
<blockquote>
<p>Can you add a call to <code>src.assert_reg_type_is</code> too, please? Can you also add asserts for valid immediates?</p>
</blockquote>



<a name="205130989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130989">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460958927">PR Review Comment</a>:</p>
<blockquote>
<p>The way to go here would be to use the <code>OperandSize</code> (maybe add variants for lower sizes), and have it in the instruction, instead of having one SSE opcode per size. Since you need a new Inst anyways, how about doing this here?</p>
</blockquote>



<a name="205130990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130990">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460963230">PR Review Comment</a>:</p>
<blockquote>
<p>Shouldn't this be cmpps or cmppd according to the input type? If not, it might be worth commenting why it's ok to do this here.</p>
</blockquote>



<a name="205130991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130991">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460967448">PR Review Comment</a>:</p>
<blockquote>
<p>The shift amount should be 1 for andps and andpd, for this to work correctly.</p>
</blockquote>



<a name="205130992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130992">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460961888">PR Review Comment</a>:</p>
<blockquote>
<p>nit: Can you use <code>FloatComparisonPredicate::from(FloatCC::Equal)</code> instead? it doesn't require the explicit type then, which is nice.</p>
</blockquote>



<a name="205130993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130993">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460959866">PR Review Comment</a>:</p>
<blockquote>
<p>Can you add an assert on the src reg's type here too, please?</p>
</blockquote>



<a name="205130994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130994">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460962429">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe put a panic with a message explaining which combination has been seen?</p>
</blockquote>



<a name="205130995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130995">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460956302">PR Review Comment</a>:</p>
<blockquote>
<p>light suggestion: we use <code>def</code> for <code>definition</code> / <code>define</code> in misc places in the code base, so for consistency, it'd be nice to use it here too.</p>
</blockquote>



<a name="205130996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130996">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460965548">PR Review Comment</a>:</p>
<blockquote>
<p>nit: the above comment and this variable name hide the fact that it can be used for AND'ing and taking the absolute value too.</p>
</blockquote>



<a name="205130997"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130997" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130997">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460960615">PR Review Comment</a>:</p>
<blockquote>
<p>Is the lowering missing for these operations?</p>
</blockquote>



<a name="205130998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205130998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205130998">(Jul 27 2020 at 15:21)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r460961556">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, we shouldn't probably duplicate this comment everywhere, since it's the regular way to do things in x86; we may add a file doc-comment at some point explaining this, maybe. It's fine to keep this comment until then.</p>
</blockquote>



<a name="205268772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205268772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205268772">(Jul 28 2020 at 17:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456875233">PR Review</a>.</p>



<a name="205268774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205268774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205268774">(Jul 28 2020 at 17:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461767458">PR Review Comment</a>:</p>
<blockquote>
<p>Hm, <code>match (..., src)</code> takes ownership and then I can't do <code>src.map_uses</code> later on.</p>
</blockquote>



<a name="205286187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205286187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205286187">(Jul 28 2020 at 20:25)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456984773">PR Review</a>.</p>



<a name="205286188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205286188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205286188">(Jul 28 2020 at 20:25)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461857033">PR Review Comment</a>:</p>
<blockquote>
<p>I had something like the <code>OperandSize</code> approach but based on someone's comments, I refactored it to this.</p>
</blockquote>



<a name="205286580"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205286580" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205286580">(Jul 28 2020 at 20:28)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456986487">PR Review</a>.</p>



<a name="205286581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205286581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205286581">(Jul 28 2020 at 20:28)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461858412">PR Review Comment</a>:</p>
<blockquote>
<p>Nope, see shifts.</p>
</blockquote>



<a name="205287180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205287180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205287180">(Jul 28 2020 at 20:32)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456989355">PR Review</a>.</p>



<a name="205287181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205287181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205287181">(Jul 28 2020 at 20:32)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461860682">PR Review Comment</a>:</p>
<blockquote>
<p>I don't think it matters since the result is all 1s either way and we don't cross domains.</p>
</blockquote>



<a name="205288381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205288381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205288381">(Jul 28 2020 at 20:42)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456996076">PR Review</a>.</p>



<a name="205288382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205288382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205288382">(Jul 28 2020 at 20:42)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461866057">PR Review Comment</a>:</p>
<blockquote>
<p>They are used directly. I think what was happening is that some <code>*</code> use above was allowing things to work... which is more weird.</p>
</blockquote>



<a name="205288459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205288459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205288459">(Jul 28 2020 at 20:43)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-456996599">PR Review</a>.</p>



<a name="205288462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205288462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205288462">(Jul 28 2020 at 20:43)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461866458">PR Review Comment</a>:</p>
<blockquote>
<p>BTW, I purposely split these commits all up to atomic changes so we wouldn't have to squash.</p>
</blockquote>



<a name="205289717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205289717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205289717">(Jul 28 2020 at 20:55)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="205290121"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205290121" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205290121">(Jul 28 2020 at 20:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-457007179">PR Review</a>.</p>



<a name="205290122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205290122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205290122">(Jul 28 2020 at 20:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461874838">PR Review Comment</a>:</p>
<blockquote>
<p>This is being done in #2071; we need to figure out a merge ordering for these two PRs.</p>
</blockquote>



<a name="205294015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205294015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205294015">(Jul 28 2020 at 21:40)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-457048444">PR Review</a>.</p>



<a name="205294019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205294019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205294019">(Jul 28 2020 at 21:40)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r461895859">PR Review Comment</a>:</p>
<blockquote>
<p>I'm open to a different name but it should probably have the <code>Float</code> in the name somewhere and I'm not too sure about <code>Mask</code>--it relates to the instruction semantics but not directly to the predicate so that is a bit confusing.</p>
</blockquote>



<a name="205299135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205299135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205299135">(Jul 28 2020 at 22:37)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code>thread &#39;&lt;unnamed&gt;&#39; panicked at &#39;register allocation: Analysis(EntryLiveinValues)&#39;, cranelift/codegen/src/machinst/compile.rs:73:9
</code></pre></div>


</blockquote>



<a name="205414598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205414598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205414598">(Jul 29 2020 at 21:15)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;register</span><span class="w"> </span><span class="n">allocation</span>: <span class="nc">Analysis</span><span class="p">(</span><span class="n">EntryLiveinValues</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205414942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205414942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205414942">(Jul 29 2020 at 21:18)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;register</span><span class="w"> </span><span class="n">allocation</span>: <span class="nc">Analysis</span><span class="p">(</span><span class="n">EntryLiveinValues</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205415913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205415913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205415913">(Jul 29 2020 at 21:27)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/bnjbvr">bnjbvr</a> and <a href="https://github.com/julian-seward1">julian-seward1</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<a name="205496274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205496274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205496274">(Jul 30 2020 at 15:52)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;register</span><span class="w"> </span><span class="n">allocation</span>: <span class="nc">Analysis</span><span class="p">(</span><span class="n">EntryLiveinValues</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205503318"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205503318" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205503318">(Jul 30 2020 at 16:50)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;register</span><span class="w"> </span><span class="n">allocation</span>: <span class="nc">Analysis</span><span class="p">(</span><span class="n">EntryLiveinValues</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205515324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205515324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205515324">(Jul 30 2020 at 18:32)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-458652540">PR Review</a>.</p>



<a name="205515325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205515325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205515325">(Jul 30 2020 at 18:32)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#pullrequestreview-458652540">PR Review</a>.</p>



<a name="205515327"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205515327" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205515327">(Jul 30 2020 at 18:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r463189842">PR Review Comment</a>:</p>
<blockquote>
<p>Maybe you can use <code>let src = input_to_reg(ctx, inputs[0]);</code> here instead, to ensure the input is always emitted in a register? (and put the current src and dst definitions under the then branch above).</p>
</blockquote>



<a name="205515328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205515328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205515328">(Jul 30 2020 at 18:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r463191686">PR Review Comment</a>:</p>
<blockquote>
<p>My convention has been to put <code>Seq</code> in the name for such synthetic instruction sequences, can you add the suffix too, please?</p>
</blockquote>



<a name="205515329"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205515329" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205515329">(Jul 30 2020 at 18:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2060#discussion_r463192535">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
</blockquote>



<a name="205521148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205521148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205521148">(Jul 30 2020 at 19:21)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a> from <code>simd-fp-arith</code> to <code>main</code>:</p>
<blockquote>
<p>This adds support for f32x4 and f64x2 arithmetic in the x64 backend. </p>
<p>Currently, I need some help troubleshooting the error returned by <code>cargo run --features experimental_x64 -- wast --enable-simd tests/spec_testsuite/proposals/simd/simd_f32x4_arith.wast</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="err">&#39;</span><span class="o">&lt;</span><span class="n">unnamed</span><span class="o">&gt;</span><span class="err">&#39;</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="na">&#39;register</span><span class="w"> </span><span class="n">allocation</span>: <span class="nc">Analysis</span><span class="p">(</span><span class="n">EntryLiveinValues</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">73</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>


</blockquote>



<a name="205533682"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232060%20Add%20support%20for%20f32x4%20and%20f64x2%20arith.../near/205533682" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232060.20Add.20support.20for.20f32x4.20and.20f64x2.20arith.2E.2E.2E.html#205533682">(Jul 30 2020 at 21:16)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2060">PR #2060</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>