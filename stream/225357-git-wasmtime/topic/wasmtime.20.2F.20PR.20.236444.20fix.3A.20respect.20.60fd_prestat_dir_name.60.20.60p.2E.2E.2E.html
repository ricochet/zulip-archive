<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6444 fix: respect `fd_prestat_dir_name` `p... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html">wasmtime / PR #6444 fix: respect `fd_prestat_dir_name` `p...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="360804254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360804254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360804254">(May 24 2023 at 14:17)</a>:</h4>
<p>rvolosatovs opened <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a> from <code>rvolosatovs:fix/fd_prestat_dir_name</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Refs <a href="https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1202998079">https://github.com/bytecodealliance/wasmtime/pull/6440#discussion_r1202998079</a></p>
</blockquote>



<a name="360812026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360812026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360812026">(May 24 2023 at 14:45)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360815126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360815126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360815126">(May 24 2023 at 14:56)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360815403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360815403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360815403">(May 24 2023 at 14:57)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360825884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360825884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360825884">(May 24 2023 at 15:35)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360832219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360832219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360832219">(May 24 2023 at 16:00)</a>:</h4>
<p><strong>rvolosatovs</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a> as ready for review.</p>



<a name="360832220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360832220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360832220">(May 24 2023 at 16:00)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/jameysharp">jameysharp</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360832223"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360832223" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360832223">(May 24 2023 at 16:00)</a>:</h4>
<p><strong>rvolosatovs</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360838170"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360838170" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360838170">(May 24 2023 at 16:25)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#pullrequestreview-1442320367">PR review</a>:</p>
<blockquote>
<p>I think this is right but I'd like @pchickey to take a look.</p>
</blockquote>



<a name="360841710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360841710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360841710">(May 24 2023 at 16:39)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#discussion_r1204491748">PR review comment</a>:</p>
<blockquote>
<p>Can we also add a case where we pass a buffer which is 1 byte longer than required</p>
</blockquote>



<a name="360848054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360848054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360848054">(May 24 2023 at 17:06)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360851900"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360851900" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360851900">(May 24 2023 at 17:23)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#discussion_r1204539662">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    // Test that passing a larger than necessary buffer works correctly
    let r = wasi::fd_prestat_dir_name(pr_fd, vec![0; pr_name_len + 1].as_mut_ptr(), pr_name_len + 1);
</code></pre></div><br>
</p>
</blockquote>



<a name="360851949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360851949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360851949">(May 24 2023 at 17:23)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#discussion_r1204540048">PR review comment</a>:</p>
<blockquote>
<p>I'd rather not risk this being UB in the case of an incorrect implementation</p>
</blockquote>



<a name="360853145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360853145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360853145">(May 24 2023 at 17:28)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360853672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360853672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360853672">(May 24 2023 at 17:30)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#pullrequestreview-1442431699">PR review</a>.</p>



<a name="360853707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360853707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360853707">(May 24 2023 at 17:30)</a>:</h4>
<p>pchickey has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="360854502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/360854502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#360854502">(May 24 2023 at 17:34)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#discussion_r1204553099">PR review comment</a>:</p>
<blockquote>
<p>I believe that this as-written is ok, but I'd recommend avoiding this pattern in the future as it's so easy to get wrong. This only works if the <code>vec![...]</code> allocate here lives longer than the function call which I think rustc's temporary rules satisfy here, but I at least personally think it'd be more clear to move the vec above this statement to ensure it lives across the statement.</p>
</blockquote>



<a name="361027295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/361027295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#361027295">(May 25 2023 at 11:19)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="361027829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/361027829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#361027829">(May 25 2023 at 11:22)</a>:</h4>
<p>rvolosatovs created <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#discussion_r1205370781">PR review comment</a>:</p>
<blockquote>
<p>Thanks! Yes, good point, I would guess that <code>miri</code> should complain about this or at least I remember seeing it fail on a similar pattern in a different project before.</p>
</blockquote>



<a name="361031189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/361031189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#361031189">(May 25 2023 at 11:33)</a>:</h4>
<p>rvolosatovs updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<a name="361090695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/361090695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#361090695">(May 25 2023 at 15:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6444#pullrequestreview-1444131521">PR review</a>.</p>



<a name="361102921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236444%20fix%3A%20respect%20%60fd_prestat_dir_name%60%20%60p.../near/361102921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236444.20fix.3A.20respect.20.60fd_prestat_dir_name.60.20.60p.2E.2E.2E.html#361102921">(May 25 2023 at 16:00)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6444">PR #6444</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>