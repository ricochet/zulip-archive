<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7383 wasi-http: Fallible fields set and ap... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html">wasmtime / PR #7383 wasi-http: Fallible fields set and ap...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="398740826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398740826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398740826">(Oct 26 2023 at 18:06)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398740827"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398740827" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398740827">(Oct 26 2023 at 18:06)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398740829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398740829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398740829">(Oct 26 2023 at 18:06)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a> from <code>elliottt:trevor/fallible-fields-operations</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Add the ability to return errors when calls to <code>fields.set</code> or <code>fields.append</code> contain headers that are forbidden, and add the validation functions to <code>WasiHttpView</code> for extensibility. This change also necessitates tracking the intended use of <code>fields</code> values, implicitly set when the <code>fields</code> is constructed from an <code>incoming-request</code> or <code>incoming-response</code>, or explicitly set when using <code>fields.constructor</code>.<br>
</p>
</blockquote>



<a name="398740913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398740913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398740913">(Oct 26 2023 at 18:07)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>:</p>
<blockquote>
<p>Add the ability to return errors when calls to <code>fields.set</code> or <code>fields.append</code> contain headers that are forbidden, and add the validation functions to <code>WasiHttpView</code> for extensibility. This change also necessitates tracking the intended use of <code>fields</code> values, implicitly set when the <code>fields</code> is constructed from an <code>incoming-request</code> or <code>incoming-response</code>, or explicitly set when using <code>fields.constructor</code>.</p>
<p>Fixes #7270</p>
</blockquote>



<a name="398740937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398740937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398740937">(Oct 26 2023 at 18:07)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398741544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398741544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398741544">(Oct 26 2023 at 18:10)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700230076">PR review</a>.</p>



<a name="398741548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398741548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398741548">(Oct 26 2023 at 18:10)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1373553915">PR review comment</a>:</p>
<blockquote>
<p>I don't like this trap when the fields provided aren't meant for a request. This pushes me towards thinking that we shouldn't use a <code>constructor</code> here, but instead a static method for making a request that can fail.</p>
</blockquote>



<a name="398741658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398741658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398741658">(Oct 26 2023 at 18:11)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1373554872">PR review comment</a>:</p>
<blockquote>
<p>I'd appreciate some input on what a good default set of forbidden headers is for requests and responses.</p>
</blockquote>



<a name="398741660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398741660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398741660">(Oct 26 2023 at 18:11)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700231677">PR review</a>.</p>



<a name="398779471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398779471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398779471">(Oct 26 2023 at 22:59)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398780250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398780250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398780250">(Oct 26 2023 at 23:04)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700766448">PR review</a>.</p>



<a name="398780252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398780252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398780252">(Oct 26 2023 at 23:04)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1373908087">PR review comment</a>:</p>
<blockquote>
<p>Would it be useful to add the <code>HeaderMap</code> that's being added to as an argument here as well?</p>
</blockquote>



<a name="398794923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398794923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398794923">(Oct 27 2023 at 01:18)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398799030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398799030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398799030">(Oct 27 2023 at 01:54)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398800007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398800007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398800007">(Oct 27 2023 at 02:02)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>:</p>
<blockquote>
<p>This PR includes two approaches to handling fallible <code>fields</code> methods. Both make the return values of <code>fields.set</code> and <code>fields.append</code> fallible, though they differ in what they consider errors to report at that point.</p>
<ol>
<li>Adds the ability to return errors when calls to <code>fields.set</code> or <code>fields.append</code> contain headers that are forbidden, and add the validation functions to <code>WasiHttpView</code> for extensibility. This change also necessitates tracking the intended use of <code>fields</code> values, implicitly set when the <code>fields</code> is constructed from an <code>incoming-request</code> or <code>incoming-response</code>, or explicitly set when using <code>fields.constructor</code>.</li>
<li>Rejects malformed header names in <code>fields.set</code> and <code>fields.append</code>, but allows forbidden headers at that point. Instead of plumbing through the intended ultimate use in the <code>fields</code> type, validation of forbidden headers is done in the consumer of the <code>outbound-response</code> or <code>outbound-request</code> values (<code>response-outparam.set</code> or the <code>outgoing-handler.handle</code> functions).</li>
</ol>
<p>The last commit implements approach 2, and approach 1 can be seen by reverting it.</p>
<p>Fixes #7270</p>
</blockquote>



<a name="398800126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398800126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398800126">(Oct 27 2023 at 02:03)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398815954"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398815954" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398815954">(Oct 27 2023 at 04:08)</a>:</h4>
<p>lukewagner submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700967570">PR review</a>.</p>



<a name="398815955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398815955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398815955">(Oct 27 2023 at 04:08)</a>:</h4>
<p>lukewagner created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374050496">PR review comment</a>:</p>
<blockquote>
<p>I think in the case of header errors, the set of failure reasons is disjoint from all the other places that produce <code>error</code>s, which I think makes it worth having a separate variant just for header errors such as:</p>
<div class="codehilite" data-code-language="wit"><pre><span></span><code>variant header-error {
  invalid-syntax,
  forbidden
}
</code></pre></div>
<p>(I know we don't usually maximally-specialize error variants, but it seems like in cases where they're fully disjoint like this, it's worthwhile.)</p>
</blockquote>



<a name="398816234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398816234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398816234">(Oct 27 2023 at 04:10)</a>:</h4>
<p>lukewagner submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700969068">PR review</a>.</p>



<a name="398816236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398816236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398816236">(Oct 27 2023 at 04:10)</a>:</h4>
<p>lukewagner created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374051526">PR review comment</a>:</p>
<blockquote>
<p>If we reject invalid headers eagerly, then I think there shouldn't be any error possible here.  In particular, the <code>set</code> operation shouldn't be describing the actual sending of the response over the network (that kind of error would be reflecting in the streaming operations for writing to and finishing the response body); this operation should be the equivalent of <code>*outparam = result;</code>.  Or am I missing something else that can happen here?</p>
</blockquote>



<a name="398817490"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398817490" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398817490">(Oct 27 2023 at 04:23)</a>:</h4>
<p>lukewagner submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1700976876">PR review</a>.</p>



<a name="398817491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398817491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398817491">(Oct 27 2023 at 04:23)</a>:</h4>
<p>lukewagner created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374057025">PR review comment</a>:</p>
<blockquote>
<p>Note also that if we expand the WASI HTTP spec to distinguish "definitely-forbidden" headers (listed by the WASI HTTP spec) and "host-forbidden" headers (that's purely up to the current running host), we'd probably split <code>forbidden</code> into two cases to reflect the difference.</p>
</blockquote>



<a name="398925504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398925504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398925504">(Oct 27 2023 at 15:57)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1702104454">PR review</a>.</p>



<a name="398925506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398925506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398925506">(Oct 27 2023 at 15:57)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374772237">PR review comment</a>:</p>
<blockquote>
<p>I like that specific error type more than extending the more general <code>error</code> variant, thanks! I'm not sure about differentiating between definitely forbidden and host forbidden though: what would a guest do differently if it knew the difference between definitely forbidden and host forbidden?</p>
</blockquote>



<a name="398939922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398939922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398939922">(Oct 27 2023 at 17:21)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398940075"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398940075" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398940075">(Oct 27 2023 at 17:22)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1702242242">PR review</a>.</p>



<a name="398940076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398940076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398940076">(Oct 27 2023 at 17:22)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374859449">PR review comment</a>:</p>
<blockquote>
<p>Good point. Switching to having forbidden headers rejected at <code>fields.set</code> and <code>fields.append</code> removes the need to allow validation here.</p>
</blockquote>



<a name="398940482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398940482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398940482">(Oct 27 2023 at 17:25)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398940823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398940823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398940823">(Oct 27 2023 at 17:28)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>:</p>
<blockquote>
<p>This PR makes the <code>fields.set</code> and <code>fields.append</code> methods fallible, and introduces a new error type for describing the ways in which those operations can fail. Additionally it adds a notion of forbidden headers, which will always include the following:</p>
<ul>
<li>Connection</li>
<li>Keep-Alive</li>
<li>Proxy-Authenticate</li>
<li>Proxy-Authorization</li>
<li>Proxy-Connection</li>
<li>TE</li>
<li>Transfer-Encoding</li>
<li>Upgrade</li>
<li>HTTP2-Settings</li>
</ul>
<p>There's an embedder-defined hook for adding additional header name validation, but that underlying set of headers can't be altered.</p>
<p>Fixes #7270</p>
</blockquote>



<a name="398940908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398940908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398940908">(Oct 27 2023 at 17:29)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398941372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398941372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398941372">(Oct 27 2023 at 17:32)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398941890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398941890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398941890">(Oct 27 2023 at 17:36)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398942621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398942621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398942621">(Oct 27 2023 at 17:41)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398945618"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398945618" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398945618">(Oct 27 2023 at 18:01)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398950644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398950644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398950644">(Oct 27 2023 at 18:39)</a>:</h4>
<p>lukewagner created <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#discussion_r1374929541">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    unexpected-error(string)
</code></pre></div><br>
</p>
</blockquote>



<a name="398950645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398950645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398950645">(Oct 27 2023 at 18:39)</a>:</h4>
<p>lukewagner submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1702351680">PR review</a>.</p>



<a name="398951046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398951046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398951046">(Oct 27 2023 at 18:42)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="398952224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/398952224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#398952224">(Oct 27 2023 at 18:51)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="399349204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/399349204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#399349204">(Oct 30 2023 at 17:39)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7383#pullrequestreview-1704740302">PR review</a>:</p>
<blockquote>
<p>Looks great overall - rather than trap in the fields constructor, lets make the constructor create an empty set of fields, and have a static function that takes the list&lt;tuple&lt;...&gt;&gt; repr and returns result&lt;fields, header-error&gt;</p>
</blockquote>



<a name="399353289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/399353289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#399353289">(Oct 30 2023 at 18:07)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="399353510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/399353510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#399353510">(Oct 30 2023 at 18:08)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="399360206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/399360206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#399360206">(Oct 30 2023 at 18:56)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<a name="399379576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237383%20wasi-http%3A%20Fallible%20fields%20set%20and%20ap.../near/399379576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237383.20wasi-http.3A.20Fallible.20fields.20set.20and.20ap.2E.2E.2E.html#399379576">(Oct 30 2023 at 21:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7383">PR #7383</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>