<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9781 Winch: Implement rem for aarch64 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html">wasmtime / PR #9781 Winch: Implement rem for aarch64</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="487356788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487356788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487356788">(Dec 10 2024 at 23:17)</a>:</h4>
<p>MarinPostma opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a> from <code>MarinPostma:winch-aarch64-rem</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<ul>
<li><strong>pulley: Remove hardcoded instruction sizes in interpreter (#9769)</strong></li>
<li><strong>Update <code>arbitrary</code> to 1.4.1 (#9550)</strong></li>
<li><strong>Update ADOPTERS.md (#9773)</strong></li>
<li><strong> Add a guide for adding instructions to Pulley  (#9765)</strong></li>
<li><strong>pulley: Implement more of loads/stores (#9775)</strong></li>
<li><strong>implement copy/clone for RemKind</strong></li>
<li><strong>implement remainder operation for aarch64</strong></li>
<li><strong>add tests</strong></li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="487356814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487356814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487356814">(Dec 10 2024 at 23:17)</a>:</h4>
<p>MarinPostma updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="487357393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357393">(Dec 10 2024 at 23:23)</a>:</h4>
<p>MarinPostma submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2493914497">PR review</a>.</p>



<a name="487357394"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357394" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357394">(Dec 10 2024 at 23:23)</a>:</h4>
<p>MarinPostma created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1879061829">PR review comment</a>:</p>
<blockquote>
<p>@saulecabrera I'm not sure about that, but if we are performing an unsigned remainder operation, then do we really care about sign extending? Maybe it's not necessary for division either? Is there a scenario where we can't just blindly consider the <code>w</code> register as a <code>x</code> register?</p>
</blockquote>



<a name="487357648"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357648" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357648">(Dec 10 2024 at 23:25)</a>:</h4>
<p>MarinPostma edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>:</p>
<blockquote>
<p>Implement remainder operation for <code>aarch64</code> in winch.</p>
<p>one more step in the #8321 series<br>
</p>
</blockquote>



<a name="487357656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357656">(Dec 10 2024 at 23:26)</a>:</h4>
<p><strong>MarinPostma</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a> as ready for review.</p>



<a name="487357658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357658">(Dec 10 2024 at 23:26)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="487357659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357659">(Dec 10 2024 at 23:26)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="487357661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357661">(Dec 10 2024 at 23:26)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="487357666"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357666" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357666">(Dec 10 2024 at 23:26)</a>:</h4>
<p><strong>MarinPostma</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="487357796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357796">(Dec 10 2024 at 23:27)</a>:</h4>
<p>MarinPostma submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2493920142">PR review</a>.</p>



<a name="487357797"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487357797" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487357797">(Dec 10 2024 at 23:27)</a>:</h4>
<p>MarinPostma created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1879066130">PR review comment</a>:</p>
<blockquote>
<p>The same reasonning applies to div, I think. We could shave a few instructions in the case of unsigned division too.</p>
</blockquote>



<a name="487679960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/487679960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#487679960">(Dec 11 2024 at 00:58)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="488000589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488000589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488000589">(Dec 11 2024 at 02:15)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#issuecomment-2533467390">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="488136032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488136032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488136032">(Dec 11 2024 at 16:16)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2496042277">PR review</a>:</p>
<blockquote>
<p>Looking good. Left some comments inline.</p>
<p>As a general comment, given that the same invariant as division apply here, could we modify the existing <code>div_rrr</code> so that it can be re-used from <code>rem_rrr</code>?</p>
</blockquote>



<a name="488136033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488136033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488136033">(Dec 11 2024 at 16:16)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880493966">PR review comment</a>:</p>
<blockquote>
<p>Also, the same invariants as signed division apply here, right? i.e., we must still check for overflow.</p>
</blockquote>



<a name="488136034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488136034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488136034">(Dec 11 2024 at 16:16)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880429224">PR review comment</a>:</p>
<blockquote>
<p>After <a href="https://github.com/bytecodealliance/wasmtime/pull/9762">https://github.com/bytecodealliance/wasmtime/pull/9762</a> was merged, I noticed that we were unconditionally emitting a sign-extension here. Instead we need to request the proper extension depending on the division kind. I opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9784">https://github.com/bytecodealliance/wasmtime/pull/9784</a> to fix this. We should apply the same fix here. </p>
</blockquote>



<a name="488136035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488136035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488136035">(Dec 11 2024 at 16:16)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880429968">PR review comment</a>:</p>
<blockquote>
<p>Can we use <code>self.trapz</code> here?</p>
</blockquote>



<a name="488136036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488136036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488136036">(Dec 11 2024 at 16:16)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880419634">PR review comment</a>:</p>
<blockquote>
<p>In practice, nothing is stopping us from passing a <code>w</code> register here, however given that we're dealing with the 64-bit instruction variant, it will take into account the full 64-bits not just the lower 32. In case that the high 32 bits are not zeroed out, this could lead to unexpected behavior. So we need to extend in both cases. </p>
</blockquote>



<a name="488140252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488140252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488140252">(Dec 11 2024 at 16:37)</a>:</h4>
<p>MarinPostma submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2496229227">PR review</a>.</p>



<a name="488140254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488140254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488140254">(Dec 11 2024 at 16:37)</a>:</h4>
<p>MarinPostma created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880531987">PR review comment</a>:</p>
<blockquote>
<p>Actually I was expecting it to be the case, but as it turn out, it doesn't seem necessary; the following snippet</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code> <span class="p">(</span><span class="k">module</span>
     <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
          <span class="nb">local.get</span> <span class="mi">0</span>
           <span class="nb">local.get</span> <span class="mi">1</span>
           <span class="nb">i32.rem_u</span>
     <span class="p">)</span>
 <span class="p">)</span>
</code></pre></div>
<p>is compiled by cranelift to:</p>
<div class="codehilite" data-code-language="armasm"><pre><span></span><code>0000000000000000 &lt;wasm[0]::function[0]&gt;:
       0: d503235f      pacibz
       4: a9bf7bfd      stp     x29, x30, [sp, #-16]!
       8: 910003fd      mov     x29, sp
       c: 2a0403e3      mov     w3, w4
      10: 2a0503e5      mov     w5, w5
      14: b40000c5      cbz     x5, 0x2c &lt;wasm[0]::function[0]+0x2c&gt;
      18: 9ac50868      udiv    x8, x3, x5
      1c: 9b058d02      msub    x2, x8, x5, x3
      20: a8c17bfd      ldp     x29, x30, [sp], #16
      24: d50323df      autibz
      28: d65f03c0      ret
      2c: 0000c11f      udf     #49439
</code></pre></div>
<p>(with <code>rem_s</code>:</p>
<div class="codehilite" data-code-language="armasm"><pre><span></span><code>       0: d503235f      pacibz
       4: a9bf7bfd      stp     x29, x30, [sp, #-16]!
       8: 910003fd      mov     x29, sp
       c: 52b00004      mov     w4, #-2147483648
      10: 93407c81      sxtw    x1, w4
      14: 92800003      mov     x3, #-1
      18: 9ac30c25      sdiv    x5, x1, x3
      1c: 9b0384a2      msub    x2, x5, x3, x1
      20: a8c17bfd      ldp     x29, x30, [sp], #16
      24: d50323df      autibz
      28: d65f03c0      ret
</code></pre></div>
<p>)</p>
<p>At first I thought this was a bug, but it seems to be consistent across platform:</p>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="k">module</span>
    <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">export</span> <span class="s2">"_start"</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mf">0x80000000)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="nb">i32.rem_s</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<p>this yields <code>0</code> on both aarch64 and x86.<br>
</p>
</blockquote>



<a name="488141793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488141793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488141793">(Dec 11 2024 at 16:44)</a>:</h4>
<p>MarinPostma <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#issuecomment-2536521831">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>:</p>
<blockquote>
<p>I was my initial intention to factorize the check, but as it turns out, we don't need to check for overflow  for <code>rem</code>. I'm working on supporting i32 division, so we can drop the  extension in a subsequent PR too.</p>
</blockquote>



<a name="488146837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488146837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488146837">(Dec 11 2024 at 17:08)</a>:</h4>
<p>MarinPostma updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="488148576"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488148576" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488148576">(Dec 11 2024 at 17:18)</a>:</h4>
<p>MarinPostma updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<a name="488148787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488148787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488148787">(Dec 11 2024 at 17:20)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2496341574">PR review</a>.</p>



<a name="488148788"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488148788" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488148788">(Dec 11 2024 at 17:20)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#discussion_r1880603456">PR review comment</a>:</p>
<blockquote>
<p>Ah right, going over the Wasm spec, there's no explicit mention of overflow checks in this case. </p>
</blockquote>



<a name="488164212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488164212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488164212">(Dec 11 2024 at 18:48)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9781#pullrequestreview-2496559683">PR review</a>.</p>



<a name="488167343"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239781%20Winch%3A%20Implement%20rem%20for%20aarch64/near/488167343" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239781.20Winch.3A.20Implement.20rem.20for.20aarch64.html#488167343">(Dec 11 2024 at 19:05)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9781">PR #9781</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>