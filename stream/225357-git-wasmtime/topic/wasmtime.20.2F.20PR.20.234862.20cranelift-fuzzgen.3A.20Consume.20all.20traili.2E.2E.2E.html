<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4862 cranelift-fuzzgen: Consume all traili... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html">wasmtime / PR #4862 cranelift-fuzzgen: Consume all traili...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="296930967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/296930967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#296930967">(Sep 03 2022 at 01:48)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4862">PR #4862</a>.</p>



<a name="296930968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/296930968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#296930968">(Sep 03 2022 at 01:48)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4862">PR #4862</a> from <code>test-inputs-length</code> to <code>main</code>:</p>
<blockquote>
<p>But don't keep going once we've consumed it all.</p>
<p>I got tired of having a bunch of copies of the same all-zeros test inputs at the end. This version always produces exactly one all-zeros test input at the end, which I feel okay about. I could remove that by explicitly checking for <code>self.u.is_empty()</code> but, eh, testing an all-zeros input could be useful.</p>
<p>This uses less of the fuzz input too since it doesn't need to come up with a count of how many test inputs to generate.</p>
<p>This changes the input format for this fuzz target, so I figure I'll bundle it together with #4824 and merge both sometime next week.</p>
<p>cc: @afonso360 </p>
</blockquote>



<a name="297184767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297184767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297184767">(Sep 05 2022 at 08:26)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1096062351">PR review</a>.</p>



<a name="297460002"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297460002" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297460002">(Sep 06 2022 at 18:10)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1098045371">PR review</a>.</p>



<a name="297460003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297460003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297460003">(Sep 06 2022 at 18:10)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1098045371">PR review</a>.</p>



<a name="297460004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297460004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297460004">(Sep 06 2022 at 18:10)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#discussion_r964025109">PR review comment</a>:</p>
<blockquote>
<p>Might be simpler as</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">inputs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="fm">todo!</span><span class="p">(</span><span class="s">"generate one input"</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>which avoids the semi-subtle use of <code>usize::MAX</code> here.</p>
</blockquote>



<a name="297469437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297469437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297469437">(Sep 06 2022 at 19:08)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#discussion_r964077786">PR review comment</a>:</p>
<blockquote>
<p>That's how I wrote it first, actually! I could go back to <code>loop</code> plus a conditional <code>break</code> at the end if you want. But just testing <code>u.is_empty</code> doesn't work if generating an input doesn't consume any of <code>u</code>: it loops forever then. The usual way that would happen is if the generated function doesn't take any parameters, but I haven't ruled out the possibility that a parameter could only have one legal value and therefore consume no input. So instead I check that the loop makes some progress on every iteration, and stop after the first iteration where it doesn't make progress.</p>
<p>I agree that using <code>usize::MAX</code> here is subtle. We'd get nearly the same result from initializing <code>last_len</code> to <code>self.u.len() + 1</code>, if that would make you feel better?</p>
</blockquote>



<a name="297469439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297469439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297469439">(Sep 06 2022 at 19:08)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1098118774">PR review</a>.</p>



<a name="297502006"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297502006" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297502006">(Sep 06 2022 at 23:20)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1098351497">PR review</a>.</p>



<a name="297502007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297502007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297502007">(Sep 06 2022 at 23:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#discussion_r964250512">PR review comment</a>:</p>
<blockquote>
<p>I guess we could also have a maximum length on <code>inputs</code> as well.</p>
<p>Otherwise I guess I would prefer making <code>last_len</code> an option and doing something like</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="n">last_len</span><span class="p">.</span><span class="n">map_or</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">last_len</span><span class="o">|</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">last_len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="297504055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297504055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297504055">(Sep 06 2022 at 23:44)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#pullrequestreview-1098364711">PR review</a>.</p>



<a name="297504056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297504056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297504056">(Sep 06 2022 at 23:44)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4862#discussion_r964260659">PR review comment</a>:</p>
<blockquote>
<p>I'm definitely not a fan of that alternative <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> but I can still move the test to the end of the loop, if that works for you.</p>
</blockquote>



<a name="297511555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297511555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297511555">(Sep 07 2022 at 01:37)</a>:</h4>
<p>jameysharp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4862">PR #4862</a> from <code>test-inputs-length</code> to <code>main</code>.</p>



<a name="297617532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234862%20cranelift-fuzzgen%3A%20Consume%20all%20traili.../near/297617532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234862.20cranelift-fuzzgen.3A.20Consume.20all.20traili.2E.2E.2E.html#297617532">(Sep 07 2022 at 15:46)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4862">PR #4862</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>