<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3693 Initial forward-edge CFI implementation · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html">wasmtime / PR #3693 Initial forward-edge CFI implementation</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281154437"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/281154437" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#281154437">(May 04 2022 at 13:25)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>:</p>
<blockquote>
<p>This pull request is meant to illustrate the RFC proposal to improve control flow integrity for compiled WebAssembly code by using the Branch Target Identification extension to the Arm instruction set architecture (<a href="https://github.com/bytecodealliance/rfcs/issues/17">bytecodealliance/rfcs#17</a>), so it is not ready to be merged yet.</p>
</blockquote>



<a name="281154690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/281154690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#281154690">(May 04 2022 at 13:27)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>:</p>
<blockquote>
<p>This pull request is meant to illustrate the RFC proposal to improve control flow integrity for compiled WebAssembly code by using the Branch Target Identification extension to the Arm instruction set architecture (<a href="https://github.com/bytecodealliance/rfcs/issues/17">bytecodealliance/rfcs#17</a>), so it is not ready to be merged yet.</p>
<p><strong>P.S.</strong> The RFC proposal has now been merged, and the changes in this PR have been updated the reflect the final version of the proposal, so they are now ready.</p>
</blockquote>



<a name="281190622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/281190622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#281190622">(May 04 2022 at 17:30)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>:</p>
<blockquote>
<p>This pull request is meant to illustrate the RFC proposal to improve control flow integrity for compiled WebAssembly code by using the Branch Target Identification (BTI) extension to the Arm instruction set architecture (<a href="https://github.com/bytecodealliance/rfcs/issues/17">bytecodealliance/rfcs#17</a>), so it is not ready to be merged yet.</p>
<p><strong>P.S.</strong> The RFC proposal has now been merged, and the changes in this PR have been updated the reflect the final version of the proposal, so they are now ready.</p>
</blockquote>



<a name="281811971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/281811971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#281811971">(May 10 2022 at 11:53)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="282264737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/282264737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#282264737">(May 13 2022 at 15:38)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="284012644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284012644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284012644">(May 26 2022 at 14:27)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="284041841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284041841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284041841">(May 26 2022 at 18:20)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="284152313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284152313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284152313">(May 27 2022 at 16:05)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-987707121">PR review</a>.</p>



<a name="284152314"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284152314" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284152314">(May 27 2022 at 16:05)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r883751123">PR review comment</a>:</p>
<blockquote>
<p>The bti feature being detected doesn't necessarily mean that the kernel supports it, right? Maybe you could try using <code>PROT_BTI</code> and if that fails try again without?</p>
</blockquote>



<a name="284152531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284152531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284152531">(May 27 2022 at 16:07)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-987708996">PR review</a>.</p>



<a name="284152532"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284152532" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284152532">(May 27 2022 at 16:07)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r883752488">PR review comment</a>:</p>
<blockquote>
<p>This is somewhat unfortunate code duplication.</p>
</blockquote>



<a name="284361317"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284361317" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284361317">(May 30 2022 at 12:32)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-989284518">PR review</a>.</p>



<a name="284361319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/284361319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#284361319">(May 30 2022 at 12:32)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r884782811">PR review comment</a>:</p>
<blockquote>
<p>No, that's exactly what it means. The reason is that the 64-bit Arm architecture does not provide any mechanism to unprivileged software, i.e. userspace, to detect the features supported by the processor while bypassing the kernel (or more privileged software); indeed, it does not provide such a mechanism at all (irrespective of the kernel involvement), leaving it to the software environment to define one.</p>
</blockquote>



<a name="287039710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287039710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287039710">(Jun 22 2022 at 11:32)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="287041281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287041281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287041281">(Jun 22 2022 at 11:47)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="287050786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287050786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287050786">(Jun 22 2022 at 13:08)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="287165385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287165385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287165385">(Jun 23 2022 at 09:39)</a>:</h4>
<p><strong>akirilov-arm</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a>.</p>



<a name="287165386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287165386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287165386">(Jun 23 2022 at 09:39)</a>:</h4>
<p><strong>akirilov-arm</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a>.</p>



<a name="287201403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201403">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1017139769">PR review</a>.</p>



<a name="287201404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201404">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r905110115">PR review comment</a>:</p>
<blockquote>
<p>Could this use <code>io::Error::last_os_error()</code> as well to forward along the original error message?</p>
</blockquote>



<a name="287201405"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201405" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201405">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r905113310">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps move to a method on <code>Engine</code>?</p>
</blockquote>



<a name="287201406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201406">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r905114259">PR review comment</a>:</p>
<blockquote>
<p>Instead of ferrying around this <code>bool</code> as a return value from this function could the <code>is_branch_protection_enabled</code> testing go as a method on <code>Engine</code>? Most contexts that are being given this <code>bool</code> already have the <code>Engine</code> so they should be able to query the engine itself for this </p>
</blockquote>



<a name="287201409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201409">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1017139769">PR review</a>.</p>



<a name="287201412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/287201412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#287201412">(Jun 23 2022 at 14:49)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r905111914">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps be unconditionally done? I would expect that the detection of the <code>bti</code> feature would happen at a higher level than this (e.g. at the Wasmtime <code>Config</code> layer) where <code>enable_branch_protection</code> is only <code>true</code> if the machine actually has <code>bti</code>.</p>
<p>Although I think it's ok to still have <code>cfg!(target_arch = "aarch64")</code> in the condition since this is still arm64-specific.</p>
</blockquote>



<a name="293704458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293704458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293704458">(Aug 16 2022 at 12:20)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="293721802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293721802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293721802">(Aug 16 2022 at 13:49)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074154048">PR review</a>.</p>



<a name="293721803"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293721803" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293721803">(Aug 16 2022 at 13:49)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946803576">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>Could this perhaps be unconditionally done? I would expect that the detection of the <code>bti</code> feature would happen at a higher level than this (e.g. at the Wasmtime <code>Config</code> layer) where <code>enable_branch_protection</code> is only <code>true</code> if the machine actually has <code>bti</code>.</p>
</blockquote>
<p>My other comment provides a bit of context, but I didn't touch the higher-level layers on purpose, so that we support as much flexibility as possible, e.g. compile ahead-of-time a module with BTI on a machine that does not support BTI, or load a module that has been compiled ahead-of-time without BTI, while the engine is set to use BTI. I think that we will need to be more careful if we are making these decisions at a higher level - for instance, distinguish between <code>wasmtime compile</code> and <code>wasmtime run</code>.</p>
</blockquote>



<a name="293721834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293721834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293721834">(Aug 16 2022 at 13:49)</a>:</h4>
<p><strong>akirilov-arm</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a>.</p>



<a name="293728835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728835">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074214447">PR review</a>.</p>



<a name="293728836"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728836" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728836">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074214447">PR review</a>.</p>



<a name="293728837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728837">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946848080">PR review comment</a>:</p>
<blockquote>
<p>Given that <code>isa_flags</code> always come from the <code>Engine</code> itself could this parameter be dropped and internally this uses <code>self.compiler().isa_flags()</code>?</p>
</blockquote>



<a name="293728838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728838">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946849918">PR review comment</a>:</p>
<blockquote>
<p>Could this be dropped here since it can be inferred from the <code>&amp;Engine</code> argument?</p>
</blockquote>



<a name="293728839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728839">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946845040">PR review comment</a>:</p>
<blockquote>
<p>Could this perhaps still fall through to <code>rustix</code> below but use <code>MprotectFlags::from_u32</code> until there's a constant for <code>PROT_BTI</code>?</p>
</blockquote>



<a name="293728840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728840">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946850281">PR review comment</a>:</p>
<blockquote>
<p>Since this an be inferred from <code>&amp;Engine</code>-the-argument could this return value be dropped?</p>
</blockquote>



<a name="293728852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293728852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293728852">(Aug 16 2022 at 14:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r946849272">PR review comment</a>:</p>
<blockquote>
<p>Also if it's a perf concern it might be prudent to add <code>engine.compiler().is_branch_protection_enabled(..)</code> since <code>isa_flags()</code> returns a whole new <code>BTreeMap</code> each time it's called I think. Or otherwise watch it get enabled on <code>Config</code> and ferry through that <code>bool</code> to here or similar.</p>
</blockquote>



<a name="293730395"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293730395" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293730395">(Aug 16 2022 at 14:36)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="293783375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293783375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293783375">(Aug 16 2022 at 19:14)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074657648">PR review</a>.</p>



<a name="293783376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293783376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293783376">(Aug 16 2022 at 19:14)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r947166695">PR review comment</a>:</p>
<blockquote>
<p>There is one case in which the flags come from a previously compiled module - <a href="https://github.com/bytecodealliance/wasmtime/pull/3693/files#diff-f2a833f03cb2f0dfcd4dfda02740e498dea0ce15fc9749d67c711999c22ea5cfR230">line 230</a> in <code>crates/wasmtime/src/module/serialization.rs</code>. However, I can create a wrapper function, say <code>is_branch_protection_enabled_globally()</code>, that simply calls this one with a fixed parameter, <code>&amp;engine.compiler().isa_flags()</code>, and change most call sites to invoke it instead.</p>
</blockquote>



<a name="293783833"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293783833" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293783833">(Aug 16 2022 at 19:17)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r947168762">PR review comment</a>:</p>
<blockquote>
<p>See my comment about line 540 in <code>crates/wasmtime/src/engine.rs</code>.</p>
</blockquote>



<a name="293783834"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293783834" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293783834">(Aug 16 2022 at 19:17)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074660618">PR review</a>.</p>



<a name="293785939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293785939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293785939">(Aug 16 2022 at 19:31)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r947179233">PR review comment</a>:</p>
<blockquote>
<p>This is a bit tricky, but the reason is the cache implementation on line 291, and in particular the call to <code>SerializedModule::into_parts()</code> on line 314, which, given the declaration of <code>ModuleCacheEntry::get_data_raw()</code>, enforces a particular function signature for <code>Module::build_artifacts()</code>. I tried changing the closure on line 311, so that it didn't return whatever <code>SerializedModule::into_parts()</code>'s return value was directly by defining a mutable flag <code>enable_branch_protection</code> inside <code>Module::from_binary()</code>, but then the Rust compiler complained that it could not accept a closure that captured variables in that location.</p>
</blockquote>



<a name="293785942"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/293785942" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#293785942">(Aug 16 2022 at 19:31)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1074675416">PR review</a>.</p>



<a name="294248111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294248111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294248111">(Aug 19 2022 at 11:48)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="294251125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294251125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294251125">(Aug 19 2022 at 12:06)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="294253891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294253891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294253891">(Aug 19 2022 at 12:24)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1078739222">PR review</a>.</p>



<a name="294253892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294253892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294253892">(Aug 19 2022 at 12:24)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r950134498">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton I am not too happy about this part, but I tried separating the parsing of the ELF image and the changing of the memory protection done by <code>CodeMemory::publish()</code> and I ran into various borrow checker and lifetime issues that seemed beyond my Rust skills, so I went ahead with this suboptimal, but nevertheless correct solution.</p>
</blockquote>



<a name="294349600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294349600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294349600">(Aug 19 2022 at 19:30)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1079279720">PR review</a>.</p>



<a name="294349601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294349601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294349601">(Aug 19 2022 at 19:30)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r950505911">PR review comment</a>:</p>
<blockquote>
<p>Oh dear, I'll work on improving this with some refactorings but otherwise this PR looks good to me, thanks for the updates!</p>
</blockquote>



<a name="294349626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294349626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294349626">(Aug 19 2022 at 19:30)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r950505911">PR review comment</a>.</p>



<a name="294351539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294351539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294351539">(Aug 19 2022 at 19:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r950513797">PR review comment</a>:</p>
<blockquote>
<p>Ah I ended up with <a href="https://github.com/akirilov-arm/wasmtime/pull/1">https://github.com/akirilov-arm/wasmtime/pull/1</a> which was easier than I thought</p>
</blockquote>



<a name="294351540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294351540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294351540">(Aug 19 2022 at 19:44)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1079291040">PR review</a>.</p>



<a name="294656701"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294656701" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294656701">(Aug 22 2022 at 11:38)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="294658923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294658923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294658923">(Aug 22 2022 at 11:53)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1080336435">PR review</a>.</p>



<a name="294658924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294658924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294658924">(Aug 22 2022 at 11:53)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r951346034">PR review comment</a>:</p>
<blockquote>
<p>Yeah, parsing the ELF header twice definitely helps.</p>
</blockquote>



<a name="294660338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294660338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294660338">(Aug 22 2022 at 12:01)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="294660584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294660584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294660584">(Aug 22 2022 at 12:02)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="294661127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294661127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294661127">(Aug 22 2022 at 12:05)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r951346034">PR review comment</a>.</p>



<a name="294766816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294766816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294766816">(Aug 22 2022 at 21:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1081133823">PR review</a>.</p>



<a name="294766817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294766817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294766817">(Aug 22 2022 at 21:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r951911208">PR review comment</a>:</p>
<blockquote>
<p>Rather than take a single <code>bool</code> here, can we take an options struct? It may seem overkill for one flag but <code>enable_branch_protection</code> would not be my first guess for the meaning of a bare <code>false</code> hanging out in a <code>Memory::new</code> call :-)</p>
</blockquote>



<a name="294766818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294766818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294766818">(Aug 22 2022 at 21:05)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1081133823">PR review</a>.</p>



<a name="294766819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294766819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294766819">(Aug 22 2022 at 21:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r951908944">PR review comment</a>:</p>
<blockquote>
<p>This logic feels a little bit brittle to me. If I understand correctly, it is determining what the "real" CLIF-level block for this target is meant to be, even if we have inserted an edge block, so that we can tell if any indirect branch might reach it; is that right?</p>
<p>If so, I think what we really should have is a set of <em>lowered</em> block indices reachable via an indirect branch, computed by the lowering-order code. We can compute this when we traverse the lowered-block's successors if we know that we're visiting out-edges of an indirect branch, I think.</p>
</blockquote>



<a name="294766820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/294766820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#294766820">(Aug 22 2022 at 21:05)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r951902680">PR review comment</a>:</p>
<blockquote>
<p>Can we add a comment here noting what the <code>bool</code> arg to the closure is for?</p>
</blockquote>



<a name="297550377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297550377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297550377">(Sep 07 2022 at 09:17)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="297551451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297551451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297551451">(Sep 07 2022 at 09:25)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1098837644">PR review</a>.</p>



<a name="297551452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297551452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297551452">(Sep 07 2022 at 09:25)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#discussion_r964606281">PR review comment</a>:</p>
<blockquote>
<p>I decided to define a new <code>enum</code> and pass it instead. I noticed that Windows defined some memory protection flags that were related to Control Flow Guard, its own CFI implementation, and this approach seems like a good way to leave the possibility of adding support for them in the future (if we decide to do so), while keeping the current implementation simple.</p>
</blockquote>



<a name="297557018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297557018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297557018">(Sep 07 2022 at 10:01)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a> from <code>bti</code> to <code>main</code>.</p>



<a name="297691707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297691707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297691707">(Sep 08 2022 at 00:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1099949347">PR review</a>.</p>



<a name="297795241"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297795241" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297795241">(Sep 08 2022 at 14:36)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#pullrequestreview-1100867977">PR review</a>.</p>



<a name="297795286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233693%20Initial%20forward-edge%20CFI%20implementation/near/297795286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233693.20Initial.20forward-edge.20CFI.20implementation.html#297795286">(Sep 08 2022 at 14:36)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">PR #3693</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>