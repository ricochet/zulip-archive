<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3715 Support shebang for command-line w... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html">wasmtime / issue #3715 Support shebang for command-line w...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="268994419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/268994419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#268994419">(Jan 23 2022 at 03:35)</a>:</h4>
<p>JoeStrout opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Make wasmtime hip to a shebang at the first line of the file, e.g.:</p>
<p><code>#!/usr/local/bin/wasmtime</code></p>
<p>followed by the text-format wasm code as usual.  Currently, the shell runs wasmtime and feeds it the script as expected, but wasmtime chokes on the first line and fails to run the following script.</p>
<h4>Benefit</h4>
<p>This would allow us to write scripts that can be executed by simply setting the executable bit and invoking them, like any other shell script.  It's a matter of convenience.  I have a lot of scripts in a lot of different languages; I don't have to remember what tool to use to run them because they all understand shebang — except for wasmtime.</p>
<h4>Implementation</h4>
<p>Just special-case it: if the first line of the script file starts with "#!", then ignore it and continue with the rest of the file.</p>
<h4>Alternatives</h4>
<p>I could write, for every wasm script I want to run, a little 2-line shell script that runs wasmtime with the path to the actual script.  That would be annoying on so many levels.</p>
</blockquote>



<a name="269121139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269121139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269121139">(Jan 24 2022 at 15:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020216100">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Personally I don't feel that Wasmtime should support wasmtime-specific extensions to the text format. If this wants to be supported then I think that this should be added to the official grammar of text files in the wasm specification itself. </p>
</blockquote>



<a name="269127939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269127939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269127939">(Jan 24 2022 at 16:08)</a>:</h4>
<p>JoeStrout <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020263631">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I would argue that this is wasmtime's responsibility, as a command-line executable whose function is to run .wat files on the command line.  This is something all other script runners (perl, python, miniscript, etc. etc.) do, and the shebang is not part of the grammar of those languages either; it's just something the script runners are prepared to deal with.</p>
<p>Conversely, a shebang doesn't make any sense in other contexts, e.g. in a .wat file that's part of a Visual Studio project.  So I wouldn't expect to see it in the .wat spec itself.  It _only_ makes sense for people who (like me) are trying to use wasmtime like other command-line scripts, so it ought to just be something that wasmtime does.</p>
</blockquote>



<a name="269129943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269129943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269129943">(Jan 24 2022 at 16:20)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020278113">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Shebang's are definitively part of the grammar of a language if an interpreter for it can handle them.</p>
</blockquote>



<a name="269200702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269200702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269200702">(Jan 25 2022 at 02:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020744489">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>@JoeStrout FWIW I think the main issue with support in <em>wasmtime</em> for this would be that it could potentially normalize "not quite compliant" <code>.wat</code> files -- in other words, it encourages the existence of non-standards-compliant source that fails to parse in other tools/engines.</p>
<p>But since this is Unix, there are probably ways to put together other tools to make a solution... one technique that might help is to write the wat content as a heredoc, something like the following (just tested):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/bin/sh</span><span class="w"></span>

<span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">stdin</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">__END__</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"proc_exit"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"memory"</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"_start"</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">call</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="n">__END__</span><span class="w"></span>
</code></pre></div>
<p>One could conceivably write a tool that converts <code>.wat</code> to <code>.wat.sh</code> by wrapping it like this.</p>
<p>One could probably also use the "custom binfmt" support in Linux to recognize the magic number in a <code>.wasm</code> and invoke <code>wasmtime</code> as an interpreter; then a WASI .wasm would behave just like a native executable. (IIRC, distributions of qemu often set this up for ELF binaries of other architectures; that might be a place to start looking.)</p>
<p>Anyway, just some ideas -- hope these help!</p>
</blockquote>



<a name="269201867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269201867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269201867">(Jan 25 2022 at 02:39)</a>:</h4>
<p>iximeow <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020751899">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>(a little bit of pedantry, sorry: bash and python and friends do _not_ have any particular support for <code>#!</code>, that's handled in <a href="https://github.com/torvalds/linux/blob/886d7de631da71e30909980fdbf318f7caade262/fs/binfmt_script.c#L34-L43">the kernel</a> as part of <code>exec</code>. by happy ~coincidence~ design, those languages treat <code>#</code> as a comment and then ignore the shebang line when executed. thus wasmtime executing a shebang'd file would first require _ignoring a preceding <code>#!.*\n</code>_, then executing the provided <code>.wat</code> text. that's where the non-standards-compliance comes in, since .wat comments are <code>;;</code> rather than <code>#</code>.)</p>
</blockquote>



<a name="269248764"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/269248764" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#269248764">(Jan 25 2022 at 12:25)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1021134572">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Yeah, I don't think wasmtime should start accepting non-standard extensions to the file format. One way to do this if we somehow absolutely wanted to is to get the standard changed to support shebangs. That's what's <a href="https://github.com/tc39/proposal-hashbang">happening in JavaScript</a>.</p>
<p>I'm not sure that it makes sense to do this though: the <code>wat</code> format really isn't meant to be used as a production format, and I don't think we'd be well served with making it easier to run <code>wat</code> files than <code>wasm</code> files. And the binfmt support Chris mentions <a href="https://aur.archlinux.org/packages/binfmt-wasm/">already exists</a>.</p>
</blockquote>



<a name="272517921"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/272517921" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#272517921">(Feb 19 2022 at 13:17)</a>:</h4>
<p>JoeStrout <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1046016282">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I'm surprised by the negative reactions.  All I'm asking for is to skip the first line of the input if it starts with <code>#</code>, rather than fail.  If <code>#</code> had some _other_ valid usage here, we would have a problem as it might be difficult to disambiguate the user's intent.  But we don't.  I think you can confidently say that the user does not intend the result to be a screenful of error messages.</p>
<p>It's not a big ask, and it's a substantial quality-of-life improvement, at least for some of us.</p>
</blockquote>



<a name="272521403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/272521403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#272521403">(Feb 19 2022 at 14:26)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1046028851">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>The "big" part of the ask is to support a non-standard extension to a standardized format, that'd then mean that that format only runs in our runtime, but not others. The right way to go about adding something like this is to propose it in the <a href="https://www.w3.org/community/webassembly/">WebAssembly Community Group</a>.</p>
<p>As I said in my previous comment I also think that this isn't the right thing to do to begin with, but a sufficient number of people in the Community Group might disagree for it to be standardized, in which case we'd implement it.</p>
</blockquote>



<a name="283086571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/283086571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#283086571">(May 20 2022 at 15:32)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1133042173">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I'm going to close this form the discussion above. I think it's still reasonable to propose this extension to the wasm CG and the text format if you're interested though.</p>
</blockquote>



<a name="283086574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/283086574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#283086574">(May 20 2022 at 15:32)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Make wasmtime hip to a shebang at the first line of the file, e.g.:</p>
<p><code>#!/usr/local/bin/wasmtime</code></p>
<p>followed by the text-format wasm code as usual.  Currently, the shell runs wasmtime and feeds it the script as expected, but wasmtime chokes on the first line and fails to run the following script.</p>
<h4>Benefit</h4>
<p>This would allow us to write scripts that can be executed by simply setting the executable bit and invoking them, like any other shell script.  It's a matter of convenience.  I have a lot of scripts in a lot of different languages; I don't have to remember what tool to use to run them because they all understand shebang — except for wasmtime.</p>
<h4>Implementation</h4>
<p>Just special-case it: if the first line of the script file starts with "#!", then ignore it and continue with the rest of the file.</p>
<h4>Alternatives</h4>
<p>I could write, for every wasm script I want to run, a little 2-line shell script that runs wasmtime with the path to the actual script.  That would be annoying on so many levels.</p>
</blockquote>



<a name="322672507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322672507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322672507">(Jan 21 2023 at 06:35)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399192360">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Just encountered this limitation trying to run WebAssembly as a Native Messaging host. To me it seems <code>wasmtime</code> _should_ be able to run using <code>#!/usr/bin/env -S</code> which works for Python, Node.js, Deno, QuickJS,  et al. though throws for <code>wasmtime</code> </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env wasmtime</span><span class="w"></span>
<span class="p">(</span><span class="n">module</span><span class="w"></span>
<span class="w">    </span><span class="p">;;</span><span class="w"> </span><span class="n">Import</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">fd_write</span><span class="w"> </span><span class="n">WASI</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stdout</span><span class="w"></span>
<span class="w">    </span><span class="p">;;</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">fd_write</span><span class="w"> </span><span class="n">is</span>:
    <span class="p">;;</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">Descriptor</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">iovs</span><span class="p">,</span><span class="w"> </span><span class="n">iovs_len</span><span class="p">,</span><span class="w"> </span><span class="n">nwritten</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Returns</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">written</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_unstable"</span><span class="w"> </span><span class="s">"fd_write"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$fd_write</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"memory"</span><span class="w"> </span><span class="p">(</span><span class="n">memory</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">;;</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="w"> </span><span class="n">world</span><span class="err">\</span><span class="n">n</span><span class="o">'</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"></span>
<span class="w">    </span><span class="p">;;</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trailing</span><span class="w"> </span><span class="n">newline</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">appear</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="cp">$main</span><span class="w"> </span><span class="p">(</span><span class="n">export</span><span class="w"> </span><span class="s">"_start"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">;;</span><span class="w"> </span><span class="n">Creating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="n">memory</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="n">store</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">8</span><span class="p">))</span><span class="w">  </span><span class="p">;;</span><span class="w"> </span><span class="n">iov</span><span class="p">.</span><span class="n">iov_base</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="w"> </span><span class="n">world</span><span class="err">\</span><span class="n">n</span><span class="o">'</span><span class="w"> </span><span class="n">string</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="n">store</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">12</span><span class="p">))</span><span class="w">  </span><span class="p">;;</span><span class="w"> </span><span class="n">iov</span><span class="p">.</span><span class="n">iov_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="w"> </span><span class="n">world</span><span class="err">\</span><span class="n">n</span><span class="o">'</span><span class="w"> </span><span class="n">string</span><span class="w"></span>

<span class="w">        </span><span class="p">(</span><span class="n">call</span><span class="w"> </span><span class="cp">$fd_write</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="n">file_descriptor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">stdout</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="o">*</span><span class="n">iovs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">iov</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="n">iovs_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">We</span><span class="o">'</span><span class="na">re</span><span class="w"> </span><span class="n">printing</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">iov</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">one</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">i32</span><span class="p">.</span><span class="k">const</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="n">nwritten</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">place</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">written</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nb">drop</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="n">Discard</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">demo</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="n">demo</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">if</span><span class="w"> </span><span class="n">you</span><span class="o">'</span><span class="na">re</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">precompiled</span><span class="w"> </span><span class="n">module</span><span class="p">,</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">precompiled</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">expected</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="err">`</span><span class="w"></span>
<span class="w">            </span><span class="o">-</span>-&gt; <span class="p">.</span><span class="o">/</span><span class="n">demo</span>:<span class="mi">1</span>:<span class="mi">1</span><span class="w"></span>
<span class="w">             </span><span class="o">|</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span>#<span class="o">!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"></span>
<span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="o">^</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="322672705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322672705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322672705">(Jan 21 2023 at 06:38)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399192635">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>that it could potentially normalize "not quite compliant" <code>.wat</code> files -- in other words, it encourages the existence of non-standards-compliant source that fails to parse in other tools/engines.</p>
<p>But since this is Unix, there are probably ways to put together other tools to make a solution... one technique that might help is to write the wat content as a heredoc, something like the following (just tested):</p>
<p>```<br>
#!/bin/sh</p>
<p>wasmtime run /dev/stdin &lt;&lt;__END__<br>
    (module<br>
     (import "wasi_snapshot_preview1" "proc_exit" (func (param i32)))<br>
     (memory (export "memory") 0 1)<br>
     (func (export "_start")<br>
      i32.const 0<br>
      call 0))<br>
__END__<br>
```</p>
</blockquote>
<p>How will that work when the WebAssembly module is expected to be reading stdin from an application, e.g., the browser?</p>
</blockquote>



<a name="322740240"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322740240" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322740240">(Jan 21 2023 at 15:08)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399268388">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>How will that work when the WebAssembly module is expected to be reading stdin from an application, e.g., the browser?</p>
</blockquote>
<p>You can write the wat file to a temporary file and then run it. Or you could store the wat file next to the shell script that runs wasmtime. You will need to do that anyway if you want to compile the wat file to a wasm file when shipping the extension. (a wat file is several times bigger than the compiled wasm file)</p>
</blockquote>



<a name="322748737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322748737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322748737">(Jan 21 2023 at 16:04)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399279180">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>You can write the wat file to a temporary file and then run it.</p>
</blockquote>
<p>That doesn't work as described in this case <a href="https://github.com/bytecodealliance/wasmtime/issues/5614">https://github.com/bytecodealliance/wasmtime/issues/5614</a>.</p>
<p>I tried both .wat and .wasm.</p>
<p><code>wasmtime</code> appears to be a special case executable that cannot be instructed to execute what is below the shebang. </p>
</blockquote>



<a name="322752711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322752711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322752711">(Jan 21 2023 at 16:36)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399284749">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Did you try something like</p>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="ch">#!/usr/bin/sh</span>

cat &gt;foo.wat <span class="s">&lt;&lt;__END__</span>
<span class="s">(module</span>
<span class="s">    ;; Import the required fd_write WASI function which will write the given io vectors to stdout</span>
<span class="s">    ;; The function signature for fd_write is:</span>
<span class="s">    ;; (File Descriptor, *iovs, iovs_len, nwritten) -&gt; Returns number of bytes written</span>
<span class="s">    (import "wasi_unstable" "fd_write" (func $fd_write (param i32 i32 i32 i32) (result i32)))</span>

<span class="s">    (memory 1)</span>
<span class="s">    (export "memory" (memory 0))</span>

<span class="s">    ;; Write 'hello world\n' to memory at an offset of 8 bytes</span>
<span class="s">    ;; Note the trailing newline which is required for the text to appear</span>
<span class="s">    (data (i32.const 8) "hello world\n")</span>

<span class="s">    (func $main (export "_start")</span>
<span class="s">        ;; Creating a new io vector within linear memory</span>
<span class="s">        (i32.store (i32.const 0) (i32.const 8))  ;; iov.iov_base - This is a pointer to the start of the 'hello world\n' string</span>
<span class="s">        (i32.store (i32.const 4) (i32.const 12))  ;; iov.iov_len - The length of the 'hello world\n' string</span>

<span class="s">        (call $fd_write</span>
<span class="s">            (i32.const 1) ;; file_descriptor - 1 for stdout</span>
<span class="s">            (i32.const 0) ;; *iovs - The pointer to the iov array, which is stored at memory location 0</span>
<span class="s">            (i32.const 1) ;; iovs_len - We're printing 1 string stored in an iov - so one.</span>
<span class="s">            (i32.const 20) ;; nwritten - A place in memory to store the number of bytes written</span>
<span class="s">        )</span>
<span class="s">        drop ;; Discard the number of bytes written from the top of the stack</span>
<span class="s">    )</span>
<span class="s">)</span>
<span class="s">__END__</span>

wasmtime run foo.wat
</code></pre></div><br>
</p>
</blockquote>



<a name="322754510"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322754510" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322754510">(Jan 21 2023 at 16:50)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399287143">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>Did you try something like</p>
</blockquote>
<p>Just tried. The Native Messaging host exits.<br>
</p>
</blockquote>



<a name="322755020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322755020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322755020">(Jan 21 2023 at 16:54)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399287946">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>This specific example doesn't read from stdin and exits as soon as it wrote <code>hello world\n</code> to stdout. As such it is expected that it exits. Furthermore the messages need to be in json format in both directions.</p>
</blockquote>



<a name="322755065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322755065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322755065">(Jan 21 2023 at 16:55)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399287946">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>This specific example doesn't read from stdin and exits as soon as it wrote <code>hello world\n</code> to stdout. As such it is expected that it exits. Furthermore the messages need to be in json format in both directions together with a length prefix (4 byte little endian integer I believe).</p>
</blockquote>



<a name="322755248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322755248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322755248">(Jan 21 2023 at 16:56)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399288300">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I uploaded the WASm file to <a href="https://webassembly.github.io/wabt/demo/wasm2wat/">https://webassembly.github.io/wabt/demo/wasm2wat/</a> and substituted that for the wat in your example. </p>
<p>I'm just trying to test WebAssembly version of a Native Messaging host. Thus I asked the WebAssembly experts how to do that after not being successful using <code>wasmtime</code> and learning that <code>wasmtime</code> does not support shebang line.</p>
</blockquote>



<a name="322755717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322755717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322755717">(Jan 21 2023 at 17:00)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399288987">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>@bjorn3 I know for a fact that both <a href="https://github.com/guest271314/native-messaging-c">https://github.com/guest271314/native-messaging-c</a> and <a href="https://github.com/guest271314/native-messaging-cpp">https://github.com/guest271314/native-messaging-cpp</a> work as expected. I compiled the C version to WASM using WASI SDK. I downloaded and installed <code>wasmtime</code>. Now I am stuck trying to run the executable. </p>
</blockquote>



<a name="322757330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322757330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322757330">(Jan 21 2023 at 17:12)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399291189">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>It shouldn't be this complicated that we have to use a shell script to run .wasm and .wat. when we have <code>wasmtime</code> that _should_ be capable of just interpreting a shebang lineand running the code below that line.</p>
<p>At least provide users with the _option_ to use the shebang line. </p>
<p>I mean the line to install <code>wasmtime</code> itself uses Bash.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">curl</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//wasmtime.dev/install.sh -sSf | bash</span>
</code></pre></div>
<p>Examples of using shebang for Python, Node.js, Deno, QuickJS, Bun Native Messaging hosts:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S python3 -u</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S ./node --max-old-space-size=6 --jitless --expose-gc --v8-pool-size=1</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S ./deno run --v8-flags="--expose-gc,--jitless"</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S ./qjs --std</span><span class="w"></span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env -S ./bun run --no-install --hot</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="322761350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322761350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322761350">(Jan 21 2023 at 17:47)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399297970">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p><code>#!/usr/bin/env -S python3 -u</code></p>
</blockquote>
<p>In Python <code>#</code> indicates a comment, so no syntax extension is needed here.</p>
<blockquote>
<p><code>#!/usr/bin/env -S ./node --max-old-space-size=6 --jitless --expose-gc --v8-pool-size=1</code><br>
<code>#!/usr/bin/env -S ./deno run --v8-flags="--expose-gc,--jitless"</code><br>
<code>#!/usr/bin/env -S ./qjs --std</code><br>
<code>#!/usr/bin/env -S ./bun run --no-install --hot</code></p>
</blockquote>
<p>These have decided to extend javascript in a way incompatible with javascript engines not included in this list like browsers, which is not something wasmtime wants to do.</p>
<blockquote>
<p>At least provide users with the option to use the shebang line.</p>
</blockquote>
<p>As per <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020216100">https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020216100</a> you should suggest adding it to the official wat specification, not as a wasmtime specific extension.</p>
<blockquote>
<p>@bjorn3 I know for a fact that both <a href="https://github.com/guest271314/native-messaging-c">https://github.com/guest271314/native-messaging-c</a> and <a href="https://github.com/guest271314/native-messaging-cpp">https://github.com/guest271314/native-messaging-cpp</a> work as expected. I compiled the C version to WASM using WASI SDK. I downloaded and installed wasmtime. Now I am stuck trying to run the executable.</p>
</blockquote>
<p>I don't think this issue is related at all to the shebang:</p>
<p>If I try <code>printf '\0\0\0\x02{}' | ./nm_c</code>, I get <code>\0\0\0\x02{}</code> as response back followed by an infinite list of null bytes (as you didn't add an exit condition when 0 bytes are read, which indicates EOF). However when using the wasm version I get <code>\0\0\0\x02{}</code> in repeat. This is caused by an off-by-one error when allocating the message buffer. The following patch fixes this mistake:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/nm_c.c b/nm_c.c</span><span class="w"></span>
<span class="gh">index a1afda1..e328d20 100644</span><span class="w"></span>
<span class="gd">--- a/nm_c.c</span><span class="w"></span>
<span class="gi">+++ b/nm_c.c</span><span class="w"></span>
<span class="gu">@@ -26,7 +26,7 @@ uint8_t* getMessage(size_t *inputLength) {</span><span class="w"></span>
<span class="w"> </span>  // `message[0]`).<span class="w"></span>
<span class="w"> </span>  // `sizeof(*message)` will hence return the size in bytes of the type<span class="w"></span>
<span class="w"> </span>  // `message` points at, which means it's equivalent to `sizeof(uint_8)`.<span class="w"></span>
<span class="gd">-  uint8_t *message = calloc(messageLength, sizeof(*message));</span><span class="w"></span>
<span class="gi">+  uint8_t *message = calloc(messageLength+1, sizeof(*message));</span><span class="w"></span>
<span class="w"> </span>  result = fread(message, sizeof(*message), messageLength, stdin);<span class="w"></span>
<span class="w"> </span>  // `inputLength` is a pointer, so we store the length at the memory address it<span class="w"></span>
<span class="w"> </span>  // points at. This way we return 2 values at once from a function!<span class="w"></span>
</code></pre></div>
<p>I suspect that applying this patch will fix the communication issue that lead to the native messaging host exiting.</p>
</blockquote>



<a name="322763245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322763245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322763245">(Jan 21 2023 at 18:04)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399301639">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I can do this just fine with the C Native Messaging host</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">globalThis</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chrome</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">getManifest</span><span class="p">().</span><span class="n">short_name</span><span class="p">;</span><span class="w"></span>

<span class="n">globalThis</span><span class="p">.</span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chrome</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">connectNative</span><span class="p">(</span><span class="n">globalThis</span><span class="p">.</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="n">port</span><span class="p">.</span><span class="n">onMessage</span><span class="p">.</span><span class="n">addListener</span><span class="p">((</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">));</span><span class="w"></span>
<span class="n">port</span><span class="p">.</span><span class="n">onDisconnect</span><span class="p">.</span><span class="n">addListener</span><span class="p">((</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">chrome</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">lastError</span><span class="p">));</span><span class="w"></span>
<span class="n">port</span><span class="p">.</span><span class="n">postMessage</span><span class="p">(</span><span class="o">''</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Thanks for the patch nonetheless. Kindly file a PR explaining why, what, how so we know exactly what is going on on the record of the repository. I am not a C or C++ expert. I am far more fluent in JavaScript. I had to get help to create the C and C++ versions.</p>
<blockquote>
<p>As per <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020216100">https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1020216100</a> you should suggest adding it to the official wat specification, not as a wasmtime specific extension.</p>
</blockquote>
<p>I think we should be able to use <code>/usr/bin/env</code> with .wat or .wasm files where we call <code>wastime</code> as the environment.</p>
<blockquote>
<p>I suspect that applying this patch will fix the communication issue that lead to the native messaging host exiting.</p>
</blockquote>
<p>Unfortunately that didn't change anything relevant to the Native Messaging host. </p>
<p>How is .wat relevant to the ability to call <code>wasmtime</code>?</p>
<p>I'm just trying to test WebAssembly as a Native Messaging host using the officially endorsed runtime. If you try the above hosts they each echo back the input from the browser. I have no idea how to do that using WebAssembly or <code>wasmtime</code>. This is the first time I've actually successfully compiled a .wasm file.<br>
</p>
</blockquote>



<a name="322763621"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322763621" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322763621">(Jan 21 2023 at 18:08)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399302467">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I applied the patch, recompiled the C source code to WASM and the host still exited - when using the <code>cat</code> and redirection approach.</p>
</blockquote>



<a name="322764059"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322764059" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322764059">(Jan 21 2023 at 18:12)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399303341">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>@bjorn3 If/when you have the time and are so inclined perhaps try testing using <code>wasmtime</code> yourself; c. to the other hosts I've linked to above. Perhaps then you will see where I'm at and why I commented here and filed an issue. The instructions are here <a href="https://github.com/guest271314/native-messaging-nodejs">https://github.com/guest271314/native-messaging-nodejs</a>.  </p>
</blockquote>



<a name="322764578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322764578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322764578">(Jan 21 2023 at 18:17)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399304307">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for the patch nonetheless. Kindly file a PR explaining why, what, how so we know exactly what is going on on the record of the repository. I am not a C or C++ expert. I am far more fluent in JavaScript. I had to get help to create the C and C++ versions.</p>
</blockquote>
<p>Sure, <a href="https://github.com/guest271314/native-messaging-c/pull/2">https://github.com/guest271314/native-messaging-c/pull/2</a>.</p>
</blockquote>



<a name="322764968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322764968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322764968">(Jan 21 2023 at 18:21)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399305034">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>@bjorn3 If/when you have the time and are so inclined perhaps try testing using wasmtime yourself; c. to the other hosts I've linked to above. Perhaps then you will see where I'm at and why I commented here and filed an issue. The instructions are here <a href="https://github.com/guest271314/native-messaging-nodejs">https://github.com/guest271314/native-messaging-nodejs</a>.</p>
</blockquote>
<p>I will try it.</p>
</blockquote>



<a name="322765268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322765268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322765268">(Jan 21 2023 at 18:24)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399305553">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>@bjorn3 If/when you have the time and are so inclined perhaps try testing using wasmtime yourself; c. to the other hosts I've linked to above. Perhaps then you will see where I'm at and why I commented here and filed an issue. The instructions are here <a href="https://github.com/guest271314/native-messaging-nodejs">https://github.com/guest271314/native-messaging-nodejs</a>.</p>
</blockquote>
<p>I will try it.</p>
</blockquote>
<p>Don't hesitate to ask if you have any questions getting the host running. </p>
<p>I look forward to see how you will get <code>wasmtime</code> working to use .wat or .wasm as a WebAssembly Native Messaging host.</p>
</blockquote>



<a name="322766601"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322766601" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322766601">(Jan 21 2023 at 18:38)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399308135">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Got <a href="https://github.com/guest271314/native-messaging-c">https://github.com/guest271314/native-messaging-c</a> on native working after I moved it out of the <code>/tmp</code> dir and made sure to use a trailing slash for the extension specifier in <code>nm_c.json</code>. I did get a message with an array of exactly 0x33333 zero elements. Is this expected?</p>
</blockquote>



<a name="322766955"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322766955" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322766955">(Jan 21 2023 at 18:42)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399308863">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>For me an <code>nm_c.sh</code> with the following contents worked fine:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

wasmtime run nm_c.wasm
</code></pre></div>
<p>Make sure to make the shell script executable though. Otherwise chromium says "Native host has exited.".</p>
</blockquote>



<a name="322767126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322767126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322767126">(Jan 21 2023 at 18:44)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399309207">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>Got <a href="https://github.com/guest271314/native-messaging-c">https://github.com/guest271314/native-messaging-c</a> on native working after I moved it out of the <code>/tmp</code> dir and made sure to use a trailing slash for the extension specifier in <code>nm_c.json</code>. I did get a message with an array of exactly 0x33333 zero elements. Is this expected?</p>
</blockquote>
<p>We pass 1MB to the host (<code>JSON.stringify(new Array(290715)).length // 1453576</code>) and get that 1MB back.<br>
</p>
</blockquote>



<a name="322768095"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322768095" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322768095">(Jan 21 2023 at 18:55)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399311250">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<blockquote>
<p>For me an <code>nm_c.sh</code> with the following contents worked fine:</p>
<p>```shell<br>
#!/usr/bin/env bash</p>
<p>wasmtime run nm_c.wasm<br>
```</p>
<p>Make sure to make the shell script executable though. Otherwise chromium says "Native host has exited.".</p>
</blockquote>
<p>Interesting. Still exiting here. You got the array back? Can you kindly post the nm_c_webassembly.json you copied to NativeMessagingHosts and manifest.json you use here or to a gist? Did you use WASI SDK to compile to WASM?</p>
</blockquote>



<a name="322773137"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322773137" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322773137">(Jan 21 2023 at 19:48)</a>:</h4>
<p>guest271314 <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399320595">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>@bjorn3 This is what I get using C Native Messaging host</p>
<p>![Screenshot_2023-01-21_11-45-48](<a href="https://user-images.githubusercontent.com/4174848/213884538-1d724648-377f-4025-a31b-9a8f71efc5df.png">https://user-images.githubusercontent.com/4174848/213884538-1d724648-377f-4025-a31b-9a8f71efc5df.png</a>)</p>
<p>This is what I get using </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">#!/usr/bin/env bash</span><span class="w"></span>

<span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">nm_c</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
</code></pre></div>
<p>![Screenshot_2023-01-21_11-46-15](<a href="https://user-images.githubusercontent.com/4174848/213884596-4d2e31e9-5dac-4ddd-980d-d7b6b0a07268.png">https://user-images.githubusercontent.com/4174848/213884596-4d2e31e9-5dac-4ddd-980d-d7b6b0a07268.png</a>)</p>
</blockquote>



<a name="322775197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322775197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322775197">(Jan 21 2023 at 20:12)</a>:</h4>
<p>JoeStrout <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399324459">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>Interesting to see other people running into this unnecessary hurdle.  I doubt you'll get much traction, though; it seems the people in charge of wasmtime are sticklers more interested in their own notions of purity than in making a tool actually useful.</p>
<p>This will, one by one, drive away everybody who doesn't agree with them (like me; I gave up on WASM and wasmtime a while back, in part because of this).  Then they'll look around at the people who are left, all nodding in agreement, and think they were justified in their stubbornness.  That's just how these things go.</p>
</blockquote>



<a name="322776787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322776787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322776787">(Jan 21 2023 at 20:34)</a>:</h4>
<p>tschneidereit locked <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>Make wasmtime hip to a shebang at the first line of the file, e.g.:</p>
<p><code>#!/usr/local/bin/wasmtime</code></p>
<p>followed by the text-format wasm code as usual.  Currently, the shell runs wasmtime and feeds it the script as expected, but wasmtime chokes on the first line and fails to run the following script.</p>
<h4>Benefit</h4>
<p>This would allow us to write scripts that can be executed by simply setting the executable bit and invoking them, like any other shell script.  It's a matter of convenience.  I have a lot of scripts in a lot of different languages; I don't have to remember what tool to use to run them because they all understand shebang — except for wasmtime.</p>
<h4>Implementation</h4>
<p>Just special-case it: if the first line of the script file starts with "#!", then ignore it and continue with the rest of the file.</p>
<h4>Alternatives</h4>
<p>I could write, for every wasm script I want to run, a little 2-line shell script that runs wasmtime with the path to the actual script.  That would be annoying on so many levels.</p>
</blockquote>



<a name="322777204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233715%20Support%20shebang%20for%20command-line%20w.../near/322777204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233715.20Support.20shebang.20for.20command-line.20w.2E.2E.2E.html#322777204">(Jan 21 2023 at 20:39)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/issues/3715#issuecomment-1399328423">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3715">issue #3715</a>:</p>
<blockquote>
<p>I locked this topic as all the discussion starting yesterday is off-topic. As <a href="#issuecomment-1046028851">laid out last year</a>, the wasmtime project is dedicated to implementing standardized features, and will not accept non-standards, non-interoperable features. This isn't a matter of purity, but a matter of wanting to foster an ecosystem that's wider than this one project.</p>
<p>I'd again encourage those who want this feature to propose it to the WebAssembly Community Group as the right forum for discussions about changes to the standards themselves. If and when such a proposal gains traction there, we'll happily implement it in wasmtime.</p>
<p>(@bjorn3: thank you very much for your diligent work on trying to resolve users' problems—it's much appreciated! ❤️)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>