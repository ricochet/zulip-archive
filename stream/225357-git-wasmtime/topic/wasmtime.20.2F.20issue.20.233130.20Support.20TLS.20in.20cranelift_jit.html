<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3130 Support TLS in cranelift_jit · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233130.20Support.20TLS.20in.20cranelift_jit.html">wasmtime / issue #3130 Support TLS in cranelift_jit</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="247639184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233130%20Support%20TLS%20in%20cranelift_jit/near/247639184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233130.20Support.20TLS.20in.20cranelift_jit.html#247639184">(Jul 29 2021 at 20:49)</a>:</h4>
<p>bjorn3 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3130">issue #3130</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>See issue title.</p>
<h4>Benefit</h4>
<p>Required by cg_clif's jit mode.</p>
<h4>Implementation</h4>
<p>Give every defined jit tls variable a globally unique id using a global atomic counter. Next define a single native TLS variable inside <code>cranelift_jit</code>. This TLS variable points to a vec of pointers indexed by the previously mentioned globally unique id. Require the elf_tls_gd tls model and forward <code>__tls_get_addr</code> to a function of cranelift_jit that looks up the tls variable address using the native tls variable and initializes the tls variable if necessary.</p>
<p>This implementation method doesn't allow importing native tls variables, supporting native tls requires support from libc and rust never exports tls variables directly anyway. <code>thread_local!</code> wraps it in a function call.</p>
<h4>Alternatives</h4>
<p>Add a bunch of special cases in cg_clif to use a different tls declaration method when in jit mode and implement this proposal in cg_clif itself. This increases complexity and reduces reusability.</p>
</blockquote>



<a name="255809313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233130%20Support%20TLS%20in%20cranelift_jit/near/255809313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233130.20Support.20TLS.20in.20cranelift_jit.html#255809313">(Oct 01 2021 at 21:21)</a>:</h4>
<p>akirilov-arm labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3130">issue #3130</a>:</p>
<blockquote>
<h4>Feature</h4>
<p>See issue title.</p>
<h4>Benefit</h4>
<p>Required by cg_clif's jit mode.</p>
<h4>Implementation</h4>
<p>Give every defined jit tls variable a globally unique id using a global atomic counter. Next define a single native TLS variable inside <code>cranelift_jit</code>. This TLS variable points to a vec of pointers indexed by the previously mentioned globally unique id. Require the elf_tls_gd tls model and forward <code>__tls_get_addr</code> to a function of cranelift_jit that looks up the tls variable address using the native tls variable and initializes the tls variable if necessary.</p>
<p>This implementation method doesn't allow importing native tls variables, supporting native tls requires support from libc and rust never exports tls variables directly anyway. <code>thread_local!</code> wraps it in a function call.</p>
<h4>Alternatives</h4>
<p>Add a bunch of special cases in cg_clif to use a different tls declaration method when in jit mode and implement this proposal in cg_clif itself. This increases complexity and reduces reusability.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>