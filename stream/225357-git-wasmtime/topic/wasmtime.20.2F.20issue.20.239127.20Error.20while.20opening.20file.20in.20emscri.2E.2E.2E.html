<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9127 Error while opening file in emscri... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html">wasmtime / issue #9127 Error while opening file in emscri...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="462349977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462349977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462349977">(Aug 14 2024 at 13:48)</a>:</h4>
<p><a href="https://github.com/himakshi25">himakshi25</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">Issue #9127</a>.</p>



<a name="462349980"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462349980" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462349980">(Aug 14 2024 at 13:48)</a>:</h4>
<p>himakshi25 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Created a wasm of a simple c program with command: <code>emcc main.c -o file.wasm</code>.<br>
Program is trying to open a file present in test directory.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// main.c</span>
<span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"Hello world!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">    </span><span class="n">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="s">"test/hello_world_file.txt"</span><span class="p">,</span><span class="w"> </span><span class="s">"rb"</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"cannot open file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fgetc</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putchar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">fclose</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>On running file.wasm with wasmtime with command <code>wasmtime file.wasm</code> got the below error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
<span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">file</span>
</code></pre></div>
<p>Also, tried giving directory as well in wasmtime but didn't work and got same error.<br>
command <code>wasmtime --dir=test file.wasm</code></p>
<p>Is there any way to allow wasmtimes to access or mount local directory for file read and write?</p>
</blockquote>



<a name="462350047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462350047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462350047">(Aug 14 2024 at 13:48)</a>:</h4>
<p>himakshi25 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Created a wasm of a simple c program with command: <code>emcc main.c -o file.wasm</code>.<br>
Program is trying to open a file present in test directory.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// main.c</span>
<span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"Hello world!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">    </span><span class="n">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="s">"test/hello_world_file.txt"</span><span class="p">,</span><span class="w"> </span><span class="s">"rb"</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"cannot open file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fgetc</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putchar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">fclose</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>On running file.wasm with wasmtime with command <code>wasmtime file.wasm</code> got the below error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
<span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">file</span>
</code></pre></div>
<p>Also, tried giving directory as well in wasmtime but didn't work and got same error.<br>
command <code>wasmtime --dir=test file.wasm</code></p>
<p>Is there any way to allow wasmtime to access or mount local directory for file read and write?</p>
</blockquote>



<a name="462350806"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462350806" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462350806">(Aug 14 2024 at 13:54)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2288824574">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Unless you enabled the <code>PURE_WASI</code> mode, Emscripten compiled modules are not guaranteed to be WASI compatible. I don't know if that is the reason it failed here, but it is something to keep in mind.</p>
</blockquote>



<a name="462361235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462361235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462361235">(Aug 14 2024 at 14:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2289023862">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Have you tried <code>--dir .</code> perhaps? By default guests have no access to the filesystem so <code>wasmtime file.wasm</code> won't work. The <code>--dir test</code> argument I don't think will work because that makes <code>test</code> the root of the filesystem where the program wants to open a directory called <code>test</code> so the root needs to be one level higher. If that doesn't work casn you upload the wasm binary here?</p>
</blockquote>



<a name="462625512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462625512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462625512">(Aug 15 2024 at 19:41)</a>:</h4>
<p>himakshi25 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2292064058">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Yeah, I tried without <code>PURE_WASI</code> mode and this might be the possible reason, Sharing file below to confirm.<br>
<a href="https://github.com/user-attachments/files/16628956/wasm.zip">wasm.zip</a></p>
<p>As suggested, tried with <code>PURE_WASI</code> mode. <br>
command: <code>emcc main.cpp -o file.wasm -s PURE_WASI</code><br>
Getting same error, sharing the wasm binary as well.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
<span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">file</span>
</code></pre></div>
<p><a href="https://github.com/user-attachments/files/16629595/wasm_pure_wasi.zip">wasm_pure_wasi.zip</a></p>
<p>Could you please help to know if I am missing any other argument here?</p>
</blockquote>



<a name="462625568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462625568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462625568">(Aug 15 2024 at 19:41)</a>:</h4>
<p>himakshi25 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2292064058">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>@bjorn3 Yeah, I tried without <code>PURE_WASI</code> mode and this might be the possible reason, Sharing file below to confirm.<br>
<a href="https://github.com/user-attachments/files/16628956/wasm.zip">wasm.zip</a></p>
<p>As suggested, tried with <code>PURE_WASI</code> mode. <br>
command: <code>emcc main.cpp -o file.wasm -s PURE_WASI</code><br>
Getting same error, sharing the wasm binary as well.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
<span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">file</span>
</code></pre></div>
<p><a href="https://github.com/user-attachments/files/16629595/wasm_pure_wasi.zip">wasm_pure_wasi.zip</a></p>
<p>Could you please help to know if I am missing any other argument here?</p>
</blockquote>



<a name="462642050"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/462642050" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#462642050">(Aug 15 2024 at 21:13)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2292270134">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>I think this is an issue with a flag needing to be passed to emscripten or similar. The wasm binaries here have these imports:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"proc_exit"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"fd_write"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">7</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"fd_read"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">7</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"fd_close"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">3</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="n">import</span><span class="w"> </span><span class="s">"wasi_snapshot_preview1"</span><span class="w"> </span><span class="s">"fd_seek"</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(;</span><span class="mi">4</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="mi">12</span><span class="p">)))</span>
</code></pre></div>
<p>but none of those are the import to open a host file. This means that the wasm binary is not even trying to open a host file. This makes me think the issue is with the binary itself (e.g. configuration of emscripten) rather than Wasmtime.</p>
</blockquote>



<a name="463354257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463354257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463354257">(Aug 19 2024 at 09:17)</a>:</h4>
<p>rggaur789 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296079709">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Hi @alexcrichton ,<br>
I have tried the below simple c++ code</p>
<p>#include &lt;iostream&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Hello World!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>with command <code>emcc main.cpp -o file.wasm -s PURE_WASI</code></p>
<p>and <code>wasmtime file.wasm</code></p>
<p>but I am getting</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">file</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="s">"file.wasm"</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="n">import</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="n">env</span><span class="p">::</span><span class="n">_tzset_js</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">defined</span>
</code></pre></div>
<p>I am using emscripten and wasmtime latest versions. Can you please help what I am doing wrong here?</p>
</blockquote>



<a name="463354356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463354356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463354356">(Aug 19 2024 at 09:17)</a>:</h4>
<p>rggaur789 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296079709">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Hi @alexcrichton ,<br>
I have tried the below simple c++ code</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">iostream</span><span class="o">&gt;</span>

<span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Hello World!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>with command <code>emcc main.cpp -o file.wasm -s PURE_WASI</code></p>
<p>and <code>wasmtime file.wasm</code></p>
<p>but I am getting</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">file</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="s">"file.wasm"</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="n">import</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="n">env</span><span class="p">::</span><span class="n">_tzset_js</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">defined</span>
</code></pre></div>
<p>I am using emscripten and wasmtime latest versions. Can you please help what I am doing wrong here?</p>
</blockquote>



<a name="463354512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463354512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463354512">(Aug 19 2024 at 09:18)</a>:</h4>
<p>rggaur789 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296079709">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Hi @alexcrichton / @bjorn3  ,<br>
I have tried the below simple c++ code</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">iostream</span><span class="o">&gt;</span>

<span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Hello World!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>with command <code>emcc main.cpp -o file.wasm -s PURE_WASI</code></p>
<p>and <code>wasmtime file.wasm</code></p>
<p>but I am getting</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">file</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="s">"file.wasm"</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="n">import</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="n">env</span><span class="p">::</span><span class="n">_tzset_js</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">defined</span>
</code></pre></div>
<p>I am using emscripten and wasmtime latest versions. Can you please help what I am doing wrong here?</p>
</blockquote>



<a name="463354775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463354775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463354775">(Aug 19 2024 at 09:20)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296085858">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>It may be the case that the PURE_WASI mode of Emscripten is broken. It is marked as experimental anyway.</p>
<p>You may have more luck using wasi-sdk instead of Emscripten: <a href="https://github.com/webassembly/wasi-sdk">https://github.com/webassembly/wasi-sdk</a></p>
</blockquote>



<a name="463354996"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463354996" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463354996">(Aug 19 2024 at 09:21)</a>:</h4>
<p>rggaur789 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296088619">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>@bjorn3 I have tried with -s STANDALONE_WASM also but the result is same.</p>
</blockquote>



<a name="463386123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463386123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463386123">(Aug 19 2024 at 12:13)</a>:</h4>
<p>rggaur789 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296088619">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>@bjorn3 I have tried with -s STANDALONE_WASM also but the result is same,<br>
also in wasi-sdk c++ exception is not supported so it will not be compatible with our uses cases</p>
</blockquote>



<a name="463423897"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463423897" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463423897">(Aug 19 2024 at 14:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2296758362">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>@rggaur789 you're asking questions here that require a deeper knowledge of Emscripten than I think many of us have. I'd recommend raising questions with the Emscripten side of things for answers</p>
</blockquote>



<a name="463623842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463623842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463623842">(Aug 20 2024 at 07:57)</a>:</h4>
<p>himakshi25 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2298213344">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Thanks @bjorn3 @alexcrichton for inputs.<br>
One related query, <br>
I also tried by using <code>--embed-file</code> of emscripten <a href="https://emscripten.org/docs/porting/files/packaging_files.html">https://emscripten.org/docs/porting/files/packaging_files.html</a> <br>
command : <code>emcc file.cpp -o file.wasm --embed-file test/hello_world_file.txt -s STANDALONE_WASM</code><br>
and while executing with wasmtime getting error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">file</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span>
<span class="w">    </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="s">"file.wasm"</span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">unknown</span><span class="w"> </span><span class="n">import</span><span class="p">:</span><span class="w"> </span><span class="err">`</span><span class="n">env</span><span class="p">::</span><span class="n">_emscripten_fs_load_embedded_files</span><span class="err">`</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">defined</span>
</code></pre></div>
<p><a href="https://github.com/user-attachments/files/16671134/embed_file.zip">embed_file.zip</a></p>
<p>Is the wasmtime not supporting this emscripten file packaging feature or is there any plan to support this.</p>
</blockquote>



<a name="463640339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463640339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463640339">(Aug 20 2024 at 09:07)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/9127#issuecomment-2298358687">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Wasmtime doesn't support Emscripten's ABI. Said ABI is not even stable anyway AFAIK. It seems <code>--embed-file</code> depends on Emscripten's ABI and as such is incompatible with STANDALONE_WASM.</p>
</blockquote>



<a name="463650446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239127%20Error%20while%20opening%20file%20in%20emscri.../near/463650446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239127.20Error.20while.20opening.20file.20in.20emscri.2E.2E.2E.html#463650446">(Aug 20 2024 at 09:44)</a>:</h4>
<p>himakshi25 closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9127">issue #9127</a>:</p>
<blockquote>
<p>Created a wasm of a simple c program with command: <code>emcc main.c -o file.wasm</code>.<br>
Program is trying to open a file present in test directory.</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// main.c</span>
<span class="p">#</span><span class="n">include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="n">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"Hello world!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">    </span><span class="n">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="s">"test/hello_world_file.txt"</span><span class="p">,</span><span class="w"> </span><span class="s">"rb"</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"cannot open file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fgetc</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putchar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">fclose</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>On running file.wasm with wasmtime with command <code>wasmtime file.wasm</code> got the below error</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
<span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">file</span>
</code></pre></div>
<p>Also, tried giving directory as well in wasmtime but didn't work and got same error.<br>
command <code>wasmtime --dir=test file.wasm</code></p>
<p>Is there any way to allow wasmtime to access or mount local directory for file read and write?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>