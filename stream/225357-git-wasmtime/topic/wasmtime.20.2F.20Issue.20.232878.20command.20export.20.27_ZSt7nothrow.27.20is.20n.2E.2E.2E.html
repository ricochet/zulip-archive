<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2878 command export &#x27;_ZSt7nothrow&#x27; is n... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html">wasmtime / Issue #2878 command export &#x27;_ZSt7nothrow&#x27; is n...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="237720992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237720992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237720992">(May 06 2021 at 20:10)</a>:</h4>
<p>vshymanskyy opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>git clone https://github.com/wasm3/wasm3-self-compiling.git

<span class="nb">cd</span> wasm3-self-compiling

wasmtime run --mapdir<span class="o">=</span>/::. --mapdir<span class="o">=</span>./::. ./wasm/clang.wasm -- -cc1 -triple wasm32-unknown-wasi -isysroot /sys -internal-isystem /sys/include -emit-obj -o source/hello/hello.o source/hello/hello.c -O3
</code></pre></div>
<h3>Expected Results</h3>
<p>Compilation succeeds</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="log"><pre><span></span><code>Error: failed to run main module `./wasm/clang.wasm`

Caused by:
    0: failed to instantiate "./wasm/clang.wasm"
    1: command export '_ZSt7nothrow' is not a function
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 0.26.0</p>
<p>Operating system: Ubuntu 21.04<br>
Architecture: x86-64</p>
<h3>Extra Info</h3>
<p>A similar command works with <code>Wasm3</code>, <code>Wasmer</code>,  Node.js (<a href="https://www.npmjs.com/package/wasm-run"><code>wasm-run</code></a>)<br>
</p>
</blockquote>



<a name="237720993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237720993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237720993">(May 06 2021 at 20:10)</a>:</h4>
<p>vshymanskyy labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>git clone https://github.com/wasm3/wasm3-self-compiling.git

<span class="nb">cd</span> wasm3-self-compiling

wasmtime run --mapdir<span class="o">=</span>/::. --mapdir<span class="o">=</span>./::. ./wasm/clang.wasm -- -cc1 -triple wasm32-unknown-wasi -isysroot /sys -internal-isystem /sys/include -emit-obj -o source/hello/hello.o source/hello/hello.c -O3
</code></pre></div>
<h3>Expected Results</h3>
<p>Compilation succeeds</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="log"><pre><span></span><code>Error: failed to run main module `./wasm/clang.wasm`

Caused by:
    0: failed to instantiate "./wasm/clang.wasm"
    1: command export '_ZSt7nothrow' is not a function
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 0.26.0</p>
<p>Operating system: Ubuntu 21.04<br>
Architecture: x86-64</p>
<h3>Extra Info</h3>
<p>A similar command works with <code>Wasm3</code>, <code>Wasmer</code>,  Node.js (<a href="https://www.npmjs.com/package/wasm-run"><code>wasm-run</code></a>)<br>
</p>
</blockquote>



<a name="237723184"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237723184" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237723184">(May 06 2021 at 20:28)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833838016">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>@sunfishcode the repro <code>clang.wasm</code> exports a bunch of globals that aren't expected for "commands" to export.</p>
<p>Perhaps we should warn on or ignore non-function exports for commands (that we don't otherwise have a deprecation message for)?</p>
</blockquote>



<a name="237724158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237724158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237724158">(May 06 2021 at 20:35)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833842754">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>Is this the same issue as in #2587?</p>
</blockquote>



<a name="237724614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237724614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237724614">(May 06 2021 at 20:38)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833844764">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>It appears to be.</p>
</blockquote>



<a name="237724704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237724704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237724704">(May 06 2021 at 20:39)</a>:</h4>
<p>peterhuene edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833844764">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>It appears to be and I think your proposed solution there is a good one.</p>
</blockquote>



<a name="237725740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237725740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237725740">(May 06 2021 at 20:47)</a>:</h4>
<p>vshymanskyy <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833853996">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>Duplicate of #2587. Sorry didn't notice it!</p>
</blockquote>



<a name="237725741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237725741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237725741">(May 06 2021 at 20:47)</a>:</h4>
<p>vshymanskyy closed <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>git clone https://github.com/wasm3/wasm3-self-compiling.git

<span class="nb">cd</span> wasm3-self-compiling

wasmtime run --mapdir<span class="o">=</span>/::. --mapdir<span class="o">=</span>./::. ./wasm/clang.wasm -- -cc1 -triple wasm32-unknown-wasi -isysroot /sys -internal-isystem /sys/include -emit-obj -o source/hello/hello.o source/hello/hello.c -O3
</code></pre></div>
<h3>Expected Results</h3>
<p>Compilation succeeds</p>
<h3>Actual Results</h3>
<div class="codehilite" data-code-language="log"><pre><span></span><code>Error: failed to run main module `./wasm/clang.wasm`

Caused by:
    0: failed to instantiate "./wasm/clang.wasm"
    1: command export '_ZSt7nothrow' is not a function
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 0.26.0</p>
<p>Operating system: Ubuntu 21.04<br>
Architecture: x86-64</p>
<h3>Extra Info</h3>
<p>A similar command works with <code>Wasm3</code>, <code>Wasmer</code>,  Node.js (<a href="https://www.npmjs.com/package/wasm-run"><code>wasm-run</code></a>)<br>
</p>
</blockquote>



<a name="237725977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237725977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237725977">(May 06 2021 at 20:49)</a>:</h4>
<p>vshymanskyy edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833853996">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>Duplicate of #2587. Sorry didn't notice it!<br>
Is there any workaround currently?</p>
</blockquote>



<a name="237726290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237726290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237726290">(May 06 2021 at 20:51)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833856813">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>No worries at all—thank you for the report!</p>
<blockquote>
<p>Is there any workaround currently?</p>
</blockquote>
<p>I don't think there is, I'm afraid :( I <em>think</em> the solution in the other bug shouldn't be too hard to implement, but I unfortunately don't have the bandwidth to do so right now :(</p>
</blockquote>



<a name="237730758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237730758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237730758">(May 06 2021 at 21:13)</a>:</h4>
<p>peterhuene <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833870874">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>I have a fix ready that I'll put up a PR shortly for.</p>
</blockquote>



<a name="237733462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237733462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237733462">(May 06 2021 at 21:25)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-833878577">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>@vshymanskyy Can you describe how you produced the wasm file? Workarounds are one thing, but I'm also curious if there's an underlying bug in clang or wasm-ld here. Are you using any special flags, like <code>--export-dynamic</code>?</p>
</blockquote>



<a name="237774282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237774282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237774282">(May 07 2021 at 06:24)</a>:</h4>
<p>vshymanskyy <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-834101886">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>@sunfishcode it was found in the wild: <a href="https://wapm.io/package/clang">https://wapm.io/package/clang</a>  <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> </p>
</blockquote>



<a name="237774373"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232878%20command%20export%20%27_ZSt7nothrow%27%20is%20n.../near/237774373" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232878.20command.20export.20.27_ZSt7nothrow.27.20is.20n.2E.2E.2E.html#237774373">(May 07 2021 at 06:26)</a>:</h4>
<p>vshymanskyy edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2878#issuecomment-834101886">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2878">Issue #2878</a>:</p>
<blockquote>
<p>@sunfishcode it was found in the wild: <a href="https://wapm.io/package/clang">https://wapm.io/package/clang</a>  <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> <br>
The files were produced by @binji : <a href="https://github.com/binji/llvm-project/releases">https://github.com/binji/llvm-project/releases</a></p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>