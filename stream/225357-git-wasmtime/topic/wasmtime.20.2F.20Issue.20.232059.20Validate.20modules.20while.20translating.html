<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2059 Validate modules while translating · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html">wasmtime / Issue #2059 Validate modules while translating</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="204611474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204611474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204611474">(Jul 21 2020 at 22:45)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-662144630">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>I've marked this as a draft while the wasmparser changes have yet to be released.</p>
</blockquote>



<a name="204612776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204612776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204612776">(Jul 21 2020 at 23:00)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-662149198">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @bnjbvr, @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:wasm", "lightbeam", "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>bnjbvr: cranelift</li>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="204688914"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204688914" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204688914">(Jul 22 2020 at 16:24)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-662552127">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Ok the wasmparser bits are published and this should be good to go!</p>
</blockquote>



<a name="204694383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204694383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204694383">(Jul 22 2020 at 17:09)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-662575167">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="204911647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204911647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204911647">(Jul 24 2020 at 12:59)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-663525649">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>The bits to implement don't seem terribly hard, we already required most of this information anyways, so it was around. It's nice to have a proper API to make sense of it!</p>
<p>One request, though: in wasmparser, most of the trait functions return a <code>&amp;Self::Type</code> (or <code>&amp;Self::FuncType</code>, etc.), which makes it a bit hard to implement in some places. For instance, our Type representation is a plain packed u32 at the moment: the ret type being a borrow makes it hard to return a plain primitive value. Could it be a <code>Cow&lt;Self::Type&gt;</code> instead? (Unless there's a better API for this of course; my Rust knowledge is reaching its boundaries here.)</p>
<p>Because of the above issue, I haven't gone through implementing it entirely in Spidermonkey. Since I wouldn't want to block this from landing, would it make sense to allow both APIs right now, mark the former one as deprecated, and allow for implementing the new one for clients who want it?</p>
</blockquote>



<a name="204915054"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/204915054" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#204915054">(Jul 24 2020 at 13:30)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-663539348">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>(I'm being told Rust nightly has generic associated types, which would allow putting a lifetime type parameter in the <code>Type</code> trait declaration, making it possible to return something that depends on <code>&amp;'self</code> or not; this is not a viable possibility at the moment, though.)</p>
</blockquote>



<a name="205263284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/205263284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#205263284">(Jul 28 2020 at 17:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-665162380">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>After some discussion on Zulip, I think <a href="https://github.com/bytecodealliance/wasm-tools/pull/68">https://github.com/bytecodealliance/wasm-tools/pull/68</a> will help address the issues here, so I'll get that landed/published and update it here before we merge this.</p>
</blockquote>



<a name="205605525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/205605525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#205605525">(Jul 31 2020 at 15:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-667184417">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Ok I think <code>wasmparser</code> should have the necessary changes now, @bnjbvr did you want to double-check this again?</p>
</blockquote>



<a name="205611106"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/205611106" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#205611106">(Jul 31 2020 at 16:24)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-667211477">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>As agreed on Zulip, since i won't be around for some time, this should land later to give Julian/Chris an opportunity to look into Spidermonkey changes this coming week. Thanks Alex!</p>
</blockquote>



<a name="208132912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/208132912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#208132912">(Aug 26 2020 at 18:56)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-681062585">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Ok I've rebased this and further updated wasmparser to 0.62.0, which pulled in some multi-memory and memory64 bits. Multi-memory may work as-is (except for <code>memory.copy</code> between memories) but memory64 is just left as <code>unimplemented!()</code>. In any case we'll want more official support for this later, for now it's just getting things to compile.</p>
</blockquote>



<a name="208195758"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/208195758" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#208195758">(Aug 27 2020 at 09:42)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-681842211">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Thanks for the update; i'll look into using this for Spidermonkey, probably early next week.</p>
</blockquote>



<a name="210201430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/210201430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#210201430">(Sep 15 2020 at 22:50)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-693019960">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>I've done some work on the SpiderMonkey embedding of Cranelift to adapt to this change; we making progress. I rebased your patch here: <a href="https://github.com/cfallin/wasmtime/commit/d7b9a38ad3aed8ea29d855cc28d7dd0a418a41c5">commit</a></p>
<p>Patch on SM side for reference/curiosity (this is based on @bnjbvr's excellent work): on <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1655042">bug 1655042</a></p>
<p>There are a bunch of error-message regexes in unit tests that need to be updated, but we're almost there. Thanks for the patience!</p>
</blockquote>



<a name="210201447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/210201447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#210201447">(Sep 15 2020 at 22:50)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-693019960">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>I've done some work on the SpiderMonkey embedding of Cranelift to adapt to this change; we're making progress. I rebased your patch here: <a href="https://github.com/cfallin/wasmtime/commit/d7b9a38ad3aed8ea29d855cc28d7dd0a418a41c5">commit</a></p>
<p>Patch on SM side for reference/curiosity (this is based on @bnjbvr's excellent work): on <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1655042">bug 1655042</a></p>
<p>There are a bunch of error-message regexes in unit tests that need to be updated, but we're almost there. Thanks for the patience!</p>
</blockquote>



<a name="210210720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/210210720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#210210720">(Sep 16 2020 at 00:50)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-693104974">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Thanks for the update! I've gone ahead and pushed a rebased version here as well if that helps too.</p>
</blockquote>



<a name="211811656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/211811656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#211811656">(Sep 30 2020 at 19:55)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-701610779">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>I've fixed the recent merge conflicts with a rebase!</p>
</blockquote>



<a name="211816287"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/211816287" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#211816287">(Sep 30 2020 at 20:32)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-701628930">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Getting closer on my end too; FWIW I had to make one small change to fix some tests, exposing a junk-bytes-at-end condition as an error return rather than panic: <a href="https://github.com/cfallin/wasmtime/commit/51ac79a9adde9a23d2c541670d5ea8beaea6768a">commit</a> (feel free to incorporate). I just have to tackle some table/reftypes-related test failures and then SpiderMonkey will be ready for this!</p>
</blockquote>



<a name="211828514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/211828514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#211828514">(Sep 30 2020 at 21:18)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-701651879">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Oh oops, good catch! The intention was to let wasmparser's validator catch that naturally, so I pushed up a <a href="https://github.com/bytecodealliance/wasmtime/pull/2059/commits/5eab0bb7c95db3b6538f19b0580fa20647ca73a0">slightly tweaked commit</a> which should remove the panic as well.</p>
</blockquote>



<a name="212206380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/212206380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#212206380">(Oct 04 2020 at 05:08)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-703203616">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>I've gotten all tests to pass in SpiderMonkey using this validator, now! In order to do so, I locally updated the <code>wasmparser</code> dep in <code>cranelift-wasm</code> to 0.63.0; this included an update to the bytecode-operator enum so I have a local commit <a href="https://github.com/cfallin/wasmtime/commit/b89224cf74986b805181f0aee7b65abae6eeb311">here</a> on top of your two commits. (That patch-stack is rebased to current <code>main</code> as well.) I'm not sure if the update is strictly necessary, now, but I did so as I was working through some weird validation mismatches, and have now baked the new version's error messages into the unit-test updates, so it has become a requirement for that reason :-)</p>
<p>Given that, I think there isn't any further reason to hold this back -- thanks for waiting on SM to catch up!</p>
<p>(A tangential note, as hinted above -- the SpiderMonkey test suite has a whole bunch of "this wasm module should fail to compile in a way that matches this regex" tests, so we should be careful updating any error messages going forward, or at least consider the cost; I wish there were a better way (standardized error messages as per a spec?) but this is what we have for now...)</p>
</blockquote>



<a name="212239079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/212239079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#212239079">(Oct 04 2020 at 20:01)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-703308060">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<blockquote>
<p>(A tangential note, as hinted above -- the SpiderMonkey test suite has a whole bunch of "this wasm module should fail to compile in a way that matches this regex" tests, so we should be careful updating any error messages going forward, or at least consider the cost; I wish there were a better way (standardized error messages as per a spec?) but this is what we have for now...)</p>
</blockquote>
<p>The spec tests do have expected error messages and, except for a few exceptions, we match them in <code>wasmparser</code>. Does SpiderMonkey also (newly?) do this? Or am I misunderstanding which tests you're talking about?</p>
</blockquote>



<a name="212244632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/212244632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#212244632">(Oct 04 2020 at 22:33)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-703325445">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>Ah, I hadn't realized there were standard error messages. I can dig further into why SpiderMonkey doesn't hit issues with this (perhaps the harness is tweaked?) but actually all of the issues I hit were in the SpiderMonkey-specific test suite. An example <a href="https://searchfox.org/mozilla-central/rev/4352fb7b0d17c1febff9569ed311e0e42c93093e/js/src/jit-test/lib/wasm.js#62">here</a> matches on a specific "type mismatch: expression has type A but expected B" message; <code>wasmparser</code> (version 0.63) emits "type mismatch: expected Some(A), found Some(B)" and A and B are e.g. <code>I32</code>, <code>FuncRef</code> rather than <code>i32</code>, <code>funcref</code>. (Seems this is just a direct <code>Debug</code> rendering of the Rust type representation.) So I had to tweak a bunch of <code>/a/</code> regexes to <code>/(a)|(b)/</code> (because SM still has the old backends). Not ideal, but workable for now.</p>
</blockquote>



<a name="212320420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232059%20Validate%20modules%20while%20translating/near/212320420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232059.20Validate.20modules.20while.20translating.html#212320420">(Oct 05 2020 at 16:01)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#issuecomment-703727429">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/2059">Issue #2059</a>:</p>
<blockquote>
<p>"standard" is a bit of a stretch in that they're not super descriptitive, it's typically "type mismatch" for everything related to a type error and the implementation typically provides more descriptive stuff afterwards. That being said of <code>Some(...)</code> is showing up in wasmparser parser errors that's probably a bug on our end where we were too lazy to stringify something and went with <code>format!("{:?}")</code> for convenience. We'd be more than happy to update the error messages in wasmparser to be more readable, I don't think they've received too much love previously!</p>
<p>It's great to hear though that SpiderMonkey is coming along well so I'm going to carry over the approval <a href="https://github.com/bytecodealliance/wasmtime/pull/2059#pullrequestreview-453584675">from before</a> and go ahead and merge this. Thanks again for the heads up @cfallin!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>