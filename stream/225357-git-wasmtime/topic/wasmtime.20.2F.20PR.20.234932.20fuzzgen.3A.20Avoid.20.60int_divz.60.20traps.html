<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4932 fuzzgen: Avoid `int_divz` traps · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html">wasmtime / PR #4932 fuzzgen: Avoid `int_divz` traps</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="299794837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299794837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299794837">(Sep 20 2022 at 16:01)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4932">PR #4932</a> from <code>fuzz-traps</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This avoids <code>int_divz</code> traps generated by fuzzgen by doing a pass over generated code and inserting additional instructions if a particular opcode can cause a <code>int_divz</code> trap.</p>
<p>Currently we decide per function if we are going to avoid all <code>int_divz</code>'s. However I ran into something a bit unexpected. Even with one in a million inputs being allowed to trap, we still get a somewhat big amount of runs trapping (~2-3%). I'm not quite sure why this happens.</p>
<p>I suspect this is somehow related to a single input generating a bunch of runs and them all failing and inflating those numbers, but I'm not too sure.</p>
<p>I also did a sanity check run where I always inserted the <code>int_divz</code> check, and predictably got 0%.</p>
<p>Here are the benchmarks:</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;Baseline:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49977</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31759</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">183553</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4114</span><span class="o">/</span><span class="mi">8186</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">29</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">979</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">2926</span><span class="o">/</span><span class="mi">316258</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">26348</span><span class="w"> </span><span class="p">(</span><span class="mf">52.7</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">656246</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">539632</span><span class="w"> </span><span class="p">(</span><span class="mf">82.2</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">155</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">116451</span><span class="w"> </span><span class="p">(</span><span class="mf">17.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49982</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">32009</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184999</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">3984</span><span class="o">/</span><span class="mi">8155</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">25</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">975</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">5077</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25940</span><span class="w"> </span><span class="p">(</span><span class="mf">51.9</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">660751</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">639007</span><span class="w"> </span><span class="p">(</span><span class="mf">96.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">125</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">21619</span><span class="w"> </span><span class="p">(</span><span class="mf">3.3</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR with 100% insertion rate:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49907</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31943</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184612</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4012</span><span class="o">/</span><span class="mi">8336</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">24</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">1060</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">687</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">ChangeByte</span><span class="o">-</span><span class="n">ChangeASCIIInt</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25911</span><span class="w"> </span><span class="p">(</span><span class="mf">51.8</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834983</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834813</span><span class="w"> </span><span class="p">(</span><span class="mf">100.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">170</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>CC: @jameysharp </p>
</blockquote>



<a name="299794882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299794882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299794882">(Sep 20 2022 at 16:01)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4932">PR #4932</a> from <code>fuzz-traps</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This avoids <code>int_divz</code> traps generated by fuzzgen by doing a pass over generated code and inserting additional instructions if a particular opcode can cause a <code>int_divz</code> trap.</p>
<p>Currently we decide per function if we are going to avoid all <code>int_divz</code>'s. However I ran into something a bit unexpected. Even with one in a million inputs being allowed to trap, we still get a somewhat big amount of runs trapping (~2-3%). I'm not quite sure why this happens (if anyone has any ideas, let me know!).</p>
<p>I suspect this is somehow related to a single input generating a bunch of runs and them all failing and inflating those numbers, but I'm not too sure.</p>
<p>I also did a sanity check run where I always inserted the <code>int_divz</code> check, and predictably got 0%.</p>
<p>Here are the benchmarks:</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;Baseline:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49977</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31759</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">183553</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4114</span><span class="o">/</span><span class="mi">8186</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">29</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">979</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">2926</span><span class="o">/</span><span class="mi">316258</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">26348</span><span class="w"> </span><span class="p">(</span><span class="mf">52.7</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">656246</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">539632</span><span class="w"> </span><span class="p">(</span><span class="mf">82.2</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">155</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">116451</span><span class="w"> </span><span class="p">(</span><span class="mf">17.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49982</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">32009</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184999</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">3984</span><span class="o">/</span><span class="mi">8155</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">25</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">975</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">5077</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25940</span><span class="w"> </span><span class="p">(</span><span class="mf">51.9</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">660751</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">639007</span><span class="w"> </span><span class="p">(</span><span class="mf">96.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">125</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">21619</span><span class="w"> </span><span class="p">(</span><span class="mf">3.3</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR with 100% insertion rate:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49907</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31943</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184612</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4012</span><span class="o">/</span><span class="mi">8336</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">24</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">1060</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">687</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">ChangeByte</span><span class="o">-</span><span class="n">ChangeASCIIInt</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25911</span><span class="w"> </span><span class="p">(</span><span class="mf">51.8</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834983</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834813</span><span class="w"> </span><span class="p">(</span><span class="mf">100.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">170</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>CC: @jameysharp </p>
</blockquote>



<a name="299807252"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299807252" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299807252">(Sep 20 2022 at 17:05)</a>:</h4>
<p>afonso360 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4932">PR #4932</a> from <code>fuzz-traps</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This avoids <code>int_divz</code> traps generated by fuzzgen by doing a pass over generated code and inserting additional instructions if a particular opcode can cause a <code>int_divz</code> trap.</p>
<p>Currently we decide per function if we are going to avoid all <code>int_divz</code>'s. However I ran into something a bit unexpected. Even with one in a million inputs being allowed to trap, we still get a somewhat big amount of runs trapping (~2-3%). I'm not quite sure why this happens (if anyone has any ideas, let me know!).</p>
<p>I suspect this is somehow related to a single input generating a bunch of runs and them all failing and inflating those numbers, or maybe the fuzzer really likes to explore the inputs where we allow <code>int_divz</code>'s? I'm not sure.</p>
<p>I also did a sanity check run where I always inserted the <code>int_divz</code> check, and predictably got 0%.</p>
<p>Here are the benchmarks:</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;Baseline:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49977</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31759</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">183553</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4114</span><span class="o">/</span><span class="mi">8186</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">29</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">979</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">2926</span><span class="o">/</span><span class="mi">316258</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">EraseBytes</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">26348</span><span class="w"> </span><span class="p">(</span><span class="mf">52.7</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">656246</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">539632</span><span class="w"> </span><span class="p">(</span><span class="mf">82.2</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">155</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">116451</span><span class="w"> </span><span class="p">(</span><span class="mf">17.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49982</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">32009</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184999</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">3984</span><span class="o">/</span><span class="mi">8155</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">25</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">975</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">5077</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">1</span><span class="w"> </span><span class="n">CopyPart</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25940</span><span class="w"> </span><span class="p">(</span><span class="mf">51.9</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">660751</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">639007</span><span class="w"> </span><span class="p">(</span><span class="mf">96.7</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">125</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">21619</span><span class="w"> </span><span class="p">(</span><span class="mf">3.3</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>&lt;details&gt;<br>
&lt;summary&gt;&lt;h3&gt;This PR with 100% insertion rate:&lt;/h3&gt;&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>#<span class="mi">49907</span><span class="w">  </span><span class="n">NEW</span><span class="w">    </span><span class="n">cov</span>: <span class="mi">31943</span><span class="w"> </span><span class="n">ft</span>: <span class="mi">184612</span><span class="w"> </span><span class="n">corp</span>: <span class="mi">4012</span><span class="o">/</span><span class="mi">8336</span><span class="n">Kb</span><span class="w"> </span><span class="n">lim</span>: <span class="mi">393599</span><span class="w"> </span><span class="n">exec</span><span class="o">/</span><span class="n">s</span>: <span class="mi">24</span><span class="w"> </span><span class="n">rss</span>: <span class="mi">1060</span><span class="n">Mb</span><span class="w"> </span><span class="n">L</span>: <span class="mi">687</span><span class="o">/</span><span class="mi">393581</span><span class="w"> </span><span class="n">MS</span>: <span class="mi">2</span><span class="w"> </span><span class="n">ChangeByte</span><span class="o">-</span><span class="n">ChangeASCIIInt</span><span class="o">-</span><span class="w"></span>
<span class="o">==</span><span class="w"> </span><span class="n">FuzzGen</span><span class="w"> </span><span class="n">Statistics</span><span class="w">  </span><span class="o">====================</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">50000</span><span class="w"></span>
<span class="n">Valid</span><span class="w"> </span><span class="n">Inputs</span>: <span class="mi">25911</span><span class="w"> </span><span class="p">(</span><span class="mf">51.8</span><span class="o">%</span><span class="p">)</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834983</span><span class="w"></span>
<span class="n">Successful</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">834813</span><span class="w"> </span><span class="p">(</span><span class="mf">100.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Timed</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">Runs</span>: <span class="mi">170</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="n">Traps</span>:
        <span class="nc">resumable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">table_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">interrupt</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_sig</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">icall_null</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">debug</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_misaligned</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">bad_toint</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">stk_ovf</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">heap_oob</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">int_divz</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">user</span><span class="w"> </span><span class="n">code</span>: <span class="nc">unreachable</span>: <span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">Runs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
<p>CC: @jameysharp </p>
</blockquote>



<a name="299839070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299839070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299839070">(Sep 20 2022 at 20:03)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4932#pullrequestreview-1114400671">PR review</a>.</p>



<a name="299839071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299839071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299839071">(Sep 20 2022 at 20:03)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4932#discussion_r975762764">PR review comment</a>:</p>
<blockquote>
<p>There's nothing wrong with the way you've written this, but I like this alternative:</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    matches!(opcode, Opcode::Sdiv | Opcode::Udiv | Opcode::Srem | Opcode::Urem)
</code></pre></div><br>
</p>
</blockquote>



<a name="299839072"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299839072" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299839072">(Sep 20 2022 at 20:03)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4932#pullrequestreview-1114400671">PR review</a>.</p>



<a name="299890087"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299890087" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299890087">(Sep 21 2022 at 06:15)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4932#pullrequestreview-1114810755">PR review</a>.</p>



<a name="299890088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299890088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299890088">(Sep 21 2022 at 06:15)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4932#discussion_r976073896">PR review comment</a>:</p>
<blockquote>
<p>I do like that version better as well!</p>
</blockquote>



<a name="299890646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/299890646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#299890646">(Sep 21 2022 at 06:21)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4932">PR #4932</a> from <code>fuzz-traps</code> to <code>main</code>.</p>



<a name="300414627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234932%20fuzzgen%3A%20Avoid%20%60int_divz%60%20traps/near/300414627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234932.20fuzzgen.3A.20Avoid.20.60int_divz.60.20traps.html#300414627">(Sep 23 2022 at 17:19)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4932">PR #4932</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>