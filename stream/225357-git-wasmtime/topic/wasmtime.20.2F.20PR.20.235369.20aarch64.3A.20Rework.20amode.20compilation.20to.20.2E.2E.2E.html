<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5369 aarch64: Rework amode compilation to ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html">wasmtime / PR #5369 aarch64: Rework amode compilation to ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="313397528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313397528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313397528">(Dec 01 2022 at 23:15)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a> from <code>trevor/ssa-aarch64-amode</code> to <code>main</code>:</p>
<blockquote>
<p>Rework the compilation of amodes in the aarch64 backend to stop reusing registers and instead generate fresh virtual registers for intermediates. This resolves some SSA checker violations with the aarch64 backend, and gets us closer to having cranelift produce SSA code in general.<br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="313397991"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313397991" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313397991">(Dec 01 2022 at 23:19)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a> from <code>trevor/ssa-aarch64-amode</code> to <code>main</code>:</p>
<blockquote>
<p>Rework the compilation of amodes in the aarch64 backend to stop reusing registers and instead generate fresh virtual registers for intermediates. This resolves some SSA checker violations with the aarch64 backend, and as a nice side-effect removes some unnecessary <code>mov</code>s in the generated code.<br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="313398430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313398430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313398430">(Dec 01 2022 at 23:23)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a>.</p>



<a name="313398583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313398583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313398583">(Dec 01 2022 at 23:24)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a>.</p>



<a name="313404012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313404012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313404012">(Dec 02 2022 at 00:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5369#pullrequestreview-1201827517">PR review</a>.</p>



<a name="313404014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313404014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313404014">(Dec 02 2022 at 00:16)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/5369#discussion_r1037676202">PR review comment</a>:</p>
<blockquote>
<p>The move is slightly awkward here; is there a way we could rewrite the <code>AMode</code> we created above to use <code>init</code> directly? (I know this is kind of awkward because we need to do the above match first to get the <code>reg</code> addend, but perhaps we could have a <code>.replace_first_reg(..)</code> on the <code>AMode</code> or something like that.)</p>
</blockquote>



<a name="313404015"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313404015" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313404015">(Dec 02 2022 at 00:16)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5369#pullrequestreview-1201827517">PR review</a>.</p>



<a name="313407166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313407166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313407166">(Dec 02 2022 at 00:42)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a> from <code>trevor/ssa-aarch64-amode</code> to <code>main</code>.</p>



<a name="313407442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313407442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313407442">(Dec 02 2022 at 00:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5369#pullrequestreview-1201845337">PR review</a>.</p>



<a name="313408189"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313408189" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313408189">(Dec 02 2022 at 00:52)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a> from <code>trevor/ssa-aarch64-amode</code> to <code>main</code>.</p>



<a name="313408380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313408380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313408380">(Dec 02 2022 at 00:54)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a> from <code>trevor/ssa-aarch64-amode</code> to <code>main</code>.</p>



<a name="313408556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313408556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313408556">(Dec 02 2022 at 00:56)</a>:</h4>
<p>elliottt has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a>.</p>



<a name="313410949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235369%20aarch64%3A%20Rework%20amode%20compilation%20to%20.../near/313410949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235369.20aarch64.3A.20Rework.20amode.20compilation.20to.20.2E.2E.2E.html#313410949">(Dec 02 2022 at 01:23)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5369">PR #5369</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>