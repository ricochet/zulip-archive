<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1474 Fuchsia port · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html">wasmtime / PR #1474 Fuchsia port</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="193109917"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193109917" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193109917">(Apr 06 2020 at 22:21)</a>:</h4>
<p>benbrittain opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1474" title="https://github.com/bytecodealliance/wasmtime/pull/1474">PR #1474</a> from <code>master</code> to <code>master</code>:</p>
<blockquote>
<p>This is an MVP port for Fuchsia. </p>
<p>There are at least two things that need to be cleaned up in the future:</p>
<ul>
<li>Currently we spawn one exception handling thread per runtime thread. In the future we'll want to <code>zx_object_wait_async</code>/ports and register with a global exception handling thread</li>
<li>The convention for registering a fault handler</li>
</ul>
<p>I know that these syscalls are super unfamiliar so I'm happy to provide context. I've also unfortunately chosen to use the lowest level bindings since they are our most stable interface for out-of-tree Rust code.</p>
<p>cc/ @leecam</p>
</blockquote>



<a name="193120957"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120957" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120957">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-388701402" title="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-388701402">PR Review</a>.</p>



<a name="193120958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120958">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-388701402" title="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-388701402">PR Review</a>.</p>



<a name="193120959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120959">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461253" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461253">PR Review Comment</a>:</p>
<blockquote>
<p>To avoid the extra <code>not(...)</code> could this list fuchsia first with <code>// no extensions at this time</code></p>
</blockquote>



<a name="193120960"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120960" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120960">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461455" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461455">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW this is fine to leave out, this is intended for the API extensions in the <code>wasmtime</code> crate but those were left out, so this could be a noop on fuchsia.</p>
</blockquote>



<a name="193120961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120961">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461606" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461606">PR Review Comment</a>:</p>
<blockquote>
<p>Mind listing fuchsia first to avoid the extra <code>not(..)</code>?</p>
</blockquote>



<a name="193120962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120962">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461939" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404461939">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW I think this isn't quite right, this is actually only one exception handling thread for the first thread, but no other threads get exception handlers set.</p>
</blockquote>



<a name="193120963"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120963" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120963">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462000" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462000">PR Review Comment</a>:</p>
<blockquote>
<p>Some extra tabs sneaking in here?</p>
</blockquote>



<a name="193120964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120964">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462069" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462069">PR Review Comment</a>:</p>
<blockquote>
<p>Mind throwing this into the general <code>cfg_if</code> block above? </p>
</blockquote>



<a name="193120965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120965">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462690" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462690">PR Review Comment</a>:</p>
<blockquote>
<p>You may want to leave a TODO here because this won't work in stack overflow situations, only for normal faults. (this is why we use sigaltstack on unix)</p>
</blockquote>



<a name="193120966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120966">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462255" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404462255">PR Review Comment</a>:</p>
<blockquote>
<p>This can also be done with <code>fuchsia::fault_handler as usize as *const ()</code> (no <code>transmute</code> necessary)</p>
</blockquote>



<a name="193120967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120967">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404464238" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404464238">PR Review Comment</a>:</p>
<blockquote>
<p>I think there may need to be some special tidbits when resuming the original thread here? I think you probably want to resume the instruction itself rather than one byte past, and additionally I think something here needs to clean up the stack allocation for the context info, but I'm not sure that anything currently does?</p>
</blockquote>



<a name="193120968"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120968" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120968">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404463213" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404463213">PR Review Comment</a>:</p>
<blockquote>
<p>Should this perhaps have a TODO to do something with <code>handled</code>? If it's <code>false</code> this may infinitely try to handle the fault here?</p>
</blockquote>



<a name="193120969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193120969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193120969">(Apr 07 2020 at 00:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404474001" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404474001">PR Review Comment</a>:</p>
<blockquote>
<p>Thinking some more about this, is there a syscall or a standard method for "resume this thread given this thread context?" Because you basically want to always resume the exact same instruction in the exact same context (all registers preserved which currently aren't I think), but sometimes you'll unregister the trap handling logic.</p>
</blockquote>



<a name="193172689"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193172689" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193172689">(Apr 07 2020 at 11:32)</a>:</h4>
<p>benbrittain submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-389027566" title="https://github.com/bytecodealliance/wasmtime/pull/1474#pullrequestreview-389027566">PR Review</a>.</p>



<a name="193172690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/193172690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#193172690">(Apr 07 2020 at 11:32)</a>:</h4>
<p>benbrittain created <a href="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404738497" title="https://github.com/bytecodealliance/wasmtime/pull/1474#discussion_r404738497">PR Review Comment</a>:</p>
<blockquote>
<p>I really wish Fuchsia wasn't marked as a unix </p>
</blockquote>



<a name="195608354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231474%20Fuchsia%20port/near/195608354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231474.20Fuchsia.20port.html#195608354">(Apr 28 2020 at 18:40)</a>:</h4>
<p>benbrittain closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/1474" title="https://github.com/bytecodealliance/wasmtime/pull/1474">PR #1474</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>