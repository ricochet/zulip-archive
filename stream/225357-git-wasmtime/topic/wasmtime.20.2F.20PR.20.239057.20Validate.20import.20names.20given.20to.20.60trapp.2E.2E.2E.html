<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9057 Validate import names given to `trapp... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html">wasmtime / PR #9057 Validate import names given to `trapp...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="455720723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455720723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455720723">(Aug 01 2024 at 18:07)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a> from <code>elliottt:trevor/validate-trappable-imports</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>It's easy to accidentally use the generated name when passing names to the <code>trappable_imports</code> field of the <code>bindgen!</code> macro, yielding generated bindings that don't use the expected <code>trappable_error_type</code>. This PR adds some validation, ensuring that arguments to <code>trappable_imports</code> do parse as wit identifiers.</p>
<p>This is slightly more complicated than calling <code>wit_parser::validate_id</code>, on each entry of the <code>trappable_imports</code> list, as those entries can also refer to methods and constructors. As such, each part is validated in those cases, ensuring that the resource and method parts are valid wit identifiers.</p>
<p>It doesn't appear that we have negative tests for wasmtime-component-macro, but I'm happ to add some if I've missed something there.<br>
</p>
</blockquote>



<a name="455720727"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455720727" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455720727">(Aug 01 2024 at 18:07)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455720728"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455720728" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455720728">(Aug 01 2024 at 18:07)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455720757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455720757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455720757">(Aug 01 2024 at 18:07)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455732711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455732711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455732711">(Aug 01 2024 at 18:58)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<p>It's easy to accidentally use the generated name when passing names to the <code>trappable_imports</code> field of the <code>bindgen!</code> macro, yielding generated bindings that don't use the expected <code>trappable_error_type</code>. This PR adds some validation, ensuring that arguments to <code>trappable_imports</code> do parse as wit identifiers.</p>
<p>This is slightly more complicated than calling <code>wit_parser::validate_id</code>, on each entry of the <code>trappable_imports</code> list, as those entries can also refer to methods and constructors. As such, each part is validated in those cases, ensuring that the resource and method parts are valid wit identifiers.</p>
<p>It doesn't appear that we have negative tests for wasmtime-component-macro, but I'm happy to add some if I've missed something there.<br>
</p>
</blockquote>



<a name="455732730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455732730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455732730">(Aug 01 2024 at 18:58)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<p>It's easy to accidentally use the generated name when passing names to the <code>trappable_imports</code> field of the <code>bindgen!</code> macro, yielding generated bindings that don't use the expected <code>trappable_error_type</code>. This PR adds some validation, ensuring that arguments to <code>trappable_imports</code> do parse as wit identifiers.</p>
<p>This is slightly more complicated than calling <code>wit_parser::validate_id</code>, on each entry of the <code>trappable_imports</code> list, as those entries can also refer to methods and constructors. As such, each part is validated in those cases, ensuring that the resource and method parts are valid wit identifiers.</p>
<p>It doesn't appear that we have negative tests for wasmtime-component-macro, but I'm happy to add them if I've missed something there.<br>
</p>
</blockquote>



<a name="455741513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455741513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455741513">(Aug 01 2024 at 19:48)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#issuecomment-2263851967">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<p>I realize it'd be more difficult, but would you be up for seeing how to validate that all the entries in this list are used in addition to them being valid? Or rather validation wouldn't be required if they're validated to be used. IIRC we already require that all <code>with</code> entries are used so it might be possible to reuse logic there perhaps?</p>
<p>I ask this because it feels like the most robust solution here in terms of ensuring we actually use all of the input and helping to catch typos/misconfiguration.</p>
<p>Also as for negative tests you're right in that we don't have any. They're unfortunately difficult to add because rustc's output changes over time, but we should probably look in to adding them at some point in the future.</p>
</blockquote>



<a name="455759021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455759021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455759021">(Aug 01 2024 at 21:23)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#issuecomment-2264028235">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<blockquote>
<p>I realize it'd be more difficult, but would you be up for seeing how to validate that all the entries in this list are used in addition to them being valid? Or rather validation wouldn't be required if they're validated to be used. IIRC we already require that all <code>with</code> entries are used so it might be possible to reuse logic there perhaps?</p>
</blockquote>
<p>Yep, I'll have a look at doing that instead <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="455769616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455769616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455769616">(Aug 01 2024 at 22:48)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455771354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455771354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455771354">(Aug 01 2024 at 22:57)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#issuecomment-2264157937">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<p>I've reworked it to track the import names that get used, and check that all names specified in the list initially get used. If none are used, a similar error to the handling of the <code>with</code> clause will be reported.</p>
<p>One wrinkle here is that I had to mark names as used if <code>can_trap</code> returned true, rather than only if it was a name that had a trappable return type. With the more strict interpretation the tests fail, as we test cases where names mentioned in the list don't have any return type. I'm not sure that requiring names in <code>trappable_imports</code> have a trappable error is useful, given that names can overlap between different interfaces.</p>
</blockquote>



<a name="455941079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455941079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455941079">(Aug 02 2024 at 14:02)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#pullrequestreview-2215660542">PR review</a>:</p>
<blockquote>
<p>Looks reasonable to me!</p>
</blockquote>



<a name="455941082"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455941082" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455941082">(Aug 02 2024 at 14:02)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#pullrequestreview-2215660542">PR review</a>:</p>
<blockquote>
<p>Looks reasonable to me!</p>
</blockquote>



<a name="455941083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455941083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455941083">(Aug 02 2024 at 14:02)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#discussion_r1701893494">PR review comment</a>:</p>
<blockquote>
<p>Could this be added to <code>special_case_trappable_error</code>? (perhaps by updating that to take <code>&amp;Function</code>)?</p>
</blockquote>



<a name="455941084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455941084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455941084">(Aug 02 2024 at 14:02)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#discussion_r1701892468">PR review comment</a>:</p>
<blockquote>
<p>Mind updating these docs?</p>
</blockquote>



<a name="455965153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455965153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455965153">(Aug 02 2024 at 15:27)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455972450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455972450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455972450">(Aug 02 2024 at 15:56)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<a name="455972599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455972599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455972599">(Aug 02 2024 at 15:57)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>:</p>
<blockquote>
<p>It's easy to accidentally use the generated name when passing names to the <code>trappable_imports</code> field of the <code>bindgen!</code> macro, yielding generated bindings that don't use the expected <code>trappable_error_type</code>. This PR adds some validation, ensuring that arguments to <code>trappable_imports</code> are used during binding generation and raising an error if any are ignored.</p>
<p>It doesn't appear that we have negative tests for wasmtime-component-macro, but I'm happy to add them if I've missed something there.<br>
</p>
</blockquote>



<a name="455975776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455975776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455975776">(Aug 02 2024 at 16:12)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9057#pullrequestreview-2215955706">PR review</a>.</p>



<a name="455979495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239057%20Validate%20import%20names%20given%20to%20%60trapp.../near/455979495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239057.20Validate.20import.20names.20given.20to.20.60trapp.2E.2E.2E.html#455979495">(Aug 02 2024 at 16:27)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9057">PR #9057</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>