<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3687 Support vtune profiling of trampol... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html">wasmtime / issue #3687 Support vtune profiling of trampol...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="267910976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/267910976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#267910976">(Jan 13 2022 at 18:32)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1012400867">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="267912043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/267912043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#267912043">(Jan 13 2022 at 18:41)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1012407614">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<p>Oh sorry and to clarify, you're right that <code>module.trampolines()</code> is trampolines for everything exported from that module. This is basically a trampoline-per-type-signature for any functions which are "possibly exported", including all those in tables, exported functions, etc.</p>
<p>The <code>trampoline_load()</code> method is only called for trampolines dynamically created through the <code>Func::new</code> API which generates a one-off trampoline specifically for the signature of the function created. Unless <code>Func::new</code> is called somehow (which it ideally shouldn't be because <code>Func::wrap</code> is a faster embedding) then <code>trampoline_load()</code> won't be invoked.</p>
</blockquote>



<a name="268291589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/268291589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#268291589">(Jan 17 2022 at 16:28)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1014714684">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<p>Updated! Also refactored a bit how the loading of dynamic trampolines is done, so that there's less code duplication with the jitdump_linux; if that approach looks good to you too, I could go ahead and do the same for single functions and trampolines for exported signatures?</p>
</blockquote>



<a name="268405506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/268405506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#268405506">(Jan 18 2022 at 15:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1015511529">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<p>Looks great to me, thanks! Did you want to do that refactoring as a follow-up or attach here? (either way is fine by me)</p>
</blockquote>



<a name="268545819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/268545819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#268545819">(Jan 19 2022 at 14:21)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1016512631">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<blockquote>
<p>Did you want to do that refactoring as a follow-up or attach here? (either way is fine by me)</p>
</blockquote>
<p>Can do that here! I wanted to make sure this is something we wanted first <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="268552809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/268552809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#268552809">(Jan 19 2022 at 15:09)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1016561737">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<p>Ended up giving up on the refactoring (instead of loading a whole module at once, load function per function), because:</p>
<ul>
<li>if the profiling agent is the null one, that would have done a bit more work that ends up being wasted (computing the function's pointer, address, default function debug display name, etc.).</li>
<li>this introduced a bit of infra to generate the default function debug display name on demand</li>
<li>the vtune profiling agent required a new <code>ProfilingAgent</code> trait method to know that we started loading a new module (so it would know what module display name to generate).</li>
</ul>
<p>Anyhow, this added more lines of code than there was before, and made the code messier overall, so not a win in my opinion. Spotted a data structure that could be removed, though!</p>
</blockquote>



<a name="268558857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233687%20Support%20vtune%20profiling%20of%20trampol.../near/268558857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233687.20Support.20vtune.20profiling.20of.20trampol.2E.2E.2E.html#268558857">(Jan 19 2022 at 15:49)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3687#issuecomment-1016602158">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3687">issue #3687</a>:</p>
<blockquote>
<p>Seems reasonable to me!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>