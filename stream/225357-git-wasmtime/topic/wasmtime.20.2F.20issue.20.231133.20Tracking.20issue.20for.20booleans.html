<html>
<head><meta charset="utf-8"><title>wasmtime / issue #1133 Tracking issue for booleans · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html">wasmtime / issue #1133 Tracking issue for booleans</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="255499262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/255499262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#255499262">(Sep 30 2021 at 00:42)</a>:</h4>
<p>StackDoubleFlow <a href="https://github.com/bytecodealliance/wasmtime/issues/1133#issuecomment-930651382">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>Is the process complete? <code>bnot</code> now panics on an <code>unimplemented!</code> during lowering.</p>
</blockquote>



<a name="255505166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/255505166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#255505166">(Sep 30 2021 at 02:01)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1133#issuecomment-930687590">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>Yes, we're currently using the new backend. It looks like the lowering for <code>bnot</code> for scalar boolean types <a href="https://github.com/bytecodealliance/wasmtime/blob/e989caf33733ae79416ca3573496268aaf23c64b/cranelift/codegen/src/isa/aarch64/lower_inst.rs#L672-L676">exists for aarch64</a> but <a href="https://github.com/bytecodealliance/wasmtime/blob/e989caf33733ae79416ca3573496268aaf23c64b/cranelift/codegen/src/isa/x64/lower.rs#L2375">not for x86-64</a>; a PR to add this on x86-64 would be a welcome contribution and a good first bug if anyone wants to try this!</p>
<p>(We still have some holes in supported-operand-types coverage for CLIF that is outside of what the Wasm frontend generates, and the Wasm frontend doesn't use Cranelift-level bools, so that's probably why this still isn't implemented. Sorry about that!)</p>
</blockquote>



<a name="255794417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/255794417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#255794417">(Oct 01 2021 at 19:19)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/1133#issuecomment-932490727">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>And looking at the other items in this issue - currently we do not allow loads and stores of scalar booleans; this has been discussed at length in #3205, together with other aspects of the boolean types.</p>
</blockquote>



<a name="265918517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/265918517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#265918517">(Dec 23 2021 at 13:57)</a>:</h4>
<p>pnevyk <a href="https://github.com/bytecodealliance/wasmtime/issues/1133#issuecomment-1000322799">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>It seems that <code>bnot</code> no longer panics on <code>x86_64</code> target since #3592 . I tried to allow <code>x86_64</code> target in this <a href="https://github.com/bytecodealliance/wasmtime/blob/a646f685538c1d138d8e553133325d8af72300a9/cranelift/filetests/filetests/runtests/bitops.clif#L5">runtest</a> and it does not fail, while it fails before the PR.</p>
<p>Not sure if that was intentional given the ongoing (?) discussion on representation of <code>b1</code>.</p>
</blockquote>



<a name="281232354"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/281232354" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#281232354">(May 04 2022 at 23:02)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/1133#issuecomment-1118010513">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>Indeed (re: above), bools are fairly well supported now; I think we can probably close this tracking issue. The broader issue of what we want to do about bool representations in #3205 should continue regardless, as we still need to pin down some details of what we want at the CLIF-semantics level.</p>
</blockquote>



<a name="281232355"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%231133%20Tracking%20issue%20for%20booleans/near/281232355" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.231133.20Tracking.20issue.20for.20booleans.html#281232355">(May 04 2022 at 23:02)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1133">issue #1133</a>:</p>
<blockquote>
<p>See vaguely <a href="https://github.com/bytecodealliance/wasmtime/issues/1110">bytecodealliance/wasmtime#1110</a>, <a href="https://github.com/bytecodealliance/wasmtime/issues/1045">bytecodealliance/wasmtime#1045</a>, and <a href="https://github.com/jyn514/rcc/issues/92">https://github.com/jyn514/rcc/issues/92</a>. An easy way to do this might be to convert from bool -&gt; int -&gt; bool and back as suggested in <a href="https://github.com/CraneStation/cranelift/issues/922#issuecomment-523931097">https://github.com/CraneStation/cranelift/issues/922#issuecomment-523931097</a>.</p>
<ul>
<li>[ ] bnot<br>
Only occurs if you return the value (maybe would also happen for function calls?)</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="nc">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">ebb0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp_imm</span><span class="w"> </span><span class="n">ne</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bnot</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bint</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v3</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">codegen</span><span class="w"> </span><span class="n">error</span>: <span class="nc">Compilation</span><span class="w"> </span><span class="n">error</span>: <span class="nc">Verifier</span><span class="w"> </span><span class="n">errors</span>:

<span class="o">-</span><span class="w"> </span><span class="n">inst2</span>: <span class="nc">v2</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="n">GPR</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ghost</span><span class="w"> </span><span class="n">instruction</span><span class="w"></span>
</code></pre></div>
<ul>
<li>[ ] bnz<br>
Note: this only occurs when the values are <code>i8</code>, not for <code>i32</code>, and it occurs during codegen, not verification.</li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="n">ebb0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i8</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icmp</span><span class="w"> </span><span class="n">ne</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="n">brz</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">ebb1</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>

<span class="n">ebb1</span>:
    <span class="nc">return</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">codegen</span><span class="w"> </span><span class="n">error</span>: <span class="nc">Compilation</span><span class="w"> </span><span class="n">error</span>: <span class="nc">Verifier</span><span class="w"> </span><span class="n">errors</span>:

<span class="o">-</span><span class="w"> </span><span class="n">inst3</span>: <span class="nc">Branch</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">encoding</span><span class="w"></span>
</code></pre></div>
<ul>
<li>[ ] <code>store</code></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="nc">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="n">ebb0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bconst</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">ss0</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">fatal</span>: <span class="o">-</span><span class="w"> </span><span class="n">inst2</span>: <span class="nc">has</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">controlling</span><span class="w"> </span><span class="k">type</span> <span class="nc">b1</span><span class="w"></span>
</code></pre></div>
<ul>
<li>[ ] <code>bor</code></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="nc">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ss0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explicit_slot</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="n">ebb0</span>:
    <span class="nc">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack_addr</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">ss0</span><span class="w"></span>
<span class="w">    </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bconst</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">    </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load</span><span class="p">.</span><span class="n">b1</span><span class="w"> </span><span class="n">v0</span><span class="w"></span>
<span class="w">    </span><span class="n">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bor</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="w"></span>
<span class="w">    </span><span class="n">store</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="w"></span>
<span class="w">    </span><span class="n">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i32</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v4</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">fatal</span>: <span class="o">-</span><span class="w"> </span><span class="n">inst2</span>: <span class="nc">has</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">controlling</span><span class="w"> </span><span class="k">type</span> <span class="nc">b1</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="n">inst4</span>: <span class="nc">has</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">controlling</span><span class="w"> </span><span class="k">type</span> <span class="nc">b1</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>