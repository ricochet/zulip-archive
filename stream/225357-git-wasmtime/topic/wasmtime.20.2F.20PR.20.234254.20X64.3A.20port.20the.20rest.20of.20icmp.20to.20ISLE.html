<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4254 X64: port the rest of icmp to ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html">wasmtime / PR #4254 X64: port the rest of icmp to ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="285624808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285624808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285624808">(Jun 10 2022 at 03:04)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a> from <code>trevor/icmp-isle-port</code> to <code>main</code>:</p>
<blockquote>
<ul>
<li>Finish migrating icmp to ISLE</li>
<li>Update test output</li>
</ul>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="285629892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285629892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285629892">(Jun 10 2022 at 04:31)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a> as ready for review.</p>



<a name="285633860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285633860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285633860">(Jun 10 2022 at 05:47)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a> from <code>trevor/icmp-isle-port</code> to <code>main</code>.</p>



<a name="285634196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285634196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285634196">(Jun 10 2022 at 05:53)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r894174810">PR review comment</a>:</p>
<blockquote>
<p>Is the <code>setnz</code> in the original necessary here; it seems like <code>andq</code> with an immediate <code>$1</code> should be enough?</p>
</blockquote>



<a name="285634197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285634197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285634197">(Jun 10 2022 at 05:53)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1002276331">PR review</a>.</p>



<a name="285634229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285634229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285634229">(Jun 10 2022 at 05:53)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r894174810">PR review comment</a>.</p>



<a name="285971516"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285971516" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285971516">(Jun 13 2022 at 18:40)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a>.</p>



<a name="285974632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974632">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1004791828">PR review</a>.</p>



<a name="285974633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974633">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896037387">PR review comment</a>:</p>
<blockquote>
<p>Could we add a comment here describing what <code>without_eq</code> means (probably just summarizing the doc comment for <code>IntCC::without_equal()</code> and/or pointing to it)?</p>
</blockquote>



<a name="285974634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974634">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896041666">PR review comment</a>:</p>
<blockquote>
<p>I am wondering now if this <code>and</code> is necessary: it's masking high bits off the result of the <code>or</code> for <code>res</code> above, but in the end this is a combination of <code>setcc</code> results, which are all 0/1...</p>
</blockquote>



<a name="285974635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974635">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1004791828">PR review</a>.</p>



<a name="285974636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974636">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896043378">PR review comment</a>:</p>
<blockquote>
<p><code>emit_cmp</code> remains used because of the branch cases below, right?</p>
<p>It's worth thinking a bit about how we're going to factor this apart so branches can use the <code>icmp</code> logic as well (perhaps it becomes a helper that returns "result in rflags with this CC if possible, otherwise this 0/1 bool in register"), but that's not strictly necessary for this PR. If you're looking for a next thing to do, sketching out the conditional branch lowering (s390x already uses ISLE for this, as a reference point) would be good while this is in your cache :-)</p>
</blockquote>



<a name="285974637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974637">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896037694">PR review comment</a>:</p>
<blockquote>
<p>Likewise here, a quick summary or pointer would be helpful.</p>
</blockquote>



<a name="285974639"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285974639" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285974639">(Jun 13 2022 at 19:04)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896040777">PR review comment</a>:</p>
<blockquote>
<p>Indeed, it seems redundant. I suspect it might have been an artifact of lowering this in separate "generate the flags" and "use in <code>trueif</code>, <code>brif</code>, ..." halves, where the <code>and</code> generates flags (and also incidentally produces the 0/1 output directly).</p>
</blockquote>



<a name="285980947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285980947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285980947">(Jun 13 2022 at 19:53)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896081257">PR review comment</a>:</p>
<blockquote>
<p>Great point! I'll experiment with returning the result of the <code>or</code> instead :)</p>
</blockquote>



<a name="285980948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285980948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285980948">(Jun 13 2022 at 19:53)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1004856030">PR review</a>.</p>



<a name="285984422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285984422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285984422">(Jun 13 2022 at 20:20)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#discussion_r896101270">PR review comment</a>:</p>
<blockquote>
<p>As we discussed in a DM, as the <code>setcc</code> instructions only set the lowest byte and leave the upper 56 bits of the register preserved, the and will be necessary.</p>
</blockquote>



<a name="285984423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285984423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285984423">(Jun 13 2022 at 20:20)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1004884696">PR review</a>.</p>



<a name="285984448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285984448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285984448">(Jun 13 2022 at 20:20)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a> from <code>trevor/icmp-isle-port</code> to <code>main</code>.</p>



<a name="285985326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285985326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285985326">(Jun 13 2022 at 20:28)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a> from <code>trevor/icmp-isle-port</code> to <code>main</code>.</p>



<a name="285994765"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/285994765" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#285994765">(Jun 13 2022 at 21:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4254#pullrequestreview-1004999426">PR review</a>.</p>



<a name="286002816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234254%20X64%3A%20port%20the%20rest%20of%20icmp%20to%20ISLE/near/286002816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234254.20X64.3A.20port.20the.20rest.20of.20icmp.20to.20ISLE.html#286002816">(Jun 13 2022 at 23:34)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4254">PR #4254</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>