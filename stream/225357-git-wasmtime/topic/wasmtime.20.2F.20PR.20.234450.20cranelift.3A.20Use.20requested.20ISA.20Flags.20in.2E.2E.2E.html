<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4450 cranelift: Use requested ISA Flags in... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html">wasmtime / PR #4450 cranelift: Use requested ISA Flags in...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="289670167"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289670167" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289670167">(Jul 15 2022 at 01:00)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4450">PR #4450</a> from <code>testrunner-flags</code> to <code>main</code>:</p>
<blockquote>
<p><span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> Hey,</p>
<p>This PR Enables using the ISA flags that run tests request. We skip tests that request flags that the host arch does not support.</p>
<p>I did a quick pass on the backends to find ops that we have optimizations based on flags and enabled the tests for those.</p>
<p>Fixes #1891</p>
</blockquote>



<a name="289670867"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289670867" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289670867">(Jul 15 2022 at 01:11)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4450">PR #4450</a> from <code>testrunner-flags</code> to <code>main</code>.</p>



<a name="289757569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289757569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289757569">(Jul 15 2022 at 17:26)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040524517">PR review</a>.</p>



<a name="289757570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289757570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289757570">(Jul 15 2022 at 17:26)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040524517">PR review</a>.</p>



<a name="289757571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289757571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289757571">(Jul 15 2022 at 17:26)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#discussion_r922321596">PR review comment</a>:</p>
<blockquote>
<p>Can we have a more helpful message in case somebody tries putting a non-boolean flag in a test? Something like:</p>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>            k =&gt; unimplemented!("ISA flag {} of kind {:?}", value.name, k),
</code></pre></div>
<p>It's not really important if there's a similar check added to <code>is_isa_compatible</code> as that will get hit first, but I'd still do it both places just in case.</p>
</blockquote>



<a name="289757572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289757572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289757572">(Jul 15 2022 at 17:26)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#discussion_r922366494">PR review comment</a>:</p>
<blockquote>
<p>It seems surprising to me to silently ignore non-bool flags here. How do you feel about this?</p>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>    for req_value in requested_flags {
        if let Some(requested) = req_value.as_bool() {
            let available_in_host = host
                .isa_flags()
                .iter()
                .find(|val| val.name == req_value.name)
                .and_then(|val| val.as_bool())
                .unwrap_or(false);

            if requested &amp;&amp; !available_in_host {
                return Err(format!(
                    "skipped {}: host does not support ISA flag {}",
                    context.file_path, req_value.name
                ));
            }
        } else {
            unimplemented!("ISA flag {} of kind {:?}", req_value.name, req_value.kind());
        }
    }
</code></pre></div><br>
</p>
</blockquote>



<a name="289759412"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289759412" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289759412">(Jul 15 2022 at 17:41)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040619298">PR review</a>.</p>



<a name="289759413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289759413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289759413">(Jul 15 2022 at 17:41)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#discussion_r922389149">PR review comment</a>:</p>
<blockquote>
<p>Yeah, sounds good, ill update to that.</p>
</blockquote>



<a name="289759438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289759438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289759438">(Jul 15 2022 at 17:41)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040619506">PR review</a>.</p>



<a name="289759440"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289759440" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289759440">(Jul 15 2022 at 17:41)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#discussion_r922389308">PR review comment</a>:</p>
<blockquote>
<p>I'm going to backport what I did in #4453 which adds a <code>value_string</code> function and makes this a whole lot cleaner, and supports all flag kinds.</p>
</blockquote>



<a name="289760567"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289760567" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289760567">(Jul 15 2022 at 17:51)</a>:</h4>
<p>afonso360 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4450">PR #4450</a> from <code>testrunner-flags</code> to <code>main</code>.</p>



<a name="289765839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289765839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289765839">(Jul 15 2022 at 18:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040677466">PR review</a>.</p>



<a name="289769873"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289769873" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289769873">(Jul 15 2022 at 19:07)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4450#pullrequestreview-1040707775">PR review</a>.</p>



<a name="289770093"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234450%20cranelift%3A%20Use%20requested%20ISA%20Flags%20in.../near/289770093" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234450.20cranelift.3A.20Use.20requested.20ISA.20Flags.20in.2E.2E.2E.html#289770093">(Jul 15 2022 at 19:09)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4450">PR #4450</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>