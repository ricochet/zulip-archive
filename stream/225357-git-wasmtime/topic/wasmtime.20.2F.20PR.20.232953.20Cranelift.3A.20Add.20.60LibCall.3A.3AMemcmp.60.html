<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2953 Cranelift: Add `LibCall::Memcmp` · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html">wasmtime / PR #2953 Cranelift: Add `LibCall::Memcmp`</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="240864868"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/240864868" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#240864868">(May 31 2021 at 19:28)</a>:</h4>
<p>scottmcm opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>:</p>
<blockquote>
<p>The comment says the enum is "likely to grow" and the function's been in libc since C89, so hopefully this is ok.</p>
<p>I'd like to use it for emitting things like array equality.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="240865269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/240865269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#240865269">(May 31 2021 at 19:36)</a>:</h4>
<p>scottmcm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>:</p>
<blockquote>
<p>This adds <code>LibCall::Memcmp</code> and a corresponding <code>FunctionBuilder::call_memcmp</code>, following the existing patterns of <code>memcpy</code>, <code>memset</code>, &amp; <code>memmove</code>.  The comment says the enum is "likely to grow" and the <code>memcmp</code>'s been in libc since C89, so hopefully this is ok.</p>
<p>I'd like to have this for emitting equality tests of large, simple no-padding types, like <code>[u32; 123]</code>.</p>
<p>I don't know who should review this.<br>
</p>
</blockquote>



<a name="240961389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/240961389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#240961389">(Jun 01 2021 at 15:42)</a>:</h4>
<p>scottmcm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>.</p>



<a name="262986826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/262986826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#262986826">(Nov 29 2021 at 09:59)</a>:</h4>
<p>scottmcm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>.</p>



<a name="262987844"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/262987844" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#262987844">(Nov 29 2021 at 10:08)</a>:</h4>
<p>scottmcm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>.</p>



<a name="263079759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263079759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263079759">(Nov 29 2021 at 23:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818353273">PR review</a>.</p>



<a name="263079760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263079760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263079760">(Nov 29 2021 at 23:01)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818353273">PR review</a>.</p>



<a name="263079761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263079761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263079761">(Nov 29 2021 at 23:01)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#discussion_r758767012">PR review comment</a>:</p>
<blockquote>
<p>This could probably become a helper on <code>Type</code>, perhaps <code>Type::int_with_byte_size(...)</code> (and create a corresponding <code>Type::int_with_bit_size(...)</code> and maybe the <code>float</code> and <code>bool</code> equivalents too).</p>
</blockquote>



<a name="263082869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263082869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263082869">(Nov 29 2021 at 23:35)</a>:</h4>
<p>scottmcm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818416894">PR review</a>.</p>



<a name="263082871"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263082871" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263082871">(Nov 29 2021 at 23:35)</a>:</h4>
<p>scottmcm created <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#discussion_r758817434">PR review comment</a>:</p>
<blockquote>
<p>Hmm, <code>Type::int</code> is already mostly <code>Type::int_with_bit_size</code>, just with a different parameter type.</p>
<p>Here's a few possible directions.  Let me know which you'd prefer I do, @cfallin </p>
<ul>
<li>Add <code>Type::int_with_byte_size</code> and <code>Type::int_with_bit_size</code>, concentrating on the "different integer width" use by having them take <code>impl TryInto&lt;u16&gt;</code>.</li>
<li>Add a <code>Type::int_bytes</code> that takes <code>u16</code></li>
<li>Rename <code>Type::int</code> to <code>Type::int_bits</code> and add <code>Type::int_bytes</code> (rg only spots 10 obvious uses of <code>Type::int</code> so it might not be as horrible as I'd have guessed)</li>
<li>One of the above, but using a type other than <code>u16</code> for <code>Type::int</code> (TBH <code>u16</code> is kinda odd there, since the biggest value it cares about is 128 and would fit in a <code>u8</code>, but it's also not the <code>u32</code> that rust's <code>std</code> <a href="https://doc.rust-lang.org/nightly/std/primitive.u16.html#method.trailing_ones">tends to use for numbers of bits</a>)</li>
<li>Some combination thereof</li>
<li>Make a follow-up PR for one of the above</li>
<li>Do nothing<br>
</li>
</ul>
</blockquote>



<a name="263083649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263083649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263083649">(Nov 29 2021 at 23:46)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818421982">PR review</a>.</p>



<a name="263083650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263083650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263083650">(Nov 29 2021 at 23:46)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#discussion_r758821663">PR review comment</a>:</p>
<blockquote>
<p>Ah, I had missed the existing <code>Type::int()</code> -- IMHO, it might be better to leave that as-is (<code>Type::int(32)</code> is simple/ergonomic/very clear) and then add this as <code>Type::int_with_byte_size()</code> (I slightly prefer this over <code>int_bytes</code>, the latter sounds like it's a special kind of int that's a vector of bytes or something like that). And I guess let's match the <code>u16</code> for consistency (I'm not sure why <code>u16</code>, maybe to allow 256-bit vecs but still be somewhat compact?).</p>
<p>Thanks!</p>
</blockquote>



<a name="263086563"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263086563" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263086563">(Nov 30 2021 at 00:22)</a>:</h4>
<p>scottmcm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818439997">PR review</a>.</p>



<a name="263086564"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263086564" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263086564">(Nov 30 2021 at 00:22)</a>:</h4>
<p>scottmcm created <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#discussion_r758836444">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>I'm not sure why u16, maybe to allow 256-bit vecs but still be somewhat compact?</p>
</blockquote>
<p>That would make sense if it was stored, but <code>Type</code> is just <code>pub struct Type(u8);</code>, so it's just a parameter, and thus the choice seems like it could be pretty much anything.</p>
<p>I'll go add <code>Type::int_with_byte_size(u16) -&gt; Type</code> as requested.</p>
</blockquote>



<a name="263088872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263088872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263088872">(Nov 30 2021 at 00:48)</a>:</h4>
<p>scottmcm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>.</p>



<a name="263089421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263089421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263089421">(Nov 30 2021 at 00:54)</a>:</h4>
<p>scottmcm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a> from <code>add-memcmp</code> to <code>main</code>.</p>



<a name="263090622"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263090622" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263090622">(Nov 30 2021 at 01:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818462106">PR review</a>.</p>



<a name="263090623"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263090623" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263090623">(Nov 30 2021 at 01:10)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#discussion_r758854298">PR review comment</a>:</p>
<blockquote>
<p>OK, yeah, that existing bit is unclear then; but, better saved for a later cleanup :-) Thanks!</p>
</blockquote>



<a name="263090659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263090659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263090659">(Nov 30 2021 at 01:11)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2953#pullrequestreview-818462532">PR review</a>.</p>



<a name="263095462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232953%20Cranelift%3A%20Add%20%60LibCall%3A%3AMemcmp%60/near/263095462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232953.20Cranelift.3A.20Add.20.60LibCall.3A.3AMemcmp.60.html#263095462">(Nov 30 2021 at 02:36)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2953">PR #2953</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>