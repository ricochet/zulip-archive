<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3993 x64: port `load` to ISLE · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html">wasmtime / PR #3993 x64: port `load` to ISLE</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="277794041"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277794041" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277794041">(Apr 04 2022 at 21:09)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>:</p>
<blockquote>
<p>This change moves the majority of the lowerings for CLIF's <code>load</code><br>
instruction over to ISLE. To do so, it also migrates the previous<br>
mechanism for creating an <code>Amode</code> (<code>lower_to_amode</code>) to several ISLE<br>
rules (see <code>to_amode</code>).</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="277795813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277795813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277795813">(Apr 04 2022 at 21:24)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="277796149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796149">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-930962319">PR review</a>.</p>



<a name="277796150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796150">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-930962319">PR review</a>.</p>



<a name="277796151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796151">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842147098">PR review comment</a>:</p>
<blockquote>
<p>This would be a little clearer with the specific condition in the name I think -- maybe <code>const_shift_lt_eq_3</code> or somesuch?</p>
</blockquote>



<a name="277796152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796152">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842149282">PR review comment</a>:</p>
<blockquote>
<p>I think <code>ishl_imm</code> is converted during legalization to <code>ishl</code> + <code>iconst</code> so we can probably remove this TODO.</p>
</blockquote>



<a name="277796153"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796153" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796153">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842152604">PR review comment</a>:</p>
<blockquote>
<p>I think we need to check whether <code>c + offset</code> fits in the constant immediate, right?</p>
<p>If so, I think we can do this with something like (it's a hack, but):</p>
<p><code>rule (to_amode flags (iadd (iconst (low32_will_sign_extend_to_64 c)) base) (u32_add &lt;c offset)))</code></p>
<p>in other words, make <code>u32_add</code> an extractor as well, and take an in-arg (use arg polarity for this) with the half of the sum we already know (<code>c</code>). For the arg-flipped version below we need to use the <code>u32_add</code> extractor inside the <code>low32_will_sign_extend...</code> instead.</p>
<p>(open to ideas how we might clean this up in ISLE, by the way -- aside from fitzgen's ideas around higher-order extractors, I kind of like the notion of separate constraint clauses as well, which would allow us to write something like <code>(given (u32_add_fits offset c))</code> after the LHS...)</p>
</blockquote>



<a name="277796154"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796154" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796154">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842148805">PR review comment</a>:</p>
<blockquote>
<p>s/c &gt;&gt; amount/c &lt;&lt; amount/, I think?</p>
</blockquote>



<a name="277796155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796155">(Apr 04 2022 at 21:27)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842148442">PR review comment</a>:</p>
<blockquote>
<p>From the implementation below it looks like it's actually checking whether the value will fit in a <code>u32</code>, so basically, positive values &lt;= 4GiB? Is that right? Do we want to check &lt;= 2GiB or -2GiB &lt;= x &lt;= 2GiB instead?</p>
<p>(pre-existing confusion I know but it's worthwhile to fix this while we're here!)</p>
</blockquote>



<a name="277796781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277796781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277796781">(Apr 04 2022 at 21:33)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="277797975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277797975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277797975">(Apr 04 2022 at 21:44)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-930985637">PR review</a>.</p>



<a name="277797976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277797976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277797976">(Apr 04 2022 at 21:44)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842164416">PR review comment</a>:</p>
<blockquote>
<p>Done; it would be nice to have arithmetic expressions in ISLE somehow, a la <code>(shift &lt;= 3)</code>.</p>
</blockquote>



<a name="277798188"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277798188" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277798188">(Apr 04 2022 at 21:46)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="277809661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277809661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277809661">(Apr 04 2022 at 23:53)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="277809772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277809772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277809772">(Apr 04 2022 at 23:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-931073219">PR review</a>.</p>



<a name="277809774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277809774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277809774">(Apr 04 2022 at 23:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r842225933">PR review comment</a>:</p>
<blockquote>
<p>Good catch; that logic was all wrong. Take a look at the new helpers and their logic.</p>
</blockquote>



<a name="277809907"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/277809907" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#277809907">(Apr 04 2022 at 23:56)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="278098202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278098202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278098202">(Apr 06 2022 at 23:07)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="278098789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278098789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278098789">(Apr 06 2022 at 23:14)</a>:</h4>
<p><strong>abrown</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> as ready for review.</p>



<a name="278098910"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278098910" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278098910">(Apr 06 2022 at 23:15)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-934264152">PR review</a>.</p>



<a name="278098911"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278098911" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278098911">(Apr 06 2022 at 23:15)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r844499779">PR review comment</a>:</p>
<blockquote>
<p>I don't like having two of these weird helpers doing almost the same thing. It would be great if some of this logic could just exist in ISLE, but in the meantime... suggestions appreciated.</p>
</blockquote>



<a name="278114055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278114055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278114055">(Apr 07 2022 at 03:44)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a>.</p>



<a name="278208887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208887">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-935365078">PR review</a>.</p>



<a name="278208888"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208888" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208888">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845416824">PR review comment</a>:</p>
<blockquote>
<p>IIRC (and I might not, this stuff is subtle!) I think this comment should be adjusted slightly: negative values are fine if they sign-extend correctly, no? (The logic looks correct below, concern is just with the comment.)</p>
</blockquote>



<a name="278208889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208889">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-935365078">PR review</a>.</p>



<a name="278208890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208890">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845450501">PR review comment</a>:</p>
<blockquote>
<p><code>bits()</code> returns an <code>i64</code>, so won't the <code>.try_into().unwrap()</code> panic if given a negative value in the <code>Imm64</code>? I think since we're working with raw bits here then determining possibility of representation below, we can cast the raw bits with <code>as u64</code>.</p>
</blockquote>



<a name="278208892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208892">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845374694">PR review comment</a>:</p>
<blockquote>
<p>I think this will use a <code>movzx</code> for 32-bit loads as well? Strictly speaking this should be fine, and it looks like it matches how loads happen today actually, but it might be a bit more idiomatic, and I think one byte shorter in encoding, to use a 32-bit <code>mov</code> instead.</p>
</blockquote>



<a name="278208893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278208893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278208893">(Apr 07 2022 at 18:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845346137">PR review comment</a>:</p>
<blockquote>
<p>Longer-term I want to extend ISLE semantics a bit to make this work without the in-args, as we talked about (for others watching, I'll write more about some ideas soon!). For now I wonder if we could collapse these two extractors into one by passing a default type like <code>$I64</code> to the <code>Type</code> for the non-extend case?</p>
</blockquote>



<a name="278218668"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278218668" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278218668">(Apr 07 2022 at 20:01)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-935613643">PR review</a>.</p>



<a name="278218669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278218669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278218669">(Apr 07 2022 at 20:01)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845517505">PR review comment</a>:</p>
<blockquote>
<p>Ok, changed.</p>
</blockquote>



<a name="278237232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278237232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278237232">(Apr 07 2022 at 22:59)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a> from <code>isle-load</code> to <code>main</code>.</p>



<a name="278241641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278241641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278241641">(Apr 07 2022 at 23:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#pullrequestreview-935780691">PR review</a>.</p>



<a name="278241642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278241642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278241642">(Apr 07 2022 at 23:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3993#discussion_r845640205">PR review comment</a>:</p>
<blockquote>
<p>I'll add a TODO issue for this; I have been fuzzing with no issues but, being a bit paranoid, want to let oss-fuzz check this for a while before changing the logic: <a href="https://github.com/bytecodealliance/wasmtime/issues/4006">https://github.com/bytecodealliance/wasmtime/issues/4006</a>.</p>
</blockquote>



<a name="278247262"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233993%20x64%3A%20port%20%60load%60%20to%20ISLE/near/278247262" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233993.20x64.3A.20port.20.60load.60.20to.20ISLE.html#278247262">(Apr 08 2022 at 01:31)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3993">PR #3993</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>