<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8243 Migrate all Winch filetests to `tests... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html">wasmtime / PR #8243 Migrate all Winch filetests to `tests...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="429708570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708570">(Mar 26 2024 at 17:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/saulecabrera">saulecabrera</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429708572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708572">(Mar 26 2024 at 17:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429708574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708574">(Mar 26 2024 at 17:46)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a> from <code>alexcrichton:migrate-winch-tests</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit builds on <a href="https://github.com/bytecodealliance/wasmtime/pull/8237">https://github.com/bytecodealliance/wasmtime/pull/8237</a> to migrate all Winch filetests to the top-level <code>tests/disas/</code> test suite. All files are copied to a <code>tests/disas/winch</code> folder.</p>
<p>This PR has a number of commit splitting out the various stages of this migration. The main changes are:</p>
<ul>
<li><code>test = "winch"</code> is now supported in <code>disas</code> tests</li>
<li>Support for the Winch ABI in Cranelift is ungated (it no longer panics) to get <code>wasmtime compile</code> working to get the tests working</li>
<li>Winch tests now use ATT syntax instead of Intel syntax (the Cranelift default)</li>
</ul>
<p>The next follow-up I'd like to do is to remove the filetest infrastructure for Winch, which will probably also remove the Winch executable itself. I'll do that as a follow-up though.</p>
</blockquote>



<a name="429708575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708575">(Mar 26 2024 at 17:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429708579"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708579" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708579">(Mar 26 2024 at 17:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429708581"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429708581" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429708581">(Mar 26 2024 at 17:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429710495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429710495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429710495">(Mar 26 2024 at 17:57)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#issuecomment-2021129253">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>:</p>
<blockquote>
<p>One change that we made to the winch disasm tests that I liked was to only print offsets after branch instructions (and always after a return). This made updates to filetests easier to read, as the diff was usually more precise. Would that be easy to add back in before this migration, or should we do that as a separate update?</p>
</blockquote>



<a name="429724029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429724029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429724029">(Mar 26 2024 at 19:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#issuecomment-2021290621">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>:</p>
<blockquote>
<p>I saw that yeah from Winch but I ended up leaving it out in favor of printing all offsets. I was a bit confused as to why the address after a jump instruction was printed because that didn't account for fall-through-style jumps (e.g. it didn't reliably catch all jump targets). For after-ret I was also not sure that would handle the case of multiple <code>ret</code> instructions in a function. </p>
<p>I can add it back in though if desired!</p>
</blockquote>



<a name="429726161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429726161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429726161">(Mar 26 2024 at 19:36)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#pullrequestreview-1961372990">PR review</a>:</p>
<blockquote>
<p>Looks good to me, thanks! I'd be in favor of considering adding back the file test formatting; even though not all cases are covered (as you've pointed out) the original motivation that Trevor and I discussed was to make any diffs easier to read. </p>
</blockquote>



<a name="429726162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429726162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429726162">(Mar 26 2024 at 19:36)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#pullrequestreview-1961372990">PR review</a>:</p>
<blockquote>
<p>Looks good to me, thanks! I'd be in favor of considering adding back the file test formatting; even though not all cases are covered (as you've pointed out) the original motivation that Trevor and I discussed was to make any diffs easier to read. </p>
</blockquote>



<a name="429726163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429726163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429726163">(Mar 26 2024 at 19:36)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#discussion_r1539880140">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>                "The Winch calling convention is only implemented for x86_64 and aarch64"
</code></pre></div><br>
</p>
</blockquote>



<a name="429743148"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429743148" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429743148">(Mar 26 2024 at 21:30)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429743235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429743235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429743235">(Mar 26 2024 at 21:31)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429743288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429743288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429743288">(Mar 26 2024 at 21:32)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429743357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429743357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429743357">(Mar 26 2024 at 21:32)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#issuecomment-2021511318">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>:</p>
<blockquote>
<p>Ah ok that makes sense. I've updated with that added back in plus some comments</p>
</blockquote>



<a name="429758986"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429758986" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429758986">(Mar 27 2024 at 00:03)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#pullrequestreview-1961986336">PR review</a>.</p>



<a name="429759056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429759056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429759056">(Mar 27 2024 at 00:04)</a>:</h4>
<p>elliottt <a href="https://github.com/bytecodealliance/wasmtime/pull/8243#issuecomment-2021678848">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>:</p>
<blockquote>
<p>Thanks for changing the output back!</p>
</blockquote>



<a name="429872227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429872227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429872227">(Mar 27 2024 at 14:28)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429872291"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429872291" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429872291">(Mar 27 2024 at 14:28)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<a name="429883249"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238243%20Migrate%20all%20Winch%20filetests%20to%20%60tests.../near/429883249" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238243.20Migrate.20all.20Winch.20filetests.20to.20.60tests.2E.2E.2E.html#429883249">(Mar 27 2024 at 15:10)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8243">PR #8243</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>