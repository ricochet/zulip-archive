<html>
<head><meta charset="utf-8"><title>wasmtime / issue #6986 Wasm component hangs waiting for S... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html">wasmtime / issue #6986 Wasm component hangs waiting for S...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="390059614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390059614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390059614">(Sep 09 2023 at 19:37)</a>:</h4>
<p>calebschoepp opened <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/12566544/the-actual-one.wasm.zip">problematic.wasm.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="s">"&lt;p&gt;Random HTML&lt;/p&gt;"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUST_LOG</span><span class="o">=</span><span class="n">wasmtime_wasi</span><span class="o">=</span><span class="n">trace</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">problematic</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span>
</code></pre></div>
<p>Observe that component just hangs waiting for STDIN to close.</p>
<h3>Expected Results</h3>
<p>I expect the component to detect that STDIN has closed and print out the HTML converted to markdown.</p>
<h3>Actual Results</h3>
<p>Program hangs waiting for STDIN to close. Excerpt of traces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview</span><span class="o">^</span><span class="n">C2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 181d005c4</p>
<p>Operating system: MacOS</p>
<p>Architecture: M2</p>
<h3>Extra Info</h3>
<p>Nope<br>
</p>
</blockquote>



<a name="390059615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390059615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390059615">(Sep 09 2023 at 19:37)</a>:</h4>
<p><a href="https://github.com/calebschoepp">calebschoepp</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">Issue #6986</a>.</p>



<a name="390092056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390092056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390092056">(Sep 10 2023 at 03:16)</a>:</h4>
<p>pchickey assigned <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a> to pchickey.</p>



<a name="390200403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390200403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390200403">(Sep 10 2023 at 23:55)</a>:</h4>
<p>calebschoepp <a href="https://github.com/bytecodealliance/wasmtime/issues/6986#issuecomment-1712976388">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>I spent some time trying to create a wasi integration test that reproduces this issue and was unsuccessful.</p>
<p>I modified the test <code>/crates/test-programs/command-tests/src/bin/stdin.rs</code> to use the input after reading from it just like I do in the component that is failing. I even added a sleep like I used in my component but I was unable to repro the issue in a test. I'm still very new to Wasmtime so I'm not sure what I'm doing wrong.</p>
</blockquote>



<a name="390359125"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390359125" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390359125">(Sep 11 2023 at 17:37)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6986#issuecomment-1714313780">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>For tests they're using a different stdin than the CLI uses by default since it's an in-memory version, which may explain the difference between tests and the CLI. If the fix is to the actual stdin reading implementation then there won't be an easy way to test this right now since it would require spawning a subprocess which while we do that in <code>tests/all/cli_tests.rs</code> it's always done with handwritten <code>*.wat</code> which may be difficult to do in this case. If that's the case though it's probably ok to skip the test here.</p>
<p>Otherwise though a lot of I/O stuff is changing in <a href="https://github.com/bytecodealliance/wasmtime/pull/6877">https://github.com/bytecodealliance/wasmtime/pull/6877</a> so it might be good to test on that branch or test it after that lands to see if this still reproduces.</p>
</blockquote>



<a name="390362016"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390362016" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390362016">(Sep 11 2023 at 17:57)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/6986#issuecomment-1714340495">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>We have tests that use <code>fork(2)</code> to test child process stdin behavior in <a href="https://github.com/bytecodealliance/wasmtime/blob/pch/backpressure_2/crates/wasi/src/preview2/stdio.rs#L157">https://github.com/bytecodealliance/wasmtime/blob/pch/backpressure_2/crates/wasi/src/preview2/stdio.rs#L157</a></p>
</blockquote>



<a name="390362034"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390362034" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390362034">(Sep 11 2023 at 17:57)</a>:</h4>
<p>pchickey closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/12566544/the-actual-one.wasm.zip">problematic.wasm.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="s">"&lt;p&gt;Random HTML&lt;/p&gt;"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUST_LOG</span><span class="o">=</span><span class="n">wasmtime_wasi</span><span class="o">=</span><span class="n">trace</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">problematic</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span>
</code></pre></div>
<p>Observe that component just hangs waiting for STDIN to close.</p>
<h3>Expected Results</h3>
<p>I expect the component to detect that STDIN has closed and print out the HTML converted to markdown.</p>
<h3>Actual Results</h3>
<p>Program hangs waiting for STDIN to close. Excerpt of traces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview</span><span class="o">^</span><span class="n">C2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 181d005c4</p>
<p>Operating system: MacOS</p>
<p>Architecture: M2</p>
<h3>Extra Info</h3>
<p>Nope<br>
</p>
</blockquote>



<a name="390362056"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390362056" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390362056">(Sep 11 2023 at 17:58)</a>:</h4>
<p>pchickey reopened <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/12566544/the-actual-one.wasm.zip">problematic.wasm.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="s">"&lt;p&gt;Random HTML&lt;/p&gt;"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUST_LOG</span><span class="o">=</span><span class="n">wasmtime_wasi</span><span class="o">=</span><span class="n">trace</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">problematic</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span>
</code></pre></div>
<p>Observe that component just hangs waiting for STDIN to close.</p>
<h3>Expected Results</h3>
<p>I expect the component to detect that STDIN has closed and print out the HTML converted to markdown.</p>
<h3>Actual Results</h3>
<p>Program hangs waiting for STDIN to close. Excerpt of traces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview</span><span class="o">^</span><span class="n">C2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 181d005c4</p>
<p>Operating system: MacOS</p>
<p>Architecture: M2</p>
<h3>Extra Info</h3>
<p>Nope<br>
</p>
</blockquote>



<a name="390362102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/390362102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#390362102">(Sep 11 2023 at 17:58)</a>:</h4>
<p>pchickey <a href="https://github.com/bytecodealliance/wasmtime/issues/6986#issuecomment-1714341106">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Fat finger!</p>
</blockquote>



<a name="391988294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/391988294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#391988294">(Sep 19 2023 at 20:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/6986#issuecomment-1726407531">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Got around to looking at this after #6877 landed and there were still remaining issues which I think I've fixed in <a href="https://github.com/bytecodealliance/wasmtime/pull/7063">https://github.com/bytecodealliance/wasmtime/pull/7063</a></p>
</blockquote>



<a name="392022356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%236986%20Wasm%20component%20hangs%20waiting%20for%20S.../near/392022356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.236986.20Wasm.20component.20hangs.20waiting.20for.20S.2E.2E.2E.html#392022356">(Sep 20 2023 at 01:19)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/6986">issue #6986</a>:</p>
<blockquote>
<p>Thanks for filing a bug report! Please fill out the TODOs below.</p>
<p><strong>Note: if you want to report a security issue, please read our <a href="https://bytecodealliance.org/security">security policy</a>!</strong></p>
<h3>Test Case</h3>
<p><a href="https://github.com/bytecodealliance/wasmtime/files/12566544/the-actual-one.wasm.zip">problematic.wasm.zip</a></p>
<h3>Steps to Reproduce</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="s">"&lt;p&gt;Random HTML&lt;/p&gt;"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RUST_LOG</span><span class="o">=</span><span class="n">wasmtime_wasi</span><span class="o">=</span><span class="n">trace</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">problematic</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span>
</code></pre></div>
<p>Observe that component just hangs waiting for STDIN to close.</p>
<h3>Expected Results</h3>
<p>I expect the component to detect that STDIN has closed and print out the HTML converted to markdown.</p>
<h3>Actual Results</h3>
<p>Program hangs waiting for STDIN to close. Excerpt of traces:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(([],</span><span class="w"> </span><span class="n">StreamStatus</span>::<span class="n">Open</span><span class="p">)))</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">wit</span><span class="o">-</span><span class="n">bindgen</span><span class="w"> </span><span class="n">import</span><span class="p">;</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="s">"streams"</span><span class="w"> </span><span class="n">function</span><span class="o">=</span><span class="s">"read"</span>
<span class="w"> </span><span class="n">TRACE</span><span class="w"> </span><span class="n">wasmtime_wasi</span>::<span class="n">preview</span><span class="o">^</span><span class="n">C2</span>::<span class="n">bindings</span>::<span class="n">sync_io</span>::<span class="n">_internal</span>::<span class="n">wasi</span>::<span class="n">io</span>::<span class="n">streams</span><span class="w">      </span><span class="o">&gt;</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">this</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="n">len</span><span class="o">=</span><span class="mi">32</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 181d005c4</p>
<p>Operating system: MacOS</p>
<p>Architecture: M2</p>
<h3>Extra Info</h3>
<p>Nope<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>