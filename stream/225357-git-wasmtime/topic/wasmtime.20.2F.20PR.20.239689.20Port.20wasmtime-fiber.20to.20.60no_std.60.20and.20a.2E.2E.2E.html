<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9689 Port wasmtime-fiber to `no_std` and a... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html">wasmtime / PR #9689 Port wasmtime-fiber to `no_std` and a...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="484626658"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484626658" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484626658">(Nov 27 2024 at 02:02)</a>:</h4>
<p>cfallin opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a> from <code>cfallin:async-nostd</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>… Wasmtime.</p>
<p>This PR allows a <code>no_std</code> Wasmtime build to be configured with the <code>async</code> feature. (Previously, a minimal <code>no_std</code> configuration could only run with sync entry points, without suspending of stacks.)</p>
<p>The main hurdle to this support was the <code>wasmtime-fiber</code> crate. Fortunately, the "unix" variant of fibers was almost entirely portable to a <code>no_std</code> environment, owing to the fact that it implements stack-switching manually in assembly itself. I moved the per-ISA implementations to a shared submodule and built the nostd platform backend for <code>wasmtime-fiber</code> with a stripped-down version of the unix backend.</p>
<p>The nostd backend does not support mmap'd stacks, does not support custom stack allocators, and does not propagate panics.</p>
<p>I've updated the <code>min-platform</code> example to ensure this builds but have not yet actually tested it (I am in the middle of a larger porting effort); hence, a draft PR for initial feedback.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="484626700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484626700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484626700">(Nov 27 2024 at 02:02)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2502494660">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>cc @alexcrichton -- I think you're on vacation now but I'd be very curious what you think of this in general!</p>
</blockquote>



<a name="484626711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484626711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484626711">(Nov 27 2024 at 02:02)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="484626722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484626722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484626722">(Nov 27 2024 at 02:03)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>This PR allows a <code>no_std</code> Wasmtime build to be configured with the <code>async</code> feature. (Previously, a minimal <code>no_std</code> configuration could only run with sync entry points, without suspending of stacks.)</p>
<p>The main hurdle to this support was the <code>wasmtime-fiber</code> crate. Fortunately, the "unix" variant of fibers was almost entirely portable to a <code>no_std</code> environment, owing to the fact that it implements stack-switching manually in assembly itself. I moved the per-ISA implementations to a shared submodule and built the nostd platform backend for <code>wasmtime-fiber</code> with a stripped-down version of the unix backend.</p>
<p>The nostd backend does not support mmap'd stacks, does not support custom stack allocators, and does not propagate panics.</p>
<p>I've updated the <code>min-platform</code> example to ensure this builds but have not yet actually tested it (I am in the middle of a larger porting effort); hence, a draft PR for initial feedback.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="484627328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484627328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484627328">(Nov 27 2024 at 02:09)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="484687790"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484687790" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484687790">(Nov 27 2024 at 10:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2464625655">PR review</a>.</p>



<a name="484687791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484687791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484687791">(Nov 27 2024 at 10:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1860413846">PR review comment</a>:</p>
<blockquote>
<p>If you do unwind when the std feature is disabled, are you guaranteed to hit an <code>extern "C"</code> boundary to abort unwinding? Or will you get arbitrary corruption?</p>
</blockquote>



<a name="484758511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484758511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484758511">(Nov 27 2024 at 16:29)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2465507007">PR review</a>.</p>



<a name="484758513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484758513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484758513">(Nov 27 2024 at 16:29)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1860960768">PR review comment</a>:</p>
<blockquote>
<p>Excellent question! (@alexcrichton when you're around it'd be great to get your canonical answer on this)</p>
<p>Currently in my porting context I have a <code>#[panic_handler]</code> that will abort, so I haven't thought through this in much detail. One option is certainly to say that panic unwinding is not supported in <code>no_std</code> builds with <code>async</code>, and the build must provide a custom aborting panic handler or specify <code>panic=abort</code>. However if we wanted to support propagation of unwinds I think we might be able to do something custom here (the <code>catch_unwind</code>/<code>resume_unwind</code> functions in <code>std::panic</code> don't exist in <code>core::panic</code> but one could roll one's own unwinding). I wonder if there's a way to make this safe (build only when <code>panic=abort</code> for example) in the meantime?</p>
</blockquote>



<a name="484764552"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484764552" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484764552">(Nov 27 2024 at 17:04)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="484764817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484764817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484764817">(Nov 27 2024 at 17:06)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2465586485">PR review</a>.</p>



<a name="484764818"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484764818" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484764818">(Nov 27 2024 at 17:06)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1861008914">PR review comment</a>:</p>
<blockquote>
<p>@sunfishcode helpfully pointed out that <code>#[cfg(panic = "unwind")]</code> and <code>#[cfg(panic = "abort")]</code> work, so I've added a <code>compile_error!()</code> to the fiber library when built with <code>panic=unwind</code> without <code>std</code>. So this is at least now safe!</p>
</blockquote>



<a name="484766427"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484766427" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484766427">(Nov 27 2024 at 17:15)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="484766690"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484766690" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484766690">(Nov 27 2024 at 17:17)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="484772011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/484772011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#484772011">(Nov 27 2024 at 17:52)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485655734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655734">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2473079878">PR review</a>:</p>
<blockquote>
<p>This all looks quite reasonable to me, happy to see this merged <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>.</p>
<p>Could you also add a <code>cargo test -p wasmtime-fiber --no-default-features</code> in CI? I generally try to make sure that if there's nontrivial code added with no_std/etc (as is the case for the <code>nostd.rs</code> file here) that we have some at least smoke testing of what's going on. I think that this should be testable when the <code>std</code> feature is disabled? (might have to conditionally enable/disable some panicking tests, and it's ok to use <code>std</code> in tests just want to be sure to test <code>nostd.rs</code> somehow)</p>
</blockquote>



<a name="485655735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655735">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866088598">PR review comment</a>:</p>
<blockquote>
<p>Was this necessary because it was otherwise broken? Or just keeping the same behavior tested?</p>
<p>If broken, could <code>wasmtime</code> enable the <code>std</code> feature as part of the async feature for now? (until that's fixed)</p>
<p>Otherwise if just keeping the same behavior mind also adding <code>-p wasmtime-fiber --features std</code> and <code>-p wasmtime-fiber</code> to this matrix?</p>
</blockquote>



<a name="485655737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655737">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866089294">PR review comment</a>:</p>
<blockquote>
<p>It's ok to drop this if it's empty, and due to this being an internal crate I think it's reasonable to not have default features here anyway.</p>
</blockquote>



<a name="485655739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655739">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866091388">PR review comment</a>:</p>
<blockquote>
<p>I think it's ok to leave this out for now and mostly just ensure this is <code>cargo check</code>'d somewhere in CI (to avoid someone copy/pasting this <code>Cargo.toml</code> example and forgetting to turn this back off)</p>
</blockquote>



<a name="485655740"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655740" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655740">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866090236">PR review comment</a>:</p>
<blockquote>
<p>I might recommend <code>wasmtime-fiber?/std</code> (note the <code>?</code>) to only enable the <code>wasmtime-fiber</code> dependency if it's already activated via some other means.</p>
</blockquote>



<a name="485655742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655742">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866096826">PR review comment</a>:</p>
<blockquote>
<p>Mind scoping this import to just where it's needed below? (avoid the duplicate <code>#[cfg]</code>)</p>
</blockquote>



<a name="485655743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655743">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866094525">PR review comment</a>:</p>
<blockquote>
<p>A nice trick to avoid <code>core::result::Result</code> here is to, in each module, change:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>to </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>That way you can use any <code>Result</code> type-alias as the actual real <code>Result</code> without worry</p>
</blockquote>



<a name="485655744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655744">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866098930">PR review comment</a>:</p>
<blockquote>
<p>Could this be avoided by having a <code>#[cfg]</code> for std/unwind on the <code>Panicked</code> variant? That way we can statically provide that it's never constructed</p>
</blockquote>



<a name="485655746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485655746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485655746">(Dec 02 2024 at 15:53)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866096293">PR review comment</a>:</p>
<blockquote>
<p>Personally I think it's reasonable to skip the <code>compile_error!</code> here and just let this happen as normal. With <code>panic = "abort"</code> nothing should be unsafe, it just means the extra unwind bits here aren't too useful (and they'll get optimized out)</p>
</blockquote>



<a name="485656012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485656012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485656012">(Dec 02 2024 at 15:54)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2473101928">PR review</a>.</p>



<a name="485656014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485656014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485656014">(Dec 02 2024 at 15:54)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1866103742">PR review comment</a>:</p>
<blockquote>
<p>I commented below as well, but I think it's fine to rely on unconditional aborts via <code>extern "C"</code> boundary in the panic=unwind std=false mode and skip the <code>compile_error!</code></p>
</blockquote>



<a name="485809461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485809461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485809461">(Dec 03 2024 at 10:17)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2475203724">PR review</a>.</p>



<a name="485809462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485809462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485809462">(Dec 03 2024 at 10:17)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1867438640">PR review comment</a>:</p>
<blockquote>
<p>This error only happens when using <code>panic = "unwind"</code>, which is unsound if not using <code>catch_unwind</code>.</p>
</blockquote>



<a name="485902390"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485902390" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485902390">(Dec 03 2024 at 16:50)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476265825">PR review</a>.</p>



<a name="485902391"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485902391" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485902391">(Dec 03 2024 at 16:50)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868076138">PR review comment</a>:</p>
<blockquote>
<p>Could you clarify the unsoundness? Looking at <a href="https://godbolt.org/z/rYfzE1h6s">this disassembly</a> it looks like even in <code>no_std</code> mode unwinds are caught and abort correctly</p>
</blockquote>



<a name="485949200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485949200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485949200">(Dec 03 2024 at 20:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476714419">PR review</a>.</p>



<a name="485949201"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485949201" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485949201">(Dec 03 2024 at 20:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868343876">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton just so I understand: that example uses the <code>C-unwind</code> ABI; currently (and in this PR) the stackswitching bits in assembly are called with the <code>C</code> ABI. In a <code>no_std</code> world with <code>panic=unwind</code> and a custom unwinder (not my use-case, but what this error statically disables for now) I think we could otherwise get an unwind going off the top of a fiber stack. Or it's possible I'm missing something? I don't have all the compiler configuration options here fully internalized.</p>
</blockquote>



<a name="485951446"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485951446" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485951446">(Dec 03 2024 at 20:57)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476737426">PR review</a>.</p>



<a name="485951447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485951447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485951447">(Dec 03 2024 at 20:57)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868358027">PR review comment</a>:</p>
<blockquote>
<p>Ah yeah sorry that's just "faking" a non-inlined call to something that can theoretically unwind. You don't actually need <code>C-unwind</code> but with <code>panic=unwind</code> all normal rust functions can possibly unwind so a catch-and-panic should be inserted for all calls. Basically I'm still not sure how <code>#![no_std]</code> + <code>-Cpanic=unwind</code> is unsound myself</p>
</blockquote>



<a name="485973721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485973721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485973721">(Dec 03 2024 at 23:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476953798">PR review</a>.</p>



<a name="485973722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485973722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485973722">(Dec 03 2024 at 23:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868493212">PR review comment</a>:</p>
<blockquote>
<p>I see: my confusion is the dual to your confusion I think, that is, I'm still not sure how <code>#![no_std]</code> + <code>-Cpanic=unwind</code> is sound :-)</p>
<p>Restating mostly for my own benefit, but to verify we're on the same page: so with the current state of <code>main</code>, we wrap a call to the entrypoint on the new stack in a call to <code>catch_unwind</code> (e.g. <a href="https://github.com/bytecodealliance/wasmtime/blob/db956669a5bc7de1ac247c63b4ad895965469144/crates/fiber/src/lib.rs#L225">here</a>). If the fiber's body panics while on the fiber stack, system <code>libunwind</code> reaches this point, the panic is reified as a <code>RunResult</code>, and that <code>RunResult</code> is passed back to the caller on the original stack and rethrown with <code>resume_unwind</code>.</p>
<p>With this PR, in <code>no_std</code>, we don't have <code>catch_unwind</code>/<code>resume_unwind</code>. So a panic happens in a fiber's body; say that there is a custom unwinder (there must be I think, for one to be doing unwinding at all in <code>no_std</code>?); this unwinder iterates up the stack frames on the fiber stack. It reaches the top, there's no callsite in a <code>catch_unwind</code>; this is an unwind error / UB / something bad. Or is this prevented some other way?</p>
</blockquote>



<a name="485976448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485976448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485976448">(Dec 03 2024 at 23:43)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476973056">PR review</a>.</p>



<a name="485976450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485976450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485976450">(Dec 03 2024 at 23:43)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868506441">PR review comment</a>:</p>
<blockquote>
<p>Oh sorry! Good point getting on the same page (can also talk more during the Cranelift meeting tomorrow if helpful)</p>
<p>I think the main thing to add is that <code>extern "C" fn foo() { panic!() }</code> unconditionally, and soundly, aborts the process. That happens irrespective of <code>-Cunwind=...</code> settings. Starting in Rust 1.81 all <code>extern "C"</code> functions have an implicit catch-and-abort. That means that even if we were to remove the <code>catch_unwind</code> happening in wasmtime-fiber the crate would still be sound, just not too helpful on panics. The <code>catch_unwind</code> is mostly still there to assist with debugging panics by shepherding the panic across the boundary. That's always optional though since it's sound to abort the process at any time (just better to not do so if possible).</p>
<p>That to me is why it's currently sound if we skip the <code>catch_unwind</code>. A bit of a historical note though is that Rust 1.81 is very recent and prior versions of rustc didn't catch-and-abort at <code>extern "C"</code> boundaries. That means that historically <code>catch_unwind</code> was indeed required for soundness but that's no longer the case.</p>
</blockquote>



<a name="485977397"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485977397" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485977397">(Dec 03 2024 at 23:50)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2476979563">PR review</a>.</p>



<a name="485977398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485977398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485977398">(Dec 03 2024 at 23:50)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868510850">PR review comment</a>:</p>
<blockquote>
<p>Ah! OK, that's the detail I had missed; thanks for your patience here. I guess since our MSRV is now 1.81, we can rely on this behavior unconditionally. I'll remove the compile-error and add a comment detailing this.</p>
</blockquote>



<a name="485982003"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982003" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982003">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485982013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982013">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477009402">PR review</a>.</p>



<a name="485982014"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982014" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982014">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531030">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="485982018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982018">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477009434">PR review</a>.</p>



<a name="485982019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982019">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531066">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="485982029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982029">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531145">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="485982031"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982031" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982031">(Dec 04 2024 at 00:22)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477009540">PR review</a>.</p>



<a name="485982038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982038">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477009600">PR review</a>.</p>



<a name="485982039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982039">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531175">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="485982047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982047">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477009663">PR review</a>.</p>



<a name="485982049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982049">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531215">PR review comment</a>:</p>
<blockquote>
<p>I think I had added it at some point while debugging failures but indeed it should work with just <code>async</code>, no <code>std</code> -- so, restored that, added <code>std</code> separately, and added the <code>wasmtime-fiber</code> variants.</p>
</blockquote>



<a name="485982094"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982094" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982094">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477010022">PR review</a>.</p>



<a name="485982096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982096">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531434">PR review comment</a>:</p>
<blockquote>
<p>Done.</p>
</blockquote>



<a name="485982134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982134">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477010330">PR review</a>.</p>



<a name="485982135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982135">(Dec 04 2024 at 00:23)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1868531640">PR review comment</a>:</p>
<blockquote>
<p>Done -- refactored a bit in <code>Suspend::execute()</code> to statically avoid constructing the panic case as well.</p>
</blockquote>



<a name="485982360"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982360" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982360">(Dec 04 2024 at 00:25)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485982439"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982439" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982439">(Dec 04 2024 at 00:26)</a>:</h4>
<p><strong>cfallin</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a> as ready for review.</p>



<a name="485982442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982442">(Dec 04 2024 at 00:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485982443"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982443" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982443">(Dec 04 2024 at 00:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485982444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982444">(Dec 04 2024 at 00:26)</a>:</h4>
<p><strong>cfallin</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="485982478"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485982478" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485982478">(Dec 04 2024 at 00:26)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2515864834">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>Updated and out of draft mode now; thanks!</p>
</blockquote>



<a name="485988218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/485988218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#485988218">(Dec 04 2024 at 01:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2477059316">PR review</a>:</p>
<blockquote>
<p>Is it possible to add a `cargo test -p wasmtime-fiber --no-default-features to CI as well? </p>
</blockquote>



<a name="486016667"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486016667" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486016667">(Dec 04 2024 at 05:35)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486017483"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486017483" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486017483">(Dec 04 2024 at 05:46)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486017733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486017733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486017733">(Dec 04 2024 at 05:50)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486017750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486017750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486017750">(Dec 04 2024 at 05:50)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2516251521">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>Sure thing, done!</p>
</blockquote>



<a name="486017889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486017889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486017889">(Dec 04 2024 at 05:52)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486018711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486018711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486018711">(Dec 04 2024 at 06:01)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486018789"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486018789" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486018789">(Dec 04 2024 at 06:02)</a>:</h4>
<p>cfallin has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486023717"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486023717" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486023717">(Dec 04 2024 at 06:53)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2516349538">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>The CI failures are fairly perplexing -- the only failing job I see is "report failure on cancelation", and a bunch of other jobs are canceled midway through their runs. @alexcrichton any ideas?</p>
</blockquote>



<a name="486121098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486121098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486121098">(Dec 04 2024 at 15:36)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2517802774">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>This happened on another PR the other night and I couldn't figure out what was happening. I then re-queued in the morning and it merged so I assumed it was a transient failure in CI infrastructure... Let's see if that still holds true?</p>
</blockquote>



<a name="486121361"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486121361" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486121361">(Dec 04 2024 at 15:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2479132128">PR review</a>.</p>



<a name="486121362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486121362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486121362">(Dec 04 2024 at 15:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1869808280">PR review comment</a>:</p>
<blockquote>
<p>Oh when adding a new job like this you'll need to also add a "join" to the <code>ci-status</code> below so it's handled for failure-vs-not.</p>
</blockquote>



<a name="486144707"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486144707" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486144707">(Dec 04 2024 at 17:29)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486144741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486144741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486144741">(Dec 04 2024 at 17:29)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2518096704">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>I've pushed a commit to run full CI on this PR where the PR run can't cancel itself, so let's see what happens...</p>
</blockquote>



<a name="486145602"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486145602" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486145602">(Dec 04 2024 at 17:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2518107257">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>Bleh ok so this is a known issue (at least to me) on github actions. For the merge queue there's no way to cancel a failed job so our <code>main.yml</code> self-cancels whenever a job fails. This works fine on all platforms except Windows. On Windows self-cancelling sometimes gives you a big red X on the job and sometimes gives you the icon of "this was cancelled by someone else". Basically there seems to be a race of the self-cancel and the job actually failing.</p>
<p>In any case it's the Windows build. Just some minor things to update.</p>
</blockquote>



<a name="486156965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486156965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486156965">(Dec 04 2024 at 18:42)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486157152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486157152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486157152">(Dec 04 2024 at 18:43)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486157157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486157157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486157157">(Dec 04 2024 at 18:43)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#discussion_r1870100977">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="486157158"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486157158" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486157158">(Dec 04 2024 at 18:43)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#pullrequestreview-2479609441">PR review</a>.</p>



<a name="486157235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486157235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486157235">(Dec 04 2024 at 18:43)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/9689#issuecomment-2518258591">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>:</p>
<blockquote>
<p>Ah, that was entirely unintuitive, GitHub CI user-interface! Thanks for working that out.</p>
</blockquote>



<a name="486158269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486158269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486158269">(Dec 04 2024 at 18:51)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<a name="486166994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239689%20Port%20wasmtime-fiber%20to%20%60no_std%60%20and%20a.../near/486166994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239689.20Port.20wasmtime-fiber.20to.20.60no_std.60.20and.20a.2E.2E.2E.html#486166994">(Dec 04 2024 at 19:48)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9689">PR #9689</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>