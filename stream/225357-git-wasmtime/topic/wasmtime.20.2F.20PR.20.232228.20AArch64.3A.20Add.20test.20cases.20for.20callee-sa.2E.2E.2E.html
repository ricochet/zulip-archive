<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2228 AArch64: Add test cases for callee-sa... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232228.20AArch64.3A.20Add.20test.20cases.20for.20callee-sa.2E.2E.2E.html">wasmtime / PR #2228 AArch64: Add test cases for callee-sa...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="211759387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232228%20AArch64%3A%20Add%20test%20cases%20for%20callee-sa.../near/211759387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232228.20AArch64.3A.20Add.20test.20cases.20for.20callee-sa.2E.2E.2E.html#211759387">(Sep 30 2020 at 13:33)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2228">PR #2228</a> from <code>vector_callee_saves</code> to <code>main</code>:</p>
<blockquote>
<p>This PR adds a test case for a function that saves clobbered vector registers on the stack.</p>
<p>Its purpose is to demonstrate that Cranelift deviates from the Procedure Call Standard for the Arm 64-bit Architecture (AAPCS64). The AAPCS64 <a href="https://github.com/ARM-software/abi-aa/blob/2019Q4/aapcs64/aapcs64.rst#simd-and-floating-point-registers">specifies</a> that a callee is only responsible for saving the bottom 64 bits of a vector register, so it is not possible to preserve a vector value across a function call by keeping it in a callee-saved register (let's ignore the Scalable Vector Extension for the time being, but keep in mind that it makes the rules more complicated).</p>
<p>Due to another deviation from AAPCS64 (the whole vector register is saved instead of only the bottom half), Cranelift effectively implements its own custom calling convention, so there are no correctness issues as long as the generated code calls only functions with the same behaviour.</p>
<p>The wider question is - are we striving for strict AAPCS64 compliance? That's in the non-baldrdash case, of course. I can also open an issue if a longer discussion would be necessary.</p>
<p>cc @cfallin @julian-seward1</p>
</blockquote>



<a name="211991194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232228%20AArch64%3A%20Add%20test%20cases%20for%20callee-sa.../near/211991194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232228.20AArch64.3A.20Add.20test.20cases.20for.20callee-sa.2E.2E.2E.html#211991194">(Oct 02 2020 at 00:08)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2228">PR #2228</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>