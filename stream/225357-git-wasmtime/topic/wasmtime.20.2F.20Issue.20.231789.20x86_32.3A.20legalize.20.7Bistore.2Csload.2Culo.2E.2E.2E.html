<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1789 x86_32: legalize {istore,sload,ulo... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html">wasmtime / Issue #1789 x86_32: legalize {istore,sload,ulo...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199189680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199189680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199189680">(May 29 2020 at 18:00)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-636107495">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @bnjbvr</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:meta"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>bnjbvr: cranelift</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="199204918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199204918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199204918">(May 29 2020 at 20:03)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-636167875">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>Hm, I think I still don't fully understand the machinery here, especially around <code>istore32</code> and <code>*load8</code>...</p>
</blockquote>



<a name="199685838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199685838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199685838">(Jun 03 2020 at 22:37)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638497282">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>I think I'm ok merging this if we add some comments like those in <a href="https://github.com/bytecodealliance/wasmtime/issues/1747#issuecomment-636148449">https://github.com/bytecodealliance/wasmtime/issues/1747#issuecomment-636148449</a> about what the controlling type variable is. This isn't really a problem with the PR as much as it is with the types of the instruction definitions being unclear but at least with comments we'll be able to troubleshoot these legalizations more easily. Also, I would have expected to see these legalizations in <code>widen</code>, not <code>expand</code> so if it can't be changed there we should probably explain that as well.</p>
</blockquote>



<a name="199686150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199686150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199686150">(Jun 03 2020 at 22:41)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638498610">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>So the problem is that unlike my earlier PRs I actually still don't really understand why it works, and why some of the earlier (incorrect) iterations worked and some of them were broken.</p>
</blockquote>



<a name="199692982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199692982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199692982">(Jun 04 2020 at 00:14)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638525598">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>Hm, yeah... Cranelift's legalizations are a bit tricky. Just to confirm the intent of all of this, you want to be able to run <code>istore32</code>, <code>sload32</code>, and <code>uload32</code> on 32-bit x86, right? </p>
</blockquote>



<a name="199693138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199693138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199693138">(Jun 04 2020 at 00:16)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638526280">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>Yes. Moreover, I have the exact same problem with the <code>store8/load8</code> variants of instructions, and I assume also <code>store16/load16</code> though I haven't encountered those. The problem is that applying the knowledge from this PR to the <code>store8/load8</code> variants has not been successful as it looks like the meta code requires the cvar to be half the size of the result, whereas they should be independent.</p>
</blockquote>



<a name="199694027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199694027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199694027">(Jun 04 2020 at 00:31)</a>:</h4>
<p>abrown <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638530343">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>My comments are aimed at clarifying what we want these legalizations to do. But it occurs to me that this may be quicker in IM. I'm usually in <a href="#narrow/stream/217117-cranelift">https://bytecodealliance.zulipchat.com/#narrow/stream/217117-cranelift</a> and can discuss more tomorrow.</p>
</blockquote>



<a name="199694085"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/199694085" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#199694085">(Jun 04 2020 at 00:32)</a>:</h4>
<p>abrown edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-638530343">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>My comments are aimed at clarifying what we want these legalizations to do (so feel free to correct me above if I'm not getting the intent right). But it occurs to me that this may be quicker in IM. I'm usually in <a href="#narrow/stream/217117-cranelift">https://bytecodealliance.zulipchat.com/#narrow/stream/217117-cranelift</a> and can discuss more tomorrow.</p>
</blockquote>



<a name="202912295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202912295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202912295">(Jul 05 2020 at 08:50)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653859784">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>I think I'm going to close this because I see that the migration to the new backend is underway, and it feels like I'm not going to be able to get x86_32 support to a usable state before it gets removed.</p>
</blockquote>



<a name="202913020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202913020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202913020">(Jul 05 2020 at 09:13)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653862427">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>@whitequark this might make sense, but just to make sure we didn't accidentally create wrong impressions: the old backend framework won't be removed until sometime next year. We'll have switched the default for the x64 codegen to the new framework well before, after which very little will happen around the old one, but it'll stay in-tree for quite a while longer.</p>
</blockquote>



<a name="202913185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202913185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202913185">(Jul 05 2020 at 09:18)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653863105">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<blockquote>
<p>the old backend framework won't be removed until sometime next year</p>
</blockquote>
<p>I understand that, but I expect that, once the old backend is no longer heavily tested by the majority of the users, it's going to slowly bit-rot. Since the x86_32 code paths are marginal in first place, it would mean that I'd have to run twice as fast just to remain in the same place, and I don't expect to be able to do that.</p>
</blockquote>



<a name="202913344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202913344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202913344">(Jul 05 2020 at 09:23)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653863577">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<p>Oh and to add to this: I would be generally happy to work on x32 support in the new backend, but given that it's currently written to support x64 alone, it requires an amount of work I can't justify (and experience with x86 that I do not have). If someone else generalizes the x64 backend to support 32 bits too, like the old one, I'd help bring it to completion.</p>
</blockquote>



<a name="202914876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202914876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202914876">(Jul 05 2020 at 10:09)</a>:</h4>
<p>tschneidereit <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653868648">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<blockquote>
<p>Since the x86_32 code paths are marginal in first place, it would mean that I'd have to run twice as fast just to remain in the same place, and I don't expect to be able to do that.</p>
</blockquote>
<p>I thought that might be the reason, and makes sense to me, yes.</p>
<blockquote>
<p>If someone else generalizes the x64 backend to support 32 bits too, like the old one, I'd help bring it to completion.</p>
</blockquote>
<p>Much appreciated! I filed #1980 to look into what support for x86 in the new framework could look like.</p>
</blockquote>



<a name="202914999"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231789%20x86_32%3A%20legalize%20%7Bistore%2Csload%2Culo.../near/202914999" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231789.20x86_32.3A.20legalize.20.7Bistore.2Csload.2Culo.2E.2E.2E.html#202914999">(Jul 05 2020 at 10:12)</a>:</h4>
<p>whitequark <a href="https://github.com/bytecodealliance/wasmtime/pull/1789#issuecomment-653868933">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/1789">Issue #1789</a>:</p>
<blockquote>
<blockquote>
<p>I filed #1980 to look into what support for x86 in the new framework could look like.</p>
</blockquote>
<p>Thank you! Looking forward to it.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>