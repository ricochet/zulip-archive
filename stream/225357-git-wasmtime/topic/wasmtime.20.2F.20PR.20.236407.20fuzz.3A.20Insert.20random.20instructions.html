<html>
<head><meta charset="utf-8"><title>wasmtime / PR #6407 fuzz: Insert random instructions · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html">wasmtime / PR #6407 fuzz: Insert random instructions</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="359340612"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/359340612" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#359340612">(May 18 2023 at 09:15)</a>:</h4>
<p>remlse edited <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>:</p>
<blockquote>
<p>related to #4134 </p>
</blockquote>



<a name="359369265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/359369265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#359369265">(May 18 2023 at 11:30)</a>:</h4>
<p>remlse updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="359468263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/359468263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#359468263">(May 18 2023 at 18:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#pullrequestreview-1433236203">PR review</a>:</p>
<blockquote>
<p>This looks basically like what I expected -- I think it's a good addition to the suite of chaos techniques!</p>
</blockquote>



<a name="359468264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/359468264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#359468264">(May 18 2023 at 18:24)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#pullrequestreview-1433236203">PR review</a>:</p>
<blockquote>
<p>This looks basically like what I expected -- I think it's a good addition to the suite of chaos techniques!</p>
</blockquote>



<a name="359468265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/359468265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#359468265">(May 18 2023 at 18:24)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1198147811">PR review comment</a>:</p>
<blockquote>
<p>We could perhaps choose a float or int here, so we get the increased register pressure / potential clobbering of both kinds of registers. I guess that implies two kinds of <code>gen_imm</code> as well.</p>
</blockquote>



<a name="360380895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/360380895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#360380895">(May 22 2023 at 21:40)</a>:</h4>
<p>remlse updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="360381149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/360381149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#360381149">(May 22 2023 at 21:42)</a>:</h4>
<p>remlse created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1201188536">PR review comment</a>:</p>
<blockquote>
<p>The floats aren't working yet, I still have to figure out how to properly use a floating point register.</p>
</blockquote>



<a name="361002302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361002302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361002302">(May 25 2023 at 09:43)</a>:</h4>
<p>remlse updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="361007272"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361007272" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361007272">(May 25 2023 at 10:02)</a>:</h4>
<p>remlse created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1205290576">PR review comment</a>:</p>
<blockquote>
<p>An immediate floating point value seems to compile to the immediate value being stored in a general purpose register first, then moved to a floating point register (xmm).</p>
<p>So I did it the same way here. But I assume the abstraction is not right yet. The <code>MachInst</code> trait shouldn't contain references to implementation details of a specific backend.</p>
<p>If the <code>MachInst</code> trait had some method <code>gen_imm_f64</code>, what should it return? Just one of the existing instructions is not enough, I think, because a single instruction for immediate f64 values doesn't exist? And returning something like <code>Option&lt;(Self, Self)&gt;</code> also seems like a leaky abstraction.</p>
<p>@cfallin maybe you have an idea for the right abstraction here?</p>
</blockquote>



<a name="361133487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361133487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361133487">(May 25 2023 at 18:11)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1205861085">PR review comment</a>:</p>
<blockquote>
<p>@remlse a pattern we've used before successfully (see e.g. some instances in <code>abi.rs</code>) is to return a <code>SmallVec&lt;[Inst; 2]&gt;</code> (tweak inlined size as appropriate for expected max size). Then we have something like <code>for inst in M::gen_seq(...) { self.emit(inst); }</code> or whatever is appropriate at the callsite.</p>
</blockquote>



<a name="361240575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361240575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361240575">(May 26 2023 at 07:39)</a>:</h4>
<p>remlse updated <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="361244372"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361244372" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361244372">(May 26 2023 at 07:55)</a>:</h4>
<p>remlse created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1206373237">PR review comment</a>:</p>
<blockquote>
<p>That works well, thanks. <code>MachInst::gen_imm_f64</code> still "leaks" the fact that there may be a temporary general purpose register required, are you ok with that?</p>
</blockquote>



<a name="361411979"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361411979" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361411979">(May 26 2023 at 18:41)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1207192749">PR review comment</a>:</p>
<blockquote>
<p>Yep, that's fine, we have a notion of "this machine-specific sequence gets a tmp" elsewhere too. If you're happy with this please feel free to flip it to Ready to Review and I'll look over the whole thing!</p>
</blockquote>



<a name="361428444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361428444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361428444">(May 26 2023 at 20:05)</a>:</h4>
<p><strong>remlse</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a> as ready for review.</p>



<a name="361428447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361428447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361428447">(May 26 2023 at 20:05)</a>:</h4>
<p><strong>remlse</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="361428448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/361428448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#361428448">(May 26 2023 at 20:05)</a>:</h4>
<p><strong>remlse</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<a name="362740578"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/362740578" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#362740578">(Jun 01 2023 at 12:43)</a>:</h4>
<p>remlse created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1213093814">PR review comment</a>:</p>
<blockquote>
<p>@cfallin pinging in case you weren't notified when I marked the PR ready for review</p>
</blockquote>



<a name="362806872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/362806872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#362806872">(Jun 01 2023 at 16:03)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#discussion_r1213377533">PR review comment</a>:</p>
<blockquote>
<p>Ah, thanks, indeed that does not send an email so I missed it. Taking a final look now.</p>
</blockquote>



<a name="362807319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/362807319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#362807319">(Jun 01 2023 at 16:04)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/6407#pullrequestreview-1455831151">PR review</a>:</p>
<blockquote>
<p>LGTM!</p>
</blockquote>



<a name="362818869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%236407%20fuzz%3A%20Insert%20random%20instructions/near/362818869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.236407.20fuzz.3A.20Insert.20random.20instructions.html#362818869">(Jun 01 2023 at 16:43)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/6407">PR #6407</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>