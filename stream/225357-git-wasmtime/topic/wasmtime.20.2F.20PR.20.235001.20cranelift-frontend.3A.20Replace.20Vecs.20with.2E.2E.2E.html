<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5001 cranelift-frontend: Replace Vecs with... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235001.20cranelift-frontend.3A.20Replace.20Vecs.20with.2E.2E.2E.html">wasmtime / PR #5001 cranelift-frontend: Replace Vecs with...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="302127709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235001%20cranelift-frontend%3A%20Replace%20Vecs%20with.../near/302127709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235001.20cranelift-frontend.3A.20Replace.20Vecs.20with.2E.2E.2E.html#302127709">(Oct 03 2022 at 18:55)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5001">PR #5001</a>.</p>



<a name="302127710"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235001%20cranelift-frontend%3A%20Replace%20Vecs%20with.../near/302127710" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235001.20cranelift-frontend.3A.20Replace.20Vecs.20with.2E.2E.2E.html#302127710">(Oct 03 2022 at 18:55)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5001">PR #5001</a> from <code>more-ssa</code> to <code>main</code>:</p>
<blockquote>
<p>There are three main themes in this PR:</p>
<ol>
<li>Replace the <code>Vec</code> and <code>SmallVec</code> in <code>SSABlockData</code> with <code>EntityList</code>s using <code>ListPool</code>s kept in the <code>SSABuilder</code>.</li>
<li>Both of those vectors stored pairs, which <code>EntityList</code> doesn't easily support. But in both cases I was able to remove one element of the pair because it was uniquely determined by other information.</li>
<li>Determining the removed <code>Block</code> ID from a branch <code>Inst</code> is slower than just storing the block together with the branch, but I was able to remove most of those lookups.</li>
</ol>
<p>According to DHAT, compared with main, overal this PR uses 0.3% less memory at max heap, reads 0.6% fewer bytes, and writes 0.2% fewer bytes. It also executes fewer instructions and allocates less memory in total, by less than 0.1% each.</p>
<p>According to Hyperfine, this PR is "1.01 ± 0.01 times faster" than main when compiling Spidermonkey. On the other hand, Sightglass says main is 1.01x faster than this PR on the same benchmark by CPU cycles. In short, actual effects are too small to measure reliably.</p>
<p>By coincidence, the diff adds exactly as many lines as it removes, but a larger fraction of those lines are comments now.</p>
</blockquote>



<a name="302145142"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235001%20cranelift-frontend%3A%20Replace%20Vecs%20with.../near/302145142" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235001.20cranelift-frontend.3A.20Replace.20Vecs.20with.2E.2E.2E.html#302145142">(Oct 03 2022 at 20:42)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5001#pullrequestreview-1128998007">PR review</a>.</p>



<a name="302151989"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235001%20cranelift-frontend%3A%20Replace%20Vecs%20with.../near/302151989" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235001.20cranelift-frontend.3A.20Replace.20Vecs.20with.2E.2E.2E.html#302151989">(Oct 03 2022 at 21:29)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5001">PR #5001</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>