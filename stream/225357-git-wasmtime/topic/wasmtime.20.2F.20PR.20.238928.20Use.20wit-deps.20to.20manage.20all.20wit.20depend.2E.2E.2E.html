<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8928 Use wit-deps to manage all wit depend... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html">wasmtime / PR #8928 Use wit-deps to manage all wit depend...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="450342504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450342504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450342504">(Jul 10 2024 at 04:33)</a>:</h4>
<p>iawia002 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a> from <code>iawia002:wit-deps</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This patch uses the <a href="https://github.com/bytecodealliance/wit-deps">wit-deps</a> package to manage all wit dependencies (except wasi-nn for now):<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/7caca1624a3c68dd4135b3941e7c87d94eb4c7db/ci/vendor-wit.sh#L40-L43">https://github.com/bytecodealliance/wasmtime/blob/7caca1624a3c68dd4135b3941e7c87d94eb4c7db/ci/vendor-wit.sh#L40-L43</a></p>
<p>I believe this is a more understandable and automated approach compared to the <a href="https://github.com/bytecodealliance/wasmtime/blob/main/ci/vendor-wit.sh">bash script</a>, as it will automatically synchronize these wit dependencies during the build process.</p>
</blockquote>



<a name="450342505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450342505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450342505">(Jul 10 2024 at 04:33)</a>:</h4>
<p><strong>iawia002</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450342506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450342506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450342506">(Jul 10 2024 at 04:33)</a>:</h4>
<p><strong>iawia002</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450342507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450342507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450342507">(Jul 10 2024 at 04:33)</a>:</h4>
<p><strong>iawia002</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450343308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450343308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450343308">(Jul 10 2024 at 04:42)</a>:</h4>
<p>iawia002 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450344083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450344083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450344083">(Jul 10 2024 at 04:51)</a>:</h4>
<p>iawia002 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450480183"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450480183" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450480183">(Jul 10 2024 at 15:10)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8928#issuecomment-2220769761">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>:</p>
<blockquote>
<p>Thanks for the PR! While I don't disagree that this is better than bash in terms of readability this has a downside of depending on <code>wit-deps</code> at build time which is a bit of a hefty dependency to add to the build. For now I think it would be best to keep the same style of build where the wit files are checked in CI to be correct but otherwise there's no extra build dependencies for downstream users.</p>
</blockquote>



<a name="450482786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450482786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450482786">(Jul 10 2024 at 15:18)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8928#issuecomment-2220793752">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for the PR! While I don't disagree that this is better than bash in terms of readability this has a downside of depending on <code>wit-deps</code> at build time which is a bit of a hefty dependency to add to the build. For now I think it would be best to keep the same style of build where the wit files are checked in CI to be correct but otherwise there's no extra build dependencies for downstream users.</p>
</blockquote>
<p>What I’m doing in a project of mine at the moment is to use wit-deps in a test to check that everything is up to date (but to also keep the wit field checked in … well technically my solution uses git submodules to avoid checking the files in directly, but that doesn’t matter for the test) - this makes the dependency a dev-dependency only so that it should not burden any downstream users</p>
</blockquote>



<a name="450516055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450516055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450516055">(Jul 10 2024 at 17:28)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/pull/8928#issuecomment-2221077509">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>:</p>
<blockquote>
<p>Seconding what Alex said: we should run this in CI, not on every single build of the <code>wasmtime</code> crate.</p>
</blockquote>



<a name="450607212"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450607212" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450607212">(Jul 11 2024 at 02:05)</a>:</h4>
<p>iawia002 <a href="https://github.com/bytecodealliance/wasmtime/pull/8928#issuecomment-2221849156">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>:</p>
<blockquote>
<p>Thank all for your feedback. I understand your concerns and have made some improvements. I will no longer use <code>build.rs</code> to update dependencies. The process will remain as it is now, but developers will need to install the <code>wit-deps</code> CLI tool to update wit files locally.</p>
<p>Going back to the original reason why I wanted to make this change:</p>
<ol>
<li>
<p>I noticed that the current bash script keeps the dependencies of the <code>wasi</code> and <code>wasi-http</code> crates in sync, but in fact, the <code>wasi</code> crate does not need the <code>http</code> world: <a href="https://github.com/bytecodealliance/wasmtime/blob/0e5048e20a24f6da19b3794eeb94111f052dc414/crates/wasi/src/bindings.rs#L148-L150">https://github.com/bytecodealliance/wasmtime/blob/0e5048e20a24f6da19b3794eeb94111f052dc414/crates/wasi/src/bindings.rs#L148-L150</a><br>
In the bash script, achieving this differentiation requires more code. If this patch is accepted, I will submit another PR to do some cleanup.</p>
</li>
<li>
<p>When I tried to <a href="https://github.com/bytecodealliance/wasmtime/issues/8929">implement <code>wasi-runtime-config</code></a>, since it is still a draft version, its tag is different from <code>cli</code> and <code>http</code> etc. To manage its wit dependencies, I had to add some code to the bash script to download files individually. If there are more different versions of wit dependencies in the future, the bash script will become very complex.</p>
</li>
</ol>
<p>PTAL if this change is reasonable.</p>
</blockquote>



<a name="450607326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450607326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450607326">(Jul 11 2024 at 02:06)</a>:</h4>
<p>iawia002 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450633482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450633482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450633482">(Jul 11 2024 at 06:57)</a>:</h4>
<p>iawia002 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<a name="450729419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/450729419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#450729419">(Jul 11 2024 at 14:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8928#issuecomment-2223133390">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>:</p>
<blockquote>
<p>Functionally this is much better, thanks! Personally though I'd at least personally prefer to stick to the bash script for now. I'm worried to pick up another tool as part of our build which much of us don't understand and it's not buying us much over a bash script. I don't disagree that the bash script is going to get a bit more complicated over time but I think the complexity is relatively manageable. For example it's not really an issue that HTTP WIT files are part of the <code>wasmtime-wasi</code> crate. Adding support for downloading another version of things to a different location shouldn't greatly increase the complexity of the script either.</p>
<p>Some other reasons I'd prefer to stick to a script for now:</p>
<ul>
<li>Installation of <code>wit-deps</code> is yet-another-tool to manage in CI. For example <code>cargo install</code> here doesn't use <code>--locked</code> to prevent errors over time with mistakes in publishing to <a href="http://crates.io">crates.io</a>. It also doesn't specify a version to install so we'd be susceptible to breakage in terms of if <code>wit-deps</code>changes. This is all fixable but is adding more overhead relative to a script.</li>
<li>We can't exclusively use <code>wit-deps</code> because wasi-nn doesn't support it. That means we still need a script to do things. Additionally the script is required to matter what to pass the right arguments to <code>wit-deps</code>.</li>
</ul>
<p>Overall I think it may just not be the right time to switch away from bash scripts. If the shell script could go away entirely I think that's the right time to migrate to a different tool, but I don't think that we're there yet.</p>
</blockquote>



<a name="452106007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238928%20Use%20wit-deps%20to%20manage%20all%20wit%20depend.../near/452106007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238928.20Use.20wit-deps.20to.20manage.20all.20wit.20depend.2E.2E.2E.html#452106007">(Jul 17 2024 at 15:17)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/8928">PR #8928</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>