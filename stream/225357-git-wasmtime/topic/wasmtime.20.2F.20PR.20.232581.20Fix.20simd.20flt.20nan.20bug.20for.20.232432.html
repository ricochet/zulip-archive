<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2581 Fix simd flt nan bug for #2432 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html">wasmtime / PR #2581 Fix simd flt nan bug for #2432</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="222674684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222674684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222674684">(Jan 14 2021 at 02:47)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2581">PR #2581</a> from <code>fix-simd-flt-nan-bug-for-2432</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222675363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222675363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222675363">(Jan 14 2021 at 03:01)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2581">PR #2581</a> from <code>fix-simd-flt-nan-bug-for-2432</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="222676131"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222676131" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222676131">(Jan 14 2021 at 03:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-567823962">PR Review</a>.</p>



<a name="222677111"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222677111" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222677111">(Jan 14 2021 at 03:44)</a>:</h4>
<p>jlb6740 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2581">PR #2581</a>.</p>



<a name="222746543"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222746543" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222746543">(Jan 14 2021 at 16:56)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568433273">PR Review</a>.</p>



<a name="222746544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222746544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222746544">(Jan 14 2021 at 16:56)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557545946">PR Review Comment</a>:</p>
<blockquote>
<p>Looks like this should have been <code>FloatCC::UnorderedOrGreaterThanOrEqual</code> which uses <code>FcmpImm::UnorderedOrGreaterThanOrEqual</code> to encode to the <code>0x05</code> immediate. Using that might avoid the extra <code>XORPS</code>.</p>
</blockquote>



<a name="222746958"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222746958" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222746958">(Jan 14 2021 at 16:59)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557548038">PR Review Comment</a>:</p>
<blockquote>
<p>In the old backend we were using <code>PCMPEQB</code> to generate the "all ones vector" so this wasn't a problem, but I think in this new backend we should check around and make sure no more of the "all ones vectors" we create will have this same issue. Before Christmas I was working on a PR to simplify constant emission so that we only have one place to check... looks like I should have finished that.</p>
</blockquote>



<a name="222746959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222746959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222746959">(Jan 14 2021 at 16:59)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568436287">PR Review</a>.</p>



<a name="222755804"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222755804" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222755804">(Jan 14 2021 at 17:55)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568484196">PR Review</a>.</p>



<a name="222755805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222755805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222755805">(Jan 14 2021 at 17:55)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557584231">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, my understanding (after some more reading) is that the i8x16 (pcmpeqb) variant is more canonical; would prefer that over reasoning about FP comparison edge cases. +1 to centralizing this logic!</p>
</blockquote>



<a name="222756711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222756711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222756711">(Jan 14 2021 at 18:01)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568488929">PR Review</a>.</p>



<a name="222756712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222756712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222756712">(Jan 14 2021 at 18:01)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557587852">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>UnorderedOrGreaterThanOrEqual</p>
</blockquote>
<p>Yes, I suppose any unordered instruction that also checks for equality should work. Just depends on what that actually lowers to and the supported CPU feature. That encoding to 0x05 ( NLT_US) looks good except it signals. Not really sure what that means for cranelift .. maybe @cfallin @abrown you have comment. Perhaps instead we'd want to encode as 0x15 or NLT_UQ which does not signal.</p>
</blockquote>



<a name="222756780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222756780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222756780">(Jan 14 2021 at 18:01)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568489280">PR Review</a>.</p>



<a name="222756784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222756784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222756784">(Jan 14 2021 at 18:01)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557588097">PR Review Comment</a>:</p>
<blockquote>
<p><a href="https://www.felixcloutier.com/x86/cmppd#tbl-3-1">https://www.felixcloutier.com/x86/cmppd#tbl-3-1</a></p>
</blockquote>



<a name="222763526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222763526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222763526">(Jan 14 2021 at 18:47)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#pullrequestreview-568522674">PR Review</a>.</p>



<a name="222763527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232581%20Fix%20simd%20flt%20nan%20bug%20for%20%232432/near/222763527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232581.20Fix.20simd.20flt.20nan.20bug.20for.20.232432.html#222763527">(Jan 14 2021 at 18:47)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2581#discussion_r557613859">PR Review Comment</a>:</p>
<blockquote>
<p>That does look better <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>