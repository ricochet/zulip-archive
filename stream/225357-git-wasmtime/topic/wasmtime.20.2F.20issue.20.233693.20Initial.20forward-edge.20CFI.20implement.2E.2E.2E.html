<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3693 Initial forward-edge CFI implement... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html">wasmtime / issue #3693 Initial forward-edge CFI implement...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="281158442"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/281158442" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#281158442">(May 04 2022 at 13:56)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1117346040">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="281191673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/281191673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#281191673">(May 04 2022 at 17:37)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1117624403">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>Note that the <code>region</code> crate lacks support for BTI (reported in <a href="https://github.com/darfink/region-rs/issues/21">darfink/region-rs#21</a>), so I have used a work-around - a direct call to <code>libc::mprotect()</code>.</p>
</blockquote>



<a name="287165457"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/287165457" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#287165457">(Jun 23 2022 at 09:40)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1164184960">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>@alexcrichton I added you as reviewer for the Wasmtime bits.</p>
</blockquote>



<a name="293717919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293717919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293717919">(Aug 16 2022 at 13:25)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216635867">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>@alexcrichton I wanted to finish with the pointer authentication PR before coming back to this one:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>* If a module is compiled with bti support and loaded into an engine that has bti support disabled, that&#39;s fine right? (since everything is a nop)
</code></pre></div>

</blockquote>
<p>Yes, that is correct; we just have to make sure that we do not request the <code>PROT_BTI</code> memory protection mode from the kernel, since the system call is going to fail.</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>* If a module is not compiled with bti support, but is loaded into an engine with bti support, that&#39;s bad right? (in that none of the branches are protected but the page permissions say that all branches need protection?)
</code></pre></div>

</blockquote>
<p>Yes, assuming that the engine applies <code>PROT_BTI</code> unconditionally to all executable memory pages.</p>
<p>The current implementation supports the full flexibility the BTI extension enables, so we have to decouple the following:</p>
<ul>
<li>whether the user passed <code>--cranelift-enable use_bti</code> on the Wasmtime command line</li>
<li>whether the environment (i.e. CPU and OS) supports BTI</li>
<li>whether the module that the engine is trying to load has been compiled to use BTI instructions; also, if I am not mistaken, the engine could be trying to load several modules, which might not necessarily have been compiled with the same settings</li>
</ul>
</blockquote>



<a name="293728150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293728150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293728150">(Aug 16 2022 at 14:25)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the cranelift JIT to run runtests so we can also test the JIT portion of this PR.</p>
<p>We don't yet support <code>call</code>s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
</blockquote>



<a name="293728187"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293728187" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293728187">(Aug 16 2022 at 14:25)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the cranelift JIT to run runtests so we can also test the <code>cranelift-jit</code> portion of this PR.</p>
<p>We don't yet support <code>call</code>s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
</blockquote>



<a name="293728196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293728196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293728196">(Aug 16 2022 at 14:25)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the cranelift JIT to run runtests so we can also test the <code>cranelift-jit</code> portion of this PR.</p>
<p>We don't yet support <code>call</code>'s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
</blockquote>



<a name="293729139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293729139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293729139">(Aug 16 2022 at 14:29)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the <code>cranelift-jit</code> to run runtests so we can also test the <code>cranelift-jit</code> portion of this PR.</p>
<p>We don't yet support <code>call</code>'s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
</blockquote>



<a name="293729520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293729520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293729520">(Aug 16 2022 at 14:31)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the <code>cranelift-jit</code> to run runtests so we can also test the <code>cranelift-jit</code> portion of this PR.</p>
<p>We don't yet support <code>call</code>'s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
<p>Also, should we add <code>bti</code> detection in <code>cranelift-native</code>?</p>
</blockquote>



<a name="293729702"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293729702" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293729702">(Aug 16 2022 at 14:32)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1216710905">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>We should add a <code>target aarch64 use_bti</code> to <code>runtests/br_table.clif</code>, we now use the <code>cranelift-jit</code> to run runtests so we can also test the <code>cranelift-jit</code> portion of this PR.</p>
<p>We don't yet support <code>call</code>'s, but that's something I'm addressing in #4667, and can add some bti runtests there as well.</p>
</blockquote>



<a name="293794076"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/293794076" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#293794076">(Aug 16 2022 at 20:23)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1217121327">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>Ah sorry ok I see why this can't be an <code>Engine</code>-level thing. If that's the case though instead of ferrying a separate <code>bool</code> through the system could this get attached to <code>CompiledModuleInfo</code> somewhere internally? </p>
</blockquote>



<a name="294661498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233693%20Initial%20forward-edge%20CFI%20implement.../near/294661498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233693.20Initial.20forward-edge.20CFI.20implement.2E.2E.2E.html#294661498">(Aug 22 2022 at 12:08)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/pull/3693#issuecomment-1222265028">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/3693">issue #3693</a>:</p>
<blockquote>
<p>@cfallin I think that I have resolved all of @alexcrichton's comments that are related to Wasmtime, so do you have any feedback on the Cranelift side of things?</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>