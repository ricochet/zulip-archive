<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1530 Pending arm64 fixes for Spidermonkey ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html">wasmtime / PR #1530 Pending arm64 fixes for Spidermonkey ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194436607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194436607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194436607">(Apr 17 2020 at 13:06)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a> from <code>bbouvier-arm64-fixes</code> to <code>master</code>:</p>
<blockquote>
<p>This rebases and adapts patches that landed in our arm64 work-in-progress branch after the last commit that was merged with the new arm64 backend.</p>
<p>Commit 8f181f8 is a bit invasive, because it propagates the <code>settings::Flags</code> down to the arm64 machinery, and the ABI has to be marked with the Flags' lifetime. I hesitated with just doing a copy, but it's not too bad as is.</p>
</blockquote>



<a name="194436608"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194436608" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194436608">(Apr 17 2020 at 13:06)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin" title="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a>.</p>



<a name="194451925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194451925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194451925">(Apr 17 2020 at 14:51)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395523973" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395523973">PR Review</a>.</p>



<a name="194451926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194451926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194451926">(Apr 17 2020 at 14:51)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410275568" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410275568">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // X22 - X28
</pre></div>


</blockquote>



<a name="194482730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482730">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395679412" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395679412">PR Review</a>.</p>



<a name="194482731"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482731" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482731">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395679412" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-395679412">PR Review</a>.</p>



<a name="194482732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482732">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410398295" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410398295">PR Review Comment</a>:</p>
<blockquote>
<p>Doc comment now that this is <code>pub</code>?</p>
</blockquote>



<a name="194482733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482733">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410396743" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410396743">PR Review Comment</a>:</p>
<blockquote>
<p>I understand the optimization here but this <code>Writable</code> cast makes me a little nervous; perhaps it would be better to take a <code>Writable&lt;Reg&gt;</code> for <code>from_reg</code> to enable this? Then the safety argument is a completely local property of the machine-independent lowering code that calls us: it knows that it's generating the copy into the retval just before the epilogue, and so can break its usual "SSA value's register is only writable at SSA def point" invariant (or if it does something different, allocate a writable temp to use here).</p>
</blockquote>



<a name="194482734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482734">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410397781" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410397781">PR Review Comment</a>:</p>
<blockquote>
<p>Can we just create an <code>Inst::Move</code> and then <code>inst.emit(sink);</code> as we do for the other pseudoinstructions?</p>
</blockquote>



<a name="194482735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194482735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194482735">(Apr 17 2020 at 18:36)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410399926" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r410399926">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not super-excited about the <code>'flags</code> lifetime carried into the <code>VCode</code>; it will propagate to anything else that contains a <code>VCode</code> which is not very ergonomic. (On preview of the rest of the patch below, it already led to a lot of boilerplate churn.) Reading the generated code, it looks like it's currently a <code>[u8; 7]</code> (so the pointer is larger than the flags array itself!). In general, with a bit per flag, I wouldn't expect it to grow beyond a few words, for a while anyway. Could we just clone it instead?</p>
</blockquote>



<a name="194781782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194781782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194781782">(Apr 21 2020 at 10:01)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397178924" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397178924">PR Review</a>.</p>



<a name="194781785"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194781785" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194781785">(Apr 21 2020 at 10:01)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412048368" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412048368">PR Review Comment</a>:</p>
<blockquote>
<p>Oh yes, it's much simpler.</p>
</blockquote>



<a name="194781830"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194781830" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194781830">(Apr 21 2020 at 10:01)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a> from <code>bbouvier-arm64-fixes</code> to <code>master</code>:</p>
<blockquote>
<p>This rebases and adapts patches that landed in our arm64 work-in-progress branch after the last commit that was merged with the new arm64 backend.</p>
<p>Commit 8f181f8 is a bit invasive, because it propagates the <code>settings::Flags</code> down to the arm64 machinery, and the ABI has to be marked with the Flags' lifetime. I hesitated with just doing a copy, but it's not too bad as is.</p>
</blockquote>



<a name="194781906"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194781906" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194781906">(Apr 21 2020 at 10:02)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin" title="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a>.</p>



<a name="194782664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194782664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194782664">(Apr 21 2020 at 10:13)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a> from <code>bbouvier-arm64-fixes</code> to <code>master</code>:</p>
<blockquote>
<p>This rebases and adapts patches that landed in our arm64 work-in-progress branch after the last commit that was merged with the new arm64 backend.</p>
<p>Commit 8f181f8 is a bit invasive, because it propagates the <code>settings::Flags</code> down to the arm64 machinery, and the ABI has to be marked with the Flags' lifetime. I hesitated with just doing a copy, but it's not too bad as is.</p>
</blockquote>



<a name="194783294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194783294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194783294">(Apr 21 2020 at 10:20)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412060939" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412060939">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be updated?</p>
</blockquote>



<a name="194783295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194783295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194783295">(Apr 21 2020 at 10:20)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397193109" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397193109">PR Review</a>.</p>



<a name="194783335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194783335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194783335">(Apr 21 2020 at 10:21)</a>:</h4>
<p>bjorn3 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412060939" title="https://github.com/bytecodealliance/wasmtime/pull/1530#discussion_r412060939">PR Review Comment</a>.</p>



<a name="194815810"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194815810" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194815810">(Apr 21 2020 at 15:07)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397426771" title="https://github.com/bytecodealliance/wasmtime/pull/1530#pullrequestreview-397426771">PR Review</a>.</p>



<a name="194815892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231530%20Pending%20arm64%20fixes%20for%20Spidermonkey%20.../near/194815892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231530.20Pending.20arm64.20fixes.20for.20Spidermonkey.20.2E.2E.2E.html#194815892">(Apr 21 2020 at 15:08)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1530" title="https://github.com/bytecodealliance/wasmtime/pull/1530">PR #1530</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>