<html>
<head><meta charset="utf-8"><title>wasmtime / issue #4271 add riscv64 backend for cranelift. · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html">wasmtime / issue #4271 add riscv64 backend for cranelift.</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="286183018"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286183018" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286183018">(Jun 15 2022 at 08:56)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1156191095">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>ci did not pass because I used  is_riscv_feature_detected which is in std library.</p>
</blockquote>



<a name="286207351"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286207351" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286207351">(Jun 15 2022 at 12:54)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1156435762">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Hi @yuyang-ok -- thanks for this! I will take a detailed look next week when I'm back in the office. At a high level, my initial feedback is that new backends need to use ISLE for all instruction lowerings; we're working on migrating the others, and we don't want to create more work for ourselves by adopting a half-migrated backend. So, the <code>lower_inst.rs</code> file should be essentially empty (right now it has a bunch of handwritten lowerings). But now that you have a working backend, hopefully doing this is a bit easier than starting from scratch!</p>
</blockquote>



<a name="286278703"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286278703" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286278703">(Jun 15 2022 at 21:48)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1156980167">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>ok I will improve this.</p>
</blockquote>



<a name="286288080"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286288080" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286288080">(Jun 15 2022 at 23:25)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1157070019">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I didnot using isle to write a very much logic , I think isle is very good at match.turns out <a href="http://lower_inst.rs">lower_inst.rs</a> and <a href="http://isle.rs">isle.rs</a> is quit large now!</p>
</blockquote>



<a name="286865687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286865687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286865687">(Jun 21 2022 at 04:57)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1161267459">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin are you reviewing this?</p>
</blockquote>



<a name="286935126"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286935126" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286935126">(Jun 21 2022 at 15:53)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1161945800">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>hi @yuyang-ok -- no, not yet; I just got back this morning. I would expect this to take some time, especially for a 21k-line PR.</p>
<p>At a high level, though, three questions:</p>
<ul>
<li>
<p>My question about ISLE is I think still unanswered: are you planning to update this PR to use only ISLE lowering patterns, and not handwritten code? That is our standard for all new backend code and we cannot merge a new backend that uses the legacy approach.</p>
</li>
<li>
<p>Grepping for "todo" in this code, I still see a bunch of comments -- picking one example, "//todo what is this??" We unfortunately can't merge things like that (they are fine for draft PRs but not for production code): please make a pass through the PR and resolve all TODOs or uncertainties.</p>
</li>
</ul>
<p>I think it would also be good to talk about ongoing expectations once a new backend is merged. I mentioned this in some earlier feedback as well, but: we want to make sure that every backend has some person or people who specialize in the architecture actively involved in the project. This is part of why I'm asking about your future plans: this PR is the start, but shouldn't be the only step. To this end, would you be willing to attend the Cranelift biweekly meeting at some point so we can talk about your new backend and plans?</p>
<p>Thanks for all your hard work on this so far!</p>
</blockquote>



<a name="286935197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286935197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286935197">(Jun 21 2022 at 15:54)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1161945800">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>hi @yuyang-ok -- no, not yet; I just got back this morning. I would expect this to take some time, especially for a 21k-line PR.</p>
<p>At a high level, though, three questions:</p>
<ul>
<li>
<p>My question about ISLE is I think still unanswered: are you planning to update this PR to use only ISLE lowering patterns, and not handwritten code? That is our standard for all new backend code and we cannot merge a new backend that uses the legacy approach.</p>
</li>
<li>
<p>Grepping for "todo" in this code, I still see a bunch of comments -- picking one example, "//todo what is this??" We unfortunately can't merge things like that (they are fine for draft PRs but not for production code): please make a pass through the PR and resolve all TODOs or uncertainties.</p>
</li>
</ul>
<p>I think it would also be good to talk about ongoing expectations once a new backend is merged. I mentioned this in some earlier feedback as well, but: we want to make sure that every backend has some person or people who specialize in the architecture actively involved in the project. This is part of why I'm asking about your future plans: this PR is the start, but shouldn't be the only step. To this end, would you be willing to attend the Cranelift biweekly meeting at some point so we can talk about your new backend and plans?</p>
<p>Thanks for all your hard work on this so far!</p>
</blockquote>



<a name="286986525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/286986525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#286986525">(Jun 21 2022 at 23:25)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1162457009">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I think it is fine to use ISLE to lowering inst instead of handwritten code, I think maybe the way I am using ISLE is not very good right now,I should  doing this part of work after the review.</p>
<p>yes,software is never an one time job,software will evolve from time to time,I think at least I can maintain riscv64 backend, I am happy  attend the Cranelift biweekly meeting at some point.</p>
</blockquote>



<a name="287671108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/287671108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#287671108">(Jun 28 2022 at 05:02)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1168224742">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I think need provides an extractor.</p>
</blockquote>
<p>(decl value_inst(Inst)Value)<br>
(extern extractor value_inst value_inst)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">look</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">"trapff"</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">lowering</span><span class="p">.</span><span class="w"></span>
<span class="n">So</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="n">parameters</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="288240925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288240925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288240925">(Jul 02 2022 at 01:49)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1172811022">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin still waiting for you review. :)</p>
</blockquote>



<a name="288248017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288248017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288248017">(Jul 02 2022 at 04:28)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1172811022">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin still waiting for your review. :)</p>
</blockquote>



<a name="288248562"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288248562" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288248562">(Jul 02 2022 at 04:41)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1172833290">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@yuyang-ok unfortunately, I still have not gotten to it, sorry.</p>
<p>It looks like you still have code in legacy handwritten lowerings, though you're slowly moving it over to ISLE -- that's good, please keep doing that. I think it makes the most sense to review this PR once that is done.</p>
<p>LIkewise, I still see large blocks of commented-out code. As a random example, I see</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// println!("xxxx : {}", buffer.disasm.unwrap());</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">buffer</span><span class="p">.</span><span class="n">data</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// write_to_a_file("/home/yuyang/tmp/code.bin", code);</span>
<span class="w">        </span><span class="c1">//0:   000015b7                lui     a1,0x1</span>
<span class="w">        </span><span class="c1">//4:   23458593                addi    a1,a1,564 # 0x1234</span>
<span class="w">        </span><span class="c1">//8:   00b5053b                addw    a0,a0,a1</span>
<span class="w">        </span><span class="c1">//c:   00008067</span>
</code></pre></div>
<p>Please carefully go over your code and remove anything you would not want merged into the main branch.</p>
<p>Regarding your continued pings: unfortunately, reviewing a 21,000-line PR is not a small task. It will probably take me a few days to a week to read through all of your code in detail. I have an enormous amount of work on my plate, with varying levels of priority. I also spent all last week with COVID and am still working through some backlog from that time away. So, I haven't gotten to this yet, and pinging me will not make the TODO list go faster.</p>
<p>While we very much appreciate the contribution -- having a RISC-V backend will be very valuable for Cranelift -- this process will require patience as well. Thanks!</p>
</blockquote>



<a name="288251149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288251149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288251149">(Jul 02 2022 at 05:48)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1172840607">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  ok ,thanks,take care of yourself.</p>
</blockquote>



<a name="288613144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288613144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288613144">(Jul 06 2022 at 01:52)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1175688282">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin ok.</p>
</blockquote>



<a name="288619875"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288619875" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288619875">(Jul 06 2022 at 03:45)</a>:</h4>
<p>dunxen <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1175745370">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Hi @yuyang-ok, it's great that you've started the work on this, and thanks @cfallin for the mention. I do indeed have an interest in seeing this through.</p>
<p>I'll be able to give a thorough pass of this later today and throughout the rest of the week.</p>
</blockquote>



<a name="288886462"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/288886462" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#288886462">(Jul 08 2022 at 01:24)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1178433297">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>abi document I found it at <a href="https://github.com/riscv-non-isa/riscv-elf-psabi-doc">https://github.com/riscv-non-isa/riscv-elf-psabi-doc</a></p>
</blockquote>



<a name="289907858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/289907858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#289907858">(Jul 17 2022 at 22:28)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1186618999">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>some part of wasmtime cannot compiler on target riscv64.<br>
@cfallin @afonso360 @bjorn3 @bjorn3  </p>
<p>![image](<a href="https://user-images.githubusercontent.com/96557710/179427225-c1b908b3-6fdf-4213-a647-7595e35c0683.png">https://user-images.githubusercontent.com/96557710/179427225-c1b908b3-6fdf-4213-a647-7595e35c0683.png</a>)</p>
</blockquote>



<a name="289919876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/289919876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#289919876">(Jul 18 2022 at 03:51)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1186734601">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@yuyang-ok a port of <code>wasmtime</code>'s CPU-dependent bits -- the fiber library, and the trap handler details, at least -- would probably not be too much work beyond a pure Cranelift-only port, and is needed in any case for the port to be useful: otherwise, all we can do is exercise it with filetests. Enabling wasmtime on the platform allows us to run the Wasm test suite as well. So, yes, you've run into that missing support; would you be willing to build it? Or if not, perhaps another contributor could help?</p>
</blockquote>



<a name="289928208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/289928208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#289928208">(Jul 18 2022 at 06:44)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1186825596">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I like to give it a try.</p>
</blockquote>



<a name="290719839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/290719839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#290719839">(Jul 25 2022 at 05:04)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1193582384">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>can Someone help to port <a href="https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber">https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber</a> to riscv64,<br>
I am not very understand of this lib.<br>
thanks.</p>
</blockquote>



<a name="290720449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/290720449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#290720449">(Jul 25 2022 at 05:20)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1193582384">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>can Someone help to port <a href="https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber">https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber</a> to riscv64,<br>
I am not very understand of this lib.<br>
thanks.</p>
</blockquote>



<a name="290731722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/290731722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#290731722">(Jul 25 2022 at 08:29)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1193746025">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>can Someone help to port <a href="https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber">https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber</a> to riscv64,<br>
I am not very understand of this lib.<br>
thanks.</p>
</blockquote>
<p>I would suggest leaving that for a future PR. We can merge the backend independently and then start working on a port for wasmtime later. That would also make it a lot easier to review, since this is already a lot of code to review.</p>
</blockquote>



<a name="290731825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/290731825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#290731825">(Jul 25 2022 at 08:30)</a>:</h4>
<p>afonso360 deleted a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1193746025">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>can Someone help to port <a href="https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber">https://github.com/bytecodealliance/wasmtime/tree/main/crates/fiber</a> to riscv64,<br>
I am not very understand of this lib.<br>
thanks.</p>
</blockquote>
<p>I would suggest leaving that for a future PR. We can merge the backend independently and then start working on a port for wasmtime later. That would also make it a lot easier to review, since this is already a lot of code to review.</p>
</blockquote>



<a name="292305447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292305447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292305447">(Aug 07 2022 at 07:42)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207350646">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>![image](<a href="https://user-images.githubusercontent.com/96557710/183280640-7d38e007-b998-4645-96cd-96d532e6c631.png">https://user-images.githubusercontent.com/96557710/183280640-7d38e007-b998-4645-96cd-96d532e6c631.png</a>)<br>
@cfallin is this project rely on v8,there are still some part not compile.</p>
</blockquote>



<a name="292308070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292308070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292308070">(Aug 07 2022 at 08:49)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207360445">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>If v8 doesn't support riscv, it should be fine to disable the fuzzers that check wasmtime against v8.</p>
</blockquote>



<a name="292308073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292308073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292308073">(Aug 07 2022 at 08:49)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207360445">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>If v8 doesn't support riscv, it should be fine to disable the fuzzers that check wasmtime against v8 I think.</p>
</blockquote>



<a name="292350912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292350912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292350912">(Aug 08 2022 at 00:53)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207530465">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin @bjorn3 @afonso360 @afonso360  I think  it's the time to review.I think I fix most of the problems.</p>
</blockquote>



<a name="292352902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292352902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292352902">(Aug 08 2022 at 01:43)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207558745">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin @bjorn3 @afonso360 @afonso360 I think it's the time to review.I think I fix most of the problems.</p>
</blockquote>
<p>@yuyang-ok I scanned through the diff at places where I had left comments before, and it looks like almost none of my comments have been addressed. Some of them are fairly small things, like formatting and typo fixes; others are more substantial, like "no commented-out code, please" or a general indication that some code needs to be cleaned up. Could you please address all of these comments, and then let us know when that is done?</p>
<p>Also, above (in <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1175745370">this comment</a> I see @dunxen expressed interest in making a clean-up pass over this PR. @dunxen, are you still willing to do this? If so, it seems that either after @yuyang-ok makes a pass or beforehand (coordinating with them as necessary) might be a good time for this. Thanks (and no worries if no longer able)!</p>
<p>I'm happy to see the qemu CI job added (does this mean Wasmtime fully works now?); I look forward to seeing this merged eventually, once it is cleaned up a bit!</p>
</blockquote>



<a name="292352915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292352915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292352915">(Aug 08 2022 at 01:44)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207558745">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin @bjorn3 @afonso360 @afonso360 I think it's the time to review.I think I fix most of the problems.</p>
</blockquote>
<p>@yuyang-ok I scanned through the diff at places where I had left comments before, and it looks like almost none of my comments have been addressed. Some of them are fairly small things, like formatting and typo fixes; others are more substantial, like "no commented-out code, please" or a general indication that some code needs to be cleaned up. Could you please address all of these comments, and then let us know when that is done?</p>
<p>Also, above (in <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1175745370">this comment</a>) I see @dunxen expressed interest in making a clean-up pass over this PR. @dunxen, are you still willing to do this? If so, it seems that either after @yuyang-ok makes a pass or beforehand (coordinating with them as necessary) might be a good time for this. Thanks (and no worries if no longer able)!</p>
<p>I'm happy to see the qemu CI job added (does this mean Wasmtime fully works now?); I look forward to seeing this merged eventually, once it is cleaned up a bit!</p>
</blockquote>



<a name="292353953"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292353953" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292353953">(Aug 08 2022 at 02:09)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207572395">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin ok , I will do a full check.</p>
</blockquote>



<a name="292354238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292354238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292354238">(Aug 08 2022 at 02:15)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207576634">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>wasmtime is not fully workd,because rusty_v8 cannot be compiler on riscv64.</p>
</blockquote>



<a name="292356347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292356347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292356347">(Aug 08 2022 at 03:09)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207602367">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>wasmtime is not fully workd,because rusty_v8 cannot be compiler on riscv64.</p>
</blockquote>
<p>That's fine, as @bjorn3 mentions above V8 is only needed for one fuzzing target. You can disable it on riscv64.</p>
</blockquote>



<a name="292365913"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292365913" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292365913">(Aug 08 2022 at 06:47)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207732948">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>why I cannot find all conversations.<br>
![image](<a href="https://user-images.githubusercontent.com/96557710/183356169-cb4f7e19-4918-4ee8-8296-a6193ee082dd.png">https://user-images.githubusercontent.com/96557710/183356169-cb4f7e19-4918-4ee8-8296-a6193ee082dd.png</a>)<br>
some comment not show. why?</p>
</blockquote>



<a name="292367716"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292367716" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292367716">(Aug 08 2022 at 07:15)</a>:</h4>
<p>yuyang-ok deleted a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207732948">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>why I cannot find all conversations.<br>
![image](<a href="https://user-images.githubusercontent.com/96557710/183356169-cb4f7e19-4918-4ee8-8296-a6193ee082dd.png">https://user-images.githubusercontent.com/96557710/183356169-cb4f7e19-4918-4ee8-8296-a6193ee082dd.png</a>)<br>
some comment not show. why?</p>
</blockquote>



<a name="292377135"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292377135" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292377135">(Aug 08 2022 at 09:08)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1207864298">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Running <code>cargo test --target riscv64gc-unknown-linux-gnu</code> from the root of the repository it looks like we are also missing some other stuff for wasmtime, such as trampolines and trap handling.</p>
<p>&lt;details&gt;<br>
  &lt;summary&gt;Output:&lt;/summary&gt;</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">unsupported</span><span class="w"> </span><span class="n">architecture</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">trampolines</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">55</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">55</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="fm">compile_error!</span><span class="p">(</span><span class="s">"unsupported architecture"</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">unsupported</span><span class="w"> </span><span class="n">architecture</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">46</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w"></span>
<span class="mi">46</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="fm">compile_error!</span><span class="p">(</span><span class="s">"unsupported architecture"</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">unsupported</span><span class="w"> </span><span class="n">platform</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">unix</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">232</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">232</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="fm">compile_error!</span><span class="p">(</span><span class="s">"unsupported platform"</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">cannot</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">wasm_to_libcall_trampoline</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">scope</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">libcalls</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="n">wasm_to_libcall_trampoline</span><span class="o">!</span><span class="p">(</span><span class="cp">$name</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">impl_</span><span class="w"> </span><span class="cp">$name</span><span class="o">&gt;</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                 </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w"></span>
<span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="mi">130</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">wasmtime_environ</span>::<span class="n">foreach_builtin_function</span><span class="o">!</span><span class="p">(</span><span class="n">libcall</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">     </span><span class="o">----------------------------------------------------</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="n">invocation</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">libcall</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">227</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">arch</span>::<span class="n">assert_entry_sp_is_aligned</span><span class="p">(</span><span class="n">first_wasm_sp</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">230</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">230</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">arch</span>::<span class="n">assert_fp_is_aligned</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">             </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">242</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">242</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="n">arch</span>::<span class="n">reached_entry_sp</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="n">first_wasm_sp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">252</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">252</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arch</span>::<span class="n">get_next_older_pc_from_fp</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                  </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">258</span>:<span class="mi">24</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">258</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">arch</span>::<span class="n">NEXT_OLDER_FP_FROM_FP_OFFSET</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                        </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0433</span><span class="p">]</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span>: <span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">260</span>:<span class="mi">57</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">260</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="kd">let</span><span class="w"> </span><span class="n">next_older_fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">fp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">usize</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">arch</span>::<span class="n">NEXT_OLDER_FP_FROM_FP_OFFSET</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">                                                         </span><span class="o">^^^^</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">arch</span><span class="err">`</span><span class="w"></span>

<span class="n">error</span><span class="p">[</span><span class="n">E0308</span><span class="p">]</span>: <span class="nc">mismatched</span><span class="w"> </span><span class="n">types</span><span class="w"></span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">crates</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="o">/</span><span class="n">unix</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">167</span>:<span class="mi">73</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="mi">167</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_pc_and_fp</span><span class="p">(</span><span class="n">cx</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="n">libc</span>::<span class="n">c_void</span><span class="p">,</span><span class="w"> </span><span class="n">_signum</span>: <span class="nc">libc</span>::<span class="n">c_int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">           </span><span class="o">-------------</span><span class="w">                                                 </span><span class="o">^^^^^^^^^^^^^^^^^^</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">tuple</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="err">`</span><span class="p">()</span><span class="err">`</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w">           </span><span class="n">implicitly</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="err">`</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="err">`</span><span class="k">return</span><span class="err">`</span><span class="w"> </span><span class="n">expression</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>:  <span class="nc">expected</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="err">`</span><span class="w"></span>
<span class="w">            </span><span class="n">found</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="k">type</span> <span class="err">`</span><span class="p">()</span><span class="err">`</span><span class="w"></span>

<span class="nb">Some</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">detailed</span><span class="w"> </span><span class="n">explanations</span>: <span class="nc">E0308</span><span class="p">,</span><span class="w"> </span><span class="n">E0433</span><span class="p">.</span><span class="w"></span>
<span class="n">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="err">`</span><span class="n">rustc</span><span class="w"> </span><span class="o">--</span><span class="n">explain</span><span class="w"> </span><span class="n">E0308</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="err">`</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">errors</span><span class="w"></span>
<span class="n">warning</span>: <span class="nc">build</span><span class="w"> </span><span class="n">failed</span><span class="p">,</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">jobs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">finish</span><span class="o">..</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p>&lt;/details&gt;</p>
</blockquote>



<a name="292678665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292678665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292678665">(Aug 10 2022 at 00:26)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1210019175">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@afonso360  I will give a try to fix these.</p>
</blockquote>



<a name="292857399"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/292857399" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#292857399">(Aug 11 2022 at 01:57)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1211476428">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>a little update.<br>
cranelift can pass test on riscv64.<br>
@cfallin I think I resolved most of modify that you request.</p>
<p>wasmtime test <code>test_successful_compile</code> not pass.<br>
![image](<a href="https://user-images.githubusercontent.com/96557710/184052244-eae0482c-489c-46b0-bd8b-111077f87cfb.png">https://user-images.githubusercontent.com/96557710/184052244-eae0482c-489c-46b0-bd8b-111077f87cfb.png</a>)<br>
since I am not familiar with wasmtime's code . maybe still need some time to fix.</p>
</blockquote>



<a name="293465385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293465385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293465385">(Aug 15 2022 at 05:17)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1214627491">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>hey @cfallin @bjorn3  maybe need a little help here.<br>
<a href="#narrow/stream/206238-general/topic/as.20help.20about.20utf8_to_latin1.2E/near/293465163">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/as.20help.20about.20utf8_to_latin1.2E/near/293465163</a></p>
</blockquote>



<a name="293465452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293465452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293465452">(Aug 15 2022 at 05:18)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1214627491">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>hey @cfallin @bjorn3  maybe need a little help here.<br>
<a href="#narrow/stream/206238-general/topic/as.20help.20about.20utf8_to_latin1.2E/near/293465163">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/as.20help.20about.20utf8_to_latin1.2E/near/293465163</a></p>
<p>thanks. :-)</p>
</blockquote>



<a name="293472987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293472987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293472987">(Aug 15 2022 at 06:55)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1214681433">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E</a><br>
should load return  address from stack if frame is set up?</p>
</blockquote>



<a name="293489886"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293489886" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293489886">(Aug 15 2022 at 09:29)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1214815683">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p><a href="#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E</a><br>
should load return address from stack if frame is set up?</p>
</blockquote>
<p>I think so.</p>
</blockquote>



<a name="293648680"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293648680" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293648680">(Aug 16 2022 at 02:24)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1216070467">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p><a href="#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E</a><br>
should load return address from stack if frame is set up?</p>
</blockquote>
<p>I think so.</p>
</blockquote>
<p>but I think I can't get if_frame_is_set_up at isle lowering stage. maybe I am not find the current function????</p>
</blockquote>



<a name="293648724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293648724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293648724">(Aug 16 2022 at 02:24)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1216070818">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>I think <code>iadd_ifcout</code> can't be lowering.<br>
<a href="#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283</a></p>
</blockquote>



<a name="293650404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293650404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293650404">(Aug 16 2022 at 03:01)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1216070818">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>I think <code>iadd_ifcout</code> can't be lowered.<br>
<a href="#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283</a></p>
</blockquote>



<a name="293651001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293651001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293651001">(Aug 16 2022 at 03:15)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1216070467">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<blockquote>
<p><a href="#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/cranelift.20opcode.20get_return_address.2E</a><br>
should load return address from stack if frame is set up?</p>
</blockquote>
<p>I think so.</p>
</blockquote>
<p>but I think I can't get if_frame_is_set_up at isle lowering stage. maybe I am not find the correct function????</p>
</blockquote>



<a name="293846641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/293846641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#293846641">(Aug 17 2022 at 07:17)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1217554488">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>Yes, But My local qemu-riscv64 emulator doesn't implement it, I can't test it. right now I have two implemetion,<br>
One rely on B extension , One don't.</p>
</blockquote>
<p>It's nice that we have both lowerings. Usually it's fine to select extensions in the runtest suite that the host does not implement. What we do is, at runtime check if the host has those features and skip them if they don't, so we could for example do something like:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">riscv64</span><span class="w"> </span><span class="n">has_b</span><span class="w"></span>
</code></pre></div>
<p>Which would test both versions of the instruction. However it looks like we are missing <code>cranelift-native</code> support, and we can't implement that because <a href="https://doc.rust-lang.org/std/arch/macro.is_riscv_feature_detected.html"><code>is_riscv_feature_detected!</code></a> is unstable.</p>
<p>I'm not sure if there is a way around this, but it would be nice to test those instructions.</p>
</blockquote>



<a name="294009149"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/294009149" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#294009149">(Aug 18 2022 at 03:39)</a>:</h4>
<p>yuyang-ok deleted a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1216070818">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>I think <code>iadd_ifcout</code> can't be lowered.<br>
<a href="#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/ask.20help.20for.20iadd_ifcout.2E/near/293648283</a></p>
</blockquote>



<a name="294017846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/294017846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#294017846">(Aug 18 2022 at 06:08)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1219075382">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>a little update. finally there is not <code>segfault</code>. :-)<br>
but still some test will fail.</p>
<p>![image](<a href="https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png">https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png</a>)</p>
</blockquote>



<a name="294017876"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/294017876" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#294017876">(Aug 18 2022 at 06:08)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1219075382">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>a little update. finally there is no <code>segfault</code>. :-)<br>
but still some test will fail.</p>
<p>![image](<a href="https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png">https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png</a>)</p>
</blockquote>



<a name="294018020"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/294018020" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#294018020">(Aug 18 2022 at 06:10)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1219075382">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>a little update. finally there is no <code>segfault</code>. :-)<br>
but still some test will fail.</p>
<p>![image](<a href="https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png">https://user-images.githubusercontent.com/96557710/185306362-99679286-d830-471a-a716-b53895599e5a.png</a>)</p>
<p>there are some feature not implemented , like <code>simd</code>,atomic only implmented on <code>i32</code> and <code>i64</code> because on hardware supported.</p>
</blockquote>



<a name="294514012"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/294514012" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#294514012">(Aug 21 2022 at 07:00)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1221482378">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/regalloc2/issues/72">https://github.com/bytecodealliance/regalloc2/issues/72</a></p>
</blockquote>



<a name="295340971"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295340971" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295340971">(Aug 26 2022 at 01:51)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1227931928">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="https://gitlab.com/qemu-project/qemu/-/issues/1173">https://gitlab.com/qemu-project/qemu/-/issues/1173</a></p>
<p><a href="https://github.com/WebAssembly/testsuite/blob/e25ae159357c055b3a6fac99043644e208d26d2a/float_exprs.wast#L2335">https://github.com/WebAssembly/testsuite/blob/e25ae159357c055b3a6fac99043644e208d26d2a/float_exprs.wast#L2335</a></p>
<p>I am little confused by the <code>nan-boxed</code>.</p>
</blockquote>



<a name="295341165"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295341165" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295341165">(Aug 26 2022 at 01:54)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1227931928">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="https://gitlab.com/qemu-project/qemu/-/issues/1173">https://gitlab.com/qemu-project/qemu/-/issues/1173</a></p>
<p><a href="https://github.com/WebAssembly/testsuite/blob/e25ae159357c055b3a6fac99043644e208d26d2a/float_exprs.wast#L2335">https://github.com/WebAssembly/testsuite/blob/e25ae159357c055b3a6fac99043644e208d26d2a/float_exprs.wast#L2335</a></p>
<p>I am little confused by the <code>nan-boxed</code>.</p>
</blockquote>



<a name="295355169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295355169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295355169">(Aug 26 2022 at 05:11)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1228060907">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a></p>
</blockquote>



<a name="295367424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295367424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295367424">(Aug 26 2022 at 07:22)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1228145707">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Left a comment on <a href="https://gitlab.com/qemu-project/qemu/-/issues/1173">https://gitlab.com/qemu-project/qemu/-/issues/1173</a>. It was incorrectly closed based on my reading of the riscv spec.</p>
</blockquote>



<a name="295367547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295367547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295367547">(Aug 26 2022 at 07:22)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1228145707">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Left a comment on <a href="https://gitlab.com/qemu-project/qemu/-/issues/1173">https://gitlab.com/qemu-project/qemu/-/issues/1173</a>. Based on my reading of the riscv spec it was incorrectly closed.</p>
</blockquote>



<a name="295367835"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295367835" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295367835">(Aug 26 2022 at 07:25)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1228148928">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>By the way which test is <a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a> for?</p>
</blockquote>



<a name="295457860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295457860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295457860">(Aug 26 2022 at 15:58)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1228668709">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>So this isn't a qemu bug after all. <a href="https://gitlab.com/qemu-project/qemu/-/issues/1173#note_1079580087">https://gitlab.com/qemu-project/qemu/-/issues/1173#note_1079580087</a>:</p>
<blockquote>
<p>Ah, I see what you mean now. I am pretty sure this is the result of a bitcast from i32 -&gt; f32 using FMV.D.X as move instead of FMV.W.X as required for 32bit floats. This is because f64 is passed as type at <a href="https://github.com/bytecodealliance/wasmtime/pull/4271/files#diff-6ce7e9721c05ddbf92ec1a5e11518e9833cd3f6c12d30f3131c4baf4d8ca2127R171-R172">https://github.com/bytecodealliance/wasmtime/pull/4271/files#diff-6ce7e9721c05ddbf92ec1a5e11518e9833cd3f6c12d30f3131c4baf4d8ca2127R171-R172</a></p>
</blockquote>
</blockquote>



<a name="295760583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295760583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295760583">(Aug 28 2022 at 22:01)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1229562725">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>By the way which test is <a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a> for?<br>
related to <a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a> </p>
</blockquote>
</blockquote>



<a name="295761700"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295761700" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295761700">(Aug 28 2022 at 22:22)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1229562725">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>By the way which test is <a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a> for?</p>
</blockquote>
<p>related to <a href="https://gitlab.com/qemu-project/qemu/-/issues/1178">https://gitlab.com/qemu-project/qemu/-/issues/1178</a> </p>
</blockquote>



<a name="295797420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295797420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295797420">(Aug 29 2022 at 07:55)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1229914739">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>a little update.</p>
</blockquote>
<p>test wast::Cranelift::spec::skip_stack_guard_page ... ok</p>
<p>failures:</p>
<p>failures:<br>
    memory::offsets_static_dynamic_oh_my<br>
    pooling_allocator::table_limit<br>
    wast::Cranelift::misc::memory64::simd<br>
    wast::Cranelift::misc::simd::almost_extmul<br>
    wast::Cranelift::misc::simd::canonicalize_nan<br>
    wast::Cranelift::misc::simd::cvt_from_uint<br>
    wast::Cranelift::misc::simd::issue_3173_select_v128<br>
    wast::Cranelift::misc::simd::issue_3327_bnot_lowering<br>
    wast::Cranelift::misc::simd::replace_lane_preserve<br>
    wast::Cranelift::misc::simd::spillslot_size_fuzzbug<br>
    wast::Cranelift::misc::simd::unaligned_load<br>
    wast::Cranelift::misc::simd::v128_select</p>
<p>test result: FAILED. 626 passed; 12 failed; 10 ignored; 0 measured; 0 filtered out; finished in 616.44s</p>
<p>error: test failed, to rerun pass '--test all'</p>



<a name="295989023"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/295989023" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#295989023">(Aug 29 2022 at 20:04)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1230803037">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Getting very close, @yuyang-ok -- that's very exciting!</p>
</blockquote>



<a name="296024134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/296024134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#296024134">(Aug 30 2022 at 01:46)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1231046128">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="#narrow/stream/206238-general/topic/target-riscv64.20.20decommit_table_pages.2E">https://bytecodealliance.zulipchat.com/#narrow/stream/206238-general/topic/target-riscv64.20.20decommit_table_pages.2E</a></p>
</blockquote>



<a name="296241053"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/296241053" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#296241053">(Aug 31 2022 at 00:37)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1232314793">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin @bjorn3 @afonso360  right now only simd test failed.</p>
</blockquote>
<p>failures:<br>
    memory::offsets_static_dynamic_oh_my<br>
    wast::Cranelift::misc::memory64::simd<br>
    wast::Cranelift::misc::simd::almost_extmul<br>
    wast::Cranelift::misc::simd::canonicalize_nan<br>
    wast::Cranelift::misc::simd::cvt_from_uint<br>
    wast::Cranelift::misc::simd::issue_3173_select_v128<br>
    wast::Cranelift::misc::simd::issue_3327_bnot_lowering<br>
    wast::Cranelift::misc::simd::replace_lane_preserve<br>
    wast::Cranelift::misc::simd::spillslot_size_fuzzbug<br>
    wast::Cranelift::misc::simd::unaligned_load<br>
    wast::Cranelift::misc::simd::v128_select</p>
<p>test result: FAILED. 627 passed; 11 failed; 10 ignored; 0 measured; 0 filtered out; finished in 793.71s</p>



<a name="296258514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/296258514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#296258514">(Aug 31 2022 at 05:33)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1232482809">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin maybe another review?</p>
</blockquote>



<a name="296408572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/296408572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#296408572">(Aug 31 2022 at 17:03)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1233195131">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@yuyang-ok I'll give it another review sometime in the next week -- thank you very much for your patience and hard work here!</p>
<p>I will say overall that given that the backend passes tests for Wasm-MVP now, it's very likely we will be able to merge it; it's probably just a matter of some cleanup. We have precedent for disabling SIMD tests on platforms until SIMD is complete, so that should be fine.</p>
</blockquote>



<a name="296460735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/296460735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#296460735">(Aug 31 2022 at 22:33)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1233489031">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin ok,thanks.</p>
</blockquote>



<a name="298658392"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298658392" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298658392">(Sep 13 2022 at 20:00)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1245894255">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@yuyang-ok I spent some time today going through this PR again. It's looking quite good overall; thank you again for the work!</p>
<p>I pushed a few fixups and a merge of the latest <code>main</code> to your branch. With this, I'm now happy with all the Rust code in <code>cranelift/codegen/src/isa/riscv64</code>, and I'll take a look soon at the remainder.</p>
<p>My main feedback now -- and I promise we're really close -- is:</p>
<ul>
<li>
<p>The ISLE code has some strange formatting in places. I think I made some comments earlier about this, but it would be great if you could make a pass through it all and normalize it. Things like: spaces before opening parentheses (so <code>(decl term (A) B)</code>, not <code>(decl term(A) B)</code>), removing extraneous spaces otherwise (no <code>((a b  )  )</code>), and putting closing parentheses on the same line. </p>
<p>Maybe there is an autoformatter out there somewhere that can help; I haven't looked closely. Anyone else have ideas?</p>
</li>
<li>
<p>There are a few extractors like <code>iadd_ifcout_parameters</code> that serve to unwrap an instruction, just like <code>(iadd_ifcout ...)</code> would; it's unclear why they exist. Could you remove these or add comments noting why they are needed otherwise?</p>
</li>
<li>
<p>If there are any other tests that don't pass, we need a completely clean CI run to merge. I went ahead and disabled SIMD tests in my changes I just pushed; it's fine to merge a backend initially without this, as long as there is a plan to add it eventually.</p>
</li>
<li>
<p>I stubbed out the "is feature compatible" code in Wasmtime's AOT object loader but we probably want something better there.</p>
</li>
<li>
<p>We should ensure that we fail cleanly on modules with SIMD, just like s390x did before it gained SIMD support.</p>
</li>
</ul>
<p>And I think that's it! Let me know if anything above is unclear; happy to help further.</p>
</blockquote>



<a name="298686210"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298686210" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298686210">(Sep 14 2022 at 00:29)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246085637">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin That is true the ISLE formatting is strange.<br>
I have aleardy remove extraneous spaces.<br>
The reason I didn't pay much attention to ISLE formatting is that I am not very get used to the ISLE grammar.<br>
I think maybe leave some space let me clearly to see where parenthesis starts and ends.</p>
<p>I write like this deliberately.</p>
</blockquote>
<p>(decl gen_float_round(FloatRoundOP Reg Type) Reg)<br>
(rule<br>
  (gen_float_round op rs ty)<br>
  (let<br>
    (<br>
      (rd WritableReg (temp_writable_reg ty))<br>
      (tmp WritableReg (temp_writable_reg $I64))<br>
      (tmp2 WritableReg (temp_writable_reg $F64))<br>
      (_ Unit (emit (MInst.FloatRound op rd tmp tmp2 rs ty)))<br>
    )<br>
    (writable_reg_to_reg rd)<br>
  )<br>
)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">this</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">structure</span><span class="w"> </span><span class="n">clearly</span><span class="p">.</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">return</span><span class="p">.</span><span class="w"></span>

<span class="err">`</span><span class="n">iadd_ifcout_parameters</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">of</span><span class="w">  </span><span class="n">riscv</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">iflags</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">extrac</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">overflow</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="298686922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298686922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298686922">(Sep 14 2022 at 00:39)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246085637">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin That is true the ISLE formatting is strange.<br>
I have aleardy remove extraneous spaces.<br>
The reason I didn't pay much attention to ISLE formatting is that I am not very get used to the ISLE grammar.<br>
I think maybe leave some space let me clearly to see where parenthesis starts and ends.</p>
<p>I write like this deliberately.</p>
</blockquote>
<p>(decl gen_float_round(FloatRoundOP Reg Type) Reg)<br>
(rule<br>
  (gen_float_round op rs ty)<br>
  (let<br>
    (<br>
      (rd WritableReg (temp_writable_reg ty))<br>
      (tmp WritableReg (temp_writable_reg $I64))<br>
      (tmp2 WritableReg (temp_writable_reg $F64))<br>
      (_ Unit (emit (MInst.FloatRound op rd tmp tmp2 rs ty)))<br>
    )<br>
    (writable_reg_to_reg rd)<br>
  )<br>
)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">this</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">structure</span><span class="w"> </span><span class="n">clearly</span><span class="p">.</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">return</span><span class="p">.</span><span class="w"></span>

<span class="err">`</span><span class="n">iadd_ifcout_parameters</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">of</span><span class="w">  </span><span class="n">riscv</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">iflags</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">extrac</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">overflow</span><span class="p">.</span><span class="w"></span>



<span class="p">[</span><span class="n">inst</span><span class="p">.</span><span class="n">txt</span><span class="p">](</span><span class="n">https</span>:<span class="c1">//github.com/bytecodealliance/wasmtime/files/9561637/inst.txt)</span>

<span class="o">@</span><span class="n">cfallin</span><span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="n">codestyle</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">ok</span><span class="o">??</span><span class="w"></span>
</code></pre></div>



<a name="298690073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298690073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298690073">(Sep 14 2022 at 01:30)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246118823">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I think maybe leave some space let me clearly to see where parenthesis starts and ends.</p>
<p>I write like this deliberately.</p>
</blockquote>
<p>@yuyang-ok I'd prefer that we standardize on formatting. I agree that it can take a bit of work to get used to reading ISLE, as with any other language; but that's not a reason to do things differently in one part of the codebase vs somewhere else, IMHO. I also see some extra spaces in cases like <a href="https://github.com/yuyang-ok/wasmtime/blob/dc8b7ee8a5824536790d0f0a906398d4c17beafd/cranelift/codegen/src/isa/riscv64/lower.isle#L94">this</a> at the end of the line: <code>... (smulhi x y ))</code> (the space after <code>y</code>). It's not a huge deal, but I also don't want to loosen standards here without a good reason. Thanks!</p>
<blockquote>
<p><code>iadd_ifcout_parameters</code> is because of riscv has no iflags, I need extrac the inputs to generate overflow.</p>
</blockquote>
<p>The implementation <a href="https://github.com/yuyang-ok/wasmtime/blob/dc8b7ee8a5824536790d0f0a906398d4c17beafd/cranelift/codegen/src/isa/riscv64/lower/isle.rs#L362-L374">here</a> looks like it is equivalent to using <code>(iadd_ifcout x y)</code> to get the args, and then getting the type of <code>x</code>; so instead of writing <code>(iadd_ifcout_parameters a b ty)</code> <a href="https://github.com/yuyang-ok/wasmtime/blob/dc8b7ee8a5824536790d0f0a906398d4c17beafd/cranelift/codegen/src/isa/riscv64/lower.isle#L930">here</a>, you could write <code>(iadd_ifcout a @ (value_type ty) b)</code> instead. Then we can get rid of the custom extractors. Does that make sense?</p>
</blockquote>



<a name="298691757"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298691757" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298691757">(Sep 14 2022 at 02:00)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246134554">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  seens work to me. look like <code>ifcmp_parameters</code> and <code>ffcmp_parameters</code> have this problem too.</p>
</blockquote>



<a name="298696477"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298696477" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298696477">(Sep 14 2022 at 03:19)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246180694">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I already remove <code>(smulhi x y )) </code> in <code>y </code>.</p>
</blockquote>



<a name="298701809"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298701809" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298701809">(Sep 14 2022 at 04:43)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246226033">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  look like <code>offsets_static_dynamic_oh_my</code> need simd too.</p>
</blockquote>
<p>test wast::Cranelift::spec::skip_stack_guard_page ... ok</p>
<p>failures:</p>
<p>failures:<br>
    memory::offsets_static_dynamic_oh_my</p>
<p>test result: FAILED. 626 passed; 1 failed; 32 ignored; 0 measured; 0 filtered out; finished in 752.18s</p>
<p>error: test failed, to rerun pass '--test all'<br>
[1]+  已完成               nohup ~/software/firefox/firefox-bin  (工作目录: ~)<br>
(当前工作目录：~/projects/wasmtime/tests)</p>



<a name="298703049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298703049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298703049">(Sep 14 2022 at 05:02)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246237137">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin look like <code>offsets_static_dynamic_oh_my</code> need simd too.</p>
<p>```<br>
test wast::Cranelift::spec::skip_stack_guard_page ... ok</p>
<p>failures:</p>
<p>failures:<br>
    memory::offsets_static_dynamic_oh_my</p>
<p>test result: FAILED. 626 passed; 1 failed; 32 ignored; 0 measured; 0 filtered out; finished in 752.18s</p>
<p>error: test failed, to rerun pass '--test all'<br>
[1]+  已完成               nohup ~/software/firefox/firefox-bin  (工作目录: ~)<br>
(当前工作目录：~/projects/wasmtime/tests)<br>
```</p>
</blockquote>
<p>It shouldn't, anymore: I excluded <code>v128</code> loads from the test with the cfg directive in <code>tests/all/memory.rs</code> in <a href="https://github.com/bytecodealliance/wasmtime/pull/4271/commits/5cf133b8da570779951ff1004128f319dc218f7a">this commit</a>. Have you pulled the changes that I pushed?</p>
</blockquote>



<a name="298703340"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298703340" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298703340">(Sep 14 2022 at 05:07)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246240049">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I pulled your commit, only this test failed.</p>
</blockquote>



<a name="298703974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298703974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298703974">(Sep 14 2022 at 05:18)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246246090">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Ah! OK, I do remember this failure, sorry; it gets past an earlier issue and now is hitting a <code>trapif</code> that is not lowered for some reason. It's not SIMD-related, I don't think. Here's what I see (cross-compiling from Ubuntu/aarch64 and running under emulation with qemu-risc64):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">----</span><span class="w"> </span><span class="n">memory</span>::<span class="n">offsets_static_dynamic_oh_my</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>
<p>You'll probably need to look at what CLIF is being generated and make sure that the pattern is properly matched?</p>
</blockquote>



<a name="298704029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298704029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298704029">(Sep 14 2022 at 05:18)</a>:</h4>
<p>cfallin edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246246090">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>Ah! OK, I do remember this failure, sorry; it gets past an earlier issue and now is hitting a <code>trapif</code> that is not lowered for some reason. It's not SIMD-related, I don't think. Here's what I see (cross-compiling from Ubuntu/aarch64 and running under emulation with qemu-riscv64):</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">----</span><span class="w"> </span><span class="n">memory</span>::<span class="n">offsets_static_dynamic_oh_my</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="o">----</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">internal</span><span class="w"> </span><span class="n">error</span>: <span class="nc">entered</span><span class="w"> </span><span class="n">unreachable</span><span class="w"> </span><span class="n">code</span>: <span class="nc">implemented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ISLE</span>: <span class="nc">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="n">trapif</span><span class="w"> </span><span class="n">uge</span><span class="w"> </span><span class="n">v5</span><span class="p">,</span><span class="w"> </span><span class="n">heap_oob</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">type</span> <span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="nb">None</span><span class="err">`</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">riscv64</span><span class="o">/</span><span class="n">lower_inst</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">37</span>:<span class="mi">9</span><span class="w"></span>
</code></pre></div>
<p>You'll probably need to look at what CLIF is being generated and make sure that the pattern is properly matched?</p>
</blockquote>



<a name="298708229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298708229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298708229">(Sep 14 2022 at 06:12)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246289158">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  ok, thanks. solved.</p>
</blockquote>



<a name="298713238"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298713238" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298713238">(Sep 14 2022 at 06:58)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246329683">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>it this another qemu wrong implementation??</p>
</blockquote>
<p>RUST_BACKTRACE=1  cargo test   --target    riscv64gc-unknown-linux-gnu --test host_segfault <br>
    Finished test [unoptimized + debuginfo] target(s) in 0.83s<br>
     Running tests/host_segfault.rs (/home/yuyang/projects/wasmtime/target/riscv64gc-unknown-linux-gnu/debug/deps/host_segfault-0362e2365a90b3f7)<br>
thread 'main' panicked at '</p>
<p>expected a stack overflow on <code>hit async stack guard page with pooling allocator</code><br>
got status: signal: 9 (SIGKILL)</p>
<p>', tests/host_segfault.rs:213:13<br>
stack backtrace:<br>
   0: rust_begin_unwind<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/std/src/panicking.rs:584:5<br>
   1: core::panicking::panic_fmt<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/core/src/panicking.rs:142:14<br>
   2: host_segfault::run_test<br>
             at ./tests/host_segfault.rs:213:13<br>
   3: host_segfault::main<br>
             at ./tests/host_segfault.rs:177:17<br>
   4: core::ops::function::FnOnce::call_once<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/core/src/ops/function.rs:248:5<br>
note: Some details are omitted, run with <code>RUST_BACKTRACE=full</code> for a verbose backtrace.<br>
error: test failed, to rerun pass '--test host_segfault'</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SIGKILL</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="err">`</span><span class="n">host_segfault</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="298715110"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298715110" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298715110">(Sep 14 2022 at 07:15)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246329683">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>it this another qemu wrong implementation??</p>
</blockquote>
<p>RUST_BACKTRACE=1  cargo test   --target    riscv64gc-unknown-linux-gnu --test host_segfault <br>
    Finished test [unoptimized + debuginfo] target(s) in 0.83s<br>
     Running tests/host_segfault.rs (/home/yuyang/projects/wasmtime/target/riscv64gc-unknown-linux-gnu/debug/deps/host_segfault-0362e2365a90b3f7)<br>
thread 'main' panicked at '</p>
<p>expected a stack overflow on <code>hit async stack guard page with pooling allocator</code><br>
got status: signal: 9 (SIGKILL)</p>
<p>', tests/host_segfault.rs:213:13<br>
stack backtrace:<br>
   0: rust_begin_unwind<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/std/src/panicking.rs:584:5<br>
   1: core::panicking::panic_fmt<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/core/src/panicking.rs:142:14<br>
   2: host_segfault::run_test<br>
             at ./tests/host_segfault.rs:213:13<br>
   3: host_segfault::main<br>
             at ./tests/host_segfault.rs:177:17<br>
   4: core::ops::function::FnOnce::call_once<br>
             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/core/src/ops/function.rs:248:5<br>
note: Some details are omitted, run with <code>RUST_BACKTRACE=full</code> for a verbose backtrace.<br>
error: test failed, to rerun pass '--test host_segfault'</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SIGKILL</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="err">`</span><span class="n">host_segfault</span><span class="err">`</span><span class="p">.</span><span class="w"></span>

<span class="n">look</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">related</span><span class="w"> </span><span class="n">cranelift</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">all</span><span class="p">,</span><span class="n">very</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">related</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span><span class="err">`</span><span class="p">.</span><span class="w"></span>
</code></pre></div>



<a name="298884363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298884363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298884363">(Sep 15 2022 at 00:13)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246329683">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p><a href="https://github.com/bytecodealliance/wasmtime/issues/4912">https://github.com/bytecodealliance/wasmtime/issues/4912</a></p>
</blockquote>



<a name="298918196"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298918196" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298918196">(Sep 15 2022 at 07:45)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1246329683">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I think all test in <code>wasmtime/tests</code> passed except this one.<br>
<a href="https://github.com/bytecodealliance/wasmtime/issues/4912">https://github.com/bytecodealliance/wasmtime/issues/4912</a></p>
<p>I think there still have some codestyle problem in ISLE.</p>
</blockquote>



<a name="298948426"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298948426" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298948426">(Sep 15 2022 at 11:24)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1247968808">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin is this project rely on v8,there are still some part not compile.</p>
</blockquote>
<p>I took a look at why CI's not working. It looks like rusty_v8 does not produce precompiled binaries for riscv. I disabled it for riscv and <a href="https://github.com/afonso360/wasmtime/actions/runs/3059838341/jobs/4937680796">CI now runs tests, but its failing somewhere</a>. I've also added a build CI job for riscv.</p>
<p>See these two commits:</p>
<ul>
<li><a href="https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d">https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d</a></li>
<li><a href="https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4">https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4</a></li>
</ul>
</blockquote>



<a name="298948471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298948471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298948471">(Sep 15 2022 at 11:24)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1247968808">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin is this project rely on v8,there are still some part not compile.</p>
</blockquote>
<p>I took a look at why CI's not working. It looks like rusty_v8 does not produce precompiled binaries for riscv. I disabled v8 for riscv and <a href="https://github.com/afonso360/wasmtime/actions/runs/3059838341/jobs/4937680796">CI now runs tests, but its failing somewhere</a>. I've also added a build CI job for riscv.</p>
<p>See these two commits:</p>
<ul>
<li><a href="https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d">https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d</a></li>
<li><a href="https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4">https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4</a></li>
</ul>
</blockquote>



<a name="298948493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298948493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298948493">(Sep 15 2022 at 11:24)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1247968808">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin is this project rely on v8,there are still some part not compile.</p>
</blockquote>
<p>I took a look at why CI's not working. It looks like rusty_v8 does not produce precompiled binaries for riscv. I disabled v8 for riscv and <a href="https://github.com/afonso360/wasmtime/actions/runs/3059838341/jobs/4937680796">CI now runs tests, but its failing somewhere</a>. I've also added a CI build job for riscv.</p>
<p>See these two commits:</p>
<ul>
<li><a href="https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d">https://github.com/afonso360/wasmtime/commit/636d0c3409845d04ddce01b375b548462ce8eb5d</a></li>
<li><a href="https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4">https://github.com/afonso360/wasmtime/commit/1f2b5210b17736270a151f02fdd8e8d06ea739d4</a></li>
</ul>
</blockquote>



<a name="298951301"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/298951301" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#298951301">(Sep 15 2022 at 11:44)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1247968808">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin is this project rely on v8,there are still some part not compile.</p>
</blockquote>
<p>I took a look at why CI's not working. It looks like rusty_v8 does not produce precompiled binaries for riscv. I disabled v8 for riscv and <a href="https://github.com/afonso360/wasmtime/actions/runs/3060053021/jobs/4938125637">CI now runs tests, but its failing somewhere</a>. I've also added a CI build job for riscv.</p>
<p>See these two commits:</p>
<ul>
<li><a href="https://github.com/afonso360/wasmtime/commit/e3f5de35b9cfe4bb6717fa8ea0ec1ae574e18b77">https://github.com/afonso360/wasmtime/commit/e3f5de35b9cfe4bb6717fa8ea0ec1ae574e18b77</a></li>
<li><a href="https://github.com/afonso360/wasmtime/commit/d3ef08b912d1a60750b816d1403e12d7bd6e1ecc">https://github.com/afonso360/wasmtime/commit/d3ef08b912d1a60750b816d1403e12d7bd6e1ecc</a></li>
</ul>
</blockquote>



<a name="299073139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299073139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299073139">(Sep 16 2022 at 00:44)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1248792415">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@afonso360 ok, thanks a lot.</p>
</blockquote>



<a name="299076802"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299076802" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299076802">(Sep 16 2022 at 01:48)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1248821380">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I want disable <code>host_segfault</code> a little while  due to <a href="https://github.com/bytecodealliance/wasmtime/issues/4912">https://github.com/bytecodealliance/wasmtime/issues/4912</a>.</p>
</blockquote>



<a name="299092281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299092281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299092281">(Sep 16 2022 at 05:11)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1248821380">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin I want disable <code>host_segfault</code> a little while  due to <br>
<a href="https://gitlab.com/qemu-project/qemu/-/issues/1214">https://gitlab.com/qemu-project/qemu/-/issues/1214</a></p>
</blockquote>



<a name="299101780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299101780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299101780">(Sep 16 2022 at 06:56)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1248989674">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin </p>
</blockquote>
<p>diff --git a/tests/host_segfault.rs b/tests/host_segfault.rs<br>
index 7a761678b..616430289 100644<br>
--- a/tests/host_segfault.rs<br>
+++ b/tests/host_segfault.rs<br>
@@ -144,6 +144,10 @@ fn main() {<br>
             },<br>
             true,<br>
         ),</p>
<ul>
<li>#[cfg(not(any(target_arch = "riscv64")))]</li>
<li>// Due to <code>InstanceAllocationStrategy::pooling()</code> trying to alloc more 6000G memory.</li>
<li>// <a href="https://gitlab.com/qemu-project/qemu/-/issues/1214">https://gitlab.com/qemu-project/qemu/-/issues/1214</a></li>
<li>// <a href="https://gitlab.com/qemu-project/qemu/-/issues/290">https://gitlab.com/qemu-project/qemu/-/issues/290</a><br>
         (<br>
             "hit async stack guard page with pooling allocator",<br>
             || {</li>
</ul>



<a name="299109746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299109746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299109746">(Sep 16 2022 at 08:00)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1248989674">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin </p>
</blockquote>
<p>diff --git a/tests/host_segfault.rs b/tests/host_segfault.rs<br>
index 7a761678b..6adac707e 100644<br>
--- a/tests/host_segfault.rs<br>
+++ b/tests/host_segfault.rs<br>
@@ -144,6 +144,10 @@ fn main() {<br>
             },<br>
             true,<br>
         ),</p>
<ul>
<li>#[cfg(not(any(target_arch = "riscv64")))]</li>
<li>// Due to <code>InstanceAllocationStrategy::pooling()</code> trying to alloc more than 6000G memory space.</li>
<li>// <a href="https://gitlab.com/qemu-project/qemu/-/issues/1214">https://gitlab.com/qemu-project/qemu/-/issues/1214</a></li>
<li>// <a href="https://gitlab.com/qemu-project/qemu/-/issues/290">https://gitlab.com/qemu-project/qemu/-/issues/290</a><br>
         (<br>
             "hit async stack guard page with pooling allocator",<br>
             || {</li>
</ul>



<a name="299840712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299840712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299840712">(Sep 20 2022 at 20:13)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1252862677">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@yuyang-ok did you hit this error while using the patched qemu as our CI builds? (Start with qemu 6.1.0, then apply <code>ci/madvise.patch</code>) If yes, and still an error, then we can disable the test temporarily. But I'd prefer not to if our patched qemu runs it properly.</p>
<p>Otherwise, please go ahead and apply any other fixes (from Afonso above and any others needed) to get to green CI, make sure the other items in <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1245894255">the list here</a> are covered, and then ping me when ready -- thanks!</p>
</blockquote>



<a name="299868669"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/299868669" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#299868669">(Sep 21 2022 at 00:43)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1253058107">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I still hit this error using the patched qemu.  I think we are ready.<br>
</p>
</blockquote>



<a name="300259509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300259509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300259509">(Sep 22 2022 at 22:39)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1255628644">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin I still hit this error using the patched qemu. I think we are ready.</p>
</blockquote>
<p>Well, no, if tests don't pass then we aren't ready. We need to somehow either find and fix the issue or disable tests.</p>
<p>Going back to my checklist from my previous comment:</p>
<blockquote>
<ul>
<li>
<p>The ISLE code has some strange formatting in places. I think I made some comments earlier about this, but it would be great if you could make a pass through it all and normalize it. Things like: spaces before opening parentheses (so (decl term (A) B), not (decl term(A) B)), removing extraneous spaces otherwise (no ((a b ) )), and putting closing parentheses on the same line.</p>
<p>Maybe there is an autoformatter out there somewhere that can help; I haven't looked closely. Anyone else have ideas?</p>
</li>
<li>
<p>There are a few extractors like iadd_ifcout_parameters that serve to unwrap an instruction, just like (iadd_ifcout ...) would; it's unclear why they exist. Could you remove these or add comments noting why they are needed otherwise?</p>
</li>
<li>
<p>If there are any other tests that don't pass, we need a completely clean CI run to merge. I went ahead and disabled SIMD tests in my changes I just pushed; it's fine to merge a backend initially without this, as long as there is a plan to add it eventually.</p>
</li>
<li>
<p>I stubbed out the "is feature compatible" code in Wasmtime's AOT object loader but we probably want something better there.</p>
</li>
<li>
<p>We should ensure that we fail cleanly on modules with SIMD, just like s390x did before it gained SIMD support.</p>
</li>
</ul>
</blockquote>
<p>I see that <code>iadd_ifcout_parameters</code> is now removed, so that's good, but can you confirm that you have addressed the other points, with comments or links to code you've added for each one?</p>
<p>I also see some unresolved comments from long ago for simple things like typos in comments. Can you make sure there are no open code-review comments, and they are all addressed?</p>
<p>Once all of these things are done, then we can proceed!<br>
</p>
</blockquote>



<a name="300264632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300264632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300264632">(Sep 22 2022 at 23:23)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1255653241">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin </p>
</blockquote>
<p>(decl gen_div_by_zero(Reg)InstOutput)<br>
(rule<br>
  (gen_div_by_zero r)<br>
  (gen_trapifc (IntCC.Equal) (zero_reg) r (TrapCode.IntegerDivisionByZero))<br>
)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">this</span><span class="w"> </span><span class="n">codestyle</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">ok</span><span class="p">.</span><span class="w"></span>
<span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">this</span><span class="o">???</span><span class="w"></span>
</code></pre></div>
<p>(decl gen_div_by_zero(Reg)InstOutput)<br>
(rule<br>
  (gen_div_by_zero r)<br>
  (gen_trapifc (IntCC.Equal) (zero_reg) r (TrapCode.IntegerDivisionByZero)))</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>
</code></pre></div>



<a name="300264829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300264829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300264829">(Sep 22 2022 at 23:25)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1255653241">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin </p>
</blockquote>
<p>(decl gen_div_by_zero(Reg)InstOutput)<br>
(rule<br>
  (gen_div_by_zero r)<br>
  (gen_trapifc (IntCC.Equal) (zero_reg) r (TrapCode.IntegerDivisionByZero))<br>
)</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">this</span><span class="w"> </span><span class="n">codestyle</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">ok</span><span class="o">????</span><span class="w"></span>
<span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">this</span><span class="o">???</span><span class="w"></span>
</code></pre></div>
<p>(decl gen_div_by_zero(Reg)InstOutput)<br>
(rule<br>
  (gen_div_by_zero r)<br>
  (gen_trapifc (IntCC.Equal) (zero_reg) r (TrapCode.IntegerDivisionByZero)))</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code>
</code></pre></div>



<a name="300267220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300267220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300267220">(Sep 22 2022 at 23:47)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1255665187">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I stubbed out the "is feature compatible" code in Wasmtime's AOT object loader but we probably want something better there.<br>
Yes, this is because <code>is_riscv64_feature_detected</code> not stable,I perfer not use it.</p>
</blockquote>
</blockquote>



<a name="300601454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300601454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300601454">(Sep 25 2022 at 02:34)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257104978">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I think we  are ready.</p>
</blockquote>



<a name="300601459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300601459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300601459">(Sep 25 2022 at 02:34)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257104978">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I think we  are ready.</p>
</blockquote>



<a name="300601671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300601671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300601671">(Sep 25 2022 at 02:38)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257104978">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin  I think we  are ready.<br>
maybe some part not appropriate like <a href="https://github.com/yuyang-ok/wasmtime/blob/risc-v/crates/wasmtime/src/engine.rs#L493">https://github.com/yuyang-ok/wasmtime/blob/risc-v/crates/wasmtime/src/engine.rs#L493</a> .<br>
maybe you can help me a little??</p>
</blockquote>



<a name="300735976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300735976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300735976">(Sep 26 2022 at 07:58)</a>:</h4>
<p>a1phyr <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257644578">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>I think you could do the same that for s390x, i.e. calling <code>getauxval</code> by yourself.</p>
<p>You can find a RISC-V example in <code>std_detect</code> (the implementation of <code>is_riscv64_feature_detected!</code>) <a href="https://github.com/rust-lang/stdarch/blob/master/crates/std_detect/src/detect/os/linux/riscv.rs">here</a>.</p>
</blockquote>



<a name="300761635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300761635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300761635">(Sep 26 2022 at 10:50)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257846627">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I think you could do the same that for s390x, i.e. calling <code>getauxval</code> by yourself.</p>
<p>You can find a RISC-V example in <code>std_detect</code> (the implementation of <code>is_riscv64_feature_detected!</code>) <a href="https://github.com/rust-lang/stdarch/blob/master/crates/std_detect/src/detect/os/linux/riscv.rs">here</a>.<br>
still look a little hard to use to me. look like need use <code>C</code>???</p>
</blockquote>
</blockquote>



<a name="300761671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300761671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300761671">(Sep 26 2022 at 10:50)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257846627">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I think you could do the same that for s390x, i.e. calling <code>getauxval</code> by yourself.</p>
<p>You can find a RISC-V example in <code>std_detect</code> (the implementation of <code>is_riscv64_feature_detected!</code>) [here]</p>
</blockquote>
<p>(<a href="https://github.com/rust-lang/stdarch/blob/master/crates/std_detect/src/detect/os/linux/riscv.rs">https://github.com/rust-lang/stdarch/blob/master/crates/std_detect/src/detect/os/linux/riscv.rs</a>).<br>
still look a little hard to use to me. look like need use <code>C</code>???</p>
</blockquote>



<a name="300761695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300761695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300761695">(Sep 26 2022 at 10:50)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257846627">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I think you could do the same that for s390x, i.e. calling <code>getauxval</code> by yourself.<br>
still look a little hard to use to me. look like need use <code>C</code>???</p>
</blockquote>
</blockquote>



<a name="300761713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300761713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300761713">(Sep 26 2022 at 10:50)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257846627">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>I think you could do the same that for s390x, i.e. calling <code>getauxval</code> by yourself.</p>
</blockquote>
<p>still look a little hard to use to me. look like need use <code>C</code>???</p>
</blockquote>



<a name="300764857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/300764857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#300764857">(Sep 26 2022 at 11:10)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1257867658">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin what do you think appropriate to solve <code>is_riscv64_feature_detected</code>???</p>
</blockquote>



<a name="301125416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/301125416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#301125416">(Sep 27 2022 at 22:05)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1260101701">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin what do you think appropriate to solve is_riscv64_feature_detected???</p>
</blockquote>
<p>If we want to wait for stabilization of the feature-detection macro in the standard library, I don't see anything wrong with assuming a baseline RISC-V ISA level for now (in other words, running with <em>no</em> features ever detected). Does this seem reasonable or would it result in important optimizations going missing?</p>
</blockquote>



<a name="301131937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/301131937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#301131937">(Sep 27 2022 at 22:59)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1260158789">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>Does this seem reasonable or would it result in important optimizations going missing?</p>
</blockquote>
<p><code>popcnt</code>,<code>ctz</code>,<code>rev8</code>,<code>brev8</code> will fallback to loop implementation, seen reasonable to me, I think there instructions are used rare to me.<br>
</p>
</blockquote>



<a name="301134926"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/301134926" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#301134926">(Sep 27 2022 at 23:33)</a>:</h4>
<p>yuyang-ok edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1260158789">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>Does this seem reasonable or would it result in important optimizations going missing?</p>
</blockquote>
<p><code>popcnt</code>,<code>ctz</code>,<code>rev8</code>,<code>brev8</code> will fallback to loop implementation, seen reasonable to me, I think these instructions are used rare to me.<br>
</p>
</blockquote>



<a name="301140282"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/301140282" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#301140282">(Sep 28 2022 at 00:34)</a>:</h4>
<p>yuyang-ok <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1260240470">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>@cfallin ok,thanks. :-)</p>
</blockquote>



<a name="303030695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/303030695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#303030695">(Oct 08 2022 at 15:04)</a>:</h4>
<p>JhonnyRice <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1272338543">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<blockquote>
<p>@cfallin ok,thanks. :-)</p>
</blockquote>
<p>Congratulations!</p>
</blockquote>



<a name="309335944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/309335944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#309335944">(Nov 12 2022 at 13:02)</a>:</h4>
<p>martasp <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1312474318">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>How can I use this feature, is there documentation? <br>
How can I set a target risc5 and produce Linux  risc5 elf binary? <br>
I would want to use it like that: </p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime</span><span class="w"> </span><span class="n">exampleProgram</span><span class="p">.</span><span class="n">wasm</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">risc5</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="309357307"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/309357307" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#309357307">(Nov 12 2022 at 15:48)</a>:</h4>
<p>archanox <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1312512410">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>This work is for RISC-V not risc5.<br>
You'll likely need to use <code>riscv64gc</code> as per the changes in this PR.</p>
</blockquote>



<a name="309362901"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/309362901" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#309362901">(Nov 12 2022 at 16:40)</a>:</h4>
<p>martasp <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1312523592">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>I see that we have binaries riscv64gc here: <a href="https://github.com/bytecodealliance/wasmtime/releases/tag/v2.0.2">https://github.com/bytecodealliance/wasmtime/releases/tag/v2.0.2</a> therefore It should probably work on riscv64 Linux. So I tried to install wasmtime in <code>riscv64 </code>Linux but without success.<br>
Probably there is a difference between <code>riscv64 </code>and <code>riscv64gc </code> but I'm kinda new to these things, where can I learn it, any good resources?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="o">~</span><span class="p">]</span>#<span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//wasmtime.dev/install.sh -sSf | bash</span>
<span class="n">Error</span>: <span class="nc">Sorry</span><span class="o">!</span><span class="w"> </span><span class="n">Wasmtime</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">provides</span><span class="w"> </span><span class="n">pre</span><span class="o">-</span><span class="n">built</span><span class="w"> </span><span class="n">binaries</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="p">(</span><span class="n">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">macOS</span><span class="p">,</span><span class="w"> </span><span class="n">Windows</span><span class="p">),</span><span class="w"> </span><span class="n">aa</span><span class="w"></span>
<span class="n">rch64</span><span class="w"> </span><span class="p">(</span><span class="n">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">macOS</span><span class="p">),</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">s390x</span><span class="w"> </span><span class="p">(</span><span class="n">Linux</span><span class="p">).</span><span class="w"></span>

<span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="o">~</span><span class="p">]</span>#<span class="w"> </span><span class="n">uname</span><span class="w"></span>
<span class="n">Linux</span><span class="w"></span>
<span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="o">~</span><span class="p">]</span>#<span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"></span>
<span class="n">riscv64</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="309363644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%234271%20add%20riscv64%20backend%20for%20cranelift./near/309363644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.234271.20add.20riscv64.20backend.20for.20cranelift.2E.html#309363644">(Nov 12 2022 at 16:48)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/pull/4271#issuecomment-1312525019">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/4271">issue #4271</a>:</p>
<blockquote>
<p>The script at <a href="https://wasmtime.dev/install.sh">https://wasmtime.dev/install.sh</a> hasn't been updated yet for riscv64 support. You should probably directly download the binary from <a href="https://github.com/bytecodealliance/wasmtime/releases/tag/v2.0.2">https://github.com/bytecodealliance/wasmtime/releases/tag/v2.0.2</a>.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>