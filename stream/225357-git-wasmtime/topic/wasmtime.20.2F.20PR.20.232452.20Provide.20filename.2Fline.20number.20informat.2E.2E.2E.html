<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2452 Provide filename/line number informat... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html">wasmtime / PR #2452 Provide filename/line number informat...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="217940587"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/217940587" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#217940587">(Nov 25 2020 at 21:18)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="217942965"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/217942965" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#217942965">(Nov 25 2020 at 21:42)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-538862940">PR Review</a>.</p>



<a name="218314872"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218314872" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218314872">(Nov 30 2020 at 17:04)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="218316636"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218316636" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218316636">(Nov 30 2020 at 17:16)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="218465220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218465220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218465220">(Dec 01 2020 at 18:52)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="218470270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470270">(Dec 01 2020 at 19:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542227753">PR Review</a>.</p>



<a name="218470273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470273">(Dec 01 2020 at 19:34)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542227753">PR Review</a>.</p>



<a name="218470274"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470274" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470274">(Dec 01 2020 at 19:34)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533667834">PR Review Comment</a>:</p>
<blockquote>
<p>Does the <code>'_</code> here end up as the same lifetime that <code>&amp;self</code> has? I know it would if the lifetime was completely elided, but I don't think I've ever actually seen <code>'_</code> in a result type.</p>
</blockquote>



<a name="218470275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470275">(Dec 01 2020 at 19:34)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533669554">PR Review Comment</a>:</p>
<blockquote>
<p>Want to throw a <code>cpp_demangle</code> fallback in here too?</p>
</blockquote>



<a name="218470491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470491">(Dec 01 2020 at 19:36)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542231956">PR Review</a>.</p>



<a name="218470492"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218470492" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218470492">(Dec 01 2020 at 19:36)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533671216">PR Review Comment</a>:</p>
<blockquote>
<p><span aria-label="bike" class="emoji emoji-1f6b2" role="img" title="bike">:bike:</span> shed nit: as this is a Wasmtime-specific environment variable, perhaps it should be <code>WASMTIME_BACKTRACE_DETAILS</code>?</p>
</blockquote>



<a name="218482704"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218482704" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218482704">(Dec 01 2020 at 21:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533726154">PR Review Comment</a>:</p>
<blockquote>
<p>It does yeah, it basically stands for "compiler fill something in here" and elision means that in method position with <code>&amp;self</code> it's filled in with that lifetime.</p>
</blockquote>



<a name="218482705"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218482705" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218482705">(Dec 01 2020 at 21:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542302078">PR Review</a>.</p>



<a name="218482708"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218482708" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218482708">(Dec 01 2020 at 21:15)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542302147">PR Review</a>.</p>



<a name="218482709"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218482709" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218482709">(Dec 01 2020 at 21:15)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533726199">PR Review Comment</a>:</p>
<blockquote>
<p>Sure!</p>
</blockquote>



<a name="218483294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218483294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218483294">(Dec 01 2020 at 21:20)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#pullrequestreview-542305568">PR Review</a>.</p>



<a name="218483295"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218483295" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218483295">(Dec 01 2020 at 21:20)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2452#discussion_r533728842">PR Review Comment</a>:</p>
<blockquote>
<p>Seems reasonable to me!</p>
</blockquote>



<a name="218483298"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218483298" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218483298">(Dec 01 2020 at 21:21)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="218489739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218489739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218489739">(Dec 01 2020 at 22:13)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a> from <code>wasm-dwarf</code> to <code>main</code>:</p>
<blockquote>
<p>This commit extends the <code>Trap</code> type and <code>Store</code> to retain DWARF debug<br>
information found in a wasm file unconditionally, if it's present. This<br>
then enables us to print filenames and line numbers which point back to<br>
actual source code when a trap backtrace is printed. Additionally the<br>
<code>FrameInfo</code> type has been souped up to return filename/line number<br>
information as well.</p>
<p>The implementation here is pretty simplistic currently. The meat of all<br>
the work happens in <code>gimli</code> and <code>addr2line</code>, and otherwise wasmtime is<br>
just schlepping around bytes of dwarf debuginfo here and there!</p>
<p>The general goal here is to assist with debugging when using wasmtime<br>
because filenames and line numbers are generally orders of magnitude<br>
better even when you already have a stack trace. Another nicety here is<br>
that backtraces will display inlined frames (learned through debug<br>
information), improving the experience in release mode as well.</p>
<p>An example of this is that with this file:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">panic</span><span class="o">!</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>we get this stack trace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">rustc</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">wasi</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"></span>
<span class="cp">$</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="w"></span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.16</span><span class="n">s</span><span class="w"></span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>
<span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">hello</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">foo</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span><span class="w"></span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="mi">0</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">default</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span>: <span class="nc">wasm</span><span class="w"> </span><span class="n">trap</span>: <span class="nc">unreachable</span><span class="w"></span>
<span class="w">       </span><span class="n">wasm</span><span class="w"> </span><span class="n">backtrace</span>:
           <span class="mi">0</span>: <span class="mh">0x6c1c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">panic_abort</span>::<span class="n">__rust_start_panic</span>::<span class="n">abort</span>::<span class="n">h2d60298621b1ccbf</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">__rust_start_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">panic_abort</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">32</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">1</span>: <span class="mh">0x68c7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rust_panic</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">626</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span>: <span class="mh">0x65a1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">h2345fb0909b53e12</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">596</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">3</span>: <span class="mh">0x1436</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">h106f151a6db8c8fb</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">506</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">           </span><span class="mi">4</span>:  <span class="mh">0xda8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">he55aa13f22782798</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">153</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">5</span>: <span class="mh">0x1324</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic</span>::<span class="n">h1727e7d1d719c76f</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">505</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">           </span><span class="mi">6</span>:  <span class="mh">0xfde</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">foo</span>::<span class="n">main</span>::<span class="n">h2db1313a64510850</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">acrichton</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">foo</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">2</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">7</span>: <span class="mh">0x11d5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h20ee1cc04aeff1fc</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">           </span><span class="mi">8</span>:  <span class="mh">0xddf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h054493e41e27e69c</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">137</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">           </span><span class="mi">9</span>: <span class="mh">0x1d5a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="n">hd83784448d3fcb42</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">          </span><span class="mi">10</span>: <span class="mh">0x69d8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">F</span><span class="o">&gt;</span>::<span class="n">call_once</span>::<span class="n">h564d3dad35014917</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">do_call</span>::<span class="n">hdca4832ace5a8603</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">381</span>:<span class="mi">40</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="k">try</span>::<span class="n">ha8624a1a6854b456</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">345</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h71421f57cf2bc688</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">382</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">                     </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h260050c92cd470af</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span>:<span class="mi">25</span><span class="w"></span>
<span class="w">          </span><span class="mi">11</span>: <span class="mh">0x1d0c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">h0b4bcf3c5e498224</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">eac88abb2e57e752f3302f02be5f3ce3d7adfb4</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">          </span><span class="mi">12</span>:  <span class="mh">0xffc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unknown</span><span class="o">&gt;!</span><span class="n">__original_main</span><span class="w"></span>
<span class="w">          </span><span class="mi">13</span>:  <span class="mh">0x393</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">__muloti4</span><span class="w"></span>
<span class="w">                           </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">compiler_builtins</span><span class="o">-</span><span class="mf">0.1.35</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">macros</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">269</span><span class="w"></span>
</code></pre></div>
<p>This is relatively noisy by default but there's filenames and line<br>
numbers! Additionally frame 10 can be seen to have lots of frames<br>
inlined into it. All information is always available to the embedder but<br>
we could try to handle the <code>__rust_begin_short_backtrace</code> and<br>
<code>__rust_end_short_backtrace</code> markers to trim the backtrace by default as<br>
well.</p>
<p>The only gotcha here is that it looks like <code>__muloti4</code> is out of place.<br>
That's because the libc that Rust ships with doesn't have dwarf<br>
information, although I'm not sure why we land in that function for<br>
symbolizing it...<br>
</p>
</blockquote>



<a name="218493925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232452%20Provide%20filename/line%20number%20informat.../near/218493925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232452.20Provide.20filename.2Fline.20number.20informat.2E.2E.2E.html#218493925">(Dec 01 2020 at 22:56)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2452">PR #2452</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>