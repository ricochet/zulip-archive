<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5876 Cranelift: MIRI complaining about ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html">wasmtime / issue #5876 Cranelift: MIRI complaining about ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="336525944"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/336525944" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#336525944">(Feb 24 2023 at 16:21)</a>:</h4>
<p>mokhaled2992 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span>::<span class="n">slice_from_raw_parts_mut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt;:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">FnEntry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt;<span class="p">.</span><span class="n">rs</span>:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">from_raw_parts_mut</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>: <span class="mi">145</span>:<span class="mi">55</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">60</span>:<span class="mi">38</span>: <span class="mi">60</span>:<span class="mi">63</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1304</span>:<span class="mi">29</span>: <span class="mi">1306</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">97</span>:<span class="mi">9</span>: <span class="mi">97</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">5</span>: <span class="mi">125</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1464</span>:<span class="mi">5</span>: <span class="mi">1464</span>:<span class="mi">45</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">9</span>: <span class="mi">41</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">9</span>: <span class="mi">58</span>:<span class="mi">83</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">69</span>:<span class="mi">40</span>: <span class="mi">69</span>:<span class="mi">79</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">173</span>:<span class="mi">9</span>: <span class="mi">173</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">185</span>:<span class="mi">23</span>: <span class="mi">185</span>:<span class="mi">48</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">687</span>:<span class="mi">19</span>: <span class="mi">687</span>:<span class="mi">42</span>

<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serializer_func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
</code></pre></div>
<p>Rust version <code>rustc 1.68.0-nightly (935dc0721 2022-12-19)</code></p>
</blockquote>



<a name="336525945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/336525945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#336525945">(Feb 24 2023 at 16:21)</a>:</h4>
<p>mokhaled2992 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span>::<span class="n">slice_from_raw_parts_mut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt;:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">FnEntry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt;<span class="p">.</span><span class="n">rs</span>:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">from_raw_parts_mut</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>: <span class="mi">145</span>:<span class="mi">55</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">60</span>:<span class="mi">38</span>: <span class="mi">60</span>:<span class="mi">63</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1304</span>:<span class="mi">29</span>: <span class="mi">1306</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">97</span>:<span class="mi">9</span>: <span class="mi">97</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">5</span>: <span class="mi">125</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1464</span>:<span class="mi">5</span>: <span class="mi">1464</span>:<span class="mi">45</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">9</span>: <span class="mi">41</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">9</span>: <span class="mi">58</span>:<span class="mi">83</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">69</span>:<span class="mi">40</span>: <span class="mi">69</span>:<span class="mi">79</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">173</span>:<span class="mi">9</span>: <span class="mi">173</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">185</span>:<span class="mi">23</span>: <span class="mi">185</span>:<span class="mi">48</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">687</span>:<span class="mi">19</span>: <span class="mi">687</span>:<span class="mi">42</span>

<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serializer_func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
</code></pre></div>
<p>Rust version <code>rustc 1.68.0-nightly (935dc0721 2022-12-19)</code></p>
</blockquote>



<a name="336525948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/336525948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#336525948">(Feb 24 2023 at 16:21)</a>:</h4>
<p>mokhaled2992 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span>::<span class="n">slice_from_raw_parts_mut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt;:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">FnEntry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt;<span class="p">.</span><span class="n">rs</span>:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">from_raw_parts_mut</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>: <span class="mi">145</span>:<span class="mi">55</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">60</span>:<span class="mi">38</span>: <span class="mi">60</span>:<span class="mi">63</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1304</span>:<span class="mi">29</span>: <span class="mi">1306</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">97</span>:<span class="mi">9</span>: <span class="mi">97</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">5</span>: <span class="mi">125</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1464</span>:<span class="mi">5</span>: <span class="mi">1464</span>:<span class="mi">45</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">9</span>: <span class="mi">41</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">9</span>: <span class="mi">58</span>:<span class="mi">83</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">69</span>:<span class="mi">40</span>: <span class="mi">69</span>:<span class="mi">79</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">173</span>:<span class="mi">9</span>: <span class="mi">173</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">185</span>:<span class="mi">23</span>: <span class="mi">185</span>:<span class="mi">48</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">687</span>:<span class="mi">19</span>: <span class="mi">687</span>:<span class="mi">42</span>

<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serializer_func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
</code></pre></div>
<p>Rust version <code>rustc 1.68.0-nightly (935dc0721 2022-12-19)</code></p>
</blockquote>



<a name="336542939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/336542939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#336542939">(Feb 24 2023 at 17:32)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1444095340">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>I haven't looked at MIRI output before, so I'm not sure I'm reading this correctly. From the backtrace, it looks like the last code we wrote on the way to the error is regalloc2's <code>ion/liveranges.rs</code>, in <code>fixup_multi_fixed_vregs</code>.</p>
<p>So at a first guess, probably @cfallin should take a look at this.</p>
</blockquote>



<a name="336551204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/336551204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#336551204">(Feb 24 2023 at 18:12)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1444175186">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>@mokhaled2992 thank you for this report; however I have to admit I'm pretty perplexed by it. From the included stacktrace, it looks like the actual issue is in <code>slice_group_by::linear_group::linear_group_by_key</code>, i.e., an iterator-producing helper method on a slice that we call. I don't think this is any problem in <code>regalloc2</code> itself, for other reasons as well: RA2 uses no unsafe code, and does not play any tricks with lifetimes otherwise.</p>
<p>I also note there are no details on how to reproduce this; in general, issues are more useful when we can reproduce the output to look for ourselves :-)</p>
<p>Would you be able to dig further and let us know where you think the issue is coming from, and e.g. if the issue is actually in <code>group_by</code> as noted above?</p>
</blockquote>



<a name="339145211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339145211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339145211">(Mar 02 2023 at 16:21)</a>:</h4>
<p>mokhaled2992 edited <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span>::<span class="n">slice_from_raw_parts_mut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt;:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">FnEntry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt;<span class="p">.</span><span class="n">rs</span>:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">from_raw_parts_mut</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>: <span class="mi">145</span>:<span class="mi">55</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">60</span>:<span class="mi">38</span>: <span class="mi">60</span>:<span class="mi">63</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1304</span>:<span class="mi">29</span>: <span class="mi">1306</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">97</span>:<span class="mi">9</span>: <span class="mi">97</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">5</span>: <span class="mi">125</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1464</span>:<span class="mi">5</span>: <span class="mi">1464</span>:<span class="mi">45</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">9</span>: <span class="mi">41</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">9</span>: <span class="mi">58</span>:<span class="mi">83</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">69</span>:<span class="mi">40</span>: <span class="mi">69</span>:<span class="mi">79</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">173</span>:<span class="mi">9</span>: <span class="mi">173</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">185</span>:<span class="mi">23</span>: <span class="mi">185</span>:<span class="mi">48</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">687</span>:<span class="mi">19</span>: <span class="mi">687</span>:<span class="mi">42</span>

<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serializer_func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
</code></pre></div>
<p>Rust version <code>rustc 1.68.0-nightly (935dc0721 2022-12-19)</code></p>
</blockquote>



<a name="339360292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339360292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339360292">(Mar 03 2023 at 14:32)</a>:</h4>
<p>jakubDoka <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1453619665">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>I am experiencing similar problem</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">25171425</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc10208590</span><span class="p">[</span><span class="mh">0x58</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">25171425</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc10208590</span><span class="p">[</span><span class="mh">0x58</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc10208590</span><span class="p">[</span><span class="mh">0x58</span><span class="o">..</span><span class="mh">0x64</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">25171425</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x58</span><span class="o">..</span><span class="mh">0x70</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">Catalyst</span><span class="o">/</span><span class="n">subcommands</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">logic</span><span class="o">/</span><span class="n">worker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">928</span>:<span class="mi">36</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">928</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span>
<span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="n">____________________________________</span><span class="o">^</span>
<span class="mi">929</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">ctx</span>
<span class="mi">930</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">cranelift</span>
<span class="mi">931</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="o">&amp;*</span><span class="bp">self</span><span class="p">.</span><span class="n">isa</span><span class="p">.</span><span class="n">inner</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">__________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">25171425</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x58</span><span class="o">..</span><span class="mh">0x70</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">Catalyst</span><span class="o">/</span><span class="n">subcommands</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">logic</span><span class="o">/</span><span class="n">worker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">928</span>:<span class="mi">36</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">928</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span>
<span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="n">____________________________________</span><span class="o">^</span>
<span class="mi">929</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">ctx</span>
<span class="mi">930</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">cranelift</span>
<span class="mi">931</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="o">&amp;*</span><span class="bp">self</span><span class="p">.</span><span class="n">isa</span><span class="p">.</span><span class="n">inner</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">__________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.5.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1329</span>:<span class="mi">29</span>: <span class="mi">1331</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.5.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">100</span>:<span class="mi">9</span>: <span class="mi">100</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.5.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">133</span>:<span class="mi">5</span>: <span class="mi">133</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.5.1</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1481</span>:<span class="mi">5</span>: <span class="mi">1481</span>:<span class="mi">67</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.92.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span>: <span class="mi">57</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.92.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span>: <span class="mi">57</span>:<span class="mi">68</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.92.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">67</span>:<span class="mi">40</span>: <span class="mi">67</span>:<span class="mi">64</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.92.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">143</span>:<span class="mi">9</span>: <span class="mi">143</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.92.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">215</span>:<span class="mi">23</span>: <span class="mi">215</span>:<span class="mi">48</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">middleware</span>::<span class="n">logic</span>::<span class="n">worker</span>::<span class="n">GeneratorThread</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span>::<span class="n">generate</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">Catalyst</span><span class="o">/</span><span class="n">subcommands</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">logic</span><span class="o">/</span><span class="n">worker</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">928</span>:<span class="mi">36</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">928</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span>
<span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="n">____________________________________</span><span class="o">^</span>
<span class="mi">929</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">ctx</span>
<span class="mi">930</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">cranelift</span>
<span class="mi">931</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="o">&amp;*</span><span class="bp">self</span><span class="p">.</span><span class="n">isa</span><span class="p">.</span><span class="n">inner</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">__________________________________________</span><span class="o">^</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="n">closure</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mlokis</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">Catalyst</span><span class="o">/</span><span class="n">subcommands</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">logic</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">827</span>:<span class="mi">21</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">827</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">                     </span><span class="n">GeneratorThread</span><span class="w"> </span><span class="p">{</span>
<span class="mi">828</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                         </span><span class="n">requests</span><span class="p">,</span>
<span class="mi">829</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                         </span><span class="n">mir</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">mir</span><span class="p">,</span>
<span class="mi">830</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                         </span><span class="n">resources</span><span class="p">,</span>
<span class="o">..</span><span class="p">.</span><span class="w">   </span><span class="o">|</span>
<span class="mi">837</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="p">}</span>
<span class="mi">838</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">                     </span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">ir_dump</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>
</code></pre></div>
<p>just in case this proves to be useful</p>
</blockquote>



<a name="339925316"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339925316" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339925316">(Mar 06 2023 at 17:19)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1456566233">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>So I was able to reproduce the problem. After doing some reading on these <a href="https://plv.mpi-sws.org/rustbelt/stacked-borrows/paper.pdf">stacked borrows</a> and looking at the code of the <code>slice-group-by</code> its usages in <code>regalloc2</code>, I <strong>_guessed_</strong> that miri does not like the pointer to reference conversions done by the <code>slice-group-by</code> crate inside <code>fixup_multi_fixed_vregs</code>. My naive understanding is that the same pointer gets converted to a <code>mut</code> and non mut references in the same scope which miri assumes it breaks the borrow checking rules.</p>
<p>Minimal example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">slice_group_by</span>::<span class="n">GroupByMut</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Preparing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sysroot</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Miri</span><span class="w"> </span><span class="p">(</span><span class="n">target</span>: <span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">)</span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">done</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">HelloWorld</span><span class="err">`</span>
<span class="n">warning</span>: <span class="nc">crate</span><span class="w"> </span><span class="err">`</span><span class="n">HelloWorld</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span>: <span class="err">`</span><span class="n">hello_world</span><span class="err">`</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(non_snake_case)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x4</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">44</span>: <span class="mi">6</span>:<span class="mi">47</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>

<span class="n">note</span>: <span class="nc">some</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">MIRIFLAGS</span><span class="o">=-</span><span class="n">Zmiri</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="339925535"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339925535" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339925535">(Mar 06 2023 at 17:20)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1456566233">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>So I was able to reproduce the problem. After doing some reading on these <a href="https://plv.mpi-sws.org/rustbelt/stacked-borrows/paper.pdf">stacked borrows</a> and looking at the code of the <code>slice-group-by</code> its usages in <code>regalloc2</code>, I <strong>_guessed_</strong> that miri does not like the pointer to reference conversions done by the <code>slice-group-by</code> crate inside <code>fixup_multi_fixed_vregs</code>. My naive understanding is that the same pointer gets converted to a <code>mut</code> and non mut references in the same scope which miri assumes it breaks the borrow checking rules.</p>
<p>Minimal example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">slice_group_by</span>::<span class="n">GroupByMut</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Miri complaining</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">miri</span><span class="w"> </span><span class="n">run</span>

<span class="n">Preparing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sysroot</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Miri</span><span class="w"> </span><span class="p">(</span><span class="n">target</span>: <span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">)</span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">done</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">HelloWorld</span><span class="err">`</span>
<span class="n">warning</span>: <span class="nc">crate</span><span class="w"> </span><span class="err">`</span><span class="n">HelloWorld</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span>: <span class="err">`</span><span class="n">hello_world</span><span class="err">`</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(non_snake_case)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x4</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">44</span>: <span class="mi">6</span>:<span class="mi">47</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>

<span class="n">note</span>: <span class="nc">some</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">MIRIFLAGS</span><span class="o">=-</span><span class="n">Zmiri</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="339925574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339925574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339925574">(Mar 06 2023 at 17:20)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1456566233">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>So I was able to reproduce the problem. After doing some reading on these <a href="https://plv.mpi-sws.org/rustbelt/stacked-borrows/paper.pdf">stacked borrows</a> and looking at the code of the <code>slice-group-by</code> its usages in <code>regalloc2</code>, I <strong>_guessed_</strong> that miri does not like the pointer to reference conversions done by the <code>slice-group-by</code> crate inside <code>fixup_multi_fixed_vregs</code>. My naive understanding is that the same pointer gets converted to a <code>mut</code> and non mut references in the same scope which miri assumes it breaks the borrow checking rules.</p>
<p>Minimal example</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">slice_group_by</span>::<span class="n">GroupByMut</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Miri complaining</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">miri</span><span class="w"> </span><span class="n">run</span>

<span class="n">Preparing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sysroot</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Miri</span><span class="w"> </span><span class="p">(</span><span class="n">target</span>: <span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">)</span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">done</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">HelloWorld</span><span class="err">`</span>
<span class="n">warning</span>: <span class="nc">crate</span><span class="w"> </span><span class="err">`</span><span class="n">HelloWorld</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span>: <span class="err">`</span><span class="n">hello_world</span><span class="err">`</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(non_snake_case)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x4</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">44</span>: <span class="mi">6</span>:<span class="mi">47</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>

<span class="n">note</span>: <span class="nc">some</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">MIRIFLAGS</span><span class="o">=-</span><span class="n">Zmiri</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="339925814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339925814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339925814">(Mar 06 2023 at 17:21)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1456566233">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>So I was able to reproduce the problem. After doing some reading on these <a href="https://plv.mpi-sws.org/rustbelt/stacked-borrows/paper.pdf">stacked borrows</a> and looking at the code of the <code>slice-group-by</code> its usages in <code>regalloc2</code>, I <strong>_guessed_</strong> that miri does not like the pointer to reference conversions done by the <code>slice-group-by</code> crate inside <code>fixup_multi_fixed_vregs</code>. My naive understanding is that the same pointer gets converted to a <code>mut</code> and non mut references in the same scope which miri assumes it breaks the borrow checking rules.</p>
<p>Minimal example</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">slice_group_by</span>::<span class="n">GroupByMut</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Miri complaining</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">miri</span><span class="w"> </span><span class="n">run</span>

<span class="n">Preparing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sysroot</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Miri</span><span class="w"> </span><span class="p">(</span><span class="n">target</span>: <span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">)</span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">done</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">HelloWorld</span><span class="err">`</span>
<span class="n">warning</span>: <span class="nc">crate</span><span class="w"> </span><span class="err">`</span><span class="n">HelloWorld</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span>: <span class="err">`</span><span class="n">hello_world</span><span class="err">`</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(non_snake_case)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x4</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">44</span>: <span class="mi">6</span>:<span class="mi">47</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>

<span class="n">note</span>: <span class="nc">some</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">MIRIFLAGS</span><span class="o">=-</span><span class="n">Zmiri</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span>
</code></pre></div>
<p>I would suggest to replace the <code>slice-group-by</code> with the <code>std::slice::split</code> <a href="https://doc.rust-lang.org/std/primitive.slice.html#method.split">https://doc.rust-lang.org/std/primitive.slice.html#method.split</a> if that can achieve the same outcome.</p>
</blockquote>



<a name="339931566"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339931566" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339931566">(Mar 06 2023 at 17:47)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1456566233">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>So I was able to reproduce the problem. After doing some reading on these <a href="https://plv.mpi-sws.org/rustbelt/stacked-borrows/paper.pdf">stacked borrows</a> and looking at the code of the <code>slice-group-by</code> and its usages in <code>regalloc2</code>, I <strong>_guessed_</strong> that miri does not like the pointer to reference conversions done by the <code>slice-group-by</code> APIs indirectly inside <code>fixup_multi_fixed_vregs</code>. My naive understanding is that the same pointer gets converted to a <code>mut</code> and non mut references in the same scope which miri assumes it breaks the borrow checking rules.</p>
<p>Minimal example</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">slice_group_by</span>::<span class="n">GroupByMut</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter_mut</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{j}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Miri complaining</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">cargo</span><span class="w"> </span><span class="n">miri</span><span class="w"> </span><span class="n">run</span>

<span class="n">Preparing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">sysroot</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Miri</span><span class="w"> </span><span class="p">(</span><span class="n">target</span>: <span class="nc">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="p">)</span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="n">done</span>
<span class="w">    </span><span class="n">Finished</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="p">[</span><span class="n">unoptimized</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debuginfo</span><span class="p">]</span><span class="w"> </span><span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.00</span><span class="n">s</span>
<span class="w">     </span><span class="n">Running</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cargo</span><span class="o">-</span><span class="n">miri</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">miri</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">HelloWorld</span><span class="err">`</span>
<span class="n">warning</span>: <span class="nc">crate</span><span class="w"> </span><span class="err">`</span><span class="n">HelloWorld</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="o">|</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">snake</span><span class="w"> </span><span class="n">case</span>: <span class="err">`</span><span class="n">hello_world</span><span class="err">`</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="err">`</span><span class="cp">#[warn(non_snake_case)]</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>

<span class="n">error</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">214</span>:<span class="mi">1</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">214</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_by_key</span><span class="o">!</span><span class="p">{</span><span class="w"> </span><span class="k">struct</span> <span class="nc">LinearGroupByKeyMut</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">from_raw_parts_mut</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SharedReadOnly</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc1564</span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x4</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">3196</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x0</span><span class="o">..</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">entry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">44</span>: <span class="mi">6</span>:<span class="mi">47</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">33</span>: <span class="mi">41</span>:<span class="mi">38</span>
<span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">main</span><span class="err">`</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="nc">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6</span>:<span class="mi">14</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">6</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">slice</span><span class="p">.</span><span class="n">linear_group_by_key_mut</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">|</span><span class="w">              </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">originates</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">macro</span><span class="w"> </span><span class="err">`</span><span class="n">group_by_key</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">Nightly</span><span class="w"> </span><span class="n">builds</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="kr">macro</span><span class="o">-</span><span class="n">backtrace</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">info</span><span class="p">)</span>

<span class="n">note</span>: <span class="nc">some</span><span class="w"> </span><span class="n">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">MIRIFLAGS</span><span class="o">=-</span><span class="n">Zmiri</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span>

<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span>
</code></pre></div>
<p>I would suggest to replace the <code>slice-group-by</code> with the <code>std::slice::split</code> <a href="https://doc.rust-lang.org/std/primitive.slice.html#method.split">https://doc.rust-lang.org/std/primitive.slice.html#method.split</a> if that can achieve the same outcome.</p>
</blockquote>



<a name="339978663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339978663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339978663">(Mar 06 2023 at 22:20)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1457100949">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<blockquote>
<p>miri does not like the pointer to reference conversions done by the slice-group-by APIs</p>
</blockquote>
<p>OK, great; so, to summarize, the issue is in the <code>slice_group_by</code> crate. (Unfortunately your suggestion to use <code>std::slice::split</code> instead doesn't quite work; the semantics are a little different.)</p>
<p>I would recommend filing an issue with that crate. We are simply using the crate according to its API, so the bug is not here, IMHO. Since this isn't an issue with regalloc2 (or Cranelift or Wasmtime, on whose repo this issue is filed), I'll go ahead and close this.</p>
</blockquote>



<a name="339978664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/339978664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#339978664">(Mar 06 2023 at 22:20)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">rror</span>: <span class="nc">Undefined</span><span class="w"> </span><span class="n">Behavior</span>: <span class="nc">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">   </span><span class="o">-</span>-&gt; <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">145</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span>::<span class="n">slice_from_raw_parts_mut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="p">],</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">borrow</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">location</span>
<span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">alloc3449930</span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">this</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="n">bug</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span>: <span class="nc">it</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Stacked</span><span class="w"> </span><span class="n">Borrows</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">violated</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="n">experimental</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">help</span>: <span class="nc">see</span><span class="w"> </span><span class="n">https</span>:<span class="c1">//github.com/rust-lang/unsafe-code-guidelines/blob/master/wip/stacked-borrows.md for further information</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SharedReadWrite</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span>
<span class="w">   </span><span class="o">-</span>-&gt;:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="n">help</span>: <span class="o">&lt;</span><span class="mi">11026494</span><span class="o">&gt;</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="p">[</span><span class="mh">0x110c</span><span class="o">..</span><span class="mh">0x1118</span><span class="p">]</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Unique</span><span class="w"> </span><span class="n">FnEntry</span><span class="w"> </span><span class="n">retag</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">call</span>
<span class="w">   </span><span class="o">-</span>-&gt;<span class="p">.</span><span class="n">rs</span>:<span class="mi">339</span>:<span class="mi">9</span>
<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">BACKTRACE</span>:
    <span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">std</span>::<span class="n">slice</span>::<span class="n">from_raw_parts_mut</span>::<span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">rustup</span><span class="o">/</span><span class="n">toolchains</span><span class="o">/</span><span class="n">nightly</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rustlib</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">slice</span><span class="o">/</span><span class="n">raw</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">145</span>:<span class="mi">9</span>: <span class="mi">145</span>:<span class="mi">55</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">slice_group_by</span>::<span class="n">linear_group</span>::<span class="n">linear_group_by_key</span>::<span class="n">LinearGroupByKeyMut</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Use</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">closure</span><span class="o">@</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span>::<span class="p">{</span><span class="n">closure</span>#<span class="mi">0</span><span class="p">}]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">next</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">slice</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="mf">0.3.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linear_group</span><span class="o">/</span><span class="n">linear_group_by_key</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">60</span>:<span class="mi">38</span>: <span class="mi">60</span>:<span class="mi">63</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">liveranges</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">fixup_multi_fixed_vregs</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="n">liveranges</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1304</span>:<span class="mi">29</span>: <span class="mi">1306</span>:<span class="mi">56</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">data_structures</span>::<span class="n">Env</span><span class="o">&lt;'</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;&gt;</span>::<span class="n">init</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">97</span>:<span class="mi">9</span>: <span class="mi">97</span>:<span class="mi">39</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">ion</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ion</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">5</span>: <span class="mi">125</span>:<span class="mi">15</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">regalloc2</span>::<span class="n">run</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">vcode</span>::<span class="n">VCode</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">isle</span>::<span class="n">generated_code</span>::<span class="n">MInst</span><span class="o">&gt;&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">regalloc2</span><span class="o">-</span><span class="mf">0.3.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1464</span>:<span class="mi">5</span>: <span class="mi">1464</span>:<span class="mi">45</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span>::<span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">machinst</span><span class="o">/</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">41</span>:<span class="mi">9</span>: <span class="mi">41</span>:<span class="mi">54</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">58</span>:<span class="mi">9</span>: <span class="mi">58</span>:<span class="mi">83</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">TargetIsa</span><span class="o">&gt;</span>::<span class="n">compile_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">69</span>:<span class="mi">40</span>: <span class="mi">69</span>:<span class="mi">79</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile_stencil</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">173</span>:<span class="mi">9</span>: <span class="mi">173</span>:<span class="mi">59</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="n">cranelift_codegen</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">codegen</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">185</span>:<span class="mi">23</span>: <span class="mi">185</span>:<span class="mi">48</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="nc">inside</span><span class="w"> </span><span class="err">`</span><span class="o">&lt;</span><span class="n">cranelift_jit</span>::<span class="n">JITModule</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cranelift_module</span>::<span class="n">Module</span><span class="o">&gt;</span>::<span class="n">define_function</span><span class="err">`</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">i572922</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mf">0.88.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">backend</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">687</span>:<span class="mi">19</span>: <span class="mi">687</span>:<span class="mi">42</span>

<span class="w">    </span><span class="o">|</span>
<span class="mi">339</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">         </span><span class="bp">self</span><span class="p">.</span><span class="n">module</span>
<span class="mi">340</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">as_mut</span><span class="p">()</span>
<span class="mi">341</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span>
<span class="mi">342</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="p">.</span><span class="n">define_function</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">serializer_func_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="n">____________________________________________________________________</span><span class="o">^</span>
</code></pre></div>
<p>Rust version <code>rustc 1.68.0-nightly (935dc0721 2022-12-19)</code></p>
</blockquote>



<a name="340064010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/340064010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#340064010">(Mar 07 2023 at 10:01)</a>:</h4>
<p>mokhaled2992 <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1457884688">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>As I said in my comment this is just my guess. The alternatives are:</p>
<ul>
<li>A stacked borrows violation by the <code>slice-group-by</code> crate</li>
<li>A stacked borrows violation in the <code>regalloc2</code> usage for creating a mut and non mut references to the same pointer</li>
<li>A stack borrows bug in miri</li>
</ul>
</blockquote>



<a name="340064722"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/340064722" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#340064722">(Mar 07 2023 at 10:05)</a>:</h4>
<p>mokhaled2992 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1457884688">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>As I said in my comment this is just my guess. The alternatives are:</p>
<ul>
<li>A stacked borrows violation by the <code>slice-group-by</code> crate</li>
<li>A stacked borrows violation in the <code>regalloc2</code> usage for creating a mut and non mut references to the same pointer</li>
<li>A stack borrows bug in miri</li>
</ul>
<p>Ideally this should be checked by someone who has more expertise with the stacked borrows.</p>
</blockquote>



<a name="340180684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235876%20Cranelift%3A%20MIRI%20complaining%20about%20.../near/340180684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235876.20Cranelift.3A.20MIRI.20complaining.20about.20.2E.2E.2E.html#340180684">(Mar 07 2023 at 18:21)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/5876#issuecomment-1458626755">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/5876">issue #5876</a>:</p>
<blockquote>
<p>OK, thanks. The one possibility in your list that involves BA code</p>
<blockquote>
<p>A stacked borrows violation in the regalloc2 usage for creating a mut and non mut references to the same pointer</p>
</blockquote>
<p>doesn't seem possible to me, as regalloc2 does not have any unsafe Rust code.</p>
<p>Your minimal example above is also more-or-less an argument that this is not regalloc2: you were able to get the same error in <code>slice-group-by</code> when driving it with your own code.</p>
<p>If you do narrow down the issue explicitly to some code that we manage, please do feel free to leave more details here!</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>