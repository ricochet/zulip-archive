<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8792 wasi-adapter: Implement provider crat... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html">wasmtime / PR #8792 wasi-adapter: Implement provider crat...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="444386746"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386746" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386746">(Jun 13 2024 at 05:37)</a>:</h4>
<p>juntyr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a> from <code>juntyr:wasi-adapter-provider</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Fixes #8759</p>
<p>This PR adds a new <code>wasi-preview1-component-adapter-provider</code> crate that embeds the binary contents of the three wasi adapters. As per @alexcrichton's suggestion, this crate contains the adapter files as artefacts, which are checked in CI to match the freshly compiled versions of the <code>wasi-preview1-component-adapter</code> crate. The new crate is intended to be published on <a href="http://crates.io">crates.io</a> and allow Rust code which programmatically builds WASM components to use the adapter without needing more than a normal crate dependency (instead of having to manually download the file).</p>
</blockquote>



<a name="444386748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386748">(Jun 13 2024 at 05:37)</a>:</h4>
<p><strong>juntyr</strong> requested <a href="https://github.com/alexcrichton">alexcrichton</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444386749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386749">(Jun 13 2024 at 05:37)</a>:</h4>
<p><strong>juntyr</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444386751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386751">(Jun 13 2024 at 05:37)</a>:</h4>
<p><strong>juntyr</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444386855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386855">(Jun 13 2024 at 05:38)</a>:</h4>
<p>juntyr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2114747812">PR review</a>.</p>



<a name="444386856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386856">(Jun 13 2024 at 05:38)</a>:</h4>
<p>juntyr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2114747812">PR review</a>.</p>



<a name="444386857"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444386857" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444386857">(Jun 13 2024 at 05:38)</a>:</h4>
<p>juntyr created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1637576459">PR review comment</a>:</p>
<blockquote>
<p>@alexcrichton I didn't find as much information on the proxy online and in code. Does it implement a pre-defined HTTP proxy world?</p>
</blockquote>



<a name="444388069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444388069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444388069">(Jun 13 2024 at 05:50)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444388488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444388488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444388488">(Jun 13 2024 at 05:54)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2164485443">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>@alexcrichton Well at least the CI check works :)</p>
<p>I tried rebuilding the adapters locally with 1.76.0 stable and the pinned wasm-tools version and got the local CI script to pass, but the GitHub CI check still failed. Is there something else I need to do to make the build reproducible and push a matching artefact?</p>
</blockquote>



<a name="444487035"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444487035" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444487035">(Jun 13 2024 at 15:03)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2116064696">PR review</a>:</p>
<blockquote>
<p>Thanks for this! For the CI failure you say you're using Rust 1.76 but CI is using Rust 1.78, so that may be the culprit? </p>
<p>In addition to that there's a few more things here I think:</p>
<ul>
<li>By default the version of Rust used to compile the adapter will change whenever we bump the MSRV. This seems a little unfortunate and I think it'd be better to do this as a discrete step for the adapter to reduce the annoyance of updating our MSRV. Could the rust version be explicitly specified for the CI job that builds the adapter as exactly <code>1.78.0</code>? This might require splitting out the CI job so it's only build the adapter and doing nothing else.</li>
<li>Currently there's not an easy way to rebuild the adapter locally and then check in the results. Could the <code>cmp</code> commands in the build script be conditional somehow? For example they should only run on CI but locally you can skip them if you want to regenerate all the adapters.</li>
</ul>
</blockquote>



<a name="444487036"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444487036" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444487036">(Jun 13 2024 at 15:03)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2116064696">PR review</a>:</p>
<blockquote>
<p>Thanks for this! For the CI failure you say you're using Rust 1.76 but CI is using Rust 1.78, so that may be the culprit? </p>
<p>In addition to that there's a few more things here I think:</p>
<ul>
<li>By default the version of Rust used to compile the adapter will change whenever we bump the MSRV. This seems a little unfortunate and I think it'd be better to do this as a discrete step for the adapter to reduce the annoyance of updating our MSRV. Could the rust version be explicitly specified for the CI job that builds the adapter as exactly <code>1.78.0</code>? This might require splitting out the CI job so it's only build the adapter and doing nothing else.</li>
<li>Currently there's not an easy way to rebuild the adapter locally and then check in the results. Could the <code>cmp</code> commands in the build script be conditional somehow? For example they should only run on CI but locally you can skip them if you want to regenerate all the adapters.</li>
</ul>
</blockquote>



<a name="444487039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444487039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444487039">(Jun 13 2024 at 15:03)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1638374073">PR review comment</a>:</p>
<blockquote>
<p>It corresponds to <a href="https://github.com/WebAssembly/WASI/blob/main/preview2/http/proxy.wit#L7">this <code>world</code></a>, notably <code>wasi:http/proxy</code> which doesn't have filesystem/env vars/cli arguments/etc</p>
</blockquote>



<a name="444634007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444634007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444634007">(Jun 14 2024 at 07:10)</a>:</h4>
<p>juntyr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2117652074">PR review</a>.</p>



<a name="444634008"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444634008" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444634008">(Jun 14 2024 at 07:10)</a>:</h4>
<p>juntyr created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1639372151">PR review comment</a>:</p>
<blockquote>
<p>Thanks! I think what confused me is that the adapter defines the world inline here: </p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/3bcbd5e597c483928d1c064955b027404cd8b465/crates/wasi-preview1-component-adapter/src/lib.rs#L83-L102">https://github.com/bytecodealliance/wasmtime/blob/3bcbd5e597c483928d1c064955b027404cd8b465/crates/wasi-preview1-component-adapter/src/lib.rs#L83-L102</a></p>
<p>which includes most imports but not the incoming HTTP request handler import and not the outgoing HTTP request export.</p>
</blockquote>



<a name="444638057"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444638057" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444638057">(Jun 14 2024 at 07:30)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444639486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444639486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444639486">(Jun 14 2024 at 07:37)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444640569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444640569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444640569">(Jun 14 2024 at 07:44)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2167436422">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for this! For the CI failure you say you're using Rust 1.76 but CI is using Rust 1.78, so that may be the culprit?</p>
<p>In addition to that there's a few more things here I think:</p>
<ul>
<li>By default the version of Rust used to compile the adapter will change whenever we bump the MSRV. This seems a little unfortunate and I think it'd be better to do this as a discrete step for the adapter to reduce the annoyance of updating our MSRV. Could the rust version be explicitly specified for the CI job that builds the adapter as exactly <code>1.78.0</code>? This might require splitting out the CI job so it's only build the adapter and doing nothing else.</li>
<li>Currently there's not an easy way to rebuild the adapter locally and then check in the results. Could the <code>cmp</code> commands in the build script be conditional somehow? For example they should only run on CI but locally you can skip them if you want to regenerate all the adapters.</li>
</ul>
</blockquote>
<p>I'm a bit stumped. I check in CI and it now seems to build with 1.79 but even when I build locally with 1.79 it still produces different artefacts.</p>
<p>I absolutely agree we should explicitly lock down the adapter build settings to ensure that local build and CI builds remain the same unless someone explicitly changes that setting (including the Rust version). Once I have a successful build, I'll implement that.</p>
<p>What we could do perhaps is to offer two (mutually exclusive) options for the CI script:</p>
<ul>
<li>no options just build the adapters to the target folder, as before</li>
<li><code>--replace</code> also copies the newly built adapters into the provider crate</li>
<li><code>--check</code> checks the newly built adapters against the provider crate (used in CI)</li>
</ul>
<p>I'll add that once CI works.</p>
</blockquote>



<a name="444642751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444642751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444642751">(Jun 14 2024 at 07:59)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2167469828">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>I restarted my dev container, cleared my target folder, followed all toolchain setup steps from the job output log, and reran the build script locally, which produced no change in the adapter binaries. So locally the build is reproducible, but something must still be different in CI.</p>
</blockquote>



<a name="444716105"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444716105" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444716105">(Jun 14 2024 at 14:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168203029">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>Ah yesterday it was Rust 1.78 but we upgraded to 1.79 yesterday too, explaining that discrepancy. What os are you on? I've seen that macOS produces different binaries than Linux, for example, and that might be happening here. I can try to dig in today as well and see what's going on.</p>
</blockquote>



<a name="444757313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444757313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444757313">(Jun 14 2024 at 17:52)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168501040">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>I was running on a Linux GitHub codespace container and tried both 1.78 and 1.79 today. I also used the same version of wasm tools as the one in CI and checked the Rust version hash from the CI job log. If you do have a bit of time to spare to investigate, that would be brilliant :)</p>
</blockquote>



<a name="444766283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444766283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444766283">(Jun 14 2024 at 18:43)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444766527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444766527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444766527">(Jun 14 2024 at 18:44)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168573803">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>Hm interestingly I checked out this branch, ran the script, and it didn't fail. Locally I've got rustc 1.78 and wasm-tools 1.201, as opposed to CI which for the last build used rustc 1.79 and wasm-tools 1.0.27.</p>
<p>I added some debugging in the hopes of seeing what's happening in CI</p>
</blockquote>



<a name="444767308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444767308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444767308">(Jun 14 2024 at 18:49)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444768549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444768549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444768549">(Jun 14 2024 at 18:57)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168590069">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>Ok now I think it's more clear what's happening:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Reference</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">of</span>
<span class="n">the</span><span class="w"> </span><span class="n">adapter</span>
<span class="w">  </span><span class="n">reference</span><span class="w"> </span><span class="n">copy</span><span class="p">:</span><span class="w"> </span><span class="nc">crates</span><span class="o">/</span><span class="n">wasi</span><span class="o">-</span><span class="n">preview1</span><span class="o">-</span><span class="n">component</span><span class="o">-</span><span class="n">adapter</span><span class="o">/</span><span class="n">provider</span><span class="o">/</span><span class="n">artefacts</span><span class="o">/</span><span class="n">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">wasm</span>
<span class="w">      </span><span class="n">built</span><span class="w"> </span><span class="n">copy</span><span class="p">:</span><span class="w"> </span><span class="nc">target</span><span class="o">/</span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">unknown</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">wasi_snapshot_preview1</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">To</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="err">`</span><span class="n">BLESS</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span>
<span class="n">environment</span>
<span class="o">---</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fd</span><span class="o">/</span><span class="mi">63</span><span class="w">  </span><span class="mi">2024</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">51.726335825</span><span class="w"> </span><span class="o">+</span><span class="mi">0000</span>
<span class="o">+++</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fd</span><span class="o">/</span><span class="mi">62</span><span class="w">  </span><span class="mi">2024</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">14</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mf">51.726335825</span><span class="w"> </span><span class="o">+</span><span class="mi">0000</span>
<span class="o">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="w"> </span><span class="o">@@</span>
<span class="o">-</span><span class="p">(</span><span class="n">module</span><span class="w"> </span><span class="cp">$wasi_preview1_component_adapter</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">adapter</span><span class="p">:</span>
<span class="o">+</span><span class="p">(</span><span class="n">module</span><span class="w"> </span><span class="cp">$wasi_preview1_component_adapter</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">adapter</span><span class="p">:</span><span class="mi">9</span><span class="n">a152d0ad902adeb995c2ab83556f62119151301</span>
<span class="w">   </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">0</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
<span class="w">   </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">1</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">param</span><span class="w"> </span><span class="kt">i32</span><span class="p">)))</span>
<span class="w">   </span><span class="p">(</span><span class="k">type</span><span class="w"> </span><span class="p">(;</span><span class="mi">2</span><span class="p">;)</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="kt">i64</span><span class="p">)))</span>
</code></pre></div>
<p>CI only sets the <code>VERSION</code> environment variable to the current git commit. That I think will no longer be viable with this approach so we'll need to remove that from CI and the script here.</p>
</blockquote>



<a name="444769696"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444769696" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444769696">(Jun 14 2024 at 19:04)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168600072">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<blockquote>
<p>Ok now I think it's more clear what's happening:</p>
<p><code>
Reference copy of adapter is not the same as the generated copy of
the adapter
  reference copy: crates/wasi-preview1-component-adapter/provider/artefacts/wasi_snapshot_preview1.command.wasm
      built copy: target/wasm32-unknown-unknown/release/wasi_snapshot_preview1.command.wasm
To automatically update the reference copy set `BLESS=1` in the
environment
--- /dev/fd/63    2024-06-14 18:50:51.726335825 +0000
+++ /dev/fd/62    2024-06-14 18:50:51.726335825 +0000
@@ -1,4 +1,4 @@
-(module $wasi_preview1_component_adapter.command.adapter:
+(module $wasi_preview1_component_adapter.command.adapter:9a152d0ad902adeb995c2ab83556f62119151301
   (type (;0;) (func))
   (type (;1;) (func (param i32)))
   (type (;2;) (func (result i64)))
</code></p>
<p>CI only sets the <code>VERSION</code> environment variable to the current git commit. That I think will no longer be viable with this approach so we'll need to remove that from CI and the script here.</p>
</blockquote>
<p>Oooh, that makes sense! I never set the version variable locally and of course we can only know it once a commit is made.</p>
<p>I do like the idea that the version points to the last commit when the adapter was changed. Could git be used to check the file tree, excluding the artefacts folder, for the latest commit hash, and then use that?</p>
</blockquote>



<a name="444769840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444769840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444769840">(Jun 14 2024 at 19:06)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2168601524">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>Yeah I think that'd also be reasonable to do!</p>
</blockquote>



<a name="444841893"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444841893" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444841893">(Jun 15 2024 at 08:25)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444842542"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444842542" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444842542">(Jun 15 2024 at 08:35)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444842981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444842981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444842981">(Jun 15 2024 at 08:43)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444845071"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444845071" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444845071">(Jun 15 2024 at 09:12)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444847826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444847826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444847826">(Jun 15 2024 at 09:52)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="444847941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444847941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444847941">(Jun 15 2024 at 09:54)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2169253957">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<blockquote>
<p>Yeah I think that'd also be reasonable to do!</p>
</blockquote>
<p>I tried, I tried. It unfortunately doesn't work out as any commit that would change the adapter would need to refer to itself to provide the updated artefacts (especially since in CI we run on merge-into-main commits which don't exist yet). So I've reverted to the most basic solution of just using the crate version :/</p>
</blockquote>



<a name="444869182"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/444869182" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#444869182">(Jun 15 2024 at 14:41)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2169815264">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>If we do want more info in the version, it could also include a hash of the source files (but this would only help to distinguish git versions, though without relation to their commit hash, not published versions)</p>
</blockquote>



<a name="445025233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445025233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445025233">(Jun 16 2024 at 22:05)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2121611779">PR review</a>:</p>
<blockquote>
<p>I think it's reasonable to remove the hash yeah. One difficulty of using the crate version though is that these binaries would need to be updated whenever we bump the version of the repo which is currently an automated process. It's possible to update that automation, but I think it's probably just easiest to remove the version info entirely for now.</p>
<p>Otherwise can you also move the CI checks for the adapter to their own build job? That way it can pin rustc to a fixed version which isn't updated when we update the rest of CI in the future (done by updating our MSRV right now).</p>
<p>As some minor follow-up work:</p>
<ul>
<li>Can this update <code>scripts/publish.rs</code> as well? I think that'll end up getting caught when full CI runs on merge.</li>
<li>Mind updating <code>crates/test-programs/artifacts/build.rs to depend on this crate with a </code>[build-dependencies]`? That otherwise builds the adapters right now and it shouldn't need to any longer after this.</li>
</ul>
</blockquote>



<a name="445099514"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445099514" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445099514">(Jun 17 2024 at 10:19)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="445099889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445099889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445099889">(Jun 17 2024 at 10:21)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2172984144">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<blockquote>
<p>I think it's reasonable to remove the hash yeah. One difficulty of using the crate version though is that these binaries would need to be updated whenever we bump the version of the repo which is currently an automated process. It's possible to update that automation, but I think it's probably just easiest to remove the version info entirely for now.</p>
</blockquote>
<p>What if the adapter crate got its own explicit version, that could be bumped independently of the other crates? I've prototyped this for now, but I can also revert the change and use the workspace version and not add the version to the metadata.</p>
<blockquote>
<p>Otherwise can you also move the CI checks for the adapter to their own build job? That way it can pin rustc to a fixed version which isn't updated when we update the rest of CI in the future (done by updating our MSRV right now).</p>
</blockquote>
<p>Done - the adapter crate now lists an explicit MSRV which the build script uses.</p>
<blockquote>
<p>As some minor follow-up work:</p>
<div class="codehilite"><pre><span></span><code>* Can this update `scripts/publish.rs` as well? I think that&#39;ll end up getting caught when full CI runs on merge.
</code></pre></div>

</blockquote>
<p>Done!</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>* Mind updating `crates/test-programs/artifacts/build.rs to depend on this crate with a `[build-dependencies]`? That otherwise builds the adapters right now and it shouldn&#39;t need to any longer after this.
</code></pre></div>

</blockquote>
<p>Done!</p>
</blockquote>



<a name="445176484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445176484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445176484">(Jun 17 2024 at 16:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2123368448">PR review</a>.</p>



<a name="445176485"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445176485" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445176485">(Jun 17 2024 at 16:37)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2123368448">PR review</a>.</p>



<a name="445176487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445176487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445176487">(Jun 17 2024 at 16:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1643096507">PR review comment</a>:</p>
<blockquote>
<p>While having an explicit version here improves things my worry is that this will basically never get updated, even when it needs to. Currently all other version management in this repository is automated so I would expect that this would never change as a result.</p>
<p>I can think of two other primary alternatives for continuing to embed version information in the adapter:</p>
<ul>
<li>Update the bump-version script/CI configuration to additionally rebuild the adapters. I find this not super appealing though because it adds binary file churn to this repository which feels unfortunate.</li>
<li>Add a <code>build.rs</code> to the provider crate which injects version information. To be maximally useful this would probably want to have zero build-dependencies which makes it a bit difficult to do, though.</li>
</ul>
<p>Overall I'd probably still be most in favor of just dropping the version information in the binary. AFAIK we haven't really ended up using it all that much in practice.</p>
</blockquote>



<a name="445176488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445176488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445176488">(Jun 17 2024 at 16:37)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1643092440">PR review comment</a>:</p>
<blockquote>
<p>Could this be deferred to CI configuration rather than built-in to this script? It might make sense to double-check that the rustc version activated matches the <code>rust-version</code> on the crate itself but otherwise installation of the toolchain can get unwieldy to work with when running this script locally.</p>
</blockquote>



<a name="445274055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274055">(Jun 18 2024 at 05:22)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="445274617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274617">(Jun 18 2024 at 05:29)</a>:</h4>
<p>juntyr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<a name="445274929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274929">(Jun 18 2024 at 05:32)</a>:</h4>
<p>juntyr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2124505071">PR review</a>.</p>



<a name="445274930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274930">(Jun 18 2024 at 05:32)</a>:</h4>
<p>juntyr created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1643822103">PR review comment</a>:</p>
<blockquote>
<p>Ok, let's just remove the version info (for now) then</p>
</blockquote>



<a name="445274936"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274936" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274936">(Jun 18 2024 at 05:33)</a>:</h4>
<p>juntyr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2124505195">PR review</a>.</p>



<a name="445274938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445274938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445274938">(Jun 18 2024 at 05:33)</a>:</h4>
<p>juntyr created <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#discussion_r1643822267">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="445275064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445275064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445275064">(Jun 18 2024 at 05:34)</a>:</h4>
<p>juntyr <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#issuecomment-2175049178">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>:</p>
<blockquote>
<p>@alexcrichton I hope this is now good to go - thank you for all of your rounds of feedback!</p>
</blockquote>



<a name="445392896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445392896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445392896">(Jun 18 2024 at 15:38)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8792#pullrequestreview-2125868945">PR review</a>:</p>
<blockquote>
<p>Thank you as well for pushing on this!</p>
</blockquote>



<a name="445397832"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238792%20wasi-adapter%3A%20Implement%20provider%20crat.../near/445397832" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238792.20wasi-adapter.3A.20Implement.20provider.20crat.2E.2E.2E.html#445397832">(Jun 18 2024 at 15:54)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8792">PR #8792</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>