<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2888 x64: add x64 encoding benchmarks · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html">wasmtime / PR #2888 x64: add x64 encoding benchmarks</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="238187774"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238187774" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238187774">(May 10 2021 at 18:14)</a>:</h4>
<p>abrown opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2888">PR #2888</a> from <code>inst-format-4</code> to <code>main</code>:</p>
<blockquote>
<p>This is a follow-up to #2819 to add a benchmark comparing the different encoding approaches (builder vs function) used to encode EVEX instructions. The measurements I observed indicate that the builder pattern is faster, as noted in #2819. The more interesting improvement of this PR is to show how to measure parts of the <code>cranelift-codegen</code> crate. To do so with <code>criterion</code>, I had to make some of the x64 module public:</p>
<ul>
<li>the first commit moves the <code>encoding</code> module out of <code>x64::inst</code> so that <code>x64::inst</code> does not have to become public</li>
<li>the second makes the <code>x64</code> module itself public</li>
<li>the third adds the benchmark.</li>
</ul>
</blockquote>



<a name="238187934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238187934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238187934">(May 10 2021 at 18:15)</a>:</h4>
<p><strong>abrown</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2888">PR #2888</a>.</p>



<a name="238188229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238188229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238188229">(May 10 2021 at 18:17)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#pullrequestreview-655938334">PR Review</a>.</p>



<a name="238188230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238188230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238188230">(May 10 2021 at 18:17)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#discussion_r629574067">PR Review Comment</a>:</p>
<blockquote>
<p>I think this entire benchmark should be feature-gated (i.e., <code>#[cfg(feature = "x86")]</code>) but I don't know the best way to do this?</p>
</blockquote>



<a name="238349694"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238349694" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238349694">(May 11 2021 at 17:19)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2888">PR #2888</a> from <code>inst-format-4</code> to <code>main</code>.</p>



<a name="238503984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238503984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238503984">(May 12 2021 at 16:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#pullrequestreview-658119297">PR review</a>.</p>



<a name="238503987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238503987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238503987">(May 12 2021 at 16:28)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#discussion_r631206358">PR review comment</a>:</p>
<blockquote>
<p>You could put the whole implementation inside an inner <code>mod { ... }</code> with the #[cfg(...)]<code>, export one main function, and have an alternate (empty) main function with </code>[cfg(not(feature = "x86"))]` probably?</p>
</blockquote>



<a name="238503988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238503988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238503988">(May 12 2021 at 16:28)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#pullrequestreview-658119297">PR review</a>.</p>



<a name="238648174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238648174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238648174">(May 13 2021 at 16:52)</a>:</h4>
<p>abrown updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2888">PR #2888</a> from <code>inst-format-4</code> to <code>main</code>.</p>



<a name="238648976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238648976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238648976">(May 13 2021 at 16:58)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#pullrequestreview-659107964">PR review</a>.</p>



<a name="238648977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238648977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238648977">(May 13 2021 at 16:58)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#discussion_r631959733">PR review comment</a>:</p>
<blockquote>
<p>Ok, I finally figured out how to do this. My latest update uses the inner module approach feature-gated on <code>x86</code> and prints a "can't run this benchmark" message if the feature is not present.</p>
</blockquote>



<a name="238649489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238649489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238649489">(May 13 2021 at 17:02)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2888#pullrequestreview-659110773">PR review</a>.</p>



<a name="238655185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232888%20x64%3A%20add%20x64%20encoding%20benchmarks/near/238655185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232888.20x64.3A.20add.20x64.20encoding.20benchmarks.html#238655185">(May 13 2021 at 17:46)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2888">PR #2888</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>