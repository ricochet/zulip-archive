<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3100 Cranelift: x64 backend crashes com... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html">wasmtime / issue #3100 Cranelift: x64 backend crashes com...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="246580466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233100%20Cranelift%3A%20x64%20backend%20crashes%20com.../near/246580466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html#246580466">(Jul 20 2021 at 13:02)</a>:</h4>
<p>afonso360 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3100">issue #3100</a>:</p>
<blockquote>
<p>Hey, While working on implementing <code>br_table</code>'s for the interpreter i found the following test case that crashes on the x64 backend. This test case passes on s390x and aarch64, and on x64 it only fails for the i64 data type, it passes on i32, i16 and i8's.</p>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">br_table</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">block4</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block1</span>:
  <span class="nc">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span>:
  <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block3</span>:
  <span class="nc">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span>:
  <span class="nc">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v5</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">v6</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>This test case to pass.</p>
<h3>Actual Results</h3>
<p>This crashes with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span>#<span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">invalid</span><span class="w"> </span><span class="n">extension</span>: <span class="mi">64</span><span class="w"> </span>-&gt; <span class="mi">32</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span>:<span class="mi">38</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">option</span>::<span class="n">expect_failed</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1243</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="o">&gt;</span>::<span class="n">expect</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">351</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">extend_input_to_reg</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">lower_branch_group</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6843</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower_clif_branches</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">880</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">955</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">30</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">compile_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">62</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">197</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">286</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">SingleFunctionCompiler</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">cranelift_filetests</span>::<span class="n">test_run</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">test_run</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run_one_test</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">188</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">132</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">401</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_catch</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="n">tuple</span><span class="o">&lt;&gt;&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">365</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="nc">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">434</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="246580467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233100%20Cranelift%3A%20x64%20backend%20crashes%20com.../near/246580467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html#246580467">(Jul 20 2021 at 13:02)</a>:</h4>
<p>afonso360 opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3100">issue #3100</a>:</p>
<blockquote>
<p>Hey, While working on implementing <code>br_table</code>'s for the interpreter i found the following test case that crashes on the x64 backend. This test case passes on s390x and aarch64, and on x64 it only fails for the i64 data type, it passes on i32, i16 and i8's.</p>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">br_table</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">block4</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block1</span>:
  <span class="nc">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span>:
  <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block3</span>:
  <span class="nc">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span>:
  <span class="nc">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v5</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">v6</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>This test case to pass.</p>
<h3>Actual Results</h3>
<p>This crashes with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span>#<span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">invalid</span><span class="w"> </span><span class="n">extension</span>: <span class="mi">64</span><span class="w"> </span>-&gt; <span class="mi">32</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span>:<span class="mi">38</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">option</span>::<span class="n">expect_failed</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1243</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="o">&gt;</span>::<span class="n">expect</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">351</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">extend_input_to_reg</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">lower_branch_group</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6843</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower_clif_branches</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">880</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">955</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">30</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">compile_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">62</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">197</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">286</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">SingleFunctionCompiler</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">cranelift_filetests</span>::<span class="n">test_run</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">test_run</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run_one_test</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">188</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">132</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">401</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_catch</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="n">tuple</span><span class="o">&lt;&gt;&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">365</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="nc">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">434</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="246580468"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233100%20Cranelift%3A%20x64%20backend%20crashes%20com.../near/246580468" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html#246580468">(Jul 20 2021 at 13:02)</a>:</h4>
<p>afonso360 labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3100">issue #3100</a>:</p>
<blockquote>
<p>Hey, While working on implementing <code>br_table</code>'s for the interpreter i found the following test case that crashes on the x64 backend. This test case passes on s390x and aarch64, and on x64 it only fails for the i64 data type, it passes on i32, i16 and i8's.</p>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">br_table</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">block4</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block1</span>:
  <span class="nc">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span>:
  <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block3</span>:
  <span class="nc">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span>:
  <span class="nc">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v5</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">v6</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>This test case to pass.</p>
<h3>Actual Results</h3>
<p>This crashes with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span>#<span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">invalid</span><span class="w"> </span><span class="n">extension</span>: <span class="mi">64</span><span class="w"> </span>-&gt; <span class="mi">32</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span>:<span class="mi">38</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">option</span>::<span class="n">expect_failed</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1243</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="o">&gt;</span>::<span class="n">expect</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">351</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">extend_input_to_reg</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">lower_branch_group</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6843</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower_clif_branches</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">880</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">955</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">30</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">compile_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">62</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">197</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">286</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">SingleFunctionCompiler</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">cranelift_filetests</span>::<span class="n">test_run</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">test_run</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run_one_test</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">188</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">132</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">401</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_catch</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="n">tuple</span><span class="o">&lt;&gt;&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">365</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="nc">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">434</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="246584593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233100%20Cranelift%3A%20x64%20backend%20crashes%20com.../near/246584593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html#246584593">(Jul 20 2021 at 13:36)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3100#issuecomment-883398854">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3100">issue #3100</a>:</p>
<blockquote>
<p>Can you update <a href="https://github.com/bytecodealliance/wasmtime/blob/ebbe3997251add0278cc2de9c18dc43a1895f580/cranelift/frontend/src/switch.rs#L279-L285">https://github.com/bytecodealliance/wasmtime/blob/ebbe3997251add0278cc2de9c18dc43a1895f580/cranelift/frontend/src/switch.rs#L279-L285</a> once it is implemented?</p>
</blockquote>



<a name="251748144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233100%20Cranelift%3A%20x64%20backend%20crashes%20com.../near/251748144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233100.20Cranelift.3A.20x64.20backend.20crashes.20com.2E.2E.2E.html#251748144">(Sep 02 2021 at 16:58)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3100">issue #3100</a>:</p>
<blockquote>
<p>Hey, While working on implementing <code>br_table</code>'s for the interpreter i found the following test case that crashes on the x64 backend. This test case passes on s390x and aarch64, and on x64 it only fails for the i64 data type, it passes on i32, i16 and i8's.</p>
<h3><code>.clif</code> Test Case</h3>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">test</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">target</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="n">machinst</span><span class="w"></span>

<span class="n">function</span><span class="w"> </span><span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i64</span> <span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block1</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">br_table</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">block4</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block1</span>:
  <span class="nc">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"></span>

<span class="n">block2</span>:
  <span class="nc">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block3</span>:
  <span class="nc">v3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span>:
  <span class="nc">v4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iconst</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">  </span><span class="n">jump</span><span class="w"> </span><span class="n">block5</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="w"></span>

<span class="n">block5</span><span class="p">(</span><span class="n">v5</span>: <span class="kt">i64</span><span class="p">)</span>:
  <span class="nc">v6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iadd</span><span class="p">.</span><span class="kt">i64</span><span class="w"> </span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">v5</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">v6</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="p">;</span><span class="w"> </span><span class="n">run</span>: <span class="o">%</span><span class="n">br_table_i64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
</code></pre></div>
<h3>Expected Results</h3>
<p>This test case to pass.</p>
<h3>Actual Results</h3>
<p>This crashes with the following error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">worker</span><span class="w"> </span>#<span class="mi">0</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">invalid</span><span class="w"> </span><span class="n">extension</span>: <span class="mi">64</span><span class="w"> </span>-&gt; <span class="mi">32</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">cranelift</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span>:<span class="mi">38</span><span class="w"></span>
<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span>:
   <span class="mi">0</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">515</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span>: <span class="nc">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">92</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span>: <span class="nc">core</span>::<span class="n">option</span>::<span class="n">expect_failed</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="o">/</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1243</span><span class="w"></span>
<span class="w">   </span><span class="mi">3</span>: <span class="nc">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">option</span>::<span class="nb">Option</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="o">&gt;</span>::<span class="n">expect</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">args</span>::<span class="n">ExtMode</span><span class="o">&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">core</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">option</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">351</span><span class="w"></span>
<span class="w">   </span><span class="mi">4</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="n">extend_input_to_reg</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">233</span><span class="w"></span>
<span class="w">   </span><span class="mi">5</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">lower</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">lower_branch_group</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">6843</span><span class="w"></span>
<span class="w">   </span><span class="mi">6</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower_clif_branches</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">880</span><span class="w"></span>
<span class="w">   </span><span class="mi">7</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">lower</span>::<span class="n">Lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;&gt;</span>::<span class="n">lower</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">inst</span>::<span class="n">Inst</span><span class="o">&gt;</span><span class="p">,</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">lower</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">955</span><span class="w"></span>
<span class="w">   </span><span class="mi">8</span>: <span class="nc">cranelift_codegen</span>::<span class="n">machinst</span>::<span class="n">compile</span>::<span class="n">compile</span><span class="o">&lt;</span><span class="n">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">machinst</span><span class="err">\</span><span class="n">compile</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">30</span><span class="w"></span>
<span class="w">   </span><span class="mi">9</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="n">X64Backend</span>::<span class="n">compile_vcode</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span><span class="w"></span>
<span class="w">  </span><span class="mi">10</span>: <span class="nc">cranelift_codegen</span>::<span class="n">isa</span>::<span class="n">x64</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">compile_function</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">isa</span><span class="err">\</span><span class="n">x64</span><span class="err">\</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">62</span><span class="w"></span>
<span class="w">  </span><span class="mi">11</span>: <span class="nc">cranelift_codegen</span>::<span class="n">context</span>::<span class="n">Context</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">codegen</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">context</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">197</span><span class="w"></span>
<span class="w">  </span><span class="mi">12</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">286</span><span class="w"></span>
<span class="w">  </span><span class="mi">13</span>: <span class="nc">cranelift_filetests</span>::<span class="n">function_runner</span>::<span class="n">SingleFunctionCompiler</span>::<span class="n">compile</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">function_runner</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">77</span><span class="w"></span>
<span class="w">  </span><span class="mi">14</span>: <span class="nc">cranelift_filetests</span>::<span class="n">test_run</span>::<span class="p">{{</span><span class="k">impl</span><span class="p">}}</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">test_run</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">61</span><span class="w"></span>
<span class="w">  </span><span class="mi">15</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run_one_test</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">188</span><span class="w"></span>
<span class="w">  </span><span class="mi">16</span>: <span class="nc">cranelift_filetests</span>::<span class="n">runone</span>::<span class="n">run</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">runone</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">132</span><span class="w"></span>
<span class="w">  </span><span class="mi">17</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="w">  </span><span class="mi">18</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">401</span><span class="w"></span>
<span class="w">  </span><span class="mi">19</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_catch</span><span class="o">&lt;</span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">AssertUnwindSafe</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="n">tuple</span><span class="o">&lt;&gt;&gt;</span><span class="w"></span>
<span class="w">  </span><span class="mi">20</span>: <span class="nc">std</span>::<span class="n">panicking</span>::<span class="kr">try</span><span class="o">&lt;</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">365</span><span class="w"></span>
<span class="w">  </span><span class="mi">21</span>: <span class="nc">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span><span class="o">&lt;</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="k">enum</span><span class="cp">$</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="n">core</span>::<span class="n">time</span>::<span class="n">Duration</span><span class="p">,</span><span class="w"> </span><span class="n">anyhow</span>::<span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mi">7</span><span class="n">c3872e6bfd555d2ad753ac1f871db3bd7f2a547</span><span class="err">\</span><span class="n">library</span><span class="err">\</span><span class="n">std</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">434</span><span class="w"></span>
<span class="w">  </span><span class="mi">22</span>: <span class="nc">cranelift_filetests</span>::<span class="n">concurrent</span>::<span class="n">worker_thread</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="w"></span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="err">\</span><span class="n">filetests</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">concurrent</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">150</span><span class="w"></span>
<span class="n">note</span>: <span class="nb">Some</span> <span class="nc">details</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">omitted</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="n">full</span><span class="err">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>