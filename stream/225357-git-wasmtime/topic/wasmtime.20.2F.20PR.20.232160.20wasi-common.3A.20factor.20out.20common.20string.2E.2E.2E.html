<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2160 wasi-common: factor out common string... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html">wasmtime / PR #2160 wasi-common: factor out common string...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="207910512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/207910512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#207910512">(Aug 24 2020 at 23:47)</a>:</h4>
<p>pchickey opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207910519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/207910519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#207910519">(Aug 24 2020 at 23:47)</a>:</h4>
<p><strong>pchickey</strong> requested <a href="https://github.com/iximeow">iximeow</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a>.</p>



<a name="207910547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/207910547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#207910547">(Aug 24 2020 at 23:48)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207910638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/207910638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#207910638">(Aug 24 2020 at 23:49)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="207911879"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/207911879" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#207911879">(Aug 25 2020 at 00:07)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208032840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208032840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208032840">(Aug 25 2020 at 22:36)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208747200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208747200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208747200">(Sep 01 2020 at 20:56)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208747711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208747711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208747711">(Sep 01 2020 at 21:00)</a>:</h4>
<p><strong>pchickey</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> as ready for review.</p>



<a name="208767723"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208767723" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208767723">(Sep 02 2020 at 00:53)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208862644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208862644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208862644">(Sep 02 2020 at 17:55)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208877922"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208877922" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208877922">(Sep 02 2020 at 19:48)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>Based on top of #2140 and #2139 <br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208880421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208880421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208880421">(Sep 02 2020 at 20:09)</a>:</h4>
<p>pchickey edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208880994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208880994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208880994">(Sep 02 2020 at 20:13)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208881590"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881590" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881590">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481266358">PR Review</a>.</p>



<a name="208881591"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881591" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881591">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482402059">PR Review Comment</a>:</p>
<blockquote>
<p>Should this be <code>index</code> times the gues size of <code>T</code>?</p>
</blockquote>



<a name="208881592"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881592" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881592">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481266358">PR Review</a>.</p>



<a name="208881593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881593">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482402334">PR Review Comment</a>:</p>
<blockquote>
<p>Same question as above with <code>get</code></p>
</blockquote>



<a name="208881594"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881594" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881594">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482403005">PR Review Comment</a>:</p>
<blockquote>
<p>I think this may also want to include the condition that <code>r.start &lt;= r.end</code>?</p>
</blockquote>



<a name="208881595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881595">(Sep 02 2020 at 20:18)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482405099">PR Review Comment</a>:</p>
<blockquote>
<p>How come this is a trait? Could this perhaps be a free-function in a utils-like module of some kind?</p>
</blockquote>



<a name="208881624"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208881624" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208881624">(Sep 02 2020 at 20:18)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208883155"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208883155" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208883155">(Sep 02 2020 at 20:30)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481276181">PR Review</a>.</p>



<a name="208883156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208883156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208883156">(Sep 02 2020 at 20:30)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482421742">PR Review Comment</a>:</p>
<blockquote>
<p>My thought was we would eventually support different representations than <code>Vec&lt;CString&gt;</code> here as part of modularization. It seemed like a reasonable way to hang three methods onto some existing struct members. But maybe instead of <code>WasiCtx { args: Vec&lt;CString&gt;, env: Vec&lt;CString&gt; }</code> we could make this <code>struct StringArray(Vec&lt;String&gt;)</code> that just has these three pub methods?</p>
</blockquote>



<a name="208883277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208883277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208883277">(Sep 02 2020 at 20:31)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481276854">PR Review</a>.</p>



<a name="208883278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208883278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208883278">(Sep 02 2020 at 20:31)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482423096">PR Review Comment</a>:</p>
<blockquote>
<p>I was under the mistaken impression that this was guaranteed by Range construction, I'll correct that</p>
</blockquote>



<a name="208884352"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208884352" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208884352">(Sep 02 2020 at 20:39)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481281739">PR Review</a>.</p>



<a name="208884353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208884353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208884353">(Sep 02 2020 at 20:39)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482432875">PR Review Comment</a>:</p>
<blockquote>
<p>len() is in <code>units</code> (correcting this to <code>elements</code> in the doc strings, not bytes, so I dont think we need to multiply by the size.</p>
</blockquote>



<a name="208884420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208884420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208884420">(Sep 02 2020 at 20:39)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208888614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208888614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208888614">(Sep 02 2020 at 21:12)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208905918"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208905918" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208905918">(Sep 03 2020 at 00:17)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="208906945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208906945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208906945">(Sep 03 2020 at 00:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481403654">PR Review</a>.</p>



<a name="208906946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208906946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208906946">(Sep 03 2020 at 00:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-481403654">PR Review</a>.</p>



<a name="208906947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/208906947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#208906947">(Sep 03 2020 at 00:33)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r482617874">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah the length is in units but the <code>GuestPtr</code> returned here I think is offset in bytes from the memory base?</p>
</blockquote>



<a name="209010073"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/209010073" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#209010073">(Sep 03 2020 at 18:27)</a>:</h4>
<p>pchickey submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#pullrequestreview-482099433">PR Review</a>.</p>



<a name="209010074"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/209010074" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#209010074">(Sep 03 2020 at 18:27)</a>:</h4>
<p>pchickey created <a href="https://github.com/bytecodealliance/wasmtime/pull/2160#discussion_r483174171">PR Review Comment</a>:</p>
<blockquote>
<p>Thanks, I completely missed that. Clearly I'm not smart enough to write or maintain this code without tests, and since the only ones i have currently are in wasi-common and use <code>GuestPtr&lt;[u8]&gt;</code>, ill add some others to the wiggle tree that use non-byte-sized elements and make sure its done right.</p>
</blockquote>



<a name="209041641"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/209041641" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#209041641">(Sep 03 2020 at 23:41)</a>:</h4>
<p>pchickey updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a> from <code>pch/wasi_common_array_writer</code> to <code>main</code>:</p>
<blockquote>
<p>The args and environ methods duplicated code, so I factored it into a trait impled on <code>Vec&lt;CString&gt;</code>. It could easily be impled for <code>Vec&lt;String&gt;</code> if we wanted to, but there doesn't seem to be much reason to refactor it further now.</p>
<p>As part of the factoring I added slice accessors <code>get</code> and <code>get_range</code> to <code>wiggle::GuestPtr&lt;[T]&gt;</code>, which seem useful.</p>
<p>My current goal is to make snapshots/wasi_snapshot_preview1.rs as uninteresting as possible. This was one small chunk that could be moved out. We expect this code to work essentially the same across all snapshots, until interface types change the way we write arrays of strings into the guest.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;</p>
</blockquote>



<a name="209046049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232160%20wasi-common%3A%20factor%20out%20common%20string.../near/209046049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232160.20wasi-common.3A.20factor.20out.20common.20string.2E.2E.2E.html#209046049">(Sep 04 2020 at 01:01)</a>:</h4>
<p>pchickey merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2160">PR #2160</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>