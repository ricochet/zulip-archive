<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #2552 Interrupting engine causes illegal... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html">wasmtime / Issue #2552 Interrupting engine causes illegal...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="221789945"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221789945" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221789945">(Jan 06 2021 at 16:44)</a>:</h4>
<p>EliseZeroTwo labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p><strong>Environment</strong>: rustc 1.50.0-nightly (c609b2eaf 2020-12-20), MacOS, AArch64<br>
<strong>Wasmtime Version</strong>: 0.21.0<br>
<strong>Expected Behavior</strong>: Interrupt WASM engine, actually causes <code>zsh: illegal hardware instruction  cargo run</code><br>
<strong>To Reproduce</strong>: Attempt to run the <a href="https://docs.rs/wasmtime/0.21.0/wasmtime/struct.Store.html#examples">Store/interrupt_handle example</a></p>
<p>If there is any more info needed/testing I am here<br>
</p>
</blockquote>



<a name="221789946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221789946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221789946">(Jan 06 2021 at 16:44)</a>:</h4>
<p>EliseZeroTwo opened <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p><strong>Environment</strong>: rustc 1.50.0-nightly (c609b2eaf 2020-12-20), MacOS, AArch64<br>
<strong>Wasmtime Version</strong>: 0.21.0<br>
<strong>Expected Behavior</strong>: Interrupt WASM engine, actually causes <code>zsh: illegal hardware instruction  cargo run</code><br>
<strong>To Reproduce</strong>: Attempt to run the <a href="https://docs.rs/wasmtime/0.21.0/wasmtime/struct.Store.html#examples">Store/interrupt_handle example</a></p>
<p>If there is any more info needed/testing I am here<br>
</p>
</blockquote>



<a name="221790520"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221790520" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221790520">(Jan 06 2021 at 16:48)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755420284">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>Can you get a backtrace using lldb?</p>
</blockquote>



<a name="221790899"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221790899" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221790899">(Jan 06 2021 at 16:51)</a>:</h4>
<p>EliseZeroTwo <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755422511">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>Sure, this is what you wanted right?</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">elise</span><span class="o">@</span><span class="n">Elises</span><span class="o">-</span><span class="n">MacBook</span><span class="o">-</span><span class="n">Air</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="s">"target/debug/wasmtime-test"</span><span class="w"></span>
<span class="n">Current</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">elise</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">).</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">run</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">93711</span><span class="w"> </span><span class="n">launched</span>: <span class="o">'/</span><span class="n">Users</span><span class="o">/</span><span class="n">elise</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="o">'</span><span class="w"> </span><span class="p">(</span><span class="n">arm64</span><span class="p">)</span><span class="w"></span>
<span class="n">Process</span><span class="w"> </span><span class="mi">93711</span><span class="w"> </span><span class="n">stopped</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">'</span><span class="na">com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXC_BAD_INSTRUCTION</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">subcode</span><span class="o">=</span><span class="mh">0xd4a00000</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x0000000102af001c</span><span class="w"></span>
-&gt;  <span class="mh">0x102af001c</span>: <span class="p">.</span><span class="n">long</span><span class="w">  </span><span class="mh">0xd4a00000</span><span class="w">                </span><span class="p">;</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">opcode</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x102af0020</span>: <span class="nc">stp</span><span class="w">    </span><span class="n">x29</span><span class="p">,</span><span class="w"> </span><span class="n">x30</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="o">-</span><span class="mh">0x10</span><span class="p">]</span><span class="o">!</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x102af0024</span>: <span class="nc">mov</span><span class="w">    </span><span class="n">x29</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="w"></span>
<span class="w">    </span><span class="mh">0x102af0028</span>: <span class="nc">blr</span><span class="w">    </span><span class="n">x2</span><span class="w"></span>
<span class="n">Target</span><span class="w"> </span><span class="mi">0</span>: <span class="p">(</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="n">stopped</span><span class="p">.</span><span class="w"></span>
<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">bt</span><span class="w"></span>
<span class="n">error</span>: <span class="nc">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">DW_TAG_base_type</span><span class="w"> </span><span class="o">'</span><span class="p">()</span><span class="o">'</span><span class="w"> </span><span class="n">encoded</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">DW_ATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7</span><span class="p">,</span><span class="w"> </span><span class="n">bit_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="o">*</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">'</span><span class="na">com</span><span class="p">.</span><span class="n">apple</span><span class="p">.</span><span class="n">main</span><span class="o">-</span><span class="n">thread</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXC_BAD_INSTRUCTION</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">subcode</span><span class="o">=</span><span class="mh">0xd4a00000</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">0</span>: <span class="mh">0x0000000102af001c</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">1</span>: <span class="mh">0x0000000100052504</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">get0</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hdf065a651b23e6eb</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">219</span>:<span class="mi">36</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">2</span>: <span class="mh">0x000000010007bdc8</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span>::<span class="n">h34799d017a830c62</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="s">"\x88��o"</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">397</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">3</span>: <span class="mh">0x0000000100662110</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">RegisterSetjmp</span><span class="p">(</span><span class="n">buf_storage</span><span class="o">=</span><span class="mh">0x000000016fdfef68</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="p">(</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">call_closure</span>::<span class="n">h34799d017a830c62</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">393</span><span class="p">),</span><span class="w"> </span><span class="n">payload</span><span class="o">=</span><span class="mh">0x000000016fdff0e0</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">helpers</span><span class="p">.</span><span class="n">c</span>:<span class="mi">12</span>:<span class="mi">3</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">4</span>: <span class="mh">0x000000010007c148</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h4cbc1bf5cfaf39f6</span><span class="p">(</span><span class="n">cx</span><span class="o">=</span><span class="mh">0x000000016fdfef30</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">386</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">5</span>: <span class="mh">0x000000010007dc5c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h43344f8625fc9eb5</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">38</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">6</span>: <span class="mh">0x000000010005e42c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h32dc2e0d54271bc4</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mh">0x00000001038082a0</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">678</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">7</span>: <span class="mh">0x00000001000b24dc</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="cp">$LT$T$GT$</span>::<span class="n">try_with</span>::<span class="n">h22f85c7b627282cd</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="mh">0x00000001010f9110</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfe620</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">272</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">8</span>: <span class="mh">0x00000001000b2318</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">thread</span>::<span class="n">local</span>::<span class="n">LocalKey</span><span class="cp">$LT$T$GT$</span>::<span class="n">with</span>::<span class="n">h0fa96015bd54d6c9</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="mh">0x00000001010f9110</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">=&lt;</span><span class="n">unavailable</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">local</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">248</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">9</span>: <span class="mh">0x000000010005e2fc</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">tls</span>::<span class="n">set</span>::<span class="n">h4b883c3c99a44464</span><span class="p">(</span><span class="n">ptr</span><span class="o">=</span><span class="mh">0x000000016fdfef30</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfe680</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">670</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">10</span>: <span class="mh">0x000000010007c278</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">CallThreadState</span>::<span class="n">with</span>::<span class="n">h1b3c574b3e474783</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="n">CallThreadState</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfef30</span><span class="p">,</span><span class="w"> </span><span class="n">max_wasm_stack</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfed10</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">442</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">11</span>: <span class="mh">0x000000010007c08c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="n">hf821c618b37cd358</span><span class="p">(</span><span class="n">vmctx</span><span class="o">=</span><span class="mh">0x0000000102c08d20</span><span class="p">,</span><span class="w"> </span><span class="n">max_wasm_stack</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span><span class="w"> </span><span class="n">is_wasm_code</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfee38</span><span class="p">,</span><span class="w"> </span><span class="n">signal_handler</span><span class="o">=</span><span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="nb">Fn</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">libc</span>::<span class="n">unix</span>::<span class="n">bsd</span>::<span class="n">apple</span>::<span class="n">siginfo_t</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">core</span>::<span class="n">ffi</span>::<span class="n">c_void</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdfefb8</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdff0e0</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">385</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">12</span>: <span class="mh">0x0000000100051a08</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">invoke_wasm_and_catch_traps</span>::<span class="n">h748a5c3d509c585d</span><span class="p">(</span><span class="n">vmctx</span><span class="o">=</span><span class="mh">0x0000000102c08d20</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="o">=</span><span class="mh">0x000000016fdff498</span><span class="p">,</span><span class="w"> </span><span class="n">closure</span><span class="o">=</span><span class="n">closure</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mh">0x000000016fdff1b0</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">829</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">13</span>: <span class="mh">0x00000001000525c0</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime</span>::<span class="n">func</span>::<span class="n">Func</span>::<span class="n">get0</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">hb5574d4b37bd571e</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">func</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">218</span>:<span class="mi">21</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">14</span>: <span class="mh">0x0000000100003f3c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_test</span>::<span class="n">main</span>::<span class="n">haebedb672b1ad106</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">23</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">15</span>: <span class="mh">0x0000000100001bc0</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="nb">FnOnce</span>::<span class="n">call_once</span>::<span class="n">h2185be2c6c66daf8</span><span class="p">((</span><span class="n">null</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_test</span>::<span class="n">main</span>::<span class="n">haebedb672b1ad106</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="o">=&lt;</span><span class="n">unavailable</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">227</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">16</span>: <span class="mh">0x00000001000024ac</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_begin_short_backtrace</span>::<span class="n">h015d35dd00b7b79a</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="p">(</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_test</span>::<span class="n">main</span>::<span class="n">haebedb672b1ad106</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">125</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">17</span>: <span class="mh">0x0000000100003a7c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">_</span><span class="cp">$u7b$$u7b$closure$u7d$$u7d$</span>::<span class="n">h272b1220ab4da625</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">66</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">18</span>: <span class="mh">0x0000000100d42dd4</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h17327e074e29c857</span><span class="w"> </span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span><span class="w"> </span><span class="n">core</span>::<span class="n">ops</span>::<span class="n">function</span>::<span class="n">impls</span>::<span class="n">_</span><span class="cp">$LT$impl$u20$core</span><span class="o">..</span><span class="n">ops</span><span class="o">..</span><span class="n">function</span><span class="o">..</span><span class="nb">FnOnce</span><span class="cp">$LT$A$GT$$u20$for$u20$$RF$F$GT$</span>::<span class="n">call_once</span>::<span class="n">hba3336600b4e2d51</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">13</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">19</span>: <span class="mh">0x0000000100d42dc8</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h17327e074e29c857</span><span class="w"> </span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">do_call</span>::<span class="n">hb525555825cb795d</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">379</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">20</span>: <span class="mh">0x0000000100d42dc8</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h17327e074e29c857</span><span class="w"> </span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">hd444835db4887372</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">343</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">21</span>: <span class="mh">0x0000000100d42dc8</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h17327e074e29c857</span><span class="w"> </span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">h73a34a4a8bd42478</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">396</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">22</span>: <span class="mh">0x0000000100d42dc8</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start_internal</span>::<span class="n">h17327e074e29c857</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">51</span><span class="w"> </span><span class="p">[</span><span class="n">opt</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">23</span>: <span class="mh">0x0000000100003a54</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">std</span>::<span class="n">rt</span>::<span class="n">lang_start</span>::<span class="n">hfad81a1e4e1ebb69</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="p">(</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">wasmtime_test</span>::<span class="n">main</span>::<span class="n">haebedb672b1ad106</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">argc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="o">=</span><span class="mh">0x000000016fdff728</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">rt</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">65</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">24</span>: <span class="mh">0x000000010000415c</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">-</span><span class="n">test</span><span class="err">`</span><span class="n">main</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">    </span><span class="n">frame</span><span class="w"> </span><span class="err">#</span><span class="mi">25</span>: <span class="mh">0x00000001a472cf34</span><span class="w"> </span><span class="n">libdyld</span><span class="p">.</span><span class="n">dylib</span><span class="err">`</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="221793069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221793069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221793069">(Jan 06 2021 at 17:07)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755431994">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>Thanks. While I am not familiar with this part of the code, this backtrace will likely be useful for someone who is familiar with it.</p>
</blockquote>



<a name="221795157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221795157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221795157">(Jan 06 2021 at 17:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755440235">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>Thanks for the report @EliseZeroTwo!</p>
<p><code>0xd4a00000</code> is our specially-chosen undefined instruction, borrowed <a href="https://searchfox.org/mozilla-central/rev/ef900cd2258d4c5d968093f612f807d96e6e7c98/js/src/jit/arm64/vixl/Constants-vixl.h#2668-2690">from SpiderMonkey</a> (there is some good discussion in that comment on how to reliably get a SIGILL on arm64). It is how we emit traps (<code>Inst::Udf</code> <a href="https://github.com/bytecodealliance/wasmtime/blob/6317290a1d75c68a8930ae86e3f1a45ba1db4a97/cranelift/codegen/src/isa/aarch64/inst/emit.rs#L2166">here</a>).</p>
<p>What seems to be happening is that the SIGILL isn't being caught in this case; so there's something wrong with the signal handling in the case that SIGINT (or whatever Ctrl-C becomes in this case) is being processed.</p>
<p>I recall something recently about the interaction between Mach message ports (on macOS) and POSIX signals, and how there might be an issue there... does anyone else know more? Sadly I don't have an arm64 Mac to test with...</p>
</blockquote>



<a name="221796404"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221796404" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221796404">(Jan 06 2021 at 17:31)</a>:</h4>
<p>sunfishcode <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755445631">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>The recent discussion of Mach message ports on macOS is in <a href="https://github.com/bytecodealliance/wasmtime/issues/2456">https://github.com/bytecodealliance/wasmtime/issues/2456</a>.</p>
</blockquote>



<a name="221798537"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/221798537" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#221798537">(Jan 06 2021 at 17:47)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-755454685">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>AFAIK we haven't done testing yet on arm64 macOS machines, so this is likely a bug with integration with the new system. This looks like the signal either isn't being caught (e.g. mach messages and such), or it's correctly caught but wasmtime is incorrectly concluding that the signal isn't related to wasm code. In the latter case the signal will look like a normal uncaught signal.</p>
<p>This'd probably need someone with arm64 hardware to debug a bit to figure out what's going on here. Unfortunately I don't myself have such hardware :( </p>
</blockquote>



<a name="222346786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222346786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222346786">(Jan 11 2021 at 19:39)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758177462">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>This is a bit tangential to the issue, but unless I am missing some context, we should be able to switch to the <code>UDF</code> "instruction".</p>
</blockquote>



<a name="222347526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222347526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222347526">(Jan 11 2021 at 19:44)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758180349">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>As far as I know <code>.long 0xd4a00000</code> is a variant of the UDF instruction with <code>0xa0d4</code> as payload. <a href="https://reviews.llvm.org/D53319">https://reviews.llvm.org/D53319</a></p>
</blockquote>



<a name="222351375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222351375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222351375">(Jan 11 2021 at 20:11)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758195005">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>No, <code>UDF</code> is encoded as 0xFFFF or less; in particular, 0 corresponds to <code>UDF #0</code>.</p>
</blockquote>



<a name="222352725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222352725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222352725">(Jan 11 2021 at 20:22)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758200661">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>It looks like @bnjbvr originally wrote the comment in SpiderMonkey above that describes why they chose <code>0xd4a00000</code>. As I recall, we had originally generated proper <code>UDF</code>s but had to switch for some reason while bringing up SpiderMonkey/Cranelift integration. @bnjbvr, do you have any more details? (It's not hugely important but it would be good to document exactly why we can't use <code>UDF</code>, if that's the case.)</p>
</blockquote>



<a name="222415995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222415995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222415995">(Jan 12 2021 at 10:58)</a>:</h4>
<p>bnjbvr <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758578178">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>Yes, a few reasons come to mind. None of them seem particularly inevitable, and they could all be worked around, if we decided to use a new value, but it was simpler to choose this one for a few reasons:</p>
<ul>
<li>this is the same value Spidermonkey uses for triggering SIGILL, with the reasons explained there: <a href="https://searchfox.org/mozilla-central/source/js/src/jit/arm64/vixl/Constants-vixl.h#2668-2690">https://searchfox.org/mozilla-central/source/js/src/jit/arm64/vixl/Constants-vixl.h#2668-2690</a> . If we didn't use the same value as Spidermonkey did use, either Cranelift would need a compiler option to allow selecting which undefined instruction is used (or select it among a list of predefined), or Spidermonkey should refactor its code to support different undefined instruction encodings in their aarch64 backend.</li>
<li>there might be an argument that a native compiler (rustc/llvm) would use the default UDF instruction, and that using a different instruction in cranelift-generated code makes it easier to spot what's the actual issue in a test case. For instance, for the initial issue discussed here in particular, we could directly infer that it was a cranelift-generated undefined encoding not being properly handled by the OS. A sigill with another undefined encoding could have been this problem <em>or</em> another illegal encoding problem (coming from llvm codegen in native code).</li>
</ul>
</blockquote>



<a name="222420652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222420652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222420652">(Jan 12 2021 at 11:53)</a>:</h4>
<p>akirilov-arm <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-758607046">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>The issue with the current encoding is that it is undefined now, but may no longer be in the future. <code>UDF</code> on the other hand is permanently undefined, i.e. it can be viewed as a permanent encoding space reservation.</p>
</blockquote>



<a name="222574138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222574138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222574138">(Jan 13 2021 at 12:50)</a>:</h4>
<p>repi <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-759428161">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>We've been running into the same issue in some our WASM modules with wasmtime on <code>aarch64-apple-darwin</code></p>
<p>![](<a href="https://user-images.githubusercontent.com/1262692/102669186-311bd080-418e-11eb-8dda-46df11a03c0a.png">https://user-images.githubusercontent.com/1262692/102669186-311bd080-418e-11eb-8dda-46df11a03c0a.png</a>)</p>
</blockquote>



<a name="222574517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%232552%20Interrupting%20engine%20causes%20illegal.../near/222574517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.232552.20Interrupting.20engine.20causes.20illegal.2E.2E.2E.html#222574517">(Jan 13 2021 at 12:54)</a>:</h4>
<p>repi edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/2552#issuecomment-759428161">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/2552">Issue #2552</a>:</p>
<blockquote>
<p>We've been running into the same issue in some our WASM modules with wasmtime on <code>aarch64-apple-darwin</code> as well as on <code>aarch64-linux-android</code></p>
<p>![](<a href="https://user-images.githubusercontent.com/1262692/102669186-311bd080-418e-11eb-8dda-46df11a03c0a.png">https://user-images.githubusercontent.com/1262692/102669186-311bd080-418e-11eb-8dda-46df11a03c0a.png</a>)</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>