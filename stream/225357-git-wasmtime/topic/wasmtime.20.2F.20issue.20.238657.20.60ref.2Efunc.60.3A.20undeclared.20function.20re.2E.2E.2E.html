<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8657 `ref.func`: undeclared function re... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html">wasmtime / issue #8657 `ref.func`: undeclared function re...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="439574628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238657%20%60ref.func%60%3A%20undeclared%20function%20re.../near/439574628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html#439574628">(May 20 2024 at 13:31)</a>:</h4>
<p><a href="https://github.com/oovm">oovm</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8657">Issue #8657</a>.</p>



<a name="439574632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238657%20%60ref.func%60%3A%20undeclared%20function%20re.../near/439574632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html#439574632">(May 20 2024 at 13:31)</a>:</h4>
<p>oovm opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8657">issue #8657</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span> <span class="nv">$App</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$Main</span>
        <span class="p">(</span><span class="k">type</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$hof</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$f</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$i32-i32</span><span class="p">))</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nb">call</span><span class="err">_ref</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">42</span><span class="p">)</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$f</span><span class="p">)))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$inc</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$i</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$caller</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">call</span> <span class="nv">$hof</span> <span class="p">(</span><span class="err">ref.</span><span class="k">func</span> <span class="nv">$inc</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<ul>
<li>This example came from: <a href="https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples">https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<ul>
<li>When commenting <code>$caller</code> function, everything works fine. </li>
<li>Uncommenting it will give an error.</li>
</ul>
<h3>Expected Results</h3>
<p>No error reported</p>
<h3>Actual Results</h3>
<p><div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">Error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WebAssembly translation error</span>

<span class="nt">Caused by</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Invalid input WebAssembly code at offset 67</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">undeclared function reference</span>

<span class="nt">Stack backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="nt">0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::dbghelp::trace</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\dbghelp.rs:131</span>
<span class="w">   </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::trace_unsynchronized</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\mod.rs:66</span>
<span class="w">   </span><span class="nt">2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::create</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:331</span>
<span class="w">   </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::capture</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:296</span>
<span class="w">   </span><span class="nt">4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anyhow::error::impl$1::from&lt;enum2$&lt;wasmtime_environ::compile::CompileError&gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\anyhow-1.0.85\src\error.rs:565</span>
<span class="w">   </span><span class="nt">5</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::result::impl$27::from_residual&lt;wasmtime::compile::CompileOutput,enum2$&lt;wasmtime_environ::compile::CompileError&gt;,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\result.rs:1963</span>
<span class="w">   </span><span class="nt">6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::collect_inputs_in_translations::closure$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::ModuleTranslation&gt;,wasmtime::compile::build_co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:457</span>
<span class="w">   </span><span class="nt">7</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::FnOnce::call_once&lt;wasmtime::compile::impl$4::collect_inputs_in_translations::closure_env$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::Mod</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:250</span>
<span class="w">   </span><span class="nt">8</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::boxed::impl$47::call_once&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutpu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\boxed.rs:2016</span>
<span class="w">   </span><span class="nt">9</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::compile::closure$0</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:537</span>
<span class="w w-Error">  </span><span class="nt">10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::engine::impl$1::run_maybe_parallel::closure$0&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\engine.rs:164</span>
<span class="w">  </span><span class="nt">11</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$1::call_mut&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:272</span>
<span class="w">  </span><span class="nt">12</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$4::call_once&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:305</span>
<span class="w">  </span><span class="nt">13</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enum2$&lt;core::option::Option&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marker::Send&gt;,al</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\option.rs:1072</span>
<span class="w">  </span><span class="nt">14</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">15</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">16</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::take_while::impl$2::next&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\take_while.rs:47</span>
<span class="w">  </span><span class="nt">17</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;wasmtime::compile::CompileOutput,core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">18</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;::extend_desugared&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core:</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2930</span>
<span class="w">  </span><span class="nt">19</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::spec_extend::impl$0::spec_extend&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\spec_extend.rs:17</span>
<span class="w">  </span><span class="nt">20</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::impl$18::extend&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2904</span>
<span class="w">  </span><span class="nt">21</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::extend::impl$2::consume_iter&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dy</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\extend.rs:130</span>
<span class="w">  </span><span class="nt">22</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::while_some::impl$4::consume_iter&lt;wasmtime::compile::CompileOutput,rayon::iter::extend::ListVecFolder&lt;wasmtime::compile::CompileOutput&gt;,core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\while_some.rs:139</span>
<span class="w">  </span><span class="nt">23</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,rayon::iter::while_some::WhileSomeFolder&lt;rayon::iter::extend::ListVecFolde</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">24</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marke</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">25</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::Producer::fold_with&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,an</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:109</span>
<span class="w">  </span><span class="nt">26</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::Com</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:437</span>
<span class="w">  </span><span class="nt">27</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper::closure$1&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::c</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:426</span>
<span class="w">  </span><span class="nt">28</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon_core::join::join_context::call_b::closure$0&lt;alloc::collections::linked_list::LinkedList&lt;alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;,alloc::alloc::Global&gt;,rayon::iter::plumbing::bridge_producer_consumer::helper::closure_env</span>

<span class="p p-Indicator">[</span><span class="nv">message truncated</span><span class="p p-Indicator">]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="439576055"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238657%20%60ref.func%60%3A%20undeclared%20function%20re.../near/439576055" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html#439576055">(May 20 2024 at 13:39)</a>:</h4>
<p>oovm edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8657">issue #8657</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span> <span class="nv">$App</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$Main</span>
        <span class="p">(</span><span class="k">type</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$hof</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$f</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$i32-i32</span><span class="p">))</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nb">call</span><span class="err">_ref</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">42</span><span class="p">)</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$f</span><span class="p">)))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$inc</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$i</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$caller</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">call</span> <span class="nv">$hof</span> <span class="p">(</span><span class="err">ref.</span><span class="k">func</span> <span class="nv">$inc</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<ul>
<li>This example came from: <a href="https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples">https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<ul>
<li>When commenting <code>$caller</code> function, everything works fine. </li>
<li>Uncommenting it will give an error.</li>
</ul>
<h3>Expected Results</h3>
<p>No error reported</p>
<h3>Actual Results</h3>
<p><div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">Error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WebAssembly translation error</span>

<span class="nt">Caused by</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Invalid input WebAssembly code at offset 67</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">undeclared function reference</span>

<span class="nt">Stack backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="nt">0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::dbghelp::trace</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\dbghelp.rs:131</span>
<span class="w">   </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::trace_unsynchronized</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\mod.rs:66</span>
<span class="w">   </span><span class="nt">2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::create</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:331</span>
<span class="w">   </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::capture</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:296</span>
<span class="w">   </span><span class="nt">4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anyhow::error::impl$1::from&lt;enum2$&lt;wasmtime_environ::compile::CompileError&gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\anyhow-1.0.85\src\error.rs:565</span>
<span class="w">   </span><span class="nt">5</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::result::impl$27::from_residual&lt;wasmtime::compile::CompileOutput,enum2$&lt;wasmtime_environ::compile::CompileError&gt;,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\result.rs:1963</span>
<span class="w">   </span><span class="nt">6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::collect_inputs_in_translations::closure$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::ModuleTranslation&gt;,wasmtime::compile::build_co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:457</span>
<span class="w">   </span><span class="nt">7</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::FnOnce::call_once&lt;wasmtime::compile::impl$4::collect_inputs_in_translations::closure_env$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::Mod</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:250</span>
<span class="w">   </span><span class="nt">8</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::boxed::impl$47::call_once&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutpu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\boxed.rs:2016</span>
<span class="w">   </span><span class="nt">9</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::compile::closure$0</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:537</span>
<span class="w w-Error">  </span><span class="nt">10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::engine::impl$1::run_maybe_parallel::closure$0&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\engine.rs:164</span>
<span class="w">  </span><span class="nt">11</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$1::call_mut&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:272</span>
<span class="w">  </span><span class="nt">12</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$4::call_once&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:305</span>
<span class="w">  </span><span class="nt">13</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enum2$&lt;core::option::Option&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marker::Send&gt;,al</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\option.rs:1072</span>
<span class="w">  </span><span class="nt">14</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">15</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">16</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::take_while::impl$2::next&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\take_while.rs:47</span>
<span class="w">  </span><span class="nt">17</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;wasmtime::compile::CompileOutput,core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">18</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;::extend_desugared&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core:</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2930</span>
<span class="w">  </span><span class="nt">19</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::spec_extend::impl$0::spec_extend&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\spec_extend.rs:17</span>
<span class="w">  </span><span class="nt">20</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::impl$18::extend&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2904</span>
<span class="w">  </span><span class="nt">21</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::extend::impl$2::consume_iter&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dy</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\extend.rs:130</span>
<span class="w">  </span><span class="nt">22</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::while_some::impl$4::consume_iter&lt;wasmtime::compile::CompileOutput,rayon::iter::extend::ListVecFolder&lt;wasmtime::compile::CompileOutput&gt;,core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\while_some.rs:139</span>
<span class="w">  </span><span class="nt">23</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,rayon::iter::while_some::WhileSomeFolder&lt;rayon::iter::extend::ListVecFolde</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">24</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marke</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">25</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::Producer::fold_with&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,an</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:109</span>
<span class="w">  </span><span class="nt">26</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::Com</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:437</span>
<span class="w">  </span><span class="nt">27</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper::closure$1&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::c</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:426</span>
<span class="w">  </span><span class="nt">28</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon_core::join::join_context::call_b::closure$0&lt;alloc::collections::linked_list::LinkedList&lt;alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;,alloc::alloc::Global&gt;,rayon::iter::plumbing::bridge_producer_consumer::helper::closure_env</span>

<span class="p p-Indicator">[</span><span class="nv">message truncated</span><span class="p p-Indicator">]</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="439586218"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238657%20%60ref.func%60%3A%20undeclared%20function%20re.../near/439586218" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html#439586218">(May 20 2024 at 14:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8657#issuecomment-2120588720">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8657">issue #8657</a>:</p>
<blockquote>
<p>Thanks for the report! The example you're copying in the function-references proposal, and the snippet here, are both invalid and need to be updated (at least in the function-references proposal). The <a href="https://webassembly.github.io/spec/core/valid/instructions.html#reference-instructions">validation of <code>ref.func</code></a> requires that the referenced function is already registered in an <code>elem</code> segment or defined global. For this you'll want to do something like:</p>
<div class="codehilite" data-code-language="wasm"><pre><span></span><code>(elem declare funcref (ref.func $inc))
</code></pre></div>
<p>where the complete example is:</p>
<p><div class="codehilite" data-code-language="wasm"><pre><span></span><code>(component $App
    (core module $Main
        (type $i32-i32 (func (param i32) (result i32)))

        (elem declare funcref (ref.func $inc)) ;; &lt;- this line was added

        (func $hof (param $f (ref $i32-i32)) (result i32)
            (i32.add (i32.const 10) (call_ref $i32-i32 (i32.const 42) (local.get $f)))
        )

        (func $inc (param $i i32) (result i32)
            (i32.add (local.get $i) (i32.const 1))
        )

        (func $caller (result i32)
            (call $hof (ref.func $inc))
        )
    )
)
</code></pre></div><br>
</p>
</blockquote>



<a name="439596988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238657%20%60ref.func%60%3A%20undeclared%20function%20re.../near/439596988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238657.20.60ref.2Efunc.60.3A.20undeclared.20function.20re.2E.2E.2E.html#439596988">(May 20 2024 at 15:28)</a>:</h4>
<p>oovm closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8657">issue #8657</a>:</p>
<blockquote>
<h3>Test Case</h3>
<div class="codehilite" data-code-language="WebAssembly"><pre><span></span><code><span class="p">(</span><span class="err">component</span> <span class="nv">$App</span>
    <span class="p">(</span><span class="err">core</span> <span class="k">module</span> <span class="nv">$Main</span>
        <span class="p">(</span><span class="k">type</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">param</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)))</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$hof</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$f</span> <span class="p">(</span><span class="err">ref</span> <span class="nv">$i32-i32</span><span class="p">))</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nb">call</span><span class="err">_ref</span> <span class="nv">$i32-i32</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">42</span><span class="p">)</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$f</span><span class="p">)))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$inc</span> <span class="p">(</span><span class="k">param</span> <span class="nv">$i</span> <span class="kt">i32</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="k">func</span> <span class="nv">$caller</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">call</span> <span class="nv">$hof</span> <span class="p">(</span><span class="err">ref.</span><span class="k">func</span> <span class="nv">$inc</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<ul>
<li>This example came from: <a href="https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples">https://github.com/WebAssembly/gc/blob/main/proposals/function-references/Overview.md#examples</a></li>
</ul>
<h3>Steps to Reproduce</h3>
<ul>
<li>When commenting <code>$caller</code> function, everything works fine. </li>
<li>Uncommenting it will give an error.</li>
</ul>
<h3>Expected Results</h3>
<p>No error reported</p>
<h3>Actual Results</h3>
<p><div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">Error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WebAssembly translation error</span>

<span class="nt">Caused by</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Invalid input WebAssembly code at offset 67</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">undeclared function reference</span>

<span class="nt">Stack backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="nt">0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::dbghelp::trace</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\dbghelp.rs:131</span>
<span class="w">   </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace_rs::backtrace::trace_unsynchronized</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\..\..\backtrace\src\backtrace\mod.rs:66</span>
<span class="w">   </span><span class="nt">2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::create</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:331</span>
<span class="w">   </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std::backtrace::Backtrace::capture</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c/library\std\src\backtrace.rs:296</span>
<span class="w">   </span><span class="nt">4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">anyhow::error::impl$1::from&lt;enum2$&lt;wasmtime_environ::compile::CompileError&gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\anyhow-1.0.85\src\error.rs:565</span>
<span class="w">   </span><span class="nt">5</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::result::impl$27::from_residual&lt;wasmtime::compile::CompileOutput,enum2$&lt;wasmtime_environ::compile::CompileError&gt;,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\result.rs:1963</span>
<span class="w">   </span><span class="nt">6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::collect_inputs_in_translations::closure$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::ModuleTranslation&gt;,wasmtime::compile::build_co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:457</span>
<span class="w">   </span><span class="nt">7</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::FnOnce::call_once&lt;wasmtime::compile::impl$4::collect_inputs_in_translations::closure_env$0&lt;core::iter::adapters::map::Map&lt;cranelift_entity::iter::IterMut&lt;wasmtime_types::StaticModuleIndex,wasmtime_environ::compile::module_environ::Mod</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:250</span>
<span class="w">   </span><span class="nt">8</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::boxed::impl$47::call_once&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutpu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\boxed.rs:2016</span>
<span class="w">   </span><span class="nt">9</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::compile::impl$4::compile::closure$0</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\compile.rs:537</span>
<span class="w w-Error">  </span><span class="nt">10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wasmtime::engine::impl$1::run_maybe_parallel::closure$0&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at C:\Users\Dell\.cargo\git\checkouts\wasmtime-41807828cb3a7a7e\a77e877\crates\wasmtime\src\engine.rs:164</span>
<span class="w">  </span><span class="nt">11</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$1::call_mut&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:272</span>
<span class="w">  </span><span class="nt">12</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::ops::function::impls::impl$4::call_once&lt;tuple$&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt;</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\ops\function.rs:305</span>
<span class="w">  </span><span class="nt">13</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enum2$&lt;core::option::Option&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marker::Send&gt;,al</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\option.rs:1072</span>
<span class="w">  </span><span class="nt">14</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">15</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Co</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">16</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::take_while::impl$2::next&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\take_while.rs:47</span>
<span class="w">  </span><span class="nt">17</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core::iter::adapters::map::impl$2::next&lt;wasmtime::compile::CompileOutput,core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tu</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\core\src\iter\adapters\map.rs:108</span>
<span class="w">  </span><span class="nt">18</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;::extend_desugared&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core:</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2930</span>
<span class="w">  </span><span class="nt">19</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::spec_extend::impl$0::spec_extend&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\spec_extend.rs:17</span>
<span class="w">  </span><span class="nt">20</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alloc::vec::impl$18::extend&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed</span><span class="p p-Indicator">:</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at /rustc/6672c16afcd4db8acdf08a6984fd4107bf07632c\library\alloc\src\vec\mod.rs:2904</span>
<span class="w">  </span><span class="nt">21</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::extend::impl$2::consume_iter&lt;wasmtime::compile::CompileOutput,core::iter::adapters::map::Map&lt;core::iter::adapters::take_while::TakeWhile&lt;core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dy</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\extend.rs:130</span>
<span class="w">  </span><span class="nt">22</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::while_some::impl$4::consume_iter&lt;wasmtime::compile::CompileOutput,rayon::iter::extend::ListVecFolder&lt;wasmtime::compile::CompileOutput&gt;,core::iter::adapters::map::Map&lt;core::iter::adapters::map::Map&lt;rayon::vec::SliceDrain&lt;alloc::boxed::Box&lt;dyn$</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\while_some.rs:139</span>
<span class="w">  </span><span class="nt">23</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt;,enum2$&lt;core::option::Option&lt;wasmtime::compile::CompileOutput&gt; &gt;,rayon::iter::while_some::WhileSomeFolder&lt;rayon::iter::extend::ListVecFolde</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">24</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::map::impl$8::consume_iter&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,anyhow::Error&gt; &gt; &gt; &gt;,core::marke</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\map.rs:248</span>
<span class="w">  </span><span class="nt">25</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::Producer::fold_with&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::CompileOutput,an</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:109</span>
<span class="w">  </span><span class="nt">26</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::compile::Com</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:437</span>
<span class="w">  </span><span class="nt">27</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon::iter::plumbing::bridge_producer_consumer::helper::closure$1&lt;rayon::vec::DrainProducer&lt;alloc::boxed::Box&lt;dyn$&lt;core::ops::function::FnOnce&lt;tuple$&lt;ref$&lt;dyn$&lt;wasmtime_environ::compile::Compiler&gt; &gt; &gt;,assoc$&lt;Output,enum2$&lt;core::result::Result&lt;wasmtime::c</span>
<span class="w">             </span><span class="l l-Scalar l-Scalar-Plain">at .cargo\rayon-1.10.0\src\iter\plumbing\mod.rs:426</span>
<span class="w">  </span><span class="nt">28</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rayon_core::join::join_context::call_b::closure$0&lt;alloc::collections::linked_list::LinkedList&lt;alloc::vec::Vec&lt;wasmtime::compile::CompileOutput,alloc::alloc::Global&gt;,alloc::alloc::Global&gt;,rayon::iter::plumbing::bridge_producer_consumer::helper::closure_env</span>

<span class="p p-Indicator">[</span><span class="nv">message truncated</span><span class="p p-Indicator">]</span>
</code></pre></div><br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>