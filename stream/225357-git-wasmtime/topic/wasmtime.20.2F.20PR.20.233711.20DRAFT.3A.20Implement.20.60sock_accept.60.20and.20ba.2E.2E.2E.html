<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3711 DRAFT: Implement `sock_accept` and ba... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html">wasmtime / PR #3711 DRAFT: Implement `sock_accept` and ba...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="268845569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268845569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268845569">(Jan 21 2022 at 13:56)</a>:</h4>
<p>haraldh opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:<br>
[ ] Windows support<br>
[ ] Put the <code>ListenFd</code> feature behind a cli options<br>
[ ] Document the <code>ListenFd</code> feature</p>
</blockquote>



<a name="268846242"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268846242" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268846242">(Jan 21 2022 at 14:01)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:<br>
[ ] Windows support<br>
[ ] Put the <code>ListenFd</code> feature behind a cli option<br>
[ ] Document the <code>ListenFd</code> feature</p>
</blockquote>



<a name="268850302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850302">(Jan 21 2022 at 14:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r789707608">PR review comment</a>:</p>
<blockquote>
<p>I think this shouldn't be done by default. I think it should only give access if a commandline argument is passed to enable it. In addition it would be nice to have a commandline argument to manually specify ports to listen to without having to use systemd or some other external program to create the socket.</p>
</blockquote>



<a name="268850303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850303">(Jan 21 2022 at 14:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-859616931">PR review</a>.</p>



<a name="268850631"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850631" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850631">(Jan 21 2022 at 14:36)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[ ] Windows support</li>
<li>[ ] Put the <code>ListenFd</code> feature behind a cli option</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
</ul>
</blockquote>



<a name="268850712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850712">(Jan 21 2022 at 14:37)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-859621093">PR review</a>.</p>



<a name="268850713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850713">(Jan 21 2022 at 14:37)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r789710370">PR review comment</a>:</p>
<blockquote>
<p>See the <code>TODO</code> section in the PR comment :)</p>
</blockquote>



<a name="268850863"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850863" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850863">(Jan 21 2022 at 14:38)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[ ] Windows support</li>
<li>[ ] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
</ul>
</blockquote>



<a name="268850974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850974">(Jan 21 2022 at 14:39)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-859623630">PR review</a>.</p>



<a name="268850975"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268850975" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268850975">(Jan 21 2022 at 14:39)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r789712103">PR review comment</a>:</p>
<blockquote>
<p>Happy to receive PRs to this draft :) Will add you as a co-author</p>
</blockquote>



<a name="268851098"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268851098" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268851098">(Jan 21 2022 at 14:40)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-859624705">PR review</a>.</p>



<a name="268851099"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268851099" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268851099">(Jan 21 2022 at 14:40)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r789712860">PR review comment</a>:</p>
<blockquote>
<p>Right. I honestly only looked at the source and barely at the description <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
</blockquote>



<a name="268852568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/268852568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#268852568">(Jan 21 2022 at 14:51)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[ ] Windows support</li>
<li>[ ] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269256760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269256760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269256760">(Jan 25 2022 at 13:34)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269259151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269259151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269259151">(Jan 25 2022 at 13:53)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269259173"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269259173" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269259173">(Jan 25 2022 at 13:53)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[ ] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269259174"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269259174" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269259174">(Jan 25 2022 at 13:53)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269261130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269261130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269261130">(Jan 25 2022 at 14:07)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269267531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269267531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269267531">(Jan 25 2022 at 14:52)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269269266"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269269266" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269269266">(Jan 25 2022 at 15:04)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269273495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269273495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269273495">(Jan 25 2022 at 15:32)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[ ] Tokio implementation</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269283635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269283635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269283635">(Jan 25 2022 at 16:36)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269387281"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269387281" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269387281">(Jan 26 2022 at 10:14)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269427455"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269427455" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269427455">(Jan 26 2022 at 15:17)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269427877"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269427877" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269427877">(Jan 26 2022 at 15:20)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[ ] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269427882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269427882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269427882">(Jan 26 2022 at 15:20)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[x] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="269428213"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269428213" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269428213">(Jan 26 2022 at 15:22)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[x] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Document the <code>ListenFd</code> feature</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269428444"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269428444" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269428444">(Jan 26 2022 at 15:23)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[x] Put the <code>ListenFd</code> feature behind a CLI option</li>
<li>[x] Add CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269432160"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269432160" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269432160">(Jan 26 2022 at 15:47)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-863734707">PR review</a>.</p>



<a name="269432161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269432161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269432161">(Jan 26 2022 at 15:47)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r792777785">PR review comment</a>:</p>
<blockquote>
<p>Wouldn't it make more sense to add a new preopen type returned by <code>fd_prestat_get</code> rather than using env vars? Also won't the current code conflict with the fds for pre-opened dirs?</p>
</blockquote>



<a name="269440127"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269440127" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269440127">(Jan 26 2022 at 16:31)</a>:</h4>
<p>haraldh submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#pullrequestreview-863796686">PR review</a>.</p>



<a name="269440128"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269440128" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269440128">(Jan 26 2022 at 16:31)</a>:</h4>
<p>haraldh created <a href="https://github.com/bytecodealliance/wasmtime/pull/3711#discussion_r792823067">PR review comment</a>:</p>
<blockquote>
<p>My goal was to mimic the listenfd behavior 1:1 so you could reuse already written code.</p>
<p>The preopened dirs are inserted later on, IIRC.. I can recheck again.</p>
</blockquote>



<a name="269441466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269441466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269441466">(Jan 26 2022 at 16:39)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269447033"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269447033" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269447033">(Jan 26 2022 at 17:14)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269545119"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269545119" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269545119">(Jan 27 2022 at 09:30)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269545202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269545202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269545202">(Jan 27 2022 at 09:31)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[ ] Followup PR with CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269545388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269545388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269545388">(Jan 27 2022 at 09:32)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[x] Windows support</li>
<li>[x] Tokio implementation</li>
<li>[ ] Followup PR with CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269545467"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269545467" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269545467">(Jan 27 2022 at 09:33)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>The split of <code>listen</code> and <code>stream</code> modules where mainly done because of the difference in <code>::num_ready_bytes()</code>.</p>
<p>TODO:</p>
<ul>
<li>[ ] Followup PR with CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269551333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269551333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269551333">(Jan 27 2022 at 10:25)</a>:</h4>
<p>haraldh updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>.</p>



<a name="269552528"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269552528" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269552528">(Jan 27 2022 at 10:36)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>TODO:</p>
<ul>
<li>[ ] Followup PR with CLI option to specify <code>ListenFd</code>s</li>
<li>[ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)</li>
<li>[ ] Non-busy polling on Windows</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</blockquote>



<a name="269561419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233711%20DRAFT%3A%20Implement%20%60sock_accept%60%20and%20ba.../near/269561419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233711.20DRAFT.3A.20Implement.20.60sock_accept.60.20and.20ba.2E.2E.2E.html#269561419">(Jan 27 2022 at 11:51)</a>:</h4>
<p>haraldh edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3711">PR #3711</a> from <code>wasmtime_sock_accept</code> to <code>main</code>:</p>
<blockquote>
<p>Together with <a href="https://github.com/rust-lang/rust/pull/93158">https://github.com/rust-lang/rust/pull/93158</a> this enables basic networking in rust.</p>
<p>TODO:</p>
<ul>
<li>[ ] Test cases</li>
<li>[ ] Discussion of <code>SocketAddr</code> return value for <code>::accept()</code> in the <a href="https://github.com/rust-lang/rust/pull/93158">rustsrc PR</a></li>
</ul>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="nb">Ok</span><span class="p">((</span><span class="w"></span>
<span class="w">            </span><span class="n">TcpStream</span>::<span class="n">from_inner</span><span class="p">(</span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Socket</span>::<span class="n">from_raw_fd</span><span class="p">(</span><span class="n">fd</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="w">            </span><span class="c1">// WASI has no concept of SocketAddr yet</span>
<span class="w">            </span><span class="c1">// return an unspecified IPv4Addr</span>
<span class="w">            </span><span class="n">SocketAddr</span>::<span class="n">new</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">UNSPECIFIED</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="p">))</span><span class="w"></span>
</code></pre></div>
<p>Followup Todo:
* [ ] PR with CLI option to specify <code>ListenFd</code>s
* [ ] Wasi definition of <code>Preopentype</code> for sockets (listener and stream, tcp and unix)
* [ ] Non-busy polling on Windows<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>