<html>
<head><meta charset="utf-8"><title>wasmtime / PR #5073 Remove uses of `reg_mod` from s390x · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html">wasmtime / PR #5073 Remove uses of `reg_mod` from s390x</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="304860206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304860206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304860206">(Oct 19 2022 at 00:00)</a>:</h4>
<p>elliottt opened <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>:</p>
<blockquote>
<p>Remove uses of <code>reg_mod</code> from the s390x backend. This required moving away from using <code>r0</code>/<code>r1</code> as the result registers from a few different pseudo instructions, standardizing instead on <code>r2/r3</code>. That change was necessary as regalloc2 will not correctly allocate registers that aren't listed in the allocatable set, which <code>r0</code>/<code>r1</code> are not.<br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="304863611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304863611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304863611">(Oct 19 2022 at 00:48)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="304863687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304863687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304863687">(Oct 19 2022 at 00:49)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>:</p>
<blockquote>
<p>Remove uses of <code>reg_mod</code> from the s390x backend. This required moving away from using <code>r0</code>/<code>r1</code> as the result registers from a few different pseudo instructions, standardizing instead on <code>r2/r3</code>. That change was necessary as regalloc2 will not correctly allocate registers that aren't listed in the allocatable set, which <code>r0</code>/<code>r1</code> are not.</p>
<p>cc @uweigand, this is the same set of changes you and @cfallin iterated on in #4856.<br>
&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="304875324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304875324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304875324">(Oct 19 2022 at 03:37)</a>:</h4>
<p><strong>elliottt</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> as ready for review.</p>



<a name="304938981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938981">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147383803">PR review</a>.</p>



<a name="304938982"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938982" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938982">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147383803">PR review</a>.</p>



<a name="304938983"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938983" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938983">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999337433">PR review comment</a>:</p>
<blockquote>
<p>Doesn't this swap the two inputs now?  The original logic results in <code>src1</code> if the condition is true and <code>src2</code> if it is false.  The new logic appears to result in <code>src1</code> if the condition is false ...</p>
</blockquote>



<a name="304938984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938984">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999334830">PR review comment</a>:</p>
<blockquote>
<p>Similarly, these helpers shouldn't be needed anymore.</p>
</blockquote>



<a name="304938985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938985">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999342081">PR review comment</a>:</p>
<blockquote>
<p>The whole reason for using an <code>emit_producer</code> / <code>emit_consumer</code> pair here, instead of just doing <code>(with_flags_reg producer consumer)</code>, is that we needed to place the <code>emit_mov</code> <em>in between</em>.  If this is no longer necessary, I guess we could just use <code>with_flags_reg</code>.   (But that can also be a standalone follow-up cleanup.)</p>
</blockquote>



<a name="304938987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938987">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999351207">PR review comment</a>:</p>
<blockquote>
<p>Why the <code>extern</code> when it is already fully defined here?</p>
</blockquote>



<a name="304938988"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938988" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938988">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999352219">PR review comment</a>:</p>
<blockquote>
<p>Again the question, why have another definition here when it is already defined in ISLE?  I think it should be one place or the other, not both.</p>
</blockquote>



<a name="304938990"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938990" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938990">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999359194">PR review comment</a>:</p>
<blockquote>
<p>So these changes I really do not like, for the same reason originally discussed here: <a href="https://github.com/bytecodealliance/wasmtime/pull/4856#discussion_r962932362">https://github.com/bytecodealliance/wasmtime/pull/4856#discussion_r962932362</a></p>
<p>I really think the final assembly output needs to remain <em>valid</em> s390x assembler text, that could be run through the system assembler.  We fixed that problem originally by using a <code>pretty_print_reg_mod</code> helper that prints both virtual regs before regalloc, and just the single physreg after regalloc.</p>
<p>Similarly, I think we should define <code>pretty_print_regpair</code> and/or <code>pretty_print_regpair_mod</code> helpers that print all participating virtual regs before regalloc, and just the single physreg  that ends up in the assembler text after regalloc.</p>
<p>That should also remove many of the changes to the filetests.</p>
</blockquote>



<a name="304938992"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938992" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938992">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999334193">PR review comment</a>:</p>
<blockquote>
<p>I believe this shouldn't be needed at all anymore, see my patch attached here: <a href="https://github.com/bytecodealliance/wasmtime/pull/4856#issuecomment-1237240252">https://github.com/bytecodealliance/wasmtime/pull/4856#issuecomment-1237240252</a></p>
</blockquote>



<a name="304938993"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938993" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938993">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999325787">PR review comment</a>:</p>
<blockquote>
<p>I think there should still be a FIXME somewhere that these aren't actually allocated but hard-coded.  But maybe that FIXME should now go into <code>s390x_get_operands</code> instead?</p>
</blockquote>



<a name="304938994"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938994" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938994">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999344606">PR review comment</a>:</p>
<blockquote>
<p>Might as well use <code>rd1</code> for clarity then.</p>
</blockquote>



<a name="304938995"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304938995" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304938995">(Oct 19 2022 at 12:13)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999328406">PR review comment</a>:</p>
<blockquote>
<p>Chris' original patch always uses <code>ri</code> for the input side of tied operands.  I think it would be preferable to be consistent with that everywhere.</p>
</blockquote>



<a name="304998362"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304998362" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304998362">(Oct 19 2022 at 16:49)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147957808">PR review</a>.</p>



<a name="304998364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304998364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304998364">(Oct 19 2022 at 16:49)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999714639">PR review comment</a>:</p>
<blockquote>
<p>How about adding this FIXME where the allocatable registers are defined?</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/0667a412d70c6b4d9f97502a351db54373c18c91/cranelift/codegen/src/isa/s390x/inst/regs.rs#L94-L95">https://github.com/bytecodealliance/wasmtime/blob/0667a412d70c6b4d9f97502a351db54373c18c91/cranelift/codegen/src/isa/s390x/inst/regs.rs#L94-L95</a></p>
</blockquote>



<a name="304999350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999350">(Oct 19 2022 at 16:54)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147964251">PR review</a>.</p>



<a name="304999353"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999353" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999353">(Oct 19 2022 at 16:54)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999719168">PR review comment</a>:</p>
<blockquote>
<p>This is so that we have the constructors available in the ISLE source, but don't emit the actual declaration.</p>
</blockquote>



<a name="304999555"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999555" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999555">(Oct 19 2022 at 16:55)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147965802">PR review</a>.</p>



<a name="304999556"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999556" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999556">(Oct 19 2022 at 16:55)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999720193">PR review comment</a>:</p>
<blockquote>
<p>It's a little unfortunate to have the redundancy here, but this is currently the best way to have the constructors from an enum available when the declaration is in rust.</p>
</blockquote>



<a name="304999820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999820">(Oct 19 2022 at 16:56)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147967717">PR review</a>.</p>



<a name="304999821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999821">(Oct 19 2022 at 16:56)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999721533">PR review comment</a>:</p>
<blockquote>
<p>The other backends had drifted from being valid assembly, and I had assumed that the same was true of the s390x backend; I'll remove the changes to the pretty-printer <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> </p>
</blockquote>



<a name="304999904"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999904" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999904">(Oct 19 2022 at 16:57)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999721965">PR review comment</a>:</p>
<blockquote>
<p>Great point, that will be more resilient long-term as well.</p>
</blockquote>



<a name="304999905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/304999905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#304999905">(Oct 19 2022 at 16:57)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1147968384">PR review</a>.</p>



<a name="305007323"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305007323" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305007323">(Oct 19 2022 at 17:37)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999761002">PR review comment</a>:</p>
<blockquote>
<p>Fine with me, thanks!</p>
</blockquote>



<a name="305007324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305007324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305007324">(Oct 19 2022 at 17:37)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148024403">PR review</a>.</p>



<a name="305007547"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305007547" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305007547">(Oct 19 2022 at 17:38)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148025636">PR review</a>.</p>



<a name="305007548"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305007548" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305007548">(Oct 19 2022 at 17:38)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999761858">PR review comment</a>:</p>
<blockquote>
<p>I guess my question is, why <em>does</em> the declaration have to be in rust?  Why not just have it in ISLE, and use the auto-generated definition from Rust code, just like with the other enums defined in ISLE?</p>
</blockquote>



<a name="305015603"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305015603" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305015603">(Oct 19 2022 at 18:20)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305016290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305016290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305016290">(Oct 19 2022 at 18:24)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148084665">PR review</a>.</p>



<a name="305016292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305016292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305016292">(Oct 19 2022 at 18:24)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999803468">PR review comment</a>:</p>
<blockquote>
<p>The precise-output test changes should be mostly register changes now.</p>
</blockquote>



<a name="305023672"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305023672" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305023672">(Oct 19 2022 at 19:08)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148139069">PR review</a>.</p>



<a name="305023673"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305023673" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305023673">(Oct 19 2022 at 19:08)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999842211">PR review comment</a>:</p>
<blockquote>
<p>Unfortunately the reason in this case is that it allows us to derive <code>Copy</code> for <code>RegPair</code> and <code>WritableRegPair</code>. Without deriving <code>Copy</code> the register pair values get moved into the instructions that use them, and borrow errors are generated for any subsequent use of those values. This might be a pattern that we should enable in ISLE, but for now it's easiest to define those types in rust instead.</p>
</blockquote>



<a name="305024801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305024801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305024801">(Oct 19 2022 at 19:15)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305024948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305024948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305024948">(Oct 19 2022 at 19:16)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148147367">PR review</a>.</p>



<a name="305024949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305024949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305024949">(Oct 19 2022 at 19:16)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999847970">PR review comment</a>:</p>
<blockquote>
<p>I've moved this comment to the first fixed allocation of <code>%r2</code>/<code>%r3</code> instead, as that made it easier to provide some context.</p>
</blockquote>



<a name="305025597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305025597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305025597">(Oct 19 2022 at 19:20)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148152259">PR review</a>.</p>



<a name="305025598"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305025598" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305025598">(Oct 19 2022 at 19:20)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999851410">PR review comment</a>:</p>
<blockquote>
<p>Now that I've reverted everything back to how it was before, I'll have a look at adding the helper that you mentioned to print  the additional regs when they don't have a physical allocation.</p>
</blockquote>



<a name="305032812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305032812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305032812">(Oct 19 2022 at 20:06)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148205559">PR review</a>.</p>



<a name="305032813"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305032813" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305032813">(Oct 19 2022 at 20:06)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999886994">PR review comment</a>:</p>
<blockquote>
<p>You're right, it absolutely does. However, it's not used anywhere, so I'll remove it.</p>
</blockquote>



<a name="305033794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305033794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305033794">(Oct 19 2022 at 20:10)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305034961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305034961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305034961">(Oct 19 2022 at 20:17)</a>:</h4>
<p>elliottt edited <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999886994">PR review comment</a>.</p>



<a name="305037521"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305037521" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305037521">(Oct 19 2022 at 20:32)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305037650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305037650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305037650">(Oct 19 2022 at 20:33)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148237302">PR review</a>.</p>



<a name="305037651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305037651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305037651">(Oct 19 2022 at 20:33)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999908702">PR review comment</a>:</p>
<blockquote>
<p>I migrated <code>select_bool_reg</code> and <code>select_bool_imm</code>, which removed the need for <code>emit_consumer</code>.</p>
</blockquote>



<a name="305050985"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305050985" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305050985">(Oct 19 2022 at 22:18)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305051783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305051783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305051783">(Oct 19 2022 at 22:24)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1148343151">PR review</a>.</p>



<a name="305051784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305051784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305051784">(Oct 19 2022 at 22:24)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r999984496">PR review comment</a>:</p>
<blockquote>
<p>I made the changes to introduce <code>pretty_print_regpair</code>, <code>pretty_print_regpair_mod</code>, and <code>pretty_print_regpair_mod_lo</code>. This definitely cleaned up the pretty-printing code quite a bit, so thank you for the suggestion!</p>
<p>I also opted to make <code>RegPair</code> and <code>WritableRegPair</code> structs instead of enums, and marking them as <code>primitive</code> types in ISLE. This required moving some functions to rust like <code>regpair</code>, <code>regpair_lo</code>, etc, but made working with their values in rust much nicer.</p>
</blockquote>



<a name="305131227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131227">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149034909">PR review</a>.</p>



<a name="305131228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131228">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149034909">PR review</a>.</p>



<a name="305131229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131229">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000495899">PR review comment</a>:</p>
<blockquote>
<p>Not sure if there can be a phase where only one of <code>hi</code> and <code>lo</code> are real regs?   Also, it would be good to assert in the real reg case that we have a valid even/odd pair.</p>
</blockquote>



<a name="305131230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131230">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000483001">PR review comment</a>:</p>
<blockquote>
<p>Should be <code>ri</code> in the comment now.</p>
</blockquote>



<a name="305131231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131231">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000508633">PR review comment</a>:</p>
<blockquote>
<p>This also now seems to generate an extra <code>lgr</code> (see the <code>ctz_64</code> test case).</p>
</blockquote>



<a name="305131232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131232">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000492999">PR review comment</a>:</p>
<blockquote>
<p>There's actually no need now to assert we get the specific r2/r3 pair here.  The emit code might as well accept any valid register pair, i.e. only assert that we have an even/odd GPR pair, and that the tied input (if any) matches the output.</p>
<p>Then the only place where r2/r3 are still hardcoded is in <code>s390x_get_operands</code>.</p>
</blockquote>



<a name="305131233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131233">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000508375">PR review comment</a>:</p>
<blockquote>
<p>So the old <code>select_bool_imm/reg</code> were written the way they were specifically to avoid unnecessary register moves.  It appears this new way brings those unnecessary moves back (see e.g. the many tests with an extra <code>lgr</code> in <code>icmp.clif</code>.  This is not a show-stopper for this PR, we can look into it afterwards -- just wondering if there's something we can to do improve on this again ...</p>
</blockquote>



<a name="305131234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131234">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000482470">PR review comment</a>:</p>
<blockquote>
<p>Perfect!</p>
</blockquote>



<a name="305131235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131235">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000493612">PR review comment</a>:</p>
<blockquote>
<p>Ah, I see.  Thanks for the explanation.</p>
</blockquote>



<a name="305131236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131236">(Oct 20 2022 at 11:36)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000487965">PR review comment</a>:</p>
<blockquote>
<p><code>cmov_imm_regpair_lo/hi</code> were only used by the old division code, so they're really not needed anymore</p>
</blockquote>



<a name="305131366"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131366" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131366">(Oct 20 2022 at 11:37)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149078781">PR review</a>.</p>



<a name="305131367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305131367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305131367">(Oct 20 2022 at 11:37)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000512302">PR review comment</a>:</p>
<blockquote>
<p>Yes, this is looking really nice now, thanks!</p>
</blockquote>



<a name="305189284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305189284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305189284">(Oct 20 2022 at 16:32)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149601082">PR review</a>.</p>



<a name="305189286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305189286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305189286">(Oct 20 2022 at 16:32)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000866960">PR review comment</a>:</p>
<blockquote>
<p>That's much cleaner, thanks!</p>
</blockquote>



<a name="305199083"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305199083" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305199083">(Oct 20 2022 at 17:17)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305199384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305199384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305199384">(Oct 20 2022 at 17:18)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149668910">PR review</a>.</p>



<a name="305199385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305199385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305199385">(Oct 20 2022 at 17:18)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000913144">PR review comment</a>:</p>
<blockquote>
<p>I changed this to require that both <code>hi</code> and <code>lo</code> are real registers, and to assert that they are valid.</p>
</blockquote>



<a name="305206419"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305206419" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305206419">(Oct 20 2022 at 17:56)</a>:</h4>
<p>elliottt updated <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a> from <code>trevor/ssa-s390x</code> to <code>main</code>.</p>



<a name="305206570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305206570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305206570">(Oct 20 2022 at 17:57)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1149732636">PR review</a>.</p>



<a name="305206572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305206572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305206572">(Oct 20 2022 at 17:57)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1000952802">PR review comment</a>:</p>
<blockquote>
<p>I went ahead and reverted this commit, as it's not strictly necessary for removing uses of <code>reg_mod</code>.</p>
</blockquote>



<a name="305257228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305257228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305257228">(Oct 21 2022 at 00:00)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1150144579">PR review</a>.</p>



<a name="305257229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305257229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305257229">(Oct 21 2022 at 00:00)</a>:</h4>
<p>elliottt created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1001229732">PR review comment</a>:</p>
<blockquote>
<p>I dug into this a bit, and have an explanation. Here's the program before register allocation:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">0</span>: <span class="nc">args</span><span class="w"> </span><span class="o">%</span><span class="n">v128</span><span class="o">=%</span><span class="n">r2</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">1</span>: <span class="nc">lcgr</span><span class="w"> </span><span class="o">%</span><span class="n">v131</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v128</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">2</span>: <span class="nc">ngrk</span><span class="w"> </span><span class="o">%</span><span class="n">v132</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v128</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v131</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">3</span>: <span class="nc">flogr</span><span class="w"> </span><span class="o">%</span><span class="n">v133</span><span class="o">/%</span><span class="n">v134</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v132</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">4</span>: <span class="nc">locghie</span><span class="w"> </span><span class="o">%</span><span class="n">v135</span><span class="o">&lt;-%</span><span class="n">v133</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">5</span>: <span class="nc">lghi</span><span class="w"> </span><span class="o">%</span><span class="n">v136</span><span class="p">,</span><span class="w"> </span><span class="mi">63</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">6</span>: <span class="nc">sgrk</span><span class="w"> </span><span class="o">%</span><span class="n">v137</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v136</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v135</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">7</span>: <span class="nc">lgr</span><span class="w"> </span><span class="o">%</span><span class="n">v130</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v129</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">8</span>: <span class="nc">lgr</span><span class="w"> </span><span class="o">%</span><span class="n">r2</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">v130</span><span class="w"></span>
<span class="w">  </span><span class="n">Inst</span><span class="w"> </span><span class="mi">9</span>: <span class="nc">br</span><span class="w"> </span><span class="o">%</span><span class="n">r14</span><span class="w"></span>
</code></pre></div>
<p>There are two live-ranges that contribute to the move: one that covers the output of instruction 3 to where it's consumed in instruction 4 (<code>a</code>), and one that covers the output of instruction 4  to where it's consumed in instruction 6 (<code>b</code>). As the second live-range <code>b</code> is longer than <code>a</code>, it will be allocated first. As it has no fixed register constraints, the allocator is free to choose anything, and in the test output it chooses <code>%r4</code>. As the <code>flogr</code> instruction has a constraint that says it must use <code>%r2</code>/<code>%r3</code> for its output register, allocating a register for <code>%v133</code> produces a move from <code>%r2</code> to <code>%r4</code> once the live-range <code>a</code> is processed.</p>
<p>It would be great to fix this problem by merging those two live-ranges into a single bundle, but regalloc2 is currently unable to merge live ranges when one contains a fixed register constraint, like <code>a</code>. It's not all bad news though, getting cranelift producing lowered output that's in SSA will enable some simplifications in regalloc2 that will enable merging these two live-ranges, so these sort of unnecessary moves should be less common in the future.</p>
</blockquote>



<a name="305257254"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305257254" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305257254">(Oct 21 2022 at 00:00)</a>:</h4>
<p><strong>elliottt</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a>.</p>



<a name="305257388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305257388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305257388">(Oct 21 2022 at 00:02)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1150145750">PR review</a>.</p>



<a name="305286767"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305286767" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305286767">(Oct 21 2022 at 06:19)</a>:</h4>
<p>uweigand created <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#discussion_r1001408313">PR review comment</a>:</p>
<blockquote>
<p>I see, thanks for having a look.  This looks all good to me now.</p>
</blockquote>



<a name="305286768"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305286768" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305286768">(Oct 21 2022 at 06:19)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1150397217">PR review</a>.</p>



<a name="305286787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305286787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305286787">(Oct 21 2022 at 06:19)</a>:</h4>
<p>uweigand submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/5073#pullrequestreview-1150397400">PR review</a>.</p>



<a name="305395292"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%235073%20Remove%20uses%20of%20%60reg_mod%60%20from%20s390x/near/305395292" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.235073.20Remove.20uses.20of.20.60reg_mod.60.20from.20s390x.html#305395292">(Oct 21 2022 at 16:22)</a>:</h4>
<p>elliottt merged <a href="https://github.com/bytecodealliance/wasmtime/pull/5073">PR #5073</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>