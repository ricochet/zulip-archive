<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1605 Stub of a new isel backend for x64 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html">wasmtime / PR #1605 Stub of a new isel backend for x64</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="195444931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195444931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195444931">(Apr 27 2020 at 16:52)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1605" title="https://github.com/bytecodealliance/wasmtime/pull/1605">PR #1605</a> from <code>rebase-x64</code> to <code>master</code>:</p>
<blockquote>
<p>This is a draft-ish PR containing a rebase of Julian's x64 work on the new isel backend, including quite a few refactorings of mine. During today's Cranelift meeting, we agreed that it might make sense to add the incomplete backend here, allowing incremental development by more contributors.</p>
<p>I've tried to split the files in a way that was similar to the aarch64 backend, but some things might still be wobbly; I might check this a bit further more tomorrow. Of course, that's also something we could do as follow-up PRs.</p>
<p>The new x64 backend is controlled by a new Cargo feature <code>x64</code> (which also requires <code>x86</code>). Then, users of <code>clif-util</code> can use the <code>--target x86_64</code> argument, and:</p>
<ul>
<li>get the code generated by the current isel (with legalization, Recipes, Encodings, etc.) and regalloc if nothing more is provided.</li>
<li>or add <code>--set use_new_backend</code> and this will use the new isel backend. (Expect panics, unimplemented errors, etc.)</li>
</ul>
<p>Second (small) commit is what allows passing ISA-specific flags to <code>--set</code>, which wasn't implemented yet.</p>
</blockquote>



<a name="195446508"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195446508" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195446508">(Apr 27 2020 at 17:02)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401149846" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401149846">PR Review</a>.</p>



<a name="195446509"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195446509" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195446509">(Apr 27 2020 at 17:02)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415988543" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415988543">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>fn xmm(num: u8) -&gt; Reg {
    fpr(num, 14 + num)
}
</pre></div>


</blockquote>



<a name="195446676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195446676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195446676">(Apr 27 2020 at 17:03)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401151120" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401151120">PR Review</a>.</p>



<a name="195446677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195446677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195446677">(Apr 27 2020 at 17:03)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415989686" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415989686">PR Review Comment</a>:</p>
<blockquote>
<p>Please return the original triple as passed to <code>isa_builder</code>.</p>
</blockquote>



<a name="195447024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447024">(Apr 27 2020 at 17:06)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401153007" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401153007">PR Review</a>.</p>



<a name="195447025"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447025" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447025">(Apr 27 2020 at 17:06)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415991358" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415991358">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    if isa_flags.use_new_backend() {
        #[cfg(feature = &quot;x64&quot;)]
        {
            use super::x64;
            return x64::isa_builder(triple).finish(shared_flags)
        }
        #[cfg(not(feature = &quot;x64&quot;))]
        {
            panic!(&quot;new backend x86 support not included by cargo features!&quot;);
        }
    } else {
        Box::new(Isa {
            triple,
            isa_flags,
            shared_flags,
            cpumode: level1,
        })
    }
</pre></div>


</blockquote>



<a name="195447325"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447325" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447325">(Apr 27 2020 at 17:08)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401154915" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401154915">PR Review</a>.</p>



<a name="195447326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447326">(Apr 27 2020 at 17:08)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415992994" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415992994">PR Review Comment</a>:</p>
<blockquote>
<p>There is already a way to have target specific settings: <code>target riscv32 supports_m=1</code></p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/d6b158992697546dfda982495bfa7572668a9888/cranelift/filetests/filetests/isa/riscv/expand-i32.clif#L4" title="https://github.com/bytecodealliance/wasmtime/blob/d6b158992697546dfda982495bfa7572668a9888/cranelift/filetests/filetests/isa/riscv/expand-i32.clif#L4">https://github.com/bytecodealliance/wasmtime/blob/d6b158992697546dfda982495bfa7572668a9888/cranelift/filetests/filetests/isa/riscv/expand-i32.clif#L4</a></p>
</blockquote>



<a name="195447660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447660">(Apr 27 2020 at 17:11)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995096" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995096">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// `simm32` is its sign-extension out to 64 bits.
</pre></div>


</blockquote>



<a name="195447661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447661">(Apr 27 2020 at 17:11)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401157261" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401157261">PR Review</a>.</p>



<a name="195447781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447781">(Apr 27 2020 at 17:12)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401157866" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401157866">PR Review</a>.</p>



<a name="195447782"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447782" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447782">(Apr 27 2020 at 17:12)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995677" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995677">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// the signless, non-extending (N x N -&gt; N, for N in {32,64}) variant
    Mul,
</pre></div>


</blockquote>



<a name="195447794"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447794" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447794">(Apr 27 2020 at 17:12)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401158043" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401158043">PR Review</a>.</p>



<a name="195447796"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195447796" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195447796">(Apr 27 2020 at 17:12)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995826" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415995826">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// These indicate ways of extending (widening) a value, using the Intel
/// naming: B(yte) = u8, W(ord) = u16, L(ong)word = u32, Q(uad)word = u64
</pre></div>


</blockquote>



<a name="195448151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448151">(Apr 27 2020 at 17:15)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401160373" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401160373">PR Review</a>.</p>



<a name="195448152"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448152" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448152">(Apr 27 2020 at 17:15)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415997847" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415997847">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// byte -&gt; long word
    BL,
    /// byte -&gt; quad word
    BQ,
    /// word -&gt; long word
    WL,
    /// word -&gt; quad word
    WQ,
    /// long -&gt; quad word
    LQ,
</pre></div>


<p>Also is there no byte -&gt; word variant?</p>
</blockquote>



<a name="195448539"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448539" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448539">(Apr 27 2020 at 17:18)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162651" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162651">PR Review</a>.</p>



<a name="195448540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448540">(Apr 27 2020 at 17:18)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415999992" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r415999992">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    /// overflow
    O = 0,
    /// no overflow
    NO = 1,
    /// &lt;u
    B = 2,
    /// &gt;= u
    NB = 3,
    /// zero
    Z = 4,
    /// not zero
    NZ = 5,
    /// &lt;=u
    BE = 6,
    /// &gt;u
    NBE = 7,
    /// negative
    S = 8,
    /// not negative
    NS = 9,
    /// &lt;s
    L = 12,
    /// &gt;=s
    NL= 13,
    /// &lt;=s
    LE = 14,
    /// &gt;s
    NLE = 15,
</pre></div>


</blockquote>



<a name="195448568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448568">(Apr 27 2020 at 17:18)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162815" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162815">PR Review</a>.</p>



<a name="195448570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448570">(Apr 27 2020 at 17:18)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000150" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000150">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        self as u8
</pre></div>


</blockquote>



<a name="195448593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448593">(Apr 27 2020 at 17:19)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162947" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401162947">PR Review</a>.</p>



<a name="195448595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448595">(Apr 27 2020 at 17:19)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000280" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000280">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>#[derive(Copy, Clone)]
#[repr(u8)]
</pre></div>


</blockquote>



<a name="195448643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448643">(Apr 27 2020 at 17:19)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401163364" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401163364">PR Review</a>.</p>



<a name="195448644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448644">(Apr 27 2020 at 17:19)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000652" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416000652">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            CC::O =&gt; CC::NO,
            CC::NO =&gt; CC::O,

            CC::B =&gt; CC::NB,
            CC::NB =&gt; CC::B,

            CC::Z =&gt; CC::NZ,
            CC::NZ =&gt; CC::Z,

            CC::BE =&gt; CC::NBE,
            CC::NBE =&gt; CC::BE,

            CC::S =&gt; CC::NS,
            CC::NS =&gt; CC::S,

            CC::L =&gt; CC::NL,
            CC::NL =&gt; CC::L,

            CC::LE =&gt; CC::NLE,
            CC::NLE =&gt; CC::LE,
</pre></div>


</blockquote>



<a name="195448889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448889">(Apr 27 2020 at 17:21)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401164739" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401164739">PR Review</a>.</p>



<a name="195448890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448890">(Apr 27 2020 at 17:21)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416001860" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416001860">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// Don&#39;t build these directly.  Instead use the `Inst::*` functions to create them.
</pre></div>


</blockquote>



<a name="195448938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448938">(Apr 27 2020 at 17:22)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401165127" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401165127">PR Review</a>.</p>



<a name="195448939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195448939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195448939">(Apr 27 2020 at 17:22)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416002197" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416002197">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    Ret,
</pre></div>


</blockquote>



<a name="195449045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449045">(Apr 27 2020 at 17:22)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401165558" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401165558">PR Review</a>.</p>



<a name="195449046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449046">(Apr 27 2020 at 17:22)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416002583" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416002583">PR Review Comment</a>:</p>
<blockquote>
<p>Why? You can just emit multiple nop instructions, right?</p>
</blockquote>



<a name="195449499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449499">(Apr 27 2020 at 17:26)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401168541" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401168541">PR Review</a>.</p>



<a name="195449500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449500">(Apr 27 2020 at 17:26)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416005342" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416005342">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                s + &amp;format!(&quot;{nil: &lt;width$}&quot;, nil = &quot;&quot;, width = need)
</pre></div>


</blockquote>



<a name="195449569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449569">(Apr 27 2020 at 17:26)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401169043" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401169043">PR Review</a>.</p>



<a name="195449570"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449570" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449570">(Apr 27 2020 at 17:26)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416005865" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416005865">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                _ =&gt; panic!(&quot;Inst(x64).show.suffixBWLQ (size={})&quot;, size),
</pre></div>


</blockquote>



<a name="195449712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449712">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401169916" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401169916">PR Review</a>.</p>



<a name="195449713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449713">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006659" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006659">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // For registers that appear in a read role, apply `pre_map`.  For those
    // that appear in a write role, apply `post_map`.  For registers that
</pre></div>


</blockquote>



<a name="195449779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449779">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170090" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170090">PR Review</a>.</p>



<a name="195449780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449780">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006817" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006817">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // Note that this function must be closely coordinated with `fn regs`, in
    // the sense that each arm &quot;agrees&quot; with the one in `fn regs` about which
</pre></div>


</blockquote>



<a name="195449800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449800">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170228" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170228">PR Review</a>.</p>



<a name="195449801"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449801" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449801">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006951" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416006951">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            apply_map(dst, pre_map); // yes, really `pre_map`
</pre></div>


</blockquote>



<a name="195449820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449820">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170377" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170377">PR Review</a>.</p>



<a name="195449821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449821">(Apr 27 2020 at 17:28)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007087" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007087">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>        // conceivably use `movl %reg, %reg` to zero out the top 32 bits of
</pre></div>


</blockquote>



<a name="195449896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449896">(Apr 27 2020 at 17:29)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170875" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401170875">PR Review</a>.</p>



<a name="195449898"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449898" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449898">(Apr 27 2020 at 17:29)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007592" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007592">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            collector.add_use(*dst); // yes, really `add_use`
</pre></div>


</blockquote>



<a name="195449934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449934">(Apr 27 2020 at 17:29)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401171099" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401171099">PR Review</a>.</p>



<a name="195449935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195449935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195449935">(Apr 27 2020 at 17:29)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007794" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416007794">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // serious error in the allocator or in our `get_regs` function.
</pre></div>


</blockquote>



<a name="195450101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450101">(Apr 27 2020 at 17:30)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401171923" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401171923">PR Review</a>.</p>



<a name="195450102"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450102" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450102">(Apr 27 2020 at 17:30)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416008583" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416008583">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// For an instruction that has as operands a register `encG` and a memory
// address `memE`, create and emit, first the REX prefix, then caller-supplied
// opcode byte(s) (`opcodes` and `numOpcodes`), then the MOD/RM byte, then
// optionally, a SIB byte, and finally optionally an immediate that will be
// derived from the `memE` operand.  For most instructions up to and including
// SSE4.2, that will be the whole instruction.
</pre></div>


</blockquote>



<a name="195450150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450150">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172280" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172280">PR Review</a>.</p>



<a name="195450151"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450151" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450151">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416008914" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416008914">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Get the encoding number from something which we sincerely hope is a real
/// register of class I64.
</pre></div>


</blockquote>



<a name="195450207"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450207" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450207">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172587" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172587">PR Review</a>.</p>



<a name="195450208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450208">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009270" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009270">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Emit the REX prefix byte even if it appears to be redundant (== 0x40).
</pre></div>


</blockquote>



<a name="195450221"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450221" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450221">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172707" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172707">PR Review</a>.</p>



<a name="195450222"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450222" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450222">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009405" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009405">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Set the W bit in the REX prefix to zero.  By default it will be set to 1,
/// indicating a 64-bit operation.
</pre></div>


</blockquote>



<a name="195450256"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450256" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450256">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172861" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401172861">PR Review</a>.</p>



<a name="195450257"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450257" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450257">(Apr 27 2020 at 17:31)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009527" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009527">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Add an 0x66 (operand-size override) prefix.  This is necessary to indicate
/// a 16-bit operation.  Normally this will be used together with F_CLEAR_REX_W.
</pre></div>


</blockquote>



<a name="195450326"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450326" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450326">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173184" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173184">PR Review</a>.</p>



<a name="195450328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450328">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009839" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416009839">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// then the caller should pass `opcodes` == 0xF3_0F_27 and `numOpcodes` == 3.
</pre></div>


</blockquote>



<a name="195450367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450367">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173483" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173483">PR Review</a>.</p>



<a name="195450368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450368">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010100" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010100">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// The register operand is represented here not as a `Reg` but as its hardware
// encoding, `encG`.  `flags` can specify special handling for the REX prefix.
</pre></div>


</blockquote>



<a name="195450384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450384">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173644" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173644">PR Review</a>.</p>



<a name="195450386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450386">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010237" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010237">PR Review Comment</a>:</p>
<blockquote>
<p>This should all be a doc comment.</p>
</blockquote>



<a name="195450398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450398">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173760" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173760">PR Review</a>.</p>



<a name="195450400"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450400" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450400">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010339" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010339">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // General comment for this function: the registers in `memE` must be
</pre></div>


</blockquote>



<a name="195450413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450413">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010456" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010456">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // expression.  But `encG` can be derived from a register of any class.
</pre></div>


</blockquote>



<a name="195450415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450415">(Apr 27 2020 at 17:32)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173890" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401173890">PR Review</a>.</p>



<a name="195450458"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450458" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450458">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174191" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174191">PR Review</a>.</p>



<a name="195450459"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450459" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450459">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010735" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010735">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// This is the core &#39;emit&#39; function for instructions that do not reference
/// memory.
///
/// This is conceptually the same as
/// emit_REX_OPCODES_MODRM_SIB_IMM_encG_memE, except it is for the case
/// where the E operand is a register rather than memory.  Hence it is much
/// simpler.
</pre></div>


</blockquote>



<a name="195450491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450491">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174442" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174442">PR Review</a>.</p>



<a name="195450493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450493">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010958" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416010958">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// These are merely wrappers for the above two functions that facilitate passing
/// actual `Reg`s rather than their encodings.
</pre></div>


</blockquote>



<a name="195450614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450614">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174627" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174627">PR Review</a>.</p>



<a name="195450616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450616">(Apr 27 2020 at 17:33)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011154" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011154">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // JRS FIXME 2020Feb07: this should really just be `regEnc` not `iregEnc`
</pre></div>


</blockquote>



<a name="195450724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450724">(Apr 27 2020 at 17:34)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174859" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174859">PR Review</a>.</p>



<a name="195450725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450725">(Apr 27 2020 at 17:34)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011385" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011385">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>    // JRS FIXME 2020Feb07: these should really just be `regEnc` not `iregEnc`
</pre></div>


</blockquote>



<a name="195450742"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450742" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450742">(Apr 27 2020 at 17:34)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174989" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401174989">PR Review</a>.</p>



<a name="195450743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195450743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195450743">(Apr 27 2020 at 17:34)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011529" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416011529">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// Write a suitable number of bits from an imm64 to the sink.
</pre></div>


</blockquote>



<a name="195451047"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451047" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451047">(Apr 27 2020 at 17:36)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401176867" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401176867">PR Review</a>.</p>



<a name="195451048"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451048" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451048">(Apr 27 2020 at 17:36)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416013296" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416013296">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>/// The top-level emit function.
///
/// Important!  Do not add improved (shortened) encoding cases to existing
/// instructions without also adding tests for those improved encodings.  That
/// is a dangerous game that leads to hard-to-track-down errors in the emitted
/// code.
///
/// For all instructions, make sure to have test coverage for all of the
/// following situations.  Do this by creating the cross product resulting from
/// applying the following rules to each operand:
///
/// (1) for any insn that mentions a register: one test using a register from
///     the group [rax, rcx, rdx, rbx, rsp, rbp, rsi, rdi] and a second one
///     using a register from the group [r8, r9, r10, r11, r12, r13, r14, r15].
///     This helps detect incorrect REX prefix construction.
///
/// (2) for any insn that mentions a byte register: one test for each of the
///     four encoding groups [al, cl, dl, bl], [spl, bpl, sil, dil],
///     [r8b .. r11b] and [r12b .. r15b].  This checks that
///     apparently-redundant REX prefixes are retained when required.
///
/// (3) for any insn that contains an immediate field, check the following
///     cases: field is zero, field is in simm8 range (-128 .. 127), field is
///     in simm32 range (-0x8000_0000 .. 0x7FFF_FFFF).  This is because some
///     instructions that require a 32-bit immediate have a short-form encoding
///     when the imm is in simm8 range.
///
/// Rules (1), (2) and (3) don&#39;t apply for registers within address expressions
/// (`Addr`s).  Those are already pretty well tested, and the registers in them
/// don&#39;t have any effect on the containing instruction (apart from possibly
/// require REX prefix bits).
///
/// When choosing registers for a test, avoid using registers with the same
/// offset within a given group.  For example, don&#39;t use rax and r8, since they
/// both have the lowest 3 bits as 000, and so the test won&#39;t detect errors
/// where those 3-bit register sub-fields are confused by the emitter.  Instead
/// use (eg) rax (lo3 = 000) and r9 (lo3 = 001).  Similarly, don&#39;t use (eg) cl
/// and bpl since they have the same offset in their group; use instead (eg) cl
/// and sil.
///
/// For all instructions, also add a test that uses only low-half registers
/// (rax .. rdi, xmm0 .. xmm7) etc, so as to check that any redundant REX
/// prefixes are correctly omitted.  This low-half restriction must apply to
/// _all_ registers in the insn, even those in address expressions.
///
/// Following these rules creates large numbers of test cases, but it&#39;s the
/// only way to make the emitter reliable.
///
/// Known possible improvements:
///
/// * there&#39;s a shorter encoding for shl/shr/sar by a 1-bit immediate.  (Do we
///   care?)
</pre></div>


</blockquote>



<a name="195451220"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451220" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451220">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401177895" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401177895">PR Review</a>.</p>



<a name="195451246"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451246" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451246">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014325" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014325">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// See comments at the top of `fn x64_emit` for advice on how to create
</pre></div>


</blockquote>



<a name="195451288"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451288" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451288">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401178105" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401178105">PR Review</a>.</p>



<a name="195451290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451290">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014537" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014537">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>// (cd cranelift/codegen &amp;&amp; \
</pre></div>


</blockquote>



<a name="195451334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451334">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401178498" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401178498">PR Review</a>.</p>



<a name="195451335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195451335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195451335">(Apr 27 2020 at 17:38)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014904" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416014904">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            // This insn is 6 bytes long.  Currently `offset` is relative to
</pre></div>


</blockquote>



<a name="195456346"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195456346" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195456346">(Apr 27 2020 at 18:21)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401212089" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401212089">PR Review</a>.</p>



<a name="195456347"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195456347" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195456347">(Apr 27 2020 at 18:21)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416045396" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416045396">PR Review Comment</a>:</p>
<blockquote>
<p>encoding-wise, <code>movzx</code> and <code>movsx</code> have such an encoding with <code>660f{b6,be}</code>. For example, <code>movzx ax, cl // 66 0f b6 c1</code>. I dunno if we're just not using them though.</p>
</blockquote>



<a name="195466388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195466388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195466388">(Apr 27 2020 at 19:49)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401274940" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401274940">PR Review</a>.</p>



<a name="195466389"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195466389" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195466389">(Apr 27 2020 at 19:49)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416101871" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416101871">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>            // Baldrdash expects the stack to take at least the number of words set in
</pre></div>


<p>Or maybe I'm misreading :)</p>
</blockquote>



<a name="195469501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195469501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195469501">(Apr 27 2020 at 20:16)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416117868" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416117868">PR Review Comment</a>:</p>
<blockquote>
<p>just making sure I'm following the intended direction: this will eventually have an <code>if call_conv.extends_windows_fastcall()</code> arm like the existing x86 abi code, correct?</p>
</blockquote>



<a name="195469502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195469502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195469502">(Apr 27 2020 at 20:16)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401292826" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401292826">PR Review</a>.</p>



<a name="195487278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195487278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195487278">(Apr 27 2020 at 23:29)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401397412" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401397412">PR Review</a>.</p>



<a name="195487279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195487279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195487279">(Apr 27 2020 at 23:29)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416218343" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416218343">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span>                sink.put1(mkModRegRM(1, encG &amp; 7, 5)); // could/?should? be encE &amp; 7 for consistency
                sink.put1(0x25);
                sink.put1((simm32 &amp; 0xFF) as u8);
</pre></div>


<p>and similar for <code>!low8WillSXto32()</code> would encode the <code>RBP</code>/<code>R13</code> variants that are currently missing here right? is there a wider reason this is <code>panic!</code>, or just "not gotten to it yet"?</p>
</blockquote>



<a name="195490227"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195490227" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195490227">(Apr 28 2020 at 00:17)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401414354" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401414354">PR Review</a>.</p>



<a name="195490228"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195490228" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195490228">(Apr 28 2020 at 00:17)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416236407" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416236407">PR Review Comment</a>:</p>
<blockquote>
<p>This means we can't encode <code>SHR 0, %rax</code> (sure fine) but more importantly that attempting to emit a <code>SHR 0, %rax</code> gets you <code>SHR %cl, %rax</code> instead! My understanding is that this is a level below anything a user would see from building a function in Cranelift IR, so it's still unlikely to trip across this, correct?</p>
</blockquote>



<a name="195522610"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522610" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522610">(Apr 28 2020 at 06:17)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401526350" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401526350">PR Review</a>.</p>



<a name="195522611"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522611" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522611">(Apr 28 2020 at 06:17)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416355573" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416355573">PR Review Comment</a>:</p>
<blockquote>
<p>I propose not to generate 16 bit operations (addw, etc) to the extent that it's possible to avoid them.  They put us at risk of partial register stalls.  Instead I plan to do as much 16-bit work as possible at 32 bit width, hence avoiding the stalls and also the need for the 66 prefix.</p>
</blockquote>



<a name="195522882"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522882" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522882">(Apr 28 2020 at 06:23)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401529250" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401529250">PR Review</a>.</p>



<a name="195522883"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522883" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522883">(Apr 28 2020 at 06:23)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416358151" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416358151">PR Review Comment</a>:</p>
<blockquote>
<p>Is this really a win?  IMO it wastes a lot of vertical screen space for minimal gain.  Sure, we can rustdoc <code>CC</code> itself, but I think the benefit of documenting the meaning of each individual item is not worth the loss of screen space.</p>
</blockquote>



<a name="195522977"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522977" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522977">(Apr 28 2020 at 06:25)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401530239" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401530239">PR Review</a>.</p>



<a name="195522978"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195522978" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195522978">(Apr 28 2020 at 06:25)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416359136" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416359136">PR Review Comment</a>:</p>
<blockquote>
<p>I'd prefer to retain the original. That makes it easy to figure out the encoding for each condition. With <code>self as u8</code> you have to count through the definition to find the encoding.</p>
</blockquote>



<a name="195523247"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523247" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523247">(Apr 28 2020 at 06:30)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401532847" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401532847">PR Review</a>.</p>



<a name="195523248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523248">(Apr 28 2020 at 06:30)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416361525" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416361525">PR Review Comment</a>:</p>
<blockquote>
<p>that sounds reasonable to me (pending if/when we might also optimize for size at least)</p>
<p>Do you know if decode stalls from 66-prefixed instructions with immediates are still a concern? At the least it might be helpful to note what is _intentionally_ not implemented, for future readers.</p>
</blockquote>



<a name="195523358"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523358" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523358">(Apr 28 2020 at 06:32)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401533704" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401533704">PR Review</a>.</p>



<a name="195523359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523359">(Apr 28 2020 at 06:32)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416362350" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416362350">PR Review Comment</a>:</p>
<blockquote>
<p>Hmm, I thought I had exhaustively tested this in the encoding test cases (there are 100+ amode encoding tests).  So I'm not convinced there's a missing case (am not convinced there isn't a missing case, either).  It's simple enough to shake out, by checking the encoding test cases.</p>
</blockquote>



<a name="195523923"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523923" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523923">(Apr 28 2020 at 06:41)</a>:</h4>
<p>iximeow submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401537837" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401537837">PR Review</a>.</p>



<a name="195523924"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195523924" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195523924">(Apr 28 2020 at 06:41)</a>:</h4>
<p>iximeow created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416366130" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416366130">PR Review Comment</a>:</p>
<blockquote>
<p>Ah, you're right - the initial checks against <code>R{BP,13}</code> had me looking for an else mentioning them, but they're encoded through the <code>if low8willSXto32(*simm32) &amp;&amp; encE != regs::ENC_RSP &amp;&amp; encE != regs::ENC_R12</code> case. There are a few tests for these such as for <a href="https://github.com/bytecodealliance/wasmtime/pull/1605/files/f44e562b0660ed38ec8f01c94bf07efe3d4fe5fc#diff-4543aa3149dc21a011981c094c49644bR987-R991" title="https://github.com/bytecodealliance/wasmtime/pull/1605/files/f44e562b0660ed38ec8f01c94bf07efe3d4fe5fc#diff-4543aa3149dc21a011981c094c49644bR987-R991"><code>127(%rbp)</code></a>.</p>
<p>How do you feel about upgrading this to an <code>unreachable!</code>?</p>
</blockquote>



<a name="195524402"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195524402" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195524402">(Apr 28 2020 at 06:48)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401541447" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401541447">PR Review</a>.</p>



<a name="195524403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195524403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195524403">(Apr 28 2020 at 06:48)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416369320" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416369320">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, it's the instruction selector's responsibility not to try to produce <code>shr $0, %reg</code>, but that's fine -- it can just emit no-instruction if it needs to do that -- which would in itself reflect incomplete cleanup at the CLIR level.  I guess it would be conceptually cleaner and safer change this so that the shift amount is an <code>Option&lt;u8&gt;</code> though; maybe we should do that.</p>
</blockquote>



<a name="195524428"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195524428" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195524428">(Apr 28 2020 at 06:48)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416369320" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416369320">PR Review Comment</a>.</p>



<a name="195530385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530385">(Apr 28 2020 at 08:03)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401591121" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401591121">PR Review</a>.</p>



<a name="195530387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530387">(Apr 28 2020 at 08:03)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416412014" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416412014">PR Review Comment</a>:</p>
<blockquote>
<p>Multiple single-byte nop insns, you mean?  Sure, you <em>can</em> do that, but that wastes front end resources.  Intel defines "official" no-ops with lengths at least 1 to 14 and maybe more (I forget).</p>
</blockquote>



<a name="195530525"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530525" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530525">(Apr 28 2020 at 08:04)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401592341" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401592341">PR Review</a>.</p>



<a name="195530526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530526">(Apr 28 2020 at 08:04)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416412983" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416412983">PR Review Comment</a>:</p>
<blockquote>
<p>I don't know the details (Benjamin surely will), but no doubt the intent exists to make it possible to support windows-specific ABIs as necessary.</p>
</blockquote>



<a name="195530626"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530626" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530626">(Apr 28 2020 at 08:05)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401593300" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401593300">PR Review</a>.</p>



<a name="195530627"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530627" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530627">(Apr 28 2020 at 08:05)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416413740" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416413740">PR Review Comment</a>:</p>
<blockquote>
<p>I would be the first to admit that the logic is pretty hard to follow there.  Er, if <code>unreachable!</code> is the right thing there, then use that.  Just so long as it really <em>is</em> unreachable.</p>
</blockquote>



<a name="195530683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195530683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195530683">(Apr 28 2020 at 08:06)</a>:</h4>
<p>julian-seward1 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416413740" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416413740">PR Review Comment</a>.</p>



<a name="195531278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195531278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195531278">(Apr 28 2020 at 08:13)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401598697" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401598697">PR Review</a>.</p>



<a name="195531279"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195531279" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195531279">(Apr 28 2020 at 08:13)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416418231" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416418231">PR Review Comment</a>:</p>
<blockquote>
<p>I don't know about decode stalls offhand; we'd have to consult the latest incarnation of the Intel "Optimisation Reference Manual".  Note though that I was speaking above of dispatch stalls, not decode stalls -- I forgot there might also be decode limitations till you mentioned it.</p>
<p>Yes, documenting the general intention to avoid generating 16-bit operations as much as possible would be a good thing to do.</p>
</blockquote>



<a name="195531511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195531511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195531511">(Apr 28 2020 at 08:15)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401600447" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401600447">PR Review</a>.</p>



<a name="195531512"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195531512" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195531512">(Apr 28 2020 at 08:15)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416419781" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416419781">PR Review Comment</a>:</p>
<blockquote>
<p>The previous suggestion explicitly assigns a discriminant to every variant. Otherwise this wouldn't even be correct, as 10 and 11 are skipped.</p>
</blockquote>



<a name="195544422"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544422" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544422">(Apr 28 2020 at 10:31)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401705637" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401705637">PR Review</a>.</p>



<a name="195544423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544423">(Apr 28 2020 at 10:31)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416506693" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416506693">PR Review Comment</a>:</p>
<blockquote>
<p>The function I'm modifying is called by the CLI flags parser, though; is there a way to pass target-specific flags through the CLI that I missed?</p>
</blockquote>



<a name="195544606"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544606" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544606">(Apr 28 2020 at 10:33)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401706913" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401706913">PR Review</a>.</p>



<a name="195544607"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544607" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544607">(Apr 28 2020 at 10:33)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416507759" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416507759">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed with Julian, there's an official selection of nop instructions for different sizes.</p>
</blockquote>



<a name="195544791"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544791" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544791">(Apr 28 2020 at 10:35)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401708133" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-401708133">PR Review</a>.</p>



<a name="195544792"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195544792" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195544792">(Apr 28 2020 at 10:35)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416508790" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r416508790">PR Review Comment</a>:</p>
<blockquote>
<p>Yes, that's the idea! We'd pass the <code>CallConv</code>, or we'd select different impl in the caller according to the given <code>CallConv</code> here, as done in <code>x86/abi.rs</code>.</p>
</blockquote>



<a name="195851938"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195851938" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195851938">(Apr 30 2020 at 15:02)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403608242" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403608242">PR Review</a>.</p>



<a name="195851939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195851939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195851939">(Apr 30 2020 at 15:02)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418077938" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418077938">PR Review Comment</a>:</p>
<blockquote>
<p>I'll punt on this one, it does break the symmetry with GPR, and it may require a bunch of changes all over the place.</p>
</blockquote>



<a name="195852527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195852527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195852527">(Apr 30 2020 at 15:05)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403611243" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403611243">PR Review</a>.</p>



<a name="195852529"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195852529" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195852529">(Apr 30 2020 at 15:05)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418080206" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418080206">PR Review Comment</a>:</p>
<blockquote>
<p>I'll assume no, then :)</p>
</blockquote>



<a name="195854691"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195854691" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195854691">(Apr 30 2020 at 15:18)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403622962" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403622962">PR Review</a>.</p>



<a name="195854692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195854692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195854692">(Apr 30 2020 at 15:18)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418089015" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418089015">PR Review Comment</a>:</p>
<blockquote>
<p>I heard screen space is free, so I'll take it!</p>
</blockquote>



<a name="195855484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195855484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195855484">(Apr 30 2020 at 15:23)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403627543" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403627543">PR Review</a>.</p>



<a name="195855486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195855486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195855486">(Apr 30 2020 at 15:23)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418092527" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418092527">PR Review Comment</a>:</p>
<blockquote>
<p>nice</p>
</blockquote>



<a name="195857649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195857649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195857649">(Apr 30 2020 at 15:37)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1605" title="https://github.com/bytecodealliance/wasmtime/pull/1605">PR #1605</a> from <code>rebase-x64</code> to <code>master</code>:</p>
<blockquote>
<p>This is a draft-ish PR containing a rebase of Julian's x64 work on the new isel backend, including quite a few refactorings of mine. During today's Cranelift meeting, we agreed that it might make sense to add the incomplete backend here, allowing incremental development by more contributors.</p>
<p>I've tried to split the files in a way that was similar to the aarch64 backend, but some things might still be wobbly; I might check this a bit further more tomorrow. Of course, that's also something we could do as follow-up PRs.</p>
<p>The new x64 backend is controlled by a new Cargo feature <code>x64</code> (which also requires <code>x86</code>). Then, users of <code>clif-util</code> can use the <code>--target x86_64</code> argument, and:</p>
<ul>
<li>get the code generated by the current isel (with legalization, Recipes, Encodings, etc.) and regalloc if nothing more is provided.</li>
<li>or add <code>--set use_new_backend</code> and this will use the new isel backend. (Expect panics, unimplemented errors, etc.)</li>
</ul>
<p>Second (small) commit is what allows passing ISA-specific flags to <code>--set</code>, which wasn't implemented yet.</p>
</blockquote>



<a name="195862409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195862409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195862409">(Apr 30 2020 at 16:08)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403667877" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403667877">PR Review</a>.</p>



<a name="195862410"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195862410" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195862410">(Apr 30 2020 at 16:08)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418123974" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418123974">PR Review Comment</a>:</p>
<blockquote>
<blockquote>
<p>it may require a bunch of changes all over the place.</p>
</blockquote>
<p>These functions are not exported from this module.</p>
<blockquote>
<p>I'll punt on this one, it does break the symmetry with GPR</p>
</blockquote>
<p>Fair enough</p>
</blockquote>



<a name="195862655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195862655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195862655">(Apr 30 2020 at 16:10)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403669346" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403669346">PR Review</a>.</p>



<a name="195862656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195862656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195862656">(Apr 30 2020 at 16:10)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418125153" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418125153">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>/// Actually codegens an instruction&#39;s results into registers.
</code></pre></div>


</blockquote>



<a name="195862671"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195862671" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195862671">(Apr 30 2020 at 16:10)</a>:</h4>
<p>bjorn3 deleted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418125153" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418125153">PR Review Comment</a>.</p>



<a name="195863482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195863482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195863482">(Apr 30 2020 at 16:16)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403674731" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403674731">PR Review</a>.</p>



<a name="195863484"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195863484" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195863484">(Apr 30 2020 at 16:16)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418129318" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418129318">PR Review Comment</a>:</p>
<blockquote>
<p>What about a <code>return</code> in the middle of a function? The current code would just fall through to the next instruction without ever inserting a <code>return</code>, right?</p>
</blockquote>



<a name="195863574"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195863574" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195863574">(Apr 30 2020 at 16:17)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403675427" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403675427">PR Review</a>.</p>



<a name="195863575"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195863575" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195863575">(Apr 30 2020 at 16:17)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418129852" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418129852">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>                    // `VMContext` is `r14` in Baldrdash.
</code></pre></div>


</blockquote>



<a name="195865132"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195865132" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195865132">(Apr 30 2020 at 16:29)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403684920" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403684920">PR Review</a>.</p>



<a name="195865133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195865133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195865133">(Apr 30 2020 at 16:29)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418137299" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418137299">PR Review Comment</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>    pub(crate) fn get_enc(self) -&gt; u8 {
        self as u8
</code></pre></div>


<p><code>CC</code> is copy</p>
</blockquote>



<a name="195882903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195882903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195882903">(Apr 30 2020 at 18:37)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403779615" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-403779615">PR Review</a>.</p>



<a name="195946179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195946179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195946179">(May 01 2020 at 09:55)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404094382" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404094382">PR Review</a>.</p>



<a name="195946180"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195946180" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195946180">(May 01 2020 at 09:55)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418484325" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418484325">PR Review Comment</a>:</p>
<blockquote>
<p>I'm sure this is handled correctly, although I am not exactly sure how.  The new backend and register allocators are block-order invariant; they can be presented with the blocks in any order; they don't care.  After regalloc is done, a final block order is chosen, branches which would be fallthroughs are removed, empty blocks are removed, and the prologue/epilogue machinery identify the entry/exit blocks and add the relevant extra insns.</p>
</blockquote>



<a name="195946312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195946312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195946312">(May 01 2020 at 09:57)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404094915" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404094915">PR Review</a>.</p>



<a name="195946313"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195946313" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195946313">(May 01 2020 at 09:57)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418484764" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418484764">PR Review Comment</a>:</p>
<blockquote>
<p>I mean how does it know that this is an exit block if there is no <code>ret</code> emitted?</p>
</blockquote>



<a name="195947838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195947838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195947838">(May 01 2020 at 10:21)</a>:</h4>
<p>julian-seward1 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404101996" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-404101996">PR Review</a>.</p>



<a name="195947839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/195947839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#195947839">(May 01 2020 at 10:21)</a>:</h4>
<p>julian-seward1 created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418490786" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r418490786">PR Review Comment</a>:</p>
<blockquote>
<p>You'd have to ask Chris or Benjamin for a definite answer, but .. I'm pretty sure it's because the higher level steering machinery in the new BE knows which CLIR-level blocks are exit blocks, so it knows which machine code blocks are exit blocks.</p>
</blockquote>



<a name="196307799"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196307799" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196307799">(May 05 2020 at 13:32)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-405790900" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-405790900">PR Review</a>.</p>



<a name="196307800"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196307800" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196307800">(May 05 2020 at 13:32)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r420111423" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r420111423">PR Review Comment</a>:</p>
<blockquote>
<p>Ha, interesting. Indeed it lacks the emission of <code>Ret</code>. This bug wouldn't be observable in spidermonkey since it uses the FallthroughRet, which means wasm returns in the middle of a function are translated into a jump to a single return block at the end of the function.</p>
</blockquote>



<a name="196310848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196310848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196310848">(May 05 2020 at 13:58)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-405815267" title="https://github.com/bytecodealliance/wasmtime/pull/1605#pullrequestreview-405815267">PR Review</a>.</p>



<a name="196310849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196310849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196310849">(May 05 2020 at 13:58)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r420130750" title="https://github.com/bytecodealliance/wasmtime/pull/1605#discussion_r420130750">PR Review Comment</a>:</p>
<blockquote>
<p>Taking this back: the actual <code>Ret</code> opcode for this is generated in <code>machinst/lower.rs</code>, in <code>gen_retval_setup</code>.</p>
</blockquote>



<a name="196311120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196311120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196311120">(May 05 2020 at 14:00)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1605" title="https://github.com/bytecodealliance/wasmtime/pull/1605">PR #1605</a> from <code>rebase-x64</code> to <code>master</code>:</p>
<blockquote>
<p>This is a draft-ish PR containing a rebase of Julian's x64 work on the new isel backend, including quite a few refactorings of mine. During today's Cranelift meeting, we agreed that it might make sense to add the incomplete backend here, allowing incremental development by more contributors.</p>
<p>I've tried to split the files in a way that was similar to the aarch64 backend, but some things might still be wobbly; I might check this a bit further more tomorrow. Of course, that's also something we could do as follow-up PRs.</p>
<p>The new x64 backend is controlled by a new Cargo feature <code>x64</code> (which also requires <code>x86</code>). Then, users of <code>clif-util</code> can use the <code>--target x86_64</code> argument, and:</p>
<ul>
<li>get the code generated by the current isel (with legalization, Recipes, Encodings, etc.) and regalloc if nothing more is provided.</li>
<li>or add <code>--set use_new_backend</code> and this will use the new isel backend. (Expect panics, unimplemented errors, etc.)</li>
</ul>
<p>Second (small) commit is what allows passing ISA-specific flags to <code>--set</code>, which wasn't implemented yet.</p>
</blockquote>



<a name="196316233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231605%20Stub%20of%20a%20new%20isel%20backend%20for%20x64/near/196316233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231605.20Stub.20of.20a.20new.20isel.20backend.20for.20x64.html#196316233">(May 05 2020 at 14:35)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1605" title="https://github.com/bytecodealliance/wasmtime/pull/1605">PR #1605</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>