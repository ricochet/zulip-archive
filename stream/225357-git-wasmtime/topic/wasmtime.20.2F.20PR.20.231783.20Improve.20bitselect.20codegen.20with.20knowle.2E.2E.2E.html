<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1783 Improve bitselect codegen with knowle... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html">wasmtime / PR #1783 Improve bitselect codegen with knowle...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="199095284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199095284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199095284">(May 28 2020 at 22:43)</a>:</h4>
<p>teapotd opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a> from <code>bitselect-blend</code> to <code>master</code>:</p>
<blockquote>
<p>This PR fixes #1187 and adds:</p>
<ul>
<li>encoding of <code>vselect</code> on x86 using <code>BLEND*</code> instructions</li>
<li>legalization of <code>vselect</code> to <code>bitselect</code></li>
<li>simple_preopt transformation that replaces <code>bitselect</code> with <code>vselect</code> if possible</li>
</ul>
<p>r? @abrown </p>
</blockquote>



<a name="199098934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199098934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199098934">(May 28 2020 at 23:38)</a>:</h4>
<p>teapotd updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a> from <code>bitselect-blend</code> to <code>master</code>:</p>
<blockquote>
<p>This PR fixes #1187 and adds:</p>
<ul>
<li>encoding of <code>vselect</code> on x86 using <code>BLEND*</code> instructions</li>
<li>legalization of <code>vselect</code> to <code>bitselect</code></li>
<li>simple_preopt transformation that replaces <code>bitselect</code> with <code>vselect</code> if possible</li>
</ul>
<p>r? @abrown </p>
</blockquote>



<a name="199210851"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210851" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210851">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#pullrequestreview-421269672">PR Review</a>.</p>



<a name="199210852"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210852" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210852">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#pullrequestreview-421269672">PR Review</a>.</p>



<a name="199210853"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210853" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210853">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#discussion_r432721561">PR Review Comment</a>:</p>
<blockquote>
<p>This and below can now use better syntax:</p>
<div class="codehilite"><pre><span></span><code>    v4 = vselect v1, v2, v3
    return v4
}
; run: %vselect_i8x16() == [200 101 202 103 204 105 106 107 108 109 210 211 212 213 214 215]
</code></pre></div>


<p>And, even better, could pass in the vectors in the run statement:</p>
<div class="codehilite"><pre><span></span><code>; run: %vselect_i8x16([...], [...], [...]) == [...]
~~~
</code></pre></div>


</blockquote>



<a name="199210854"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210854" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210854">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#discussion_r432723007">PR Review Comment</a>:</p>
<blockquote>
<p>nit: we might want to note here that using <code>bitselect</code> works because the entire lane is filled with 1s or 0s</p>
</blockquote>



<a name="199210855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210855">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#discussion_r432727671">PR Review Comment</a>:</p>
<blockquote>
<p>It might be good to use a couple of run tests as well just to make CI assure us that the optimization is running as expected.</p>
</blockquote>



<a name="199210856"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199210856" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199210856">(May 29 2020 at 20:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#discussion_r432729628">PR Review Comment</a>:</p>
<blockquote>
<p>I was puzzling over this for a while and I do understand now why this works; since <code>bitcast</code> was selecting at the bit level, we can safely select at the byte level in this optimization. In this code path we are going to bitcast our way to <code>vselect(B8x16, *8x16, *8x16)</code> every time, right?</p>
</blockquote>



<a name="199213197"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199213197" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199213197">(May 29 2020 at 21:16)</a>:</h4>
<p>teapotd submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#pullrequestreview-421292431">PR Review</a>.</p>



<a name="199213198"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199213198" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199213198">(May 29 2020 at 21:16)</a>:</h4>
<p>teapotd created <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#discussion_r432739330">PR Review Comment</a>:</p>
<blockquote>
<p>That's right, I'll add a comment with explanation to make it more clear.</p>
</blockquote>



<a name="199222304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199222304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199222304">(May 29 2020 at 22:57)</a>:</h4>
<p>teapotd updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a> from <code>bitselect-blend</code> to <code>master</code>:</p>
<blockquote>
<p>This PR fixes #1187 and adds:</p>
<ul>
<li>encoding of <code>vselect</code> on x86 using <code>BLEND*</code> instructions</li>
<li>legalization of <code>vselect</code> to <code>bitselect</code></li>
<li>simple_preopt transformation that replaces <code>bitselect</code> with <code>vselect</code> if possible</li>
</ul>
<p>r? @abrown </p>
</blockquote>



<a name="199223134"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199223134" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199223134">(May 29 2020 at 23:11)</a>:</h4>
<p>teapotd updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a> from <code>bitselect-blend</code> to <code>master</code>:</p>
<blockquote>
<p>This PR fixes #1187 and adds:</p>
<ul>
<li>encoding of <code>vselect</code> on x86 using <code>BLEND*</code> instructions</li>
<li>legalization of <code>vselect</code> to <code>bitselect</code></li>
<li>simple_preopt transformation that replaces <code>bitselect</code> with <code>vselect</code> if possible</li>
</ul>
<p>r? @abrown </p>
</blockquote>



<a name="199223451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199223451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199223451">(May 29 2020 at 23:17)</a>:</h4>
<p><strong>teapotd</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a>.</p>



<a name="199234236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199234236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199234236">(May 30 2020 at 02:52)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1783#pullrequestreview-421371851">PR Review</a>.</p>



<a name="199234248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231783%20Improve%20bitselect%20codegen%20with%20knowle.../near/199234248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231783.20Improve.20bitselect.20codegen.20with.20knowle.2E.2E.2E.html#199234248">(May 30 2020 at 02:53)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1783">PR #1783</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>