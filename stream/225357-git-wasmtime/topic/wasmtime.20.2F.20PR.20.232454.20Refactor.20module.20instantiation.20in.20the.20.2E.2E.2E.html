<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2454 Refactor module instantiation in the ... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html">wasmtime / PR #2454 Refactor module instantiation in the ...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="217962754"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/217962754" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#217962754">(Nov 26 2020 at 03:39)</a>:</h4>
<p>peterhuene opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set on which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="217963589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/217963589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#217963589">(Nov 26 2020 at 03:59)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218341230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341230">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541242362">PR Review</a>.</p>



<a name="218341231"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341231" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341231">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541242362">PR Review</a>.</p>



<a name="218341232"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341232" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341232">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532858798">PR Review Comment</a>:</p>
<blockquote>
<p>Would be nice to note something like "it is the wasmtime crate's responsibility to ensure that the allocator outlives this instance" or something of the sort.</p>
</blockquote>



<a name="218341233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341233">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532876948">PR Review Comment</a>:</p>
<blockquote>
<p>Why do we have both of these? I would have expected just <code>instance_allocator</code> (without the <code>Option</code>) which is initialized by default to <code>Arc::new(DefaultInstanceAllocator)</code>.</p>
</blockquote>



<a name="218341234"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341234" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341234">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532873861">PR Review Comment</a>:</p>
<blockquote>
<p>It isn't clear to me that implementations will ever do this initialization step differently. Do you expect it to change with instance pooling? If not, then I think we don't need to make <code>initialize</code> part of the trait.</p>
</blockquote>



<a name="218341235"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341235" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341235">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532877801">PR Review Comment</a>:</p>
<blockquote>
<p>And if we just had <code>instance_allocator</code>, then this code would simplify a bit as well.</p>
<p>But I feel like I'm missing some kind of context about why we have both (a comment above the field definitions in the <code>Config</code> struct would really help readers out here!)</p>
</blockquote>



<a name="218341236"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218341236" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218341236">(Nov 30 2020 at 20:28)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532882034">PR Review Comment</a>:</p>
<blockquote>
<p>The public version of the trait doesn't have any deallocation hooks? I don't see any mention of this in the RFC either. How is the instance pool supposed to recycle an instance's memory?</p>
</blockquote>



<a name="218348423"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348423" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348423">(Nov 30 2020 at 21:27)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541308380">PR Review</a>.</p>



<a name="218348424"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348424" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348424">(Nov 30 2020 at 21:27)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532914433">PR Review Comment</a>:</p>
<blockquote>
<p>I do expect there to be some differences with the allocator implementations with respect to table / linear memory initialization.  <code>userfaultfd</code> support can lazily initialize the pages, so it might simply take a reference on the initializers for later use, for example.</p>
</blockquote>



<a name="218348445"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348445" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348445">(Nov 30 2020 at 21:27)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541308510">PR Review</a>.</p>



<a name="218348447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348447">(Nov 30 2020 at 21:27)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532914540">PR Review Comment</a>:</p>
<blockquote>
<p>I'll add that comment for safety.</p>
</blockquote>



<a name="218348848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348848">(Nov 30 2020 at 21:30)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541310370">PR Review</a>.</p>



<a name="218348849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218348849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218348849">(Nov 30 2020 at 21:30)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532916002">PR Review Comment</a>:</p>
<blockquote>
<p>So the instance allocator is really meant for allocating <em>module</em> instances and not for the various "instantiations" Wasmtime does internally for representing host tables, memories, globals, and functions.</p>
<p>The "default" allocator is used exclusively for these internal instantiations as well as for module instantiations when a user does not provide an alternative instance allocator.</p>
<p>I can improve the comments around this to make that distinction clearer, but I'm also open to an alternative implementation.</p>
</blockquote>



<a name="218349185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218349185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218349185">(Nov 30 2020 at 21:32)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541311980">PR Review</a>.</p>



<a name="218349186"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218349186" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218349186">(Nov 30 2020 at 21:32)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532917280">PR Review Comment</a>:</p>
<blockquote>
<p>Agreed.  I can comment on why the config is storing both, but I'm definitely open to any suggestions you might have regarding a different approach for handling internal host object instantiations vs. module instantiations.</p>
<p>The end goal being that I don't want a pooling allocator to treat host objects as counting towards any limits placed on the total number of instances supported by the pool.</p>
</blockquote>



<a name="218349662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218349662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218349662">(Nov 30 2020 at 21:37)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541314576">PR Review</a>.</p>



<a name="218349663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218349663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218349663">(Nov 30 2020 at 21:37)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532919351">PR Review Comment</a>:</p>
<blockquote>
<p>The RFC doesn't change the lifetime semantics of module instances, so this trait doesn't need a <code>deallocate</code> method as it is assumed a store owns the returned instance.  When the store gets dropped, all associated instances will be deallocated like they are today.</p>
<p>This differs from the runtime <code>InstanceAllocator</code> trait as there's no concept of store there and handles are what are being allocated and deallocated.</p>
</blockquote>



<a name="218350022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218350022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218350022">(Nov 30 2020 at 21:40)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532919351">PR Review Comment</a>.</p>



<a name="218354939"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218354939" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218354939">(Nov 30 2020 at 22:22)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532941996">PR Review Comment</a>:</p>
<blockquote>
<p>I feel like I'm missing something or we are talking past each other, sorry: When a store is dropped, doesn't the instance pool need to know that each of the store's instance's memory ranges are available for reuse now?</p>
</blockquote>



<a name="218354940"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218354940" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218354940">(Nov 30 2020 at 22:22)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541342902">PR Review</a>.</p>



<a name="218355037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218355037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218355037">(Nov 30 2020 at 22:23)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541343324">PR Review</a>.</p>



<a name="218355038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218355038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218355038">(Nov 30 2020 at 22:23)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532942351">PR Review Comment</a>:</p>
<blockquote>
<p>Actually, I'm going to remove this field, along with the <code>initialize</code> and <code>dealloc</code> methods on <code>InstanceHandle</code> in favor of just calling on the allocator directly rather than shimming through the handle this way.</p>
</blockquote>



<a name="218356303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218356303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218356303">(Nov 30 2020 at 22:34)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532942351">PR Review Comment</a>.</p>



<a name="218357122"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218357122" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218357122">(Nov 30 2020 at 22:43)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541354321">PR Review</a>.</p>



<a name="218357123"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218357123" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218357123">(Nov 30 2020 at 22:43)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532951540">PR Review Comment</a>:</p>
<blockquote>
<p>It will via <code>InstanceHandle::dealloc</code> which is currently calling the associated allocator to deallocate the instance.  The pool then will know what associated memories and tables to put back on the free list.</p>
<p>I'm trying to remove the <code>allocator</code> field of <code>InstanceHandle</code> though since I don't like storing this unsafe back pointer to the allocator.</p>
</blockquote>



<a name="218357166"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218357166" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218357166">(Nov 30 2020 at 22:43)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532951540">PR Review Comment</a>.</p>



<a name="218357179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218357179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218357179">(Nov 30 2020 at 22:43)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532951540">PR Review Comment</a>.</p>



<a name="218358019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218358019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218358019">(Nov 30 2020 at 22:52)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541359535">PR Review</a>.</p>



<a name="218358021"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218358021" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218358021">(Nov 30 2020 at 22:52)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532955921">PR Review Comment</a>:</p>
<blockquote>
<p>Okay and that <code>dealloc</code> call fowards to <code>wasmtime_runtime::InstanceAllocator::deallocate</code>, but that doesn't have a corresponding method in the public <code>wasmtime::InstanceAllocator</code> trait. Do we expect the instance pool to use the internal <code>wasmtime-runtime</code> APIs instead of the public <code>wasmtime</code> APIs? Do we expect any implementations of <code>InstanceAllocator</code> other than the default and the instance pool? Do we expect to eventually add a <code>deallocate</code> method to <code>wasmtime::InstanceAllocator</code> as well?</p>
</blockquote>



<a name="218358734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218358734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218358734">(Nov 30 2020 at 23:00)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541363472">PR Review</a>.</p>



<a name="218358735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218358735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218358735">(Nov 30 2020 at 23:00)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532959270">PR Review Comment</a>:</p>
<blockquote>
<p>What I'd like to do is remove the <code>InstanceAllocator</code> and <code>DefaultInstanceAllocator</code> types from the <code>wasmtime</code> crate in favor of <code>Config</code> taking a <code>Arc&lt;dyn wasmtime_runtime::InstanceAllocator&gt;</code> directly.  This would both simply things and help me remove this back pointer from <code>wasmtime_runtime::Instance</code> to the allocator that created the instance so that deallocation can be handled directly from the drop implementation of <code>Store</code>.</p>
<p>I would then like to open up the construction of <code>wasmtime_runtime::Instance</code> and <code>wasmtime_runtime::InstanceHandle</code> such that instance allocators could be implemented in crates other than <code>wasmtime_runtime</code>.</p>
<p>However, given our stance on <code>wasmtime</code> being the crate we offer semantic versioning and <code>wasmtime_runtime</code> being an implementation details crate, I don't know if this is feasible to do.</p>
</blockquote>



<a name="218358891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218358891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218358891">(Nov 30 2020 at 23:02)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532959270">PR Review Comment</a>.</p>



<a name="218370776"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370776" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370776">(Dec 01 2020 at 01:31)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218370884"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370884" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370884">(Dec 01 2020 at 01:33)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541424406">PR Review</a>.</p>



<a name="218370885"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370885" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370885">(Dec 01 2020 at 01:33)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r533014603">PR Review Comment</a>:</p>
<blockquote>
<p>This field has now been removed.</p>
</blockquote>



<a name="218370948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370948">(Dec 01 2020 at 01:34)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541424590">PR Review</a>.</p>



<a name="218370949"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370949" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370949">(Dec 01 2020 at 01:34)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r533014801">PR Review Comment</a>:</p>
<blockquote>
<p>This field has now been removed.</p>
<p>Where instance handles are created for host objects, the default instance allocator is explicitly used with a comment.</p>
</blockquote>



<a name="218370969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370969">(Dec 01 2020 at 01:34)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541424722">PR Review</a>.</p>



<a name="218370970"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218370970" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218370970">(Dec 01 2020 at 01:34)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r533014946">PR Review Comment</a>:</p>
<blockquote>
<p>The config no longer stores both the configured instance allocator and the default allocator.</p>
</blockquote>



<a name="218371026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218371026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218371026">(Dec 01 2020 at 01:35)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-541425156">PR Review</a>.</p>



<a name="218371027"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218371027" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218371027">(Dec 01 2020 at 01:35)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r533015352">PR Review Comment</a>:</p>
<blockquote>
<p>I've went ahead with an enum-based solution to the problem as discussed on the RFC (which I'll be amending shortly).</p>
<p>As such, the <code>InstanceAllocator</code> trait has been removed from the <code>wasmtime</code> crate.</p>
</blockquote>



<a name="218371112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218371112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218371112">(Dec 01 2020 at 01:37)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r532914433">PR Review Comment</a>.</p>



<a name="218371664"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218371664" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218371664">(Dec 01 2020 at 01:46)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218472486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218472486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218472486">(Dec 01 2020 at 19:53)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218476736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218476736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218476736">(Dec 01 2020 at 20:27)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218479540"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218479540" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218479540">(Dec 01 2020 at 20:50)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This commit refactors module instantiation in the runtime to allow for<br>
different allocator implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>DefaultInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocator set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This commit also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218479642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218479642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218479642">(Dec 01 2020 at 20:51)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218480195"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218480195" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218480195">(Dec 01 2020 at 20:55)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218481779"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218481779" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218481779">(Dec 01 2020 at 21:07)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218627138"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627138" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627138">(Dec 02 2020 at 22:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-543279175">PR Review</a>.</p>



<a name="218627139"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627139" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627139">(Dec 02 2020 at 22:09)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-543279175">PR Review</a>.</p>



<a name="218627140"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627140" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627140">(Dec 02 2020 at 22:09)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r534515230">PR Review Comment</a>:</p>
<blockquote>
<p>FWIW <code>Box::new(SomeZst) as Box&lt;dyn Any&gt;</code> doesn't actually allocate anything, so if the purpose of this was to eschew allocations I think it's fine to leave this without the <code>Option</code>?</p>
</blockquote>



<a name="218627894"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627894" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627894">(Dec 02 2020 at 22:14)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-543282436">PR Review</a>.</p>



<a name="218627895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627895">(Dec 02 2020 at 22:14)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r534517864">PR Review Comment</a>:</p>
<blockquote>
<p>It wasn't to elide an allocation, but to take the host state out of the instance allocation request when creating the instance handle and passing the remainder of the request to <code>initialize_vmcontext</code>.</p>
<p>I'm happy to undo this change and just splat what's needed from the request as discrete arguments to <code>initialize_vmcontext</code>.</p>
</blockquote>



<a name="218627973"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218627973" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218627973">(Dec 02 2020 at 22:15)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r534517864">PR Review Comment</a>.</p>



<a name="218628628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218628628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218628628">(Dec 02 2020 at 22:22)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-543286713">PR Review</a>.</p>



<a name="218628630"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218628630" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218628630">(Dec 02 2020 at 22:22)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r534521372">PR Review Comment</a>:</p>
<blockquote>
<p>Ah ok that seems fine to leave as-is in that case!</p>
</blockquote>



<a name="218628685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218628685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218628685">(Dec 02 2020 at 22:22)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r534517864">PR Review Comment</a>.</p>



<a name="218754258"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754258" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754258">(Dec 03 2020 at 21:04)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="218754328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754328">(Dec 03 2020 at 21:05)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-544447685">PR Review</a>.</p>



<a name="218754330"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754330" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754330">(Dec 03 2020 at 21:05)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r535616802">PR Review Comment</a>:</p>
<blockquote>
<p>Given the latest changes to module linking which I've now rebased on, this is back to being <code>Box&lt;dyn Any&gt;</code>.</p>
</blockquote>



<a name="218754367"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754367" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754367">(Dec 03 2020 at 21:05)</a>:</h4>
<p><strong>peterhuene</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> as ready for review.</p>



<a name="218754643"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754643" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754643">(Dec 03 2020 at 21:07)</a>:</h4>
<p>peterhuene submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#pullrequestreview-544449649">PR Review</a>.</p>



<a name="218754644"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754644" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754644">(Dec 03 2020 at 21:07)</a>:</h4>
<p>peterhuene created <a href="https://github.com/bytecodealliance/wasmtime/pull/2454#discussion_r535620318">PR Review Comment</a>:</p>
<blockquote>
<p>Whoops, this comment accidentally got removed during the rebase.  Adding it back now.</p>
</blockquote>



<a name="218754821"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/218754821" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#218754821">(Dec 03 2020 at 21:09)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219176278"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219176278" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219176278">(Dec 08 2020 at 06:46)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219177022"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219177022" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219177022">(Dec 08 2020 at 07:03)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219262017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219262017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219262017">(Dec 08 2020 at 21:01)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219281344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219281344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219281344">(Dec 09 2020 at 00:03)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219376522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219376522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219376522">(Dec 09 2020 at 18:20)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219378169"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219378169" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219378169">(Dec 09 2020 at 18:32)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219926896"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219926896" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219926896">(Dec 15 2020 at 01:18)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="219926961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/219926961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#219926961">(Dec 15 2020 at 01:20)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="220082345"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/220082345" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#220082345">(Dec 16 2020 at 06:38)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="220170386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/220170386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#220170386">(Dec 16 2020 at 20:44)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="220172784"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/220172784" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#220172784">(Dec 16 2020 at 21:03)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="220175264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/220175264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#220175264">(Dec 16 2020 at 21:27)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="223697829"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/223697829" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#223697829">(Jan 22 2021 at 20:48)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="223698838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/223698838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#223698838">(Jan 22 2021 at 20:56)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="223699858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/223699858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#223699858">(Jan 22 2021 at 21:03)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="224524497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/224524497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#224524497">(Jan 29 2021 at 19:52)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="225105891"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225105891" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225105891">(Feb 04 2021 at 00:52)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
</blockquote>



<a name="225105931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225105931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225105931">(Feb 04 2021 at 00:53)</a>:</h4>
<p>peterhuene edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225106209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225106209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225106209">(Feb 04 2021 at 00:57)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225108029"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225108029" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225108029">(Feb 04 2021 at 01:21)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225108615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225108615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225108615">(Feb 04 2021 at 01:30)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225112855"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225112855" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225112855">(Feb 04 2021 at 02:44)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225222586"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225222586" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225222586">(Feb 04 2021 at 21:07)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225222737"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225222737" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225222737">(Feb 04 2021 at 21:08)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225223004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225223004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225223004">(Feb 04 2021 at 21:10)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225223593"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225223593" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225223593">(Feb 04 2021 at 21:15)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225225398"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225225398" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225225398">(Feb 04 2021 at 21:29)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225227017"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225227017" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225227017">(Feb 04 2021 at 21:40)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225357976"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225357976" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225357976">(Feb 05 2021 at 21:09)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225361204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225361204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225361204">(Feb 05 2021 at 21:37)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225363101"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225363101" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225363101">(Feb 05 2021 at 21:56)</a>:</h4>
<p>peterhuene updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a> from <code>instance-pooling</code> to <code>main</code>:</p>
<blockquote>
<p>This PR refactors module instantiation in the runtime to allow for<br>
different instance allocation strategy implementations.</p>
<p>It adds an <code>InstanceAllocator</code> trait with the current implementation put behind<br>
the <code>OnDemandInstanceAllocator</code> struct.</p>
<p>The Wasmtime API has been updated to allow a <code>Config</code> to have an instance<br>
allocation strategy set which will determine how instances get allocated.</p>
<p>This change is in preparation for an alternative <em>pooling</em> instance allocator<br>
that can reserve all needed host process address space in advance.</p>
<p>This PR also makes changes to the <code>wasmtime_environ</code> crate to represent<br>
compiled modules in a way that reduces copying at instantiation time.</p>
<p>See <a href="https://github.com/bytecodealliance/rfcs/issues/5">bytecodealliance/rfcs#5</a> about these proposed changes.</p>
<p>This PR depends on #2434.</p>
</blockquote>



<a name="225951200"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232454%20Refactor%20module%20instantiation%20in%20the%20.../near/225951200" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232454.20Refactor.20module.20instantiation.20in.20the.20.2E.2E.2E.html#225951200">(Feb 11 2021 at 05:48)</a>:</h4>
<p>peterhuene closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/2454">PR #2454</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>