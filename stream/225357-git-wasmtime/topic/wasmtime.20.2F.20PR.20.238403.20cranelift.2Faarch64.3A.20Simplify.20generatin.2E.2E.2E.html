<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8403 cranelift/aarch64: Simplify generatin... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html">wasmtime / PR #8403 cranelift/aarch64: Simplify generatin...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="434218613"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434218613" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434218613">(Apr 18 2024 at 18:40)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a> from <code>jameysharp:simplify-aarch64-constants</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>While reviewing #8393 I found the existing <code>load_constant64_full</code> function nearly incomprehensible, so I rewrote it. Besides having many fewer cases now, this should also fix part of the bug that #8393 addresses, but that PR fixes other issues as well.</p>
<p>This PR changes the operand size that we emit for some cases from 32-bit to 64-bit. In those cases, the operand size doesn't matter because we want the upper 32 bits to be zero. We set them that way with the initial instruction: widening <code>movz</code> from 32-bit to 64-bit doesn't change anything. And we preserve the upper bits with subsequent <code>movk</code> instructions, instead of zeroing them, but they were already zero.</p>
</blockquote>



<a name="434218614"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434218614" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434218614">(Apr 18 2024 at 18:40)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>.</p>



<a name="434218615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434218615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434218615">(Apr 18 2024 at 18:40)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>.</p>



<a name="434219192"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434219192" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434219192">(Apr 18 2024 at 18:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/8403#issuecomment-2064909693">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @cfallin, @fitzgen</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:aarch64", "isle"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>cfallin: isle</li>
<li>fitzgen: isle</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="434239438"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434239438" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434239438">(Apr 18 2024 at 21:12)</a>:</h4>
<p>jameysharp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>.</p>



<a name="434239747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434239747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434239747">(Apr 18 2024 at 21:14)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8403#issuecomment-2065336125">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>:</p>
<blockquote>
<p>#8393 landed so I've rebased this.</p>
<p>Also, I've switched to an implementation which I believe generates exactly the same instructions as the prior implementation in all cases. There are some choices we could make which would synthesize the same constants using a different sequence of instructions, but in almost all cases we'd produce the same number of instructions, so it doesn't make much difference. This algorithm is simple and produces readable disassembly listings so we might as well preserve the existing behavior.</p>
</blockquote>



<a name="434239778"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434239778" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434239778">(Apr 18 2024 at 21:15)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8403#pullrequestreview-2009914377">PR review</a>:</p>
<blockquote>
<p>Awesome!</p>
</blockquote>



<a name="434240038"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434240038" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434240038">(Apr 18 2024 at 21:17)</a>:</h4>
<p>jameysharp has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>.</p>



<a name="434244721"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238403%20cranelift/aarch64%3A%20Simplify%20generatin.../near/434244721" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238403.20cranelift.2Faarch64.3A.20Simplify.20generatin.2E.2E.2E.html#434244721">(Apr 18 2024 at 21:55)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8403">PR #8403</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>