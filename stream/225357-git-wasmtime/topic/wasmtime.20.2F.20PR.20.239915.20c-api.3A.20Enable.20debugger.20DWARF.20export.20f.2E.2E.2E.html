<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9915 c-api: Enable debugger DWARF export f... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html">wasmtime / PR #9915 c-api: Enable debugger DWARF export f...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="491267204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491267204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491267204">(Dec 30 2024 at 10:49)</a>:</h4>
<p>puremourning opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a> from <code>puremourning:c-api-debug-info</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In order to allow source level debugging of hosted webassembly code in C-based embeddings, we must enable the debug-builtins cargo feature when building the C api. This allows for embeddings of wasmtime in non-rust environments to benefit from the integration with <a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/JIT-Interface.html">gdb/lldb's JIT debug interface</a>.</p>
<p>Fixes #9909 </p>
<hr>
<p>Tests: I have tested this manually per the notes in the linked issue, and have single-stepped through the code to confirm it is behaving as I expect (I basically did a side-by side step through with an equivalent rust program linked with the default settings and <code>wasmtime</code> cargo dependency).</p>
<p>I took a look at the automated tests and the most obvious place to add a regression test is <code>tests/all/debug/lldb.rs</code> or <code>tests/all/debug/gdb.rs</code>. I haven't done this yet because I don't see any other places where the c-api is currently tested and wonder if it's even simple to build such a test. Let me know if there's a good path to adding something.</p>
</blockquote>



<a name="491267205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491267205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491267205">(Dec 30 2024 at 10:49)</a>:</h4>
<p><strong>puremourning</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>.</p>



<a name="491267206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491267206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491267206">(Dec 30 2024 at 10:49)</a>:</h4>
<p><strong>puremourning</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>.</p>



<a name="491267359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491267359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491267359">(Dec 30 2024 at 10:51)</a>:</h4>
<p>puremourning <a href="https://github.com/bytecodealliance/wasmtime/pull/9915#issuecomment-2565318488">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>:</p>
<blockquote>
<p>Well now, I see CI / Test C-API macos-latest in the CI runs.</p>
<p>I'll dig further on how this is done.</p>
</blockquote>



<a name="491270156"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270156" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270156">(Dec 30 2024 at 11:20)</a>:</h4>
<p>puremourning updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>.</p>



<a name="491270162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270162">(Dec 30 2024 at 11:20)</a>:</h4>
<p>puremourning <a href="https://github.com/bytecodealliance/wasmtime/pull/9915#issuecomment-2565351048">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>:</p>
<blockquote>
<p>OK I have a testing strategy. I can validate that the GDB structures are actually set up in the fib-debug/main.c.</p>
<p>It's a little tacky so I've added as a second commit. The strategy is to validate the actual <code>__jit_debug_descriptor</code> that's created is non-NULL after instantiation.</p>
<p>I have confirmed this test fails without my patch and passes with it.</p>
</blockquote>



<a name="491270194"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270194" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270194">(Dec 30 2024 at 11:20)</a>:</h4>
<p>puremourning edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/9915#issuecomment-2565351048">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>:</p>
<blockquote>
<p>OK I have a testing strategy. I can validate that the GDB structures are actually set up in the fib-debug/main.c.</p>
<p>It's a little hacky so I've added as a second commit. The strategy is to validate the actual <code>__jit_debug_descriptor</code> that's created is non-NULL after instantiation.</p>
<p>I have confirmed this test fails without my patch and passes with it.</p>
</blockquote>



<a name="491270237"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270237" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270237">(Dec 30 2024 at 11:21)</a>:</h4>
<p>puremourning edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/9915#issuecomment-2565351048">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>:</p>
<blockquote>
<p>OK I have a testing strategy. I can validate that the GDB structures are actually set up in the fib-debug/main.c.</p>
<p>It's a little hacky so I've added as a second commit. The strategy is to validate the actual <code>__jit_debug_descriptor</code> that's created is non-NULL after instantiation. As these examples are used by other people, I have gated the code with a compile definition that's only set during the tests.</p>
<p>I have confirmed this test fails without my patch and passes with it.</p>
</blockquote>



<a name="491270273"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270273" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270273">(Dec 30 2024 at 11:21)</a>:</h4>
<p>puremourning updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>.</p>



<a name="491270741"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491270741" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491270741">(Dec 30 2024 at 11:27)</a>:</h4>
<p>puremourning edited <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>:</p>
<blockquote>
<p>In order to allow source level debugging of hosted webassembly code in C-based embeddings, we must enable the debug-builtins cargo feature when building the C api. This allows for embeddings of wasmtime in non-rust environments to benefit from the integration with <a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/JIT-Interface.html">gdb/lldb's JIT debug interface</a>.</p>
<p>Fixes #9909 </p>
<hr>
<p>Tests: I have tested this manually per the notes in the linked issue, and have single-stepped through the code to confirm it is behaving as I expect (I basically did a side-by side step through with an equivalent rust program linked with the default settings and <code>wasmtime</code> cargo dependency).</p>
<p>For automated tests, I have a simple strategy: I can validate that the GDB structures are actually set up in the fib-debug/main.c. It's a little hacky so I've added as a second commit. The strategy is to validate the actual <code>__jit_debug_descriptor</code> that's created is non-NULL after instantiation. As these examples are used by other people, I have gated the code with a compile definition that's only set during the tests.</p>
<p>I have confirmed this test fails without my patch and passes with it.</p>
</blockquote>



<a name="491302544"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491302544" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491302544">(Dec 30 2024 at 16:33)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9915#pullrequestreview-2525776144">PR review</a>.</p>



<a name="491304486"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239915%20c-api%3A%20Enable%20debugger%20DWARF%20export%20f.../near/491304486" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239915.20c-api.3A.20Enable.20debugger.20DWARF.20export.20f.2E.2E.2E.html#491304486">(Dec 30 2024 at 16:51)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9915">PR #9915</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>