<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8554 build: add &quot;optimized&quot; profile for ru... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html">wasmtime / PR #8554 build: add &quot;optimized&quot; profile for ru...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="437106759"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437106759" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437106759">(May 05 2024 at 12:16)</a>:</h4>
<p><strong>dundargoc</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437106760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437106760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437106760">(May 05 2024 at 12:16)</a>:</h4>
<p><strong>dundargoc</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437106761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437106761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437106761">(May 05 2024 at 12:16)</a>:</h4>
<p>dundargoc opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a> from <code>dundargoc:build/performance</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This is extremely useful for cases where the default optimizations just<br>
are not enough.</p>
<p>Background: <a href="https://github.com/neovim/neovim">neovim</a> is interested to<br>
add wasmtime support in <a href="https://github.com/neovim/neovim/pull/28415">https://github.com/neovim/neovim/pull/28415</a> but<br>
we noticed that including wasmtime, even when not using wasmtime<br>
directly, heavily affects runtime performance. This is not only<br>
reflected in the increased startuptime but affects the runtime<br>
performance overall.</p>
<p>Here are the benchmarks for startuptimes for different configurations.<br>
Important to note is that all of runtime is affected, but the<br>
startuptime is a decent proxy to measure runtime performance:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">No</span><span class="w"> </span><span class="n">wasm</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">50.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.5</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">32.8</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.3</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">48.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">54.4</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">56</span><span class="w"> </span><span class="n">runs</span>

<span class="n">Wasm</span><span class="p">,</span><span class="w"> </span><span class="n">lto</span><span class="o">=</span><span class="n">thin</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:     <span class="mf">104.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.5</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">86.5</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.7</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">99.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="mf">111.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">26</span><span class="w"> </span><span class="n">runs</span>

<span class="n">Wasm</span><span class="p">,</span><span class="w"> </span><span class="n">lto</span><span class="o">=</span><span class="kc">true</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">83.8</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">2.5</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">65.8</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.1</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">80.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">93.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">31</span><span class="w"> </span><span class="n">runs</span>

<span class="n">Wasm</span><span class="p">,</span><span class="w"> </span><span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">incremental</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">53.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.5</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.5</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">50.6</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">55.5</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">54</span><span class="w"> </span><span class="n">runs</span>
</code></pre></div>
</blockquote>



<a name="437106762"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437106762" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437106762">(May 05 2024 at 12:16)</a>:</h4>
<p><strong>dundargoc</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437108289"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108289" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108289">(May 05 2024 at 12:41)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039681758">PR review</a>.</p>



<a name="437108290"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108290" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108290">(May 05 2024 at 12:41)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590301954">PR review comment</a>:</p>
<blockquote>
<p>This is already the default for release mode.</p>
</blockquote>



<a name="437108370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108370">(May 05 2024 at 12:42)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039683629">PR review</a>.</p>



<a name="437108371"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108371" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108371">(May 05 2024 at 12:42)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590302082">PR review comment</a>:</p>
<blockquote>
<p>Why disable debuginfo stripping when you don't enable debuginfo anyway?</p>
</blockquote>



<a name="437108571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108571">(May 05 2024 at 12:45)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590303585">PR review comment</a>:</p>
<blockquote>
<p>This can probably be enabled unconditionally for the c-api. We aren't catching panics on the C abi boundary, so they will abort anyway (or be UB until the <code>c_unwind</code> rustc feature is fully stabilized).</p>
</blockquote>



<a name="437108572"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108572" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108572">(May 05 2024 at 12:45)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039686713">PR review</a>.</p>



<a name="437108634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108634">(May 05 2024 at 12:46)</a>:</h4>
<p>clason submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039686880">PR review</a>.</p>



<a name="437108635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108635">(May 05 2024 at 12:46)</a>:</h4>
<p>clason created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590304190">PR review comment</a>:</p>
<blockquote>
<p>This strips more, though (symbols as well). We really need all these settings to close the gap to a build without wasmtime (we tested this).</p>
</blockquote>



<a name="437108683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108683">(May 05 2024 at 12:47)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039687089">PR review</a>.</p>



<a name="437108684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437108684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437108684">(May 05 2024 at 12:47)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590305105">PR review comment</a>:</p>
<blockquote>
<p><code>strip = "none"</code> strips neither debuginfo, nor symbols.</p>
</blockquote>



<a name="437109202"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437109202" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437109202">(May 05 2024 at 12:55)</a>:</h4>
<p>clason submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039688479">PR review</a>.</p>



<a name="437109203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437109203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437109203">(May 05 2024 at 12:55)</a>:</h4>
<p>clason created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590308698">PR review comment</a>:</p>
<blockquote>
<p>My mistake; I was reading this wrong (my own tests were with <code>true</code>).</p>
</blockquote>



<a name="437111079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437111079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437111079">(May 05 2024 at 13:21)</a>:</h4>
<p>dundargoc updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437111161"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437111161" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437111161">(May 05 2024 at 13:22)</a>:</h4>
<p>dundargoc submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039693212">PR review</a>.</p>



<a name="437111162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437111162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437111162">(May 05 2024 at 13:22)</a>:</h4>
<p>dundargoc created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590313422">PR review comment</a>:</p>
<blockquote>
<p>I benchmarked this and it seems strip does not seem to make difference. I'll remove it.</p>
</blockquote>



<a name="437111175"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437111175" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437111175">(May 05 2024 at 13:22)</a>:</h4>
<p>dundargoc updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437112229"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437112229" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437112229">(May 05 2024 at 13:36)</a>:</h4>
<p>dundargoc submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039695968">PR review</a>.</p>



<a name="437112230"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437112230" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437112230">(May 05 2024 at 13:36)</a>:</h4>
<p>dundargoc created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590316269">PR review comment</a>:</p>
<blockquote>
<p>I am getting the following warning</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
  <span class="err">`</span><span class="n">panic</span><span class="err">`</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="n">package</span><span class="err">`</span><span class="w"> </span><span class="n">profile</span>
</code></pre></div>
<p>It seems as though this is not possible based on the <a href="https://doc.rust-lang.org/cargo/reference/profiles.html#overrides">documentation</a>:</p>
<blockquote>
<p>Overrides cannot specify the <code>panic</code>, <code>lto</code>, or <code>rpath</code> settings.</p>
</blockquote>
</blockquote>



<a name="437130019"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437130019" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437130019">(May 05 2024 at 15:07)</a>:</h4>
<p><strong>dundargoc</strong> requested <a href="https://github.com/bjorn3">bjorn3</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437134177"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437134177" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437134177">(May 05 2024 at 15:24)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039720885">PR review</a>.</p>



<a name="437134178"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437134178" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437134178">(May 05 2024 at 15:24)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590339676">PR review comment</a>:</p>
<blockquote>
<p>I meant setting the <code>CARGO_PROFILE_&lt;profile name&gt;_PANIC="abort"</code> env var in <code>CMakeLists.txt</code> where <code>&lt;profile name&gt;</code> is either <code>DEV</code> or <code>RELEASE</code> depending on if <code>--release</code> was passed or not.</p>
</blockquote>



<a name="437141181"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437141181" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437141181">(May 05 2024 at 15:57)</a>:</h4>
<p>dundargoc updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<a name="437141204"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437141204" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437141204">(May 05 2024 at 15:57)</a>:</h4>
<p>dundargoc submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#pullrequestreview-2039728083">PR review</a>.</p>



<a name="437141205"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437141205" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437141205">(May 05 2024 at 15:57)</a>:</h4>
<p>dundargoc created <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#discussion_r1590346959">PR review comment</a>:</p>
<blockquote>
<p>Fixed</p>
</blockquote>



<a name="437292959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437292959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437292959">(May 06 2024 at 16:01)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096393574">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Thanks for the PR here! Is it possible perhaps for CMake to set environment variables for other steps? That's probably the best way to do this rather than adding a static profile. That way you'd be able to set <code>CARGO_PROFILE_RELEASE_*</code> to appropriate values and it can be customized per-project. Or perhaps could knobs be added to the CMake project in Wasmtime to set the env vars?</p>
<p>Otherwise though I also wanted to poke a bit about what the benchmark is. This is just starting a program that's not actually using Wasmtime at all? It's just changing how Wasmtime itself is linked in? If so it sounds like the main issue is that Wasmtime has lots of symbols and they may be all getting processed by the dynamic linker at startup. LTO will reduce the number of symbols, but there should be other knobs to internalize symbols in an executable or dynamic library such that LTO wouldn't be required to get the same performance benefits.</p>
</blockquote>



<a name="437294356"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437294356" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437294356">(May 06 2024 at 16:09)</a>:</h4>
<p>clason <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096408582">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<blockquote>
<p>Thanks for the PR here! Is it possible perhaps for CMake to set environment variables for other steps? That's probably the best way to do this rather than adding a static profile. That way you'd be able to set CARGO_PROFILE_RELEASE_* to appropriate values and it can be customized per-project.</p>
</blockquote>
<p>That's what we did before, but we thought that the preset could be used by other projects with similar needs.</p>
<blockquote>
<p>Otherwise though I also wanted to poke a bit about what the benchmark is. This is just starting a program that's not actually using Wasmtime at all? It's just changing how Wasmtime itself is linked in? </p>
</blockquote>
<p>That is correct.</p>
<blockquote>
<p>If so it sounds like the main issue is that Wasmtime has lots of symbols and they may be all getting processed by the dynamic linker at startup. LTO will reduce the number of symbols, but there should be other knobs to internalize symbols in an executable or dynamic library such that LTO wouldn't be required to get the same performance benefits.</p>
</blockquote>
<p>This is our thinking as well; if you know of such knobs, we'd be more than happy for the hint. Our own interface to wasmtime is extremely small (but we do link to tree-sitter, which uses more of it).</p>
</blockquote>



<a name="437294919"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437294919" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437294919">(May 06 2024 at 16:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096414558">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Ok sounds good, and a preset also sounds good to me!</p>
<p>Is this on macOS, Linux, Windows, or all three? This would likely be flags to the linker invocation that creates the neovim executable itself which would be along the lines of "only export this list of symbols and no more" and that would internalize everything else. Is it possible to construct a list like that, for example is <code>main</code> the only symbol that's necessary? Or are plugins dlopen'd which need to reach into internal symbols?</p>
</blockquote>



<a name="437296328"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437296328" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437296328">(May 06 2024 at 16:20)</a>:</h4>
<p>clason <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096429351">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>All three and more (as many as we can build on), with a wide range of compilers. We use only a very limited set (basically, <code>wasm_engine_{new,delete}</code>, but we link to tree-sitter which uses more (which I don't know off the top of my head). </p>
</blockquote>



<a name="437296646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437296646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437296646">(May 06 2024 at 16:22)</a>:</h4>
<p>clason edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096429351">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>All three and more (as many as we can build on), with a wide range of compilers. We use only a very limited set (basically, <code>wasm_engine_{new,delete}</code>), but we link to tree-sitter which uses more (which I don't know off the top of my head). </p>
</blockquote>



<a name="437298526"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437298526" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437298526">(May 06 2024 at 16:32)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096449766">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Oh sorry, to clarify, is the performance regression you're seeing on all platforms? Or only some?</p>
</blockquote>



<a name="437298769"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437298769" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437298769">(May 06 2024 at 16:34)</a>:</h4>
<p>clason <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096451933">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>So far we have mostly tested with macOS; of course the exact impact varies with platform and toolchain.</p>
</blockquote>



<a name="437313482"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437313482" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437313482">(May 06 2024 at 18:12)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096629752">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>I'm trying to test my theory with a <a href="https://gist.github.com/alexcrichton/0e25ee8ef950bb21f61f7ff326a0fe3c">small script</a> but it's not too successful. The big binaries are slower but they don't get faster when removing the symbols so I don't think this going to bear fruit.</p>
<p>Regardless though I think it's fine to land this, but on reviewing it I think it might be best to call this "lto" in the various places instead of "optimized". I want to avoid confusion between "optimized" and <code>--release</code> builds since both are runtime-wise pretty equally optimized, and "lto" is the main differentiating factor here.</p>
</blockquote>



<a name="437315998"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437315998" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437315998">(May 06 2024 at 18:30)</a>:</h4>
<p>clason <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096657976">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>I appreciate your testing! Not married to the name, of course, but note that full LTO is only half the game here -- you also need the other settings for the "optimal" benefit. Unless you consider codegen-units to be part of LTO? Then it'd obviously make sense. </p>
</blockquote>



<a name="437316495"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437316495" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437316495">(May 06 2024 at 18:33)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096664370">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>That's true yeah. I suppose I'm mostly looking for a name that evokes something like "pull out all the stops on optimizing this I'm willing to wait for an hour". That typically includes lto and codegen-units=1. I personally consider "lto" as "take your time please optimize this as much as you can" but that's also just me.</p>
<p>Also, question for y'all, does codegen-units=1 help much here in isolation? If that setting is dropped do you see a difference in perf? I ask because that should only affect generated code quality, not symbol visibility. If codegen-units=1 does help then the mystery deepens in my head for what's going on here (PR can land either way of course, I'm just curious now!)</p>
</blockquote>



<a name="437321470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437321470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437321470">(May 06 2024 at 19:06)</a>:</h4>
<p>clason <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096715916">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Yes it does! (We benchmarked each option -- @dundargoc could you edit the PR description to add the individual steps?)</p>
<p>And it's _very_ weird -- but then I don't know any other large C project that statically links a Rust dependency (and we have been quite reticent about it im the past). </p>
<p>If LTO has the full connotation for you, that's fine with us of course!</p>
</blockquote>



<a name="437325136"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437325136" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437325136">(May 06 2024 at 19:31)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096759885">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Odd! Well in any case happy to r+ and flag for merge with a rename.</p>
<p>Otherwise though if y'all have a series of instructions to reproduce this slowdown I'd be happy to try to dig further in my spare time later.</p>
</blockquote>



<a name="437337523"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437337523" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437337523">(May 06 2024 at 21:05)</a>:</h4>
<p>dundargoc <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096916766">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>This is the benchmarking we did to determine which of the flags seemed to make a difference:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">--</span><span class="n">release</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:     <span class="mf">132.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">114.5</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.3</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:   <span class="mf">122.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="mf">137.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">22</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">83.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">66.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">80.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">86.8</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">63.6</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">2.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">64.0</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.7</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.0</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.2</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.2</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.8</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">49.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">56.4</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">51</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span><span class="p">,</span><span class="w"> </span><span class="n">incremental</span><span class="o">=</span><span class="kc">false</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.4</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">50.4</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">54.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">52</span><span class="w"> </span><span class="n">runs</span>
</code></pre></div>
<p>So from this we were able to see that <code>lto</code> and <code>panic</code> makes the biggest difference, and that <code>codegen-units=1</code> does make a small yet noticable difference as well. Note that @clason noticed a bigger difference for <code>codegen-units=1</code> on his intel macos, so it could be platform-dependent as well?</p>
<hr>
<p>As for the name, I am fine with whatever. <code>lto</code> is just fine. For reference, we got these flags from <a href="https://github.com/Kobzol/cargo-wizard">cargo-wizard</a> and the configuration for this was called <code>fast-runtime</code>. So perhaps that is also a viable profile name? In any case, I'm fine with either, just lemme know what you want me to change it to.</p>
</blockquote>



<a name="437337550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437337550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437337550">(May 06 2024 at 21:05)</a>:</h4>
<p>dundargoc edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096916766">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>This is the benchmarking we did to determine which of the flags seemed to make a difference:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">--</span><span class="n">release</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:     <span class="mf">132.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">114.5</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.3</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:   <span class="mf">122.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="mf">137.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">22</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">83.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">66.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">80.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">86.8</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">63.6</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">2.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">64.0</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.7</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.0</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.2</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.2</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.8</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">49.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">56.4</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">51</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span><span class="p">,</span><span class="w"> </span><span class="n">incremental</span><span class="o">=</span><span class="kc">false</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.4</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">50.4</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">54.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">52</span><span class="w"> </span><span class="n">runs</span>
</code></pre></div>
<p>So from this we were able to see that <code>lto</code> and <code>panic</code> makes the biggest difference, and that <code>codegen-units=1</code> does make a small yet noticable difference as well. Note that @clason noticed a bigger difference for <code>codegen-units=1</code> on his intel macos, so it could be platform-dependent as well?</p>
<hr>
<p>As for the profile name, I am fine with whatever. <code>lto</code> is just fine. For reference, we got these flags from <a href="https://github.com/Kobzol/cargo-wizard">cargo-wizard</a> and the configuration for this was called <code>fast-runtime</code>. So perhaps that is also a viable profile name? In any case, I'm fine with either, just lemme know what you want me to change it to.</p>
</blockquote>



<a name="437337663"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437337663" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437337663">(May 06 2024 at 21:06)</a>:</h4>
<p>dundargoc edited a <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096916766">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>This is the benchmarking we did to determine which of the flags seemed to make a difference:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">--</span><span class="n">release</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:     <span class="mf">132.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">3.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">114.5</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.3</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:   <span class="mf">122.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="mf">137.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">22</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">83.5</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">66.3</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">80.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">86.8</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.7</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">63.6</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.9</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.3</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.3</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">80.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">2.0</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">64.0</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">77.1</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">84.7</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">34</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.0</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.2</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.2</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">11.8</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">49.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">56.4</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">51</span><span class="w"> </span><span class="n">runs</span>

<span class="n">lto</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">codegen</span><span class="o">-</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">strip</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">panic</span><span class="o">=</span><span class="s">"abort"</span><span class="p">,</span><span class="w"> </span><span class="n">incremental</span><span class="o">=</span><span class="kc">false</span>
<span class="w">  </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="err">σ</span><span class="p">)</span>:      <span class="mf">52.9</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w">   </span><span class="mf">1.1</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="p">[</span><span class="n">User</span>: <span class="mf">35.4</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">System</span>: <span class="mf">12.0</span><span class="w"> </span><span class="n">ms</span><span class="p">]</span>
<span class="w">  </span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">max</span><span class="p">)</span>:    <span class="mf">50.4</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="mf">54.9</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="mi">52</span><span class="w"> </span><span class="n">runs</span>
</code></pre></div>
<p>So from this we were able to see that <code>lto</code> and <code>panic</code> makes the biggest difference, and that <code>codegen-units=1</code> does make a small yet noticable difference as well. Note that @clason noticed a bigger difference for <code>codegen-units=1</code> on his intel macos, so it could be platform-dependent as well.</p>
<hr>
<p>As for the profile name, I am fine with whatever. <code>lto</code> is just fine. For reference, we got these flags from <a href="https://github.com/Kobzol/cargo-wizard">cargo-wizard</a> and the configuration for this was called <code>fast-runtime</code>. So perhaps that is also a viable profile name? In any case, I'm fine with either, just lemme know what you want me to change it to.</p>
</blockquote>



<a name="437338488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437338488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437338488">(May 06 2024 at 21:11)</a>:</h4>
<p>dundargoc <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096926335">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>Oh, right. Reproduction steps. We build neovim in <a href="https://github.com/neovim/neovim/pull/28415">this</a> PR with the following command:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>make<span class="w"> </span>distclean<span class="w"> </span><span class="c1">#just to remove old builds</span>
make<span class="w"> </span><span class="nv">CMAKE_EXTRA_FLAGS</span><span class="o">=</span>-DENABLE_WASMTIME<span class="o">=</span>ON<span class="w"> </span><span class="nv">DEPS_CMAKE_FLAGS</span><span class="o">=</span>-DENABLE_WASMTIME<span class="o">=</span>ON<span class="w"> </span><span class="nv">CMAKE_BUILD_TYPE</span><span class="o">=</span>Release
cmake<span class="w"> </span>--install<span class="w"> </span>build<span class="w"> </span>--prefix<span class="w"> </span>bin
hyperfine<span class="w"> </span>--warmup<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">"bin/bin/nvim +'quit'"</span>
</code></pre></div>
<p>I point to a local path of wasmtime in <code>cmake.deps/deps.txt</code> so it says </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">WASMTIME_URL</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">dundargoc</span><span class="o">/</span><span class="n">programs</span><span class="o">/</span><span class="n">wasmtime</span>
</code></pre></div>
<p>It's not the most graceful reproductions steps I'm afraid but that's the current tech we're working with at the moment <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
</blockquote>



<a name="437342357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437342357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437342357">(May 06 2024 at 21:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096963476">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>"fast-runtime" sounds reasonable to me, although I might bikeshed to "fastest-runtime" perhaps to help head off confusion between the default <code>--release</code> and "fast-runtime" where they're both supposed to be fast</p>
</blockquote>



<a name="437342448"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437342448" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437342448">(May 06 2024 at 21:35)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8554#issuecomment-2096964467">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>:</p>
<blockquote>
<p>And no worries! I'll try to kick the tires there and see if I can't bottom something out as to how Wasmtime is affecting things</p>
</blockquote>



<a name="437350511"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238554%20build%3A%20add%20%22optimized%22%20profile%20for%20ru.../near/437350511" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238554.20build.3A.20add.20.22optimized.22.20profile.20for.20ru.2E.2E.2E.html#437350511">(May 06 2024 at 22:57)</a>:</h4>
<p>dundargoc updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8554">PR #8554</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>