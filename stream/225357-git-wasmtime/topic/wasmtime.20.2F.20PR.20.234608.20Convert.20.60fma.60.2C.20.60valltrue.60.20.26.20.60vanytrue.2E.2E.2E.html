<html>
<head><meta charset="utf-8"><title>wasmtime / PR #4608 Convert `fma`, `valltrue` &amp; `vanytrue... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html">wasmtime / PR #4608 Convert `fma`, `valltrue` &amp; `vanytrue...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="292006359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292006359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292006359">(Aug 04 2022 at 13:23)</a>:</h4>
<p>dheaton-arm opened <a href="https://github.com/bytecodealliance/wasmtime/pull/4608">PR #4608</a> from <code>isle-fma</code> to <code>main</code>:</p>
<blockquote>
<p>Ported the existing implementations of the following opcodes to ISLE on<br>
AArch64:</p>
<ul>
<li>
<p><code>fma</code></p>
<ul>
<li>Introduced missing support for <code>fma</code> on vector values, as per the<br>
  docs.</li>
</ul>
</li>
<li>
<p><code>valltrue</code></p>
</li>
<li><code>vanytrue</code></li>
</ul>
<p>Also fixed <code>fcmp</code> on scalar values in the interpreter, and enabled<br>
interpreter tests in <code>simd-fma.clif</code>.</p>
<p>This introduces the <code>FMLA</code> machine instruction.</p>
<p>Copyright (c) 2022 Arm Limited</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="292006869"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292006869" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292006869">(Aug 04 2022 at 13:27)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#pullrequestreview-1061893410">PR review</a>.</p>



<a name="292006870"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292006870" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292006870">(Aug 04 2022 at 13:27)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#discussion_r937780279">PR review comment</a>:</p>
<blockquote>
<p><code>fma</code> is somewhat broken in the interpreter for the <code>x86_64-pc-windows-gnu</code> target (see #4517 for more details). We have a smaller subset of fma tests for the interpreter in a separate file.</p>
</blockquote>



<a name="292007319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292007319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292007319">(Aug 04 2022 at 13:30)</a>:</h4>
<p>afonso360 created <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#discussion_r937784194">PR review comment</a>:</p>
<blockquote>
<p>Although it looks like we don't have those problematic inputs in this test file, so the tests will probably pass.</p>
</blockquote>



<a name="292007320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292007320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292007320">(Aug 04 2022 at 13:30)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#pullrequestreview-1061900618">PR review</a>.</p>



<a name="292009842"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292009842" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292009842">(Aug 04 2022 at 13:49)</a>:</h4>
<p>afonso360 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#pullrequestreview-1061944989">PR review</a>.</p>



<a name="292034656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292034656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292034656">(Aug 04 2022 at 16:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#pullrequestreview-1062185719">PR review</a>.</p>



<a name="292034657"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292034657" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292034657">(Aug 04 2022 at 16:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#pullrequestreview-1062185719">PR review</a>.</p>



<a name="292034659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292034659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292034659">(Aug 04 2022 at 16:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#discussion_r938032252">PR review comment</a>:</p>
<blockquote>
<p>Could we add a comment here (and also on <code>bsl</code> while we're at it) to note that the opcode must only be used with the <code>vec_rrr_inplace</code> constructor?</p>
<p>(Note below on a better approach here by separating the types for safety, but we don't need to do it right away)</p>
</blockquote>



<a name="292034660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292034660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292034660">(Aug 04 2022 at 16:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#discussion_r937975581">PR review comment</a>:</p>
<blockquote>
<p>Hmm, I'm not too happy about the conditional-mod here, but it's pre-existing, so I won't ask you to do anything in this PR. But noting it regardless: it would be better to split the case out to a new enum arm (<code>VecRRRMod</code>?) and then make the sub-opcode enum separate (<code>VecALUOp</code> / <code>VecALUModOp</code> maybe?) for more safety at the type level. (If you want to tackle that in a followup PR, I'd be happy to review!)</p>
</blockquote>



<a name="292034661"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292034661" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292034661">(Aug 04 2022 at 16:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/4608#discussion_r937960192">PR review comment</a>:</p>
<blockquote>
<p>the <code>src_dst</code> here is actually a pure source, since we move out of it below, right? Could we call it <code>src1</code> instead for clarity?</p>
</blockquote>



<a name="292126393"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292126393" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292126393">(Aug 05 2022 at 09:06)</a>:</h4>
<p>dheaton-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/4608">PR #4608</a> from <code>isle-fma</code> to <code>main</code>.</p>



<a name="292179787"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%234608%20Convert%20%60fma%60%2C%20%60valltrue%60%20%26%20%60vanytrue.../near/292179787" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.234608.20Convert.20.60fma.60.2C.20.60valltrue.60.20.26.20.60vanytrue.2E.2E.2E.html#292179787">(Aug 05 2022 at 16:47)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/4608">PR #4608</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>