<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8506 cranelift: Compress vcode range-lists · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html">wasmtime / PR #8506 cranelift: Compress vcode range-lists</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="436131933"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436131933" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436131933">(Apr 29 2024 at 20:20)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8506">PR #8506</a> from <code>jameysharp:compress-range-lists</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>These lists of ranges always cover contiguous ranges of an index space, meaning the start of one range is the same as the end of the previous range, so we can cut storage in half by only storing one endpoint of each range.</p>
<p>This in turn means we don't have to keep track of the other endpoint while building these lists, reducing the state we need to keep while building vcode and simplifying the various build steps.</p>
</blockquote>



<a name="436131934"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436131934" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436131934">(Apr 29 2024 at 20:20)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8506">PR #8506</a>.</p>



<a name="436131935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436131935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436131935">(Apr 29 2024 at 20:20)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8506">PR #8506</a>.</p>



<a name="436133582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436133582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436133582">(Apr 29 2024 at 20:30)</a>:</h4>
<p>jameysharp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8506">PR #8506</a>.</p>



<a name="436150374"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436150374" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436150374">(Apr 29 2024 at 22:20)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#pullrequestreview-2029749292">PR review</a>.</p>



<a name="436150375"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436150375" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436150375">(Apr 29 2024 at 22:20)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#pullrequestreview-2029749292">PR review</a>.</p>



<a name="436150376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436150376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436150376">(Apr 29 2024 at 22:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#discussion_r1583845105">PR review comment</a>:</p>
<blockquote>
<p>Why ignore?</p>
</blockquote>



<a name="436150378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436150378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436150378">(Apr 29 2024 at 22:20)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#discussion_r1583847868">PR review comment</a>:</p>
<blockquote>
<p>Can we add some typed indices for <code>Ranges</code>? Or reuse <code>cranelift_entity::Entity</code>?</p>
<p>I've always been slightly nervous about all of our raw indices in the backends.</p>
</blockquote>



<a name="436152632"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436152632" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436152632">(Apr 29 2024 at 22:38)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#pullrequestreview-2029762165">PR review</a>.</p>



<a name="436152633"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436152633" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436152633">(Apr 29 2024 at 22:38)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#discussion_r1583853551">PR review comment</a>:</p>
<blockquote>
<p>Because doc-tests don't work in non-public types, since they're compiled in a separate crate. I couldn't figure out a better way to document what these methods do than with code, so doc-test style seemed good, but didn't quite work how I wanted. I did build this with the module made public and the doc-tests un-ignored, and verified that they pass. </p>
</blockquote>



<a name="436152634"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436152634" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436152634">(Apr 29 2024 at 22:38)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#pullrequestreview-2029762165">PR review</a>.</p>



<a name="436152635"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436152635" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436152635">(Apr 29 2024 at 22:38)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#discussion_r1583859108">PR review comment</a>:</p>
<blockquote>
<p>I guess we could add some sort of type-system tagging, but what we have now is <code>usize</code> almost everywhere this is used, so it would be noisy.</p>
<p>That said, I had wanted to somehow associate each instance of <code>Ranges</code> with the <code>Vec</code> or <code>Ranges</code> that it indexes. I couldn't figure out a good way to do that, but putting a newtype wrapper around the indexes could work, with some helpers.</p>
<p>I'd prefer to land this without that change, since I believe it's easier to understand and no less safe than the _status quo_, but I do think this is worth thinking about more.</p>
</blockquote>



<a name="436595947"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436595947" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436595947">(May 02 2024 at 00:39)</a>:</h4>
<p>elliottt submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8506#pullrequestreview-2034651696">PR review</a>:</p>
<blockquote>
<p>This is a really nice change!</p>
</blockquote>



<a name="436619383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238506%20cranelift%3A%20Compress%20vcode%20range-lists/near/436619383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238506.20cranelift.3A.20Compress.20vcode.20range-lists.html#436619383">(May 02 2024 at 05:32)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8506">PR #8506</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>