<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9737 winch: Epoch-based interruption · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html">wasmtime / PR #9737 winch: Epoch-based interruption</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="486199493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486199493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486199493">(Dec 04 2024 at 23:55)</a>:</h4>
<p>saulecabrera opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a> from <code>saulecabrera:winch-epoch</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Closes <a href="https://github.com/bytecodealliance/wasmtime/issues/8091">https://github.com/bytecodealliance/wasmtime/issues/8091</a></p>
<p>This commit introduces support for epoch interruption to Winch. The heuristics around epoch check emission are identical to Cranelift's except for the fact that the current implementation doesn't introduce a local-based cache for the current epoch deadline. This is an intentional decision given Winch's focus on compilation performance. However, if needed in the future, knobs could be introduced to optionally introduce a local cache at the cost of reduced compilation performance.</p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="486199497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486199497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486199497">(Dec 04 2024 at 23:55)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486199498"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486199498" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486199498">(Dec 04 2024 at 23:55)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486199500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486199500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486199500">(Dec 04 2024 at 23:55)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486199501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486199501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486199501">(Dec 04 2024 at 23:55)</a>:</h4>
<p><strong>saulecabrera</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486212365"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486212365" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486212365">(Dec 05 2024 at 02:16)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#issuecomment-2518938882">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @fitzgen, @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "fuzzing", "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>fitzgen: fuzzing</li>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="486377333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486377333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486377333">(Dec 05 2024 at 19:17)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#pullrequestreview-2482640598">PR review</a>:</p>
<blockquote>
<p>Looks great! Just a couple nitpicks inline.</p>
<p>Also I know that most of the testing will be covered by fuzzing and the existing epoch tests, but it may make sense to throw in a single disas test with epochs enabled as well that contains a some <code>if</code>s, <code>block</code>s, and a <code>loop</code> just to show that we insert epoch checks only on the loop headers and body prologue. Could also be used to see that deadlines are actually cached, if we ever get around to doing that here.</p>
</blockquote>



<a name="486377334"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486377334" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486377334">(Dec 05 2024 at 19:17)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#discussion_r1871944629">PR review comment</a>:</p>
<blockquote>
<p>Is the <code>_var</code> suffix fairly established in Winch? If so, ignore the following.</p>
<p>If not, then I find it a little surprising. I thought maybe there was a <code>Var</code> type that abstracts over registers and stack slots or something. Or introduces a virtual register concept or something like that. I think a <code>_reg</code> suffix would have avoided me going down that line of thought and inquiry, which would make it slightly easier to follow what's going on, as a code reader.</p>
</blockquote>



<a name="486377335"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486377335" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486377335">(Dec 05 2024 at 19:17)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#discussion_r1871941349">PR review comment</a>:</p>
<blockquote>
<p>Maybe move this <code>if self.tunables.epoch_interruption</code> into the <code>emit_epoch_check</code> helper? (And rename it to <code>maybe_emit_epoch_check</code> or something like that? Feel free to bikeshed.)</p>
<p>This code motion would simplify callers, which are all doing the exact same conditional.</p>
</blockquote>



<a name="486377336"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486377336" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486377336">(Dec 05 2024 at 19:17)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#discussion_r1871949039">PR review comment</a>:</p>
<blockquote>
<p>I think a one-line comment describing what this label is could also be helpful to code readers.</p>
</blockquote>



<a name="486377337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486377337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486377337">(Dec 05 2024 at 19:17)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#discussion_r1871945153">PR review comment</a>:</p>
<blockquote>
<p>And then I'd expect these to also be <code>_reg</code> if the last suggestion is taken.</p>
</blockquote>



<a name="486518456"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486518456" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486518456">(Dec 06 2024 at 13:44)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486524452"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486524452" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486524452">(Dec 06 2024 at 14:15)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486524841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486524841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486524841">(Dec 06 2024 at 14:17)</a>:</h4>
<p>saulecabrera <a href="https://github.com/bytecodealliance/wasmtime/pull/9737#issuecomment-2523347542">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>:</p>
<blockquote>
<p>@fitzgen agreed with all the suggestions,thanks! I've also opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">https://github.com/bytecodealliance/wasmtime/pull/9737</a>, which applies the suggestions in this PR to fuel checks. </p>
</blockquote>



<a name="486559569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486559569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486559569">(Dec 06 2024 at 17:10)</a>:</h4>
<p>saulecabrera updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<a name="486564522"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239737%20winch%3A%20Epoch-based%20interruption/near/486564522" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239737.20winch.3A.20Epoch-based.20interruption.html#486564522">(Dec 06 2024 at 17:37)</a>:</h4>
<p>saulecabrera merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9737">PR #9737</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>