<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9775 pulley: Implement more of loads/stores · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html">wasmtime / PR #9775 pulley: Implement more of loads/stores</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="487290887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487290887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487290887">(Dec 10 2024 at 16:18)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a> from <code>alexcrichton:pulley-loads-and-stores</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>This commit gets the <code>address.wast</code> spec test working by filling out more load/store infrastructure in Pulley. In doing so I've done a refactoring of the existing load/store methods. Changes here are:</p>
<ul>
<li>All load/stores are <code>*_offset32</code> now instead of optionally having no offset, a 8-bit offset, or a 64-bit offset.</li>
<li>All x-register loads/stores are prefixed with <code>x</code> now.</li>
<li>All loads/stores have "le" for little-endian in their name.</li>
<li>Loads/stores are refactored to have 8 and 16-bit variants.</li>
<li>Sign-extending loads now either extend to 32 or 64 depending on the opcode.</li>
<li>Float loads/stores are added.</li>
<li>Big-endian is handled with explicit big-endian loads/stores instead <code>bswap</code> to handle this transparently in the backend (e.g. for stores not ISLE-generated) and to handle floats.</li>
</ul>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="487290889"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487290889" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487290889">(Dec 10 2024 at 16:18)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487290890"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487290890" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487290890">(Dec 10 2024 at 16:18)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487290892"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487290892" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487290892">(Dec 10 2024 at 16:18)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-default-reviewers">wasmtime-default-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487290895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487290895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487290895">(Dec 10 2024 at 16:18)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487291129"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487291129" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487291129">(Dec 10 2024 at 16:19)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492850440">PR review</a>.</p>



<a name="487291133"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487291133" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487291133">(Dec 10 2024 at 16:19)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878402607">PR review comment</a>:</p>
<blockquote>
<p>Curious on your thoughts on this in particular @fitzgen.</p>
<p>I'll note that we don't currently do this well, e.g. <code>xconst8</code> always writes the full 64-bits and <code>br_if</code> has no variant that only reads 32-bits. I think we'll want to change that over time though.</p>
</blockquote>



<a name="487291401"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487291401" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487291401">(Dec 10 2024 at 16:20)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#issuecomment-2532197516">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>:</p>
<blockquote>
<p>At a high level the <code>spec_testsuite/*.wast</code> still can't be executed, but that's the next PR after this to get that executing on CI (and a large number of tests already pass)</p>
</blockquote>



<a name="487292772"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487292772" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487292772">(Dec 10 2024 at 16:26)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487292775"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487292775" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487292775">(Dec 10 2024 at 16:26)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-fuzz-reviewers">wasmtime-fuzz-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487292915"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487292915" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487292915">(Dec 10 2024 at 16:27)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492888607">PR review</a>.</p>



<a name="487292916"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487292916" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487292916">(Dec 10 2024 at 16:27)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878423821">PR review comment</a>:</p>
<blockquote>
<p>Also curious on your thoughts here @fitzgen of the deletion of this fuzzer. Personally I feel like it's a bit of a pain to maintain while not adding much more over the wasm-smith fuzzing we have already.</p>
</blockquote>



<a name="487294744"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487294744" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487294744">(Dec 10 2024 at 16:34)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487296839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487296839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487296839">(Dec 10 2024 at 16:44)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492941504">PR review</a>.</p>



<a name="487296841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487296841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487296841">(Dec 10 2024 at 16:44)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878452889">PR review comment</a>:</p>
<blockquote>
<p>Also double-check me on this, is this right?</p>
</blockquote>



<a name="487298382"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298382" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298382">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492870323">PR review</a>.</p>



<a name="487298383"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298383" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298383">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878412984">PR review comment</a>:</p>
<blockquote>
<p>I think we could remove the parenthetical here. They must be fast to decode <em>in software</em> (perhaps worth adding that qualifier) at runtime and various bit-packing schemes will either be fast enough or not. I don't think it necessarily makes sense to say we won't do any bit-packing at all, since (a) we already do a little, and (b) we need to balance the decoding with instruction density and cache usage.</p>
</blockquote>



<a name="487298384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298384">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878443485">PR review comment</a>:</p>
<blockquote>
<p>We are (rightfully) burning a lot of opcode space for loads and stores, but I wonder if we can make an exception for the "only write the bottom bits" and always extend to the full register width? This would mean we wouldn't need both <code>xload8_s32_offset32</code> <em>and</em> <code>xload8_s64_offset32</code> and would effectively have only the latter. This would roughly cut in half the number of load/store instructions we have but wouldn't constrain the cranelift backend at all. The cost would be a couple extra extends on 32-bit platforms, which I don't think is too bad a trade off in this particular case.</p>
<p>And FWIW, I still think the default position should be to only write the low bits of registers when doing 32-bit adds/ands/xors/etc, we are just running into all the edge cases now :)</p>
</blockquote>



<a name="487298385"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298385" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298385">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878432311">PR review comment</a>:</p>
<blockquote>
<p>For <code>xconst*</code> I think filling the whole register is what we want regardless. They are a little different from, say, bitwise arithmetic since they aren't really an operation themselves and are more about getting data in place to perform actual operations.</p>
<p>Although IIRC we are still zero-extending rather than sign-extending in <code>const*</code>. The latter is going to save us code size, since otherwise all negative immediates will need to be loaded in registers with <code>xconst64</code>s. But maybe we did fix this already at one point...</p>
</blockquote>



<a name="487298386"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298386" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298386">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878423104">PR review comment</a>:</p>
<blockquote>
<p>This actually _increases_ the number of opcodes, but _decreases_ the number of instructions in most programs. That is, with macro ops we are doing _more work per instruction_. And the reason we want to do more work per instruction is because one of the biggest costs of interpretation compared to compilation is the interpreter loop's per-instruction overhead.</p>
</blockquote>



<a name="487298387"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298387" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298387">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878425601">PR review comment</a>:</p>
<blockquote>
<p>Maybe also add a note about signed vs unsigned naming conventions</p>
</blockquote>



<a name="487298388"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298388" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298388">(Dec 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878462697">PR review comment</a>:</p>
<blockquote>
<p>nitpick: Use the new helper here and elsewhere</p>
</blockquote>



<a name="487298823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298823">(Dec 10 2024 at 16:53)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492969733">PR review</a>.</p>



<a name="487298824"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487298824" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487298824">(Dec 10 2024 at 16:53)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878469669">PR review comment</a>:</p>
<blockquote>
<p>I don't think so, since (unlike addition) subtraction lets high bits (which should be invisible) move down to the low bits (and become visible), right?</p>
</blockquote>



<a name="487300069"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487300069" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487300069">(Dec 10 2024 at 16:59)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2492986168">PR review</a>.</p>



<a name="487300070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487300070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487300070">(Dec 10 2024 at 16:59)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878480108">PR review comment</a>:</p>
<blockquote>
<p>Good point, I'll add notes about the balance. I was mostly thinking here of things like RISC-V instructions where the registers are spread throughout the instruction in various locations to fit around encodings of other instructions. That's the "super fancy" part but I also don't think we're at risk of getting there any time soon.</p>
</blockquote>



<a name="487301381"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487301381" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487301381">(Dec 10 2024 at 17:05)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2493001806">PR review</a>.</p>



<a name="487301384"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487301384" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487301384">(Dec 10 2024 at 17:05)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878488934">PR review comment</a>:</p>
<blockquote>
<p>actually I think this works correctly</p>
</blockquote>



<a name="487301517"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487301517" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487301517">(Dec 10 2024 at 17:06)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2493003047">PR review</a>.</p>



<a name="487301518"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487301518" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487301518">(Dec 10 2024 at 17:06)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878489663">PR review comment</a>:</p>
<blockquote>
<p>let's merge this and get further in spec tests, and eventually differential fuzzing, which will definitely catch any issues here</p>
</blockquote>



<a name="487305037"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487305037" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487305037">(Dec 10 2024 at 17:25)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#pullrequestreview-2493049668">PR review</a>.</p>



<a name="487305039"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487305039" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487305039">(Dec 10 2024 at 17:25)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/9775#discussion_r1878518315">PR review comment</a>:</p>
<blockquote>
<p>This I feel is a bit entangled with the question below of "do we want <code>xload8_s32_offset32</code>". I'm a bit worried about <code>xconst8</code> always filling the entire register mostly from the perspective of 32-bit platforms. If most constants in a program are actually 32-bits then we're in theory spending a lot of instructions to fill the upper half of the register that's never read. Cache-wise that's probably not too problematic but it's possibly problematic from an icache perspective of the implementation of <code>xconst8</code> itself.</p>
<p>I definitely agree though that for 64-bit platforms it doesn't matter at all.</p>
<p>For now I'm going to go ahead with this PR as-is (with <code>xload8_s32_offset32</code> for example) and these docs since we don't have a great answer one way or another and I think we're both on the fence. I'm going to add some notes to <a href="https://github.com/bytecodealliance/wasmtime/issues/9747">https://github.com/bytecodealliance/wasmtime/issues/9747</a> to come back to reevaluate though.</p>
</blockquote>



<a name="487305088"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487305088" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487305088">(Dec 10 2024 at 17:26)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487305145"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487305145" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487305145">(Dec 10 2024 at 17:26)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487313739"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487313739" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487313739">(Dec 10 2024 at 18:13)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487313760"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487313760" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487313760">(Dec 10 2024 at 18:13)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<a name="487319662"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239775%20pulley%3A%20Implement%20more%20of%20loads/stores/near/487319662" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239775.20pulley.3A.20Implement.20more.20of.20loads.2Fstores.html#487319662">(Dec 10 2024 at 18:47)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9775">PR #9775</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>