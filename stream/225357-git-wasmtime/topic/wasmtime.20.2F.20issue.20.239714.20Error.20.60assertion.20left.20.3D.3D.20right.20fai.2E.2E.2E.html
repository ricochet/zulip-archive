<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9714 Error `assertion left == right fai... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html">wasmtime / issue #9714 Error `assertion left == right fai...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="485765930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/485765930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#485765930">(Dec 03 2024 at 06:28)</a>:</h4>
<p><a href="https://github.com/epsylonix">epsylonix</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">Issue #9714</a>.</p>



<a name="485765932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/485765932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#485765932">(Dec 03 2024 at 06:28)</a>:</h4>
<p>epsylonix opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>I'm trying to run a Kotlin-produced Wasm module in Rust-embedded Wasmtime. Kotlin requires support for the Wasm GC proposal, which Wasmtime officially has since version 27.0.0. Unfortunately, when initializing the Kotlin-generated Wasm module, a Wasmtime assertion error occurs, seemingly related to the Wasm GC code.</p>
<p>I initially assumed some incompatibility between Wasmtime and Kotlin-produced Wasm but the same file can be executed successfully in the standalone mode with <code>wasmtime -W function-references,gc</code>.</p>
<p>The minimal Kotlin guest code that reproduces this issue looks like this:</p>
<div class="codehilite" data-code-language="Kotlin"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>And this is the corresponding host code:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">wasmtime</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">wasi_common</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">WasiCtxBuilder</span><span class="p">;</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="n">config</span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_gc</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">wasm_function_references</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Linker</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">);</span>
<span class="w">    </span><span class="n">wasi_common</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">add_to_linker</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">linker</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wasi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WasiCtxBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">inherit_stderr</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">inherit_stdout</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Store</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">wasi</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Module</span><span class="p">::</span><span class="n">from_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="s">"kotlin.wasm"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">linker</span><span class="p">.</span><span class="n">instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>This fails at <code>linker.instantiate</code> call with an error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">type_registry</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">271</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="err">`</span><span class="n">left</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">right</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span>
<span class="w">  </span><span class="n">left</span><span class="p">:</span><span class="w"> </span><span class="nc">WasmSubType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_final</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span><span class="w"> </span><span class="n">supertype</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">composite_type</span><span class="p">:</span><span class="w"> </span><span class="nc">WasmCompositeType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">Struct</span><span class="p">(</span><span class="n">WasmStructType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fields</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">shared</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="n">right</span><span class="p">:</span><span class="w"> </span><span class="nc">WasmSubType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_final</span><span class="p">:</span><span class="w"> </span><span class="nc">true</span><span class="p">,</span><span class="w"> </span><span class="n">supertype</span><span class="p">:</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Engine</span><span class="p">(</span><span class="n">VMSharedTypeIndex</span><span class="p">(</span><span class="mi">19</span><span class="p">))),</span><span class="w"> </span><span class="n">composite_type</span><span class="p">:</span><span class="w"> </span><span class="nc">WasmCompositeType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">Struct</span><span class="p">(</span><span class="n">WasmStructType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fields</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">shared</span><span class="p">:</span><span class="w"> </span><span class="nc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>

<span class="n">stack</span><span class="w"> </span><span class="n">backtrace</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nc">rust_begin_unwind</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">f6e511eec7342f59a25f7c0534f1dbea00d01b14</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">662</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">panic_fmt</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">f6e511eec7342f59a25f7c0534f1dbea00d01b14</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">74</span><span class="p">:</span><span class="mi">14</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">assert_failed_inner</span>
<span class="w">   </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">panicking</span><span class="p">::</span><span class="n">assert_failed</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">f6e511eec7342f59a25f7c0534f1dbea00d01b14</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">367</span><span class="p">:</span><span class="mi">5</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">type_registry</span><span class="p">::</span><span class="n">RegisteredType</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="nb">PartialEq</span><span class="o">&gt;</span><span class="p">::</span><span class="n">eq</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">type_registry</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">271</span><span class="p">:</span><span class="mi">17</span>
<span class="w">   </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="n">impls</span><span class="p">::</span><span class="o">&lt;</span><span class="k">impl</span><span class="w"> </span><span class="n">core</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="nb">PartialEq</span><span class="o">&lt;&amp;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">eq</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">f6e511eec7342f59a25f7c0534f1dbea00d01b14</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">cmp</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1661</span><span class="p">:</span><span class="mi">13</span>
<span class="w">   </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Q</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">hashbrown</span><span class="p">::</span><span class="n">Equivalent</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">equivalent</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">172</span><span class="p">:</span><span class="mi">9</span>
<span class="w">   </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">map</span><span class="p">::</span><span class="n">equivalent_key</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">map</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">229</span><span class="p">:</span><span class="mi">14</span>
<span class="w">   </span><span class="mi">8</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">raw</span><span class="p">::</span><span class="n">inner</span><span class="p">::</span><span class="n">RawTable</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">find_or_find_insert_slot</span><span class="p">::{{</span><span class="n">closure</span><span class="p">}}</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1425</span><span class="p">:</span><span class="mi">68</span>
<span class="w">   </span><span class="mi">9</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">raw</span><span class="p">::</span><span class="n">inner</span><span class="p">::</span><span class="n">RawTableInner</span><span class="p">::</span><span class="n">find_or_find_insert_slot_inner</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1983</span><span class="p">:</span><span class="mi">27</span>
<span class="w">  </span><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">raw</span><span class="p">::</span><span class="n">inner</span><span class="p">::</span><span class="n">RawTable</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">find_or_find_insert_slot</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1423</span><span class="p">:</span><span class="mi">19</span>
<span class="w">  </span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">map</span><span class="p">::</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">insert</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">map</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1754</span><span class="p">:</span><span class="mi">15</span>
<span class="w">  </span><span class="mi">12</span><span class="p">:</span><span class="w"> </span><span class="nc">hashbrown</span><span class="p">::</span><span class="n">set</span><span class="p">::</span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">insert</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">hashbrown</span><span class="o">-</span><span class="mf">0.14.5</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">set</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1115</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">13</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">store</span><span class="p">::</span><span class="n">StoreOpaque</span><span class="p">::</span><span class="n">insert_gc_host_alloc_type</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">store</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1797</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">14</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">gc</span><span class="p">::</span><span class="n">enabled</span><span class="p">::</span><span class="n">structref</span><span class="p">::</span><span class="n">StructRefPre</span><span class="p">::</span><span class="n">_new</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">gc</span><span class="o">/</span><span class="n">enabled</span><span class="o">/</span><span class="n">structref</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">74</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">15</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">const_expr</span><span class="p">::</span><span class="n">ConstEvalContext</span><span class="p">::</span><span class="n">struct_new</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">const_expr</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="mi">25</span>
<span class="w">  </span><span class="mi">16</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">const_expr</span><span class="p">::</span><span class="n">ConstEvalContext</span><span class="p">::</span><span class="n">struct_new_default</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">const_expr</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">153</span><span class="p">:</span><span class="mi">18</span>
<span class="w">  </span><span class="mi">17</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">const_expr</span><span class="p">::</span><span class="n">ConstExprEvaluator</span><span class="p">::</span><span class="n">eval</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">const_expr</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">278</span><span class="p">:</span><span class="mi">31</span>
<span class="w">  </span><span class="mi">18</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">allocator</span><span class="p">::</span><span class="n">initialize_globals</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">instance</span><span class="o">/</span><span class="n">allocator</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">779</span><span class="p">:</span><span class="mi">13</span>
<span class="w">  </span><span class="mi">19</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">allocator</span><span class="p">::</span><span class="n">initialize_instance</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">instance</span><span class="o">/</span><span class="n">allocator</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">826</span><span class="p">:</span><span class="mi">5</span>
<span class="w">  </span><span class="mi">20</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">vm</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">InstanceHandle</span><span class="p">::</span><span class="n">initialize</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1541</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">21</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new_raw</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">343</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">22</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new_started_impl</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">206</span><span class="p">:</span><span class="mi">33</span>
<span class="w">  </span><span class="mi">23</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">Instance</span><span class="p">::</span><span class="n">new_started</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">194</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">24</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">instance</span><span class="p">::</span><span class="n">InstancePre</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">instantiate</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">instance</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">876</span><span class="p">:</span><span class="mi">18</span>
<span class="w">  </span><span class="mi">25</span><span class="p">:</span><span class="w"> </span><span class="nc">wasmtime</span><span class="p">::</span><span class="n">runtime</span><span class="p">::</span><span class="n">linker</span><span class="p">::</span><span class="n">Linker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">::</span><span class="n">instantiate</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">crates</span><span class="p">.</span><span class="n">io</span><span class="o">-</span><span class="mi">6</span><span class="n">f17d22bba15001f</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="mf">27.0.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">linker</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">1112</span><span class="p">:</span><span class="mi">9</span>
<span class="w">  </span><span class="mi">26</span><span class="p">:</span><span class="w"> </span><span class="nc">jobexecutor</span><span class="p">::</span><span class="n">main</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">5</span>
<span class="w">  </span><span class="mi">27</span><span class="p">:</span><span class="w"> </span><span class="nc">core</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">function</span><span class="p">::</span><span class="nb">FnOnce</span><span class="p">::</span><span class="n">call_once</span>
<span class="w">             </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="n">f6e511eec7342f59a25f7c0534f1dbea00d01b14</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ops</span><span class="o">/</span><span class="n">function</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">250</span><span class="p">:</span><span class="mi">5</span>
</code></pre></div>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 27.0.0</p>
<p>Operating system: macOS</p>
<p>Architecture: arm64<br>
</p>
</blockquote>



<a name="485884046"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/485884046" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#485884046">(Dec 03 2024 at 15:35)</a>:</h4>
<p>alexcrichton assigned fitzgen to <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>.</p>



<a name="485884248"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/485884248" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#485884248">(Dec 03 2024 at 15:36)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasm-proposal:gc label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">Issue #9714</a>.</p>



<a name="486066628"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/486066628" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#486066628">(Dec 04 2024 at 11:08)</a>:</h4>
<p>epsylonix <a href="https://github.com/bytecodealliance/wasmtime/issues/9714#issuecomment-2517004021">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<p>I've also encountered a similar issue in the standalone mode with when I've added any non-trivial code. For example, using Kotlin's <code>kotlinx.serialization</code> json and a small code example from docs: <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#json-decoding">https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#json-decoding</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">import</span><span class="w"> </span><span class="n">kotlinx</span><span class="p">.</span><span class="n">serialization</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="n">Json</span>

<span class="n">fun</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="n">decodeFromString</span><span class="o">&lt;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">"""</span>
<span class="s">        {"</span><span class="n">name</span><span class="s">":"</span><span class="n">test</span><span class="s">"}</span>
<span class="s">    """</span><span class="p">)</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">@</span><span class="n">WasmExport</span>
<span class="n">fun</span><span class="w"> </span><span class="n">dummy</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>Execution results in this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">gc</span><span class="o">/</span><span class="n">func_ref</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">81</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">types</span><span class="p">.</span><span class="n">is_subtype</span><span class="p">(</span><span class="n">actual_ty</span><span class="p">,</span><span class="w"> </span><span class="n">expected_ty</span><span class="p">)</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">    </span><span class="mi">11826</span><span class="w"> </span><span class="n">abort</span><span class="w">      </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">v27</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">references</span><span class="p">,</span><span class="n">gc</span>
</code></pre></div>
<p>I tested it with WasmEdge and it this works there so I assume this is a Wasmtime issue, not Kotlin.<br>
</p>
</blockquote>



<a name="486066665"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/486066665" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#486066665">(Dec 04 2024 at 11:08)</a>:</h4>
<p>epsylonix edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9714#issuecomment-2517004021">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<p>I've also encountered a similar issue in the standalone mode with when added any non-trivial code. For example, using Kotlin's <code>kotlinx.serialization</code> json and a small code example from docs: <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#json-decoding">https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#json-decoding</a></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">import</span><span class="w"> </span><span class="n">kotlinx</span><span class="p">.</span><span class="n">serialization</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="n">Json</span>

<span class="n">fun</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="n">decodeFromString</span><span class="o">&lt;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">"""</span>
<span class="s">        {"</span><span class="n">name</span><span class="s">":"</span><span class="n">test</span><span class="s">"}</span>
<span class="s">    """</span><span class="p">)</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">@</span><span class="n">WasmExport</span>
<span class="n">fun</span><span class="w"> </span><span class="n">dummy</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>Execution results in this error:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'</span><span class="na">main</span><span class="o">'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">crates</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">gc</span><span class="o">/</span><span class="n">func_ref</span><span class="p">.</span><span class="n">rs</span><span class="p">:</span><span class="mi">81</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span>
<span class="nc">assertion</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="nc">types</span><span class="p">.</span><span class="n">is_subtype</span><span class="p">(</span><span class="n">actual_ty</span><span class="p">,</span><span class="w"> </span><span class="n">expected_ty</span><span class="p">)</span>
<span class="n">note</span><span class="p">:</span><span class="w"> </span><span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">    </span><span class="mi">11826</span><span class="w"> </span><span class="n">abort</span><span class="w">      </span><span class="p">.</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">v27</span><span class="p">.</span><span class="mf">0.0</span><span class="o">/</span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">W</span><span class="w"> </span><span class="n">function</span><span class="o">-</span><span class="n">references</span><span class="p">,</span><span class="n">gc</span>
</code></pre></div>
<p>I tested it with WasmEdge and it this works there so I assume this is a Wasmtime issue, not Kotlin.<br>
</p>
</blockquote>



<a name="486167930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/486167930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#486167930">(Dec 04 2024 at 19:54)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/9714#issuecomment-2518433588">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<p>Thanks for filing an issue! Can you attach the <code>.wasm</code> or <code>.wat</code> instead of the Kotlin source? That will greatly help us debug and diagnose the issue. Thanks!</p>
</blockquote>



<a name="486266103"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/486266103" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#486266103">(Dec 05 2024 at 10:00)</a>:</h4>
<p>epsylonix <a href="https://github.com/bytecodealliance/wasmtime/issues/9714#issuecomment-2519818778">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<p>Thank you for looking into this!</p>
<p>Here are two wasm files for both issues I've mentined.</p>
<ol>
<li>
<p>The first one is an empty main case (<code>fun main() {}</code>) that can be executed by the standalone Wasmtime version but fails with <code>assertion </code>left == right<code> failed</code> when the module is initialized when Wasmtime is embedded in Rust. I'm new to Rust so it might be something I'm doing wrong here but the code is mostly taken from docs.<br>
<a href="https://github.com/user-attachments/files/18021180/assertion_failed__left_eq_right.wasm.zip">assertion_failed__left_eq_right.wasm.zip</a></p>
</li>
<li>
<p>The second one is the case with the serialization. It fails even in the standalone version of Wasmtime with <code>assertion failed: types.is_subtype(actual_ty, expected_ty)</code> error.</p>
</li>
</ol>
<p><a href="https://github.com/user-attachments/files/18021181/assertion_failed__types_is_subtype.wasm.zip">assertion_failed__types_is_subtype.wasm.zip</a><br>
</p>
</blockquote>



<a name="486266130"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239714%20Error%20%60assertion%20left%20%3D%3D%20right%20fai.../near/486266130" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239714.20Error.20.60assertion.20left.20.3D.3D.20right.20fai.2E.2E.2E.html#486266130">(Dec 05 2024 at 10:01)</a>:</h4>
<p>epsylonix edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/9714#issuecomment-2519818778">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/9714">issue #9714</a>:</p>
<blockquote>
<p>Thank you for looking into this!</p>
<p>Here are two wasm files for both issues I've mentined.</p>
<ol>
<li>
<p>The first one is an empty main case (<code>fun main() {}</code>) that can be executed by the standalone Wasmtime version but fails with <code>assertion </code>left == right<code> failed</code> when the module is initialized when Wasmtime is embedded in Rust. I'm new to Rust so it might be something I'm doing wrong here but the code is mostly taken from docs.<br>
<a href="https://github.com/user-attachments/files/18021180/assertion_failed__left_eq_right.wasm.zip">assertion_failed__left_eq_right.wasm.zip</a></p>
</li>
<li>
<p>The second one is the case with the serialization. It fails even in the standalone version of Wasmtime with <code>assertion failed: types.is_subtype(actual_ty, expected_ty)</code> error.<br>
<a href="https://github.com/user-attachments/files/18021181/assertion_failed__types_is_subtype.wasm.zip">assertion_failed__types_is_subtype.wasm.zip</a><br>
</p>
</li>
</ol>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>