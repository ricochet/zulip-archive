<html>
<head><meta charset="utf-8"><title>wasmtime / issue #5934 implement &quot;part 1&quot; of WIT Templates · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html">wasmtime / issue #5934 implement &quot;part 1&quot; of WIT Templates</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="339752079"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/339752079" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#339752079">(Mar 05 2023 at 22:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1455231331">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @peterhuene</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "wasmtime:api"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>peterhuene: wasmtime:api</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="339922322"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/339922322" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#339922322">(Mar 06 2023 at 17:06)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1456538045">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>Yes, in that particular test case, the only reason I used <code>bindgen!</code> was to ensure that it doesn't choke on wildcards.  In a more realistic scenario, a world could contain a mix of non-wildcard interfaces and wildcard interfaces.  You'd still want generated bindings for the former even if you don't need them for the latter.</p>
<p>Also, although <a href="https://github.com/WebAssembly/component-model/issues/172">https://github.com/WebAssembly/component-model/issues/172</a> does not include "mixed" interfaces which contain both wildcard and non-wildcard functions, it would be pretty trivial to add support for that.  For example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">default</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">wildcards</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">import</span><span class="w"> </span><span class="n">imports</span>: <span class="nc">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span>: <span class="nc">func</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u32</span>
        <span class="nc">foo</span>: <span class="nc">func</span><span class="p">(</span><span class="n">s</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span>
<span class="w">        </span><span class="n">bar</span>: <span class="nc">func</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">u32</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>BTW, my initial implementation (<a href="https://github.com/bytecodealliance/wasmtime/pull/5925">https://github.com/bytecodealliance/wasmtime/pull/5925</a>) _did_ generate code for wildcards, but that code ended up just being wrappers around the Wasmtime API which didn't add much value vs. using the API directly.  If you think there _is_ value to be added via code generation, we can revisit that.</p>
</blockquote>



<a name="339941434"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/339941434" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#339941434">(Mar 06 2023 at 18:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1456734223">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>In some sense the whole <code>bindgen!</code> macro is a pretty thin wrapper around the component embedding API, but I think the main value from it is that it gets all the types right and you don't have to think about it. From another perspective any type-level bugs are caught by <code>rustc</code> and aren't logic bugs in your own code. Manually calling linker functions, though, you can get past <code>rustc</code> but accidentally deviate from the <code>*.wit</code> which I think is nice to fix if we can. More-or-less I do think that it's wortwhile to generate typed bindings to <code>*</code>-imports/exports to make it idomatic with the rest of <code>*.wit</code>-generated bindings and otherwise make it so you don't have to think about the types.</p>
</blockquote>



<a name="339942368"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/339942368" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#339942368">(Mar 06 2023 at 18:39)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1456741797">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>Fair enough.  Would you mind taking a look at the diff for <a href="https://github.com/bytecodealliance/wasmtime/pull/5925">https://github.com/bytecodealliance/wasmtime/pull/5925</a> and provide feedback on that, then?  I can close this PR and reopen that one if desired.  I just want to make sure we're aligned about what the generated code should look like first.</p>
</blockquote>



<a name="339947416"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/339947416" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#339947416">(Mar 06 2023 at 19:05)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1456786286">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>For sure yeah, the main thing I'd consider on #5925 is sort of along the same lines of catching issues earlier rather than later. There it looks like the strategy is that <code>*</code>-imports bottom out into a <code>fn call(&amp;mut self, name: &amp;str, ...)</code> trait method but an alternative would be for the host to pass in some sort of configuration "I support <code>call</code> with these names" which then fails instantiation if enough names weren't supplied. My original idea here was to pass in a vector of named trait objects, but that may be too inefficient for the intended use cases (I'm not sure).</p>
<p>I don't feel super strongly about this particular point though myself. It feels a little odd to pass around the component when you're adding something to a linker but that's probably just me needing to get over my preconceptions about this. In any case I do think that #5925 is better in the sense of "everything is type-checked for you" so I think that would be a better starting point than not generating bindings for <code>*</code></p>
</blockquote>



<a name="340003211"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/340003211" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#340003211">(Mar 07 2023 at 01:51)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1457364838">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>@alexcrichton I've implemented code generation per your feedback.  Please let me know what you think.</p>
</blockquote>



<a name="340237675"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%235934%20implement%20%22part%201%22%20of%20WIT%20Templates/near/340237675" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.235934.20implement.20.22part.201.22.20of.20WIT.20Templates.html#340237675">(Mar 07 2023 at 23:54)</a>:</h4>
<p>dicej <a href="https://github.com/bytecodealliance/wasmtime/pull/5934#issuecomment-1459049033">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/5934">issue #5934</a>:</p>
<blockquote>
<p>@alexcrichton Thanks for all your feedback.  I think I've addressed everything so far.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>