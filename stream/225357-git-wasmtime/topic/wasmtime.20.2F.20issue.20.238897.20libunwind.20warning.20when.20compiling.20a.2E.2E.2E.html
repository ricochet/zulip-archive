<html>
<head><meta charset="utf-8"><title>wasmtime / issue #8897 libunwind warning when compiling a... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html">wasmtime / issue #8897 libunwind warning when compiling a...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="448855409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448855409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448855409">(Jul 03 2024 at 13:50)</a>:</h4>
<p><a href="https://github.com/pimeys">pimeys</a> added the bug label to <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">Issue #8897</a>.</p>



<a name="448855418"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448855418" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448855418">(Jul 03 2024 at 13:50)</a>:</h4>
<p>pimeys opened <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Load _any_ wasm component (wasip2) with wasmtime 21.0.1, if you compile the rust against musl, a warning is printed to the terminal:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">libunwind</span><span class="p">:</span><span class="w"> </span><span class="nc">__unw_add_dynamic_fde</span><span class="p">:</span><span class="w"> </span><span class="nc">bad</span><span class="w"> </span><span class="n">fde</span><span class="p">:</span><span class="w"> </span><span class="nc">FDE</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CIE</span>
</code></pre></div>
<p>The component and the whole system works correctly, but the log is confusing and there's no way to tell if something is actually broken.</p>
<h3>Expected Results</h3>
<p>It should work as with builds against glibc, or builds on macos with no libunwind warning printed to the terminal.</p>
<h3>Actual Results</h3>
<p>I can't seem to find anything being broken really...</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 21.0.1</p>
<p>Operating system: nixos linux unstable</p>
<p>Architecture: x86_64-unknown-linux-musl for the host and wasm32-wasip1 for the guest.</p>
<h3>Extra Info</h3>
<p>I found issues from the past, such as</p>
<p><a href="https://github.com/wasmerio/wasmer/issues/2150">https://github.com/wasmerio/wasmer/issues/2150</a><br>
<a href="https://github.com/bytecodealliance/wasmtime/issues/1904">https://github.com/bytecodealliance/wasmtime/issues/1904</a></p>
<p>But nothing more recent...<br>
</p>
</blockquote>



<a name="448858032"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448858032" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448858032">(Jul 03 2024 at 14:00)</a>:</h4>
<p>pimeys edited <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Load _any_ wasm component (wasip2) with wasmtime 21.0.1, if you compile the rust host against musl, a warning is printed to the terminal:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">libunwind</span><span class="p">:</span><span class="w"> </span><span class="nc">__unw_add_dynamic_fde</span><span class="p">:</span><span class="w"> </span><span class="nc">bad</span><span class="w"> </span><span class="n">fde</span><span class="p">:</span><span class="w"> </span><span class="nc">FDE</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CIE</span>
</code></pre></div>
<p>The component and the whole system works correctly, but the log is confusing and there's no way to tell if something is actually broken.</p>
<h3>Expected Results</h3>
<p>It should work as with builds against glibc, or builds on macos with no libunwind warning printed to the terminal.</p>
<h3>Actual Results</h3>
<p>I can't seem to find anything being broken really...</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 21.0.1</p>
<p>Operating system: nixos linux unstable</p>
<p>Architecture: x86_64-unknown-linux-musl for the host and wasm32-wasip1 for the guest.</p>
<h3>Extra Info</h3>
<p>I found issues from the past, such as</p>
<p><a href="https://github.com/wasmerio/wasmer/issues/2150">https://github.com/wasmerio/wasmer/issues/2150</a><br>
<a href="https://github.com/bytecodealliance/wasmtime/issues/1904">https://github.com/bytecodealliance/wasmtime/issues/1904</a></p>
<p>But nothing more recent...<br>
</p>
</blockquote>



<a name="448903308"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448903308" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448903308">(Jul 03 2024 at 16:57)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2206797458">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>Seems like a regression of #1904 and #1914.</p>
<p>FWIW, we do not rely on the system's libunwind for correctness, we only emit <code>.eh_frame</code> and call <code>__register_frame</code> for the benefit of tools like profilers. You can also turn this off via <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.native_unwind_info">https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.native_unwind_info</a></p>
<p>IIRC, different libc implementations have different signatures for <code>__register_frame</code>, and this might be what we are running into here. If so, that isn't really something we can fix...</p>
</blockquote>



<a name="448903350"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448903350" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448903350">(Jul 03 2024 at 16:57)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2206797968">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<blockquote>
<p>IIRC, different libc implementations have different signatures for <code>__register_frame</code>, and this might be what we are running into here. If so, that isn't really something we can fix...</p>
</blockquote>
<p>Context:</p>
<p><a href="https://github.com/bytecodealliance/wasmtime/blob/58b4d093fa03e112533fd3dd96bd68792f9e13a4/crates/wasmtime/src/runtime/vm/sys/unix/unwind.rs#L19-L34">https://github.com/bytecodealliance/wasmtime/blob/58b4d093fa03e112533fd3dd96bd68792f9e13a4/crates/wasmtime/src/runtime/vm/sys/unix/unwind.rs#L19-L34</a></p>
</blockquote>



<a name="448931304"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448931304" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448931304">(Jul 03 2024 at 19:21)</a>:</h4>
<p>pimeys <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2207027008">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>Is there any way to hide this message or will it break any functionality?</p>
</blockquote>



<a name="448936114"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/448936114" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#448936114">(Jul 03 2024 at 19:48)</a>:</h4>
<p>fitzgen <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2207090195">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>I believe it is the libunwind implementation printing the message, not Wasmtime.</p>
<p>You can turn off Wasmtime's generation of unwind info via <a href="https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.native_unwind_info">https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.native_unwind_info</a> which should make it so that the message stops printing.</p>
</blockquote>



<a name="449033116"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/449033116" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#449033116">(Jul 04 2024 at 08:30)</a>:</h4>
<p>pimeys <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2208409685">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>Yeah, this solved it for us. I don't really know should I close this issue or not. It's kind of still an issue if wanting to use the native unwind info, but also wanting to target musl.</p>
</blockquote>



<a name="449874010"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/449874010" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#449874010">(Jul 08 2024 at 13:46)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2214124185">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>This cropping up again is a consequence of <a href="https://github.com/bytecodealliance/wasmtime/pull/8028">https://github.com/bytecodealliance/wasmtime/pull/8028</a> and how <code>dlsym</code> looks like it always returns NULL in a static build. This means that if you build a static binary, which I believe you're doing here, then it'll always think it's using libgcc which is incorrect.</p>
<p>So effectively this boils down to the mechanism used to detect libgcc-vs-libunwind. Another possible option is to use weak symbols but that's not possible in stable Rust so would require some C trickery to do that. I don't know of other options myself.</p>
</blockquote>



<a name="449875042"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/449875042" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#449875042">(Jul 08 2024 at 13:51)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2214136513">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>You can use weak symbols from inline asm, right? Would require a separate implementation for each architecture though.</p>
</blockquote>



<a name="449886303"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/449886303" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#449886303">(Jul 08 2024 at 14:34)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2214251874">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>Oh? I had no idea! If that works that might be a reasonable way to go here</p>
</blockquote>



<a name="477315946"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/477315946" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#477315946">(Oct 16 2024 at 23:00)</a>:</h4>
<p>kate-goldenring <a href="https://github.com/bytecodealliance/wasmtime/issues/8897#issuecomment-2418108802">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<p>We are encountering this in Spin with Wasmtime v25.0.0: <a href="https://github.com/fermyon/spin/issues/2889">https://github.com/fermyon/spin/issues/2889</a></p>
</blockquote>



<a name="478328206"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%238897%20libunwind%20warning%20when%20compiling%20a.../near/478328206" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.238897.20libunwind.20warning.20when.20compiling.20a.2E.2E.2E.html#478328206">(Oct 22 2024 at 16:49)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/8897">issue #8897</a>:</p>
<blockquote>
<h3>Test Case</h3>
<p>Load _any_ wasm component (wasip2) with wasmtime 21.0.1, if you compile the rust host against musl, a warning is printed to the terminal:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">libunwind</span><span class="p">:</span><span class="w"> </span><span class="nc">__unw_add_dynamic_fde</span><span class="p">:</span><span class="w"> </span><span class="nc">bad</span><span class="w"> </span><span class="n">fde</span><span class="p">:</span><span class="w"> </span><span class="nc">FDE</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CIE</span>
</code></pre></div>
<p>The component and the whole system works correctly, but the log is confusing and there's no way to tell if something is actually broken.</p>
<h3>Expected Results</h3>
<p>It should work as with builds against glibc, or builds on macos with no libunwind warning printed to the terminal.</p>
<h3>Actual Results</h3>
<p>I can't seem to find anything being broken really...</p>
<h3>Versions and Environment</h3>
<p>Wasmtime version or commit: 21.0.1</p>
<p>Operating system: nixos linux unstable</p>
<p>Architecture: x86_64-unknown-linux-musl for the host and wasm32-wasip1 for the guest.</p>
<h3>Extra Info</h3>
<p>I found issues from the past, such as</p>
<p><a href="https://github.com/wasmerio/wasmer/issues/2150">https://github.com/wasmerio/wasmer/issues/2150</a><br>
<a href="https://github.com/bytecodealliance/wasmtime/issues/1904">https://github.com/bytecodealliance/wasmtime/issues/1904</a></p>
<p>But nothing more recent...<br>
</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>