<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2960 Cranelift: Simplify leaf functions th... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html">wasmtime / PR #2960 Cranelift: Simplify leaf functions th...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="250468489"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250468489" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250468489">(Aug 24 2021 at 11:01)</a>:</h4>
<p>akirilov-arm edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2960">PR #2960</a> from <code>leaf_functions</code> to <code>main</code>.</p>



<a name="250468814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250468814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250468814">(Aug 24 2021 at 11:05)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#pullrequestreview-737092851">PR review</a>.</p>



<a name="250468815"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250468815" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250468815">(Aug 24 2021 at 11:05)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#discussion_r694747234">PR review comment</a>:</p>
<blockquote>
<p>I also added the x64 counterpart to my changes in a separate commit, which passed the tests locally.</p>
</blockquote>



<a name="250514108"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250514108" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250514108">(Aug 24 2021 at 16:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#pullrequestreview-737469230">PR review</a>.</p>



<a name="250514109"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250514109" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250514109">(Aug 24 2021 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#discussion_r695033748">PR review comment</a>:</p>
<blockquote>
<p>I can't say I have looked into this much but isn't there some way for the unwind info to still unwind leaf functions? Looking at the <a href="https://github.com/bytecodealliance/wasmtime/blob/e526ffc0d6bcc3431aee49a8037ef44478c4d112/tests/all/traps.rs#L140">test where MacOS fails</a>, I think this problem will also exist for aarch64?</p>
</blockquote>



<a name="250766711"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250766711" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250766711">(Aug 26 2021 at 12:55)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#pullrequestreview-739436562">PR review</a>.</p>



<a name="250766712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250766712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250766712">(Aug 26 2021 at 12:55)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#discussion_r696601473">PR review comment</a>:</p>
<blockquote>
<p>Well, doesn't the comment next to the code imply that unwinding on Apple silicon is broken irrespective of my changes, so any potential breakages introduced by my patch on that platform shouldn't be a blocker to progressing with the PR (and we don't test that configuration in CI anyway)?</p>
<p>On the other hand, AFAIK there are no known issues with unwinding on x86-64 macOS.</p>
</blockquote>



<a name="250767319"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250767319" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250767319">(Aug 26 2021 at 12:59)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#pullrequestreview-739441153">PR review</a>.</p>



<a name="250767320"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250767320" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250767320">(Aug 26 2021 at 12:59)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#discussion_r696604903">PR review comment</a>:</p>
<blockquote>
<blockquote>
<p>unwinding on Apple silicon is broken</p>
</blockquote>
<p>Right now, unwinding on M1 doesn't panic/crash, it is just materializing an incomplete backtrace, and I would be interested in at least keeping it not crashing. So I'd be happy to try your patch on Apple Silicon, fwiw! (Also it makes sense to me to get this optimization in for aarch64 only at start, and then trying to untangle what's going on on x64.)</p>
</blockquote>



<a name="250798732"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250798732" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250798732">(Aug 26 2021 at 16:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2960#pullrequestreview-739684916">PR review</a>.</p>



<a name="250802743"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250802743" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250802743">(Aug 26 2021 at 16:43)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2960">PR #2960</a> from <code>leaf_functions</code> to <code>main</code>.</p>



<a name="250826912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250826912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250826912">(Aug 26 2021 at 19:32)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2960">PR #2960</a> from <code>leaf_functions</code> to <code>main</code>.</p>



<a name="250909908"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232960%20Cranelift%3A%20Simplify%20leaf%20functions%20th.../near/250909908" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232960.20Cranelift.3A.20Simplify.20leaf.20functions.20th.2E.2E.2E.html#250909908">(Aug 27 2021 at 10:12)</a>:</h4>
<p>bnjbvr merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2960">PR #2960</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>