<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3006 Unable to compile when dynamically... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html">wasmtime / issue #3006 Unable to compile when dynamically...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="243306943"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233006%20Unable%20to%20compile%20when%20dynamically.../near/243306943" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html#243306943">(Jun 20 2021 at 15:09)</a>:</h4>
<p>skorpi-and-friends opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3006">issue #3006</a>:</p>
<blockquote>
<p>It's known dynamically linking dependencies in large Rust projects can improve compile times to a considerable degree. Facing the following problem when attempting to setup such a workspace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="err"></span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">[</span><span class="o">?</span><span class="p">]</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="err">📦</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="err">🦀</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">54.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">7</span><span class="n">s</span><span class="w"></span>
<span class="err">❯</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="w">    </span><span class="o">....</span><span class="w"> </span><span class="o">&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">crates</span><span class="o">&gt;..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">deps</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">deps</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">dylink</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">dylink</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="p">)</span><span class="w">                                                                                                         </span><span class="mi">17</span>:<span class="mi">40</span>:<span class="mi">12</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="p">)</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">cc</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="s">"cc"</span><span class="w"> </span><span class="s">"-m64"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-znoexecstack"</span><span class="w"> </span><span class="s">"-Wl,--as-needed"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.176re6pgxyy8ex5.rcgu.o"</span><span class="w"> </span><span class="o">......&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">files</span><span class="o">&gt;......</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.yqhnz0r7qoxxab5.rcgu.o"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-pie"</span><span class="w"> </span><span class="s">"-Wl,-zrelro"</span><span class="w"> </span><span class="s">"-Wl,-znow"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/psm-04165501c77b945c/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/zstd-sys-0f0a0a67e9ce9bc7/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-fiber-8ff9cbc1eca6d35f/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-runtime-2bce6ad7a15d697a/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-ldylink"</span><span class="w"> </span><span class="s">"-Wl,--start-group"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-lstd-c6dddd3d354e6bea"</span><span class="w"> </span><span class="s">"-Wl,--end-group"</span><span class="w"> </span><span class="s">"-Wl,-Bstatic"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-8b33f9cbbc9652fe.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasmtime_dylink_issue223c9046feaa7cea</span><span class="p">.</span><span class="mi">3</span><span class="n">nou4ari0sahe2y2</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="o">'</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.28.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">180</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">RegisterSetjmp</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="n">collect2</span>: <span class="nc">error</span>: <span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"></span>


<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_dylink_issue</span><span class="err">`</span><span class="w"></span>

<span class="n">To</span><span class="w"> </span><span class="n">learn</span><span class="w"> </span><span class="n">more</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p><a href="https://github.com/skorpi-and-friends/wasmtime_dylink_issue">Repo to recreate bug.</a></p>
<p>Similar issue when using the llvm linker.</p>
<p>Not exactly a traditional bug, I know, but would really appreciate any recs for getting past this.</p>
</blockquote>



<a name="243307028"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233006%20Unable%20to%20compile%20when%20dynamically.../near/243307028" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html#243307028">(Jun 20 2021 at 15:11)</a>:</h4>
<p>skorpi-and-friends edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3006">issue #3006</a>:</p>
<blockquote>
<p>It's known dynamically linking dependencies in large Rust projects can improve compile times to a considerable degree. Facing the following problem when attempting to setup such a workspace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="err"></span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">[</span><span class="o">?</span><span class="p">]</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="err">📦</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="err">🦀</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">54.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">7</span><span class="n">s</span><span class="w"></span>
<span class="err">❯</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="w">    </span><span class="o">....</span><span class="w"> </span><span class="o">&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">crates</span><span class="o">&gt;..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">deps</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">deps</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">dylink</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">dylink</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="p">)</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">cc</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="s">"cc"</span><span class="w"> </span><span class="s">"-m64"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-znoexecstack"</span><span class="w"> </span><span class="s">"-Wl,--as-needed"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.176re6pgxyy8ex5.rcgu.o"</span><span class="w"> </span><span class="o">......&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">files</span><span class="o">&gt;......</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.yqhnz0r7qoxxab5.rcgu.o"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-pie"</span><span class="w"> </span><span class="s">"-Wl,-zrelro"</span><span class="w"> </span><span class="s">"-Wl,-znow"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/psm-04165501c77b945c/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/zstd-sys-0f0a0a67e9ce9bc7/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-fiber-8ff9cbc1eca6d35f/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-runtime-2bce6ad7a15d697a/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-ldylink"</span><span class="w"> </span><span class="s">"-Wl,--start-group"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-lstd-c6dddd3d354e6bea"</span><span class="w"> </span><span class="s">"-Wl,--end-group"</span><span class="w"> </span><span class="s">"-Wl,-Bstatic"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-8b33f9cbbc9652fe.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasmtime_dylink_issue223c9046feaa7cea</span><span class="p">.</span><span class="mi">3</span><span class="n">nou4ari0sahe2y2</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="o">'</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.28.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">180</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">RegisterSetjmp</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="n">collect2</span>: <span class="nc">error</span>: <span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"></span>


<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_dylink_issue</span><span class="err">`</span><span class="w"></span>

<span class="n">To</span><span class="w"> </span><span class="n">learn</span><span class="w"> </span><span class="n">more</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p><a href="https://github.com/skorpi-and-friends/wasmtime_dylink_issue">Repo to recreate bug.</a></p>
<p>Similar issue when using the llvm linker.</p>
<p>Not exactly a traditional bug, I know, but would really appreciate any recs for getting past this.</p>
</blockquote>



<a name="243308208"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233006%20Unable%20to%20compile%20when%20dynamically.../near/243308208" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html#243308208">(Jun 20 2021 at 15:40)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3006#issuecomment-864572876">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3006">issue #3006</a>:</p>
<blockquote>
<p><code>RegisterSetJmp</code> is written in C: <a href="https://github.com/bytecodealliance/wasmtime/blob/7a1b7cdf92a644a256a9f4c5c002682e1900d817/crates/runtime/src/helpers.c#L17">https://github.com/bytecodealliance/wasmtime/blob/7a1b7cdf92a644a256a9f4c5c002682e1900d817/crates/runtime/src/helpers.c#L17</a> Maybe the visibility is set to hidden (<code>-fvisibility=hidden</code>), causing it to not be exported from dynamic libraries?</p>
</blockquote>



<a name="243390144"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233006%20Unable%20to%20compile%20when%20dynamically.../near/243390144" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html#243390144">(Jun 21 2021 at 14:27)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/3006#issuecomment-865078508">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3006">issue #3006</a>:</p>
<blockquote>
<p>Thanks for the report! This should be fixed in <a href="https://github.com/bytecodealliance/wasmtime/pull/3010">https://github.com/bytecodealliance/wasmtime/pull/3010</a>.</p>
</blockquote>



<a name="243403466"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233006%20Unable%20to%20compile%20when%20dynamically.../near/243403466" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233006.20Unable.20to.20compile.20when.20dynamically.2E.2E.2E.html#243403466">(Jun 21 2021 at 15:54)</a>:</h4>
<p>cfallin closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3006">issue #3006</a>:</p>
<blockquote>
<p>It's known dynamically linking dependencies in large Rust projects can improve compile times to a considerable degree. Facing the following problem when attempting to setup such a workspace:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="err"></span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">[</span><span class="o">?</span><span class="p">]</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="err">📦</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="err">🦀</span><span class="w"> </span><span class="n">v1</span><span class="p">.</span><span class="mf">54.0</span><span class="o">-</span><span class="n">nightly</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">7</span><span class="n">s</span><span class="w"></span>
<span class="err">❯</span><span class="w"> </span><span class="n">cargo</span><span class="w"> </span><span class="n">r</span><span class="w"></span>
<span class="w">    </span><span class="o">....</span><span class="w"> </span><span class="o">&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">crates</span><span class="o">&gt;..</span><span class="p">.</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">deps</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">deps</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">dylink</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">dylink</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Compiling</span><span class="w"> </span><span class="n">wasmtime_dylink_issue</span><span class="w"> </span><span class="n">v0</span><span class="p">.</span><span class="mf">1.0</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="p">)</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">linking</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">cc</span><span class="err">`</span><span class="w"> </span><span class="n">failed</span>: <span class="nc">exit</span><span class="w"> </span><span class="n">status</span>: <span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="s">"cc"</span><span class="w"> </span><span class="s">"-m64"</span><span class="w"> </span><span class="s">"-Wl,--eh-frame-hdr"</span><span class="w"> </span><span class="s">"-Wl,-znoexecstack"</span><span class="w"> </span><span class="s">"-Wl,--as-needed"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.176re6pgxyy8ex5.rcgu.o"</span><span class="w"> </span><span class="o">......&lt;</span><span class="n">loads</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">files</span><span class="o">&gt;......</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea.yqhnz0r7qoxxab5.rcgu.o"</span><span class="w"> </span><span class="s">"-o"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps/wasmtime_dylink_issue-223c9046feaa7cea"</span><span class="w"> </span><span class="s">"-Wl,--gc-sections"</span><span class="w"> </span><span class="s">"-pie"</span><span class="w"> </span><span class="s">"-Wl,-zrelro"</span><span class="w"> </span><span class="s">"-Wl,-znow"</span><span class="w"> </span><span class="s">"-nodefaultlibs"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/psm-04165501c77b945c/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/zstd-sys-0f0a0a67e9ce9bc7/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-fiber-8ff9cbc1eca6d35f/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/build/wasmtime-runtime-2bce6ad7a15d697a/out"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/Source/rust/wasmtime_dylink_issue/target/debug/deps"</span><span class="w"> </span><span class="s">"-ldylink"</span><span class="w"> </span><span class="s">"-Wl,--start-group"</span><span class="w"> </span><span class="s">"-L"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span><span class="w"> </span><span class="s">"-lstd-c6dddd3d354e6bea"</span><span class="w"> </span><span class="s">"-Wl,--end-group"</span><span class="w"> </span><span class="s">"-Wl,-Bstatic"</span><span class="w"> </span><span class="s">"/home/user/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-8b33f9cbbc9652fe.rlib"</span><span class="w"> </span><span class="s">"-Wl,-Bdynamic"</span><span class="w"> </span><span class="s">"-lgcc_s"</span><span class="w"> </span><span class="s">"-lutil"</span><span class="w"> </span><span class="s">"-lrt"</span><span class="w"> </span><span class="s">"-lpthread"</span><span class="w"> </span><span class="s">"-lm"</span><span class="w"> </span><span class="s">"-ldl"</span><span class="w"> </span><span class="s">"-lc"</span><span class="w"></span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">note</span>: <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ld</span>: <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">Source</span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">wasmtime_dylink_issue</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">wasmtime_dylink_issue223c9046feaa7cea</span><span class="p">.</span><span class="mi">3</span><span class="n">nou4ari0sahe2y2</span><span class="p">.</span><span class="n">rcgu</span><span class="p">.</span><span class="n">o</span>: <span class="nc">in</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_runtime</span>::<span class="n">traphandlers</span>::<span class="n">catch_traps</span>::<span class="p">{{</span><span class="n">closure</span><span class="p">}}</span><span class="o">'</span>:
          <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="p">.</span><span class="n">cargo</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">wasmtime</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="mf">0.28.0</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">traphandlers</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">180</span>: <span class="nc">undefined</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">RegisterSetjmp</span><span class="o">'</span><span class="w"></span>
<span class="w">          </span><span class="n">collect2</span>: <span class="nc">error</span>: <span class="nc">ld</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"></span>


<span class="n">error</span>: <span class="nc">aborting</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="n">emitted</span><span class="w"></span>

<span class="n">error</span>: <span class="nc">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="err">`</span><span class="n">wasmtime_dylink_issue</span><span class="err">`</span><span class="w"></span>

<span class="n">To</span><span class="w"> </span><span class="n">learn</span><span class="w"> </span><span class="n">more</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<p><a href="https://github.com/skorpi-and-friends/wasmtime_dylink_issue">Repo to recreate bug.</a></p>
<p>Similar issue when using the llvm linker.</p>
<p>Not exactly a traditional bug, I know, but would really appreciate any recs for getting past this.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>