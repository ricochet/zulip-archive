<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1740 runtime: handle traps on Windows x32 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html">wasmtime / PR #1740 runtime: handle traps on Windows x32</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="198359551"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198359551" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198359551">(May 21 2020 at 18:42)</a>:</h4>
<p>whitequark opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1740">PR #1740</a> from <code>x32-windows-traps</code> to <code>master</code>:</p>
<blockquote>
<p>This PR is a small incremental step towards a working Windows x32 backend. It implements what I believe is the correct approach to handling traps on x86_32 Windows, which is based on my understanding of x32 SEH: there is no global unwind registry at all, and instead SEH frames are pushed onto stack. Therefore no registration is needed. However I am by no means a Windows expert and my understanding might be incorrect.</p>
<p>There is no way to actually run code on Windows x32 yet because the fastcall ABI isn't implemented. I'll add that in a follow-up PR. I have a working prototype that can print <code>Hello, World</code> but it has some missing parts and requires major cleanup to be upstreamed.</p>
</blockquote>



<a name="198360724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198360724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198360724">(May 21 2020 at 18:52)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#pullrequestreview-416404685">PR Review</a>.</p>



<a name="198360725"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198360725" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198360725">(May 21 2020 at 18:52)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#pullrequestreview-416404685">PR Review</a>.</p>



<a name="198360726"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198360726" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198360726">(May 21 2020 at 18:52)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#discussion_r428847024">PR Review Comment</a>:</p>
<blockquote>
<p>I'm not entirely certain where this ends up being used elsewhere, but should this presumably return an error? We could then specifically ignore the error somewhere else or have some form of error handling?</p>
<p>(I'm not sure where errors here end up)</p>
</blockquote>



<a name="198361162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198361162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198361162">(May 21 2020 at 18:55)</a>:</h4>
<p>whitequark submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#pullrequestreview-416407398">PR Review</a>.</p>



<a name="198361163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198361163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198361163">(May 21 2020 at 18:55)</a>:</h4>
<p>whitequark created <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#discussion_r428849192">PR Review Comment</a>:</p>
<blockquote>
<p>The error would end up here: <a href="https://github.com/bytecodealliance/wasmtime/blob/68f0d2f6d0c84c090b590d3bda60369e7e45eac7/crates/jit/src/code_memory.rs#L210-L214">https://github.com/bytecodealliance/wasmtime/blob/68f0d2f6d0c84c090b590d3bda60369e7e45eac7/crates/jit/src/code_memory.rs#L210-L214</a></p>
<p>I think you're right and we should return an error here, since in that function <code>func.unwind_info == None</code> on x32 and this function would end up being never called at all.</p>
</blockquote>



<a name="198361600"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198361600" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198361600">(May 21 2020 at 18:59)</a>:</h4>
<p>whitequark updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1740">PR #1740</a> from <code>x32-windows-traps</code> to <code>master</code>:</p>
<blockquote>
<p>This PR is a small incremental step towards a working Windows x32 backend. It implements what I believe is the correct approach to handling traps on x86_32 Windows, which is based on my understanding of x32 SEH: there is no global unwind registry at all, and instead SEH frames are pushed onto stack. Therefore no registration is needed. However I am by no means a Windows expert and my understanding might be incorrect.</p>
<p>There is no way to actually run code on Windows x32 yet because the fastcall ABI isn't implemented. I'll add that in a follow-up PR. I have a working prototype that can print <code>Hello, World</code> but it has some missing parts and requires major cleanup to be upstreamed.</p>
</blockquote>



<a name="198361616"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198361616" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198361616">(May 21 2020 at 18:59)</a>:</h4>
<p>whitequark submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#pullrequestreview-416409716">PR Review</a>.</p>



<a name="198361617"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198361617" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198361617">(May 21 2020 at 18:59)</a>:</h4>
<p>whitequark created <a href="https://github.com/bytecodealliance/wasmtime/pull/1740#discussion_r428851046">PR Review Comment</a>:</p>
<blockquote>
<p>Fixed</p>
</blockquote>



<a name="198370043"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231740%20runtime%3A%20handle%20traps%20on%20Windows%20x32/near/198370043" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231740.20runtime.3A.20handle.20traps.20on.20Windows.20x32.html#198370043">(May 21 2020 at 20:07)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1740">PR #1740</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>