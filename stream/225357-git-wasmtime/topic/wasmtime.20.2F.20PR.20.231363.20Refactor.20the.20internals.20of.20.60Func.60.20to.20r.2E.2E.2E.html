<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1363 Refactor the internals of `Func` to r... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html">wasmtime / PR #1363 Refactor the internals of `Func` to r...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="191127062"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191127062" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191127062">(Mar 19 2020 at 15:11)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191127286"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191127286" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191127286">(Mar 19 2020 at 15:12)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191132935"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191132935" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191132935">(Mar 19 2020 at 15:51)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191133333"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191133333" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191133333">(Mar 19 2020 at 15:54)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191147571"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191147571" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191147571">(Mar 19 2020 at 17:28)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191152497"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191152497" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191152497">(Mar 19 2020 at 18:01)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377950318" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377950318">PR Review</a>.</p>



<a name="191152499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191152499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191152499">(Mar 19 2020 at 18:01)</a>:</h4>
<p>sunfishcode submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377950318" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377950318">PR Review</a>.</p>



<a name="191152500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191152500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191152500">(Mar 19 2020 at 18:01)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395214918" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395214918">PR Review Comment</a>:</p>
<blockquote>
<p>Can this use <code>.add</code> instead of <code>.offset</code> with a cast?</p>
</blockquote>



<a name="191152501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191152501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191152501">(Mar 19 2020 at 18:01)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395208378" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395208378">PR Review Comment</a>:</p>
<blockquote>
<p>While we're here, instead of casting to <code>*mut u8</code>, could we change the signature of <code>wasmtime_call_trampoline</code> to expect a <code>*mut u128</code>? And maybe we can also rename <code>wasmtime_call_trampoline</code> to just <code>call_trampoline</code>, since we're qualifiying it with the crate name here anyway.</p>
</blockquote>



<a name="191152502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191152502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191152502">(Mar 19 2020 at 18:01)</a>:</h4>
<p>sunfishcode created <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395206235" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395206235">PR Review Comment</a>:</p>
<blockquote>
<p>We use <code>u128</code> for values in a lot of places, Is there a reason to prefer <code>i128</code> here?</p>
<p>Random idea, don't feel obliged to do this here, but we could also introduce a new type, like <code>VMValue</code> or so, which has the size and alignment of a <code>u128</code>, that we could use instead of <code>u128</code> everywhere, to help document the intent.</p>
</blockquote>



<a name="191153491"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191153491" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191153491">(Mar 19 2020 at 18:08)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377972926" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#pullrequestreview-377972926">PR Review</a>.</p>



<a name="191153493"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191153493" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191153493">(Mar 19 2020 at 18:08)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395223794" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363#discussion_r395223794">PR Review Comment</a>:</p>
<blockquote>
<p>Nah this was just carried over from the original implementation, I'll switch it all to u128</p>
</blockquote>



<a name="191154026"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191154026" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191154026">(Mar 19 2020 at 18:12)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191154549"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191154549" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191154549">(Mar 19 2020 at 18:17)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191162786"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191162786" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191162786">(Mar 19 2020 at 19:21)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a> from <code>less-traits</code> to <code>master</code>:</p>
<blockquote>
<p>This commit simplifies <code>Func</code> and its API through a few avenues:</p>
<ul>
<li>The <code>callable</code> module is removed in favor of always calling functions through their trampoline (now that we always have one)</li>
<li>The <code>Callable</code> trait is removed in favor of just using an <code>impl Fn()</code> argument</li>
<li>The <code>Func::new</code> method is now generic and no longer requires an explicit <code>Rc</code> allocation</li>
<li>The <code>Func::new</code> closure now takes a leading <code>&amp;Caller</code> argument to empower it with the same capabilities of <code>Func::wrap</code></li>
</ul>
</blockquote>



<a name="191162793"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231363%20Refactor%20the%20internals%20of%20%60Func%60%20to%20r.../near/191162793" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231363.20Refactor.20the.20internals.20of.20.60Func.60.20to.20r.2E.2E.2E.html#191162793">(Mar 19 2020 at 19:21)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/1363" target="_blank" title="https://github.com/bytecodealliance/wasmtime/pull/1363">PR #1363</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>