<html>
<head><meta charset="utf-8"><title>wasmtime / issue #7326 Add support for components to `was... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html">wasmtime / issue #7326 Add support for components to `was...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="397971245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/397971245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#397971245">(Oct 22 2023 at 20:47)</a>:</h4>
<p>lann opened <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<p>You can currently call a core module export with <code>wasmtime run --invoke &lt;func&gt; &lt;module.wasm&gt; [params...]</code>, but <a href="https://github.com/bytecodealliance/wasmtime/blob/b995e2f20805b104636019e1b4f8dfe35e1eaf3e/src/commands/run.rs#L450">using <code>--invoke</code> with components is not supported</a>.</p>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this. </p>
<p>I see a few ways that WAVE could be used here:</p>
<ol>
<li>
<p>The simplest extension of the existing feature would just add WAVE parsing for params:<br>
<code>wasmtime run --invoke my-func component.wasm '"arg1"' 2 '[3,4]'</code></p>
</li>
<li>
<p>A variation of this could allow "undelimited" values (which would require further spec/implementation work), e.g.:<br>
<code>wasmtime run --invoke my-func component.wasm arg1 2 3,4</code></p>
</li>
<li>
<p>A more radical change would be to change the way arguments are passed to look more like a "normal" function call, which might help with <a href="https://github.com/bytecodealliance/wasmtime/issues/6794">some confusion</a> with the existing <code>--invoke</code> syntax:<br>
<code>wasmtime run --invoke 'my-func("arg1", 2, [3, 4])'</code> component.wasm</p>
</li>
<li>
<p>Make some other even more radical (breaking, probably) change to how <code>--invoke</code> works </p>
</li>
</ol>
<p>I have implemented <a href="https://github.com/lann/wave-tank">a prototype</a> of the "function call" encoding option 3, though I would actually prefer the "undelimited" option 2 if the params could appear immediately after the function name.</p>
</blockquote>



<a name="397971812"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/397971812" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#397971812">(Oct 22 2023 at 20:59)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1774197415">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<p>Another open question here would be how to reference functions that aren't top-level exports, e.g. something like <code>wasi:cli/run@0.2.0-rc-2023-11-05::run()</code>, though hopefully we can have something a little nicer than that.</p>
</blockquote>



<a name="398159687"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/398159687" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#398159687">(Oct 23 2023 at 21:38)</a>:</h4>
<p>lann edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1774197415">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<p>Another open question here would be how to reference functions that aren't top-level exports, e.g. something like <code>wasi:cli/run@0.2.0-rc-2023-11-05::run()</code>, though hopefully we can have something a little nicer than that.</p>
<p>Update: A suggestion from @pchickey <a href="#narrow/stream/223391-wasm/topic/WAVE/near/398157307">on Zulip</a> is to allow the "path" to a function export to be omitted as long as the result isn't ambiguous. We'd still presumably want some way to disambiguate if necessary but that sounds good to me.<br>
</p>
</blockquote>



<a name="398162403"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/398162403" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#398162403">(Oct 23 2023 at 22:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1776097771">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>



<a name="418821817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418821817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418821817">(Jan 30 2024 at 12:03)</a>:</h4>
<p>HarikrishnanBalagopal <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<p>Is there any update on this issue?</p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
</blockquote>



<a name="418821849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418821849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418821849">(Jan 30 2024 at 12:03)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
</blockquote>



<a name="418822408"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418822408" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418822408">(Jan 30 2024 at 12:07)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.<br>
</p>
</blockquote>
</blockquote>



<a name="418822513"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418822513" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418822513">(Jan 30 2024 at 12:07)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="cp">$</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">wasm</span><span class="o">-</span><span class="n">features</span><span class="w"> </span><span class="n">component</span><span class="o">-</span><span class="n">model</span><span class="w"> </span><span class="o">--</span><span class="n">invoke</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">add</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span>
<span class="n">Error</span>: <span class="nc">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="err">`</span><span class="n">add</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">wasm</span><span class="err">`</span>

<span class="n">Caused</span><span class="w"> </span><span class="n">by</span>:
    <span class="nc">using</span><span class="w"> </span><span class="err">`</span><span class="o">--</span><span class="n">invoke</span><span class="err">`</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">components</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">supported</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="418822527"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418822527" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418822527">(Jan 30 2024 at 12:07)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm-features<span class="w"> </span>component-model<span class="w"> </span>--invoke<span class="w"> </span>add<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>using<span class="w"> </span><span class="sb">`</span>--invoke<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>components<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported
</code></pre></div><br>
</p>
</blockquote>



<a name="418823642"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418823642" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418823642">(Jan 30 2024 at 12:15)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code></p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>--version
wasmtime-cli<span class="w"> </span><span class="m">17</span>.0.0<span class="w"> </span><span class="o">(</span>ab5a4484e<span class="w"> </span><span class="m">2024</span>-01-25<span class="o">)</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm<span class="w"> </span>component-model<span class="o">=</span>y<span class="w"> </span>--invoke<span class="o">=</span>add<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>using<span class="w"> </span><span class="sb">`</span>--invoke<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>components<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported
</code></pre></div><br>
</p>
</blockquote>



<a name="418824011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418824011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418824011">(Jan 30 2024 at 12:17)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code><br>
I was very confused seeing that phrase for the first time and wondering what <code>six-to-one</code> had to do with <code>half-dozen</code> <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span> </p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>--version
wasmtime-cli<span class="w"> </span><span class="m">17</span>.0.0<span class="w"> </span><span class="o">(</span>ab5a4484e<span class="w"> </span><span class="m">2024</span>-01-25<span class="o">)</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm<span class="w"> </span>component-model<span class="o">=</span>y<span class="w"> </span>--invoke<span class="o">=</span>add<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>using<span class="w"> </span><span class="sb">`</span>--invoke<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>components<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported
</code></pre></div><br>
</p>
</blockquote>



<a name="418824302"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418824302" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418824302">(Jan 30 2024 at 12:19)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code><br>
I was very confused seeing that phrase for the first time and wondering what <code>six-to-one</code> had to do with <code>half-dozen</code> <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span> </p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue now that WASI preview 2 has been officially released?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>--version
wasmtime-cli<span class="w"> </span><span class="m">17</span>.0.0<span class="w"> </span><span class="o">(</span>ab5a4484e<span class="w"> </span><span class="m">2024</span>-01-25<span class="o">)</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm<span class="w"> </span>component-model<span class="o">=</span>y<span class="w"> </span>--invoke<span class="o">=</span>add<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>using<span class="w"> </span><span class="sb">`</span>--invoke<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>components<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported
</code></pre></div><br>
</p>
</blockquote>



<a name="418824685"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418824685" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418824685">(Jan 30 2024 at 12:22)</a>:</h4>
<p>HarikrishnanBalagopal edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916695085">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>I think adding this is a great idea, and I like the idea of having a well-defined encoding for types-to-strings-and-back like WAVE, so I'm all for this <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span>. As to the bikesheddy details, I'm down to defer to you and see how it plays out over time, these are all six-to-one-half-dozen to me.</p>
</blockquote>
<p><code>six-of-one</code><br>
I was very confused seeing that phrase for the first time and wondering what <code>six-to-one</code> had to do with <code>half-dozen</code> <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span> </p>
<blockquote>
<p>While it should (presumably) be fairly straightforward to add support for invoking nullary functions, it would be much more useful to be able to pass arguments, which brings up the challenge of encoding complex parameter values. I have developed a component model value encoding (and library) called <a href="https://github.com/lann/wave">WAVE</a> which could be used for this.</p>
</blockquote>
<p>Is there any update on this issue now that WASI preview 2 has been officially released?</p>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
<p>I came here from the tutorial on wasm component model <a href="https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools">https://component-model.bytecodealliance.org/language-support.html#building-a-component-with-wasm-tools</a></p>
<blockquote>
<p>Running a Component with Wasmtime</p>
</blockquote>
<blockquote>
<p>You can "run" a component by calling one of its exports. Hosts and runtimes often only support running components with certain exports. The <a href="https://github.com/bytecodealliance/wasmtime">wasmtime</a> CLI can only run "command" components, so in order to run the add function above, it first must be composed with a primary "command" component that calls it. See <a href="https://component-model.bytecodealliance.org/creating-and-consuming/running.html">documentation on running components</a> for more details.</p>
</blockquote>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>$<span class="w"> </span>wasmtime<span class="w"> </span>--version
wasmtime-cli<span class="w"> </span><span class="m">17</span>.0.0<span class="w"> </span><span class="o">(</span>ab5a4484e<span class="w"> </span><span class="m">2024</span>-01-25<span class="o">)</span>
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm<span class="w"> </span>component-model<span class="o">=</span>y<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>exported<span class="w"> </span>instance<span class="w"> </span><span class="sb">`</span>wasi:cli/run@0.2.0<span class="sb">`</span><span class="w"> </span>not<span class="w"> </span>present
$<span class="w"> </span>wasmtime<span class="w"> </span>run<span class="w"> </span>--wasm<span class="w"> </span>component-model<span class="o">=</span>y<span class="w"> </span>--invoke<span class="o">=</span>add<span class="w"> </span>add.component.wasm
Error:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>main<span class="w"> </span>module<span class="w"> </span><span class="sb">`</span>add.component.wasm<span class="sb">`</span>

Caused<span class="w"> </span>by:
<span class="w">    </span>using<span class="w"> </span><span class="sb">`</span>--invoke<span class="sb">`</span><span class="w"> </span>with<span class="w"> </span>components<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported
</code></pre></div><br>
</p>
</blockquote>



<a name="418839100"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%237326%20Add%20support%20for%20components%20to%20%60was.../near/418839100" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.237326.20Add.20support.20for.20components.20to.20.60was.2E.2E.2E.html#418839100">(Jan 30 2024 at 13:48)</a>:</h4>
<p>lann <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1916891504">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/7326">issue #7326</a>:</p>
<blockquote>
<blockquote>
<p>Is there any update on this issue now that WASI preview 2 has been officially released?</p>
</blockquote>
<p>I think this just hasn't been a priority for anyone. WAVE has evolved a bit in the interim and is expected to make an appearance in some other Bytecode Alliance tooling pretty soon which should help iron out any remaining bugs or process issues.</p>
<blockquote>
<p>If it's too difficult to implement full parameter passing from the CLI, what about just supporting nullary (and possibly integer) functions for now?</p>
</blockquote>
<p>I think this would be entirely fine as a first step. There is <a href="https://github.com/bytecodealliance/wasmtime/issues/7326#issuecomment-1774197415">some nuance</a> just in identifying an export, but I don't see much downside to starting with a very constrained/explicit implementation (nullary, fully-qualified export name), especially if there is a rough idea of how to extend it from there.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>