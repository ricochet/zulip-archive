<html>
<head><meta charset="utf-8"><title>wasmtime / Issue #1678 Can&#x27;t mutate state from Funcs pass... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231678.20Can.27t.20mutate.20state.20from.20Funcs.20pass.2E.2E.2E.html">wasmtime / Issue #1678 Can&#x27;t mutate state from Funcs pass...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="197094096"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231678%20Can%27t%20mutate%20state%20from%20Funcs%20pass.../near/197094096" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231678.20Can.27t.20mutate.20state.20from.20Funcs.20pass.2E.2E.2E.html#197094096">(May 11 2020 at 02:43)</a>:</h4>
<p>J0eCool opened <a href="https://github.com/bytecodealliance/wasmtime/issues/1678" title="https://github.com/bytecodealliance/wasmtime/issues/1678">Issue #1678</a>:</p>
<blockquote>
<p>Trying to build a graphical application using the wasmtime Rust API, using the <a href="https://docs.rs/sdl2/0.34.0/sdl2/" title="https://docs.rs/sdl2/0.34.0/sdl2/">sdl2 crate</a>, I run in to the issue that SDL's drawing methods take a mutable reference to the screen, and using those from a closure passed to <code>Func::wrap</code> gives me the error</p>
<blockquote>
<p>error[E0525]: expected a closure that implements the <code>Fn</code> trait, but this closure only implements <code>FnMut</code></p>
</blockquote>
<h4>Feature</h4>
<p>Let the closure argument to <code>Func::wrap</code> derive from <code>FnMut</code> instead of <code>Fn</code></p>
<h4>Benefit</h4>
<p>This should allow embedder applications more freedom to build wasm modules that interact with the outside world in stateful ways</p>
</blockquote>



<a name="197151275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231678%20Can%27t%20mutate%20state%20from%20Funcs%20pass.../near/197151275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231678.20Can.27t.20mutate.20state.20from.20Funcs.20pass.2E.2E.2E.html#197151275">(May 11 2020 at 14:15)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/issues/1678#issuecomment-626728633">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/1678">Issue #1678</a>:</p>
<blockquote>
<p>Thanks for the report! This is required for safety when using wasm modules, however, so it's not something that we can fix. Host functions can be called recursively if they, for example, reenter wasm and then get called again.</p>
<p>You can get mutation through interior mutability in Rust, however, for example through <code>RefCell</code> or <code>Cell</code>.</p>
</blockquote>



<a name="197151276"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20Issue%20%231678%20Can%27t%20mutate%20state%20from%20Funcs%20pass.../near/197151276" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20Issue.20.231678.20Can.27t.20mutate.20state.20from.20Funcs.20pass.2E.2E.2E.html#197151276">(May 11 2020 at 14:15)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/1678">Issue #1678</a>:</p>
<blockquote>
<p>Trying to build a graphical application using the wasmtime Rust API, using the <a href="https://docs.rs/sdl2/0.34.0/sdl2/">sdl2 crate</a>, I run in to the issue that SDL's drawing methods take a mutable reference to the screen, and using those from a closure passed to <code>Func::wrap</code> gives me the error</p>
<blockquote>
<p>error[E0525]: expected a closure that implements the <code>Fn</code> trait, but this closure only implements <code>FnMut</code></p>
</blockquote>
<h4>Feature</h4>
<p>Let the closure argument to <code>Func::wrap</code> derive from <code>FnMut</code> instead of <code>Fn</code></p>
<h4>Benefit</h4>
<p>This should allow embedder applications more freedom to build wasm modules that interact with the outside world in stateful ways</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>