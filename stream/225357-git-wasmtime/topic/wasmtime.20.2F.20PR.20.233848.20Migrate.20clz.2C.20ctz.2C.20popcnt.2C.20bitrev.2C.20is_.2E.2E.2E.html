<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3848 Migrate clz, ctz, popcnt, bitrev, is_... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html">wasmtime / PR #3848 Migrate clz, ctz, popcnt, bitrev, is_...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="273184078"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273184078" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273184078">(Feb 25 2022 at 03:08)</a>:</h4>
<p>cfallin edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3848">PR #3848</a> from <code>isle-bitops</code> to <code>main</code>:</p>
<blockquote>
<p>Along the way this introduces a few new utility bits to the ISLE bindings, e.g. some constructors to do integer arithmetic on constants (I'm surprised we got this far without it!). The bit-twiddling algorithms are, at least to my eye, a bit more legible in this form, but I'm happy to add more comments here if desired since we're making a pass over everything anyway.</p>
<p>Also updated a few stray places I had missed earlier where we can use implicit conversions (the <code>def_inst</code> removals).</p>
</blockquote>



<a name="273253647"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253647" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253647">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893903735">PR review</a>.</p>



<a name="273253649"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253649" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253649">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893903735">PR review</a>.</p>



<a name="273253650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253650">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814911847">PR review comment</a>:</p>
<blockquote>
<p>It seems weird that these extractors (and above) are in any way related to <code>Type</code>... logically confusing, I can see the pragmatic part of it.</p>
</blockquote>



<a name="273253651"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253651" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253651">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814922331">PR review comment</a>:</p>
<blockquote>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>
</blockquote>



<a name="273253652"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253652" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253652">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814915810">PR review comment</a>:</p>
<blockquote>
<p>The <code>CMOV</code> here uses <code>BSR</code>'s flag-setting behavior to work correctly. Just to check: we don't need to use <code>ConsumesFlags/ProducesFlags</code> here because these instructions are back-to-back and emitted in order? If that is the case, is a comment to that effect useful here?</p>
</blockquote>



<a name="273253653"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253653" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253653">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814929960">PR review comment</a>:</p>
<blockquote>
<p>The comments below are pretty helpful; any high-level comments here that explain the general gist of how this is counting bits?</p>
</blockquote>



<a name="273253654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253654">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814912314">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>;; Helper for emitting immediates with an `i64` value. Note that
</code></pre></div><br>
</p>
</blockquote>



<a name="273253655"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253655" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253655">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814921568">PR review comment</a>:</p>
<blockquote>
<p>(Also, if this is allowed, then shouldn't the new <code>CmoveOr</code> and <code>XmmCmoveOr</code> sequences have been written in ISLE?)</p>
</blockquote>



<a name="273253656"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273253656" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273253656">(Feb 25 2022 at 16:54)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814928674">PR review comment</a>:</p>
<blockquote>
<div class="codehilite" data-code-language="suggestion"><pre><span></span><code>;; For SSE4.2 we use Mula's algorithm (https://arxiv.org/pdf/1611.07612.pdf)
</code></pre></div>
<p>?</p>
</blockquote>



<a name="273256447"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273256447" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273256447">(Feb 25 2022 at 17:12)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893952196">PR review</a>.</p>



<a name="273256449"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273256449" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273256449">(Feb 25 2022 at 17:12)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814946724">PR review comment</a>:</p>
<blockquote>
<p>When I introduced the first of these extractors, I did it this way so that you read them near the type constraints because they are most often related to those, e.g. whether to use AVX512 is related to whether we are lowering a vector type.</p>
<p>/me shrugs</p>
</blockquote>



<a name="273260683"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273260683" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273260683">(Feb 25 2022 at 17:44)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893983636">PR review</a>.</p>



<a name="273260684"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273260684" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273260684">(Feb 25 2022 at 17:44)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814969492">PR review comment</a>:</p>
<blockquote>
<p>Hmm, yeah, I realize now that this is exactly the same circumstance that led me to suggest <code>CmoveOr</code> previously; the output of the bsr is one of the inputs to the cmove. I'm thinking now maybe we can add a new variant to <code>ConsumesFlags</code> for this; I'll play with it a bit, and clean up by removing <code>CmoveOr</code> at the same time if I can work something out. Sorry for the inconsistency and churn!</p>
</blockquote>



<a name="273260807"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273260807" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273260807">(Feb 25 2022 at 17:45)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893984628">PR review</a>.</p>



<a name="273260808"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273260808" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273260808">(Feb 25 2022 at 17:45)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814970304">PR review comment</a>:</p>
<blockquote>
<p>I had copied this comment from <code>lower.rs</code> but it seems that the instructions used only require SSE 4.2 (right?) so I can update accordingly.</p>
</blockquote>



<a name="273261162"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273261162" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273261162">(Feb 25 2022 at 17:48)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-893987299">PR review</a>.</p>



<a name="273261163"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273261163" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273261163">(Feb 25 2022 at 17:48)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r814972278">PR review comment</a>:</p>
<blockquote>
<p>Yup, the advantage is that it lets us use these in a context that's already common. Though I wonder now if it could make sense to have an extractor result value (the input) that is something like a unit type: in other words, the extractor takes nothing as input, but can be used in any context. I'll think more about it; it probably muddies the waters a bit wrt clean/simple semantics; but it could work...</p>
</blockquote>



<a name="273275179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275179">(Feb 25 2022 at 19:37)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3848">PR #3848</a> from <code>isle-bitops</code> to <code>main</code>.</p>



<a name="273275275"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275275" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275275">(Feb 25 2022 at 19:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894085994">PR review</a>.</p>



<a name="273275277"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275277" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275277">(Feb 25 2022 at 19:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r815043272">PR review comment</a>:</p>
<blockquote>
<p>OK, so I've reworked things so that <code>CmoveOr</code>/<code>XmmCmoveOr</code> no longer exist. Thanks for noticing this! The <code>i128</code> case needs a new <code>ConsumesFlags</code> variant that contains four consumer instructions, but this seems reasonable-ish to me.</p>
</blockquote>



<a name="273275284"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275284" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275284">(Feb 25 2022 at 19:38)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894086048">PR review</a>.</p>



<a name="273275285"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275285" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275285">(Feb 25 2022 at 19:38)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r815043310">PR review comment</a>:</p>
<blockquote>
<p>Done!</p>
</blockquote>



<a name="273275363"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275363" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275363">(Feb 25 2022 at 19:39)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894086583">PR review</a>.</p>



<a name="273275364"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273275364" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273275364">(Feb 25 2022 at 19:39)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r815043729">PR review comment</a>:</p>
<blockquote>
<p>Added comments describing how this popcount algorithm works -- it was pretty fun to work out :-)</p>
</blockquote>



<a name="273281583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273281583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273281583">(Feb 25 2022 at 20:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894201466">PR review</a>.</p>



<a name="273281584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273281584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273281584">(Feb 25 2022 at 20:37)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894201466">PR review</a>.</p>



<a name="273281585"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273281585" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273281585">(Feb 25 2022 at 20:37)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r815131936">PR review comment</a>:</p>
<blockquote>
<p>Does it make sense to duplicate <code>(imm $i64 0x7777777777777777)</code> at each use site, rather than reusing the named register, to reduce register pressure?</p>
</blockquote>



<a name="273283063"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273283063" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273283063">(Feb 25 2022 at 20:47)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#pullrequestreview-894219335">PR review</a>.</p>



<a name="273283064"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273283064" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273283064">(Feb 25 2022 at 20:47)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3848#discussion_r815144886">PR review comment</a>:</p>
<blockquote>
<p>I thought about this a bit, but I think it's very likely better to load it once and reuse it: the instruction to load an arbitrary 64-bit value (<code>movabs</code>) is pretty long, the immediate can't fit in the normal <code>simm32</code> so we need a register in any case, and the live-range across 7 instructions is not really any worse than across one (any other value that wants to be live across this sequence will conflict with the register anyway, whether loaded once or loaded three times).</p>
</blockquote>



<a name="273301283"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273301283" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273301283">(Feb 25 2022 at 23:53)</a>:</h4>
<p>cfallin updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3848">PR #3848</a> from <code>isle-bitops</code> to <code>main</code>.</p>



<a name="273526929"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233848%20Migrate%20clz%2C%20ctz%2C%20popcnt%2C%20bitrev%2C%20is_.../near/273526929" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233848.20Migrate.20clz.2C.20ctz.2C.20popcnt.2C.20bitrev.2C.20is_.2E.2E.2E.html#273526929">(Feb 28 2022 at 17:45)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3848">PR #3848</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>