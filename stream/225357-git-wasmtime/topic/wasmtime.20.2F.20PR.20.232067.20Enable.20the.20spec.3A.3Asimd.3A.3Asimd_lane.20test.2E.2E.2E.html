<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2067 Enable the spec::simd::simd_lane test... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html">wasmtime / PR #2067 Enable the spec::simd::simd_lane test...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="204804925"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/204804925" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#204804925">(Jul 23 2020 at 14:32)</a>:</h4>
<p>akirilov-arm opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2067">PR #2067</a> from <code>simd_lane</code> to <code>main</code>:</p>
<blockquote>
<p>This PR enables the <code>spec::simd::simd_lane</code> test for AArch64. Of particular note is that it was necessary to make compromises in the <code>Shuffle</code> implementation because the <code>TBL</code> instruction requires consecutive registers for the table.</p>
</blockquote>



<a name="205169501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205169501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205169501">(Jul 27 2020 at 21:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#pullrequestreview-456137299">PR Review</a>.</p>



<a name="205169502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205169502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205169502">(Jul 27 2020 at 21:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#discussion_r461171684">PR Review Comment</a>:</p>
<blockquote>
<p>Could we expand these doc comments (on <code>VecTbl</code> and <code>VecTbl2</code>) a bit? I went to the manual to understand what tbl/tbx do; but it would be helpful to summarize. Especially the <code>is_extension</code> bit that alters the way that <code>rd</code> is treated (full overwrite vs. conditional one), and the requirement that <code>rn2</code> is immediately after <code>rn</code> for <code>VecTbl2</code>.</p>
</blockquote>



<a name="205169503"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205169503" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205169503">(Jul 27 2020 at 21:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#pullrequestreview-456137299">PR Review</a>.</p>



<a name="205169504"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205169504" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205169504">(Jul 27 2020 at 21:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#discussion_r461174253">PR Review Comment</a>:</p>
<blockquote>
<p>I'd prefer for this helper to retain the <code>Option&lt;u128&gt;</code> return value -- it forces the caller to handle the wrong-instruction-type case explicitly with something like <code>const_param_to_u128(...).expect("Invalid const insn for i128 const")</code> if it should be infallible, or do something else if the input may or may not be a constant.</p>
<p>Actually, ideally, we'd handle <code>u128</code> constants with the same machinery as <code>u64</code> ones, via the <code>constant</code> field on <code>LowerCtx::get_input()</code>'s returned information. This would let us dedup and handle constant pools in the machine-independent code. I'm happy to defer that to later, though!</p>
</blockquote>



<a name="205531676"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205531676" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205531676">(Jul 30 2020 at 20:59)</a>:</h4>
<p>akirilov-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#pullrequestreview-458752190">PR Review</a>.</p>



<a name="205531677"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205531677" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205531677">(Jul 30 2020 at 20:59)</a>:</h4>
<p>akirilov-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#discussion_r463267737">PR Review Comment</a>:</p>
<blockquote>
<p>Just to check my understanding of your idea (otherwise I'd go for the simpler solution for the time being) - I don't think that it would help us for <code>Opcode::Shuffle</code> because the mask is not an input from the point of view of <code>LowerCtx::get_input()</code> (<code>Opcode::Vconst</code> is different, of course).</p>
<p>As for the constant pool improvements - yes, I was keeping that in mind and I think that concentrating the constant handling in as few places as possible would help eventually, hence why I made the changes to this helper. In fact I don't think I understand the practical distinction between <code>DataFlowGraph::constants</code> and <code>DataFlowGraph::immediates</code> - at least in the cases of <code>Opcode::Vconst</code> and <code>Opcode::Shuffle</code> the handling is pretty much equivalent.</p>
</blockquote>



<a name="205552264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205552264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205552264">(Jul 31 2020 at 02:26)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#pullrequestreview-458880312">PR Review</a>.</p>



<a name="205552265"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205552265" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205552265">(Jul 31 2020 at 02:26)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/2067#discussion_r463372667">PR Review Comment</a>:</p>
<blockquote>
<p>Yeah, I am fine with the design suggested in the first paragraph -- just return <code>Option&lt;u128&gt;</code>. I need to do more work to make use of the constant-pool functionality in <code>MachBuffer</code>, so we can revisit this later.</p>
</blockquote>



<a name="205919415"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/205919415" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#205919415">(Aug 04 2020 at 15:13)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2067">PR #2067</a> from <code>simd_lane</code> to <code>main</code>:</p>
<blockquote>
<p>This PR enables the <code>spec::simd::simd_lane</code> test for AArch64. Of particular note is that it was necessary to make compromises in the <code>Shuffle</code> implementation because the <code>TBL</code> instruction requires consecutive registers for the table.</p>
</blockquote>



<a name="206130004"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/206130004" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#206130004">(Aug 06 2020 at 11:43)</a>:</h4>
<p>akirilov-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2067">PR #2067</a> from <code>simd_lane</code> to <code>main</code>:</p>
<blockquote>
<p>This PR enables the <code>spec::simd::simd_lane</code> test for AArch64. Of particular note is that it was necessary to make compromises in the <code>Shuffle</code> implementation because the <code>TBL</code> instruction requires consecutive registers for the table.</p>
</blockquote>



<a name="206172309"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232067%20Enable%20the%20spec%3A%3Asimd%3A%3Asimd_lane%20test.../near/206172309" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232067.20Enable.20the.20spec.3A.3Asimd.3A.3Asimd_lane.20test.2E.2E.2E.html#206172309">(Aug 06 2020 at 17:33)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2067">PR #2067</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>