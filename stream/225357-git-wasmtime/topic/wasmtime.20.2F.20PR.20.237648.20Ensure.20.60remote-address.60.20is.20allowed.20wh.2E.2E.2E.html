<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7648 Ensure `remote-address` is allowed wh... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html">wasmtime / PR #7648 Ensure `remote-address` is allowed wh...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="406350747"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406350747" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406350747">(Dec 06 2023 at 17:14)</a>:</h4>
<p>rylev opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a> from <code>rylev:udp-perform-addr-checking</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Until now, the <code>remote-address</code> argument to <code>wasi:sockets/udp-socket#stream</code> was not checked against the <code>Pool</code> of allowed IP addresses. Now, we store the <code>Pool</code> from <code>network</code> into the <code>socket</code> object in <code>wasi:sockets/udp-socket#bind</code> and later use that <code>Pool</code> in <code>wasi:sockets/udp-socket#stream</code> to check that <code>remote-address</code> is allowed.</p>
<p>The check itself is a bit hacky since <code>Pool</code> doesn't seem to expose a way to just check an address so we use <code>PoolExt</code> to create a <code>UdpConnecter</code> which we will fail if we don't have permission to connect to the remote address.</p>
<p>I can add a test once I figure out the testing story in <a href="https://github.com/bytecodealliance/wasmtime/pull/7647">https://github.com/bytecodealliance/wasmtime/pull/7647</a></p>
</blockquote>



<a name="406350748"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406350748" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406350748">(Dec 06 2023 at 17:14)</a>:</h4>
<p><strong>rylev</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406350749"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406350749" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406350749">(Dec 06 2023 at 17:14)</a>:</h4>
<p><strong>rylev</strong> requested <a href="https://github.com/pchickey">pchickey</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406371930"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406371930" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406371930">(Dec 06 2023 at 19:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1768466222">PR review</a>.</p>



<a name="406371931"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406371931" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406371931">(Dec 06 2023 at 19:28)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1768466222">PR review</a>.</p>



<a name="406371932"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406371932" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406371932">(Dec 06 2023 at 19:28)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1417882465">PR review comment</a>:</p>
<blockquote>
<p>Could this be done after the state validation below? That'd help prevent odd situations such as calling this multiple times just to switch the network while having the method return an error.</p>
</blockquote>



<a name="406507846"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406507846" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406507846">(Dec 07 2023 at 09:56)</a>:</h4>
<p>badeend submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1769687595">PR review</a>.</p>



<a name="406507848"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406507848" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406507848">(Dec 07 2023 at 09:56)</a>:</h4>
<p>badeend submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1769687595">PR review</a>.</p>



<a name="406507849"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406507849" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406507849">(Dec 07 2023 at 09:56)</a>:</h4>
<p>badeend created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1418693074">PR review comment</a>:</p>
<blockquote>
<p>Might not be the prettiest solution, but: could we use this same workaround to validate the remote address in unconnected outgoing datagram streams?</p>
</blockquote>



<a name="406507850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406507850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406507850">(Dec 07 2023 at 09:56)</a>:</h4>
<p>badeend created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1418690673">PR review comment</a>:</p>
<blockquote>
<p>@rylev  Don't know if this was your intention, but this creates a full copy of the entire pool for each socket.</p>
</blockquote>



<a name="406509406"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406509406" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406509406">(Dec 07 2023 at 10:04)</a>:</h4>
<p>rylev submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1769708802">PR review</a>.</p>



<a name="406509407"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406509407" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406509407">(Dec 07 2023 at 10:04)</a>:</h4>
<p>rylev created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1418704190">PR review comment</a>:</p>
<blockquote>
<p>Yea, the clone shouldn't be too expensive, but if we're worried about allocations here, I can wrap this in an <code>Arc</code>. </p>
</blockquote>



<a name="406513185"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406513185" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406513185">(Dec 07 2023 at 10:26)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406513771"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406513771" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406513771">(Dec 07 2023 at 10:30)</a>:</h4>
<p>rylev <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#issuecomment-1845087140">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>:</p>
<blockquote>
<p>I've addressed the PR feedback:</p>
<ul>
<li>Pool is now wrapped in an <code>Arc</code> to make cloning cheaper.</li>
<li><code>HostOutgoingDatagramStream</code> will check the provided addr against the <code>Pool</code> before sending a datagram.</li>
</ul>
<p>@alexcrichton I'm not sure what the testing story should look like here. I don't see where the wasi implementations are being tested against non-default <code>WasiCtx</code>s. I believe all tests are running with full network. I suppose whatever solution we decide on here should also work for #7647 as well.</p>
</blockquote>



<a name="406566959"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406566959" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406566959">(Dec 07 2023 at 15:29)</a>:</h4>
<p>alexcrichton closed without merge <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406566961"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406566961" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406566961">(Dec 07 2023 at 15:29)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#issuecomment-1845554783">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>:</p>
<blockquote>
<p>I wrote up some thoughts <a href="https://github.com/bytecodealliance/wasmtime/pull/7647#issuecomment-1845552342">here</a> for how this might be tested (in case anyone lands on this PR in the future)</p>
</blockquote>



<a name="406566969"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406566969" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406566969">(Dec 07 2023 at 15:29)</a>:</h4>
<p>alexcrichton reopened <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406617805"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406617805" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406617805">(Dec 07 2023 at 20:44)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406633499"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406633499" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406633499">(Dec 07 2023 at 22:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1771255087">PR review</a>.</p>



<a name="406633500"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406633500" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406633500">(Dec 07 2023 at 22:47)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1771255087">PR review</a>.</p>



<a name="406633501"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406633501" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406633501">(Dec 07 2023 at 22:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1419740132">PR review comment</a>:</p>
<blockquote>
<p>(same below too)</p>
</blockquote>



<a name="406633502"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406633502" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406633502">(Dec 07 2023 at 22:47)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1419740010">PR review comment</a>:</p>
<blockquote>
<p>Could this start as <code>None</code> to represent that it's bound-late? That could also help overwriting it by accident by only writing to it if it's <code>None</code></p>
</blockquote>



<a name="406716505"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406716505" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406716505">(Dec 08 2023 at 09:04)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406718001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406718001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406718001">(Dec 08 2023 at 09:14)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406718011"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406718011" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406718011">(Dec 08 2023 at 09:14)</a>:</h4>
<p>rylev submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1771900259">PR review</a>.</p>



<a name="406718013"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406718013" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406718013">(Dec 08 2023 at 09:14)</a>:</h4>
<p>rylev created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1420153471">PR review comment</a>:</p>
<blockquote>
<p>Pushed a change that does this, but I have a question about the exact desired semantics of <code>start-bind</code>. Take the following_example:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="c1">// `bad_addr` is an address that is not permitted</span>
<span class="fm">assert!</span><span class="p">(</span><span class="n">sock</span><span class="p">.</span><span class="n">start_bind</span><span class="p">(</span><span class="n">bad_addr</span><span class="p">).</span><span class="n">is_err</span><span class="p">());</span>
<span class="c1">// `good_addr` is permitted</span>
<span class="n">sock</span><span class="p">.</span><span class="n">start_bind</span><span class="p">(</span><span class="n">good_addr</span><span class="p">);</span>
</code></pre></div>
<p>As currently written the second call to <code>start-bind</code> will fail with <code>InvalidState</code> since the pool has already been set on the socket. Is this right? Previously, this would have succeeded. I would imagine that <code>start_bind</code> should be allowed to be called multiple times as long as the socket has not successfully been bound before.</p>
</blockquote>



<a name="406773795"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406773795" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406773795">(Dec 08 2023 at 14:47)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406778045"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406778045" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406778045">(Dec 08 2023 at 15:08)</a>:</h4>
<p>rylev updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="406778964"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406778964" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406778964">(Dec 08 2023 at 15:13)</a>:</h4>
<p>rylev submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1772597627">PR review</a>.</p>



<a name="406778966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406778966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406778966">(Dec 08 2023 at 15:13)</a>:</h4>
<p>rylev created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1420627596">PR review comment</a>:</p>
<blockquote>
<p>I removed the check that the pool was not previously set as this broke some tests. Once we decide on what the semantics should be, I can adjust.</p>
</blockquote>



<a name="406790781"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406790781" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406790781">(Dec 08 2023 at 16:11)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1772737577">PR review</a>.</p>



<a name="406790783"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406790783" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406790783">(Dec 08 2023 at 16:11)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1420725107">PR review comment</a>:</p>
<blockquote>
<p>cc @badeend on this you are probably best-equipped to answer this</p>
</blockquote>



<a name="406791481"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406791481" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406791481">(Dec 08 2023 at 16:14)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#issuecomment-1847463376">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>:</p>
<blockquote>
<p>I'm gonna go ahead and queue this for merge, and @rylev says they're happy to follow-up on semantic changes in a follow-up.</p>
</blockquote>



<a name="406798409"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/406798409" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#406798409">(Dec 08 2023 at 16:41)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7648">PR #7648</a>.</p>



<a name="407054420"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/407054420" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#407054420">(Dec 10 2023 at 11:27)</a>:</h4>
<p>badeend submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#pullrequestreview-1774015922">PR review</a>.</p>



<a name="407054421"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237648%20Ensure%20%60remote-address%60%20is%20allowed%20wh.../near/407054421" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237648.20Ensure.20.60remote-address.60.20is.20allowed.20wh.2E.2E.2E.html#407054421">(Dec 10 2023 at 11:27)</a>:</h4>
<p>badeend created <a href="https://github.com/bytecodealliance/wasmtime/pull/7648#discussion_r1421732446">PR review comment</a>:</p>
<blockquote>
<p>@rylev </p>
<p>From the API's perspective, unbound sockets (<code>Default</code>) never need a pool, and all other states (<code>BindStarted</code>, <code>Bound</code>, <code>Connected</code>) could've only be reached by calling <code>bind</code> at some point, so they always have access to a pool. A way to codify this could be:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span><span class="w"> </span><span class="k">enum</span> <span class="nc">UdpState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Default</span><span class="p">,</span>
<span class="w">    </span><span class="n">BindStarted</span><span class="p">(</span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">Pool</span><span class="o">&gt;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Bound</span><span class="p">(</span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">Pool</span><span class="o">&gt;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Connected</span><span class="p">(</span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">Pool</span><span class="o">&gt;</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>
<p>Also, OutgoingDatagramStream's <code>pool</code> field doesn't have to be optional, because you can never call <code>stream</code> on an unbound socket.</p>
<hr>
<blockquote>
<p>As currently written the second call to start-bind will fail with InvalidState since the pool has already been set on the socket. Is this right?</p>
</blockquote>
<p>From the caller's perspective, the <code>start-bind</code> call should preferably succeed or fail atomically. Using the enum layout above would _automagically_ fix that.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>