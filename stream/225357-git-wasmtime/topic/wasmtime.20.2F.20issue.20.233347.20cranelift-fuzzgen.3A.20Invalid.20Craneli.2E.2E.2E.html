<html>
<head><meta charset="utf-8"><title>wasmtime / issue #3347 cranelift-fuzzgen: Invalid Craneli... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html">wasmtime / issue #3347 cranelift-fuzzgen: Invalid Craneli...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="253156822"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/253156822" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#253156822">(Sep 13 2021 at 20:41)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Found via oss-fuzz recently <a href="https://github.com/bytecodealliance/wasmtime/files/7157244/repro.gz">this input file</a> when fed into the <code>cranelift-fuzzgen</code> fuzzer as of 4d86f0ca102345555d87eaaa7524acd4260f7607 will generate this panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">VerifierErrors</span><span class="p">([</span><span class="n">VerifierError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">location</span>: <span class="nc">inst3</span><span class="p">,</span><span class="w"> </span><span class="n">context</span>: <span class="nb">Some</span><span class="p">(</span><span class="s">"jump block2(v2)"</span><span class="p">),</span><span class="w"> </span><span class="n">message</span>: <span class="s">"uses value arg from non-dominating block1"</span><span class="w"> </span><span class="p">}])</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">45</span><span class="w"></span>
<span class="o">--</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">AddressSanitizer</span>:<span class="nc">DEADLYSIGNAL</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">=================================================================</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==</span><span class="mi">916</span><span class="o">==</span><span class="n">ERROR</span>: <span class="nc">AddressSanitizer</span>: <span class="nc">ABRT</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0x053900000394</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="mh">0x7ffe46a99210</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="mh">0x7ffe46a98fa0</span><span class="w"> </span><span class="n">T0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">SCARINESS</span>: <span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">sysdeps</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">sysv</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">raise</span><span class="p">.</span><span class="n">c</span>:<span class="mi">51</span>:<span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x7facee41a858</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">abort</span><span class="p">.</span><span class="n">c</span>:<span class="mi">79</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5652cf6ed936</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h810beef058600b40</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5652cdd4eb15</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">heb2aba170fd673de</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1979</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5652cf601a7e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">h579d487df9b334a1</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5652cf6e0c78</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">hc09e869c4cf00885</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">628</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x5652cf6e072f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">hc2c6d70142458fc8</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">521</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x5652cf6dd3a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">had58f7c459a1cd6e</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5652cf6e0698</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">517</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5652cdd4fde0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hf443e5eeb6cc9eab</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">96</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x5652cdd4fed2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h885d3f7beb571353</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1617</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="cp">$LT$T$C$E$GT$</span>::<span class="n">unwrap</span>::<span class="n">h63bc4d7eddd801dc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1299</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x5652cf601bb8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="n">libfuzzer_sys</span><span class="p">.</span><span class="mf">7250e05</span><span class="n">b</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mi">0</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">hdb574c15f35ab6b9</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">367</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">he6e3d6241b2b560d</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">129</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">28</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x5652cf637d73</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x5652cf624a12</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerDriver</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">324</span>:<span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x5652cf62a43b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x5652cf6502e2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerMain</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">20</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x7facee41c0b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x5652cdd5124d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"></span>
</code></pre></div>
<p>cc @afonso360, I think you might be interested in this? Sorry I'm not super familiar with this fuzzer so I'm not sure how to reduce further before handing it off here</p>
</blockquote>



<a name="253156823"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/253156823" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#253156823">(Sep 13 2021 at 20:41)</a>:</h4>
<p>alexcrichton labeled <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Found via oss-fuzz recently <a href="https://github.com/bytecodealliance/wasmtime/files/7157244/repro.gz">this input file</a> when fed into the <code>cranelift-fuzzgen</code> fuzzer as of 4d86f0ca102345555d87eaaa7524acd4260f7607 will generate this panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">VerifierErrors</span><span class="p">([</span><span class="n">VerifierError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">location</span>: <span class="nc">inst3</span><span class="p">,</span><span class="w"> </span><span class="n">context</span>: <span class="nb">Some</span><span class="p">(</span><span class="s">"jump block2(v2)"</span><span class="p">),</span><span class="w"> </span><span class="n">message</span>: <span class="s">"uses value arg from non-dominating block1"</span><span class="w"> </span><span class="p">}])</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">45</span><span class="w"></span>
<span class="o">--</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">AddressSanitizer</span>:<span class="nc">DEADLYSIGNAL</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">=================================================================</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==</span><span class="mi">916</span><span class="o">==</span><span class="n">ERROR</span>: <span class="nc">AddressSanitizer</span>: <span class="nc">ABRT</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0x053900000394</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="mh">0x7ffe46a99210</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="mh">0x7ffe46a98fa0</span><span class="w"> </span><span class="n">T0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">SCARINESS</span>: <span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">sysdeps</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">sysv</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">raise</span><span class="p">.</span><span class="n">c</span>:<span class="mi">51</span>:<span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x7facee41a858</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">abort</span><span class="p">.</span><span class="n">c</span>:<span class="mi">79</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5652cf6ed936</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h810beef058600b40</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5652cdd4eb15</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">heb2aba170fd673de</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1979</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5652cf601a7e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">h579d487df9b334a1</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5652cf6e0c78</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">hc09e869c4cf00885</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">628</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x5652cf6e072f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">hc2c6d70142458fc8</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">521</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x5652cf6dd3a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">had58f7c459a1cd6e</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5652cf6e0698</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">517</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5652cdd4fde0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hf443e5eeb6cc9eab</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">96</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x5652cdd4fed2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h885d3f7beb571353</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1617</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="cp">$LT$T$C$E$GT$</span>::<span class="n">unwrap</span>::<span class="n">h63bc4d7eddd801dc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1299</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x5652cf601bb8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="n">libfuzzer_sys</span><span class="p">.</span><span class="mf">7250e05</span><span class="n">b</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mi">0</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">hdb574c15f35ab6b9</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">367</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">he6e3d6241b2b560d</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">129</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">28</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x5652cf637d73</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x5652cf624a12</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerDriver</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">324</span>:<span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x5652cf62a43b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x5652cf6502e2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerMain</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">20</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x7facee41c0b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x5652cdd5124d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"></span>
</code></pre></div>
<p>cc @afonso360, I think you might be interested in this? Sorry I'm not super familiar with this fuzzer so I'm not sure how to reduce further before handing it off here</p>
</blockquote>



<a name="253156850"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/253156850" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#253156850">(Sep 13 2021 at 20:41)</a>:</h4>
<p>alexcrichton edited <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Found via oss-fuzz recently <a href="https://github.com/bytecodealliance/wasmtime/files/7157244/repro.gz">this input file</a> when fed into the <code>cranelift-fuzzgen</code> fuzzer as of 4d86f0ca102345555d87eaaa7524acd4260f7607 will generate this panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">VerifierErrors</span><span class="p">([</span><span class="n">VerifierError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">location</span>: <span class="nc">inst3</span><span class="p">,</span><span class="w"> </span><span class="n">context</span>: <span class="nb">Some</span><span class="p">(</span><span class="s">"jump block2(v2)"</span><span class="p">),</span><span class="w"> </span><span class="n">message</span>: <span class="s">"uses value arg from non-dominating block1"</span><span class="w"> </span><span class="p">}])</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">45</span><span class="w"></span>
<span class="o">--</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">AddressSanitizer</span>:<span class="nc">DEADLYSIGNAL</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">=================================================================</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==</span><span class="mi">916</span><span class="o">==</span><span class="n">ERROR</span>: <span class="nc">AddressSanitizer</span>: <span class="nc">ABRT</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0x053900000394</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="mh">0x7ffe46a99210</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="mh">0x7ffe46a98fa0</span><span class="w"> </span><span class="n">T0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">SCARINESS</span>: <span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">sysdeps</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">sysv</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">raise</span><span class="p">.</span><span class="n">c</span>:<span class="mi">51</span>:<span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x7facee41a858</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">abort</span><span class="p">.</span><span class="n">c</span>:<span class="mi">79</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5652cf6ed936</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h810beef058600b40</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5652cdd4eb15</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">heb2aba170fd673de</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1979</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5652cf601a7e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">h579d487df9b334a1</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5652cf6e0c78</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">hc09e869c4cf00885</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">628</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x5652cf6e072f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">hc2c6d70142458fc8</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">521</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x5652cf6dd3a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">had58f7c459a1cd6e</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5652cf6e0698</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">517</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5652cdd4fde0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hf443e5eeb6cc9eab</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">96</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x5652cdd4fed2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h885d3f7beb571353</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1617</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="cp">$LT$T$C$E$GT$</span>::<span class="n">unwrap</span>::<span class="n">h63bc4d7eddd801dc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1299</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x5652cf601bb8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="n">libfuzzer_sys</span><span class="p">.</span><span class="mf">7250e05</span><span class="n">b</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mi">0</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">hdb574c15f35ab6b9</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">367</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">he6e3d6241b2b560d</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">129</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">28</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x5652cf637d73</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x5652cf624a12</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerDriver</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">324</span>:<span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x5652cf62a43b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x5652cf6502e2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerMain</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">20</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x7facee41c0b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x5652cdd5124d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"></span>
</code></pre></div>
<p>cc @afonso360, I think you might be interested in this? Sorry I'm not super familiar with this fuzzer so I'm not sure how to reduce further before handing it off here</p>
</blockquote>



<a name="253161937"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/253161937" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#253161937">(Sep 13 2021 at 21:18)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-918585112">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<blockquote>
<p>cc @afonso360, I think you might be interested in this? Sorry I'm not super familiar with this fuzzer so I'm not sure how to reduce further before handing it off here</p>
</blockquote>
<p>Yeah, ill take a look, thanks!</p>
</blockquote>



<a name="288748780"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288748780" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288748780">(Jul 07 2022 at 00:47)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1176899085">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's the CLIF generated for that fuzzer input:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block3</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block4</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="w"></span>

<span class="n">block5</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>

<span class="n">block6</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>I notice that the SSA value it's complaining about, <code>v2</code>, is defined in <code>block1</code>. But as the error message says, <code>block1</code> doesn't dominate <code>block3</code>, which is also reachable through <code>block2</code>. In fact there are no branches to <code>block1</code>.</p>
<p>I'm finding this confusing to reason about because the fuzz target doesn't use SSA values directly, but rather <code>Variable</code>s which can be bound to different SSA values at different points.</p>
<p>I'm guessing that if you ensure that the fuzz target makes every block reachable from the function entry, then variables will always be bound to values from dominating blocks. But I could be wrong!</p>
</blockquote>



<a name="288778887"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288778887" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288778887">(Jul 07 2022 at 08:51)</a>:</h4>
<p>afonso360 <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> an <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available. <code>v1</code> gets picked as <code>v3</code> in <code>block2</code>.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288778902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288778902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288778902">(Jul 07 2022 at 08:51)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available. <code>v1</code> gets picked as <code>v3</code> in <code>block2</code>.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288779001"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288779001" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288779001">(Jul 07 2022 at 08:52)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available. <code>v1</code> gets picked as <code>v2</code> in <code>block1</code> and <code>v3</code> in <code>block2</code>.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288779112"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288779112" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288779112">(Jul 07 2022 at 08:53)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available. <code>v1</code> gets picked as <code>v3</code> in <code>block2</code>.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288779461"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288779461" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288779461">(Jul 07 2022 at 08:56)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available. <code>v1</code> gets picked as <code>v2</code> in <code>block1</code> and  <code>v3</code> in <code>block2</code>.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288779531"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288779531" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288779531">(Jul 07 2022 at 08:57)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We do only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available.</p>
<p><code>v1</code> gets picked as <code>v2</code> in <code>block1</code> and  <code>v3</code> in <code>block2</code>. The difference being that <code>v2</code> is part of the signature of <code>block1</code> when generating and <code>block2</code> supposedly didn't have any variables in the signature.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288781024"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288781024" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288781024">(Jul 07 2022 at 09:13)</a>:</h4>
<p>afonso360 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1177270634">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Here's what the fuzzer generates before calling: <code>seal_all_blocks</code> and <code>finalize</code></p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="k">fn</span>: <span class="nc">function</span><span class="w"> </span><span class="n">u0</span>:<span class="mi">0</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="kt">i16</span><span class="p">)</span><span class="w"> </span><span class="n">system_v</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">jt0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_table</span><span class="w"> </span><span class="p">[</span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">]</span><span class="w"></span>

<span class="n">block0</span><span class="p">(</span><span class="n">v0</span>: <span class="nc">b1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">jump</span><span class="w"> </span><span class="n">block2</span><span class="w"></span>

<span class="n">block1</span><span class="p">(</span><span class="n">v2</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>

<span class="n">block2</span><span class="p">(</span><span class="n">v3</span>: <span class="kt">i16</span><span class="p">)</span>:
    <span class="nc">br_table</span><span class="w"> </span><span class="n">v3</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">,</span><span class="w"> </span><span class="n">jt0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>When generating the function, <code>block2</code> does not have any params. That's why its picked up as a valid <code>jump_table</code> and <code>br_table</code> target.</p>
<p>However, it looks like that when generating the last <code>br_table</code> instruction it uses a variable from our global variable pool, and that adds a block param somehow?</p>
<p>We only have 2 variables in this example, and they are conveniently bound to <code>v0</code> and <code>v1</code> on <code>block0</code>, so they should always be available.</p>
<p><code>v1</code> gets picked as <code>v2</code> in <code>block1</code> and  <code>v3</code> in <code>block2</code>. The difference being that <code>v2</code> is part of the signature of <code>block1</code> when generating and <code>block2</code> supposedly didn't have any variables in the signature.</p>
<p>I'm not really sure how to investigate this. But it looks like we are doing something wrong when converting to SSA.</p>
</blockquote>



<a name="288843104"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288843104" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288843104">(Jul 07 2022 at 18:00)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178010891">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>I think the chain of events leading to that block param is:</p>
<ul>
<li><code>generate_br_table</code> calls <code>builder.use_var</code></li>
<li>the variable doesn't already have a definition in <code>block2</code>, so eventually <code>use_var_nonlocal</code> is called in <code>cranelift_frontend::ssa</code></li>
<li><code>block2</code> isn't sealed, and even if it were it already has multiple predecessors, so no matter what, <code>use_var_nonlocal</code> is going to call <code>func.dfg.append_block_param</code></li>
</ul>
<p>I think that makes sense because the SSA builder doesn't know at that point whether there will be another definition added later in some predecessor of this block.</p>
<p>Is it possible to arrange that any block used as the target of a <code>br_table</code> has only the one predecessor, and is sealed before any instructions are added to it?</p>
<p>It looks like other callers always generate a jump table at the same time as the <code>br_table</code> instruction that uses it, so each jump table is used exactly once. Maybe doing the same thing here would help with this bug?</p>
</blockquote>



<a name="288846219"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288846219" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288846219">(Jul 07 2022 at 18:23)</a>:</h4>
<p>cfallin <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178038993">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>@jameysharp and I talked briefly offline; it seems the issue is with the handling of unreachable code in the SSA-building algorithms in <code>cranelift-frontend</code>. I suspect the least error-prone approach is to disallow unreachable code to be built with <code>cranelift-frontend</code> (and <code>debug_assert</code> that somewhere). This does imply that embedders using the SSA-builder frontend need to ensure all blocks are reachable (or do a quick DFS to mark reachable blocks and skip unreachable ones first), but it removes a bunch of special cases and resolves bugs as a result.</p>
<p>So I think a good way out here is to:</p>
<ol>
<li>Check and assert for no unreachable code in the frontend;</li>
<li>Do any cleanup that allows;</li>
<li>Ensure that <code>cranelift-wasm</code>'s unreachable-code handling is compatible with this (i.e. does not generate unreachable blocks at the CLIF level);</li>
<li>Modify <code>cranelift-fuzzgen</code> to ensure generated blocks are always reachable.</li>
</ol>
<p>If we can resolve the bugs in <code>cranelift-frontend</code> arising from unreachable code I'm fine with that outcome as well, but I don't see it as a really necessary case to support at that level.</p>
</blockquote>



<a name="288852120"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288852120" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288852120">(Jul 07 2022 at 19:09)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178096225">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>@cfallin and I discussed this a little further and I think there is actually a frontend bug here, and if we can fix that then the current fuzzgen strategy should work.</p>
<p>Adding block parameters during SSA construction should actually be okay, even to blocks which are used in jump tables. There's code in the frontend crate to rewrite the jump table when it does that.</p>
<p>The problem here is that if a jump-table is shared by multiple instructions, then we need to be careful about how we rewrite it. During sealing, <code>block2</code> should have gotten a different jump table than <code>block1</code>, where all the original references to <code>block2</code> were rewritten to <code>block5</code>, rather than <code>block3</code>. Then <code>v3</code> is used when the branch comes from <code>block2</code>, and <code>v2</code> is used when the branch comes from <code>block1</code>, and the validator should be happy.</p>
<p>I think the simplest way to fix it is that <code>append_jump_argument</code> (in <code>cranelift/frontend/src/ssa.rs</code>) needs to not update <code>func.jump_tables</code> in-place. Instead, it should copy the jump table, and update <code>jump_inst</code> to use the new table.</p>
<p>This may leave unused jump-tables lying around. In fact, since everywhere else uses a jump-table in exactly one instruction, it will leave a lot of unnecessary copies of these tables lying around.</p>
<p>As an optimization, it'd be nice if <code>append_jump_argument</code> could check whether there are any other users of the jump table. I'm having trouble following the control flow, but I think this function is only called after the target block is sealed. Unfortunately I don't think there's any guarantee that other targets in the jump table are also sealed, so I don't think it's safe to assume we've seen all uses of the jump table at that point.</p>
</blockquote>



<a name="288857638"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288857638" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288857638">(Jul 07 2022 at 19:56)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178154275">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Maybe add a <code>seal_jump_table</code> function that can be called after all instructions using a jump.table have been inserted?</p>
</blockquote>



<a name="288857650"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288857650" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288857650">(Jul 07 2022 at 19:56)</a>:</h4>
<p>bjorn3 edited a <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178154275">comment</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Maybe add a <code>seal_jump_table</code> function that can be called after all instructions using a jump table have been inserted?</p>
</blockquote>



<a name="288859215"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288859215" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288859215">(Jul 07 2022 at 20:09)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178168580">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>It's not immediately obvious to me how <code>seal_jump_table</code> would work; do you have suggestions? I think this operation needs to wait not only for all instructions using the jump table to be inserted, but also for all blocks targeted by the jump table to be sealed.</p>
<p>It might be feasible to defer the work that <code>append_jump_argument</code> does until sometime like <code>FunctionBuilder::finalize</code>, but I'm not sure how much complexity that would add.</p>
<p>Alternatively, <code>append_jump_argument</code> could just clone jump tables as needed, and then any unused jump tables could get cleaned up in <code>FunctionBuilder::finalize</code>?</p>
<p>Either way I think it'd be nice to get a patch together that fixes the bug first, then figure out how to optimize it if necessary.</p>
</blockquote>



<a name="288878646"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/288878646" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#288878646">(Jul 07 2022 at 23:20)</a>:</h4>
<p>bjorn3 <a href="https://github.com/bytecodealliance/wasmtime/issues/3347#issuecomment-1178361005">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>seal_jump_table could set a flag and then when it is actually time to modify jump tablea this flag could be checked to see if in-place modification is possible or not.</p>
</blockquote>



<a name="289243659"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%233347%20cranelift-fuzzgen%3A%20Invalid%20Craneli.../near/289243659" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.233347.20cranelift-fuzzgen.3A.20Invalid.20Craneli.2E.2E.2E.html#289243659">(Jul 11 2022 at 20:09)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/3347">issue #3347</a>:</p>
<blockquote>
<p>Found via oss-fuzz recently <a href="https://github.com/bytecodealliance/wasmtime/files/7157244/repro.gz">this input file</a> when fed into the <code>cranelift-fuzzgen</code> fuzzer as of 4d86f0ca102345555d87eaaa7524acd4260f7607 will generate this panic:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">thread</span><span class="w"> </span><span class="o">'&lt;</span><span class="n">unnamed</span><span class="o">&gt;'</span><span class="w"> </span><span class="n">panicked</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">'</span><span class="na">called</span><span class="w"> </span><span class="err">`</span><span class="nb">Result</span>::<span class="n">unwrap</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">`</span><span class="nb">Err</span><span class="err">`</span><span class="w"> </span><span class="n">value</span>: <span class="nc">VerifierErrors</span><span class="p">([</span><span class="n">VerifierError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">location</span>: <span class="nc">inst3</span><span class="p">,</span><span class="w"> </span><span class="n">context</span>: <span class="nb">Some</span><span class="p">(</span><span class="s">"jump block2(v2)"</span><span class="p">),</span><span class="w"> </span><span class="n">message</span>: <span class="s">"uses value arg from non-dominating block1"</span><span class="w"> </span><span class="p">}])</span><span class="o">'</span><span class="p">,</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">45</span><span class="w"></span>
<span class="o">--</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">note</span>: <span class="nc">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backtrace</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">AddressSanitizer</span>:<span class="nc">DEADLYSIGNAL</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">=================================================================</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==</span><span class="mi">916</span><span class="o">==</span><span class="n">ERROR</span>: <span class="nc">AddressSanitizer</span>: <span class="nc">ABRT</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="mh">0x053900000394</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="mh">0x7ffe46a99210</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="mh">0x7ffe46a98fa0</span><span class="w"> </span><span class="n">T0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">SCARINESS</span>: <span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">0</span><span class="w"> </span><span class="mh">0x7facee43b18b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">raise</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">sysdeps</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="n">sysv</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">raise</span><span class="p">.</span><span class="n">c</span>:<span class="mi">51</span>:<span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">1</span><span class="w"> </span><span class="mh">0x7facee41a858</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abort</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">abort</span><span class="p">.</span><span class="n">c</span>:<span class="mi">79</span>:<span class="mi">7</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">2</span><span class="w"> </span><span class="mh">0x5652cf6ed936</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys</span>::<span class="n">unix</span>::<span class="n">abort_internal</span>::<span class="n">h810beef058600b40</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">unix</span><span class="o">/</span><span class="k">mod</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">259</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">3</span><span class="w"> </span><span class="mh">0x5652cdd4eb15</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">abort</span>::<span class="n">heb2aba170fd673de</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">process</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1979</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">4</span><span class="w"> </span><span class="mh">0x5652cf601a7e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libfuzzer_sys</span>::<span class="n">initialize</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">h579d487df9b334a1</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">57</span>:<span class="mi">9</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">5</span><span class="w"> </span><span class="mh">0x5652cf6e0c78</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">rust_panic_with_hook</span>::<span class="n">hc09e869c4cf00885</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">628</span>:<span class="mi">17</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">6</span><span class="w"> </span><span class="mh">0x5652cf6e072f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="n">begin_panic_handler</span>::<span class="n">_</span><span class="cp">$u7b$u7b$closure$u7d$u7d$</span>::<span class="n">hc2c6d70142458fc8</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">521</span>:<span class="mi">13</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">7</span><span class="w"> </span><span class="mh">0x5652cf6dd3a3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">sys_common</span>::<span class="n">backtrace</span>::<span class="n">__rust_end_short_backtrace</span>::<span class="n">had58f7c459a1cd6e</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">sys_common</span><span class="o">/</span><span class="n">backtrace</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">141</span>:<span class="mi">18</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">8</span><span class="w"> </span><span class="mh">0x5652cf6e0698</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_begin_unwind</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">517</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">9</span><span class="w"> </span><span class="mh">0x5652cdd4fde0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">panicking</span>::<span class="n">panic_fmt</span>::<span class="n">hf443e5eeb6cc9eab</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">96</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">10</span><span class="w"> </span><span class="mh">0x5652cdd4fed2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="n">unwrap_failed</span>::<span class="n">h885d3f7beb571353</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1617</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">11</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">core</span>::<span class="n">result</span>::<span class="nb">Result</span><span class="cp">$LT$T$C$E$GT$</span>::<span class="n">unwrap</span>::<span class="n">h63bc4d7eddd801dc</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">1299</span>:<span class="mi">23</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">12</span><span class="w"> </span><span class="mh">0x5652cde1b096</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rust_fuzzer_test_input</span><span class="w"> </span><span class="n">wasmtime</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span><span class="n">fuzz_targets</span><span class="o">/</span><span class="n">cranelift</span><span class="o">-</span><span class="n">fuzzgen</span><span class="o">-</span><span class="n">verify</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">10</span>:<span class="mi">5</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">13</span><span class="w"> </span><span class="mh">0x5652cf601bb8</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__rust_try</span><span class="w"> </span><span class="n">libfuzzer_sys</span><span class="p">.</span><span class="mf">7250e05</span><span class="n">b</span><span class="o">-</span><span class="n">cgu</span><span class="p">.</span><span class="mi">0</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">14</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panicking</span>::<span class="kr">try</span>::<span class="n">hdb574c15f35ab6b9</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panicking</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">367</span>:<span class="mi">19</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">15</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">std</span>::<span class="n">panic</span>::<span class="n">catch_unwind</span>::<span class="n">he6e3d6241b2b560d</span><span class="w"> </span><span class="o">/</span><span class="n">rustc</span><span class="o">/</span><span class="mf">51e514</span><span class="n">c0fb4f9afcaae3b02dd9ccb93e15b30ef8</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">std</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">129</span>:<span class="mi">14</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">16</span><span class="w"> </span><span class="mh">0x5652cf60131f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LLVMFuzzerTestOneInput</span><span class="w"> </span><span class="o">/</span><span class="n">rust</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="mi">1</span><span class="n">ecc6299db9ec823</span><span class="o">/</span><span class="n">libfuzzer</span><span class="o">-</span><span class="n">sys</span><span class="o">-</span><span class="mf">0.4.2</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="p">.</span><span class="n">rs</span>:<span class="mi">28</span>:<span class="mi">22</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">17</span><span class="w"> </span><span class="mh">0x5652cf637d73</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span>::<span class="n">ExecuteCallback</span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">18</span><span class="w"> </span><span class="mh">0x5652cf624a12</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">RunOneTest</span><span class="p">(</span><span class="n">fuzzer</span>::<span class="n">Fuzzer</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerDriver</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">324</span>:<span class="mi">6</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">19</span><span class="w"> </span><span class="mh">0x5652cf62a43b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fuzzer</span>::<span class="n">FuzzerDriver</span><span class="p">(</span><span class="n">int</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">***</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="n">long</span><span class="p">))</span><span class="w"> </span><span class="n">cxa_noexception</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">0</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">20</span><span class="w"> </span><span class="mh">0x5652cf6502e2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">compiler</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">FuzzerMain</span><span class="p">.</span><span class="n">cpp</span>:<span class="mi">20</span>:<span class="mi">10</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">21</span><span class="w"> </span><span class="mh">0x7facee41c0b2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">__libc_start_main</span><span class="w"> </span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="n">eX1tMB</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.31</span><span class="o">/</span><span class="n">csu</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">start</span><span class="p">.</span><span class="n">c</span>:<span class="mi">308</span>:<span class="mi">16</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span>#<span class="mi">22</span><span class="w"> </span><span class="mh">0x5652cdd5124d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">_start</span><span class="w"></span>
</code></pre></div>
<p>cc @afonso360, I think you might be interested in this? Sorry I'm not super familiar with this fuzzer so I'm not sure how to reduce further before handing it off here</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>