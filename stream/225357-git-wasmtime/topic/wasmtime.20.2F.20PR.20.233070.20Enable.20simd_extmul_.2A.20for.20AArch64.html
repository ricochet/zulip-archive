<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3070 Enable simd_extmul_* for AArch64 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html">wasmtime / PR #3070 Enable simd_extmul_* for AArch64</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="245332030"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/245332030" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#245332030">(Jul 08 2021 at 15:42)</a>:</h4>
<p>sparker-arm opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3070">PR #3070</a> from <code>simd-extmul-aarch64</code> to <code>main</code>:</p>
<blockquote>
<p>Lower simd_extmul_[low/high][signed/unsigned] to [s|u]widen inputs to<br>
an imul node.</p>
<p>This also reorganises the aarch64 'long mul' operations and their assembly.</p>
<p>Copyright (c) 2021, Arm Limited.</p>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="245420912"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/245420912" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#245420912">(Jul 09 2021 at 09:28)</a>:</h4>
<p>sparker-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3070">PR #3070</a> from <code>simd-extmul-aarch64</code> to <code>main</code>.</p>



<a name="245994589"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/245994589" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#245994589">(Jul 14 2021 at 17:44)</a>:</h4>
<p><strong>akirilov-arm</strong> requested <a href="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3070">PR #3070</a>.</p>



<a name="246018268"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246018268" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246018268">(Jul 14 2021 at 20:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-706705524">PR review</a>.</p>



<a name="246018269"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246018269" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246018269">(Jul 14 2021 at 20:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#discussion_r669942005">PR review comment</a>:</p>
<blockquote>
<p>It seems like this and <code>Umlal8</code> aren't actually generated in any lowerings (unless I'm missing something), but do you want to leave these in for completeness with possible future lowerings?</p>
</blockquote>



<a name="246018270"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246018270" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246018270">(Jul 14 2021 at 20:48)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-706705524">PR review</a>.</p>



<a name="246018271"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246018271" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246018271">(Jul 14 2021 at 20:48)</a>:</h4>
<p>alexcrichton created <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#discussion_r669943051">PR review comment</a>:</p>
<blockquote>
<p>One possible way to structure this is to perhaps check for <code>is_vector</code> and i64x2 early on at the top of this block with early-returns if they match, and if that fails all the remaining cases share the logic of </p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">put_input_in_reg</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">NarrowValueMode</span>::<span class="nb">None</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">put_input_in_reg</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">NarrowValueMode</span>::<span class="nb">None</span><span class="p">);</span><span class="w"></span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">rd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_output_reg</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">only_reg</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>as a prefix.</p>
<p>Just a thought though, happy to defer to you who work on this much more than I!</p>
</blockquote>



<a name="246059729"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246059729" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246059729">(Jul 15 2021 at 07:21)</a>:</h4>
<p>sparker-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-707009178">PR review</a>.</p>



<a name="246059730"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246059730" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246059730">(Jul 15 2021 at 07:21)</a>:</h4>
<p>sparker-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#discussion_r670201193">PR review comment</a>:</p>
<blockquote>
<p>Yes, exactly - thought it would be weird to just port the 32-bit version.</p>
</blockquote>



<a name="246060966"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246060966" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246060966">(Jul 15 2021 at 07:37)</a>:</h4>
<p>sparker-arm submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-707022728">PR review</a>.</p>



<a name="246060967"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/246060967" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#246060967">(Jul 15 2021 at 07:37)</a>:</h4>
<p>sparker-arm created <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#discussion_r670211815">PR review comment</a>:</p>
<blockquote>
<p>So even though I don't like the duplication, or how much conditional stuff is going on here, we would only be able to factor out one collection of these calls as the I128 case uses, ever so slightly, different calls to handle multiple registers.   So I think I prefer the clarity. </p>
</blockquote>



<a name="247265733"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247265733" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247265733">(Jul 26 2021 at 21:25)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-715295028">PR review</a>.</p>



<a name="247265734"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247265734" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247265734">(Jul 26 2021 at 21:25)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#discussion_r676954138">PR review comment</a>:</p>
<blockquote>
<p>Can we add a doc-comment here describing the return tuple? E.g. it's not clear to me reading at this point what the <code>bool</code> denotes, until I notice the low/high pattern below in the implementation.</p>
</blockquote>



<a name="247265735"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247265735" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247265735">(Jul 26 2021 at 21:25)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-715295028">PR review</a>.</p>



<a name="247451007"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247451007" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247451007">(Jul 28 2021 at 12:18)</a>:</h4>
<p>sparker-arm updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3070">PR #3070</a> from <code>simd-extmul-aarch64</code> to <code>main</code>.</p>



<a name="247495713"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247495713" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247495713">(Jul 28 2021 at 18:10)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3070#pullrequestreview-717323767">PR review</a>.</p>



<a name="247495724"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233070%20Enable%20simd_extmul_%2A%20for%20AArch64/near/247495724" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233070.20Enable.20simd_extmul_.2A.20for.20AArch64.html#247495724">(Jul 28 2021 at 18:10)</a>:</h4>
<p>cfallin merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3070">PR #3070</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>