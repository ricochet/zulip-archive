<html>
<head><meta charset="utf-8"><title>wasmtime / PR #3084 Add simd_extmul_* support for x64 · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html">wasmtime / PR #3084 Add simd_extmul_* support for x64</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="245908736"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245908736" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245908736">(Jul 14 2021 at 01:13)</a>:</h4>
<p>jlb6740 opened <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> from <code>implement_ext_mul_x64</code> to <code>main</code>:</p>
<blockquote>
<p>&lt;!--</p>
<p>Please ensure that the following steps are all taken care of before submitting<br>
the PR.</p>
<ul>
<li>
<p>[ ] This has been discussed in issue #..., or if not, please tell us why<br>
  here.</p>
</li>
<li>
<p>[ ] A short description of what this does, why it is needed; if the<br>
  description becomes long, the matter should probably be discussed in an issue<br>
  first.</p>
</li>
<li>
<p>[ ] This PR contains test cases, if meaningful.</p>
</li>
<li>[ ] A reviewer from the core maintainer team has been assigned for this PR.<br>
  If you don't know who could review this, please indicate so. The list of<br>
  suggested reviewers on the right can help you.</li>
</ul>
<p>Please ensure all communication adheres to the <a href="https://github.com/bytecodealliance/wasmtime/blob/master/CODE_OF_CONDUCT.md">code of
conduct</a>.<br>
--&gt;<br>
</p>
</blockquote>



<a name="245910084"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245910084" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245910084">(Jul 14 2021 at 01:37)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> from <code>implement_ext_mul_x64</code> to <code>main</code>.</p>



<a name="245912559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245912559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245912559">(Jul 14 2021 at 02:27)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> from <code>implement_ext_mul_x64</code> to <code>main</code>.</p>



<a name="245912654"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245912654" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245912654">(Jul 14 2021 at 02:28)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> from <code>implement_ext_mul_x64</code> to <code>main</code>.</p>



<a name="245912660"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245912660" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245912660">(Jul 14 2021 at 02:29)</a>:</h4>
<p><strong>jlb6740</strong> has marked <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> as ready for review.</p>



<a name="245912712"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245912712" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245912712">(Jul 14 2021 at 02:30)</a>:</h4>
<p><strong>jlb6740</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a>.</p>



<a name="245912761"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245912761" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245912761">(Jul 14 2021 at 02:31)</a>:</h4>
<p><strong>jlb6740</strong> requested <a href="https://github.com/akirilov-arm">akirilov-arm</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a>.</p>



<a name="245994837"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245994837" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245994837">(Jul 14 2021 at 17:46)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#pullrequestreview-706534271">PR review</a>.</p>



<a name="245994838"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245994838" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245994838">(Jul 14 2021 at 17:46)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r669815263">PR review comment</a>:</p>
<blockquote>
<p>Initially I thought that this matching was too greedy--that it would match sequences that it shouldn't be and then crash because the types are wrong. I think now that it is OK because <code>swiden_high</code> only really allows the following types: <code>I8X16</code>, <code>I16X8</code>, <code>I32X4</code>. I think it might be worthwhile to mention this assumption in some comments at the top so that future readers aren't confused.</p>
<p><div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swiden</span><span class="p">.</span><span class="kt">i64</span><span class="w"></span>
</code></pre></div><br>
</p>
</blockquote>



<a name="245994839"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245994839" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245994839">(Jul 14 2021 at 17:46)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r669810577">PR review comment</a>:</p>
<blockquote>
<p>Not sure why <code>swiden_input</code> is needed: couldn't the <code>InsnInput</code>s be created inline?</p>
</blockquote>



<a name="245994840"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245994840" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245994840">(Jul 14 2021 at 17:46)</a>:</h4>
<p>abrown created <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r669820816">PR review comment</a>:</p>
<blockquote>
<p>I think the order of the lowerings should be reversed: scalar lowerings first, then vector lowerings, then pattern matching lowerings. As it stands in this PR, every <code>imul.i64</code> is going to require a bunch of matching calls and type comparisons before it ever gets lowered. I think scalar multiplication is going to be the most common, then plain vector multiplication, so I would think we would want to make those common paths shorter. (Not sure exactly how much this affects compile time but hopefully you see what I mean).</p>
</blockquote>



<a name="245994841"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/245994841" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#245994841">(Jul 14 2021 at 17:46)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#pullrequestreview-706534271">PR review</a>.</p>



<a name="246050595"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246050595" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246050595">(Jul 15 2021 at 04:24)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r670122317">PR review comment</a>:</p>
<blockquote>
<p>Sure .. I agree. That was my original thought but I never reverted the initial implementation.</p>
</blockquote>



<a name="246050597"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246050597" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246050597">(Jul 15 2021 at 04:24)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#pullrequestreview-706911885">PR review</a>.</p>



<a name="246057645"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246057645" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246057645">(Jul 15 2021 at 06:50)</a>:</h4>
<p>jlb6740 edited <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r670122317">PR review comment</a>.</p>



<a name="246058599"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246058599" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246058599">(Jul 15 2021 at 07:05)</a>:</h4>
<p>jlb6740 updated <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a> from <code>implement_ext_mul_x64</code> to <code>main</code>.</p>



<a name="246058825"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246058825" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246058825">(Jul 15 2021 at 07:09)</a>:</h4>
<p>jlb6740 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#pullrequestreview-706999209">PR review</a>.</p>



<a name="246058826"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246058826" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246058826">(Jul 15 2021 at 07:09)</a>:</h4>
<p>jlb6740 created <a href="https://github.com/bytecodealliance/wasmtime/pull/3084#discussion_r670193346">PR review comment</a>:</p>
<blockquote>
<p>Also note, the code must remain at the top as the fall through target since I am using "if let Some(_) .." to check for op sources and there is no if not let Some(_) ..". Still there is just one branch to get to the other lowerings.</p>
</blockquote>



<a name="246060536"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246060536" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246060536">(Jul 15 2021 at 07:31)</a>:</h4>
<p><strong>jlb6740</strong> requested <a href="https://github.com/abrown">abrown</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a>.</p>



<a name="246063413"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%233084%20Add%20simd_extmul_%2A%20support%20for%20x64/near/246063413" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.233084.20Add.20simd_extmul_.2A.20support.20for.20x64.html#246063413">(Jul 15 2021 at 08:07)</a>:</h4>
<p>jlb6740 merged <a href="https://github.com/bytecodealliance/wasmtime/pull/3084">PR #3084</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>