<html>
<head><meta charset="utf-8"><title>wasmtime / PR #9218 Winch multi values results · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html">wasmtime / PR #9218 Winch multi values results</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="469052337"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469052337" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469052337">(Sep 10 2024 at 10:19)</a>:</h4>
<p>vulc41n opened <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a> from <code>vulc41n:winch-multi-values</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>Hey <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>
<p>This PR fixes how results are returned when using Winch. Cranelift uses x0-x7 and v0-v7 to store the first results, and then stores the remaining ones in the stack from sp to fp. Winch stores the last result in either x0 or v0, with the other results placed on the stack from fp to sp.</p>
<p>Thank you @saulecabrera for helping me figure this out <span aria-label="smiling face" class="emoji emoji-263a" role="img" title="smiling face">:smiling_face:</span></p>
<p>&lt;!--<br>
Please make sure you include the following information:</p>
<ul>
<li>
<p>If this work has been discussed elsewhere, please include a link to that<br>
  conversation. If it was discussed in an issue, just mention "issue #...".</p>
</li>
<li>
<p>Explain why this change is needed. If the details are in an issue already,<br>
  this can be brief.</p>
</li>
</ul>
<p>Our development process is documented in the Wasmtime book:<br>
<a href="https://docs.wasmtime.dev/contributing-development-process.html">https://docs.wasmtime.dev/contributing-development-process.html</a></p>
<p>Please ensure all communication follows the code of conduct:<br>
<a href="https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md">https://github.com/bytecodealliance/wasmtime/blob/main/CODE_OF_CONDUCT.md</a><br>
--&gt;</p>
</blockquote>



<a name="469052338"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469052338" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469052338">(Sep 10 2024 at 10:19)</a>:</h4>
<p><strong>vulc41n</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>.</p>



<a name="469052339"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469052339" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469052339">(Sep 10 2024 at 10:19)</a>:</h4>
<p><strong>vulc41n</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>.</p>



<a name="469052341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469052341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469052341">(Sep 10 2024 at 10:19)</a>:</h4>
<p><strong>vulc41n</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>.</p>



<a name="469096315"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469096315" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469096315">(Sep 10 2024 at 13:44)</a>:</h4>
<p>github-actions[bot] <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#issuecomment-2340849734">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>:</p>
<blockquote>
<h4>Subscribe to Label Action</h4>
<p>cc @saulecabrera</p>
<p>&lt;details&gt;<br>
This issue or pull request has been labeled: "cranelift", "cranelift:area:aarch64", "winch"</p>
<p>Thus the following users have been cc'd because of the following labels:</p>
<ul>
<li>saulecabrera: winch</li>
</ul>
<p>To subscribe or unsubscribe from this label, edit the &lt;code&gt;.github/subscribe-to-label.json&lt;/code&gt; configuration file.</p>
<p><a href="https://github.com/bytecodealliance/subscribe-to-label-action">Learn more.</a><br>
&lt;/details&gt;</p>
</blockquote>



<a name="469137450"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469137450" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469137450">(Sep 10 2024 at 15:55)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#pullrequestreview-2292940313">PR review</a>:</p>
<blockquote>
<p>Looks good, just a couple nitpicks below. Thanks!</p>
</blockquote>



<a name="469137451"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469137451" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469137451">(Sep 10 2024 at 15:55)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#discussion_r1752240782">PR review comment</a>:</p>
<blockquote>
<p>Since we are checking this condition so frequently, it may help to define an <code>is_winch_return</code> boolean at the start of this procedure that we can reuse throughout.</p>
</blockquote>



<a name="469137453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469137453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469137453">(Sep 10 2024 at 15:55)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#discussion_r1752238997">PR review comment</a>:</p>
<blockquote>
<p>Rather than checking for winch returns every iteration of the loop, can we initialize <code>remaining_reg_vals</code> such that this behavior happens automatically? I think that means initializing it to one when we are doing winch returns. That feels cleaner to me than adding edge case conditions to check in the middle of the body of the register assignment loop.</p>
</blockquote>



<a name="469143378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469143378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469143378">(Sep 10 2024 at 16:13)</a>:</h4>
<p>saulecabrera submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#pullrequestreview-2292995261">PR review</a>:</p>
<blockquote>
<p>Left one small nit as well. </p>
</blockquote>



<a name="469143379"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469143379" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469143379">(Sep 10 2024 at 16:13)</a>:</h4>
<p>saulecabrera created <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#discussion_r1752268864">PR review comment</a>:</p>
<blockquote>
<p>We have this exact implementation in the x64 backend. Maybe it's worth factoring it out into a function shared between both backends?</p>
</blockquote>



<a name="469145341"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469145341" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469145341">(Sep 10 2024 at 16:21)</a>:</h4>
<p>vulc41n submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#pullrequestreview-2293014039">PR review</a>.</p>



<a name="469145344"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469145344" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469145344">(Sep 10 2024 at 16:21)</a>:</h4>
<p>vulc41n created <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#discussion_r1752279254">PR review comment</a>:</p>
<blockquote>
<p>If <code>remaining_reg_vals</code> is one, it will put the first result in the registry, not the last one. I can add another variable named <code>skip_reg_vals</code> which is zero except when processing winch returns, then it is <code>params.len() - 1</code>. What do you think ?</p>
</blockquote>



<a name="469153559"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469153559" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469153559">(Sep 10 2024 at 16:51)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#pullrequestreview-2293096635">PR review</a>.</p>



<a name="469153560"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469153560" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469153560">(Sep 10 2024 at 16:51)</a>:</h4>
<p>fitzgen created <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#discussion_r1752318254">PR review comment</a>:</p>
<blockquote>
<p>Ah I missed that detail. In that case, I think it is fine as-is.</p>
</blockquote>



<a name="469336474"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469336474" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469336474">(Sep 11 2024 at 09:12)</a>:</h4>
<p>vulc41n updated <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>.</p>



<a name="469500294"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469500294" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469500294">(Sep 11 2024 at 20:15)</a>:</h4>
<p>fitzgen submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/9218#pullrequestreview-2298532919">PR review</a>:</p>
<blockquote>
<p>Thanks!</p>
</blockquote>



<a name="469502312"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%239218%20Winch%20multi%20values%20results/near/469502312" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.239218.20Winch.20multi.20values.20results.html#469502312">(Sep 11 2024 at 20:30)</a>:</h4>
<p>fitzgen merged <a href="https://github.com/bytecodealliance/wasmtime/pull/9218">PR #9218</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>