<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8664 cranelift: Always consider sret argum... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html">wasmtime / PR #8664 cranelift: Always consider sret argum...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="439623260"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623260" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623260">(May 20 2024 at 17:51)</a>:</h4>
<p>jameysharp opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a> from <code>jameysharp:fix-8659</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In #8438 we stopped emitting register bindings for unused arguments, based on the use-counts from <code>compute_use_states</code>. However, that doesn't count the use of the struct-return argument that's automatically added after lowering when the <code>rets</code> instruction is generated in the epilogue. As a result, using a struct-return argument caused register allocation to panic due to the VReg not being defined anywhere.</p>
<p>This commit adds a use to the struct-return argument so that it's always available in the epilogue.</p>
<p>Fixes #8659</p>
</blockquote>



<a name="439623263"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623263" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623263">(May 20 2024 at 17:51)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a>.</p>



<a name="439623264"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623264" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623264">(May 20 2024 at 17:51)</a>:</h4>
<p><strong>jameysharp</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a>.</p>



<a name="439623750"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623750" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623750">(May 20 2024 at 17:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#pullrequestreview-2066714995">PR review</a>:</p>
<blockquote>
<p>LGTM!</p>
</blockquote>



<a name="439623751"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623751" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623751">(May 20 2024 at 17:54)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#pullrequestreview-2066714995">PR review</a>:</p>
<blockquote>
<p>LGTM!</p>
</blockquote>



<a name="439623752"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439623752" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439623752">(May 20 2024 at 17:54)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#discussion_r1607082861">PR review comment</a>:</p>
<blockquote>
<p>Could we add a comment here to note it starts at <code>Once</code> (for the one use that is the implicit return), but can still be updated below?</p>
</blockquote>



<a name="439625435"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439625435" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439625435">(May 20 2024 at 18:04)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#pullrequestreview-2066737503">PR review</a>.</p>



<a name="439625436"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439625436" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439625436">(May 20 2024 at 18:04)</a>:</h4>
<p>jameysharp created <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#discussion_r1607093441">PR review comment</a>:</p>
<blockquote>
<p>Actually, should I just start it at <code>Multiple</code> in case there are multiple epilogues? The definition of the sret vreg can't participate in load-sinking or anything so I don't think the value really matters, but I guess it should be "correct" anyway?</p>
</blockquote>



<a name="439627568"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439627568" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439627568">(May 20 2024 at 18:18)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#pullrequestreview-2066763967">PR review</a>.</p>



<a name="439627569"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439627569" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439627569">(May 20 2024 at 18:18)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/8664#discussion_r1607116737">PR review comment</a>:</p>
<blockquote>
<p>Oh, yes, that makes more sense actually, I agree. It's unlikely to matter as you say but might as well get the analysis right...</p>
</blockquote>



<a name="439660203"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439660203" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439660203">(May 20 2024 at 19:04)</a>:</h4>
<p>jameysharp updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a>.</p>



<a name="439660259"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439660259" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439660259">(May 20 2024 at 19:05)</a>:</h4>
<p>jameysharp has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a>.</p>



<a name="439664179"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238664%20cranelift%3A%20Always%20consider%20sret%20argum.../near/439664179" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238664.20cranelift.3A.20Always.20consider.20sret.20argum.2E.2E.2E.html#439664179">(May 20 2024 at 19:27)</a>:</h4>
<p>jameysharp merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8664">PR #8664</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>