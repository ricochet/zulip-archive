<html>
<head><meta charset="utf-8"><title>wasmtime / PR #7690 wasi-sockets: Add SO_REUSEADDR back in · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html">wasmtime / PR #7690 wasi-sockets: Add SO_REUSEADDR back in</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="408009582"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408009582" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408009582">(Dec 14 2023 at 17:27)</a>:</h4>
<p><strong>badeend</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>.</p>



<a name="408009583"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408009583" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408009583">(Dec 14 2023 at 17:27)</a>:</h4>
<p>badeend opened <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a> from <code>badeend:reuseaddr</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>In #7662 the call to <code>bind_existing_tcp_listener</code> was replaced with <code>rustix::net::bind</code>. Unfortunately, besides calling <code>bind</code>, <code>bind_existing_tcp_listener</code> also set <code>SO_REUSEADDR</code>. This PR restores that behavior. I've added an integration test and a note to the WITs too. </p>
<p>Unrelated: I also removed the workarounds in the Bind tests:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="w">        </span><span class="c1">// Concurrent invocations of this test can yield `AddressInUse` and that</span>
<span class="w">        </span><span class="c1">// same error can show up on Windows as `AccessDenied`.</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">ErrorCode</span>::<span class="n">AddressInUse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ErrorCode</span>::<span class="n">AccessDenied</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="p">,</span>
</code></pre></div>
<p>by using a random generated port instead of a single constant.</p>
</blockquote>



<a name="408009584"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408009584" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408009584">(Dec 14 2023 at 17:27)</a>:</h4>
<p><strong>badeend</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>.</p>



<a name="408010150"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408010150" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408010150">(Dec 14 2023 at 17:31)</a>:</h4>
<p>badeend updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>.</p>



<a name="408054720"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408054720" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408054720">(Dec 14 2023 at 22:03)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#pullrequestreview-1782836764">PR review</a>.</p>



<a name="408197376"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408197376" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408197376">(Dec 15 2023 at 14:34)</a>:</h4>
<p>rylev submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#pullrequestreview-1784209625">PR review</a>.</p>



<a name="408197378"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408197378" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408197378">(Dec 15 2023 at 14:34)</a>:</h4>
<p>rylev submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#pullrequestreview-1784209625">PR review</a>.</p>



<a name="408197380"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408197380" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408197380">(Dec 15 2023 at 14:34)</a>:</h4>
<p>rylev created <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#discussion_r1428041198">PR review comment</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="suggestion"><pre><span></span><code>        /// When binding to a non-zero port, this bind operation shouldn't be affected by the TIME_WAIT
        /// state of a recently closed socket on the same local address (i.e., the SO_REUSEADDR socket
        /// option should be set implicitly on platforms that require it).
</code></pre></div><br>
</p>
</blockquote>



<a name="408434941"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408434941" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408434941">(Dec 17 2023 at 11:28)</a>:</h4>
<p>badeend updated <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>.</p>



<a name="408435895"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408435895" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408435895">(Dec 17 2023 at 11:44)</a>:</h4>
<p>badeend <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#issuecomment-1859147575">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>:</p>
<blockquote>
<p>This should be good to go again.</p>
<p>In ran into EADDRINUSE issues on my local machine when binding to a specific (but random) port. So I've modified the tests to give it a few attempts.</p>
</blockquote>



<a name="408468695"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408468695" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408468695">(Dec 17 2023 at 18:34)</a>:</h4>
<p>alexcrichton submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/7690#pullrequestreview-1785493700">PR review</a>.</p>



<a name="408473692"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%237690%20wasi-sockets%3A%20Add%20SO_REUSEADDR%20back%20in/near/408473692" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.237690.20wasi-sockets.3A.20Add.20SO_REUSEADDR.20back.20in.html#408473692">(Dec 17 2023 at 19:18)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/7690">PR #7690</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>