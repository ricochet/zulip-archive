<html>
<head><meta charset="utf-8"><title>wasmtime / PR #8140 Migrate all existing cranelift-filete... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html">wasmtime / PR #8140 Migrate all existing cranelift-filete...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="426625814"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426625814" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426625814">(Mar 14 2024 at 20:46)</a>:</h4>
<p>alexcrichton opened <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a> from <code>alexcrichton:migrate-more-tests</code> to <code>bytecodealliance:main</code>:</p>
<blockquote>
<p>All existing tests are moved and updated so now they're reflecting what Wasmtime is generating. Yay!</p>
</blockquote>



<a name="426625816"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426625816" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426625816">(Mar 14 2024 at 20:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-compiler-reviewers">wasmtime-compiler-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426625817"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426625817" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426625817">(Mar 14 2024 at 20:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/elliottt">elliottt</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426625819"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426625819" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426625819">(Mar 14 2024 at 20:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/fitzgen">fitzgen</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426625820"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426625820" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426625820">(Mar 14 2024 at 20:46)</a>:</h4>
<p><strong>alexcrichton</strong> requested <a href="https://github.com/orgs/bytecodealliance/teams/wasmtime-core-reviewers">wasmtime-core-reviewers</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426628637"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426628637" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426628637">(Mar 14 2024 at 21:04)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#issuecomment-1998480814">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>:</p>
<blockquote>
<p>I'm trying to diff between old tests and new ones to get a sense of what's really changed. For example,</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="n">main</span>:<span class="nc">cranelift</span><span class="o">/</span><span class="n">filetests</span><span class="o">/</span><span class="n">filetests</span><span class="o">/</span><span class="n">isa</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">wasm</span><span class="w"> </span><span class="n">HEAD</span>:<span class="nc">tests</span><span class="o">/</span><span class="n">disas</span><span class="o">/</span><span class="n">load</span><span class="o">-</span><span class="n">store</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span>
</code></pre></div>
<p>It seems odd that on x64, <code>load_store_dynamic_kind_i32_index_0_guard_no_spectre_i32_access_0_offset.wat</code> previously used a conditional branch to a trap, but now uses a cmov of a null pointer and lets the memory access trap.</p>
<p>Perhaps the script needs to emit settings for <code>enable_heap_access_spectre_mitigation=false</code>?</p>
</blockquote>



<a name="426629147"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426629147" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426629147">(Mar 14 2024 at 21:07)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426629233"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426629233" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426629233">(Mar 14 2024 at 21:07)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#issuecomment-1998485440">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>:</p>
<blockquote>
<p>Oops, indeed! That's a difference between Cranelift's defaults and Wasmtime's defaults I forgot about with the script. Rebased with a fix now</p>
</blockquote>



<a name="426632745"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426632745" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426632745">(Mar 14 2024 at 21:31)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#issuecomment-1998516717">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>:</p>
<blockquote>
<p>For the <code>table-*-fixed-size.wat</code> tests, you've changed them from "optimize" tests to "clif" tests. If you're going to change the type of these tests in this PR, I'd rather go the other direction, with full <code>opt_level=speed</code> optimization. On the other hand if this is meant to be a no-op-ish PR, then these should be <code>test = "optimize</code> with <code>opt_level=none</code>.</p>
</blockquote>



<a name="426634417"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426634417" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426634417">(Mar 14 2024 at 21:43)</a>:</h4>
<p>jameysharp <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#issuecomment-1998532095">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>:</p>
<blockquote>
<p>As far as I can tell, this is the series of renames you did, which I needed to reproduce in order to diff the real changes:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="n">mv</span><span class="w"> </span><span class="n">cranelift</span><span class="o">/</span><span class="n">filetests</span><span class="o">/</span><span class="n">filetests</span><span class="o">/</span><span class="n">wasm</span><span class="o">/</span><span class="n">load</span><span class="o">-</span><span class="n">store</span><span class="cm">/* tests/disas/load-store/</span>
<span class="cm">mv cranelift/filetests/filetests/isa/aarch64/wasm/* tests/disas/load-store/aarch64/</span>
<span class="cm">mv cranelift/filetests/filetests/isa/x64/wasm/* tests/disas/load-store/x64/</span>
<span class="cm">mv cranelift/filetests/filetests/isa/riscv64/wasm/* tests/disas/load-store/riscv64/</span>
<span class="cm">mv cranelift/filetests/filetests/isa/s390x/wasm/* tests/disas/load-store/s390x/</span>
<span class="cm">mv cranelift/filetests/filetests/wasm/*.wat tests/disas</span>
<span class="cm">for f in tests/disas/load-store/riscv64/zb?.wat; do mv $f tests/disas/riscv64-$(basename $f) -i; done</span>
</code></pre></div>
<p>After that, <code>git diff -R</code> shows the actual test changes.</p>
</blockquote>



<a name="426638519"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426638519" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426638519">(Mar 14 2024 at 22:14)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426639370"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426639370" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426639370">(Mar 14 2024 at 22:20)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426639550"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426639550" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426639550">(Mar 14 2024 at 22:22)</a>:</h4>
<p>alexcrichton <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#issuecomment-1998578377">commented</a> on <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>:</p>
<blockquote>
<blockquote>
<p>you've changed them from "optimize" tests to "clif" tests</p>
</blockquote>
<p>Oops yes I crossed the wires reproducing what was there before, thanks for catching!</p>
<blockquote>
<p>this is the series of renames you did</p>
</blockquote>
<p>Sorry you had to reconstruct this! You gave be a better idea of how to organize this though, I've now inserted a commit which explicitly moves everything with no changes, which means that while the overall diff is still messy the per-commit view is now easier to see what changed in each test.</p>
</blockquote>



<a name="426641168"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426641168" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426641168">(Mar 14 2024 at 22:35)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426643927"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426643927" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426643927">(Mar 14 2024 at 23:00)</a>:</h4>
<p>jameysharp submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/8140#pullrequestreview-1937866143">PR review</a>:</p>
<blockquote>
<p>That helped a ton, thank you! Could you apply the same <code>opt_level=0</code> change to the non-fixed-size table-get/set tests too? Otherwise I think these all match, if my quick read of the diff didn't miss anything.</p>
<p>Very excited to start writing more tests with this new infrastructure. Thank you!</p>
</blockquote>



<a name="426644859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426644859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426644859">(Mar 14 2024 at 23:08)</a>:</h4>
<p>alexcrichton updated <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426644948"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426644948" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426644948">(Mar 14 2024 at 23:09)</a>:</h4>
<p>alexcrichton has enabled auto merge for <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<a name="426648974"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%238140%20Migrate%20all%20existing%20cranelift-filete.../near/426648974" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.238140.20Migrate.20all.20existing.20cranelift-filete.2E.2E.2E.html#426648974">(Mar 14 2024 at 23:50)</a>:</h4>
<p>alexcrichton merged <a href="https://github.com/bytecodealliance/wasmtime/pull/8140">PR #8140</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>