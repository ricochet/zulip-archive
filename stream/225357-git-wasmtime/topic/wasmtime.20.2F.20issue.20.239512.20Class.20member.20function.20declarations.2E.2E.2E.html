<html>
<head><meta charset="utf-8"><title>wasmtime / issue #9512 Class member function declarations... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html">wasmtime / issue #9512 Class member function declarations...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="478769065"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239512%20Class%20member%20function%20declarations.../near/478769065" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html#478769065">(Oct 24 2024 at 17:43)</a>:</h4>
<p>SingleAccretion opened <a href="https://github.com/bytecodealliance/wasmtime/issues/9512">issue #9512</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="p">;</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">Main</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">someclass</span><span class="p">.</span><span class="n">h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">SomeMemberVariable</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SomeFunc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SeparateFunction</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SeparateFunction</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">;</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">SeparateFunction</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SomeClass</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cp">$env</span><span class="p">:</span><span class="nc">WASI_SDK_PATH</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="o">-</span><span class="n">g3</span><span class="w"> </span><span class="o">-</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">wasip2</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">SeparateFunction</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">While</span><span class="w"> </span><span class="n">broken</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
</code></pre></div>
<p>Expected result: evaluation succeeds.</p>
<p>Actual result:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x1550de50e60</span><span class="p">)(</span><span class="mh">0x000001550de50e60</span><span class="p">)</span><span class="w"> </span><span class="mh">0x000002a4</span><span class="p">:</span><span class="w"> </span><span class="nc">DW_AT_specification</span><span class="p">(</span><span class="mh">0x0000000000000291</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">decl</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">lldb</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">prefix</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="cp">$__lldb_local_vars</span><span class="o">'</span>
<span class="w">   </span><span class="mi">45</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">using</span><span class="w"> </span><span class="cp">$__lldb_local_vars</span><span class="p">::</span><span class="n">x</span><span class="p">;</span>
<span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="o">^</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">user</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="sc">'x'</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">^</span>
</code></pre></div>
<p>The tentative root case of this is that debug info translation discards <code>DW_AT_declaration</code> DIEs for the member functions, leading to the two CUs (that both have <code>SomeClass</code> type DIEs) diverging (and LLDB ultimately ultimately caching information from the one first accessed, here <code>main.cpp</code>).</p>
</blockquote>



<a name="478769157"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239512%20Class%20member%20function%20declarations.../near/478769157" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html#478769157">(Oct 24 2024 at 17:43)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9512">issue #9512</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="p">;</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">Main</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">someclass</span><span class="p">.</span><span class="n">h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">SomeMemberVariable</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SomeFunc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SeparateFunction</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SeparateFunction</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">;</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">SeparateFunction</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SomeClass</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cp">$env</span><span class="p">:</span><span class="nc">WASI_SDK_PATH</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="o">-</span><span class="n">g3</span><span class="w"> </span><span class="o">-</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">wasip2</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">SeparateFunction</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">While</span><span class="w"> </span><span class="n">broken</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
</code></pre></div>
<p>Expected result: evaluation succeeds.</p>
<p>Actual result:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x1550de50e60</span><span class="p">)(</span><span class="mh">0x000001550de50e60</span><span class="p">)</span><span class="w"> </span><span class="mh">0x000002a4</span><span class="p">:</span><span class="w"> </span><span class="nc">DW_AT_specification</span><span class="p">(</span><span class="mh">0x0000000000000291</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">decl</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">lldb</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">prefix</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="cp">$__lldb_local_vars</span><span class="o">'</span>
<span class="w">   </span><span class="mi">45</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">using</span><span class="w"> </span><span class="cp">$__lldb_local_vars</span><span class="p">::</span><span class="n">x</span><span class="p">;</span>
<span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="o">^</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">user</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="sc">'x'</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">^</span>
</code></pre></div>
<p>The tentative root case of this is that debug info translation discards <code>DW_AT_declaration</code> DIEs for the member functions, leading to the two CUs (that both have <code>SomeClass</code> type DIEs) diverging (and LLDB ultimately ultimately caching information from the one first accessed, here <code>main.cpp</code>).</p>
</blockquote>



<a name="478769615"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239512%20Class%20member%20function%20declarations.../near/478769615" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html#478769615">(Oct 24 2024 at 17:46)</a>:</h4>
<p>SingleAccretion edited <a href="https://github.com/bytecodealliance/wasmtime/issues/9512">issue #9512</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="p">;</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">Main</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">someclass</span><span class="p">.</span><span class="n">h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">SomeMemberVariable</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SomeFunc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SeparateFunction</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SeparateFunction</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">;</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">SeparateFunction</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SomeClass</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cp">$env</span><span class="p">:</span><span class="nc">WASI_SDK_PATH</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="o">-</span><span class="n">g3</span><span class="w"> </span><span class="o">-</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">wasip2</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">SeparateFunction</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">While</span><span class="w"> </span><span class="n">broken</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
</code></pre></div>
<p>Expected result: evaluation succeeds.</p>
<p>Actual result:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x1550de50e60</span><span class="p">)(</span><span class="mh">0x000001550de50e60</span><span class="p">)</span><span class="w"> </span><span class="mh">0x000002a4</span><span class="p">:</span><span class="w"> </span><span class="nc">DW_AT_specification</span><span class="p">(</span><span class="mh">0x0000000000000291</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">decl</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">lldb</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">prefix</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="cp">$__lldb_local_vars</span><span class="o">'</span>
<span class="w">   </span><span class="mi">45</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">using</span><span class="w"> </span><span class="cp">$__lldb_local_vars</span><span class="p">::</span><span class="n">x</span><span class="p">;</span>
<span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="o">^</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">user</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="sc">'x'</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">^</span>
</code></pre></div>
<p>The tentative root case of this is that debug info translation discards <code>DW_AT_declaration</code> DIEs for the member functions, leading to the two CUs (that both have <code>SomeClass</code> type DIEs) diverging (and LLDB ultimately caching information from the one first accessed, here <code>main.cpp</code>).</p>
</blockquote>



<a name="478777049"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239512%20Class%20member%20function%20declarations.../near/478777049" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html#478777049">(Oct 24 2024 at 18:37)</a>:</h4>
<p><a href="https://github.com/alexcrichton">alexcrichton</a> added the wasmtime:debugging label to <a href="https://github.com/bytecodealliance/wasmtime/issues/9512">Issue #9512</a>.</p>



<a name="481015962"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20issue%20%239512%20Class%20member%20function%20declarations.../near/481015962" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20issue.20.239512.20Class.20member.20function.20declarations.2E.2E.2E.html#481015962">(Nov 06 2024 at 23:13)</a>:</h4>
<p>alexcrichton closed <a href="https://github.com/bytecodealliance/wasmtime/issues/9512">issue #9512</a>:</p>
<blockquote>
<p>Reproduction:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="p">;</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">Main</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">;</span><span class="w"> </span><span class="n">someclass</span><span class="p">.</span><span class="n">h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">SomeMemberVariable</span><span class="p">;</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SomeFunc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SeparateFunction</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SeparateFunction</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">;</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"someclass.h"</span>

<span class="kt">int</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">::</span><span class="n">SeparateFunction</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SomeClass</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="cp">$env</span><span class="p">:</span><span class="nc">WASI_SDK_PATH</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">clang</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">cpp</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span><span class="w">  </span><span class="o">-</span><span class="n">g3</span><span class="w"> </span><span class="o">-</span><span class="n">target</span><span class="w"> </span><span class="n">wasm32</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">wasip2</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">lldb</span><span class="w"> </span><span class="n">wasmtime</span><span class="w"> </span><span class="o">-</span><span class="n">Ccache</span><span class="o">=</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="n">Ddebug</span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="n">Oopt</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">wasm</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">SeparateFunction</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">r</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">While</span><span class="w"> </span><span class="n">broken</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Main</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">c</span>
<span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
</code></pre></div>
<p>Expected result: evaluation succeeds.</p>
<p>Actual result:</p>
<div class="codehilite" data-code-language="Rust"><pre><span></span><code><span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">x86_64</span><span class="p">)</span><span class="w"> </span><span class="n">JIT</span><span class="p">(</span><span class="mh">0x1550de50e60</span><span class="p">)(</span><span class="mh">0x000001550de50e60</span><span class="p">)</span><span class="w"> </span><span class="mh">0x000002a4</span><span class="p">:</span><span class="w"> </span><span class="nc">DW_AT_specification</span><span class="p">(</span><span class="mh">0x0000000000000291</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">decl</span>

<span class="p">(</span><span class="n">lldb</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">lldb</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">prefix</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="o">'</span><span class="cp">$__lldb_local_vars</span><span class="o">'</span>
<span class="w">   </span><span class="mi">45</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">using</span><span class="w"> </span><span class="cp">$__lldb_local_vars</span><span class="p">::</span><span class="n">x</span><span class="p">;</span>
<span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="o">^</span>
<span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">user</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nc">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">undeclared</span><span class="w"> </span><span class="n">identifier</span><span class="w"> </span><span class="sc">'x'</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">SomeMemberVariable</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">^</span>
</code></pre></div>
<p>The tentative root case of this is that debug info translation discards <code>DW_AT_declaration</code> DIEs for the member functions, leading to the two CUs (that both have <code>SomeClass</code> type DIEs) diverging (and LLDB ultimately caching information from the one first accessed, here <code>main.cpp</code>).</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>