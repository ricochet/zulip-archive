<html>
<head><meta charset="utf-8"><title>wasmtime / PR #2957 Cranelift: restrict running tests dep... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html">wasmtime / PR #2957 Cranelift: restrict running tests dep...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="240929245"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240929245" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240929245">(Jun 01 2021 at 11:47)</a>:</h4>
<p>olivierlemasle opened <a href="https://github.com/bytecodealliance/wasmtime/pull/2957">PR #2957</a> from <code>tests-no-x86_64</code> to <code>main</code>:</p>
<blockquote>
<p>These 5 tests fail with the error "This test requires x86_64 support." when<br>
executed on another architecture.<br>
</p>
</blockquote>



<a name="240929324"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240929324" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240929324">(Jun 01 2021 at 11:48)</a>:</h4>
<p>olivierlemasle edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2957">PR #2957</a> from <code>tests-no-x86_64</code> to <code>main</code>:</p>
<blockquote>
<p>Restrict running tests dependant of x86_64</p>
<p>These 5 tests fail with the error "This test requires x86_64 support." when executed on another architecture.<br>
</p>
</blockquote>



<a name="240939858"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240939858" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240939858">(Jun 01 2021 at 13:18)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-673060461">PR review</a>.</p>



<a name="240939859"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240939859" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240939859">(Jun 01 2021 at 13:18)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-673060461">PR review</a>.</p>



<a name="240939860"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240939860" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240939860">(Jun 01 2021 at 13:18)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r643094364">PR review comment</a>:</p>
<blockquote>
<p>As bjorn3 pointed out, you might need something like <code>#[cfg_attr(feature = "x86", ignore)]</code> here and below instead.</p>
</blockquote>



<a name="240940453"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240940453" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240940453">(Jun 01 2021 at 13:22)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-673065371">PR review</a>.</p>



<a name="240940454"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240940454" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240940454">(Jun 01 2021 at 13:22)</a>:</h4>
<p>bjorn3 created <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r643097888">PR review comment</a>:</p>
<blockquote>
<p>I think you are missing a <code>not()</code>.</p>
</blockquote>



<a name="240941070"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240941070" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240941070">(Jun 01 2021 at 13:27)</a>:</h4>
<p>olivierlemasle edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2957">PR #2957</a> from <code>tests-no-x86_64</code> to <code>main</code>.</p>



<a name="240941506"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240941506" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240941506">(Jun 01 2021 at 13:30)</a>:</h4>
<p>olivierlemasle submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-673074464">PR review</a>.</p>



<a name="240941507"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240941507" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240941507">(Jun 01 2021 at 13:30)</a>:</h4>
<p>olivierlemasle created <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r643104639">PR review comment</a>:</p>
<blockquote>
<p>Thank you! However, <code>x86</code> is a feature of <code>cranelift-codegen</code>, not <code>cranelift-frontend</code>. Is there a way to check from the _frontend_ crate if the x86 backend is available?<br>
(sorry if it's a newbie question!)</p>
</blockquote>



<a name="240942987"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240942987" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240942987">(Jun 01 2021 at 13:39)</a>:</h4>
<p>bnjbvr edited <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r643094364">PR review comment</a>.</p>



<a name="240946981"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240946981" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240946981">(Jun 01 2021 at 14:07)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r643136838">PR review comment</a>:</p>
<blockquote>
<p>Ah, it's a very good question. This particular crate shouldn't have tests taht depend on specific features of other crates, otherwise they wouldn't be run by our automation.</p>
<p>The behavior of <code>cranelift-codegen</code>, in the absence of specifying a target architecture for which one would like to compile, is to target the host architecture (this happens in <code>cranelift-codegen</code>'s <code>build.rs</code> script). But that doesn't _enable_ the Cargo feature either, so we couldn't even guard against the <code>cranelift-codegen</code>'s <code>x86</code> feature here.</p>
<p>So I think that checking against the <code>target_arch</code> is actually the right way to go: on a x86_64 host, the x86_64 target will be enabled by default. Sorry for the back and forth here, you were probably right in the first place :)<br>
Would still be nice to use the <code>cfg_attr</code> directive instead.</p>
</blockquote>



<a name="240946984"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/240946984" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#240946984">(Jun 01 2021 at 14:07)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-673119256">PR review</a>.</p>



<a name="241178377"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241178377" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241178377">(Jun 02 2021 at 17:02)</a>:</h4>
<p>olivierlemasle updated <a href="https://github.com/bytecodealliance/wasmtime/pull/2957">PR #2957</a> from <code>tests-no-x86_64</code> to <code>main</code>.</p>



<a name="241178487"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241178487" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241178487">(Jun 02 2021 at 17:03)</a>:</h4>
<p>olivierlemasle created <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#discussion_r644159627">PR review comment</a>:</p>
<blockquote>
<p>Thanks, I've updated the PR accordingly.</p>
</blockquote>



<a name="241178488"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241178488" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241178488">(Jun 02 2021 at 17:03)</a>:</h4>
<p>olivierlemasle submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-674467132">PR review</a>.</p>



<a name="241178902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241178902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241178902">(Jun 02 2021 at 17:06)</a>:</h4>
<p>bjorn3 submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-674470036">PR review</a>.</p>



<a name="241292224"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241292224" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241292224">(Jun 02 2021 at 17:35)</a>:</h4>
<p>abrown submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/2957#pullrequestreview-674496061">PR review</a>.</p>



<a name="241292250"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%232957%20Cranelift%3A%20restrict%20running%20tests%20dep.../near/241292250" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.232957.20Cranelift.3A.20restrict.20running.20tests.20dep.2E.2E.2E.html#241292250">(Jun 02 2021 at 17:35)</a>:</h4>
<p>abrown merged <a href="https://github.com/bytecodealliance/wasmtime/pull/2957">PR #2957</a>.</p>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>