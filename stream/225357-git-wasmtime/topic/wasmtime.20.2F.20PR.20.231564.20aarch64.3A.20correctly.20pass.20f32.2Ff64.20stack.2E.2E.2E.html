<html>
<head><meta charset="utf-8"><title>wasmtime / PR #1564 aarch64: correctly pass f32/f64 stack... · git-wasmtime · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/index.html">git-wasmtime</a></h2>
<h3>Topic: <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html">wasmtime / PR #1564 aarch64: correctly pass f32/f64 stack...</a></h3>

<hr>

<base href="https://bytecodealliance.zulipchat.com">

<head><link href="https://bytecodealliance.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="194803470"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194803470" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194803470">(Apr 21 2020 at 13:46)</a>:</h4>
<p>bnjbvr opened <a href="https://github.com/bytecodealliance/wasmtime/pull/1564" title="https://github.com/bytecodealliance/wasmtime/pull/1564">PR #1564</a> from <code>aarch64-fp-stack-args</code> to <code>master</code>:</p>
<blockquote>
<p>Thanks to a <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js" title="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js">particularly argument-heavy Spidermonkey test case</a>, I noticed that f32/f64 stack arguments were incorrectly passed as GPR. Here's a fix.</p>
<p>@cfallin, PTAL.</p>
</blockquote>



<a name="194803471"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194803471" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194803471">(Apr 21 2020 at 13:46)</a>:</h4>
<p><strong>bnjbvr</strong> requested <a href="https://github.com/cfallin" title="https://github.com/cfallin">cfallin</a> for a review on <a href="https://github.com/bytecodealliance/wasmtime/pull/1564" title="https://github.com/bytecodealliance/wasmtime/pull/1564">PR #1564</a>.</p>



<a name="194806429"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194806429" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194806429">(Apr 21 2020 at 14:06)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397365032" title="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397365032">PR Review</a>.</p>



<a name="194806430"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194806430" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194806430">(Apr 21 2020 at 14:06)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412215446" title="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412215446">PR Review Comment</a>:</p>
<blockquote>
<p>nit: <code>store_stack</code></p>
</blockquote>



<a name="194806843"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194806843" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194806843">(Apr 21 2020 at 14:08)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1564" title="https://github.com/bytecodealliance/wasmtime/pull/1564">PR #1564</a> from <code>aarch64-fp-stack-args</code> to <code>master</code>:</p>
<blockquote>
<p>Thanks to a <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js" title="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js">particularly argument-heavy Spidermonkey test case</a>, I noticed that f32/f64 stack arguments were incorrectly passed as GPR. Here's a fix.</p>
<p>@cfallin, PTAL.</p>
</blockquote>



<a name="194813902"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194813902" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194813902">(Apr 21 2020 at 14:56)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397413265" title="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397413265">PR Review</a>.</p>



<a name="194813903"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194813903" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194813903">(Apr 21 2020 at 14:56)</a>:</h4>
<p>cfallin submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397413265" title="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397413265">PR Review</a>.</p>



<a name="194813905"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194813905" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194813905">(Apr 21 2020 at 14:56)</a>:</h4>
<p>cfallin created <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412257285" title="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412257285">PR Review Comment</a>:</p>
<blockquote>
<p>I just realized: should this <code>16</code> be dependent on the calling convention? IIRC the Baldrdash/Wasm stack frame is actually 24 bytes, not 16 (and maybe would be padded to 32 to maintain 16-alignment, I'm not sure)?</p>
</blockquote>



<a name="194815357"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194815357" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194815357">(Apr 21 2020 at 15:04)</a>:</h4>
<p>bnjbvr submitted <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397423843" title="https://github.com/bytecodealliance/wasmtime/pull/1564#pullrequestreview-397423843">PR Review</a>.</p>



<a name="194815359"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194815359" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194815359">(Apr 21 2020 at 15:04)</a>:</h4>
<p>bnjbvr created <a href="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412266533" title="https://github.com/bytecodealliance/wasmtime/pull/1564#discussion_r412266533">PR Review Comment</a>:</p>
<blockquote>
<p>Yep, this is handled in #1530 :)</p>
</blockquote>



<a name="194817209"></a>
<h4><a href="https://bytecodealliance.zulipchat.com#narrow/stream/225357-git-wasmtime/topic/wasmtime%20/%20PR%20%231564%20aarch64%3A%20correctly%20pass%20f32/f64%20stack.../near/194817209" class="zl"><img src="https://bytecodealliance.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wasmtime GitHub notifications bot <a href="https://bytecodealliance.github.io/zulip-archive/stream/225357-git-wasmtime/topic/wasmtime.20.2F.20PR.20.231564.20aarch64.3A.20correctly.20pass.20f32.2Ff64.20stack.2E.2E.2E.html#194817209">(Apr 21 2020 at 15:15)</a>:</h4>
<p>bnjbvr updated <a href="https://github.com/bytecodealliance/wasmtime/pull/1564" title="https://github.com/bytecodealliance/wasmtime/pull/1564">PR #1564</a> from <code>aarch64-fp-stack-args</code> to <code>master</code>:</p>
<blockquote>
<p>Thanks to a <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js" title="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/js-reexport.js">particularly argument-heavy Spidermonkey test case</a>, I noticed that f32/f64 stack arguments were incorrectly passed as GPR. Here's a fix.</p>
<p>@cfallin, PTAL.</p>
</blockquote>



<hr><p>Last updated: Jan 20 2025 at 06:04 UTC</p>
</html>